import{aK as _,bc as I,cd as $,bg as y,dE as H,aG as j,bf as f,r as b,aJ as d,dx as L,aA as F,aB as B,bi as O,bn as R,br as U,d as J}from"./main.D-W_HyrW.js";function D(t,e){if(t&&t===e)return!0;try{return e?(typeof t=="string"&&(t=_.Address.parse(t)),typeof e=="string"&&(e=_.Address.parse(e)),t.equals(e)):!1}catch{return!1}}class C extends Error{url;status;statusText;body;request;constructor(e,n,r){super(r),this.name="ApiError",this.url=n.url,this.status=n.status,this.statusText=n.statusText,this.body=n.body,this.request=e}}class v extends Error{constructor(e){super(e),this.name="CancelError"}get isCancelled(){return!0}}class W{#t;#s;#e;#r;#a;#o;#n;constructor(e){this.#t=!1,this.#s=!1,this.#e=!1,this.#r=[],this.#a=new Promise((n,r)=>{this.#o=n,this.#n=r;const s=i=>{this.#t||this.#s||this.#e||(this.#t=!0,this.#o&&this.#o(i))},a=i=>{this.#t||this.#s||this.#e||(this.#s=!0,this.#n&&this.#n(i))},o=i=>{this.#t||this.#s||this.#e||this.#r.push(i)};return Object.defineProperty(o,"isResolved",{get:()=>this.#t}),Object.defineProperty(o,"isRejected",{get:()=>this.#s}),Object.defineProperty(o,"isCancelled",{get:()=>this.#e}),e(s,a,o)})}get[Symbol.toStringTag](){return"Cancellable Promise"}then(e,n){return this.#a.then(e,n)}catch(e){return this.#a.catch(e)}finally(e){return this.#a.finally(e)}cancel(){if(!(this.#t||this.#s||this.#e)){if(this.#e=!0,this.#r.length)try{for(const e of this.#r)e()}catch(e){console.warn("Cancellation threw an error",e);return}this.#r.length=0,this.#n&&this.#n(new v("Request aborted"))}}get isCancelled(){return this.#e}}const l={BASE:"",VERSION:"1.0.0",WITH_CREDENTIALS:!1,CREDENTIALS:"include",TOKEN:void 0,USERNAME:void 0,PASSWORD:void 0,HEADERS:void 0,ENCODE_PATH:void 0},g=t=>t!=null,m=t=>typeof t=="string",A=t=>m(t)&&t!=="",T=t=>typeof t=="object"&&typeof t.type=="string"&&typeof t.stream=="function"&&typeof t.arrayBuffer=="function"&&typeof t.constructor=="function"&&typeof t.constructor.name=="string"&&/^(Blob|File)$/.test(t.constructor.name)&&/^(Blob|File)$/.test(t[Symbol.toStringTag]),P=t=>t instanceof FormData,K=t=>{try{return btoa(t)}catch{return I.Buffer.from(t).toString("base64")}},M=t=>{const e=[],n=(s,a)=>{e.push(`${encodeURIComponent(s)}=${encodeURIComponent(String(a))}`)},r=(s,a)=>{g(a)&&(Array.isArray(a)?a.forEach(o=>{r(s,o)}):typeof a=="object"?Object.entries(a).forEach(([o,i])=>{r(`${s}[${o}]`,i)}):n(s,a))};return Object.entries(t).forEach(([s,a])=>{r(s,a)}),e.length>0?`?${e.join("&")}`:""},V=(t,e)=>{const n=encodeURI,r=e.url.replace("{api-version}",t.VERSION).replace(/{(.*?)}/g,(a,o)=>e.path?.hasOwnProperty(o)?n(String(e.path[o])):a),s=`${t.BASE}${r}`;return e.query?`${s}${M(e.query)}`:s},z=t=>{if(t.formData){const e=new FormData,n=(r,s)=>{m(s)||T(s)?e.append(r,s):e.append(r,JSON.stringify(s))};return Object.entries(t.formData).filter(([r,s])=>g(s)).forEach(([r,s])=>{Array.isArray(s)?s.forEach(a=>n(r,a)):n(r,s)}),e}},w=async(t,e)=>e,Q=async(t,e)=>{const[n,r,s,a]=await Promise.all([w(e,t.TOKEN),w(e,t.USERNAME),w(e,t.PASSWORD),w(e,t.HEADERS)]),o=Object.entries({Accept:"application/json",...a,...e.headers}).filter(([i,c])=>g(c)).reduce((i,[c,u])=>({...i,[c]:String(u)}),{});if(A(n)&&(o.Authorization=`Bearer ${n}`),A(r)&&A(s)){const i=K(`${r}:${s}`);o.Authorization=`Basic ${i}`}return e.body!==void 0&&(e.mediaType?o["Content-Type"]=e.mediaType:T(e.body)?o["Content-Type"]=e.body.type||"application/octet-stream":m(e.body)?o["Content-Type"]="text/plain":P(e.body)||(o["Content-Type"]="application/json")),new Headers(o)},Y=t=>{if(t.body!==void 0)return t.mediaType?.includes("/json")?JSON.stringify(t.body):m(t.body)||T(t.body)||P(t.body)?t.body:JSON.stringify(t.body)},Z=async(t,e,n,r,s,a,o)=>{const i=new AbortController,c={headers:a,body:r??s,method:e.method,signal:i.signal};return o(()=>i.abort()),await fetch(n,c)},X=(t,e)=>{if(e){const n=t.headers.get(e);if(m(n))return n}},ee=async t=>{if(t.status!==204)try{const e=t.headers.get("Content-Type");if(e)return["application/json","application/problem+json"].some(s=>e.toLowerCase().startsWith(s))?await t.json():await t.text()}catch(e){console.error(e)}},te=(t,e)=>{const r={400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable",...t.errors}[e.status];if(r)throw new C(t,e,r);if(!e.ok){const s=e.status??"unknown",a=e.statusText??"unknown",o=(()=>{try{return JSON.stringify(e.body,null,2)}catch{return}})();throw new C(t,e,`Generic Error: status: ${s}; status text: ${a}; body: ${o}`)}},S=(t,e)=>new W(async(n,r,s)=>{try{const a=V(t,e),o=z(e),i=Y(e),c=await Q(t,e);if(!s.isCancelled){const u=await Z(t,e,a,i,o,c,s),k=await ee(u),G=X(u,e.responseHeader),E={url:a,ok:u.ok,status:u.status,statusText:u.statusText,body:G??k};te(e,E),n(E.body)}}catch(a){r(a)}});class se{static calculateSwap(e,n,r,s){return S(l,{method:"GET",url:"/v2/swap/calculate",query:{fromAsset:e,toAsset:n,fromAmount:r,provider:s},errors:{500:"Default Response"}})}static encodeSwap(e){return S(l,{method:"POST",url:"/v2/swap/encode",body:e,mediaType:"application/json",errors:{500:"Default Response"}})}static swapGas(){return S(l,{method:"GET",url:"/v2/swap/gas",errors:{500:"Default Response"}})}static swapAssets(){return S(l,{method:"GET",url:"/v2/swap/assets",errors:{500:"Default Response"}})}}const x=()=>{const t=$();return l.BASE=t.web_swaps_url,{swapService:se,referralAddress:t.web_swaps_referral_address,isSwapsEnabled:!!t.web_swaps_url}},p=y(j),h=y(H),re=y(new d(1)),q=()=>{const[t,e]=f(p),[n,r]=f(h),s=b.useCallback(a=>{D(a.address,h.value.address)&&r(p.value),e(a)},[e,r]);return[t,s]},ne=()=>{const[t,e]=f(h),[n,r]=f(p),s=b.useCallback(a=>{D(a.address,p.value.address)&&r(h.value),e(a)},[e,r]);return[t,s]},ae=()=>f(re),le=()=>{const{data:e,isError:n}=oe(),[r]=q(),s=L(r);return F({queryKey:[B.swapMaxValue,e,r.id,s?.toFixed(0)],queryFn:async()=>{if(n)return s;if(!(!s||!e))if(r.id===j.id){const a=new d(e.dedust.tonToJetton),o=new d(e.stonfi.tonToJetton),i=s.minus(d.max(a,o)).minus(1e6);return i.lt(0)?new d(0):i}else return s},enabled:(!!e||n)&&s!==void 0})},oe=()=>{const{swapService:t}=x();return F({queryKey:[B.swapGasConfig],queryFn:async()=>t.swapGas()})},ie=y(void 0),ce=()=>f(ie),pe=()=>{const[t]=q(),[e]=ne(),[n]=ce(),{data:r,isLoading:s}=O(R(t.address)),{data:a,isLoading:o}=O(R(e.address)),i=n?.trade;if(!i||o||s)return;if(!r?.prices||!a?.prices)return null;const c=new d(i.from.relativeAmount).multipliedBy(r.prices),u=new d(i.to.relativeAmount).multipliedBy(a.prices);return c.isEqualTo(u)?new d(0):c.minus(u).dividedBy(c)},he=t=>t?t.isGreaterThan(.05)?"high":t.isGreaterThan(.01)?"medium":"low":"unknown",ye=()=>{const[t]=ae();return!t||t.isZero()},ue=(t,e,n,r)=>{const s=new URL("https://app.ston.fi/swap");return s.searchParams.append("ft",N(t)),s.searchParams.append("tt",N(e)),s.searchParams.append("referral_address",r||""),s.searchParams.append("utm_source",`tokeeper-${n}`),s.searchParams.append("utm_medium","organic"),s.searchParams.append("utm_campaign","swap_button"),s.searchParams.append("utm_content","TODO"),s.toString()},N=t=>U(t)?"ton":t.toString({urlSafe:!0}),de=y(!1),me=()=>{const[t,e]=f(de),{isSwapsEnabled:n}=x(),r=J(),s=$(),a=b.useCallback(o=>{if(o&&!n){const i=ue(p.value.address,h.value.address,s.tonkeeper_utm_track,s.stonfi_direct_link_referral_address);r.openPage(i)}else e(o)},[e,n,r,s.tonkeeper_utm_track,s.stonfi_direct_link_referral_address]);return[t,a]};export{q as a,x as b,ne as c,ae as d,D as e,ce as f,ye as g,le as h,pe as i,he as p,me as u};
