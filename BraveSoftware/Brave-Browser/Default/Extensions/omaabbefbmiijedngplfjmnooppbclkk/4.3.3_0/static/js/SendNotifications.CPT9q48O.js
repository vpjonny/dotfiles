import{i as fe,c1 as Ce,bk as ze,r as a,dx as $e,dy as Z,af as Ue,dz as Qe,c7 as Ge,dA as ye,dB as Je,dC as Ke,bn as be,aG as Q,aA as _e,ah as V,j as t,dp as Ne,dD as ce,F as qe,dE as Xe,bs as Ye,aJ as O,dF as Ze,s as C,dG as et,z as tt,dH as st,R as nt,cp as at,ab as H,dI as it,dJ as ot,cI as rt,a7 as ct,a8 as ee,a9 as te,bj as se,dK as ne,bo as lt,bV as ut,de as dt,bN as mt,u as pe,dL as je,dM as ft,dN as pt,dO as Be,dP as ht,dQ as Ve,B as v,bF as Me,dR as Oe,dS as xt,dT as At,d as he,ad as gt,bl as xe,b_ as Tt,bi as yt,dU as bt,dV as jt,ai as St,bD as le,bE as ue,dW as wt,dX as kt,dY as vt,dZ as Rt,d_ as Ct,d$ as _t,e0 as Nt,e1 as Bt,e2 as Vt,e3 as Mt,e4 as Ot,e5 as Ft,e6 as Et,e7 as It,ar as Dt,n as de,o as me,ax as Lt,ay as Wt,e8 as Fe,be as Ae,au as Pt,aE as Ht,aC as zt,aD as $t,aF as Ut,aN as Qt,aM as Gt,e9 as Jt,aO as Kt,bm as qt,bG as Xt,g as Ee,ea as Ie,eb as Yt,ec as Zt,ed as es,ae as ts,c0 as ss,bK as ns,ee as as,f as is,aP as os,aQ as rs,aR as cs,aS as ls,aT as Se,aU as us,aV as ds,aW as ms,ef as fs,eg as ps,eh as we,ei as ke,aX as ve,aY as Re,aZ as hs,K as xs,a_ as As,aK as gs,b8 as Ts,ej as ys,ek as bs,e as js}from"./main.D-W_HyrW.js";import{T as Ss}from"./TransitionGroup.CMby87Kf.js";const ws=(e,s)=>{const i=e.id===Xe.id?.9:.5,n=Ye(new O(Ze.jettonTransferAmount.toString())).multipliedBy(1.2).div(i).div(s);return V.fromRelativeAmount({asset:e,amount:n})},ks=C(et)`
    min-width: 32px;
    min-height: 32px;
    color: ${e=>e.theme.accentRed};
`,vs=C.div`
    display: flex;
    flex-direction: column;
    gap: 6px;
    align-items: center;
    width: 100%;
`,Rs=C(tt)`
    color: ${e=>e.theme.accentRed};
`,Cs=({isMax:e,assetAmount:s,...i})=>{const{t:n}=fe(),{onOpen:o}=Ce(),u=ze(),d=a.useMemo(()=>({type:"transfer",asset:s.asset}),[s.asset]),r=$e(s.asset),[m,h]=a.useState(s),p=Z(s.asset),{data:T}=Ue(d),{data:x}=Qe(i.recipient.address.address,s),_=p?T:x,[f,w]=a.useState(),j=Ge(),c=a.useCallback(g=>{const k=_?.find(I=>I.type===g);if(k&&(!ye(k)||k.isEnoughBalance))return w(g)},[_,j,i.onClose]),y=Je({recipient:i.recipient,amount:m,isMax:e,senderType:f}),A=Ke({recipient:i.recipient,amount:m,isMax:e,estimation:y.data,senderType:f});a.useEffect(()=>{!A.isIdle||!p||f||T&&w(T[0].type)},[f,p,JSON.stringify(T),A.isIdle]),a.useEffect(()=>{if(!A.isIdle||p||f)return;const g=x?.find(k=>k.isEnoughBalance);if(g?.isEnoughBalance)return w(g.type)},[f,p,JSON.stringify(x),A.isIdle]);const N=Z(s.asset)?be(s.asset.address):void 0,b=N!==Q.address&&e&&f==="gasless"&&Z(s.asset)&&r,R=_e(["current-token-to-ton-rate",be(s.asset.address)],async()=>{const g=await new st(u.tonApiV2).getRates({tokens:[N],currencies:["TON"]});return Object.values(g.rates)[0].prices.TON},{enabled:!!b});a.useEffect(()=>{if(!b)return h(s);if(!R.data)return;const g=ws(s.asset,R.data);h(new V({asset:s.asset,weiAmount:r.minus(g.weiAmount)}))},[e,s,f,r?.toFixed(0),R.data]);const F=_?.every(g=>ye(g)&&!g.isEnoughBalance);return t.jsx(Ne,{estimation:y,...A,...i,assetAmount:m,selectedSenderType:f,onSenderTypeChange:c,availableSendersOptions:_,children:F&&t.jsx(ce,{children:t.jsxs(vs,{children:[t.jsx(ks,{}),t.jsx(Rs,{children:n("send_confirm_tron_no_enough_balance_for_fee_error")}),t.jsx(qe,{size:"large",marginTop:!0,primary:!0,fullWidth:!0,onClick:()=>{i.onClose(),o()},children:n("tron_fee_banner_fee_options")})]})})})},_s=C.input`
    padding: 0;
    margin: 0;
    border: none;
    outline: none;
    /* added styles */
    font-family: inherit;
    font-size: inherit;
    background: transparent;
    color: ${e=>e.theme.textPrimary};

    font-family: 'Montserrat', sans-serif;
    font-style: normal;
    font-weight: 600;

    line-height: 49px;
    text-align: right;

    -moz-appearance: textfield;

    &::-webkit-outer-spin-button,
    &::-webkit-inner-spin-button {
        -webkit-appearance: none;
    }
`,De=nt.forwardRef(({value:e,setValue:s,inputSize:i},n)=>t.jsx(_s,{autoComplete:"off",autoCorrect:"off",spellCheck:!1,id:"sentence","data-testid":"amount-input",ref:n,style:{fontSize:`${i.size}px`,width:`${i.width}px`},inputMode:"decimal",type:"text",value:e,onChange:o=>{s(o.target.value)}}));De.displayName="Sentence";const Ns=C.div`
    background: ${e=>e.theme.buttonTertiaryBackground};
    border-radius: ${e=>e.theme.cornerMedium};
    padding: 0.5rem 1rem;
    display: flex;
    gap: 0.5rem;
`,Bs=C.span`
    color: ${e=>e.theme.iconSecondary};
    display: flex;
    align-items: center;
`,ae=C(dt)`
    border-radius: ${e=>e.theme.cornerFull};
    width: 24px;
    height: 24px;
`,ie=C.div`
    display: flex;
    gap: 0.5rem;
    width: 200px;
    overflow: hidden;
`,oe=C(mt)`
    color: ${e=>e.theme.textSecondary};
    text-overflow: ellipsis;
    overflow: hidden;
`,re=C.span`
    padding-left: 0.5rem;
    color: ${e=>e.theme.accentBlue};
    display: flex;
`,Vs=({onClose:e,jetton:s,jettons:i,setJetton:n,info:o})=>{const u=rt(),d=a.useRef(null);return a.useEffect(()=>{d.current&&d.current.parentElement?.parentElement?.scrollIntoView({behavior:"smooth"})},[d]),t.jsxs(ct,{margin:!1,dropDown:!0,children:[t.jsx(ee,{dropDown:!0,onClick:()=>{n(se.TON),e()},children:t.jsxs(te,{children:[t.jsxs(ie,{children:[t.jsx(ae,{src:"https://wallet.tonkeeper.com/img/toncoin.svg"}),t.jsx(H,{children:se.TON}),t.jsx(oe,{children:u(o?.balance??0)})]}),se.TON===s?t.jsx(re,{children:t.jsx(ne,{})}):void 0]})}),o?.extraBalance?.map(r=>t.jsx(ee,{dropDown:!0,onClick:()=>{n(r.preview.symbol),e()},children:t.jsxs(te,{children:[t.jsxs(ie,{children:[t.jsx(ae,{src:r.preview.image}),t.jsx(H,{children:r.preview.symbol}),t.jsx(oe,{children:u(r.amount,r.preview.decimals)})]}),r.preview.symbol===s?t.jsx(re,{ref:d,children:t.jsx(ne,{})}):void 0]})},r.preview.symbol)),i.balances.map(r=>t.jsx(ee,{dropDown:!0,onClick:()=>{n(r.jetton.address),e()},children:t.jsxs(te,{children:[t.jsxs(ie,{children:[t.jsx(ae,{src:r.jetton.image,noRadius:lt(r.jetton.address)}),t.jsx(H,{children:r.jetton.symbol}),t.jsx(oe,{children:ut(r).stringRelativeAmount})]}),r.jetton.address===s?t.jsx(re,{ref:d,children:t.jsx(ne,{})}):void 0]})},r.jetton.address))]})},Ms=({jetton:e,jettons:s,setJetton:i,info:n})=>t.jsx(at,{center:!0,payload:o=>t.jsx(Vs,{info:n,onClose:o,jetton:e,jettons:s,setJetton:i}),children:t.jsxs(Ns,{children:[t.jsx(H,{children:it(e,s)}),t.jsx(Bs,{children:t.jsx(ot,{})})]})}),Os=(e,s)=>{const{ios:i,standalone:n}=pe();a.useEffect(()=>{if(!i)return;const o=window.innerHeight;function u(){const m=e.current;if(!m)return;const h=o-this.height+16,p=n?Math.max(32,h):h;m.style.bottom=`${p}px`;const T=Math.min(this.height-16-56-16-36-16-16-16-16-37,272);s.current&&(s.current.style.height=`${T}px`)}function d(){const m=window.visualViewport;m&&m.removeEventListener("resize",u),setTimeout(()=>{const h=e.current;h&&(h.style.bottom=null)})}const r=window.visualViewport;return r&&(setTimeout(()=>u.call(r),300),r.addEventListener("resize",u)),()=>{d()}},[e.current,s.current])},Le={size:40,width:30},Fs=(e,s)=>{const i=s.clientWidth;let n=Le.size,o=je(e,`600 ${n}px 'Montserrat'`);for(;Math.round(o)>i-115;)n=Math.max(1,n-1),o=je(e,`600 ${n}px 'Montserrat'`);return{width:Math.max(Math.round(o)+5,e.length*6,30),size:n}},Es=(e,s)=>{a.useEffect(()=>{const i=setTimeout(()=>{e.current&&e.current.focus()},300);return()=>{clearTimeout(i)}},[e.current,s])};function U(e){return e.toFormat({groupSeparator:At(),decimalSeparator:xt()})}const Is=(e,s)=>{const{kind:i,payload:n}=s;switch(i){case"select":return{inputValue:"0",assetAmount:V.fromRelativeAmount({asset:n.token,amount:0}),inFiat:!1,isMax:!1};case"max":if(n.prices!==void 0){const o=n.balance.relativeAmount.multipliedBy(n.prices).decimalPlaces(2,O.ROUND_FLOOR);return{...e,inputValue:U(e.inFiat?o:n.balance.relativeAmount),fiatValue:o,assetAmount:n.balance,isMax:!e.isMax}}else return{...e,inputValue:U(n.balance.relativeAmount),assetAmount:n.balance,isMax:!e.isMax};case"input":{const o=e.inFiat?2:e.assetAmount.asset.decimals;let u=ft(n.value);pt(u,o)||(u=e.inputValue),Be(u)&&(u=ht(u));const d=Ve(u),r=e.inFiat?d.div(n.prices??0):d,m=e.inFiat?d:d.multipliedBy(n.prices??0);return{...e,inputValue:u,assetAmount:V.fromRelativeAmount({asset:e.assetAmount.asset,amount:r}),fiatValue:m,isMax:!1}}case"price":{if(!n.prices)return e;const o=e.assetAmount.relativeAmount.multipliedBy(n.prices).decimalPlaces(2,O.ROUND_FLOOR);return{...e,fiatValue:o}}case"toggle":{const o=U(e.inFiat?e.assetAmount.relativeAmount.decimalPlaces(e.assetAmount.asset.decimals,O.ROUND_FLOOR):e.fiatValue?.decimalPlaces(2,O.ROUND_FLOOR)??new O(0));return{...e,inputValue:o,inFiat:!e.inFiat}}default:return e}},Ds=(e,s)=>{const i=e?.inFiat??!1,n=e?.assetAmount?.asset||(s===v.TON?Q:Me);return{inputValue:e?.inputValue??U((i?e?.fiatValue:e?.assetAmount?.relativeAmount)||new O(0)),assetAmount:e?.assetAmount??V.fromRelativeAmount({asset:n,amount:0}),fiatValue:e?.fiatValue,inFiat:i,isMax:e?.isMax??!1}},Ls=e=>e.assetAmount.asset.blockchain===v.TRON?e.assetAmount.asset.symbol:Oe(e.assetAmount.asset,{userFriendly:!0}),Ws=({recipient:e,onClose:s,onBack:i,onConfirm:n,defaults:o,MainButton:u,HeaderBlock:d,isAnimationProcess:r})=>{const{t:m}=fe(),h=he(),{standalone:p,fiat:T}=pe(),x=e.address.blockchain,f=gt()&&r,{data:w}=xe(),{data:j}=Tt(),[c,y]=a.useReducer(Is,Ds(o,x)),{data:A,isLoading:N}=yt(Ls(c)),{data:b,isLoading:R}=bt(c.assetAmount.asset),F=a.useRef(null),g=a.useRef(null),k=a.useRef(null);Os(k,g),Es(F,c.assetAmount.asset);const[I,G]=a.useState(Le);a.useLayoutEffect(()=>{g.current&&G(Fs(c.inputValue,g.current))},[g.current,c.inputValue]),a.useEffect(()=>{y({kind:"price",payload:{prices:A?.prices}})},[y,A]);const D=a.useCallback(()=>{y({kind:"toggle",payload:void 0})},[]),J=a.useCallback(B=>{y({kind:"input",payload:{value:B,prices:A?.prices}})},[y,A]),K=a.useCallback(()=>{y({kind:"max",payload:{balance:b,prices:A?.prices}})},[y,b,A]),q=a.useCallback(B=>{w&&y({kind:"select",payload:{token:jt(B,j,w)}})},[y,w]),L=b.relativeAmount.minus(c.assetAmount.relativeAmount),W=L.gte(0),P=a.useMemo(()=>W&&Be(c.inputValue)&&Ve(c.inputValue).isGreaterThan(0),[W,c.inputValue]),X=a.useCallback(()=>{i(c)},[i,c]),z=a.useCallback(()=>{P?n(c):h.hapticNotification("error")},[P,n,c,h]),Y=async B=>{B.stopPropagation(),B.preventDefault(),z()};return t.jsxs(St,{onSubmit:Y,standalone:p,children:[!f&&t.jsx(le,{children:t.jsx(ue,{children:t.jsx(d,{onClose:s,onBack:X,children:t.jsxs(wt,{children:[m("send_screen_steps_done_to").replace("%{name}",""),t.jsx(kt,{recipient:e}),t.jsx(vt,{recipient:e})]})})})}),t.jsxs(Rt,{ref:g,children:[t.jsx(Ct,{children:x===v.TON?t.jsx(Ms,{info:j,jetton:Oe(c.assetAmount.asset),setJetton:q,jettons:w??{balances:[]}}):t.jsx(_t,{children:t.jsx(H,{children:"TRC20"})})}),t.jsxs(Nt,{children:[t.jsx(De,{ref:F,value:c.inputValue,setValue:J,inputSize:I}),t.jsx(Bt,{children:c.inFiat?T:c.assetAmount.asset.symbol})]}),t.jsx(Vt,{amountState:c,toggleFiat:D})]}),t.jsxs(Mt,{children:[t.jsx(Ot,{maxValue:c.isMax,onClick:K,children:m("send_screen_steps_amount_max")}),W?t.jsxs(Ft,{children:[m("send_screen_steps_amount_remaining").replace("%{amount}",Et.format(L,{decimals:c.assetAmount.asset.decimals}))," ",c.assetAmount.asset.symbol]}):t.jsx(It,{children:m("send_screen_steps_amount_insufficient_balance")})]}),t.jsx(Dt,{}),!f&&t.jsx(de,{children:t.jsx(me,{children:t.jsx(u,{ref:k,isDisabled:!P,isLoading:N||R,onClick:z})})})]})},Ps={type:"multisig",ttlSeconds:60*5};function Hs(e,s,i){const n=Lt(Ps),o=Wt(n),u=Fe();return _e(["multisig-transfer-estimation",e,s,i,o],async()=>{const d=await n(),r=e.comment;return u.estimate(d,{to:Ae(e.address.address)?e.address.address:e.toAccount.address,amount:s,isMax:i,payload:r?{type:"comment",value:r}:void 0})},{enabled:!!e,refetchOnMount:"always"})}function zs(e,s,i,n,o){const u=Fe(),d=Pt(),r=Ht(),m=zt(),{mutateAsync:h}=$t();return Ut(async()=>{try{const p=Number(n)*60,T=await r({type:"multisig",ttlSeconds:p}),x=e.comment;await u.send(T,o,{to:Ae(e.address.address)?e.address.address:e.toAccount.address,amount:s,isMax:i,payload:x?{type:"comment",value:x}:void 0}),s.asset.id===Q.id?m("send-ton"):m("send-jetton")}catch(p){await d(p)}return await h(),!0})}const $s=C(Kt)`
    margin-bottom: 1rem;
`,Us=({isMax:e,ttl:s,children:i,...n})=>{const{signerWallet:o}=Qt(),{data:u}=Gt(),d=Hs(n.recipient,n.assetAmount,e),r=zs(n.recipient,n.assetAmount,e,s,d.data);return t.jsxs(Ne,{estimation:d,...r,...n,children:[i,t.jsx(Jt,{children:u?t.jsx($s,{status:"progress",signedWallets:[],threshold:u.threshold,pendingWallets:u.signers,hostAddress:o.rawAddress,secondsLeft:Number(s)*60}):null})]})},Qs=({onClose:e,chain:s,initRecipient:i,initAmountState:n})=>{const o=he(),{standalone:u,ios:d,extension:r}=pe(),{t:m}=fe(),{data:h}=xe(),p=ts(),T=Ie(),[x,_]=a.useState(p?"multisig-settings":"recipient"),f=a.useCallback(l=>{!p&&l==="multisig-settings"&&(l="recipient"),_(l)},[_,p]),[w,j]=a.useState(!0),[c,y]=a.useState(),[A,N]=a.useState(i),[b,R]=a.useState(n);a.useEffect(()=>{i&&T("send_click",{from:"send_amount",token:b?.assetAmount?.asset?.symbol??"ton"})},[]);const F=ss(),{onOpen:g}=Ce(),k=ns(),{mutateAsync:I,isLoading:G}=Ee(),D=l=>{b?.assetAmount?.asset?.blockchain&&b?.assetAmount?.asset?.blockchain!==l.address.blockchain&&R(void 0),N(l),k&&l.address.blockchain===v.TRON&&R({assetAmount:V.fromRelativeAmount({asset:Me,amount:0})})},J=l=>{if(l.address.blockchain===v.TRON&&F.total===0)return g();j(!0),D(l),f("amount"),T("send_click",{from:"send_recipient",token:b?.assetAmount?.asset?.symbol??"ton"})},K=l=>{j(!0),R(l),f("confirm"),T("send_confirm",{from:"send_amount",token:b?.assetAmount?.asset?.symbol??"ton"})},q=l=>{j(!1),R(l),f("recipient")},L=()=>{d&&bs("decimal"),j(!1),f("amount")},W=l=>{if(!k)return;const S={address:l,blockchain:v.TRON};D({address:S,done:!0}),f("amount")},P=async({address:l,text:S})=>{const E={address:l,blockchain:v.TON},M=await I(E),Te=M.memoRequired?!!(M.memoRequired&&S):!0;D({address:E,toAccount:M,comment:S??"",done:Te})},X=a.useCallback(async({amount:l,jetton:S})=>{if(S&&h){let E;try{E=as(S,h)}catch{return o.uiEvents.emit("copy",{method:"copy",params:m("Unexpected_QR_Code")}),!1}const M=new V({asset:E,weiAmount:l||"0"});R({assetAmount:M,inFiat:!1,isMax:!1})}else R({assetAmount:new V({asset:n?.assetAmount?.asset??Q,weiAmount:l??0}),inFiat:!1,isMax:!1});return!0},[o,h,n?.assetAmount]),z=is(),Y=async l=>{const S=As({url:l});if(S){try{if(gs.Address.parseFriendly(S.address).isTestOnly&&z===Ts.MAINNET)return o.uiEvents.emit("copy",{method:"copy",params:m("Unexpected_QR_Code")})}catch{}await X(S)&&await P(S);return}return ys(l)?W(l):o.uiEvents.emit("copy",{method:"copy",params:m("Unexpected_QR_Code")})},B=a.useRef(null),We=a.useRef(null),Pe=a.useRef(null),He=a.useRef(null),ge={"multisig-settings":B,recipient:We,amount:Pe,confirm:He}[x];let $=[];return s?s===v.TRON&&!k?$=[v.TON]:$=[s]:$=k?[v.TON,v.TRON]:[v.TON],t.jsx(os,{standalone:u,extension:r,children:t.jsx(Ss,{childFactory:rs(w),children:t.jsx(cs,{nodeRef:ge,classNames:"right-to-left",addEndListener:l=>{setTimeout(l,hs)},children:l=>t.jsxs("div",{ref:ge,children:[x==="multisig-settings"&&t.jsx(ls,{onSubmit:S=>{j(!0),y(S.lifetime),f("recipient")},isAnimationProcess:l==="exiting",header:t.jsx(us,{title:m("multisig_create_order_title"),onClose:e}),MainButton:Se}),x==="recipient"&&t.jsx(ds,{data:A,setRecipient:J,onScan:Y,keyboard:"decimal",isExternalLoading:G,acceptBlockchains:$,MainButton:Se,HeaderBlock:()=>t.jsx(ms,{onBack:p?()=>{j(!1),f("multisig-settings")}:void 0,title:m("transaction_recipient"),onClose:e}),isAnimationProcess:l==="exiting"}),x==="amount"&&t.jsx(Ws,{defaults:b,onClose:e,onBack:q,recipient:A,onConfirm:K,MainButton:ps,HeaderBlock:fs,isAnimationProcess:l==="exiting"}),x==="confirm"&&(p?t.jsxs(Us,{onClose:e,onBack:L,recipient:A,assetAmount:b.assetAmount,isMax:b.isMax,ttl:c,children:[t.jsx(we,{children:l!=="exiting"&&t.jsx(le,{children:t.jsx(ue,{children:t.jsx(ke,{})})})}),t.jsx(ce,{children:l!=="exiting"&&t.jsx(de,{children:t.jsx(me,{children:t.jsx(ve,{MainButton:Re})})})})]}):t.jsxs(Cs,{onClose:e,onBack:L,recipient:A,assetAmount:b.assetAmount,isMax:b.isMax,children:[t.jsx(we,{children:l!=="exiting"&&t.jsx(le,{children:t.jsx(ue,{children:t.jsx(ke,{})})})}),t.jsx(ce,{children:l!=="exiting"&&t.jsx(de,{children:t.jsx(me,{children:t.jsx(ve,{MainButton:Re})})})})]}))]})},x)})})},Gs=C(js)`
    ${e=>e.theme.proDisplayType==="mobile"&&xs`
            --height: calc(100% - (env(safe-area-inset-top) + 10px));
        `}
`,qs=()=>{const[e,s]=a.useState(!1),[i,n]=a.useState(void 0),[o,u]=a.useState(void 0),{key:d}=xe(),r=qt(),m=Xt(),{mutateAsync:h,reset:p}=Ee(),T=he(),x=Ie();a.useEffect(()=>{const w=async j=>{p();const c=j.params;if(n(j.params.chain),c.chain===v.TRON){u(Yt(c)),s(!0),x("send_open",{from:c.from});return}const y=await h({address:m.rawAddress}),A=await r.fetchQuery(d);if(c.address&&Ae(c.address)){const N=await h({address:c.address});u(Zt(c,y,N,A)),s(!0)}else u({initAmountState:es(c,y,A)}),s(!0);x("send_open",{from:c.from})};return T.uiEvents.on("transfer",w),()=>{T.uiEvents.off("transfer",w)}},[d,x]);const _=a.useCallback(()=>{u(void 0),s(!1)},[]),f=a.useCallback(()=>t.jsx(Qs,{onClose:_,chain:i,initAmountState:o?.initAmountState,initRecipient:o?.initRecipient}),[e,o,i]);return t.jsx(Gs,{isOpen:e,handleClose:_,hideButton:!0,backShadow:!0,footer:t.jsx(t.Fragment,{}),mobileFullScreen:!0,children:f})};export{qs as default};
