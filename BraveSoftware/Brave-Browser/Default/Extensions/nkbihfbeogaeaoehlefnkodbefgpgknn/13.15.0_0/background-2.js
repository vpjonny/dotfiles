LavaPack.loadBundle([[2673,{"../fsm.cjs":2655,"../logging.cjs":2662,"../utils.cjs":2686,"./Timer.cjs":2674,"./constants.cjs":2675,"./location/index.cjs":2678,"./registry/index.cjs":2682,"./selectors.cjs":2685,"@metamask/approval-controller":1257,"@metamask/base-controller":1362,"@metamask/permission-controller":2443,"@metamask/rpc-errors":2600,"@metamask/snaps-rpc-methods":2730,"@metamask/snaps-sdk":2786,"@metamask/snaps-utils":2903,"@metamask/utils":3116,"@xstate/fsm":3589,"async-mutex":3906,nanoid:5037,semver:5586},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t,n){a(e,t),t.set(e,n)}function a(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t){return e.get(c(e,t))}function o(e,t,n){return e.set(c(e,t),n),n}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.SnapController=n.SNAP_APPROVAL_RESULT=n.SNAP_APPROVAL_UPDATE=n.SNAP_APPROVAL_INSTALL=n.controllerName=void 0;const l=e("@metamask/approval-controller"),u=e("@metamask/base-controller"),d=e("@metamask/permission-controller"),p=e("@metamask/rpc-errors"),h=e("@metamask/snaps-rpc-methods"),m=e("@metamask/snaps-sdk"),f=e("@metamask/snaps-utils"),g=e("@metamask/utils"),S=e("@xstate/fsm"),E=e("async-mutex"),_=e("nanoid"),T=e("semver"),y=e("./constants.cjs"),w=e("./location/index.cjs"),b=e("./registry/index.cjs"),I=e("./selectors.cjs"),A=e("./Timer.cjs"),v=e("../fsm.cjs"),k=e("../logging.cjs"),C=e("../utils.cjs");n.controllerName="SnapController",n.SNAP_APPROVAL_INSTALL="wallet_installSnap",n.SNAP_APPROVAL_UPDATE="wallet_updateSnap",n.SNAP_APPROVAL_RESULT="wallet_installSnapResult";const N=new Set(["initialPermissions","id","version","enabled","blocked"]),R={snaps:{},snapStates:{},unencryptedSnapStates:{},isReady:!1};function P(e){return Object.keys(e).reduce((t,n)=>(N.has(n)&&(t[n]=e[n]),t),{})}var M=new WeakMap,O=new WeakMap,D=new WeakMap,L=new WeakMap,j=new WeakMap,B=new WeakMap,x=new WeakMap,F=new WeakMap,U=new WeakMap,H=new WeakMap,q=new WeakMap,G=new WeakMap,$=new WeakMap,W=new WeakMap,V=new WeakMap,Y=new WeakMap,K=new WeakMap,Q=new WeakMap,z=new WeakMap,X=new WeakMap,J=new WeakMap,Z=new WeakSet,ee=new WeakMap;class te extends u.BaseController{constructor({closeAllConnections:e,messenger:t,state:l,dynamicPermissions:u=["endowment:caip25","wallet_snap"],environmentEndowmentPermissions:d=[],excludedPermissions:p={},idleTimeCheckInterval:h=(0,g.inMilliseconds)(5,g.Duration.Second),maxIdleTime:S=(0,g.inMilliseconds)(30,g.Duration.Second),maxRequestTime:E=(0,g.inMilliseconds)(60,g.Duration.Second),fetchFunction:_=globalThis.fetch.bind(undefined),featureFlags:T={},detectSnapLocation:b=w.detectSnapLocation,preinstalledSnaps:I=null,encryptor:A,getMnemonicSeed:v,getFeatureFlags:k=()=>({}),clientCryptography:N,trackEvent:P,ensureOnboardingComplete:te}){var ie,oe,ce;super({messenger:t,metadata:{isReady:{includeInStateLogs:!0,includeInDebugSnapshot:!0,persist:!1,usedInUi:!1},snapStates:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1},unencryptedSnapStates:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1},snaps:{includeInStateLogs:e=>Object.values(e).reduce((e,t)=>{const n={...t};return delete n.sourceCode,delete n.auxiliaryFiles,e[t.id]=n,e},{}),persist:e=>Object.values(e).filter(e=>e.status!==f.SnapStatus.Installing).map(e=>({...e,status:f.SnapStatus.Stopped})).reduce((e,t)=>(e[t.id]=t,e),{}),includeInDebugSnapshot:!1,usedInUi:!0}},name:n.controllerName,state:{...R,...l}}),a(oe=this,ce=Z),ce.add(oe),r(this,M,void 0),r(this,O,void 0),r(this,D,void 0),r(this,L,void 0),r(this,j,void 0),r(this,B,void 0),r(this,x,void 0),r(this,F,void 0),s(this,"maxRequestTime",void 0),r(this,U,void 0),r(this,H,void 0),r(this,q,void 0),r(this,G,void 0),r(this,$,void 0),r(this,W,void 0),r(this,V,void 0),r(this,Y,void 0),r(this,K,void 0),r(this,Q,void 0),r(this,z,void 0),r(this,X,void 0),r(this,J,void 0),r(this,ee,(0,C.debouncePersistState)((e,t,n)=>{c(Z,this,Xe).call(this,e).stateMutex.runExclusive(async()=>{const s=await c(Z,this,Ee).call(this,e,t,n);return n?this.update(t=>{t.snapStates[e]=s}):this.update(t=>{t.unencryptedSnapStates[e]=s})}).catch(f.logError)},y.STATE_DEBOUNCE_TIMEOUT)),o(M,this,e),o(O,this,u),o(D,this,d),o(L,this,p),o(j,this,T),o(B,this,_),o(x,this,h),o(F,this,S),this.maxRequestTime=E,o($,this,b),o(U,this,A),o(H,this,v),o(q,this,k),o(G,this,N),o(Q,this,I),this._onUnhandledSnapError=this._onUnhandledSnapError.bind(this),this._onOutboundRequest=this._onOutboundRequest.bind(this),this._onOutboundResponse=this._onOutboundResponse.bind(this),o(V,this,new Map),o(W,this,new Map),o(z,this,P),o(J,this,te),c(Z,this,ae).call(this),this.messenger.subscribe("ExecutionService:unhandledError",this._onUnhandledSnapError),this.messenger.subscribe("ExecutionService:outboundRequest",this._onOutboundRequest),this.messenger.subscribe("ExecutionService:outboundResponse",this._onOutboundResponse),this.messenger.subscribe("SnapController:snapInstalled",({id:e},t)=>{c(Z,this,it).call(this,t,e,f.HandlerType.OnInstall).catch(t=>{(0,f.logError)(`Error when calling \`onInstall\` lifecycle hook for snap "${e}": ${(0,m.getErrorMessage)(t)}`)})}),this.messenger.subscribe("SnapController:snapUpdated",({id:e},t,n)=>{c(Z,this,it).call(this,n,e,f.HandlerType.OnUpdate).catch(t=>{(0,f.logError)(`Error when calling \`onUpdate\` lifecycle hook for snap "${e}": ${(0,m.getErrorMessage)(t)}`)})}),this.messenger.subscribe("KeyringController:lock",c(Z,this,ot).bind(this)),c(Z,this,ne).call(this),c(Z,this,se).call(this),Object.values((null===(ie=this.state)||void 0===ie?void 0:ie.snaps)??{}).forEach(e=>c(Z,this,Je).call(this,e.id)),i(Q,this)&&c(Z,this,re).call(this,i(Q,this)),o(X,this,(0,C.throttleTracking)((e,t,n,s)=>{const r=this.messenger.call("SnapsRegistry:getMetadata",e);i(z,this).call(this,{event:"Snap Export Used",category:"Snaps",properties:{snap_id:e,export:t,snap_category:null==r?void 0:r.category,success:n,origin:s}})}))}init(){c(Z,this,ue).call(this).catch(f.logWarning),c(Z,this,at).call(this,y.METAMASK_ORIGIN,f.HandlerType.OnStart)}async updateRegistry(){await c(Z,this,ue).call(this),await this.messenger.call("SnapsRegistry:update");const e=await this.messenger.call("SnapsRegistry:get",Object.values(this.state.snaps).reduce((e,t)=>(e[t.id]={version:t.version,checksum:t.manifest.source.shasum},e),{}));if(await Promise.all(Object.entries(e).map(async([e,{status:t,reason:n}])=>t===b.SnapsRegistryStatus.Blocked?c(Z,this,ie).call(this,e,n):c(Z,this,oe).call(this,e))),!i(j,this).autoUpdatePreinstalledSnaps)return;await Promise.allSettled(Object.values(this.state.snaps).filter(e=>e.preinstalled).map(async e=>{const t=await c(Z,this,ke).call(this,e.id,"*");if("*"!==t&&(0,g.gtVersion)(t,e.version)){const n=i($,this).call(this,e.id,{versionRange:t,fetch:i(B,this),allowLocal:!1,useNpmProxy:!0});await c(Z,this,ve).call(this,{origin:l.ORIGIN_METAMASK,snapId:e.id,location:n,versionRange:t,automaticUpdate:!0})}}))}_onUnhandledSnapError(e,t){(0,f.logError)(`Unhandled error from "${e}":`,t),this.stopSnap(e,f.SnapStatusEvents.Crash).catch(e=>{(0,f.logError)(e)})}_onOutboundRequest(e){const t=c(Z,this,Xe).call(this,e);t.pendingInboundRequests.filter(e=>"running"===e.timer.status).forEach(e=>e.timer.pause()),t.pendingOutboundRequests+=1}_onOutboundResponse(e){const t=c(Z,this,Xe).call(this,e);t.pendingOutboundRequests-=1,0===t.pendingOutboundRequests&&t.pendingInboundRequests.filter(e=>"paused"===e.timer.status).forEach(e=>e.timer.resume())}async startSnap(e){await c(Z,this,ue).call(this);const t=this.state.snaps[e];if(!t.enabled)throw new Error(`Snap "${e}" is disabled.`);await c(Z,this,Ne).call(this,{snapId:e,sourceCode:t.sourceCode})}enableSnap(e){if(this.getExpect(e),this.state.snaps[e].blocked)throw new Error(`Snap "${e}" is blocked and cannot be enabled.`);this.update(t=>{t.snaps[e].enabled=!0}),this.messenger.publish("SnapController:snapEnabled",this.getTruncatedExpect(e))}async disableSnap(e){if(!this.has(e))throw new Error(`Snap "${e}" not found.`);this.update(t=>{t.snaps[e].enabled=!1}),this.isRunning(e)&&await this.stopSnap(e,f.SnapStatusEvents.Stop),this.messenger.publish("SnapController:snapDisabled",this.getTruncatedExpect(e))}async stopSnap(e,t=f.SnapStatusEvents.Stop){const n=c(Z,this,ze).call(this,e);if(!n)throw new Error(`The snap "${e}" is not running.`);if(n.stopPromise)return void await n.stopPromise;const{promise:s,resolve:r}=(0,g.createDeferredPromise)();n.stopPromise=s;try{var a;if(this.isRunning(e))null===(a=i(M,this))||void 0===a||a.call(this,e),await c(Z,this,he).call(this,e)}finally{n.lastRequest=null,n.pendingInboundRequests=[],n.pendingOutboundRequests=0,n.stopPromise=null,this.isRunning(e)&&c(Z,this,pe).call(this,e,t),r()}}async stopAllSnaps(e=f.SnapStatusEvents.Stop){const t=Object.values(this.state.snaps).filter(e=>this.isRunning(e.id)).map(async t=>this.stopSnap(t.id,e));await Promise.allSettled(t)}isRunning(e){return"running"===this.getExpect(e).status}has(e){return Boolean(this.get(e))}get(e){return this.state.snaps[e]}getExpect(e){const t=this.get(e);return(0,g.assert)(t!==undefined,`Snap "${e}" not found.`),t}getTruncated(e){const t=this.get(e);return t?P(t):null}getTruncatedExpect(e){return P(this.getExpect(e))}async updateSnapState(e,t,n){const s=c(Z,this,Xe).call(this,e);n?s.state=t:s.unencryptedState=t,i(ee,this).call(this,e,t,n)}clearSnapState(e,t){const n=c(Z,this,Xe).call(this,e);t?n.state=null:n.unencryptedState=null,i(ee,this).call(this,e,null,t)}async getSnapState(e,t){const n=c(Z,this,Xe).call(this,e);return await n.getStateMutex.runExclusive(async()=>{const s=t?n.state:n.unencryptedState;if(s!==undefined)return s;const r=t?this.state.snapStates[e]:this.state.unencryptedSnapStates[e];if(null===r||r===undefined)return null;if(!t){const e=JSON.parse(r);return n.unencryptedState=e,e}const a=await c(Z,this,ge).call(this,e,r);return n.state=a,a})}async getSnapFile(e,t,n=m.AuxiliaryFileEncoding.Base64){var s;const r=this.getExpect(e),a=(0,f.normalizeRelative)(t),i=null===(s=r.auxiliaryFiles)||void 0===s||null===(s=s.find(e=>e.path===a))||void 0===s?void 0:s.value;if(!i)return null;const o=await(0,f.encodeAuxiliaryFile)(i,n);return(0,g.assert)(o.length<f.MAX_FILE_SIZE,`Failed to encode static file to "${n}": Static files must be less than 64 MB when encoded.`),o}isMinimumPlatformVersion(e,t){const n=this.getExpect(e),{platformVersion:s}=n.manifest;return!!s&&(0,T.gte)(s,t)}async clearState(){const e=Object.keys(this.state.snaps);await this.stopAllSnaps(),e.forEach(e=>c(Z,this,we).call(this,e)),this.update(e=>{e.isReady=!1,e.snaps={},e.snapStates={},e.unencryptedSnapStates={}}),i(W,this).clear(),i(V,this).clear(),i(Q,this)&&c(Z,this,re).call(this,i(Q,this))}async removeSnap(e){return this.removeSnaps([e])}async removeSnaps(e){if(!Array.isArray(e))throw new Error("Expected array of snap ids.");e.forEach(e=>{const t=this.getExpect(e);(0,g.assert)(!1!==t.removable,`${e} is not removable.`)}),await Promise.all(e.map(async e=>{const t=this.getExpect(e),n=this.getTruncatedExpect(e);await this.disableSnap(e),c(Z,this,we).call(this,e),c(Z,this,ye).call(this,e),i(W,this).delete(e),this.update(t=>{delete t.snaps[e],delete t.snapStates[e],delete t.unencryptedSnapStates[e]}),t.status!==f.SnapStatus.Installing&&this.messenger.publish("SnapController:snapUninstalled",n)}))}removeSnapFromSubject(e,t){var n,s;const r=this.messenger.call("PermissionController:getPermissions",e),a=null==r||null===(n=r[h.WALLET_SNAP_PERMISSION_KEY])||void 0===n||null===(n=n.caveats)||void 0===n?void 0:n.find(e=>e.type===f.SnapCaveatType.SnapIds);if(!a)return;if(Boolean(null===(s=a.value)||void 0===s?void 0:s[t])){const n={...a.value};delete n[t],Object.keys(n).length>0?this.messenger.call("PermissionController:updateCaveat",e,h.WALLET_SNAP_PERMISSION_KEY,f.SnapCaveatType.SnapIds,n):this.messenger.call("PermissionController:revokePermissions",{[e]:[h.WALLET_SNAP_PERMISSION_KEY]})}}revokeDynamicSnapPermissions(e,t){(0,g.assert)(t.every(e=>i(O,this).includes(e)),"Non-dynamic permissions cannot be revoked"),this.messenger.call("PermissionController:revokePermissions",{[e]:t})}incrementActiveReferences(e){c(Z,this,Xe).call(this,e).activeReferences+=1}decrementActiveReferences(e){const t=c(Z,this,Xe).call(this,e);(0,g.assert)(t.activeReferences>0,"SnapController reference management is in an invalid state."),t.activeReferences-=1}getAllSnaps(){return Object.values(this.state.snaps).map(P)}getRunnableSnaps(){return(0,I.getRunnableSnaps)(this.getAllSnaps())}getPermittedSnaps(e){var t;const n=(null===(t=(this.messenger.call("PermissionController:getPermissions",e)??{})[h.WALLET_SNAP_PERMISSION_KEY])||void 0===t||null===(t=t.caveats)||void 0===t||null===(t=t.find(e=>e.type===f.SnapCaveatType.SnapIds))||void 0===t?void 0:t.value)??{};return Object.keys(n).reduce((e,t)=>{const n=this.get(t),s=this.getTruncated(t);return s&&(null==n?void 0:n.status)!==f.SnapStatus.Installing&&(e[t]=s),e},{})}async installSnaps(e,t){await c(Z,this,ue).call(this);const n={},s=Object.keys(t),r=[],a=[];try{for(const[s,{version:o}]of Object.entries(t)){(0,f.assertIsValidSnapId)(s);const[t,l]=(0,f.resolveVersionRange)(o);if(t)throw p.rpcErrors.invalidParams(`The "version" field must be a valid SemVer version range if specified. Received: "${o}".`);const u=i($,this).call(this,s,{versionRange:l,fetch:i(B,this),allowLocal:i(j,this).allowLocalSnaps,resolveVersion:async e=>i(j,this).requireAllowlist?await c(Z,this,ke).call(this,s,e):e}),d=this.has(s)&&!u.shouldAlwaysReload;if(d&&c(Z,this,rt).call(this,s,l)){const e=this.getExpect(s);r.push({snapId:s,oldVersion:e.version});let t=c(Z,this,Ve).call(this,s);if(t!==undefined)throw new Error("This snap is already being updated.");t=c(Z,this,Ye).call(this,s),t.newVersion=l}else d||a.push(s);n[s]=await c(Z,this,be).call(this,e,s,u,l)}a.forEach(t=>this.messenger.publish("SnapController:snapInstalled",this.getTruncatedExpect(t),e,!1)),r.forEach(({snapId:t,oldVersion:n})=>this.messenger.publish("SnapController:snapUpdated",this.getTruncatedExpect(t),n,e,!1)),s.forEach(e=>i(V,this).delete(e))}catch(e){const t=a.filter(e=>this.has(e));await this.removeSnaps(t);const n=[...i(V,this).keys()],s=r.map(({snapId:e})=>e).filter(e=>n.includes(e));throw await c(Z,this,Qe).call(this,s),e}return n}destroy(){super.destroy(),i(Y,this)&&clearTimeout(i(Y,this)),this.messenger.unsubscribe("ExecutionService:unhandledError",this._onUnhandledSnapError),this.messenger.unsubscribe("ExecutionService:outboundRequest",this._onOutboundRequest),this.messenger.unsubscribe("ExecutionService:outboundResponse",this._onOutboundResponse),this.messenger.clearEventSubscriptions("SnapController:snapInstalled"),this.messenger.clearEventSubscriptions("SnapController:snapUpdated")}async handleRequest({snapId:e,origin:t,handler:n,request:s}){await c(Z,this,ue).call(this);const r=this.get(e);(0,g.assert)(r,`The Snap "${e}" is not installed. Please install it before invoking it.`),(0,g.assert)(t===y.METAMASK_ORIGIN||(0,f.isValidUrl)(t),"'origin' must be a valid URL or 'metamask'.");const a={jsonrpc:"2.0",id:(0,_.nanoid)(),...s};(0,g.assertIsJsonRpcRequest)(a);const i=h.handlerEndowments[n];(0,g.assert)("string"==typeof i||null===i,"'permissionName' must be either a string or null.");const o=this.messenger.call("PermissionController:getPermissions",e);if(!(null===i||o&&(0,g.hasProperty)(o,i)))throw new Error(`Snap "${e}" is not permitted to use "${i}".`);const l=i?o[i]:undefined;if(i===h.SnapEndowments.Rpc||i===h.SnapEndowments.Keyring){(0,g.assert)(l);const n=this.messenger.call("SubjectMetadataController:getSubjectMetadata",t),s=i===h.SnapEndowments.Rpc?(0,h.getRpcCaveatOrigins)(l):(0,h.getKeyringCaveatOrigins)(l);if((0,g.assert)(s),!(0,f.isOriginAllowed)(s,(null==n?void 0:n.subjectType)??d.SubjectType.Website,t))throw new Error(`Snap "${e}" is not permitted to handle requests from "${t}".`)}if(t!==y.METAMASK_ORIGIN&&y.CLIENT_ONLY_HANDLERS.includes(n))throw new Error(`"${n}" can only be invoked by MetaMask.`);if(!r.enabled)throw new Error(`Snap "${e}" is disabled.`);if(r.status===f.SnapStatus.Installing)throw new Error(`Snap "${e}" is currently being installed. Please try again later.`);const u=c(Z,this,Le).call(this,l),p=c(Z,this,Xe).call(this,e);if(p.stopPromise&&await p.stopPromise,!this.isRunning(e)){p.startPromise||(p.startPromise=this.startSnap(e));try{await p.startPromise}finally{p.startPromise=null}}const m=c(Z,this,qe).call(this,e,n,a),S=new A.Timer(u);c(Z,this,$e).call(this,e,m.id,S);const E=this.messenger.call("ExecutionService:handleRpcRequest",e,{origin:t,handler:n,request:m});try{const s=await(0,C.withTimeout)(E,S);if(s===C.hasTimedOut){const t=null!==p.stopPromise||!this.isRunning(e);throw new Error(t?`${e} was stopped and the request was cancelled. This is likely because the Snap crashed.`:`${e} failed to respond to the request in time.`)}await c(Z,this,Ge).call(this,e,n,s);const r=await c(Z,this,xe).call(this,e,n,m,s);return c(Z,this,We).call(this,e,m.id,n,t,!0),r}catch(s){c(Z,this,We).call(this,e,m.id,n,t,!1);const[r,a]=(0,f.unwrapError)(s),i=null!==p.stopPromise||!this.isRunning(e);throw a||(i||(0,f.logError)(`"${e}" crashed due to an unhandled error:`,r),await this.stopSnap(e,f.SnapStatusEvents.Crash)),r}}setClientActive(e){e?c(Z,this,at).call(this,y.METAMASK_ORIGIN,f.HandlerType.OnActive):c(Z,this,at).call(this,y.METAMASK_ORIGIN,f.HandlerType.OnInactive)}}function ne(){const e=({snapId:e})=>this.getExpect(e).enabled,t={initial:f.SnapStatus.Installing,states:{[f.SnapStatus.Installing]:{on:{[f.SnapStatusEvents.Start]:{target:f.SnapStatus.Running,cond:e}}},[f.SnapStatus.Updating]:{on:{[f.SnapStatusEvents.Start]:{target:f.SnapStatus.Running,cond:e},[f.SnapStatusEvents.Stop]:f.SnapStatus.Stopped}},[f.SnapStatus.Running]:{on:{[f.SnapStatusEvents.Stop]:f.SnapStatus.Stopped,[f.SnapStatusEvents.Crash]:f.SnapStatus.Crashed}},[f.SnapStatus.Stopped]:{on:{[f.SnapStatusEvents.Start]:{target:f.SnapStatus.Running,cond:e},[f.SnapStatusEvents.Update]:f.SnapStatus.Updating}},[f.SnapStatus.Crashed]:{on:{[f.SnapStatusEvents.Start]:{target:f.SnapStatus.Running,cond:e},[f.SnapStatusEvents.Update]:f.SnapStatus.Updating}}}};o(K,this,(0,S.createMachine)(t)),(0,v.validateMachine)(i(K,this))}function se(){this.messenger.registerActionHandler(`${n.controllerName}:init`,(...e)=>this.init(...e)),this.messenger.registerActionHandler(`${n.controllerName}:clearSnapState`,(...e)=>this.clearSnapState(...e)),this.messenger.registerActionHandler(`${n.controllerName}:get`,(...e)=>this.get(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getSnapState`,async(...e)=>this.getSnapState(...e)),this.messenger.registerActionHandler(`${n.controllerName}:handleRequest`,async(...e)=>this.handleRequest(...e)),this.messenger.registerActionHandler(`${n.controllerName}:has`,(...e)=>this.has(...e)),this.messenger.registerActionHandler(`${n.controllerName}:updateRegistry`,async()=>this.updateRegistry()),this.messenger.registerActionHandler(`${n.controllerName}:updateSnapState`,async(...e)=>this.updateSnapState(...e)),this.messenger.registerActionHandler(`${n.controllerName}:enable`,(...e)=>this.enableSnap(...e)),this.messenger.registerActionHandler(`${n.controllerName}:disable`,async(...e)=>this.disableSnap(...e)),this.messenger.registerActionHandler(`${n.controllerName}:remove`,async(...e)=>this.removeSnap(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getPermitted`,(...e)=>this.getPermittedSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:install`,async(...e)=>this.installSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getAll`,(...e)=>this.getAllSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getRunnableSnaps`,(...e)=>this.getRunnableSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:incrementActiveReferences`,(...e)=>this.incrementActiveReferences(...e)),this.messenger.registerActionHandler(`${n.controllerName}:decrementActiveReferences`,(...e)=>this.decrementActiveReferences(...e)),this.messenger.registerActionHandler(`${n.controllerName}:disconnectOrigin`,(...e)=>this.removeSnapFromSubject(...e)),this.messenger.registerActionHandler(`${n.controllerName}:revokeDynamicPermissions`,(...e)=>this.revokeDynamicSnapPermissions(...e)),this.messenger.registerActionHandler(`${n.controllerName}:getFile`,async(...e)=>this.getSnapFile(...e)),this.messenger.registerActionHandler(`${n.controllerName}:stopAllSnaps`,async(...e)=>this.stopAllSnaps(...e)),this.messenger.registerActionHandler(`${n.controllerName}:isMinimumPlatformVersion`,(...e)=>this.isMinimumPlatformVersion(...e)),this.messenger.registerActionHandler(`${n.controllerName}:setClientActive`,(...e)=>this.setClientActive(...e))}function re(e){for(const{snapId:n,manifest:s,files:r,removable:a,hidden:i,hideSnapBranding:o}of e){var t;const e=this.get(n),l=e!==undefined,u=l&&(0,g.gtVersion)(s.version,e.version);if(l&&(!u||!0!==e.preinstalled))continue;const d=new f.VirtualFile({path:f.NpmSnapFileNames.Manifest,value:JSON.stringify(s),result:s}),p=r.map(({path:e,value:t})=>new f.VirtualFile({value:t,path:e})),{filePath:m,iconPath:S}=s.source.location.npm,E=p.find(e=>e.path===m),_=S?p.find(e=>e.path===S):undefined;(0,g.assert)(E,"Source code not provided for preinstalled snap."),(0,g.assert)(!S||S&&_,"Icon not provided for preinstalled snap."),(0,g.assert)(s.source.files===undefined,"Auxiliary files are not currently supported for preinstalled snaps.");const T=(null===(t=s.source.locales)||void 0===t?void 0:t.map(e=>p.find(t=>t.path===e)))??[],w=(0,f.getValidatedLocalizationFiles)(T.filter(Boolean));(0,g.assert)(T.length===w.length,"Missing localization files for preinstalled snap.");const b={manifest:d,sourceCode:E,svgIcon:_,auxiliaryFiles:[],localizationFiles:w};c(Z,this,Pe).call(this,{id:n,origin:y.METAMASK_ORIGIN,files:b,removable:a,hidden:i,hideSnapBranding:o,preinstalled:!0});const I=(0,h.processSnapPermissions)(s.initialPermissions);c(Z,this,Me).call(this,I);const{newPermissions:A,unusedPermissions:v}=c(Z,this,et).call(this,n,I);c(Z,this,st).call(this,{snapId:n,newPermissions:A,unusedPermissions:v}),s.initialConnections&&c(Z,this,_e).call(this,n,(null==e?void 0:e.initialConnections)??null,s.initialConnections),this.update(e=>{e.snaps[n].status=f.SnapStatus.Stopped}),c(Z,this,Je).call(this,n),u?this.messenger.publish("SnapController:snapUpdated",this.getTruncatedExpect(n),e.version,y.METAMASK_ORIGIN,!0):this.messenger.publish("SnapController:snapInstalled",this.getTruncatedExpect(n),y.METAMASK_ORIGIN,!0)}for(const t of Object.values(this.state.snaps).filter(({preinstalled:e})=>e)){const r=(0,h.processSnapPermissions)(t.manifest.initialPermissions);c(Z,this,Me).call(this,r);const{newPermissions:a,unusedPermissions:i}=c(Z,this,et).call(this,t.id,r);if((0,g.isNonEmptyArray)(Object.keys(a))||(0,g.isNonEmptyArray)(Object.keys(i))){var n,s;const{proposedName:r}=(0,f.getLocalizedSnapManifest)(t.manifest,"en",t.localizationFiles??[]),o=e.find(e=>e.snapId===t.id),{iconPath:l}=t.manifest.source.location.npm,u=l&&o?o.files.find(e=>e.path===l):undefined;this.messenger.call("SubjectMetadataController:addSubjectMetadata",{subjectType:d.SubjectType.Snap,name:r,origin:t.id,version:t.version,svgIcon:u?new f.VirtualFile(u).toString():null}),c(Z,this,st).call(this,{snapId:t.id,newPermissions:a,unusedPermissions:i}),(0,f.logWarning)(`The permissions for "${t.id}" were out of sync and have been automatically restored. If you see this message, please file a bug report.`),null===(n=(s=this.messenger).captureException)||void 0===n||n.call(s,new Error(`The permissions for "${t.id}" were out of sync and have been automatically restored. This could indicate persistence issues.`))}}}function ae(){o(Y,this,setTimeout(()=>{c(Z,this,de).call(this).catch(e=>{(0,f.logError)(e)}),c(Z,this,ae).call(this)},i(x,this)))}async function ie(e,t){if(this.has(e)){try{this.update(n=>{n.snaps[e].blocked=!0,n.snaps[e].blockInformation=t}),await this.disableSnap(e)}catch(t){(0,f.logError)(`Encountered error when stopping blocked snap "${e}".`,t)}this.messenger.publish(`${n.controllerName}:snapBlocked`,e,t)}}function oe(e){this.has(e)&&this.state.snaps[e].blocked&&(this.update(t=>{t.snaps[e].blocked=!1,delete t.snaps[e].blockInformation}),this.messenger.publish(`${n.controllerName}:snapUnblocked`,e))}async function ce(e,{platformVersion:t,...n}){const s=(await this.messenger.call("SnapsRegistry:get",{[e]:n}))[e];var r;if(s.status===b.SnapsRegistryStatus.Blocked)throw new Error(`Cannot install version "${n.version}" of snap "${e}": The version is blocked. ${(null===(r=s.reason)||void 0===r?void 0:r.explanation)??""}`);const a=Object.keys(n.permissions).some(e=>!y.ALLOWED_PERMISSIONS.includes(e));if(i(j,this).requireAllowlist&&a&&s.status!==b.SnapsRegistryStatus.Verified)throw new Error(`Cannot install version "${n.version}" of snap "${e}": ${s.status===b.SnapsRegistryStatus.Unavailable?"The registry is temporarily unavailable.":"The snap is not on the allowlist."}`);c(Z,this,Oe).call(this,e,t)}function le(){(0,g.assert)(!0!==i(j,this).disableSnapInstallation,"Installing Snaps is currently disabled in this version of MetaMask.")}async function ue(){await i(J,this).call(this);const e=!0!==i(q,this).call(this).disableSnaps;this.state.isReady!==e&&this.update(t=>{t.isReady=e}),(0,g.assert)(e,"The Snaps platform requires basic functionality to be used. Enable basic functionality in the settings to use the Snaps platform.")}async function de(){const e=[...i(W,this).entries()];return Promise.all(e.filter(([e,t])=>0===t.activeReferences&&0===t.pendingInboundRequests.length&&t.lastRequest&&i(F,this)&&(0,g.timeSince)(t.lastRequest)>i(F,this)).map(async([e])=>this.stopSnap(e,f.SnapStatusEvents.Stop)))}function pe(e,t){const{interpreter:n}=c(Z,this,Xe).call(this,e);n.send(t),this.update(t=>{t.snaps[e].status=n.state.value})}async function he(e){await this.messenger.call("ExecutionService:terminateSnap",e),await new Promise(e=>setTimeout(e,1));c(Z,this,Xe).call(this,e).pendingInboundRequests.filter(e=>"finished"!==e.timer.status).forEach(e=>e.timer.finish()),await new Promise(e=>setTimeout(e,1)),this.messenger.publish("SnapController:snapTerminated",this.getTruncatedExpect(e))}function me(e,t=c(Z,this,Xe).call(this,e)){return null!==t.encryptionKey&&null!==t.encryptionSalt}async function fe({snapId:e,salt:t,useCache:n,keyMetadata:s}){const r=c(Z,this,Xe).call(this,e);if(c(Z,this,me).call(this,e,r)&&n)return{key:await i(U,this).importKey(r.encryptionKey),salt:r.encryptionSalt};const a=t??i(U,this).generateSalt(),o=await i(H,this).call(this),l=await(0,h.getEncryptionEntropy)({snapId:e,seed:o,cryptographicFunctions:i(G,this)}),u=await i(U,this).keyFromPassword(l,a,!0,s),d=await i(U,this).exportKey(u);return n&&(r.encryptionKey=d,r.encryptionSalt=a),{key:u,salt:a}}async function ge(e,t){try{const n=JSON.parse(t),{salt:s,keyMetadata:r}=n,a=c(Z,this,me).call(this,e)||i(U,this).isVaultUpdated(t),{key:o}=await c(Z,this,fe).call(this,{snapId:e,salt:s,useCache:a,keyMetadata:r??y.LEGACY_ENCRYPTION_KEY_DERIVATION_OPTIONS});return await i(U,this).decryptWithKey(o,n)}catch{throw p.rpcErrors.internal({message:"Failed to decrypt snap state, the state must be corrupted."})}}async function Se(e,t){const{key:n,salt:s}=await c(Z,this,fe).call(this,{snapId:e,useCache:!0}),r=await i(U,this).encryptWithKey(n,t);return r.salt=s,JSON.stringify(r)}async function Ee(e,t,n){return null===t?null:n?await c(Z,this,Se).call(this,e,t):JSON.stringify(t)}function _e(e,t,n){if(t){const s=(0,C.setDiff)(t,n);for(const t of Object.keys(s))this.removeSnapFromSubject(t,e)}for(const t of Object.keys(n))c(Z,this,Te).call(this,t,e)}function Te(e,t){var n,s;const r=this.messenger.call("PermissionController:getPermissions",e),a=null==r||null===(n=r[h.WALLET_SNAP_PERMISSION_KEY])||void 0===n||null===(n=n.caveats)||void 0===n?void 0:n.find(e=>e.type===f.SnapCaveatType.SnapIds);if(Boolean(null==a||null===(s=a.value)||void 0===s?void 0:s[t]))return;if(a)return void this.messenger.call("PermissionController:updateCaveat",e,h.WALLET_SNAP_PERMISSION_KEY,f.SnapCaveatType.SnapIds,{...a.value,[t]:{}});const i={[h.WALLET_SNAP_PERMISSION_KEY]:{caveats:[{type:f.SnapCaveatType.SnapIds,value:{[t]:{}}}]}};this.messenger.call("PermissionController:grantPermissions",{approvedPermissions:i,subject:{origin:e}})}function ye(e){const t=this.messenger.call("PermissionController:getSubjectNames");for(const n of t)this.removeSnapFromSubject(n,e)}function we(e){this.messenger.call("PermissionController:hasPermissions",e)&&this.messenger.call("PermissionController:revokeAllPermissions",e)}async function be(e,t,s,r){const a=this.getTruncated(t);if(a&&!s.shouldAlwaysReload)return(0,g.satisfiesVersionRange)(a.version,r)?a:await c(Z,this,ve).call(this,{origin:e,snapId:t,location:s,versionRange:r});c(Z,this,le).call(this);let i=c(Z,this,Ie).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_INSTALL});this.messenger.publish("SnapController:snapInstallStarted",t,e,!1),a&&this.isRunning(t)&&await this.stopSnap(t,f.SnapStatusEvents.Stop),a&&s.shouldAlwaysReload&&c(Z,this,we).call(this,t);try{const{sourceCode:a}=await c(Z,this,Ce).call(this,{origin:e,id:t,location:s,versionRange:r});await c(Z,this,De).call(this,t,i),i=c(Z,this,Ie).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_RESULT}),await c(Z,this,Ne).call(this,{snapId:t,sourceCode:a});const o=this.getTruncatedExpect(t);return c(Z,this,Ae).call(this,i.id,{loading:!1,type:n.SNAP_APPROVAL_INSTALL}),o}catch(s){(0,f.logError)(`Error when adding ${t}.`,s);const r=s instanceof Error?s.message:s.toString();throw c(Z,this,Ae).call(this,i.id,{loading:!1,type:n.SNAP_APPROVAL_INSTALL,error:r}),this.messenger.publish("SnapController:snapInstallFailed",t,e,!1,r),s}}function Ie({origin:e,snapId:t,type:n}){const s=(0,_.nanoid)();return{id:s,promise:this.messenger.call("ApprovalController:addRequest",{origin:e,id:s,type:n,requestData:{metadata:{id:s,origin:t,dappOrigin:e},snapId:t},requestState:{loading:!0}},!0)}}function Ae(e,t){try{this.messenger.call("ApprovalController:updateRequestState",{id:e,requestState:t})}catch{}}async function ve({origin:e,snapId:t,location:s,versionRange:r,automaticUpdate:a=!1}){a||c(Z,this,le).call(this),await c(Z,this,ue).call(this);const i=this.getExpect(t),{preinstalled:o,removable:l,hidden:u,hideSnapBranding:d}=i;if(o&&!a)throw new Error("Preinstalled Snaps cannot be manually updated.");let m=a?null:c(Z,this,Ie).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_UPDATE});try{this.messenger.publish("SnapController:snapInstallStarted",t,e,!0);const S=i.manifest,E=await(0,C.fetchSnap)(t,s),{sourceCode:_,manifest:T}=E,y=T.result,w=y.version;if(!(0,g.gtVersion)(w,i.version))throw p.rpcErrors.invalidParams(`Snap "${t}@${i.version}" is already installed. Couldn't update to a version inside requested "${r}" range.`);if(!(0,g.satisfiesVersionRange)(w,r))throw new Error(`Version mismatch. Manifest for "${t}" specifies version "${w}" which doesn't satisfy requested version range "${r}".`);await c(Z,this,ce).call(this,t,{version:w,checksum:y.source.shasum,permissions:y.initialPermissions,platformVersion:y.platformVersion});const b=(0,h.processSnapPermissions)(y.initialPermissions);c(Z,this,Me).call(this,b);const{newPermissions:I,unusedPermissions:A,approvedPermissions:v}=c(Z,this,et).call(this,t,b),{newConnections:k,unusedConnections:N,approvedConnections:R}=c(Z,this,nt).call(this,t,S.initialConnections??{},y.initialConnections??{});let P,M;if(m){c(Z,this,Ae).call(this,m.id,{permissions:I,newVersion:y.version,newPermissions:I,approvedPermissions:v,unusedPermissions:A,newConnections:k,unusedConnections:N,approvedConnections:R,loading:!1});const{permissions:s,...r}=await m.promise;P=s,M=r,m=c(Z,this,Ie).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_RESULT})}else(0,g.assert)(a),P=I;this.isRunning(t)&&await this.stopSnap(t,f.SnapStatusEvents.Stop),c(Z,this,pe).call(this,t,f.SnapStatusEvents.Update),c(Z,this,Pe).call(this,{origin:e,id:t,files:E,removable:l,preinstalled:o,hidden:u,hideSnapBranding:d,isUpdate:!0}),c(Z,this,st).call(this,{snapId:t,unusedPermissions:A,newPermissions:P,requestData:M});const O=S.initialConnections??null,D=y.initialConnections??{};c(Z,this,_e).call(this,t,O,D);const L=c(Z,this,Ve).call(this,t);L!==undefined&&(L.permissions.revoked=A,L.permissions.granted=P,L.permissions.requestData=M,L.previousInitialConnections=O,L.newInitialConnections=D);const j=_.toString();(0,g.assert)("string"==typeof j&&j.length>0,`Invalid source code for snap "${t}".`);try{await c(Z,this,Ne).call(this,{snapId:t,sourceCode:j})}catch{throw new Error(`Snap ${t} crashed with updated source code.`)}const B=this.getTruncatedExpect(t);return m&&c(Z,this,Ae).call(this,m.id,{loading:!1,type:n.SNAP_APPROVAL_UPDATE}),B}catch(s){(0,f.logError)(`Error when updating ${t},`,s);const r=s instanceof Error?s.message:s.toString();throw m&&c(Z,this,Ae).call(this,m.id,{loading:!1,error:r,type:n.SNAP_APPROVAL_UPDATE}),this.messenger.publish("SnapController:snapInstallFailed",t,e,!0,r),s}}async function ke(e,t){return await this.messenger.call("SnapsRegistry:resolveVersion",e,t)}async function Ce(e){const{id:t,location:n,versionRange:s}=e;c(Z,this,Je).call(this,t);const r=c(Z,this,Xe).call(this,t);r.installPromise||((0,k.log)(`Adding snap: ${t}`),r.installPromise=(async()=>{const r=await(0,C.fetchSnap)(t,n),a=r.manifest.result;if(!(0,g.satisfiesVersionRange)(a.version,s))throw new Error(`Version mismatch. Manifest for "${t}" specifies version "${a.version}" which doesn't satisfy requested version range "${s}".`);await c(Z,this,ce).call(this,t,{version:a.version,checksum:a.source.shasum,permissions:a.initialPermissions,platformVersion:a.platformVersion});const o=i(j,this).forcePreinstalledSnaps&&(0,C.isLocalSnapId)(t)?{preinstalled:!0,hideSnapBranding:!0,hidden:!1}:{};return c(Z,this,Pe).call(this,{...e,files:r,id:t,...o})})());try{return await r.installPromise}catch(e){throw r.installPromise=null,e}}async function Ne(e){const{snapId:t}=e;if(this.isRunning(t))throw new Error(`Snap "${t}" is already started.`);try{const n=c(Z,this,Xe).call(this,t),s=await this.messenger.call("ExecutionService:executeSnap",{...e,endowments:await c(Z,this,Re).call(this,t)});return c(Z,this,pe).call(this,t,f.SnapStatusEvents.Start),n.lastRequest=Date.now(),s}catch(e){throw await c(Z,this,he).call(this,t),e}}async function Re(e){let t=[];for(const n of i(D,this))if(this.messenger.call("PermissionController:hasPermission",e,n)){const s=await this.messenger.call("PermissionController:getEndowments",e,n);if(s){if(!Array.isArray(s)||s.some(e=>"string"!=typeof e))throw new Error("Expected an array of string endowment names.");t=t.concat(s)}}const n=[...new Set([...f.DEFAULT_ENDOWMENTS,...t])];return n.length<f.DEFAULT_ENDOWMENTS.length+t.length&&(0,f.logError)(`Duplicate endowments found for ${e}. Default endowments should not be requested.`,t),n}function Pe(e){const{id:t,origin:n,files:s,isUpdate:r=!1,removable:a,preinstalled:o,hidden:l,hideSnapBranding:u}=e,{manifest:p,sourceCode:h,svgIcon:m,auxiliaryFiles:S,localizationFiles:E}=s;(0,f.assertIsSnapManifest)(p.result);const{version:_}=p.result,T=h.toString();(0,g.assert)("string"==typeof T&&T.length>0,`Invalid source code for snap "${t}".`);const y=S.map(e=>((0,g.assert)("string"==typeof e.data.base64),{path:e.path,value:e.data.base64})),w=this.state.snaps[t],b=[...(null==w?void 0:w.versionHistory)??[],{version:_,date:Date.now(),origin:n}],I=E.map(e=>e.result),A={...w,blocked:!1,enabled:!0,removable:a,preinstalled:o,hidden:l,hideSnapBranding:u,id:t,initialConnections:p.result.initialConnections,initialPermissions:p.result.initialPermissions,manifest:p.result,status:i(K,this).config.initial,sourceCode:T,version:_,versionHistory:b,auxiliaryFiles:y,localizationFiles:I};delete A.blockInformation;const{inversePatches:v}=this.update(e=>{e.snaps[t]=A});if(r){const e=c(Z,this,Ve).call(this,t);e!==undefined&&(e.statePatches=v)}const{proposedName:k}=(0,f.getLocalizedSnapManifest)(p.result,"en",I);return this.messenger.call("SubjectMetadataController:addSubjectMetadata",{subjectType:d.SubjectType.Snap,name:k,origin:A.id,version:_,svgIcon:(null==m?void 0:m.toString())??null}),{...A,sourceCode:T}}function Me(e){const t=Object.keys(e),n=Array.from(new Set(Object.values(h.handlerEndowments)));(0,g.assert)(t.some(e=>n.includes(e)),`A snap must request at least one of the following permissions: ${n.filter(e=>null!==e).join(", ")}.`);const s=t.reduce((e,t)=>((0,g.hasProperty)(i(L,this),t)&&e.push(i(L,this)[t]),e),[]);(0,g.assert)(0===s.length,`One or more permissions are not allowed:\n${s.join("\n")}`)}function Oe(e,t){if(t!==undefined&&(0,T.gt)(t,(0,f.getPlatformVersion)())){const n=`The Snap "${e}" requires platform version "${t}" which is greater than the current platform version "${(0,f.getPlatformVersion)()}".`;if(i(j,this).rejectInvalidPlatformVersion)throw new Error(n);(0,f.logWarning)(n)}}async function De(e,t){(0,k.log)(`Authorizing snap: ${e}`);const n=this.state.snaps[e],{initialPermissions:s,initialConnections:r}=n;try{const a=(0,h.processSnapPermissions)(s);c(Z,this,Me).call(this,a),c(Z,this,Ae).call(this,t.id,{loading:!1,connections:r??{},permissions:a});const{permissions:i,...o}=await t.promise;c(Z,this,st).call(this,{snapId:e,newPermissions:i,requestData:o}),n.manifest.initialConnections&&c(Z,this,_e).call(this,e,null,n.manifest.initialConnections)}finally{c(Z,this,Xe).call(this,e).installPromise=null}}function Le(e){return(0,h.getMaxRequestTimeCaveat)(e)??this.maxRequestTime}async function je(e,t,n){return this.messenger.call("SnapInterfaceController:createInterface",e,t,undefined,n)}function Be(e,t){(0,g.assert)(this.messenger.call("SnapInterfaceController:getInterface",e,t))}async function xe(e,t,n,s){switch(t){case f.HandlerType.OnTransaction:case f.HandlerType.OnSignature:case f.HandlerType.OnHomePage:case f.HandlerType.OnSettingsPage:{const t=s;if(t&&(0,g.hasProperty)(t,"content")){const{content:n,...s}=t;return{...s,id:await c(Z,this,je).call(this,e,n)}}return s}case f.HandlerType.OnAssetsLookup:return c(Z,this,Fe).call(this,e,n,s);case f.HandlerType.OnAssetsConversion:return c(Z,this,Ue).call(this,n,s);case f.HandlerType.OnAssetsMarketData:return c(Z,this,He).call(this,n,s);default:return s}}function Fe(e,{params:t},{assets:n}){const s=this.messenger.call("PermissionController:getPermissions",e);(0,g.assert)(s);const r=s[h.SnapEndowments.Assets],a=(0,h.getChainIdsCaveat)(r);(0,g.assert)(a);const{assets:i}=t;return{assets:Object.keys(n).reduce((e,t)=>{const s=t;return a.some(e=>s.startsWith(e))&&i.includes(s)&&(e[s]=n[s]),e},{})}}function Ue({params:e},{conversionRates:t}){const{conversions:n}=e;return{conversionRates:n.reduce((e,n)=>{var s;const r=null===(s=t[n.from])||void 0===s?void 0:s[n.to];var a;r&&(e[a=n.from]??(e[a]={}),e[n.from][n.to]=r);return e},{})}}function He({params:e},{marketData:t}){const{assets:n}=e;return{marketData:n.reduce((e,n)=>{var s;const r=null===(s=t[n.asset])||void 0===s?void 0:s[n.unit];var a;r&&(e[a=n.asset]??(e[a]={}),e[n.asset][n.unit]=r);return e},{})}}function qe(e,t,n){if(t===f.HandlerType.OnUserInput){(0,g.assert)(n.params&&(0,g.hasProperty)(n.params,"id"));const t=n.params.id,{context:s}=this.messenger.call("SnapInterfaceController:getInterface",e,t);return{...n,params:{...n.params,context:s}}}return n}async function Ge(e,t,n){switch(t){case f.HandlerType.OnTransaction:(0,g.assertStruct)(n,f.OnTransactionResponseStruct),n&&(0,g.hasProperty)(n,"id")&&c(Z,this,Be).call(this,e,n.id);break;case f.HandlerType.OnSignature:(0,g.assertStruct)(n,f.OnSignatureResponseStruct),n&&(0,g.hasProperty)(n,"id")&&c(Z,this,Be).call(this,e,n.id);break;case f.HandlerType.OnHomePage:(0,g.assertStruct)(n,f.OnHomePageResponseStruct),n&&(0,g.hasProperty)(n,"id")&&c(Z,this,Be).call(this,e,n.id);break;case f.HandlerType.OnSettingsPage:(0,g.assertStruct)(n,f.OnSettingsPageResponseStruct),n&&(0,g.hasProperty)(n,"id")&&c(Z,this,Be).call(this,e,n.id);break;case f.HandlerType.OnNameLookup:(0,g.assertStruct)(n,f.OnNameLookupResponseStruct);break;case f.HandlerType.OnAssetsLookup:(0,g.assertStruct)(n,m.OnAssetsLookupResponseStruct);break;case f.HandlerType.OnAssetsConversion:(0,g.assertStruct)(n,f.OnAssetsConversionResponseStruct);break;case f.HandlerType.OnAssetHistoricalPrice:(0,g.assertStruct)(n,f.OnAssetHistoricalPriceResponseStruct);break;case f.HandlerType.OnAssetsMarketData:(0,g.assertStruct)(n,f.OnAssetsMarketDataResponseStruct)}}function $e(e,t,n){const s=c(Z,this,Xe).call(this,e);s.pendingInboundRequests.push({requestId:t,timer:n}),s.lastRequest=null}function We(e,t,n,s,r){const a=c(Z,this,Xe).call(this,e);a.pendingInboundRequests=a.pendingInboundRequests.filter(e=>e.requestId!==t),0===a.pendingInboundRequests.length&&(a.lastRequest=Date.now());const o=this.get(e);if((0,C.isTrackableHandler)(n)&&(null==o||!o.preinstalled))try{i(X,this).call(this,e,n,r,s)}catch(e){(0,f.logError)(`Error when calling MetaMetrics hook for snap "${null==o?void 0:o.id}": ${(0,m.getErrorMessage)(e)}`)}}function Ve(e){return i(V,this).get(e)}function Ye(e){(0,g.assert)(i(V,this).get(e)===undefined,`Snap "${e}" rollback snapshot already exists.`),i(V,this).set(e,{statePatches:[],permissions:{},newVersion:""});const t=i(V,this).get(e);return(0,g.assert)(t!==undefined,`Snapshot creation failed for ${e}.`),t}async function Ke(e){var t,n;const s=c(Z,this,Ve).call(this,e);if(!s)throw new Error("A snapshot does not exist for this snap.");await this.stopSnap(e,f.SnapStatusEvents.Stop),(null===(t=this.get(e))||void 0===t?void 0:t.status)!==f.SnapStatus.Stopped&&c(Z,this,pe).call(this,e,f.SnapStatusEvents.Stop);const{statePatches:r,permissions:a,previousInitialConnections:o,newInitialConnections:l}=s;null!=r&&r.length&&this.applyPatches(r),(null===(n=this.get(e))||void 0===n?void 0:n.status)!==f.SnapStatus.Stopped&&this.update(t=>{t.snaps[e].status=f.SnapStatus.Stopped}),c(Z,this,st).call(this,{snapId:e,unusedPermissions:a.granted,newPermissions:a.revoked,requestData:a.requestData}),c(Z,this,_e).call(this,e,l??null,o??{});const u=this.getTruncatedExpect(e);this.messenger.publish("SnapController:snapRolledback",u,s.newVersion),i(V,this).delete(e)}async function Qe(e){for(const t of e)await c(Z,this,Ke).call(this,t)}function ze(e){return i(W,this).get(e)}function Xe(e){const t=c(Z,this,ze).call(this,e);return(0,g.assert)(t!==undefined,`Snap "${e}" runtime data not found`),t}function Je(e){if(i(W,this).has(e))return;const t=this.get(e),n=(0,S.interpret)(i(K,this));n.start({context:{snapId:e},value:(null==t?void 0:t.status)??i(K,this).config.initial}),(0,v.forceStrict)(n),i(W,this).set(e,{lastRequest:null,startPromise:null,stopPromise:null,installPromise:null,encryptionKey:null,encryptionSalt:null,activeReferences:0,pendingInboundRequests:[],pendingOutboundRequests:0,interpreter:n,stateMutex:new E.Mutex,getStateMutex:new E.Mutex})}function Ze(e,t){return Object.keys(e).reduce((n,s)=>{if(i(O,this).includes(s)){var r;const a=(0,g.hasProperty)(y.DYNAMIC_PERMISSION_DEPENDENCIES,s),i=null===(r=y.DYNAMIC_PERMISSION_DEPENDENCIES[s])||void 0===r?void 0:r.some(e=>(0,g.hasProperty)(t,e));a&&!i||(n[s]=e[s])}return n},t)}function et(e,t){const n=this.messenger.call("PermissionController:getPermissions",e)??{},s=c(Z,this,Ze).call(this,n,t),r=(0,C.permissionsDiff)(s,n),a=(0,C.permissionsDiff)(n,s);return{newPermissions:r,unusedPermissions:a,approvedPermissions:(0,C.permissionsDiff)(n,a)}}function tt(e,t){var n,s;const r=this.messenger.call("PermissionController:getPermissions",t),a=null==r||null===(n=r[h.WALLET_SNAP_PERMISSION_KEY])||void 0===n||null===(n=n.caveats)||void 0===n?void 0:n.find(e=>e.type===f.SnapCaveatType.SnapIds);return Boolean(null==a||null===(s=a.value)||void 0===s?void 0:s[e])}function nt(e,t,n){const s=Object.keys(t).filter(t=>c(Z,this,tt).call(this,e,t)).reduce((e,n)=>(e[n]=t[n],e),{}),r=(0,C.setDiff)(n,s),a=(0,C.setDiff)(s,n);return{newConnections:r,unusedConnections:a,approvedConnections:(0,C.setDiff)(s,a)}}function st({snapId:e,unusedPermissions:t={},newPermissions:n={},requestData:s}){const r=Object.keys(t);(0,g.isNonEmptyArray)(r)&&this.messenger.call("PermissionController:revokePermissions",{[e]:r}),(0,g.isNonEmptyArray)(Object.keys(n))&&this.messenger.call("PermissionController:grantPermissions",{approvedPermissions:n,subject:{origin:e},requestData:s})}function rt(e,t){const n=this.getExpect(e);return!(0,g.satisfiesVersionRange)(n.version,t)&&!(0,g.gtRange)(n.version,t)}function at(e,t){const n=this.getRunnableSnaps();for(const{id:s}of n){this.messenger.call("PermissionController:hasPermission",s,h.SnapEndowments.LifecycleHooks)&&c(Z,this,it).call(this,e,s,t).catch(e=>{(0,f.logError)(`Error calling lifecycle hook "${t}" for Snap "${s}": ${(0,m.getErrorMessage)(e)}`)})}}async function it(e,t,n){const s=h.handlerEndowments[n];(0,g.assert)(s,"Lifecycle hook must have an endowment.");this.messenger.call("PermissionController:hasPermission",t,s)&&await this.handleRequest({snapId:t,handler:n,origin:e,request:{jsonrpc:"2.0",method:n}})}function ot(){for(const e of i(W,this).values())e.encryptionKey=null,e.encryptionSalt=null,e.state=undefined}n.SnapController=te}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/SnapController.cjs"}],[2674,{"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.Timer=void 0;const r=e("@metamask/utils");n.Timer=class{constructor(e){s(this,"state",void 0),(0,r.assert)(!Number.isNaN(e),new TypeError("Can't start a timer with NaN time")),(0,r.assert)(e>=0,new TypeError("Can't start a timer with negative time")),this.state={value:"stopped",remaining:e}}get status(){return this.state.value}get remaining(){return this.state.remaining}cancel(){(0,r.assert)("paused"===this.status||"running"===this.status,"Tried to cancel a not running Timer"),this.onFinish(!1)}finish(){(0,r.assert)("finished"!==this.status,"Tried to finish a finished Timer."),this.onFinish(!0)}pause(){(0,r.assert)("running"===this.state.value,"Tried to pause a not running Timer");const{callback:e,start:t,timeout:n,remaining:s}=this.state;n!==undefined&&clearTimeout(n),this.state={value:"paused",callback:e,remaining:s-(Date.now()-t)}}start(e){(0,r.assert)("stopped"===this.state.value,"Tried to start an already running Timer");const{remaining:t}=this.state;this.state={value:"paused",remaining:t,callback:e},this.resume()}resume(){(0,r.assert)("paused"===this.state.value,"Tried to resume not paused Timer");const{remaining:e,callback:t}=this.state,n=Date.now();let s;e!==Number.POSITIVE_INFINITY&&(s=setTimeout(()=>this.onFinish(!0),e)),this.state={value:"running",callback:t,remaining:e,start:n,timeout:s}}onFinish(e){(0,r.assert)("running"===this.state.value||"paused"===this.state.value),"running"===this.state.value&&this.state.timeout!==undefined&&clearTimeout(this.state.timeout);const{callback:t,remaining:n}=this.state;this.state={value:"finished",remaining:"running"===this.state.value?n-(Date.now()-this.state.start):n},e&&t()}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/Timer.cjs"}],[2675,{"@metamask/snaps-rpc-methods":2730,"@metamask/snaps-utils":2903},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.DYNAMIC_PERMISSION_DEPENDENCIES=n.CLIENT_ONLY_HANDLERS=n.METAMASK_ORIGIN=n.STATE_DEBOUNCE_TIMEOUT=n.LEGACY_ENCRYPTION_KEY_DERIVATION_OPTIONS=n.ALLOWED_PERMISSIONS=void 0;const s=e("@metamask/snaps-rpc-methods"),r=e("@metamask/snaps-utils");n.ALLOWED_PERMISSIONS=Object.freeze(["snap_dialog","snap_manageState","snap_notify","snap_getLocale",s.SnapEndowments.Cronjob,s.SnapEndowments.HomePage,s.SnapEndowments.LifecycleHooks,s.SnapEndowments.EthereumProvider,s.SnapEndowments.TransactionInsight,s.SnapEndowments.SignatureInsight]),n.LEGACY_ENCRYPTION_KEY_DERIVATION_OPTIONS={algorithm:"PBKDF2",params:{iterations:1e4}},n.STATE_DEBOUNCE_TIMEOUT=500,n.METAMASK_ORIGIN="metamask",n.CLIENT_ONLY_HANDLERS=Object.freeze([r.HandlerType.OnClientRequest,r.HandlerType.OnSignature,r.HandlerType.OnTransaction,r.HandlerType.OnCronjob,r.HandlerType.OnNameLookup,r.HandlerType.OnHomePage,r.HandlerType.OnSettingsPage,r.HandlerType.OnUserInput,r.HandlerType.OnAssetsLookup,r.HandlerType.OnAssetsConversion,r.HandlerType.OnAssetHistoricalPrice,r.HandlerType.OnAssetsMarketData,r.HandlerType.OnWebSocketEvent]),n.DYNAMIC_PERMISSION_DEPENDENCIES=Object.freeze({"endowment:caip25":["endowment:ethereum-provider"]})}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/constants.cjs"}],[2676,{"./SnapController.cjs":2673,"./constants.cjs":2675,"./location/index.cjs":2678,"./registry/index.cjs":2682,"./selectors.cjs":2685},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./constants.cjs"),n),r(e("./location/index.cjs"),n),r(e("./SnapController.cjs"),n),r(e("./selectors.cjs"),n),r(e("./registry/index.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/index.cjs"}],[2677,{"@metamask/snaps-utils":2903,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.HttpLocation=void 0;const r=e("@metamask/snaps-utils"),a=e("@metamask/utils");n.HttpLocation=class{constructor(e,t={}){s(this,"cache",new Map),s(this,"validatedManifest",void 0),s(this,"url",void 0),s(this,"fetchFn",void 0),s(this,"fetchOptions",void 0),(0,a.assertStruct)(e.toString(),r.HttpSnapIdStruct,"Invalid Snap Id: "),this.fetchFn=t.fetch??globalThis.fetch.bind(undefined),this.fetchOptions=t.fetchOptions,this.url=e}async manifest(){if(this.validatedManifest)return this.validatedManifest.clone();const e=new URL(r.NpmSnapFileNames.Manifest,this.url).toString(),t=await this.fetchFn(e,this.fetchOptions);if(!t.ok)throw new Error(`Failed to fetch "${e}". Status code: ${t.status}.`);const n=await t.text(),s=(0,r.parseJson)(n),a=new r.VirtualFile({value:n,result:(0,r.createSnapManifest)(s),path:r.NpmSnapFileNames.Manifest,data:{canonicalPath:e}});return this.validatedManifest=a,this.manifest()}async fetch(e){const t=(0,r.normalizeRelative)(e),n=this.cache.get(t);if(n!==undefined)return n.clone();const s=this.toCanonical(t).toString(),i=await this.fetchFn(s,this.fetchOptions);if(!i.ok)throw new Error(`Failed to fetch "${s}". Status code: ${i.status}.`);const o=await i.arrayBuffer(),c=new r.VirtualFile({value:new Uint8Array(o),path:t,data:{canonicalPath:s}});return(0,a.assert)(!this.cache.has(t),"Corrupted cache, multiple files with same path."),this.cache.set(t,c),this.fetch(t)}get root(){return new URL(this.url)}toCanonical(e){return(0,a.assert)(!e.startsWith("/"),"Tried to parse absolute path."),new URL(e,this.url)}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/http.cjs"}],[2678,{"./http.cjs":2677,"./local.cjs":2679,"./location.cjs":2680,"./npm.cjs":2681},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./location.cjs"),n),r(e("./npm.cjs"),n),r(e("./local.cjs"),n),r(e("./http.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/index.cjs"}],[2679,{"./http.cjs":2677,"@metamask/snaps-utils":2903,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function r(e,t){return e.get(a(e,t))}function a(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.LocalLocation=void 0;const i=e("@metamask/snaps-utils"),o=e("@metamask/utils"),c=e("./http.cjs");var l=new WeakMap;function u(e){return(0,o.assert)(e.data.canonicalPath!==undefined),e.data.canonicalPath=`local:${e.data.canonicalPath}`,e}n.LocalLocation=class{constructor(e,t={}){var n,r,u;s(this,l,void 0),(0,o.assertStruct)(e.toString(),i.LocalSnapIdStruct,"Invalid Snap Id"),(0,o.assert)(t.fetchOptions===undefined,"Currently adding fetch options to local: is unsupported."),n=l,r=this,u=new c.HttpLocation(new URL(e.toString().slice(i.SnapIdPrefixes.local.length)),{...t,fetchOptions:{cache:"no-cache"}}),n.set(a(n,r),u)}async manifest(){return u(await r(l,this).manifest())}async fetch(e){return u(await r(l,this).fetch(e))}get shouldAlwaysReload(){return!0}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/local.cjs"}],[268,{"../../../shared/constants/time":5812,loglevel:4846,"readable-stream":5276},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.THREE_MINUTES=void 0,n.default=function(){const e=c();return new r.Transform({transform(t,n,s){const r=t.id===undefined,i=e.add(t.id);r||i?s(null,t):(a.default.debug(`RPC request with id "${t.id}" already seen.`),s())},objectMode:!0})};var s,r=e("readable-stream"),a=(s=e("loglevel"))&&s.__esModule?s:{default:s},i=e("../../../shared/constants/time");const o=n.THREE_MINUTES=3*i.MINUTE,c=()=>{const e=new Map;return setInterval(()=>{const t=Date.now()-o;for(const[n,s]of e.entries()){if(!(s<=t))break;e.delete(n)}},o),{add:t=>!e.has(t)&&(e.set(t,Date.now()),!0)}}}}},{package:"$root$",file:"app/scripts/lib/createDupeReqFilterStream.ts"}],[2680,{"./http.cjs":2677,"./local.cjs":2679,"./npm.cjs":2681,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.detectSnapLocation=void 0;const s=e("@metamask/utils"),r=e("./http.cjs"),a=e("./local.cjs"),i=e("./npm.cjs");n.detectSnapLocation=function(e,t){const n=(null==t?void 0:t.allowHttp)??!1,o=(null==t?void 0:t.allowLocal)??!1,c=new URL(e);switch(c.protocol){case"npm:":return new i.NpmLocation(c,t);case"local:":return(0,s.assert)(o,new TypeError("Fetching local snaps is disabled.")),new a.LocalLocation(c,t);case"http:":case"https:":return(0,s.assert)(n,new TypeError("Fetching snaps through http/https is disabled.")),new r.HttpLocation(c,t);default:throw new TypeError(`Unrecognized "${c.protocol}" snap location protocol.`)}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/location.cjs"}],[2681,{"@metamask/snaps-utils":2903,"@metamask/utils":3116,"concat-stream":2689,"get-npm-tarball-url":4445,"readable-stream":2704,"readable-web-to-node-stream":5283,"tar-stream":5673},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t,n){return e.set(c(e,t),n),n}function o(e,t){return e.get(c(e,t))}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var l=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getNpmCanonicalBasePath=n.fetchNpmMetadata=n.NpmLocation=n.TARBALL_SIZE_SAFETY_LIMIT=n.BaseNpmLocation=n.NPM_REGISTRY_PROXY=n.DEFAULT_NPM_REGISTRY=void 0;const u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),p=l(e("concat-stream")),h=l(e("get-npm-tarball-url")),m=e("readable-stream"),f=e("readable-web-to-node-stream"),g=e("tar-stream");n.DEFAULT_NPM_REGISTRY=new URL("https://registry.npmjs.org"),n.NPM_REGISTRY_PROXY=new URL("https://npm-ota.api.cx.metamask.io");var S=new WeakMap,E=new WeakMap,_=new WeakSet;class T{constructor(e,t={}){var i,o;r(i=this,o=_),o.add(i),a(this,"meta",void 0),s(this,S,void 0),s(this,E,void 0);const c=t.allowCustomRegistries??!1,l=t.fetch??globalThis.fetch.bind(undefined),p=t.versionRange??u.DEFAULT_REQUESTED_SNAP_VERSION,h=t.resolveVersion??(async e=>e);let m;(0,d.assertStruct)(e.toString(),u.NpmSnapIdStruct,"Invalid Snap Id: "),""===e.host&&""===e.port&&""===e.username&&""===e.password?m=t.useNpmProxy?n.NPM_REGISTRY_PROXY:n.DEFAULT_NPM_REGISTRY:(m="https://",e.username&&(m+=e.username,e.password&&(m+=`:${e.password}`),m+="@"),m+=e.host,m=new URL(m),(0,d.assert)(c,new TypeError(`Custom NPM registries are disabled, tried to use "${m.toString()}".`))),(0,d.assert)("/"===m.pathname&&""===m.search&&""===m.hash),(0,d.assert)(""!==e.pathname&&"/"!==e.pathname,new TypeError("The package name in NPM location is empty."));let f=e.pathname;f.startsWith("/")&&(f=f.slice(1)),this.meta={requestedRange:p,registry:m,packageName:f,fetch:l,resolveVersion:h}}async manifest(){if(o(S,this))return o(S,this).clone();const e=await this.fetch("snap.manifest.json"),t=(0,u.parseJson)(e.toString());return e.result=(0,u.createSnapManifest)(t),i(S,this,e),this.manifest()}async fetch(e){const t=(0,u.normalizeRelative)(e);o(E,this)||(await c(_,this,y).call(this),(0,d.assert)(o(E,this)!==undefined));const n=o(E,this).get(t);return(0,d.assert)(n!==undefined,new TypeError(`File "${e}" not found in package.`)),n.clone()}get packageName(){return this.meta.packageName}get version(){return(0,d.assert)(this.meta.version!==undefined,"Tried to access version without first fetching NPM package."),this.meta.version}get registry(){return this.meta.registry}get versionRange(){return this.meta.requestedRange}}async function y(){(0,d.assert)(o(E,this)===undefined);const e=await this.meta.resolveVersion(this.meta.requestedRange),{tarballURL:t,targetVersion:n}=await async function(e,t,n,s){var r;if(I(n)&&(0,d.isValidSemVerVersion)(t))return{tarballURL:(0,h.default)(e,t),targetVersion:t};const a=await w(e,n,s),i=Object.keys((null==a?void 0:a.versions)??{}).map(e=>((0,d.assertIsSemVerVersion)(e),e)),o=(0,u.getTargetVersion)(i,t);if(null===o)throw new Error(`Failed to find a matching version in npm metadata for package "${e}" and requested semver range "${t}".`);const c=null==a||null===(r=a.versions)||void 0===r||null===(r=r[o])||void 0===r||null===(r=r.dist)||void 0===r?void 0:r.tarball;return{tarballURL:c,targetVersion:o}}(this.meta.packageName,e,this.meta.registry,this.meta.fetch);if(!(0,u.isValidUrl)(t)||!t.toString().endsWith(".tgz"))throw new Error(`Failed to find valid tarball URL in NPM metadata for package "${this.meta.packageName}".`);const s=new URL(t);s.hostname=this.meta.registry.hostname,s.protocol=this.meta.registry.protocol;const r=await this.fetchNpmTarball(s);i(E,this,r),this.meta.version=n}n.BaseNpmLocation=T,n.TARBALL_SIZE_SAFETY_LIMIT=262144e3;async function w(e,t,n){const s=await n(new URL(e,t).toString(),{headers:{accept:I(t)?"application/vnd.npm.install-v1+json; q=1.0, application/json; q=0.8, */*":"application/json"}});if(!s.ok)throw new Error(`Failed to fetch NPM registry entry. Status code: ${s.status}.`);const r=await s.json();if(!(0,d.isObject)(r))throw new Error(`Failed to fetch package "${e}" metadata from npm.`);return r}function b(e,t){let n="npm://";return""!==e.username&&(n+=e.username,""!==e.password&&(n+=`:${e.password}`),n+="@"),`${n}${e.host}/${t}/`}function I(e){const t=e.toString();return t===n.DEFAULT_NPM_REGISTRY.toString()||t===n.NPM_REGISTRY_PROXY.toString()}n.NpmLocation=class extends T{async fetchNpmTarball(e){const t=await this.meta.fetch(e.toString());(0,d.assert)(404!==t.status,`"${this.meta.packageName}" was not found in the NPM registry`),(0,d.assert)(t.ok&&t.body,`Failed to fetch tarball for package "${this.meta.packageName}"`);const s=t.headers.get("content-length");(0,d.assert)(s,"Snap tarball has invalid content-length");const r=parseInt(s,10);return(0,d.assert)(r<=n.TARBALL_SIZE_SAFETY_LIMIT,"Snap tarball exceeds size limit"),new Promise((e,s)=>{const r=new Map,a=function(e,t){(0,d.assert)(e.endsWith("/"),"Base needs to end with '/' for relative paths to be added as children instead of siblings."),(0,d.assert)(e.startsWith("npm:"),'Protocol mismatch, expected "npm:".');const s=(0,g.extract)();let r=0;return s.on("entry",(a,i,o)=>{const{name:c,type:l}=a;if("file"===l){const a=c.replace(A,"");return i.pipe((0,p.default)({encoding:"uint8array"},i=>{try{r+=i.byteLength,(0,d.assert)(r<n.TARBALL_SIZE_SAFETY_LIMIT,`Snap tarball exceeds limit of ${n.TARBALL_SIZE_SAFETY_LIMIT} bytes.`);const s=new u.VirtualFile({value:i,path:a,data:{canonicalPath:new URL(a,e).toString()}});return(0,d.assert)(!t.has(a),"Malformed tarball, multiple files with the same path."),t.set(a,s),o()}catch(e){return s.destroy(e)}}))}return i.on("end",()=>o()),i.resume()}),s}(b(this.meta.registry,this.meta.packageName),r),i=t.body,o=new DecompressionStream("gzip"),c=i.pipeThrough(o);(0,m.pipeline)(function(e){if("function"!=typeof e.getReader)return e;return new f.ReadableWebToNodeStream(e)}(c),a,t=>{t?s(t):e(r)})})}},n.fetchNpmMetadata=w,n.getNpmCanonicalBasePath=b;const A=/^package\//u}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/npm.cjs"}],[2682,{"./json.cjs":2683,"./registry.cjs":2684},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./registry.cjs"),n),r(e("./json.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/registry/index.cjs"}],[2683,{"./registry.cjs":2684,"@metamask/base-controller":1362,"@metamask/snaps-registry":2709,"@metamask/snaps-utils":2903,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(e,t){return e.get(o(e,t))}function i(e,t,n){return e.set(o(e,t),n),n}function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.JsonSnapsRegistry=void 0;const c=e("@metamask/base-controller"),l=e("@metamask/snaps-registry"),u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),p=e("./registry.cjs"),h={database:null,signature:null,lastUpdated:null,databaseUnavailable:!1};var m=new WeakMap,f=new WeakMap,g=new WeakMap,S=new WeakMap,E=new WeakMap,_=new WeakMap,T=new WeakMap,y=new WeakSet;class w extends c.BaseController{constructor({messenger:e,state:t,url:n={registry:"https://acl.execution.metamask.io/latest/registry.json",signature:"https://acl.execution.metamask.io/latest/signature.json"},publicKey:a="0x025b65308f0f0fb8bc7f7ff87bfc296e0330eee5d3c1d1ee4a048b2fd6a86fa0a6",clientConfig:c,fetchFunction:l=globalThis.fetch.bind(undefined),recentFetchThreshold:u=(0,d.inMilliseconds)(5,d.Duration.Minute),refetchOnAllowlistMiss:p=!0}){var w,b;super({messenger:e,metadata:{database:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},signature:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1},lastUpdated:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1},databaseUnavailable:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1}},name:"SnapsRegistry",state:{...h,...t}}),r(w=this,b=y),b.add(w),s(this,m,void 0),s(this,f,void 0),s(this,g,void 0),s(this,S,void 0),s(this,E,void 0),s(this,_,void 0),s(this,T,void 0),i(m,this,n),i(f,this,a),i(g,this,c),i(S,this,l),i(E,this,u),i(_,this,p),i(T,this,null),this.messenger.registerActionHandler("SnapsRegistry:get",async(...e)=>o(y,this,C).call(this,...e)),this.messenger.registerActionHandler("SnapsRegistry:getMetadata",(...e)=>o(y,this,R).call(this,...e)),this.messenger.registerActionHandler("SnapsRegistry:resolveVersion",async(...e)=>o(y,this,N).call(this,...e)),this.messenger.registerActionHandler("SnapsRegistry:update",async()=>o(y,this,I).call(this))}}function b(){return this.state.lastUpdated&&Date.now()-this.state.lastUpdated<a(E,this)}async function I(){a(T,this)?await a(T,this):(null===a(T,this)&&i(T,this,o(y,this,A).call(this)),await a(T,this),i(T,this,null))}async function A(){if(!o(y,this,b).call(this))try{const[e,t]=await Promise.all([o(y,this,M).call(this,a(m,this).registry),o(y,this,M).call(this,a(m,this).signature)]),n=JSON.parse(t);if(n.signature===this.state.signature)return void this.update(e=>{e.lastUpdated=Date.now(),e.databaseUnavailable=!1});await o(y,this,P).call(this,e,n),this.update(t=>{t.database=JSON.parse(e),t.lastUpdated=Date.now(),t.databaseUnavailable=!1,t.signature=n.signature})}catch{this.update(e=>{e.databaseUnavailable=!0})}}async function v(){return null===this.state.database&&await o(y,this,I).call(this),this.state.database}async function k(e,t,n=!1){var s,r;const i=await o(y,this,v).call(this),c=null==i?void 0:i.blockedSnaps.find(n=>"id"in n?n.id===e&&(0,d.satisfiesVersionRange)(t.version,n.versionRange):n.checksum===t.checksum);if(c)return{status:p.SnapsRegistryStatus.Blocked,reason:c.reason};const l=null==i?void 0:i.verifiedSnaps[e],u=null==l||null===(s=l.versions)||void 0===s?void 0:s[t.version],h=null==u||null===(r=u.clientVersions)||void 0===r?void 0:r[a(g,this).type],m=!h||(0,d.satisfiesVersionRange)(a(g,this).version,h);return u&&u.checksum===t.checksum&&m?{status:p.SnapsRegistryStatus.Verified}:a(_,this)&&!n?(await o(y,this,I).call(this),o(y,this,k).call(this,e,t,!0)):{status:this.state.databaseUnavailable?p.SnapsRegistryStatus.Unavailable:p.SnapsRegistryStatus.Unverified}}async function C(e){return Object.entries(e).reduce(async(e,[t,n])=>{const s=await o(y,this,k).call(this,t,n),r=await e;return r[t]=s,r},Promise.resolve({}))}async function N(e,t,n=!1){var s;const r=await o(y,this,v).call(this),i=(null==r||null===(s=r.verifiedSnaps[e])||void 0===s?void 0:s.versions)??null;if(!i&&a(_,this)&&!n)return await o(y,this,I).call(this),o(y,this,N).call(this,e,t,!0);if(!i)return t;const c=Object.entries(i).reduce((e,[t,n])=>{var s;const r=null===(s=n.clientVersions)||void 0===s?void 0:s[a(g,this).type];return r&&!(0,d.satisfiesVersionRange)(a(g,this).version,r)||e.push(t),e},[]),l=(0,u.getTargetVersion)(c,t);return l||!a(_,this)||n?l?((0,d.assertIsSemVerRange)(l),l):t:(await o(y,this,I).call(this),o(y,this,N).call(this,e,t,!0))}function R(e){var t;return(null===(t=this.state)||void 0===t||null===(t=t.database)||void 0===t||null===(t=t.verifiedSnaps[e])||void 0===t?void 0:t.metadata)??null}async function P(e,t){(0,d.assert)(a(f,this),"No public key provided.");const n=await(0,l.verify)({registry:e,signature:t,publicKey:a(f,this)});(0,d.assert)(n,"Invalid registry signature.")}async function M(e){const t=await a(S,this).call(this,e,{cache:"no-cache"});if(!t.ok)throw new Error(`Failed to fetch ${e}.`);return await t.text()}n.JsonSnapsRegistry=w}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/registry/json.cjs"}],[2684,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s;Object.defineProperty(n,"__esModule",{value:!0}),n.SnapsRegistryStatus=void 0,function(e){e[e.Unverified=0]="Unverified",e[e.Blocked=1]="Blocked",e[e.Verified=2]="Verified",e[e.Unavailable=3]="Unavailable"}(s||(n.SnapsRegistryStatus=s={}))}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/registry/registry.cjs"}],[2685,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getRunnableSnaps=void 0;n.getRunnableSnaps=e=>e.filter(e=>e.enabled&&!e.blocked)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/selectors.cjs"}],[2686,{"./snaps/Timer.cjs":2674,"@metamask/snaps-sdk":2786,"@metamask/snaps-utils":2903,"fast-deep-equal":4391},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.isLocalSnapId=n.isTrackableHandler=n.throttleTracking=n.TRACKABLE_HANDLERS=n.debouncePersistState=n.fetchSnap=n.getSnapFiles=n.withTimeout=n.hasTimedOut=n.delayWithTimer=n.delay=n.permissionsDiff=n.setDiff=void 0;const r=e("@metamask/snaps-sdk"),a=e("@metamask/snaps-utils"),i=s(e("fast-deep-equal")),o=e("./snaps/Timer.cjs");function c(e,t){let n;const s=new Promise((s,r)=>{e.start(()=>{t===undefined?s():s(t)}),n=r});return s.cancel=()=>{"finished"!==e.status&&(e.cancel(),n(new Error("The delay has been canceled.")))},s}async function l(e,t){return t&&0!==t.length?await Promise.all(t.map(async t=>e.fetch(t))):[]}n.setDiff=function(e,t){return Object.entries(e).reduce((e,[n,s])=>(n in t||(e[n]=s),e),{})},n.permissionsDiff=function(e,t){return Object.entries(e).reduce((e,[n,s])=>{const r=n in t;return(!r||r&&!(0,i.default)(s.caveats??[],t[n].caveats??[]))&&(e[n]=s),e},{})},n.delay=function(e,t){return c(new o.Timer(e),t)},n.delayWithTimer=c,n.hasTimedOut=Symbol("Used to check if the requested promise has timeout (see withTimeout)"),n.withTimeout=async function(e,t){const s=c("number"==typeof t?new o.Timer(t):t,n.hasTimedOut);try{return await Promise.race([e,s])}finally{s.cancel()}},n.getSnapFiles=l,n.fetchSnap=async function(e,t){try{const e=await t.manifest(),n=await t.fetch(e.result.source.location.npm.filePath);(0,r.assert)(n.size<a.MAX_FILE_SIZE,"Snap source code must be smaller than 64 MB.");const{iconPath:s}=e.result.source.location.npm,i=s?await t.fetch(s):undefined,o=await l(t,e.result.source.files);(0,a.validateAuxiliaryFiles)(o),await Promise.all(o.map(async e=>{e.data.base64=await(0,a.encodeBase64)(e)}));const c=await l(t,e.result.source.locales),u={manifest:e,sourceCode:n,svgIcon:i,auxiliaryFiles:o,localizationFiles:(0,a.getValidatedLocalizationFiles)(c)};return await(0,a.validateFetchedSnap)(u),u}catch(t){throw new Error(`Failed to fetch snap "${e}": ${(0,r.getErrorMessage)(t)}.`)}},n.debouncePersistState=function(e,t=1e3){const n=new Map;return(s,r,a)=>{const i=`${s}-${a}`;n.has(i)&&clearTimeout(n.get(i)),n.set(i,setTimeout(()=>{e(s,r,a),n.delete(i)},t))}},n.TRACKABLE_HANDLERS=Object.freeze([a.HandlerType.OnHomePage,a.HandlerType.OnInstall,a.HandlerType.OnNameLookup,a.HandlerType.OnRpcRequest,a.HandlerType.OnSignature,a.HandlerType.OnTransaction,a.HandlerType.OnUpdate]),n.throttleTracking=function(e,t=6e4){const n=new Map,s=new Map;return(r,a,i,o)=>{const c=`${r}${a}${i}${o}`,l=Date.now(),u=n.get(c)??0,d=[r,a,i,o];if(l-u>=t)return n.set(c,l),void e(...d);const p=s.get(c);null!=p&&p.timer&&clearTimeout(p.timer),n.set(c,l),s.set(c,{args:d,timer:setTimeout(()=>{e(...d),s.delete(c)},t)})}},n.isTrackableHandler=function(e){return n.TRACKABLE_HANDLERS.includes(e)},n.isLocalSnapId=function(e){return e.startsWith("local:")}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/utils.cjs"}],[2687,{"../snaps/index.cjs":2676,"@metamask/rpc-errors":2600,"@metamask/snaps-utils":2903,"@metamask/utils":3116,nanoid:5037},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){return e.get(c(e,t))}function o(e,t,n){return e.set(c(e,t),n),n}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketService=void 0;const l=e("@metamask/rpc-errors"),u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),p=e("nanoid"),h=e("../snaps/index.cjs"),m="WebSocketService";var f=new WeakMap,g=new WeakMap,S=new WeakSet;function E(e,t){const n=i(g,this).get(t);return(0,d.assert)(n&&n.snapId===e,`Socket with ID "${t}" not found.`),n}function _(e,t,n){return c(S,this,A).call(this,e).some(e=>e.url===t&&(0,u.isEqual)(e.protocols,n))}function T(e,t){i(f,this).call("SnapController:handleRequest",{origin:h.METAMASK_ORIGIN,snapId:e,handler:u.HandlerType.OnWebSocketEvent,request:{method:"",params:{event:t}}}).catch(t=>{(0,u.logError)(`An error occurred while handling a WebSocket message for Snap "${e}":`,t)})}async function y(e,t,n=[]){(0,d.assert)(!c(S,this,_).call(this,e,t,n),`An open WebSocket connection to ${t} already exists.`);const s=new URL(t),{origin:r}=s,a=(0,p.nanoid)(),o=new WebSocket(t,n);o.binaryType="arraybuffer";const{promise:u,resolve:h,reject:m}=(0,d.createDeferredPromise)();o.addEventListener("open",()=>{h(),c(S,this,T).call(this,e,{type:"open",id:a,origin:r})}),o.addEventListener("close",t=>{i(g,this).delete(a),c(S,this,T).call(this,e,{type:"close",id:a,origin:r,code:t.code,reason:t.reason,wasClean:t.wasClean??null})});const f=()=>{m(l.rpcErrors.resourceUnavailable("An error occurred while opening the WebSocket."))};return o.addEventListener("error",f),o.addEventListener("message",t=>{const n="string"==typeof t.data?{type:"text",message:t.data}:{type:"binary",message:Array.from(new Uint8Array(t.data))};c(S,this,T).call(this,e,{type:"message",id:a,origin:r,data:n})}),i(g,this).set(a,{id:a,snapId:e,url:t,protocols:n,socket:o,openPromise:u}),await u,o.removeEventListener("error",f),a}function w(e,t){const{socket:n}=c(S,this,E).call(this,e,t);n.close()}function b(e){for(const t of c(S,this,A).call(this,e))c(S,this,w).call(this,e,t.id)}async function I(e,t,n){const{socket:s,openPromise:r}=c(S,this,E).call(this,e,t);await r;const a=Array.isArray(n)?new Uint8Array(n):n;s.send(a)}function A(e){return[...i(g,this).values()].filter(t=>t.snapId===e).map(e=>({id:e.id,url:e.url,protocols:e.protocols}))}n.WebSocketService=class{constructor({messenger:e}){var t,n;r(t=this,n=S),n.add(t),a(this,"name",m),a(this,"state",null),s(this,f,void 0),s(this,g,void 0),o(f,this,e),o(g,this,new Map),i(f,this).registerActionHandler(`${m}:open`,async(...e)=>c(S,this,y).call(this,...e)),i(f,this).registerActionHandler(`${m}:close`,(...e)=>c(S,this,w).call(this,...e)),i(f,this).registerActionHandler(`${m}:sendMessage`,async(...e)=>c(S,this,I).call(this,...e)),i(f,this).registerActionHandler(`${m}:getAll`,(...e)=>c(S,this,A).call(this,...e)),i(f,this).subscribe("SnapController:snapUpdated",e=>{c(S,this,b).call(this,e.id)}),i(f,this).subscribe("SnapController:snapUninstalled",e=>{c(S,this,b).call(this,e.id)}),i(f,this).subscribe("SnapController:snapInstalled",e=>{c(S,this,b).call(this,e.id)})}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/websocket/WebSocketService.cjs"}],[2688,{"./WebSocketService.cjs":2687},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./WebSocketService.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/websocket/index.cjs"}],[2689,{buffer:4084,"buffer-from":4090,inherits:4617,"readable-stream":2704,typedarray:5692},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var s=e("readable-stream").Writable,r=e("inherits"),a=e("buffer-from");if("undefined"==typeof Uint8Array)var i=e("typedarray").Uint8Array;else i=Uint8Array;function o(e,t){if(!(this instanceof o))return new o(e,t);"function"==typeof e&&(t=e,e={}),e||(e={});var n=e.encoding,r=!1;n?"u8"!==(n=String(n).toLowerCase())&&"uint8"!==n||(n="uint8array"):r=!0,s.call(this,{objectMode:!0}),this.encoding=n,this.shouldInferEncoding=r,t&&this.on("finish",function(){t(this.getBody())}),this.body=[]}t.exports=o,r(o,s),o.prototype._write=function(e,t,n){this.body.push(e),n()},o.prototype.inferEncoding=function(e){var t=e===undefined?this.body[0]:e;return n.isBuffer(t)?"buffer":"undefined"!=typeof Uint8Array&&t instanceof Uint8Array?"uint8array":Array.isArray(t)?"array":"string"==typeof t?"string":"[object Object]"===Object.prototype.toString.call(t)?"object":"buffer"},o.prototype.getBody=function(){return this.encoding||0!==this.body.length?(this.shouldInferEncoding&&(this.encoding=this.inferEncoding()),"array"===this.encoding?function(e){for(var t=[],n=0;n<e.length;n++)t.push.apply(t,e[n]);return t}(this.body):"string"===this.encoding?function(e){for(var t=[],s=0;s<e.length;s++){var r=e[s];"string"==typeof r||n.isBuffer(r)?t.push(r):c(r)?t.push(a(r)):t.push(a(String(r)))}t=n.isBuffer(e[0])?(t=n.concat(t)).toString("utf8"):t.join("");return t}(this.body):"buffer"===this.encoding?function(e){for(var t=[],s=0;s<e.length;s++){var r=e[s];n.isBuffer(r)?t.push(r):c(r)?t.push(a(r)):t.push(a(String(r)))}return n.concat(t)}(this.body):"uint8array"===this.encoding?function(e){for(var t=0,n=0;n<e.length;n++)"string"==typeof e[n]&&(e[n]=a(e[n])),t+=e[n].length;for(var s=new i(t),r=(n=0,0);n<e.length;n++)for(var o=e[n],c=0;c<o.length;c++)s[r++]=o[c];return s}(this.body):this.body):[]};Array.isArray;function c(e){return"string"==typeof e||(t=e,/Array\]$/.test(Object.prototype.toString.call(t)))||e&&"function"==typeof e.subarray;var t}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/snaps-controllers>concat-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/concat-stream/index.js"}],[269,{"../../../shared/constants/permissions":5799,"../controllers/permissions":239,"@metamask/keyring-api":2193},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({messenger:e}){return function(t,n,r,a){const o=e.call("AccountsController:getSelectedAccount");if((0,s.isEvmAccountType)(o.type))return r();if(i.includes(t.method))return a(new Error(`Non-EVM account cannot request this method: ${t.method}`));if("wallet_requestPermissions"===t.method&&null!=t&&t.params&&Array.isArray(t.params)&&t.params.length>0&&t.params[0]){const e=Object.keys(t.params[0]);if(i.some(t=>e.includes(t)))return a(new Error(`Non-EVM account cannot request this method: ${e.toString()}`))}return r()}};var s=e("@metamask/keyring-api"),r=e("../../../shared/constants/permissions"),a=e("../controllers/permissions");const i=[...Object.values(r.RestrictedEthMethods),...a.unrestrictedEthSigningMethods]}}},{package:"$root$",file:"app/scripts/lib/createEvmMethodsToNonEvmAccountReqFilterMiddleware.ts"}],[2690,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s={};function r(e,t,n){n||(n=Error);var r=function(e){var n,s;function r(n,s,r){return e.call(this,function(e,n,s){return"string"==typeof t?t:t(e,n,s)}(n,s,r))||this}return s=e,(n=r).prototype=Object.create(s.prototype),n.prototype.constructor=n,n.__proto__=s,r}(n);r.prototype.name=n.name,r.prototype.code=e,s[e]=r}function a(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map(function(e){return String(e)}),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}r("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError),r("ERR_INVALID_ARG_TYPE",function(e,t,n){var s,r,i,o;if("string"==typeof t&&(r="not ",t.substr(!i||i<0?0:+i,r.length)===r)?(s="must not be",t=t.replace(/^not /,"")):s="must be",function(e,t,n){return(n===undefined||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}(e," argument"))o="The ".concat(e," ").concat(s," ").concat(a(t,"type"));else{var c=function(e,t,n){return"number"!=typeof n&&(n=0),!(n+t.length>e.length)&&-1!==e.indexOf(t,n)}(e,".")?"property":"argument";o='The "'.concat(e,'" ').concat(c," ").concat(s," ").concat(a(t,"type"))}return o+=". Received type ".concat(typeof n)},TypeError),r("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),r("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"}),r("ERR_STREAM_PREMATURE_CLOSE","Premature close"),r("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"}),r("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),r("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),r("ERR_STREAM_WRITE_AFTER_END","write after end"),r("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),r("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError),r("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),t.exports.codes=s}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/errors-browser.js"}],[2691,{"./_stream_readable":2693,"./_stream_writable":2695,_process:5089,inherits:4617},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var s=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};t.exports=l;var r=e("./_stream_readable"),a=e("./_stream_writable");e("inherits")(l,r);for(var i=s(a.prototype),o=0;o<i.length;o++){var c=i[o];l.prototype[c]||(l.prototype[c]=a.prototype[c])}function l(e){if(!(this instanceof l))return new l(e);r.call(this,e),a.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",u)))}function u(){this._writableState.ended||n.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(l.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(l.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_duplex.js"}],[2692,{"./_stream_transform":2694,inherits:4617},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=r;var s=e("./_stream_transform");function r(e){if(!(this instanceof r))return new r(e);s.call(this,e)}e("inherits")(r,s),r.prototype._transform=function(e,t,n){n(null,e)}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_passthrough.js"}],[2693,{"../errors":2690,"./_stream_duplex":2691,"./internal/streams/async_iterator":2696,"./internal/streams/buffer_list":2697,"./internal/streams/destroy":2698,"./internal/streams/from":2700,"./internal/streams/state":2702,"./internal/streams/stream":2703,_process:5089,buffer:4084,events:4384,inherits:4617,"string_decoder/":5665,util:4036},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var s;t.exports=I,I.ReadableState=b;e("events").EventEmitter;var r=function(e,t){return e.listeners(t).length},a=e("./internal/streams/stream"),i=e("buffer").Buffer,o=("undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var c,l=e("util");c=l&&l.debuglog?l.debuglog("stream"):function(){};var u,d,p,h=e("./internal/streams/buffer_list"),m=e("./internal/streams/destroy"),f=e("./internal/streams/state").getHighWaterMark,g=e("../errors").codes,S=g.ERR_INVALID_ARG_TYPE,E=g.ERR_STREAM_PUSH_AFTER_EOF,_=g.ERR_METHOD_NOT_IMPLEMENTED,T=g.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;e("inherits")(I,a);var y=m.errorOrDestroy,w=["error","close","destroy","pause","resume"];function b(t,n,r){s=s||e("./_stream_duplex"),t=t||{},"boolean"!=typeof r&&(r=n instanceof s),this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=f(this,t,"readableHighWaterMark",r),this.buffer=new h,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(u||(u=e("string_decoder/").StringDecoder),this.decoder=new u(t.encoding),this.encoding=t.encoding)}function I(t){if(s=s||e("./_stream_duplex"),!(this instanceof I))return new I(t);var n=this instanceof s;this._readableState=new b(t,this,n),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),a.call(this)}function A(e,t,n,s,r){c("readableAddChunk",t);var a,l=e._readableState;if(null===t)l.reading=!1,function(e,t){if(c("onEofChunk"),t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.sync?N(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,R(e)))}(e,l);else if(r||(a=function(e,t){var n;s=t,i.isBuffer(s)||s instanceof o||"string"==typeof t||t===undefined||e.objectMode||(n=new S("chunk",["string","Buffer","Uint8Array"],t));var s;return n}(l,t)),a)y(e,a);else if(l.objectMode||t&&t.length>0)if("string"==typeof t||l.objectMode||Object.getPrototypeOf(t)===i.prototype||(t=function(e){return i.from(e)}(t)),s)l.endEmitted?y(e,new T):v(e,l,t,!0);else if(l.ended)y(e,new E);else{if(l.destroyed)return!1;l.reading=!1,l.decoder&&!n?(t=l.decoder.write(t),l.objectMode||0!==t.length?v(e,l,t,!1):P(e,l)):v(e,l,t,!1)}else s||(l.reading=!1,P(e,l));return!l.ended&&(l.length<l.highWaterMark||0===l.length)}function v(e,t,n,s){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",n)):(t.length+=t.objectMode?1:n.length,s?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&N(e)),P(e,t)}Object.defineProperty(I.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==undefined&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),I.prototype.destroy=m.destroy,I.prototype._undestroy=m.undestroy,I.prototype._destroy=function(e,t){t(e)},I.prototype.push=function(e,t){var n,s=this._readableState;return s.objectMode?n=!0:"string"==typeof e&&((t=t||s.defaultEncoding)!==s.encoding&&(e=i.from(e,t),t=""),n=!0),A(this,e,t,!1,n)},I.prototype.unshift=function(e){return A(this,e,null,!0,!1)},I.prototype.isPaused=function(){return!1===this._readableState.flowing},I.prototype.setEncoding=function(t){u||(u=e("string_decoder/").StringDecoder);var n=new u(t);this._readableState.decoder=n,this._readableState.encoding=this._readableState.decoder.encoding;for(var s=this._readableState.buffer.head,r="";null!==s;)r+=n.write(s.data),s=s.next;return this._readableState.buffer.clear(),""!==r&&this._readableState.buffer.push(r),this._readableState.length=r.length,this};var k=1073741824;function C(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=k?e=k:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function N(e){var t=e._readableState;c("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(c("emitReadable",t.flowing),t.emittedReadable=!0,n.nextTick(R,e))}function R(e){var t=e._readableState;c("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,j(e)}function P(e,t){t.readingMore||(t.readingMore=!0,n.nextTick(M,e,t))}function M(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var n=t.length;if(c("maybeReadMore read 0"),e.read(0),n===t.length)break}t.readingMore=!1}function O(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function D(e){c("readable nexttick read 0"),e.read(0)}function L(e,t){c("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),j(e),t.flowing&&!t.reading&&e.read(0)}function j(e){var t=e._readableState;for(c("flow",t.flowing);t.flowing&&null!==e.read(););}function B(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):n=t.buffer.consume(e,t.decoder),n);var n}function x(e){var t=e._readableState;c("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,n.nextTick(F,t,e))}function F(e,t){if(c("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var n=t._writableState;(!n||n.autoDestroy&&n.finished)&&t.destroy()}}function U(e,t){for(var n=0,s=e.length;n<s;n++)if(e[n]===t)return n;return-1}I.prototype.read=function(e){c("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return c("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?x(this):N(this),null;if(0===(e=C(e,t))&&t.ended)return 0===t.length&&x(this),null;var s,r=t.needReadable;return c("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&c("length less than watermark",r=!0),t.ended||t.reading?c("reading or ended",r=!1):r&&(c("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=C(n,t))),null===(s=e>0?B(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&x(this)),null!==s&&this.emit("data",s),s},I.prototype._read=function(e){y(this,new _("_read()"))},I.prototype.pipe=function(e,t){var s=this,a=this._readableState;switch(a.pipesCount){case 0:a.pipes=e;break;case 1:a.pipes=[a.pipes,e];break;default:a.pipes.push(e)}a.pipesCount+=1,c("pipe count=%d opts=%j",a.pipesCount,t);var i=(!t||!1!==t.end)&&e!==n.stdout&&e!==n.stderr?l:g;function o(t,n){c("onunpipe"),t===s&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,c("cleanup"),e.removeListener("close",m),e.removeListener("finish",f),e.removeListener("drain",u),e.removeListener("error",h),e.removeListener("unpipe",o),s.removeListener("end",l),s.removeListener("end",g),s.removeListener("data",p),d=!0,!a.awaitDrain||e._writableState&&!e._writableState.needDrain||u())}function l(){c("onend"),e.end()}a.endEmitted?n.nextTick(i):s.once("end",i),e.on("unpipe",o);var u=function(e){return function(){var t=e._readableState;c("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&r(e,"data")&&(t.flowing=!0,j(e))}}(s);e.on("drain",u);var d=!1;function p(t){c("ondata");var n=e.write(t);c("dest.write",n),!1===n&&((1===a.pipesCount&&a.pipes===e||a.pipesCount>1&&-1!==U(a.pipes,e))&&!d&&(c("false write response, pause",a.awaitDrain),a.awaitDrain++),s.pause())}function h(t){c("onerror",t),g(),e.removeListener("error",h),0===r(e,"error")&&y(e,t)}function m(){e.removeListener("finish",f),g()}function f(){c("onfinish"),e.removeListener("close",m),g()}function g(){c("unpipe"),s.unpipe(e)}return s.on("data",p),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",h),e.once("close",m),e.once("finish",f),e.emit("pipe",s),a.flowing||(c("pipe resume"),s.resume()),e},I.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var s=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<r;a++)s[a].emit("unpipe",this,{hasUnpiped:!1});return this}var i=U(t.pipes,e);return-1===i||(t.pipes.splice(i,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},I.prototype.on=function(e,t){var s=a.prototype.on.call(this,e,t),r=this._readableState;return"data"===e?(r.readableListening=this.listenerCount("readable")>0,!1!==r.flowing&&this.resume()):"readable"===e&&(r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.flowing=!1,r.emittedReadable=!1,c("on readable",r.length,r.reading),r.length?N(this):r.reading||n.nextTick(D,this))),s},I.prototype.addListener=I.prototype.on,I.prototype.removeListener=function(e,t){var s=a.prototype.removeListener.call(this,e,t);return"readable"===e&&n.nextTick(O,this),s},I.prototype.removeAllListeners=function(e){var t=a.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&e!==undefined||n.nextTick(O,this),t},I.prototype.resume=function(){var e=this._readableState;return e.flowing||(c("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,n.nextTick(L,e,t))}(this,e)),e.paused=!1,this},I.prototype.pause=function(){return c("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(c("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},I.prototype.wrap=function(e){var t=this,n=this._readableState,s=!1;for(var r in e.on("end",function(){if(c("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(r){(c("wrapped data"),n.decoder&&(r=n.decoder.write(r)),!n.objectMode||null!==r&&r!==undefined)&&((n.objectMode||r&&r.length)&&(t.push(r)||(s=!0,e.pause())))}),e)this[r]===undefined&&"function"==typeof e[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));for(var a=0;a<w.length;a++)e.on(w[a],this.emit.bind(this,w[a]));return this._read=function(t){c("wrapped _read",t),s&&(s=!1,e.resume())},this},"function"==typeof Symbol&&(I.prototype[Symbol.asyncIterator]=function(){return d===undefined&&(d=e("./internal/streams/async_iterator")),d(this)}),Object.defineProperty(I.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(I.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(I.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),I._fromList=B,Object.defineProperty(I.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(I.from=function(t,n){return p===undefined&&(p=e("./internal/streams/from")),p(I,t,n)})}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_readable.js"}],[2694,{"../errors":2690,"./_stream_duplex":2691,inherits:4617},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=u;var s=e("../errors").codes,r=s.ERR_METHOD_NOT_IMPLEMENTED,a=s.ERR_MULTIPLE_CALLBACK,i=s.ERR_TRANSFORM_ALREADY_TRANSFORMING,o=s.ERR_TRANSFORM_WITH_LENGTH_0,c=e("./_stream_duplex");function l(e,t){var n=this._transformState;n.transforming=!1;var s=n.writecb;if(null===s)return this.emit("error",new a);n.writechunk=null,n.writecb=null,null!=t&&this.push(t),s(e);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}function u(e){if(!(this instanceof u))return new u(e);c.call(this,e),this._transformState={afterTransform:l.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",d)}function d(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?p(this,null,null):this._flush(function(t,n){p(e,t,n)})}function p(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new o;if(e._transformState.transforming)throw new i;return e.push(null)}e("inherits")(u,c),u.prototype.push=function(e,t){return this._transformState.needTransform=!1,c.prototype.push.call(this,e,t)},u.prototype._transform=function(e,t,n){n(new r("_transform()"))},u.prototype._write=function(e,t,n){var s=this._transformState;if(s.writecb=n,s.writechunk=e,s.writeencoding=t,!s.transforming){var r=this._readableState;(s.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},u.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},u.prototype._destroy=function(e,t){c.prototype._destroy.call(this,e,function(e){t(e)})}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_transform.js"}],[2695,{"../errors":2690,"./_stream_duplex":2691,"./internal/streams/destroy":2698,"./internal/streams/state":2702,"./internal/streams/stream":2703,_process:5089,buffer:4084,inherits:4617,"util-deprecate":5730},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){function s(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var s=e.entry;e.entry=null;for(;s;){var r=s.callback;t.pendingcb--,r(n),s=s.next}t.corkedRequestsFree.next=e}(t,e)}}var r;t.exports=I,I.WritableState=b;var a={deprecate:e("util-deprecate")},i=e("./internal/streams/stream"),o=e("buffer").Buffer,c=("undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var l,u=e("./internal/streams/destroy"),d=e("./internal/streams/state").getHighWaterMark,p=e("../errors").codes,h=p.ERR_INVALID_ARG_TYPE,m=p.ERR_METHOD_NOT_IMPLEMENTED,f=p.ERR_MULTIPLE_CALLBACK,g=p.ERR_STREAM_CANNOT_PIPE,S=p.ERR_STREAM_DESTROYED,E=p.ERR_STREAM_NULL_VALUES,_=p.ERR_STREAM_WRITE_AFTER_END,T=p.ERR_UNKNOWN_ENCODING,y=u.errorOrDestroy;function w(){}function b(t,a,i){r=r||e("./_stream_duplex"),t=t||{},"boolean"!=typeof i&&(i=a instanceof r),this.objectMode=!!t.objectMode,i&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=d(this,t,"writableHighWaterMark",i),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var o=!1===t.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var s=e._writableState,r=s.sync,a=s.writecb;if("function"!=typeof a)throw new f;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(s),t)!function(e,t,s,r,a){--t.pendingcb,s?(n.nextTick(a,r),n.nextTick(R,e,t),e._writableState.errorEmitted=!0,y(e,r)):(a(r),e._writableState.errorEmitted=!0,y(e,r),R(e,t))}(e,s,r,t,a);else{var i=C(s)||e.destroyed;i||s.corked||s.bufferProcessing||!s.bufferedRequest||k(e,s),r?n.nextTick(v,e,s,i,a):v(e,s,i,a)}}(a,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function I(t){var n=this instanceof(r=r||e("./_stream_duplex"));if(!n&&!l.call(I,this))return new I(t);this._writableState=new b(t,this,n),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),i.call(this)}function A(e,t,n,s,r,a,i){t.writelen=s,t.writecb=i,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new S("write")):n?e._writev(r,t.onwrite):e._write(r,a,t.onwrite),t.sync=!1}function v(e,t,n,s){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,s(),R(e,t)}function k(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,a=new Array(r),i=t.corkedRequestsFree;i.entry=n;for(var o=0,c=!0;n;)a[o]=n,n.isBuf||(c=!1),n=n.next,o+=1;a.allBuffers=c,A(e,t,!0,t.length,a,"",i.finish),t.pendingcb++,t.lastBufferedRequest=null,i.next?(t.corkedRequestsFree=i.next,i.next=null):t.corkedRequestsFree=new s(t),t.bufferedRequestCount=0}else{for(;n;){var l=n.chunk,u=n.encoding,d=n.callback;if(A(e,t,!1,t.objectMode?1:l.length,l,u,d),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function C(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function N(e,t){e._final(function(n){t.pendingcb--,n&&y(e,n),t.prefinished=!0,e.emit("prefinish"),R(e,t)})}function R(e,t){var s=C(t);if(s&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,n.nextTick(N,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var r=e._readableState;(!r||r.autoDestroy&&r.endEmitted)&&e.destroy()}return s}e("inherits")(I,i),b.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(b.prototype,"buffer",{get:a.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(l=Function.prototype[Symbol.hasInstance],Object.defineProperty(I,Symbol.hasInstance,{value:function(e){return!!l.call(this,e)||this===I&&(e&&e._writableState instanceof b)}})):l=function(e){return e instanceof this},I.prototype.pipe=function(){y(this,new g)},I.prototype.write=function(e,t,s){var r,a=this._writableState,i=!1,l=!a.objectMode&&(r=e,o.isBuffer(r)||r instanceof c);return l&&!o.isBuffer(e)&&(e=function(e){return o.from(e)}(e)),"function"==typeof t&&(s=t,t=null),l?t="buffer":t||(t=a.defaultEncoding),"function"!=typeof s&&(s=w),a.ending?function(e,t){var s=new _;y(e,s),n.nextTick(t,s)}(this,s):(l||function(e,t,s,r){var a;return null===s?a=new E:"string"==typeof s||t.objectMode||(a=new h("chunk",["string","Buffer"],s)),!a||(y(e,a),n.nextTick(r,a),!1)}(this,a,e,s))&&(a.pendingcb++,i=function(e,t,n,s,r,a){if(!n){var i=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=o.from(t,n));return t}(t,s,r);s!==i&&(n=!0,r="buffer",s=i)}var c=t.objectMode?1:s.length;t.length+=c;var l=t.length<t.highWaterMark;l||(t.needDrain=!0);if(t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:s,encoding:r,isBuf:n,callback:a,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else A(e,t,!1,c,s,r,a);return l}(this,a,l,e,t,s)),i},I.prototype.cork=function(){this._writableState.corked++},I.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||k(this,e))},I.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new T(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(I.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(I.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),I.prototype._write=function(e,t,n){n(new m("_write()"))},I.prototype._writev=null,I.prototype.end=function(e,t,s){var r=this._writableState;return"function"==typeof e?(s=e,e=null,t=null):"function"==typeof t&&(s=t,t=null),null!==e&&e!==undefined&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||function(e,t,s){t.ending=!0,R(e,t),s&&(t.finished?n.nextTick(s):e.once("finish",s));t.ended=!0,e.writable=!1}(this,r,s),this},Object.defineProperty(I.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(I.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==undefined&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),I.prototype.destroy=u.destroy,I.prototype._undestroy=u.undestroy,I.prototype._destroy=function(e,t){t(e)}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/_stream_writable.js"}],[2696,{"./end-of-stream":2699,_process:5089},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var s;function r(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=e("./end-of-stream"),i=Symbol("lastResolve"),o=Symbol("lastReject"),c=Symbol("error"),l=Symbol("ended"),u=Symbol("lastPromise"),d=Symbol("handlePromise"),p=Symbol("stream");function h(e,t){return{value:e,done:t}}function m(e){var t=e[i];if(null!==t){var n=e[p].read();null!==n&&(e[u]=null,e[i]=null,e[o]=null,t(h(n,!1)))}}function f(e){n.nextTick(m,e)}var g=Object.getPrototypeOf(function(){}),S=Object.setPrototypeOf((r(s={get stream(){return this[p]},next:function(){var e=this,t=this[c];if(null!==t)return Promise.reject(t);if(this[l])return Promise.resolve(h(undefined,!0));if(this[p].destroyed)return new Promise(function(t,s){n.nextTick(function(){e[c]?s(e[c]):t(h(undefined,!0))})});var s,r=this[u];if(r)s=new Promise(function(e,t){return function(n,s){e.then(function(){t[l]?n(h(undefined,!0)):t[d](n,s)},s)}}(r,this));else{var a=this[p].read();if(null!==a)return Promise.resolve(h(a,!1));s=new Promise(this[d])}return this[u]=s,s}},Symbol.asyncIterator,function(){return this}),r(s,"return",function(){var e=this;return new Promise(function(t,n){e[p].destroy(null,function(e){e?n(e):t(h(undefined,!0))})})}),s),g);t.exports=function(e){var t,n=Object.create(S,(r(t={},p,{value:e,writable:!0}),r(t,i,{value:null,writable:!0}),r(t,o,{value:null,writable:!0}),r(t,c,{value:null,writable:!0}),r(t,l,{value:e._readableState.endEmitted,writable:!0}),r(t,d,{value:function(e,t){var s=n[p].read();s?(n[u]=null,n[i]=null,n[o]=null,e(h(s,!1))):(n[i]=e,n[o]=t)},writable:!0}),t));return n[u]=null,a(e,function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=n[o];return null!==t&&(n[u]=null,n[i]=null,n[o]=null,t(e)),void(n[c]=e)}var s=n[i];null!==s&&(n[u]=null,n[i]=null,n[o]=null,s(h(undefined,!0))),n[l]=!0}),e.on("readable",f.bind(null,n)),n}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/async_iterator.js"}],[2697,{buffer:4084,util:4036},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){a(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function a(e,t,n){return(t=o(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,o(s.key),s)}}function o(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var c=e("buffer").Buffer,l=e("util").inspect,u=l&&l.custom||"inspect";function d(e,t,n){c.prototype.copy.call(e,t,n)}t.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,n,s;return t=e,(n=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n}},{key:"concat",value:function(e){if(0===this.length)return c.alloc(0);for(var t=c.allocUnsafe(e>>>0),n=this.head,s=0;n;)d(n.data,t,s),s+=n.data.length,n=n.next;return t}},{key:"consume",value:function(e,t){var n;return e<this.head.data.length?(n=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):n=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),n}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,n=1,s=t.data;for(e-=s.length;t=t.next;){var r=t.data,a=e>r.length?r.length:e;if(a===r.length?s+=r:s+=r.slice(0,e),0===(e-=a)){a===r.length?(++n,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=r.slice(a));break}++n}return this.length-=n,s}},{key:"_getBuffer",value:function(e){var t=c.allocUnsafe(e),n=this.head,s=1;for(n.data.copy(t),e-=n.data.length;n=n.next;){var r=n.data,a=e>r.length?r.length:e;if(r.copy(t,t.length-e,0,a),0===(e-=a)){a===r.length?(++s,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=r.slice(a));break}++s}return this.length-=s,t}},{key:u,value:function(e,t){return l(this,r(r({},t),{},{depth:0,customInspect:!1}))}}])&&i(t.prototype,n),s&&i(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}()}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/buffer_list.js"}],[2698,{_process:5089},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(e){(function(){function n(e,t){r(e,t),s(e)}function s(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function r(e,t){e.emit("error",t)}t.exports={destroy:function(t,a){var i=this,o=this._readableState&&this._readableState.destroyed,c=this._writableState&&this._writableState.destroyed;return o||c?(a?a(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,e.nextTick(r,this,t)):e.nextTick(r,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!a&&t?i._writableState?i._writableState.errorEmitted?e.nextTick(s,i):(i._writableState.errorEmitted=!0,e.nextTick(n,i,t)):e.nextTick(n,i,t):a?(e.nextTick(s,i),a(t)):e.nextTick(s,i)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var n=e._readableState,s=e._writableState;n&&n.autoDestroy||s&&s.autoDestroy?e.destroy(t):e.emit("error",t)}}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/destroy.js"}],[2699,{"../../../errors":2690},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=e("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function r(){}t.exports=function e(t,n,a){if("function"==typeof n)return e(t,null,n);n||(n={}),a=function(e){var t=!1;return function(){if(!t){t=!0;for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];e.apply(this,s)}}}(a||r);var i=n.readable||!1!==n.readable&&t.readable,o=n.writable||!1!==n.writable&&t.writable,c=function(){t.writable||u()},l=t._writableState&&t._writableState.finished,u=function(){o=!1,l=!0,i||a.call(t)},d=t._readableState&&t._readableState.endEmitted,p=function(){i=!1,d=!0,o||a.call(t)},h=function(e){a.call(t,e)},m=function(){var e;return i&&!d?(t._readableState&&t._readableState.ended||(e=new s),a.call(t,e)):o&&!l?(t._writableState&&t._writableState.ended||(e=new s),a.call(t,e)):void 0},f=function(){t.req.on("finish",u)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(t)?o&&!t._writableState&&(t.on("end",c),t.on("close",c)):(t.on("complete",u),t.on("abort",m),t.req?f():t.on("request",f)),t.on("end",p),t.on("finish",u),!1!==n.error&&t.on("error",h),t.on("close",m),function(){t.removeListener("complete",u),t.removeListener("abort",m),t.removeListener("request",f),t.req&&t.req.removeListener("finish",u),t.removeListener("end",c),t.removeListener("close",c),t.removeListener("finish",u),t.removeListener("end",p),t.removeListener("error",h),t.removeListener("close",m)}}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/end-of-stream.js"}],[27,{"../../controllers/network-order":234},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.NetworkOrderControllerInit=void 0;var s=e("../../controllers/network-order");n.NetworkOrderControllerInit=({controllerMessenger:e,persistedState:t})=>({controller:new s.NetworkOrderController({messenger:e,state:{orderedNetworkList:[],...t.NetworkOrderController}})})}}},{package:"$root$",file:"app/scripts/controller-init/assets/network-order-controller-init.ts"}],[270,{loglevel:4846},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return function(t,n,s){s(s=>{n.error&&r.default.debug("Error in RPC response:\n",n),t.isMetamaskInternal||(r.default.info(`RPC (${e.origin}): ${t.method} -> ${n.error?"error":"success"}`),s())})}};var s,r=(s=e("loglevel"))&&s.__esModule?s:{default:s}}}},{package:"$root$",file:"app/scripts/lib/createLoggerMiddleware.js"}],[2700,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=function(){throw new Error("Readable.from is not available in the browser")}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/from-browser.js"}],[2701,{"../../../errors":2690,"./end-of-stream":2699},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s;var r=e("../../../errors").codes,a=r.ERR_MISSING_ARGS,i=r.ERR_STREAM_DESTROYED;function o(e){if(e)throw e}function c(e){e()}function l(e,t){return e.pipe(t)}t.exports=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var u,d=function(e){return e.length?"function"!=typeof e[e.length-1]?o:e.pop():o}(n);if(Array.isArray(n[0])&&(n=n[0]),n.length<2)throw new a("streams");var p=n.map(function(t,r){var a=r<n.length-1;return function(t,n,r,a){a=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(a);var o=!1;t.on("close",function(){o=!0}),s===undefined&&(s=e("./end-of-stream")),s(t,{readable:n,writable:r},function(e){if(e)return a(e);o=!0,a()});var c=!1;return function(e){if(!o&&!c)return c=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(t)?t.abort():"function"==typeof t.destroy?t.destroy():void a(e||new i("pipe"))}}(t,a,r>0,function(e){u||(u=e),e&&p.forEach(c),a||(p.forEach(c),d(u))})});return n.reduce(l)}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/pipeline.js"}],[2702,{"../../../errors":2690},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=e("../../../errors").codes.ERR_INVALID_OPT_VALUE;t.exports={getHighWaterMark:function(e,t,n,r){var a=function(e,t,n){return null!=e.highWaterMark?e.highWaterMark:t?e[n]:null}(t,r,n);if(null!=a){if(!isFinite(a)||Math.floor(a)!==a||a<0)throw new s(r?n:"highWaterMark",a);return Math.floor(a)}return e.objectMode?16:16384}}}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/state.js"}],[2703,{events:4384},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=e("events").EventEmitter}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/lib/internal/streams/stream-browser.js"}],[2704,{"./lib/_stream_duplex.js":2691,"./lib/_stream_passthrough.js":2692,"./lib/_stream_readable.js":2693,"./lib/_stream_transform.js":2694,"./lib/_stream_writable.js":2695,"./lib/internal/streams/end-of-stream.js":2699,"./lib/internal/streams/pipeline.js":2701},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(n=t.exports=e("./lib/_stream_readable.js")).Stream=n,n.Readable=n,n.Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js"),n.finished=e("./lib/internal/streams/end-of-stream.js"),n.pipeline=e("./lib/internal/streams/pipeline.js")}}},{package:"@metamask/snaps-controllers>readable-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/readable-stream/readable-browser.js"}],[2709,{"./verify":2710,"@metamask/superstruct":2936,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),n.SnapsRegistryDatabaseStruct=n.BlockedSnapStruct=n.BlockReasonStruct=n.VerifiedSnapStruct=n.ImagePathStruct=n.AdditionalSourceCodeStruct=n.SupportStruct=n.AuditStruct=n.AuthorStruct=void 0;const a=e("@metamask/superstruct"),i=e("@metamask/utils"),o=(0,a.refine)((0,a.string)(),"Npm ID",e=>e.startsWith("npm:")),c=(0,a.object)({checksum:i.ChecksumStruct,clientVersions:(0,a.optional)((0,a.object)({extension:(0,a.optional)(i.VersionRangeStruct),mobile:(0,a.optional)(i.VersionRangeStruct)}))});n.AuthorStruct=(0,a.object)({name:(0,a.string)(),website:(0,a.string)()}),n.AuditStruct=(0,a.object)({auditor:(0,a.string)(),report:(0,a.string)()}),n.SupportStruct=(0,a.object)({knowledgeBase:(0,a.optional)((0,a.string)()),faq:(0,a.optional)((0,a.string)()),contact:(0,a.optional)((0,a.string)()),keyRecovery:(0,a.optional)((0,a.string)())}),n.AdditionalSourceCodeStruct=(0,a.object)({name:(0,a.string)(),url:(0,a.string)()}),n.ImagePathStruct=(0,a.pattern)((0,a.string)(),/\.\/images\/.*\/\d+\.(?:png|jpe?g)$/u),n.VerifiedSnapStruct=(0,a.object)({id:o,metadata:(0,a.object)({name:(0,a.string)(),type:(0,a.optional)((0,a.enums)(["account"])),author:(0,a.optional)(n.AuthorStruct),website:(0,a.optional)((0,a.string)()),onboard:(0,a.optional)((0,a.boolean)()),summary:(0,a.optional)((0,a.string)()),description:(0,a.optional)((0,a.string)()),audits:(0,a.optional)((0,a.array)(n.AuditStruct)),category:(0,a.optional)((0,a.enums)(["interoperability","notifications","transaction insights","account management","name resolution"])),tags:(0,a.optional)((0,a.array)((0,a.string)())),support:(0,a.optional)(n.SupportStruct),sourceCode:(0,a.optional)((0,a.string)()),hidden:(0,a.optional)((0,a.boolean)()),privateCode:(0,a.optional)((0,a.boolean)()),privacyPolicy:(0,a.optional)((0,a.string)()),termsOfUse:(0,a.optional)((0,a.string)()),additionalSourceCode:(0,a.optional)((0,a.array)(n.AdditionalSourceCodeStruct)),screenshots:(0,a.optional)((0,a.size)((0,a.array)(n.ImagePathStruct),3,3))}),versions:(0,a.record)(i.VersionStruct,c)}),n.BlockReasonStruct=(0,a.object)({explanation:(0,a.optional)((0,a.string)()),url:(0,a.optional)((0,a.string)())}),n.BlockedSnapStruct=(0,a.union)([(0,a.object)({id:o,versionRange:i.VersionRangeStruct,reason:(0,a.optional)(n.BlockReasonStruct)}),(0,a.object)({checksum:i.ChecksumStruct,reason:(0,a.optional)(n.BlockReasonStruct)})]),n.SnapsRegistryDatabaseStruct=(0,a.object)({verifiedSnaps:(0,a.record)(o,n.VerifiedSnapStruct),blockedSnaps:(0,a.array)(n.BlockedSnapStruct)}),r(e("./verify"),n)}}},{package:"@metamask/snaps-utils>@metamask/snaps-registry",file:"node_modules/@metamask/snaps-registry/dist/index.js"}],[271,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({mainFrameOrigin:e}){return function(t,n,s){t.mainFrameOrigin=e,s()}}}}},{package:"$root$",file:"app/scripts/lib/createMainFrameOriginMiddleware.ts"}],[2710,{"@metamask/superstruct":2936,"@metamask/utils":3116,"@noble/curves/secp256k1":3157,"@noble/hashes/sha256":3169},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.verify=n.SignatureStruct=void 0;const s=e("@metamask/superstruct"),r=e("@metamask/utils"),a=e("@noble/curves/secp256k1"),i=e("@noble/hashes/sha256");n.SignatureStruct=(0,s.object)({signature:r.StrictHexStruct,curve:(0,s.literal)("secp256k1"),format:(0,s.literal)("DER")}),n.verify=async function({registry:e,signature:t,publicKey:s}){(0,r.assertStruct)(t,n.SignatureStruct,"Invalid signature object");const o=(0,r.hexToBytes)(s),c=await async function(e){var t;return"crypto"in globalThis&&"object"==typeof globalThis.crypto&&(null===(t=crypto.subtle)||void 0===t?void 0:t.digest)?new Uint8Array(await crypto.subtle.digest("SHA-256",e)):(0,i.sha256)(e)}((0,r.stringToBytes)(e));return a.secp256k1.verify((0,r.remove0x)(t.signature),c,o)}}}},{package:"@metamask/snaps-utils>@metamask/snaps-registry",file:"node_modules/@metamask/snaps-registry/dist/verify.js"}],[272,{"./stream-utils":351,"@metamask/rpc-errors":2600},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=e("@metamask/rpc-errors"),r=e("./stream-utils");n.default=(e,t)=>async n=>{if(!(0,r.isStreamWritable)(t))return;if(!e[n.method])return void t.write({jsonrpc:"2.0",error:s.rpcErrors.methodNotFound({message:`${n.method} not found`}),id:n.id});let a,i;try{a=await e[n.method](...n.params)}catch(e){i=e}(0,r.isStreamWritable)(t)?i?t.write({jsonrpc:"2.0",error:(0,s.serializeError)(i,{shouldIncludeStack:!0}),id:n.id}):t.write({jsonrpc:"2.0",result:a,id:n.id}):i&&console.error(i)}}}},{package:"$root$",file:"app/scripts/lib/createMetaRPCHandler.js"}],[273,{"./middleware/pending":295,"@metamask/eth-json-rpc-middleware":1885,"@metamask/json-rpc-engine/v2":2119},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({version:e,getAccounts:t,processTransaction:n,processTypedMessage:i,processTypedMessageV3:o,processTypedMessageV4:c,processPersonalMessage:l,processDecryptMessage:u,processEncryptionPublicKey:d,getPendingNonce:p,getPendingTransactionByHash:h,processRequestExecutionPermissions:m}){const f=r.JsonRpcEngineV2.create({middleware:[(0,r.createScaffoldMiddleware)({eth_syncing:!1,web3_clientVersion:`MetaMask/v${e}`}),(0,s.createWalletMiddleware)({getAccounts:t,processTransaction:n,processTypedMessage:i,processTypedMessageV3:o,processTypedMessageV4:c,processPersonalMessage:l,processDecryptMessage:u,processEncryptionPublicKey:d,processRequestExecutionPermissions:m}),(0,a.createPendingNonceMiddleware)({getPendingNonce:p}),(0,a.createPendingTxMiddleware)({getPendingTransactionByHash:h})]});return(0,r.asLegacyMiddleware)(f)};var s=e("@metamask/eth-json-rpc-middleware"),r=e("@metamask/json-rpc-engine/v2"),a=e("./middleware/pending")}}},{package:"$root$",file:"app/scripts/lib/createMetamaskMiddleware.ts"}],[274,{loglevel:4846,"webextension-polyfill":5763},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({location:e,registerOnboarding:t}){return async function(n,a,i,o){try{if("wallet_registerOnboarding"!==n.method)return void i();n.tabId&&n.tabId!==r.default.tabs.TAB_ID_NONE?await t(e,n.tabId):s.default.debug(`'wallet_registerOnboarding' message from ${e} ignored due to missing tabId`),a.result=!0,o()}catch(e){o(e)}}};var s=a(e("loglevel")),r=a(e("webextension-polyfill"));function a(e){return e&&e.__esModule?e:{default:e}}}}},{package:"$root$",file:"app/scripts/lib/createOnboardingMiddleware.js"}],[275,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return function(t,n,s){t.origin=e.origin,s()}}}}},{package:"$root$",file:"app/scripts/lib/createOriginMiddleware.js"}],[276,{"../../../shared/constants/app":5775,"@metamask/rpc-errors":2600},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SPAM_FILTER_ACTIVATED_ERROR=n.REJECTION_THRESHOLD_IN_MS=n.NUMBER_OF_REJECTIONS_THRESHOLD=n.BLOCKING_THRESHOLD_IN_MS=n.BLOCKABLE_METHODS=void 0,n.default=function({getThrottledOriginState:e,updateThrottledOriginState:t}){return function(n,s,r,p){const{method:h,origin:m}=n;if(!c.has(h)||l.includes(m))return void r();!function(e){if(!e)return!1;const t=Date.now(),{rejections:n,lastRejection:s}=e,r=t-s<=o;return n>=a&&r}(e(m))?r(n=>{if("error"in s&&s.error&&d(s.error)){var r;const a=null===(r=s.error)||void 0===r?void 0:r.data;if("rejectAllApprovals"===(null==a?void 0:a.cause))return void n();const o=e(m)||{rejections:0,lastRejection:0},c=Date.now(),l=c-o.lastRejection<i?o.rejections+1:1;t(m,{rejections:l,lastRejection:c})}else{const n=e(m);Boolean(n)&&t(m,{rejections:0,lastRejection:0})}n()}):p(u)}};var s=e("@metamask/rpc-errors"),r=e("../../../shared/constants/app");const a=n.NUMBER_OF_REJECTIONS_THRESHOLD=3,i=n.REJECTION_THRESHOLD_IN_MS=3e4,o=n.BLOCKING_THRESHOLD_IN_MS=6e4,c=n.BLOCKABLE_METHODS=new Set([r.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN,r.MESSAGE_TYPE.ETH_SEND_TRANSACTION,r.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA,r.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V1,r.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3,r.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4,r.MESSAGE_TYPE.PERSONAL_SIGN,r.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN,r.MESSAGE_TYPE.WALLET_SEND_CALLS,r.MESSAGE_TYPE.WATCH_ASSET]),l=["http://127.0.0.1:8080","http://127.0.0.1:8081","http://127.0.0.1:8082","http://localhost:8080","http://localhost:8081","http://localhost:8082"],u=n.SPAM_FILTER_ACTIVATED_ERROR=s.providerErrors.unauthorized("Request blocked due to spam filter."),d=e=>e.code===s.errorCodes.provider.userRejectedRequest}}},{package:"$root$",file:"app/scripts/lib/createOriginThrottlingMiddleware.ts"}],[277,{"../../../shared/constants/app":5775,"../../../shared/constants/metametrics":5791,"../../../shared/constants/security-provider":5803,"../../../shared/constants/signatures":5804,"../../../shared/constants/transaction":5814,"../../../shared/lib/snaps/snaps":5892,"../../../shared/lib/trust-signals":5903,"../../../shared/modules/error":5918,"../../../shared/modules/transaction.utils":5947,"../../../ui/helpers/utils/metrics":7120,"./snap-keyring/metrics":337,"@metamask/controller-utils":1449,"@metamask/rpc-errors":2600,"ethereumjs-util":4342},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({rateLimitTimeout:e=3e5,rateLimitSamplePercent:t=.001,globalRateLimitTimeout:n=3e5,globalRateLimitMaxAmount:A=10,getAccountType:v,getDeviceModel:k,getHardwareTypeForMetric:C,snapAndHardwareMessenger:N,appStateController:R,metaMetricsController:P,getHDEntropyIndex:M}){return async function(O,D,L){const{origin:j,method:B,params:x}=O,F=function(e){return[i.MESSAGE_TYPE.WALLET_CREATE_SESSION,i.MESSAGE_TYPE.WALLET_INVOKE_METHOD].includes(e)}(B),U=F?o.MetaMetricsRequestedThrough.MultichainApi:o.MetaMetricsRequestedThrough.EthereumProvider,H=F?o.MetaMetricsEventCategory.MultichainApi:o.MetaMetricsEventCategory.InpageProvider;let q,G=B;var $;B===i.MESSAGE_TYPE.WALLET_INVOKE_METHOD&&(G=null==x||null===($=x.request)||void 0===$?void 0:$.method,q=null==x?void 0:x.scope);const W=_[G];let V;switch(W){case S.TIMEOUT:V=void 0!==b[G];break;case S.NON_RATE_LIMITED:V=!1;break;case S.BLOCKED:V=!0;break;default:case S.RANDOM_SAMPLE:V=Math.random()>=t}const Y=A>0&&I>=A,K=!0===P.state.participateInMetaMetrics,Q=T[G],z={api_source:U};let X;q&&(z.chain_id_caip=q);const J=(0,f.isSnapPreinstalled)(j),Z=j!==i.ORIGIN_METAMASK&&!J&&!V&&!Y&&!0===K;if(Z){var ee;const t=Q?Q.REQUESTED:o.MetaMetricsEventName.ProviderMethodCalled;if(t===o.MetaMetricsEventName.SignatureRequested){var te,ne,se,re,ae;let e;var ie,oe;if(z.signature_type=G,z.hd_entropy_index=M(),(0,a.isValidAddress)(null==O||null===(te=O.params)||void 0===te?void 0:te[1]))e=null==O||null===(ie=O.params)||void 0===ie?void 0:ie[0];else e=null==O||null===(oe=O.params)||void 0===oe?void 0:oe[1];null!==(ne=O.securityAlertResponse)&&void 0!==ne&&ne.providerRequestsCount&&Object.keys(O.securityAlertResponse.providerRequestsCount).forEach(e=>{z[`ppom_${e}_count`]=O.securityAlertResponse.providerRequestsCount[e]}),z.security_alert_response=(null===(se=O.securityAlertResponse)||void 0===se?void 0:se.result_type)??l.BlockaidResultType.NotApplicable,z.security_alert_reason=(null===(re=O.securityAlertResponse)||void 0===re?void 0:re.reason)??l.BlockaidReason.notApplicable,z.address_alert_response=u.ResultType.Loading,null!==(ae=O.securityAlertResponse)&&void 0!==ae&&ae.description&&(z.security_alert_description=O.securityAlertResponse.description);const t=await(0,g.getSnapAndHardwareInfoForMetrics)(v,k,C,N);Object.assign(z,t);try{if(G===i.MESSAGE_TYPE.PERSONAL_SIGN){const{isSIWEMessage:t}=(0,s.detectSIWE)({data:e});t&&(z.ui_customizations=[...z.ui_customizations||[],o.MetaMetricsEventUiCustomization.Siwe])}else if(G===i.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4){const t=(0,c.parseTypedDataMessage)(e);X={},z.eip712_primary_type=t.primaryType,X.eip712_verifyingContract=t.domain.verifyingContract,X.eip712_domain_version=t.domain.version,X.eip712_domain_name=t.domain.name,d.PRIMARY_TYPES_PERMIT.includes(t.primaryType)?z.ui_customizations=[...z.ui_customizations||[],o.MetaMetricsEventUiCustomization.Permit]:d.PRIMARY_TYPES_ORDER.includes(t.primaryType)&&(z.ui_customizations=[...z.ui_customizations||[],o.MetaMetricsEventUiCustomization.Order])}}catch(e){console.warn(`createRPCMethodTrackingMiddleware: Errored - ${e}`)}}else z.method=G;const r=y[G];if(r&&(z.params=r(x)),null===(ee=w[G])||void 0===ee||ee.call(w,O,undefined,E.REQUESTED,z),t===o.MetaMetricsEventName.SignatureRequested){!function(e,t,n,s){e.createEventFragment({category:s,initialEvent:o.MetaMetricsEventName.SignatureRequested,successEvent:o.MetaMetricsEventName.SignatureApproved,failureEvent:o.MetaMetricsEventName.SignatureRejected,uniqueIdentifier:(0,m.generateSignatureUniqueId)(t.id),persist:!0,referrer:{url:t.origin},...n})}(P,O,{properties:z,sensitiveProperties:X},H)}else P.trackEvent({event:t,category:H,referrer:{url:j},properties:z});W===S.TIMEOUT&&(b[G]=setTimeout(()=>{delete b[G]},e)),I+=1,setTimeout(()=>{I-=1},n)}L(async e=>{var t,n,s,a;if(!1===Z||void 0===Q)return e();const i=null===(t=D.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.location;let c,l;const u=(0,h.getErrorMessage)(D.error);if((null===(n=D.error)||void 0===n?void 0:n.code)===r.errorCodes.provider.userRejectedRequest?(c=Q.REJECTED,l=E.REJECTED):(null===(s=D.error)||void 0===s?void 0:s.code)===r.errorCodes.rpc.internal&&[u,D.error.message].includes("Request rejected by user or snap.")?(c=Q.REJECTED,l=E.REJECTED,z.status=u):(c=Q.APPROVED,l=E.APPROVED),!c)return e();if(null===(a=w[G])||void 0===a||a.call(w,O,D,l,z),Q.REQUESTED===o.MetaMetricsEventName.SignatureRequested){const e=await(0,g.getSnapAndHardwareInfoForMetrics)(v,k,C,N);Object.assign(z,e)}let d={};if(p.SIGNING_METHODS.includes(G)){var f;const e=R.getSignatureSecurityAlertResponse(null===(f=O.securityAlertResponse)||void 0===f?void 0:f.securityAlertId);d=(0,m.getBlockaidMetricsProps)({securityAlertResponse:e})}const S={...z,...d,location:i};if(delete S.address_alert_response,c===o.MetaMetricsEventName.SignatureRejected||c===o.MetaMetricsEventName.SignatureApproved){const e={abandoned:c===Q.REJECTED},t={properties:{...S,hd_entropy_index:M()},sensitiveProperties:X};!function(e,t,n,s){const r=(0,m.generateSignatureUniqueId)(t.id);e.updateEventFragment(r,s),e.finalizeEventFragment(r,n)}(P,O,e,t)}else P.trackEvent({event:c,category:H,referrer:{url:j},properties:S});return e()})}};var s=e("@metamask/controller-utils"),r=e("@metamask/rpc-errors"),a=e("ethereumjs-util"),i=e("../../../shared/constants/app"),o=e("../../../shared/constants/metametrics"),c=e("../../../shared/modules/transaction.utils"),l=e("../../../shared/constants/security-provider"),u=e("../../../shared/lib/trust-signals"),d=e("../../../shared/constants/signatures"),p=e("../../../shared/constants/transaction"),h=e("../../../shared/modules/error"),m=e("../../../ui/helpers/utils/metrics"),f=e("../../../shared/lib/snaps/snaps"),g=e("./snap-keyring/metrics");const S={TIMEOUT:"timeout",BLOCKED:"blocked",NON_RATE_LIMITED:"non_rate_limited",RANDOM_SAMPLE:"random_sample"},E={REQUESTED:"REQUESTED",APPROVED:"APPROVED",REJECTED:"REJECTED"},_={[i.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA]:S.NON_RATE_LIMITED,[i.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3]:S.NON_RATE_LIMITED,[i.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4]:S.NON_RATE_LIMITED,[i.MESSAGE_TYPE.PERSONAL_SIGN]:S.NON_RATE_LIMITED,[i.MESSAGE_TYPE.ETH_DECRYPT]:S.NON_RATE_LIMITED,[i.MESSAGE_TYPE.ETH_GET_ENCRYPTION_PUBLIC_KEY]:S.NON_RATE_LIMITED,[i.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN]:S.NON_RATE_LIMITED,[i.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN]:S.NON_RATE_LIMITED,[i.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS]:S.TIMEOUT,[i.MESSAGE_TYPE.WALLET_REQUEST_PERMISSIONS]:S.TIMEOUT,[i.MESSAGE_TYPE.WALLET_CREATE_SESSION]:S.NON_RATE_LIMITED,[i.MESSAGE_TYPE.SEND_METADATA]:S.BLOCKED,[i.MESSAGE_TYPE.ETH_CHAIN_ID]:S.BLOCKED,[i.MESSAGE_TYPE.ETH_ACCOUNTS]:S.BLOCKED,[i.MESSAGE_TYPE.LOG_WEB3_SHIM_USAGE]:S.BLOCKED,[i.MESSAGE_TYPE.GET_PROVIDER_STATE]:S.BLOCKED,[i.MESSAGE_TYPE.WALLET_GET_CALLS_STATUS]:S.NON_RATE_LIMITED,[i.MESSAGE_TYPE.WALLET_GET_CAPABILITIES]:S.NON_RATE_LIMITED,[i.MESSAGE_TYPE.WALLET_SEND_CALLS]:S.NON_RATE_LIMITED},T={[i.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA]:{APPROVED:o.MetaMetricsEventName.SignatureApproved,REJECTED:o.MetaMetricsEventName.SignatureRejected,REQUESTED:o.MetaMetricsEventName.SignatureRequested},[i.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3]:{APPROVED:o.MetaMetricsEventName.SignatureApproved,REJECTED:o.MetaMetricsEventName.SignatureRejected,REQUESTED:o.MetaMetricsEventName.SignatureRequested},[i.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4]:{APPROVED:o.MetaMetricsEventName.SignatureApproved,REJECTED:o.MetaMetricsEventName.SignatureRejected,REQUESTED:o.MetaMetricsEventName.SignatureRequested},[i.MESSAGE_TYPE.PERSONAL_SIGN]:{APPROVED:o.MetaMetricsEventName.SignatureApproved,REJECTED:o.MetaMetricsEventName.SignatureRejected,REQUESTED:o.MetaMetricsEventName.SignatureRequested},[i.MESSAGE_TYPE.ETH_DECRYPT]:{APPROVED:o.MetaMetricsEventName.DecryptionApproved,REJECTED:o.MetaMetricsEventName.DecryptionRejected,REQUESTED:o.MetaMetricsEventName.DecryptionRequested},[i.MESSAGE_TYPE.ETH_GET_ENCRYPTION_PUBLIC_KEY]:{APPROVED:o.MetaMetricsEventName.EncryptionPublicKeyApproved,REJECTED:o.MetaMetricsEventName.EncryptionPublicKeyRejected,REQUESTED:o.MetaMetricsEventName.EncryptionPublicKeyRequested},[i.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS]:{APPROVED:o.MetaMetricsEventName.PermissionsApproved,REJECTED:o.MetaMetricsEventName.PermissionsRejected,REQUESTED:o.MetaMetricsEventName.PermissionsRequested},[i.MESSAGE_TYPE.WALLET_REQUEST_PERMISSIONS]:{APPROVED:o.MetaMetricsEventName.PermissionsApproved,REJECTED:o.MetaMetricsEventName.PermissionsRejected,REQUESTED:o.MetaMetricsEventName.PermissionsRequested},[i.MESSAGE_TYPE.WALLET_CREATE_SESSION]:{APPROVED:o.MetaMetricsEventName.PermissionsApproved,REJECTED:o.MetaMetricsEventName.PermissionsRejected,REQUESTED:o.MetaMetricsEventName.PermissionsRequested},[i.MESSAGE_TYPE.WALLET_GET_CALLS_STATUS]:{REQUESTED:o.MetaMetricsEventName.Wallet5792Called},[i.MESSAGE_TYPE.WALLET_GET_CAPABILITIES]:{REQUESTED:o.MetaMetricsEventName.Wallet5792Called},[i.MESSAGE_TYPE.WALLET_SEND_CALLS]:{REQUESTED:o.MetaMetricsEventName.Wallet5792Called}},y={[i.MESSAGE_TYPE.WATCH_ASSET]:({type:e})=>({type:e}),[i.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN]:([{chainId:e}])=>({chainId:e}),[i.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN]:([{chainId:e}])=>({chainId:e})},w={[i.MESSAGE_TYPE.WALLET_SEND_CALLS]:function(e,t,n,s){var r;if(n!==E.REQUESTED)return;const{params:a}=e,i=null==a||null===(r=a[0])||void 0===r||null===(r=r.calls)||void 0===r?void 0:r.length;i&&(s.batch_transaction_count=i)},[i.MESSAGE_TYPE.WALLET_CREATE_SESSION]:function(e,t,n,s){if(n===E.REQUESTED){const{params:t}=e,n=(null==t?void 0:t.requiredScopes)||{},r=(null==t?void 0:t.optionalScopes)||{},a=new Set;for(const e of Object.keys(n))a.add(e);for(const e of Object.keys(r))a.add(e);s.chain_id_list=Array.from(a)}else if(n===E.APPROVED){const{result:e}=t,n=Object.keys((null==e?void 0:e.sessionScopes)||{});s.chain_id_list=n}}},b={};let I=0}}},{package:"$root$",file:"app/scripts/lib/createRPCMethodTrackingMiddleware.js"}],[278,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return function(t,n,s){t.tabId=e.tabId,s()}}}}},{package:"$root$",file:"app/scripts/lib/createTabIdMiddleware.js"}],[279,{"../../../shared/constants/app":5775,"../../../shared/lib/trace":5897},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){return async function(e,t,n){const{id:s,method:o}=e,c=a[o];c&&(e.traceContext=await(0,r.trace)({name:c,id:s,tags:i[o]}),await(0,r.trace)({name:r.TraceName.Middleware,id:s,parentContext:e.traceContext})),n()}};var s=e("../../../shared/constants/app"),r=e("../../../shared/lib/trace");const a={[s.MESSAGE_TYPE.ETH_SEND_TRANSACTION]:r.TraceName.Transaction,[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA]:r.TraceName.Signature,[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V1]:r.TraceName.Signature,[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3]:r.TraceName.Signature,[s.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4]:r.TraceName.Signature,[s.MESSAGE_TYPE.PERSONAL_SIGN]:r.TraceName.Signature},i={[s.MESSAGE_TYPE.ETH_SEND_TRANSACTION]:{source:"dapp"}}}}},{package:"$root$",file:"app/scripts/lib/createTracingMiddleware.ts"}],[28,{"../../../../shared/constants/metametrics":5791,"@metamask/assets-controllers":1292,"@metamask/bridge-controller":1369},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.NftControllerInit=void 0;var s=e("@metamask/assets-controllers"),r=e("@metamask/bridge-controller"),a=e("../../../../shared/constants/metametrics");n.NftControllerInit=({controllerMessenger:e,initMessenger:t,persistedState:n})=>({controller:new s.NftController({state:n.NftController,messenger:e,onNftAdded:({address:e,symbol:n,tokenId:s,standard:i,source:o})=>t.call("MetaMetricsController:trackEvent",{event:a.MetaMetricsEventName.NftAdded,category:a.MetaMetricsEventCategory.Wallet,sensitiveProperties:{token_contract_address:e,token_symbol:n??null,token_id:s,token_standard:i,asset_type:r.AssetType.NFT,source:o}})})})}}},{package:"$root$",file:"app/scripts/controller-init/assets/nft-controller-init.ts"}],[280,{"./dapp-swap-util":281},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createDappSwapMiddleware=function({fetchQuotes:e,setDappSwapComparisonData:t,getNetworkConfigurationByNetworkClientId:n,dappSwapMetricsFlag:r}){return async(a,i,o)=>{"eth_sendTransaction"!==a.method&&"wallet_sendCalls"!==a.method||(0,s.getQuotesForConfirmation)({req:a,fetchQuotes:e,setDappSwapComparisonData:t,getNetworkConfigurationByNetworkClientId:n,dappSwapMetricsFlag:r}),o()}};var s=e("./dapp-swap-util")}}},{package:"$root$",file:"app/scripts/lib/dapp-swap/dapp-swap-middleware.ts"}],[281,{"../../../../shared/lib/sentry":5890,"../../../../shared/modules/dapp-swap-comparison/dapp-swap-command-utils":5914,"../../../../shared/modules/dapp-swap-comparison/dapp-swap-comparison-utils":5915,loglevel:4846},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getQuotesForConfirmation=function({req:e,fetchQuotes:t,setDappSwapComparisonData:n,getNetworkConfigurationByNetworkClientId:s,dappSwapMetricsFlag:l}){let u="";const d=String(e.id);try{const{enabled:o,bridge_quote_fees:p,origins:h}=l;if(!o)return;const{params:m,origin:f}=e;if(f&&h.includes(f)){const{chainId:o}=s(e.networkClientId)??{},{data:l,from:h}=c(m);if(l&&d&&o){const e=(0,i.parseTransactionData)(l);u=e.commands;const{quotesInput:s,amountMin:c}=(0,i.getDataFromSwap)(o,e.commandBytes,e.inputs);if(s){(0,i.checkValidSingleOrBatchTransaction)(m[0].calls,null==s?void 0:s.srcTokenAddress),n(d,{commands:u,swapInfo:{srcTokenAddress:null==s?void 0:s.srcTokenAddress,destTokenAddress:null==s?void 0:s.destTokenAddress,srcTokenAmount:null==s?void 0:s.srcTokenAmount,destTokenAmountMin:c}});const e=(new Date).getTime();t({...s,walletAddress:h,fee:p}).then(t=>{const s=(new Date).getTime();t&&n(d,{quotes:t,latency:s-e})}).catch(e=>{n(d,{error:`Error fetching bridge quotes: ${e.message}`,commands:u}),r.default.error("Error fetching dapp swap quotes",e),(0,a.captureException)(e)})}}}}catch(e){d&&n(d,{error:`Error fetching bridge quotes: ${e.message}`,commands:u}),e instanceof o.DappSwapDecodingError||(0,a.captureException)(e)}};var s,r=(s=e("loglevel"))&&s.__esModule?s:{default:s},a=e("../../../../shared/lib/sentry"),i=e("../../../../shared/modules/dapp-swap-comparison/dapp-swap-comparison-utils"),o=e("../../../../shared/modules/dapp-swap-comparison/dapp-swap-command-utils");const c=e=>{if(null==e||!e.length)return{data:undefined,from:undefined,chainId:undefined};const{calls:t,chainId:n,data:s,from:r}=e[0];let a=s;if(null!=t&&t.length){const e=null==t?void 0:t.find(({data:e})=>null==e?void 0:e.startsWith("0x3593564c"));e&&(a=null==e?void 0:e.data)}return{chainId:n,data:a,from:r}}}}},{package:"$root$",file:"app/scripts/lib/dapp-swap/dapp-swap-util.ts"}],[282,{"../../../../shared/lib/deep-links/constants":5829,"../../../../shared/lib/deep-links/parse":5831,"../../../../shared/lib/deep-links/routes/route":5842,"../../../../shared/lib/deep-links/verify":5846,"../../../../shared/modules/mv3.utils":5925,events:4384,loglevel:4846,"webextension-polyfill":5763},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.DeepLinkRouter=void 0;var s=d(e("events")),r=d(e("webextension-polyfill")),a=d(e("loglevel")),i=e("../../../../shared/modules/mv3.utils"),o=e("../../../../shared/lib/deep-links/parse"),c=e("../../../../shared/lib/deep-links/constants"),l=e("../../../../shared/lib/deep-links/routes/route"),u=e("../../../../shared/lib/deep-links/verify");function d(e){return e&&e.__esModule?e:{default:e}}function p(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const h=l.DEEP_LINK_ROUTE.replace(/^\//u,"");class m extends s.default{constructor({getExtensionURL:e,getState:t}){super(),p(this,"getExtensionURL",void 0),p(this,"getState",void 0),p(this,"handleBeforeRequest",({tabId:e,url:t})=>e===r.default.tabs.TAB_ID_NONE?{}:this.tryNavigateTo(e,t)),this.getExtensionURL=e,this.getState=t}formatUrlForInterstitialPage(e){return e.pathname+e.search}get404ErrorURL(e){const t=new URLSearchParams({errorCode:"404"});return e&&t.set("u",this.formatUrlForInterstitialPage(e)),this.getExtensionURL(h,t.toString())}async redirectTab(e,t){try{await r.default.tabs.update(e,{url:t})}catch(e){a.default.error("Error redirecting tab:",e),this.emit("error",e)}}install(){r.default.webRequest.onBeforeRequest.addListener(this.handleBeforeRequest,{urls:[`*://*.${c.DEEP_LINK_HOST}/*`],types:["main_frame"]},i.isManifestV3?[]:["blocking"])}uninstall(){r.default.webRequest.onBeforeRequest.removeListener(this.handleBeforeRequest)}async tryNavigateTo(e,t){if(t.length>c.DEEP_LINK_MAX_LENGTH)return a.default.debug("Url is too long, skipping deep link handling"),{};let n;try{const e=new URL(t),s=await(0,o.parse)(e);if(s)if(this.emit("navigate",{url:e,parsed:s}),"redirectTo"in s.destination)n=s.destination.redirectTo.toString();else if(this.canSkipInterstitial(s.signature))n=this.getExtensionURL(s.destination.path,s.destination.query.toString());else{const t=new URLSearchParams({u:this.formatUrlForInterstitialPage(e)});n=this.getExtensionURL(h,t.toString())}else n=this.get404ErrorURL(e)}catch(e){a.default.error("Invalid URL:",t,e),this.emit("error",e),n=this.get404ErrorURL()}return this.redirectTab(e,n),i.isManifestV3?{}:{cancel:!0}}canSkipInterstitial(e){var t;return e===u.VALID&&Boolean(null===(t=this.getState().preferences)||void 0===t?void 0:t.skipDeepLinkInterstitial)}}n.DeepLinkRouter=m}}},{package:"$root$",file:"app/scripts/lib/deep-links/deep-link-router.ts"}],[283,{"../../../../shared/constants/metametrics":5791},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createEvent=function({signature:e,url:t}){const n={route:t.pathname,signature:e},a={};for(const[e,s]of t.searchParams.entries())"sig"!==e&&("attributionId"===e?n.attribution_id=s:r.has(e)?n[e]=s:a[e]=s);return{category:s.MetaMetricsEventCategory.DeepLink,event:s.MetaMetricsEventName.DeepLinkUsed,properties:n,sensitiveProperties:a}};var s=e("../../../../shared/constants/metametrics");const r=new Set(["utm_campaign","utm_content","utm_medium","utm_source","utm_term"])}}},{package:"$root$",file:"app/scripts/lib/deep-links/metrics.ts"}],[284,{"@metamask/browser-passworder":1417},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.encryptorFactory=void 0;var s=e("@metamask/browser-passworder");const r=e=>async(t,n,r,a)=>(0,s.encrypt)(t,n,r,a,{algorithm:"PBKDF2",params:{iterations:e}}),a=e=>async(t,n,r)=>(0,s.encryptWithDetail)(t,n,r,{algorithm:"PBKDF2",params:{iterations:e}}),i=e=>async(t,n,r,a)=>(0,s.keyFromPassword)(t,n,r,a??{algorithm:"PBKDF2",params:{iterations:e}}),o=e=>t=>(0,s.isVaultUpdated)(t,{algorithm:"PBKDF2",params:{iterations:e}});n.encryptorFactory=e=>({encrypt:r(e),encryptWithKey:s.encryptWithKey,encryptWithDetail:a(e),decrypt:s.decrypt,decryptWithKey:s.decryptWithKey,decryptWithDetail:s.decryptWithDetail,keyFromPassword:i(e),isVaultUpdated:o(e),importKey:s.importKey,exportKey:s.exportKey,generateSalt:s.generateSalt})}}},{package:"$root$",file:"app/scripts/lib/encryptor-factory.ts"}],[285,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=[{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"resolver",outputs:[{name:"",type:"address"}],payable:!1,type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"owner",outputs:[{name:"",type:"address"}],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"label",type:"bytes32"},{name:"owner",type:"address"}],name:"setSubnodeOwner",outputs:[],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"ttl",type:"uint64"}],name:"setTTL",outputs:[],payable:!1,type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"ttl",outputs:[{name:"",type:"uint64"}],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"resolver",type:"address"}],name:"setResolver",outputs:[],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"owner",type:"address"}],name:"setOwner",outputs:[],payable:!1,type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"owner",type:"address"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!0,name:"label",type:"bytes32"},{indexed:!1,name:"owner",type:"address"}],name:"NewOwner",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"resolver",type:"address"}],name:"NewResolver",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"ttl",type:"uint64"}],name:"NewTTL",type:"event"}]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/contracts/registry.js"}],[286,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=[{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"hash",type:"bytes32"}],name:"setContent",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"content",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"interfaceID",type:"bytes4"}],name:"supportsInterface",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"pure",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"key",type:"string"},{name:"value",type:"string"}],name:"setText",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"},{name:"contentTypes",type:"uint256"}],name:"ABI",outputs:[{name:"contentType",type:"uint256"},{name:"data",type:"bytes"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"x",type:"bytes32"},{name:"y",type:"bytes32"}],name:"setPubkey",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"hash",type:"bytes"}],name:"setContenthash",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"addr",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"},{name:"key",type:"string"}],name:"text",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"contentType",type:"uint256"},{name:"data",type:"bytes"}],name:"setABI",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"name",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"name",type:"string"}],name:"setName",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"contenthash",outputs:[{name:"",type:"bytes"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"pubkey",outputs:[{name:"x",type:"bytes32"},{name:"y",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"addr",type:"address"}],name:"setAddr",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{name:"ensAddr",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"a",type:"address"}],name:"AddrChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"name",type:"string"}],name:"NameChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!0,name:"contentType",type:"uint256"}],name:"ABIChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"x",type:"bytes32"},{indexed:!1,name:"y",type:"bytes32"}],name:"PubkeyChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"indexedKey",type:"string"},{indexed:!1,name:"key",type:"string"}],name:"TextChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"hash",type:"bytes"}],name:"ContenthashChanged",type:"event"}]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/contracts/resolver.js"}],[287,{"./contracts/registry":285,"./contracts/resolver":286,"@ensdomains/content-hash":658,"@ethersproject/contracts":746,"@ethersproject/providers":784,"eth-ens-namehash":4288},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=async function({provider:e,name:t}){const n=s.default.hash(t),l=Number.parseInt(await e.request({method:"net_version"}),10),d=function(e){switch(e){case 1:case 3:case 4:case 5:case 6:return"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e";default:return null}}(l);if(!d)throw new Error(`EnsIpfsResolver - no known ens-ipfs registry for chainId "${l}"`);const p=new a.Web3Provider(e),h=new i.Contract(d,o.default,p),m=await h.resolver(n);if(u(m))throw new Error(`EnsIpfsResolver - no resolver found for name "${t}"`);const f=new i.Contract(m,c.default,p),g=await f.supportsInterface("0xbc1c58d1"),S=await f.supportsInterface("0xd8389dc5");if(g){const e=await f.contenthash(n);let t=r.default.decode(e);const s=r.default.getCodec(e);return"ipfs-ns"!==s&&"ipns-ns"!==s||(t=r.default.helpers.cidV0ToV1Base32(t)),{type:s,hash:t}}if(S){const e=await f.content(n);if(u(e))throw new Error(`EnsIpfsResolver - no content ID found for name "${t}"`);return{type:"swarm-ns",hash:e.slice(2)}}throw new Error(`EnsIpfsResolver - the resolver for name "${t}" is not standard, it should either supports contenthash() or content()`)};var s=l(e("eth-ens-namehash")),r=l(e("@ensdomains/content-hash")),a=e("@ethersproject/providers"),i=e("@ethersproject/contracts"),o=l(e("./contracts/registry")),c=l(e("./contracts/resolver"));function l(e){return e&&e.__esModule?e:{default:e}}function u(e){return[undefined,null,"0x","0x0","0x0000000000000000000000000000000000000000000000000000000000000000"].includes(e)}}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/resolver.js"}],[288,{"../../../../shared/modules/fetch-with-timeout":5920,"./resolver":287,"base32-encode":3969,"base64-js":3970,"webextension-polyfill":5763},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function({provider:e,getCurrentChainId:t,getIpfsGateway:n,getUseAddressBarEnsResolution:i}){const c=u.map(e=>`*://*.${e}/*`);return a.default.webRequest.onErrorOccurred.addListener(d,{urls:c,types:["main_frame"]}),{remove(){a.default.webRequest.onErrorOccurred.removeListener(d)}};async function d(c){const{tabId:d,url:p}=c;if(-1===d||"0x1"!==t())return;const{hostname:h,pathname:m,search:f,hash:g}=new URL(p),S=h.split("."),E=S[S.length-1];u.includes(E)&&async function({tabId:t,name:c,pathname:u,search:d,fragment:p}){const h=n(),m=i(),f=`https://app.ens.domains/name/${c}`;m&&h&&await a.default.tabs.update(t,{url:"loading.html"});let g=f;0;try{const{type:t,hash:n}=await(0,o.default)({provider:e,name:c});if("ipfs-ns"===t||"ipns-ns"===t){if(""===h)return void(g=null);const e=`https://${n}.${t.slice(0,4)}.${h}${u}${d||""}${p||""}`;try{200===(await l(e,{method:"HEAD"})).status&&(g=e)}catch(e){console.warn(e)}}else if("swarm-ns"===t)g=`https://swarm-gateways.net/bzz:/${n}${u}${d||""}${p||""}`;else if("onion"===t||"onion3"===t)g=`http://${n}.onion${u}${d||""}${p||""}`;else if("zeronet"===t)g=`http://127.0.0.1:43110/${n}${u}${d||""}${p||""}`;else if("skynet-ns"===t){const e=n.padEnd(n.length+4-n.length%4,"="),t=r.default.toByteArray(e),a={padding:!1};g=`https://${(0,s.default)(t,"RFC4648-HEX",a).toLowerCase()}.siasky.net${u}${d||""}${p||""}`}}catch(e){console.warn(e)}finally{g&&(m||!m&&g!==f)&&await a.default.tabs.update(t,{url:g})}}({tabId:d,name:h,pathname:m,search:f,fragment:g})}};var s=c(e("base32-encode")),r=c(e("base64-js")),a=c(e("webextension-polyfill")),i=c(e("../../../../shared/modules/fetch-with-timeout")),o=c(e("./resolver"));function c(e){return e&&e.__esModule?e:{default:e}}const l=(0,i.default)(),u=["eth"]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/setup.js"}],[289,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(e,t){return e.get(i(e,t))}function i(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.ExtensionLazyListener=void 0;var o=new WeakMap,c=new WeakMap,l=new WeakSet;function u(e){setTimeout(()=>{for(const[t,n]of a(c,this))for(const[s,{args:r}]of n){const n=`ExtensionLazyListener: Possible memory leak detected. The event "${t}.${s}" has been listened to, but no application code has added a listener after ${e}ms. There are currently ${r.length} buffered calls. If you are a developer of this extension, please ensure that you have added a listener for this event. If you are a user of this extension, please report this warning to the developers of the extension.`;console.warn(n)}},e)}function d(e,t){return a(o,this)[e][t]}n.ExtensionLazyListener=class{constructor(e,t={},n=2e4){var p,h;r(p=this,h=l),h.add(p),s(this,o,void 0),s(this,c,new Map),function(e,t,n){e.set(i(e,t),n)}(o,this,e);for(const[e,n]of Object.entries(t)){const t=new Map;for(const s of n){const n=[],r=(...e)=>{n.push(e)};i(l,this,d).call(this,e,s).addListener(r),t.set(s,{listener:r,args:n})}a(c,this).set(e,t)}i(l,this,u).call(this,n)}addListener(e,t,n){const s=i(l,this,d).call(this,e,t);s.addListener(n);const r=a(c,this).get(e);if(r){const i=r.get(t);if(i){s.removeListener(i.listener),r.delete(t),0===r.size&&a(c,this).delete(e);const{args:o}=i;for(let l=0,{length:u}=o;l<u;l++)try{if(n(...o[l]),!s.hasListener(n)){const n=l+1;n!==u&&(o.splice(0,n),r.set(t,i),a(c,this).set(e,r),s.addListener(i.listener));break}}catch(n){const d=l+1;throw d!==u&&(o.splice(0,d),r.set(t,i),a(c,this).set(e,r),s.addListener(i.listener)),n}}}}once(e,t){return new Promise(n=>{const s=i(l,this,d).call(this,e,t),r=a(c,this).get(e);if(r){const i=r.get(t),o=null==i?void 0:i.args.length;if(o)return n(i.args.shift()),s.removeListener(i.listener),void(1===o&&(r.delete(t),0===r.size&&a(c,this).delete(e)))}const o=(...e)=>{s.removeListener(o),n(e)};s.addListener(o)})}}}}},{package:"$root$",file:"app/scripts/lib/extension-lazy-listener/extension-lazy-listener.ts"}],[29,{"@metamask/assets-controllers":1292},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.NftDetectionControllerInit=void 0;var s=e("@metamask/assets-controllers");n.NftDetectionControllerInit=e=>{const{controllerMessenger:t,getController:n}=e,r=()=>n("NftController");return{controller:new s.NftDetectionController({messenger:t,addNfts:(...e)=>r().addNfts(...e),getNftState:()=>r().state,disabled:!n("PreferencesController").state.useNftDetection}),persistedStateKey:null}}}}},{package:"$root$",file:"app/scripts/controller-init/assets/nft-detection-controller-init.ts"}],[290,{"@metamask/snaps-sdk":2786,"@metamask/snaps-utils":2903},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.forwardRequestToSnap=async function(e,t,n,a){const{method:i,params:o}=n,{handleRequest:c,snapId:l,onBeforeRequest:u,onAfterRequest:d}=e;if(!l)throw new r.InternalError(`No snapId configured for method ${i}`);const p=a.get("origin");if(!p)throw new r.InternalError(`No origin specified for method ${i}`);try{null==u||u()}catch(e){try{null==d||d()}catch(e){console.error("Error from onAfterRequest hook:",e)}throw e}let h;try{h=await c({snapId:l,origin:p,handler:s.HandlerType.OnRpcRequest,request:{jsonrpc:"2.0",method:i,params:o}})}catch(e){try{null==d||d()}catch(e){console.error("Error from onAfterRequest hook:",e)}throw e}return null==d||d(),h};var s=e("@metamask/snaps-utils"),r=e("@metamask/snaps-sdk")}}},{package:"$root$",file:"app/scripts/lib/forwardRequestToSnap.ts"}],[291,{lodash:4838},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e){return r((0,s.cloneDeep)(e),e=>null===e?"null":typeof e)};var s=e("lodash");function r(e={},t){return Object.entries(e).forEach(([n,s])=>{e[n]="object"==typeof s&&null!==s?r(s,t):t(s)}),e}}}},{package:"$root$",file:"app/scripts/lib/getObjStructure.js"}],[292,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.hardwareKeyringBuilderFactory=function(e,t){const n=()=>new e({bridge:new t});return n.type=e.type,n}}}},{package:"$root$",file:"app/scripts/lib/hardware-keyring-builder-factory.ts"}],[2924,{"./types.cjs":2927},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},a=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.InMemoryStorageAdapter=void 0;const i=e("./types.cjs");n.InMemoryStorageAdapter=class{constructor(){s.set(this,void 0),r(this,s,new Map,"f")}async getItem(e,t){const n=`${i.STORAGE_KEY_PREFIX}${e}:${t}`,r=a(this,s,"f").get(n);if(r===undefined)return{};try{return{result:JSON.parse(r)}}catch(e){return console.error(`Failed to parse stored data for ${n}:`,e),{error:e}}}async setItem(e,t,n){const r=`${i.STORAGE_KEY_PREFIX}${e}:${t}`;a(this,s,"f").set(r,JSON.stringify(n))}async removeItem(e,t){const n=`${i.STORAGE_KEY_PREFIX}${e}:${t}`;a(this,s,"f").delete(n)}async getAllKeys(e){const t=`${i.STORAGE_KEY_PREFIX}${e}:`;return Array.from(a(this,s,"f").keys()).filter(e=>e.startsWith(t)).map(e=>e.slice(t.length))}async clear(e){const t=`${i.STORAGE_KEY_PREFIX}${e}:`;Array.from(a(this,s,"f").keys()).filter(e=>e.startsWith(t)).forEach(e=>a(this,s,"f").delete(e))}},s=new WeakMap}}},{package:"@metamask/storage-service",file:"node_modules/@metamask/storage-service/dist/InMemoryStorageAdapter.cjs"}],[2925,{"./InMemoryStorageAdapter.cjs":2924,"./types.cjs":2927},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,a=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},i=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.StorageService=void 0;const o=e("./InMemoryStorageAdapter.cjs"),c=e("./types.cjs"),l=["setItem","getItem","removeItem","getAllKeys","clear"];n.StorageService=class{constructor({messenger:e,storage:t}){s.set(this,void 0),r.set(this,void 0),this.name=c.SERVICE_NAME,a(this,s,e,"f"),a(this,r,t??new o.InMemoryStorageAdapter,"f"),t||console.warn(`${c.SERVICE_NAME}: No storage adapter provided. Using in-memory storage. Data will be lost on restart. Provide a storage adapter for persistence.`),i(this,s,"f").registerMethodActionHandlers(this,l)}async setItem(e,t,n){await i(this,r,"f").setItem(e,t,n),i(this,s,"f").publish(`${c.SERVICE_NAME}:itemSet:${e}`,t,n)}async getItem(e,t){return await i(this,r,"f").getItem(e,t)}async removeItem(e,t){await i(this,r,"f").removeItem(e,t)}async getAllKeys(e){return await i(this,r,"f").getAllKeys(e)}async clear(e){await i(this,r,"f").clear(e)}},s=new WeakMap,r=new WeakMap}}},{package:"@metamask/storage-service",file:"node_modules/@metamask/storage-service/dist/StorageService.cjs"}],[2926,{"./InMemoryStorageAdapter.cjs":2924,"./StorageService.cjs":2925,"./types.cjs":2927},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.STORAGE_KEY_PREFIX=n.SERVICE_NAME=n.InMemoryStorageAdapter=n.StorageService=void 0;var s=e("./StorageService.cjs");Object.defineProperty(n,"StorageService",{enumerable:!0,get:function(){return s.StorageService}});var r=e("./InMemoryStorageAdapter.cjs");Object.defineProperty(n,"InMemoryStorageAdapter",{enumerable:!0,get:function(){return r.InMemoryStorageAdapter}});var a=e("./types.cjs");Object.defineProperty(n,"SERVICE_NAME",{enumerable:!0,get:function(){return a.SERVICE_NAME}}),Object.defineProperty(n,"STORAGE_KEY_PREFIX",{enumerable:!0,get:function(){return a.STORAGE_KEY_PREFIX}})}}},{package:"@metamask/storage-service",file:"node_modules/@metamask/storage-service/dist/index.cjs"}],[2927,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.STORAGE_KEY_PREFIX=n.SERVICE_NAME=void 0,n.SERVICE_NAME="StorageService",n.STORAGE_KEY_PREFIX="storageService:"}}},{package:"@metamask/storage-service",file:"node_modules/@metamask/storage-service/dist/types.cjs"}],[293,{"../../../shared/lib/sentry":5890,"@metamask/messenger":2258},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getRootMessenger=n.ROOT_MESSENGER_NAMESPACE=void 0;var s=e("@metamask/messenger"),r=e("../../../shared/lib/sentry");const a=n.ROOT_MESSENGER_NAMESPACE="Root";n.getRootMessenger=()=>new s.Messenger({namespace:a,captureException:r.captureException})}}},{package:"$root$",file:"app/scripts/lib/messenger.ts"}],[295,{"../util":372},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createPendingNonceMiddleware=function({getPendingNonce:e}){return async({request:t,context:n,next:s})=>{const{method:r,params:a}=t;if("eth_getTransactionCount"!==r)return s();const[i,o]=a;return"pending"!==o?s():await e(i,n.get("networkClientId"))}},n.createPendingTxMiddleware=function({getPendingTransactionByHash:e}){return async({request:t,next:n})=>{const{method:r,params:a}=t;if("eth_getTransactionByHash"!==r)return n();const[i]=a,o=e(i);return o?(0,s.formatTxMetaForRpcResult)(o):n()}};var s=e("../util")}}},{package:"$root$",file:"app/scripts/lib/middleware/pending.ts"}],[296,{"../stores/persistence-manager":349,"@metamask/utils":3116,events:4384,loglevel:4846},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=o(e("events")),r=o(e("loglevel")),a=e("@metamask/utils"),i=e("../stores/persistence-manager");function o(e){return e&&e.__esModule?e:{default:e}}class c extends s.default{constructor(e={}){super();const t=e.migrations||[];this.migrations=t.sort((e,t)=>e.version-t.version);const n=this.migrations.slice(-1)[0];this.defaultVersion=e.defaultVersion||n&&n.version||0}async migrateData(e=this.generateInitialState()){const t=(0,a.isObject)(e.data)&&e.meta.version<186?new Set(Object.keys(e.data)):new Set;let n=e;for(const e of this.migrations)if(i(e))try{let s;if(r.default.info(`Running migration ${e.version}...`),e.version<186)s=await e.migrate(n),o(s,e);else{s=structuredClone(n);const a=new Set,i=await e.migrate(s,a);if(o(s,e),void 0!==i)throw new Error("Migrator - migration returned value when none expected");if(0===a.size)r.default.debug(`Migrator - migration ${e.version} did not report any changes`);else for(const e of a)t.add(e)}n=s,r.default.info(`Migration ${e.version} complete`)}catch(t){const n=t.message;t.message=`MetaMask Migration Error #${e.version}: ${n}`,this.emit("error",t);break}const s=e.meta.version<186&&(0,a.isObject)(n.data)?new Set(Object.keys(n.data)):new Set;for(const e of t)s.add(e);return{state:n,changedKeys:s};function i(e){return e.version>n.meta.version}function o(e,t){if(!e.data)throw new Error("Migrator - migration returned empty data");if(e.version!==undefined&&e.meta.version!==t.version)throw new Error("Migrator - Migration did not update version number correctly")}}generateInitialState(e){return{data:e,meta:{storageKind:i.PersistenceManager.defaultStorageKind,version:this.defaultVersion}}}}n.default=c}}},{package:"$root$",file:"app/scripts/lib/migrator/index.js"}],[298,{"../../../../shared/constants/metametrics":5791,"../../../../shared/lib/network-utils":5886,"../../../../shared/lib/only-keep-host":5887,"./utils":299,"@metamask/utils":3116,loglevel:4846},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.onRpcEndpointDegraded=function({chainId:e,endpointUrl:t,error:n,infuraProjectId:s,metaMetricsId:r,trackEvent:a}){u(i.MetaMetricsEventName.RpcServiceDegraded,{chainId:e,endpointUrl:t,error:n,infuraProjectId:s,metaMetricsId:r,trackEvent:a})},n.onRpcEndpointUnavailable=function({chainId:e,endpointUrl:t,error:n,infuraProjectId:s,metaMetricsId:r,trackEvent:a}){u(i.MetaMetricsEventName.RpcServiceUnavailable,{chainId:e,endpointUrl:t,error:n,infuraProjectId:s,metaMetricsId:r,trackEvent:a})},n.trackRpcEndpointEvent=u;var s,r=(s=e("loglevel"))&&s.__esModule?s:{default:s},a=e("@metamask/utils"),i=e("../../../../shared/constants/metametrics"),o=e("../../../../shared/lib/only-keep-host"),c=e("../../../../shared/lib/network-utils"),l=e("./utils");function u(e,{chainId:t,endpointUrl:n,error:s,infuraProjectId:u,trackEvent:d,metaMetricsId:p}){if(!(0,l.shouldCreateRpcServiceEvents)({error:s,metaMetricsId:p}))return;const h=(0,c.isPublicEndpointUrl)(n,u)?(0,o.onlyKeepHost)(n):"custom",m={chain_id_caip:`eip155:${(0,a.hexToNumber)(t)}`,rpc_domain:h,rpc_endpoint_url:h,...(0,a.isObject)(s)&&"httpStatus"in s&&(0,a.isValidJson)(s.httpStatus)?{http_status:s.httpStatus}:{}};r.default.debug(`Creating Segment event "${e}" with ${JSON.stringify(m)}`),d({category:i.MetaMetricsEventCategory.Network,event:e,properties:m})}}}},{package:"$root$",file:"app/scripts/lib/network-controller/messenger-action-handlers.ts"}],[299,{"../../../../development/build/constants":610,"@metamask/network-controller":2319,"@metamask/remote-feature-flag-controller":2592},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.PRODUCTION_LIKE_ENVIRONMENTS=void 0,n.shouldCreateRpcServiceEvents=function({error:e,metaMetricsId:t}){return(!e||!(0,s.isConnectionError)(e))&&t!==undefined&&null!==t&&function(e){if("production"===undefined)return!1;if(o.includes("production"))return(0,r.generateDeterministicRandomNumber)(e)<i;return!0}(t)};var s=e("@metamask/network-controller"),r=e("@metamask/remote-feature-flag-controller"),a=e("../../../../development/build/constants");const i=.01,o=n.PRODUCTION_LIKE_ENVIRONMENTS=[a.ENVIRONMENT.PRODUCTION,a.ENVIRONMENT.RELEASE_CANDIDATE]}}},{package:"$root$",file:"app/scripts/lib/network-controller/utils.ts"}],[30,{"../../lib/util":372,"@metamask/assets-controllers":1292},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TokenRatesControllerInit=void 0;var s=e("@metamask/assets-controllers"),r=e("../../lib/util");n.TokenRatesControllerInit=e=>{const{controllerMessenger:t,initMessenger:n,persistedState:a}=e,i=n.call("PreferencesController:getState"),o=new s.TokenRatesController({messenger:t,state:a.TokenRatesController,tokenPricesService:new s.CodefiTokenPricesServiceV2,disabled:!i.useCurrencyRateCheck});return n.subscribe("PreferencesController:stateChange",(0,r.previousValueComparator)((e,t)=>{const{useCurrencyRateCheck:n}=e,{useCurrencyRateCheck:s}=t;return s&&!n?o.enable():!s&&n&&o.disable(),!0},i)),{controller:o}}}}},{package:"$root$",file:"app/scripts/controller-init/assets/token-rates-controller-init.ts"}],[300,{"../../../shared/constants/notifications":5796,"../platforms/extension":595,"@metamask/safe-event-emitter":2602},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.NOTIFICATION_MANAGER_EVENTS=void 0;var s=i(e("@metamask/safe-event-emitter")),r=i(e("../platforms/extension")),a=e("../../../shared/constants/notifications");function i(e){return e&&e.__esModule?e:{default:e}}const o=n.NOTIFICATION_MANAGER_EVENTS={POPUP_CLOSED:"onPopupClosed"};class c extends s.default{constructor(){super(),this.platform=new r.default,this.platform.addOnRemovedListener(this._onWindowClosed.bind(this))}markAsAutomaticallyClosed(){this._popupAutomaticallyClosed=!0}async showPopup(e,t){this._popupId=t,this._setCurrentPopupId=e;const n=await this._getPopup(t);if(n)await this.platform.focusWindow(n.id);else{let e=0,t=0;try{const n=await this.platform.getLastFocusedWindow();t=n.top,e=Math.max(n.left+(n.width-a.NOTIFICATION_WIDTH),0)}catch(n){const{screenX:s,screenY:r,outerWidth:i}=window;t=Math.max(r,0),e=Math.max(s+(i-a.NOTIFICATION_WIDTH),0)}const n=await this.platform.openWindow({url:"notification.html",type:"popup",width:a.NOTIFICATION_WIDTH,height:a.NOTIFICATION_HEIGHT,left:e,top:t});n.left!==e&&"fullscreen"!==n.state&&await this.platform.updateWindowPosition(n.id,e,t),this._setCurrentPopupId(n.id),this._popupId=n.id}}_onWindowClosed(e){e===this._popupId&&(this._setCurrentPopupId(undefined),this._popupId=undefined,this.emit(o.POPUP_CLOSED,{automaticallyClosed:this._popupAutomaticallyClosed}),this._popupAutomaticallyClosed=undefined)}async _getPopup(){const e=await this.platform.getAllWindows();return this._getPopupIn(e)}_getPopupIn(e){return e?e.find(e=>e&&"popup"===e.type&&e.id===this._popupId):null}}n.default=c}}},{package:"$root$",file:"app/scripts/lib/notification-manager.js"}],[301,{"../../../../shared/constants/offscreen-communication":5797,"eth-lattice-keyring":4289},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.LatticeKeyringOffscreen=void 0;var s,r=(s=e("eth-lattice-keyring"))&&s.__esModule?s:{default:s},a=e("../../../../shared/constants/offscreen-communication");class i extends r.default{constructor(e={}){super(e)}async _getCreds(){try{if(this._hasCreds())return undefined;const e=this.appName?this.appName:"Unknown",t=`${a.KnownOrigins.lattice}?keyring=${e}&forceLogin=true`,n=await new Promise((e,n)=>{chrome.runtime.sendMessage({target:a.OffscreenCommunicationTarget.latticeOffscreen,params:{url:t}},t=>{chrome.runtime.lastError?n(chrome.runtime.lastError):null!=t&&t.error?n(t.error):e(null==t?void 0:t.result)})});if(null==n||!n.deviceID||null==n||!n.password)throw new Error("Invalid credentials returned from Lattice.");return n}catch(e){throw new Error(e)}}}n.LatticeKeyringOffscreen=i,function(e,t,n){(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(i,"type",void 0),i.type=r.default.type}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/lattice-offscreen-keyring.ts"}],[302,{"../../../../shared/constants/offscreen-communication":5797,"@ledgerhq/errors":953},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.LedgerOffscreenBridge=void 0;var s=e("@ledgerhq/errors"),r=e("../../../../shared/constants/offscreen-communication");function a(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}const c=4e3;var l=new WeakSet;async function u(e,{timeout:t}={}){return new Promise((n,a)=>{let i;t&&(i=setTimeout(()=>{a(new Error("Ledger iframe timeout"))},t)),chrome.runtime.sendMessage({...e,target:r.OffscreenCommunicationTarget.ledgerOffscreen},e=>{if(clearTimeout(i),null!=e&&e.success)n(e.payload||e.success);else{var t;const n=null==e||null===(t=e.payload)||void 0===t?void 0:t.error;if(n&&"number"==typeof n.statusCode&&n.statusCode>0){const e=new s.TransportStatusError(n.statusCode);a(e)}else if(null!=n&&n.message){const e=new Error(n.message,{cause:n});a(e)}else a(new Error("Unknown Ledger error occurred"))}})})}n.LedgerOffscreenBridge=class{constructor(){a(this,l),i(this,"isDeviceConnected",!1)}init(){return chrome.runtime.onMessage.addListener(e=>{e.target===r.OffscreenCommunicationTarget.extension&&e.event===r.OffscreenCommunicationEvents.ledgerDeviceConnect&&(this.isDeviceConnected=!0)}),Promise.resolve()}destroy(){return Promise.resolve()}getOptions(){return Promise.resolve({})}setOptions(){return Promise.resolve()}attemptMakeApp(){return o(l,this,u).call(this,{action:r.LedgerAction.makeApp},{timeout:c})}updateTransportMethod(e){return o(l,this,u).call(this,{action:r.LedgerAction.updateTransport,params:{transportType:e}},{timeout:c})}getAppNameAndVersion(){return o(l,this,u).call(this,{action:r.LedgerAction.getAppNameAndVersion},{timeout:c})}getPublicKey(e){return o(l,this,u).call(this,{action:r.LedgerAction.getPublicKey,params:e})}deviceSignTransaction(e){return o(l,this,u).call(this,{action:r.LedgerAction.signTransaction,params:e})}deviceSignMessage(e){return o(l,this,u).call(this,{action:r.LedgerAction.signPersonalMessage,params:e})}deviceSignTypedData(e){return o(l,this,u).call(this,{action:r.LedgerAction.signTypedData,params:e})}}}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/ledger-offscreen-bridge.ts"}],[3022,{"./actions/update-payment-token.cjs":3023,"./constants.cjs":3024,"./helpers/QuoteRefresher.cjs":3025,"./utils/quotes.cjs":3039,"./utils/source-amounts.cjs":3041,"./utils/transaction.cjs":3045,"@metamask/base-controller":1362,lodash:4838},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,a,i,o,c,l=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},u=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPayController=void 0;const d=e("@metamask/base-controller"),p=e("lodash"),h=e("./actions/update-payment-token.cjs"),m=e("./constants.cjs"),f=e("./helpers/QuoteRefresher.cjs"),g=e("./utils/quotes.cjs"),S=e("./utils/source-amounts.cjs"),E=e("./utils/transaction.cjs"),_={transactionData:{includeInDebugSnapshot:!1,includeInStateLogs:!0,persist:!1,usedInUi:!0}};class T extends d.BaseController{constructor({getDelegationTransaction:e,getStrategy:t,messenger:n,state:d}){super({name:m.CONTROLLER_NAME,metadata:_,messenger:n,state:{transactionData:{},...d}}),s.add(this),r.set(this,void 0),a.set(this,void 0),l(this,r,e,"f"),l(this,a,t,"f"),u(this,s,"m",c).call(this),(0,E.pollTransactionChanges)(n,u(this,s,"m",o).bind(this),u(this,s,"m",i).bind(this)),new f.QuoteRefresher({messenger:n,updateTransactionData:u(this,s,"m",o).bind(this)})}updatePaymentToken(e){(0,h.updatePaymentToken)(e,{messenger:this.messenger,updateTransactionData:u(this,s,"m",o).bind(this)})}}n.TransactionPayController=T,r=new WeakMap,a=new WeakMap,s=new WeakSet,i=function(e){this.update(t=>{delete t.transactionData[e]})},o=function e(t,n){let r=!1;this.update(e=>{const{transactionData:s}=e;let a=s[t];const i=a?.paymentToken,o=a?.tokens;a||(s[t]={isLoading:!1,tokens:[]},a=s[t]),n(a);const c=a.paymentToken!==i,l=a.tokens!==o;(c||l)&&((0,S.updateSourceAmounts)(t,a,this.messenger),r=!0)}),r&&(0,g.updateQuotes)({messenger:this.messenger,transactionData:this.state.transactionData[t],transactionId:t,updateTransactionData:u(this,s,"m",e).bind(this)}).catch(p.noop)},c=function(){this.messenger.registerActionHandler("TransactionPayController:getDelegationTransaction",u(this,r,"f").bind(this)),this.messenger.registerActionHandler("TransactionPayController:getStrategy",u(this,a,"f")??(()=>m.TransactionPayStrategy.Relay)),this.messenger.registerActionHandler("TransactionPayController:updatePaymentToken",this.updatePaymentToken.bind(this))}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/TransactionPayController.cjs"}],[3023,{"../logger.cjs":3028,"../utils/token.cjs":3043,"../utils/transaction.cjs":3045,"@metamask/utils":3116,"bignumber.js":3087},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.updatePaymentToken=void 0;const s=e("@metamask/utils"),r=e("bignumber.js"),a=e("../logger.cjs"),i=e("../utils/token.cjs"),o=e("../utils/transaction.cjs"),c=(0,s.createModuleLogger)(a.projectLogger,"update-payment-token");n.updatePaymentToken=function(e,t){const{transactionId:n,tokenAddress:s,chainId:a}=e,{messenger:l,updateTransactionData:u}=t,d=(0,o.getTransaction)(n,l);if(!d)throw new Error("Transaction not found");const p=function({chainId:e,from:t,messenger:n,tokenAddress:s}){const{decimals:a,symbol:o}=(0,i.getTokenInfo)(n,s,e)??{};if(a===undefined||!o)return undefined;const c=(0,i.getTokenFiatRate)(n,s,e);if(c===undefined)return undefined;const l=(0,i.getTokenBalance)(n,t,e,s),u=new r.BigNumber(l),d=new r.BigNumber(l).shiftedBy(-a),p=u.toFixed(0),h=d.toString(10),m=d.multipliedBy(c.fiatRate).toString(10),f=d.multipliedBy(c.usdRate).toString(10);return{address:s,balanceFiat:m,balanceHuman:h,balanceRaw:p,balanceUsd:f,chainId:e,decimals:a,symbol:o}}({chainId:a,from:d?.txParams.from,messenger:l,tokenAddress:s});if(!p)throw new Error("Payment token not found");c("Updated payment token",{transactionId:n,paymentToken:p}),u(n,e=>{e.paymentToken=p})}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/actions/update-payment-token.cjs"}],[3024,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s;Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPayStrategy=n.POLYGON_USDCE_ADDRESS=n.ARBITRUM_USDC_ADDRESS=n.NATIVE_TOKEN_ADDRESS=n.CHAIN_ID_POLYGON=n.CHAIN_ID_ARBITRUM=n.CONTROLLER_NAME=void 0,n.CONTROLLER_NAME="TransactionPayController",n.CHAIN_ID_ARBITRUM="0xa4b1",n.CHAIN_ID_POLYGON="0x89",n.NATIVE_TOKEN_ADDRESS="0x0000000000000000000000000000000000000000",n.ARBITRUM_USDC_ADDRESS="0xaf88d065e77c8cC2239327C5EDb3A432268e5831",n.POLYGON_USDCE_ADDRESS="0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174",function(e){e.Bridge="bridge",e.Relay="relay",e.Test="test"}(s||(n.TransactionPayStrategy=s={}))}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/constants.cjs"}],[3025,{"../logger.cjs":3028,"../utils/quotes.cjs":3039,"@metamask/utils":3116,lodash:4838},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,a,i,o,c,l,u,d,p,h,m=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},f=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.QuoteRefresher=void 0;const g=e("@metamask/utils"),S=e("lodash"),E=e("../logger.cjs"),_=e("../utils/quotes.cjs"),T=(0,g.createModuleLogger)(E.projectLogger,"quote-refresh");n.QuoteRefresher=class{constructor({messenger:e,updateTransactionData:t}){s.add(this),r.set(this,void 0),a.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),m(this,i,e,"f"),m(this,r,!1,"f"),m(this,a,!1,"f"),m(this,c,t,"f"),e.subscribe("TransactionPayController:stateChange",f(this,s,"m",h).bind(this))}},r=new WeakMap,a=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,s=new WeakSet,l=function(){m(this,r,!0,"f"),T("Started"),f(this,a,"f")||f(this,s,"m",p).call(this)},u=function(){f(this,o,"f")&&clearTimeout(f(this,o,"f")),m(this,r,!1,"f"),T("Stopped")},d=async function(){m(this,a,!0,"f");try{await(0,_.refreshQuotes)(f(this,i,"f"),f(this,c,"f"))}catch(e){T("Error refreshing quotes",e)}finally{m(this,a,!1,"f"),f(this,s,"m",p).call(this)}},p=function(){f(this,r,"f")&&(f(this,o,"f")&&clearTimeout(f(this,o,"f")),m(this,o,setTimeout(()=>{f(this,s,"m",d).call(this).catch(S.noop)},1e3),"f"))},h=function(e){const t=Object.values(e.transactionData).some(e=>Boolean(e.quotes?.length));t&&!f(this,r,"f")?f(this,s,"m",l).call(this):!t&&f(this,r,"f")&&f(this,s,"m",u).call(this)}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/helpers/QuoteRefresher.cjs"}],[3026,{"../logger.cjs":3028,"../utils/strategy.cjs":3042,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,a,i,o,c=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},l=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPayPublishHook=void 0;const u=e("@metamask/utils"),d=e("../logger.cjs"),p=e("../utils/strategy.cjs"),h=(0,u.createModuleLogger)(d.projectLogger,"pay-publish-hook"),m={transactionHash:undefined};n.TransactionPayPublishHook=class{constructor({isSmartTransaction:e,messenger:t}){s.add(this),r.set(this,void 0),a.set(this,void 0),c(this,r,e,"f"),c(this,a,t,"f")}getHook(){return l(this,s,"m",i).bind(this)}},r=new WeakMap,a=new WeakMap,s=new WeakSet,i=async function(e,t){try{return await l(this,s,"m",o).call(this,e,t)}catch(e){throw h("Error",e),e}},o=async function(e,t){const{id:n}=e,s=l(this,a,"f").call("TransactionPayController:getState"),i=s.transactionData?.[n]?.quotes??[];if(!i?.length)return h("Skipping as no quotes found"),m;const o=(0,p.getStrategy)(l(this,a,"f"),e);return await o.execute({isSmartTransaction:l(this,r,"f"),quotes:i,messenger:l(this,a,"f"),transaction:e})}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/helpers/TransactionPayPublishHook.cjs"}],[3027,{"./TransactionPayController.cjs":3022,"./constants.cjs":3024,"./helpers/TransactionPayPublishHook.cjs":3026},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionPayPublishHook=n.TransactionPayController=n.TransactionPayStrategy=void 0;var s=e("./constants.cjs");Object.defineProperty(n,"TransactionPayStrategy",{enumerable:!0,get:function(){return s.TransactionPayStrategy}});var r=e("./TransactionPayController.cjs");Object.defineProperty(n,"TransactionPayController",{enumerable:!0,get:function(){return r.TransactionPayController}});var a=e("./helpers/TransactionPayPublishHook.cjs");Object.defineProperty(n,"TransactionPayPublishHook",{enumerable:!0,get:function(){return a.TransactionPayPublishHook}})}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/index.cjs"}],[3028,{"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createModuleLogger=n.projectLogger=void 0;const s=e("@metamask/utils");Object.defineProperty(n,"createModuleLogger",{enumerable:!0,get:function(){return s.createModuleLogger}}),n.projectLogger=(0,s.createProjectLogger)("transaction-pay-controller")}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/logger.cjs"}],[3029,{"./bridge-quotes.cjs":3030,"./bridge-submit.cjs":3031},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.BridgeStrategy=void 0;const s=e("./bridge-quotes.cjs"),r=e("./bridge-submit.cjs");n.BridgeStrategy=class{async getQuotes(e){return(0,s.getBridgeQuotes)(e)}async getBatchTransactions(e){return(0,s.getBridgeBatchTransactions)(e)}async getRefreshInterval(e){return(0,s.getBridgeRefreshInterval)(e)}async execute(e){const{isSmartTransaction:t,quotes:n,messenger:s,transaction:a}=e,i=a.txParams.from;return await(0,r.submitBridgeQuotes)({from:i,isSmartTransaction:t,messenger:s,quotes:n,transaction:a}),{transactionHash:undefined}}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/bridge/BridgeStrategy.cjs"}],[303,{"../../../../shared/constants/offscreen-communication":5797},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TrezorOffscreenBridge=void 0;var s=e("../../../../shared/constants/offscreen-communication");function r(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.TrezorOffscreenBridge=class{constructor(){r(this,"model",void 0),r(this,"minorVersion",void 0)}init(e){return chrome.runtime.onMessage.addListener(e=>{e.target===s.OffscreenCommunicationTarget.extension&&e.event===s.OffscreenCommunicationEvents.trezorDeviceConnect&&(this.model=e.payload.model,this.minorVersion=e.payload.minorVersion)}),new Promise(t=>{chrome.runtime.sendMessage({target:s.OffscreenCommunicationTarget.trezorOffscreen,action:s.TrezorAction.init,params:e},()=>{t()})})}dispose(){return new Promise(e=>{chrome.runtime.sendMessage({target:s.OffscreenCommunicationTarget.trezorOffscreen,action:s.TrezorAction.dispose},()=>{e()})})}getPublicKey(e){return new Promise(t=>{chrome.runtime.sendMessage({target:s.OffscreenCommunicationTarget.trezorOffscreen,action:s.TrezorAction.getPublicKey,params:e},e=>{t(e)})})}ethereumSignTransaction(e){return new Promise(t=>{chrome.runtime.sendMessage({target:s.OffscreenCommunicationTarget.trezorOffscreen,action:s.TrezorAction.signTransaction,params:e},e=>{t(e)})})}ethereumSignMessage(e){return new Promise(t=>{chrome.runtime.sendMessage({target:s.OffscreenCommunicationTarget.trezorOffscreen,action:s.TrezorAction.signMessage,params:e},e=>{t(e)})})}ethereumSignTypedData(e){return new Promise(t=>{chrome.runtime.sendMessage({target:s.OffscreenCommunicationTarget.trezorOffscreen,action:s.TrezorAction.signTypedData,params:e},e=>{t(e)})})}}}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/trezor-offscreen-bridge.ts"}],[3030,{"../../index.cjs":3027,"../../logger.cjs":3028,"../../utils/gas.cjs":3038,"../../utils/token.cjs":3043,"@metamask/bridge-controller":3052,"@metamask/controller-utils":1449,"@metamask/transaction-controller":2994,"@metamask/utils":3116,"bignumber.js":3087,lodash:4838},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.refreshQuote=n.getBridgeRefreshInterval=n.getBridgeBatchTransactions=n.getBridgeQuotes=void 0;const s=e("@metamask/bridge-controller"),r=e("@metamask/controller-utils"),a=e("@metamask/transaction-controller"),i=e("@metamask/utils"),o=e("bignumber.js"),c=e("lodash"),l=e("../../index.cjs"),u=e("../../logger.cjs"),d=e("../../utils/gas.cjs"),p=e("../../utils/token.cjs"),h="All quotes under minimum",m=new Map([[a.TransactionType.perpsDeposit,s.FeatureId.PERPS]]),f=(0,i.createModuleLogger)(u.projectLogger,"bridge-strategy");function g(e){return{data:e.data,gas:e.gasLimit?(0,r.toHex)(e.gasLimit):undefined,isAfter:!1,to:e.to,value:e.value}}async function S(e,t,n){const{from:s,slippage:a,sourceChainId:i,sourceTokenAddress:l,sourceTokenAmount:u,targetChainId:d,targetTokenAddress:p}=e,{type:g}=n,S=m.get(g),E={destChainId:d,destTokenAddress:(0,r.toChecksumHexAddress)(p),destWalletAddress:s,gasIncluded:!1,gasIncluded7702:!1,insufficientBal:!1,slippage:100*a,srcChainId:i,srcTokenAddress:(0,r.toChecksumHexAddress)(l),srcTokenAmount:u,walletAddress:s},_=await t.call("BridgeController:fetchQuotes",E,undefined,S);if(!_.length)throw new Error("No quotes found");const T=function(e,t){const n=(0,c.orderBy)(e,e=>e.estimatedProcessingTimeInSeconds,"asc").slice(0,3),s=n.filter(e=>new o.BigNumber(e.quote.minDestTokenAmount).isGreaterThanOrEqualTo(t.targetAmountMinimum));if(f("Finding best quote",{allQuotes:e,fastestQuotes:n,quotesOverMinimumTarget:s}),!s.length)throw new Error(h);return(0,c.orderBy)(s,e=>(0,o.BigNumber)(e.quote.minDestTokenAmount).toNumber(),"desc")[0]}(_,e);return{...T,request:e}}function E(e,t,n,s){const r=new o.BigNumber(e).shiftedBy(-t),a=r.toString(10),i=r.multipliedBy(s).toString(10);return{fiat:r.multipliedBy(n).toString(10),human:a,raw:e,usd:i}}function _(e,t,{isMax:n=!1}={}){const{approval:s,trade:r}=e,a=s?T(s,t,{isMax:n}):{fiat:"0",human:"0",raw:"0",usd:"0"},i=T(r,t,{isMax:n});return{fiat:new o.BigNumber(a.fiat).plus(i.fiat).toString(10),human:new o.BigNumber(a.human).plus(i.human).toString(10),raw:new o.BigNumber(a.raw).plus(i.raw).toString(10),usd:new o.BigNumber(a.usd).plus(i.usd).toString(10)}}function T(e,t,{isMax:n}){const{effectiveGas:s,gasLimit:r}=e,a=n?undefined:s;return(0,d.calculateGasCost)({...e,gas:a||r||"0x0",messenger:t,isMax:n})}n.getBridgeQuotes=async function(e){f("Fetching quotes",e);const{requests:t,messenger:n,transaction:s}=e;try{const r=function(e,t){const n=function(e){const t=e.call("RemoteFeatureFlagController:getState").remoteFeatureFlags.confirmations_pay;return{attemptsMax:t?.attemptsMax??5,bufferInitial:t?.bufferInitial??.04,bufferStep:t?.bufferStep??.04,bufferSubsequent:t?.bufferSubsequent??.05,slippage:t?.slippage??.005}}(t);return e.map(e=>({...e,...n})).map((t,n)=>{const s=0===n,r=s?t.attemptsMax:1,a=e.reduce((e,r,a)=>{const i=r.sourceTokenAddress.toLowerCase()===t.sourceTokenAddress.toLowerCase()&&r.sourceChainId===t.sourceChainId;return s&&a>n&&i?e.minus(r.sourceTokenAmount):e},new o.BigNumber(t.sourceBalanceRaw)).toFixed(0);return{...t,attemptsMax:r,sourceBalanceRaw:a}})}(t,n),a=await Promise.all(r.map((t,n)=>async function(e,t,n){const{attemptsMax:s,bufferInitial:r,bufferStep:a,bufferSubsequent:i,sourceBalanceRaw:c,sourceTokenAmount:l,targetAmountMinimum:u,targetTokenAddress:d}=e,p=new o.BigNumber(l),m=0===t?r:i,g=p.div(1+m),E=Date.now();let _=l;for(let t=0;t<s;t++){const i={...e,sourceTokenAmount:_};try{f("Attempt",{attempt:t+1,attemptsMax:s,bufferInitial:r,bufferStep:a,currentSourceAmount:_,target:d});const e=await S(i,n.messenger,n.transaction),c=new o.BigNumber(e.quote.minDestTokenAmount).minus(u).toString(10);return f("Found valid quote",{attempt:t+1,target:d,targetAmount:e.quote.minDestTokenAmount,goalAmount:u,dust:c,quote:e}),{...e,metrics:{attempts:t+1,buffer:m+a*t,latency:Date.now()-E}}}catch(e){if(e.message!==h)throw e}if(new o.BigNumber(_).isGreaterThanOrEqualTo(c)){f("Reached balance limit",{targetTokenAddress:d,sourceBalanceRaw:c,currentSourceAmount:_,attempt:t+1});break}const l=g.multipliedBy(1+m+a*(t+1));_=l.isLessThan(c)?l.toFixed(0):c}throw f("All attempts failed",d),new Error(h)}(t,n,e)));return a.map((e,t)=>function(e,t,n,s){const r=(0,p.getTokenFiatRate)(n,t.sourceTokenAddress,t.sourceChainId);if(r===undefined)throw new Error(`Fiat rate not found for source token - Chain ID: ${t.sourceChainId}, Address: ${t.sourceTokenAddress}`);const a=(0,p.getTokenFiatRate)(n,t.targetTokenAddress,t.targetChainId);if(a===undefined)throw new Error(`Fiat rate not found for target token - Chain ID: ${t.targetChainId}, Address: ${t.targetTokenAddress}`);const i=E(e.quote.minDestTokenAmount,e.quote.destAsset.decimals,a.fiatRate,a.usdRate),c=E(e.quote.srcTokenAmount,e.quote.srcAsset.decimals,r.fiatRate,r.usdRate),u=E(t.targetAmountMinimum,e.quote.destAsset.decimals,a.fiatRate,a.usdRate),h=(0,d.calculateTransactionGasCost)(s,n),m={estimate:_(e,n),max:_(e,n,{isMax:!0})};return{estimatedDuration:e.estimatedProcessingTimeInSeconds,dust:{fiat:new o.BigNumber(i.fiat).minus(u.fiat).toString(10),usd:new o.BigNumber(i.usd).minus(u.usd).toString(10)},fees:{provider:{fiat:new o.BigNumber(c.fiat).minus(i.fiat).toString(10),usd:new o.BigNumber(c.usd).minus(i.usd).toString(10)},sourceNetwork:m,targetNetwork:h},original:e,request:t,sourceAmount:c,strategy:l.TransactionPayStrategy.Bridge}}(e,r[t],n,s))}catch(e){throw f("Error fetching quotes",{error:e}),new Error(`Failed to fetch bridge quotes: ${String(e)}`)}},n.getBridgeBatchTransactions=async function(e){const{quotes:t}=e,n=t[0]?.original?.quote;return n?.srcChainId!==n?.destChainId?(f("No batch transactions needed for bridge quotes"),[]):t.map(e=>e.original).flatMap(e=>{const t=[];return e.approval&&t.push({...g(e.approval),type:a.TransactionType.swapApproval}),t.push({...g(e.trade),type:a.TransactionType.swap}),t})},n.getBridgeRefreshInterval=function(e){const{chainId:t,messenger:n}=e,s=n.call("RemoteFeatureFlagController:getState").remoteFeatureFlags.bridgeConfigV2,r=s?.chains?.[parseInt(t,16)]?.refreshRate,a=s?.refreshRate;return r??a},n.refreshQuote=async function(e,t,n){const s=await S({...e.original.request,attemptsMax:1},t,n);return f("Refreshed quote",{old:e,new:s}),s}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/bridge/bridge-quotes.cjs"}],[3031,{"../../logger.cjs":3028,"../../utils/transaction.cjs":3045,"./bridge-quotes.cjs":3030,"@metamask/bridge-controller":3052,"@metamask/controller-utils":1449,"@metamask/utils":3116,lodash:4838},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.submitBridgeQuotes=void 0;const s=e("@metamask/bridge-controller"),r=e("@metamask/controller-utils"),a=e("@metamask/utils"),i=e("lodash"),o=e("./bridge-quotes.cjs"),c=e("../../logger.cjs"),l=e("../../utils/transaction.cjs"),u=(0,a.createModuleLogger)(c.projectLogger,"bridge-strategy");async function d(e,t){const{isSmartTransaction:n,messenger:a,from:o,transaction:c}=e,d=(0,i.cloneDeep)(t),p=(0,r.toHex)(d.quote.srcChainId),h=n(p),m=[],f=(0,l.collectTransactionIds)(p,o,a,e=>(0,l.updateTransaction)({transactionId:c.id,messenger:a,note:"Add required transaction ID"},t=>{t.requiredTransactionIds||(t.requiredTransactionIds=[]),t?.requiredTransactionIds.push(e),m.push(e)})),g={amount:"0",valueInCurrency:null,usd:null},S={gasFee:{effective:g,max:g,total:g},totalNetworkFee:g,totalMaxNetworkFee:g,toTokenAmount:g,minToTokenAmount:g,adjustedReturn:g,sentAmount:g,swapRate:"0",cost:g},E=await a.call("BridgeStatusController:submitTx",o,{...d,...S},h);f.end(),u("Bridge transaction submitted",{requiredTransactionIds:m,result:E}),await Promise.all(m.map(e=>(0,l.waitForTransactionConfirmed)(e,a))),u("All required transactions confirmed",m);const{id:_}=E;u("Waiting for bridge completion",_),await async function(e,t){return new Promise((n,r)=>{const a=(e,t)=>{const a=e?.status?.status;return u("Checking bridge status",a??"missing"),a===s.StatusTypes.COMPLETE?(t?.(),n(),!0):a===s.StatusTypes.FAILED&&(t?.(),r(new Error("Bridge failed")),!0)},i=t.call("BridgeStatusController:getState").txHistory[e];if(a(i))return;const o=e=>{a(e,()=>t.unsubscribe("BridgeStatusController:stateChange",o))};t.subscribe("BridgeStatusController:stateChange",o,t=>t.txHistory[e])})}(_,a)}n.submitBridgeQuotes=async function(e){const{quotes:t,messenger:n,transaction:s}=e;if(!t?.length)return void u("No quotes found");if(t[0].original.quote.srcChainId===t[0].original.quote.destChainId)return void u("Ignoring quotes as source is same chain",t[0].original.quote.srcChainId);let r=0;for(const a of t){u("Submitting bridge",r,a);let t=a.original;if(r>0)try{t=await(0,o.refreshQuote)(a,n,s)}catch(e){u("Failed to refresh subsequent quote before submit",e)}await d(e,t),r+=1}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/bridge/bridge-submit.cjs"}],[3032,{"./relay-quotes.cjs":3034,"./relay-submit.cjs":3035},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.RelayStrategy=void 0;const s=e("./relay-quotes.cjs"),r=e("./relay-submit.cjs");n.RelayStrategy=class{async getQuotes(e){return(0,s.getRelayQuotes)(e)}async execute(e){return await(0,r.submitRelayQuotes)(e)}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/relay/RelayStrategy.cjs"}],[3033,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.RELAY_POLLING_INTERVAL=n.RELAY_URL_BASE=n.CHAIN_ID_HYPERCORE=void 0,n.CHAIN_ID_HYPERCORE="0x539",n.RELAY_URL_BASE="https://api.relay.link",n.RELAY_POLLING_INTERVAL=1e3}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/relay/constants.cjs"}],[3034,{"../../constants.cjs":3024,"../../index.cjs":3027,"../../logger.cjs":3028,"../../utils/feature-flags.cjs":3037,"../../utils/gas.cjs":3038,"../../utils/token.cjs":3043,"./constants.cjs":3033,"@ethersproject/abi":723,"@metamask/controller-utils":1449,"@metamask/utils":3116,"bignumber.js":3087},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getRelayQuotes=void 0;const s=e("@ethersproject/abi"),r=e("@metamask/controller-utils"),a=e("@metamask/utils"),i=e("bignumber.js"),o=e("./constants.cjs"),c=e("../../index.cjs"),l=e("../../constants.cjs"),u=e("../../logger.cjs"),d=e("../../utils/feature-flags.cjs"),p=e("../../utils/gas.cjs"),h=e("../../utils/token.cjs"),m=(0,a.createModuleLogger)(u.projectLogger,"relay-strategy");function f(e,t){const n=e.multipliedBy(t);return{usd:e.toString(10),fiat:n.toString(10)}}function g(e,t,{isMax:n}){if(e.every(e=>e.gas!==undefined))return e.reduce((e,t)=>e+new i.BigNumber(t.gas).toNumber(),0);const s=(0,d.getFeatureFlags)(t).relayFallbackGas;return e.reduce((e,t)=>{const r=n?s.max:s.estimate,a=t.gas??r;return e+new i.BigNumber(a).toNumber()},0)}n.getRelayQuotes=async function(e){const{requests:t}=e;m("Fetching quotes",t);try{const n=t.filter(e=>"0"!==e.targetAmountMinimum).map(e=>function(e){const t=e.targetChainId===l.CHAIN_ID_ARBITRUM&&e.targetTokenAddress.toLowerCase()===l.ARBITRUM_USDC_ADDRESS.toLowerCase(),n=e.sourceChainId===l.CHAIN_ID_POLYGON&&e.sourceTokenAddress===(0,h.getNativeToken)(e.sourceChainId),s={...e,sourceTokenAddress:n?l.NATIVE_TOKEN_ADDRESS:e.sourceTokenAddress,targetChainId:t?o.CHAIN_ID_HYPERCORE:e.targetChainId,targetTokenAddress:t?"0x00000000000000000000000000000000":e.targetTokenAddress,targetAmountMinimum:t?new i.BigNumber(e.targetAmountMinimum).shiftedBy(2).toString(10):e.targetAmountMinimum};t&&m("Converting Arbitrum Hyperliquid deposit to direct deposit",{originalRequest:e,normalizedRequest:s});return s}(e));return m("Normalized requests",n),await Promise.all(n.map(t=>async function(e,t){const{messenger:n,transaction:a}=t;try{const u={amount:e.targetAmountMinimum,destinationChainId:Number(e.targetChainId),destinationCurrency:e.targetTokenAddress,originChainId:Number(e.sourceChainId),originCurrency:e.sourceTokenAddress,recipient:e.from,tradeType:"EXPECTED_OUTPUT",user:e.from};await async function(e,t,n,r){const{data:a,value:i}=e.txParams,c=!((a&&"0x"!==a||i&&"0x0"!==i)&&t.targetChainId!==o.CHAIN_ID_HYPERCORE);if(c)return void m("Skipping delegation as no transaction data");const l=await r.call("TransactionPayController:getDelegationTransaction",{transaction:e}),u=l.authorizationList?.map(e=>({...e,chainId:Number(e.chainId),nonce:Number(e.nonce),yParity:Number(e.yParity)})),d=new s.Interface(["function transfer(address to, uint256 amount)"]).encodeFunctionData("transfer",[t.from,t.targetAmountMinimum]);n.authorizationList=u,n.tradeType="EXACT_OUTPUT",n.txs=[{to:t.targetTokenAddress,data:d,value:"0x0"},{to:l.to,data:l.data,value:l.value}]}(a,e,u,n);const S=(0,d.getFeatureFlags)(n).relayQuoteUrl;m("Request body",{body:u,url:S});const E=await(0,r.successfulFetch)(S,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}),_=await E.json();return m("Fetched relay quote",_),async function(e,t,n){const{messenger:s}=n,{details:a}=e,{currencyIn:o}=a,{usdToFiatRate:u}=function(e,t){const{sourceChainId:n,sourceTokenAddress:s}=t,r=n===l.CHAIN_ID_POLYGON&&s===l.NATIVE_TOKEN_ADDRESS?(0,h.getNativeToken)(n):s,a=(0,h.getTokenFiatRate)(e,r,n);if(!a)throw new Error("Source token fiat rate not found");const o=new i.BigNumber(a.fiatRate).dividedBy(a.usdRate);return{sourceFiatRate:a,usdToFiatRate:o}}(s,t),S=f(function(e,t){const{currencyOut:n}=e.details,{amountUsd:s,amountFormatted:r,minimumAmount:a}=n,{decimals:o}=n.currency,c=new i.BigNumber(s).dividedBy(r),l=new i.BigNumber(a).minus(t.targetAmountMinimum);return l.shiftedBy(-o).multipliedBy(c)}(e,t),u),E=f(function(e){const t=new i.BigNumber(e.fees.relayer.amountUsd),n=new i.BigNumber(e.details.currencyIn.amountUsd).minus(e.details.currencyOut.amountUsd);return t.gt(n)?t:n}(e),u),{isGasFeeToken:_,...T}=await async function(e,t,n){const{from:s,sourceChainId:a,sourceTokenAddress:o}=n,c=e.steps.flatMap(e=>e.items).map(e=>e.data),{relayDisabledGasStationChains:l}=(0,d.getFeatureFlags)(t),{chainId:u,data:f,maxFeePerGas:S,maxPriorityFeePerGas:E,to:_,value:T}=c[0],y=g(c,t,{isMax:!1}),w=g(c,t,{isMax:!0}),b=(0,p.calculateGasCost)({chainId:u,gas:y,maxFeePerGas:S,maxPriorityFeePerGas:E,messenger:t}),I=(0,p.calculateGasCost)({chainId:u,gas:w,maxFeePerGas:S,maxPriorityFeePerGas:E,messenger:t,isMax:!0}),A=(0,h.getTokenBalance)(t,s,a,(0,h.getNativeToken)(a));if(new i.BigNumber(A).isGreaterThanOrEqualTo(I.raw))return{estimate:b,max:I};if(l.includes(a))return m("Skipping gas station as disabled chain",{sourceChainId:a,disabledChainIds:l}),{estimate:b,max:I};m("Checking gas fee tokens as insufficient native balance",{nativeBalance:A,max:I.raw});const v=await t.call("TransactionController:getGasFeeTokens",{chainId:a,data:f,from:s,to:_,value:(0,r.toHex)(T??"0")});m("Source gas fee tokens",{gasFeeTokens:v});const k=v.find(e=>e.tokenAddress.toLowerCase()===o.toLowerCase());if(!k)return m("No matching gas fee token found",{sourceTokenAddress:o,gasFeeTokens:v}),{estimate:b,max:I};let C=k.amount;if(c.length>1){const e=new i.BigNumber(k.amount,16).dividedBy(k.gas,16),t=e.multipliedBy(y);C=(0,r.toHex)(t.toFixed(0)),m("Estimated gas fee token amount for batch",{finalAmount:t.toString(10),gasRate:e.toString(10),totalGasLimitEstimate:y})}const N={...k,amount:C},R=(0,p.calculateGasFeeTokenCost)({chainId:a,gasFeeToken:N,messenger:t});if(!R)return{estimate:b,max:I};return m("Using gas fee token for source network",{gasFeeTokenCost:R}),{isGasFeeToken:!0,estimate:R,max:R}}(e,s,t),y={usd:"0",fiat:"0"},w={human:o.amountFormatted,raw:o.amount,...f(new i.BigNumber(o.amountUsd),u)};return{dust:S,estimatedDuration:a.timeEstimate,fees:{isSourceGasFeeToken:_,provider:E,sourceNetwork:T,targetNetwork:y},original:e,request:t,sourceAmount:w,strategy:c.TransactionPayStrategy.Relay}}(_,e,t)}catch(e){throw m("Error fetching relay quote",e),e}}(t,e)))}catch(e){throw m("Error fetching quotes",{error:e}),new Error(`Failed to fetch Relay quotes: ${String(e)}`)}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/relay/relay-quotes.cjs"}],[3035,{"../../logger.cjs":3028,"../../utils/feature-flags.cjs":3037,"../../utils/transaction.cjs":3045,"./constants.cjs":3033,"@metamask/controller-utils":1449,"@metamask/transaction-controller":2994,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.submitRelayQuotes=void 0;const s=e("@metamask/controller-utils"),r=e("@metamask/transaction-controller"),a=e("@metamask/utils"),i=e("./constants.cjs"),o=e("../../logger.cjs"),c=e("../../utils/feature-flags.cjs"),l=e("../../utils/transaction.cjs"),u="0x0",d=(0,a.createModuleLogger)(o.projectLogger,"relay-strategy");async function p(e,t,n){d("Executing single quote",e),(0,l.updateTransaction)({transactionId:n.id,messenger:t,note:"Remove nonce from skipped transaction"},e=>{e.txParams.nonce=undefined}),await async function(e,t,n){const{steps:a}=e.original,i=a.flatMap(e=>e.items).map(e=>e.data),o=a.find(e=>"transaction"!==e.kind)?.kind;if(o)throw new Error(`Unsupported step kind: ${o}`);const u=i.map(e=>function(e,t){const n=(0,c.getFeatureFlags)(t);return{data:e.data,from:e.from,gas:(0,s.toHex)(e.gas??n.relayFallbackGas.max),maxFeePerGas:(0,s.toHex)(e.maxFeePerGas),maxPriorityFeePerGas:(0,s.toHex)(e.maxPriorityFeePerGas),to:e.to,value:(0,s.toHex)(e.value??"0")}}(e,n)),p=[],{from:h,sourceChainId:m,sourceTokenAddress:f}=e.request,g=n.call("NetworkController:findNetworkClientIdByChainId",m);d("Adding transactions",{normalizedParams:u,sourceChainId:m,from:h,networkClientId:g});const{end:S}=(0,l.collectTransactionIds)(m,h,n,e=>{p.push(e),(0,l.updateTransaction)({transactionId:t,messenger:n,note:"Add required transaction ID from Relay submission"},t=>{t.requiredTransactionIds||(t.requiredTransactionIds=[]),t.requiredTransactionIds.push(e)})});let E;const _=e.fees.isSourceGasFeeToken?f:undefined;1===i.length?E=await n.call("TransactionController:addTransaction",u[0],{gasFeeToken:_,networkClientId:g,origin:s.ORIGIN_METAMASK,requireApproval:!1}):await n.call("TransactionController:addTransactionBatch",{from:h,gasFeeToken:_,networkClientId:g,origin:s.ORIGIN_METAMASK,requireApproval:!1,transactions:u.map((e,t)=>({params:{data:e.data,gas:e.gas,to:e.to,value:e.value},type:0===t?r.TransactionType.tokenMethodApprove:undefined}))});if(S(),d("Added transactions",p),E){const e=await E.result;d("Submitted transaction",e)}await Promise.all(p.map(e=>(0,l.waitForTransactionConfirmed)(e,n))),d("All transactions confirmed",p);const T=(0,l.getTransaction)(p.slice(-1)[0],n)?.hash;return T}(e,n.id,t);const a=await async function(e){if(e.details.currencyIn.currency.chainId===e.details.currencyOut.currency.chainId)return d("Skipping polling as same chain"),u;const{endpoint:t,method:n}=e.steps.slice(-1)[0].items.slice(-1)[0].check,r=`${i.RELAY_URL_BASE}${t}`;for(;;){const e=await(0,s.successfulFetch)(r,{method:n}),t=await e.json();if(d("Polled status",t.status,t),"success"===t.status){const e=t.txHashes?.slice(-1)[0];return e??u}if(["failure","refund","fallback"].includes(t.status))throw new Error(`Relay request failed with status: ${t.status}`);await new Promise(e=>setTimeout(e,i.RELAY_POLLING_INTERVAL))}}(e.original);return d("Relay request completed",a),(0,l.updateTransaction)({transactionId:n.id,messenger:t,note:"Intent complete after Relay completion"},e=>{e.isIntentComplete=!0}),{transactionHash:a}}n.submitRelayQuotes=async function(e){d("Executing quotes",e);const{quotes:t,messenger:n,transaction:s}=e;let r;for(const e of t)({transactionHash:r}=await p(e,n,s));return{transactionHash:r}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/relay/relay-submit.cjs"}],[3036,{"../../index.cjs":3027,"../../logger.cjs":3028,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,a=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.TestStrategy=void 0;const i=e("@metamask/utils"),o=e("../../index.cjs"),c=e("../../logger.cjs"),l=(0,i.createModuleLogger)(c.projectLogger,"test-strategy");n.TestStrategy=class{constructor(){s.add(this)}async getQuotes(e){const{requests:t}=e;return l("Getting quotes",t),await a(this,s,"m",r).call(this,5e3),[{dust:{fiat:"0.12",usd:"0.34"},estimatedDuration:5,fees:{provider:{fiat:"1.23",usd:"1.23"},sourceNetwork:{estimate:{human:"2.34",fiat:"2.34",usd:"2.34",raw:"234000"},max:{human:"2.35",fiat:"2.35",usd:"2.35",raw:"235000"}},targetNetwork:{fiat:"3.45",usd:"3.45"}},original:undefined,request:t[0],sourceAmount:{human:"4.56",fiat:"4.56",raw:"456000",usd:"4.56"},strategy:o.TransactionPayStrategy.Test}]}async execute(e){const{quotes:t}=e;return l("Executing",t),await a(this,s,"m",r).call(this,5e3),{transactionHash:undefined}}},s=new WeakSet,r=function(e){return new Promise(t=>setTimeout(t,e))}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/strategy/test/TestStrategy.cjs"}],[3037,{"../logger.cjs":3028,"../strategy/relay/constants.cjs":3033,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getFeatureFlags=n.DEFAULT_RELAY_QUOTE_URL=n.DEFAULT_RELAY_FALLBACK_GAS_MAX=n.DEFAULT_RELAY_FALLBACK_GAS_ESTIMATE=void 0;const s=e("@metamask/utils"),r=e("../logger.cjs"),a=e("../strategy/relay/constants.cjs"),i=(0,s.createModuleLogger)(r.projectLogger,"feature-flags");n.DEFAULT_RELAY_FALLBACK_GAS_ESTIMATE=9e5,n.DEFAULT_RELAY_FALLBACK_GAS_MAX=15e5,n.DEFAULT_RELAY_QUOTE_URL=`${a.RELAY_URL_BASE}/quote`,n.getFeatureFlags=function(e){const t=e.call("RemoteFeatureFlagController:getState").remoteFeatureFlags.confirmations_pay??{},s=t.relayFallbackGas?.estimate??n.DEFAULT_RELAY_FALLBACK_GAS_ESTIMATE,r=t.relayFallbackGas?.max??n.DEFAULT_RELAY_FALLBACK_GAS_MAX,a=t.relayQuoteUrl??n.DEFAULT_RELAY_QUOTE_URL,o={relayDisabledGasStationChains:t.relayDisabledGasStationChains??[],relayFallbackGas:{estimate:s,max:r},relayQuoteUrl:a};return i("Feature flags:",{raw:t,result:o}),o}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/feature-flags.cjs"}],[3038,{"../logger.cjs":3028,"./token.cjs":3043,"@metamask/controller-utils":1449,"bignumber.js":3087},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.calculateGasFeeTokenCost=n.calculateGasCost=n.calculateTransactionGasCost=void 0;const s=e("@metamask/controller-utils"),r=e("bignumber.js"),a=e("./token.cjs"),i=e("../logger.cjs"),o=(0,i.createModuleLogger)(i.projectLogger,"gas");function c(e){const{chainId:t,gas:n,isMax:i,maxFeePerGas:o,maxPriorityFeePerGas:c,messenger:l}=e,u=(0,s.toHex)(t),{estimatedBaseFee:d,maxFeePerGas:p,maxPriorityFeePerGas:h}=function(e,t){const n=t.call("GasFeeController:getState"),s=n?.gasFeeEstimatesByChainId?.[e],{estimatedBaseFee:a,medium:i}=s?.gasFeeEstimates??{},o=i?.suggestedMaxFeePerGas,c=i?.suggestedMaxPriorityFeePerGas,l=a?new r.BigNumber(a).shiftedBy(9).toString(10):undefined,u=o?new r.BigNumber(o).shiftedBy(9).toString(10):undefined,d=c?new r.BigNumber(c).shiftedBy(9).toString(10):undefined;return{estimatedBaseFee:l,maxFeePerGas:u,maxPriorityFeePerGas:d}}(u,l),m=o||p,f=c||h,g=d&&f&&!i?new r.BigNumber(d).plus(f):new r.BigNumber(m||"0x0"),S=new r.BigNumber(n).multipliedBy(g),E=S.toString(10),_=S.shiftedBy(-18),T=_.toString(10),y=(0,a.getTokenFiatRate)(l,(0,a.getNativeToken)(u),u);if(!y)throw new Error("Could not fetch fiat rate for native token");const w=_.multipliedBy(y.usdRate).toString(10);return{fiat:_.multipliedBy(y.fiatRate).toString(10),human:T,raw:E,usd:w}}function l({chainId:e,gasFeeToken:t,messenger:n}){const{amount:s,decimals:i,tokenAddress:c}=t,l=(0,a.getTokenFiatRate)(n,c,e);if(!l)return o("Cannot get gas fee token info"),undefined;const u=new r.BigNumber(s),d=u.toString(10),p=u.shiftedBy(-i),h=p.toString(10);return{isGasFeeToken:!0,fiat:p.multipliedBy(l.fiatRate).toString(10),human:h,raw:d,usd:p.multipliedBy(l.usdRate).toString(10)}}n.calculateTransactionGasCost=function(e,t,{isMax:n}={}){const{chainId:s,gasUsed:i,gasLimitNoBuffer:u,txParams:d}=e,{from:p,gas:h,maxFeePerGas:m,maxPriorityFeePerGas:f}=d,g=(n?undefined:i)||u||h||"0x0",S=c({chainId:s,gas:g,isMax:n,maxFeePerGas:m,maxPriorityFeePerGas:f,messenger:t}),E=c({chainId:s,gas:g,isMax:!0,messenger:t}),_=(0,a.getTokenBalance)(t,p,s,(0,a.getNativeToken)(s)),T=function({hasBalance:e,messenger:t,transaction:n}){const{chainId:s,gasFeeTokens:r,isGasFeeTokenIgnoredIfBalance:a,selectedGasFeeToken:i}=n;if(!r||!i||a&&e)return undefined;o("Calculating gas fee token cost",{selectedGasFeeToken:i,chainId:s});const c=r?.find(e=>e.tokenAddress.toLowerCase()===i.toLowerCase());if(!c)return o("Gas fee token not found",{gasFeeTokens:r,selectedGasFeeToken:i}),undefined;return l({chainId:s,gasFeeToken:c,messenger:t})}({hasBalance:new r.BigNumber(_).gte(E.raw),messenger:t,transaction:e});return T||S},n.calculateGasCost=c,n.calculateGasFeeTokenCost=l}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/gas.cjs"}],[3039,{"../logger.cjs":3028,"./strategy.cjs":3042,"./totals.cjs":3044,"./transaction.cjs":3045,"@metamask/transaction-controller":2994,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.refreshQuotes=n.updateQuotes=void 0;const s=e("@metamask/transaction-controller"),r=e("@metamask/utils"),a=e("./strategy.cjs"),i=e("./totals.cjs"),o=e("./transaction.cjs"),c=e("../logger.cjs"),l=(0,r.createModuleLogger)(c.projectLogger,"quotes");async function u(e){const{messenger:t,transactionData:n,transactionId:r,updateTransactionData:c}=e,u=(0,o.getTransaction)(r,t);if(!u||!n)throw new Error("Transaction not found");if(u?.status!==s.TransactionStatus.unapproved)return!1;l("Updating quotes",{transactionId:r});const{paymentToken:d,sourceAmounts:p,tokens:h}=n,m=function({from:e,paymentToken:t,sourceAmounts:n,tokens:s,transactionId:r}){if(!t)return[];const a=(n??[]).map(n=>{const r=s.find(e=>e.address===n.targetTokenAddress);return{from:e,sourceBalanceRaw:t.balanceRaw,sourceTokenAmount:n.sourceAmountRaw,sourceChainId:t.chainId,sourceTokenAddress:t.address,targetAmountMinimum:r.allowUnderMinimum?"0":r.amountRaw,targetChainId:r.chainId,targetTokenAddress:r.address}});a.length||l("No quote requests",{transactionId:r});return a}({from:u.txParams.from,paymentToken:d,sourceAmounts:p,tokens:h,transactionId:r});c(r,e=>{e.isLoading=!0});try{const{batchTransactions:e,quotes:n}=await async function(e,t,n){const{id:s}=e,r=(0,a.getStrategy)(n,e);let i=[];try{i=t?.length?await r.getQuotes({messenger:n,requests:t,transaction:e}):[]}catch(e){l("Error fetching quotes",{error:e,transactionId:s})}l("Updated",{transactionId:s,quotes:i});const o=i?.length&&r.getBatchTransactions?await r.getBatchTransactions({messenger:n,quotes:i}):[];return l("Batch transactions",{transactionId:s,batchTransactions:o}),{batchTransactions:o,quotes:i}}(u,m,t),s=(0,i.calculateTotals)({quotes:n,messenger:t,tokens:h,transaction:u});l("Calculated totals",{transactionId:r,totals:s}),function({batchTransactions:e,messenger:t,paymentToken:n,totals:s,transactionId:r}){if(!n)return;(0,o.updateTransaction)({transactionId:r,messenger:t,note:"Update transaction pay data"},t=>{t.batchTransactions=e,t.batchTransactionsOptions={},t.metamaskPay={bridgeFeeFiat:s.fees.provider.usd,chainId:n.chainId,networkFeeFiat:s.fees.sourceNetwork.estimate.usd,tokenAddress:n.address,totalFiat:s.total.usd}})}({batchTransactions:e,messenger:t,paymentToken:d,totals:s,transactionId:r}),c(r,e=>{e.quotes=n,e.quotesLastUpdated=Date.now(),e.totals=s})}finally{c(r,e=>{e.isLoading=!1})}return!0}n.updateQuotes=u,n.refreshQuotes=async function(e,t){const n=e.call("TransactionPayController:getState"),s=Object.keys(n.transactionData);for(const r of s){const s=n.transactionData[r],{isLoading:i,quotes:o,quotesLastUpdated:c}=s;if(i||!o?.length)continue;const d=o[0].strategy,p=(0,a.getStrategyByName)(d),h=await(p.getRefreshInterval?.({chainId:o[0].request.sourceChainId,messenger:e}))??3e4;if(!(Date.now()-(c??0)>h))continue;await u({messenger:e,transactionData:s,transactionId:r,updateTransactionData:t})&&l("Refreshed quotes",{transactionId:r,strategy:d})}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/quotes.cjs"}],[304,{"webextension-polyfill":5763},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.openUpdateTabAndReload=async function(e){try{await r.default.tabs.create({url:"https://metamask.io/updating",active:!0})}catch(e){console.error(e)}await e()};var s,r=(s=e("webextension-polyfill"))&&s.__esModule?s:{default:s}}}},{package:"$root$",file:"app/scripts/lib/open-update-tab-and-reload.ts"}],[3040,{"./token.cjs":3043,"@ethersproject/abi":723,"@metamask/controller-utils":1449,"@metamask/metamask-eth-abis":2263,"@metamask/utils":3116,"bignumber.js":3087},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.parseRequiredTokens=void 0;const s=e("@ethersproject/abi"),r=e("@metamask/controller-utils"),a=e("@metamask/metamask-eth-abis"),i=e("@metamask/utils"),o=e("bignumber.js"),c=e("./token.cjs"),l="0xa9059cbb";function u(e,t){const{data:n,to:i}=function(e){const{nestedTransactions:t,txParams:n}=e,{data:s}=n,r=n?.to;if(s?.startsWith(l)&&r)return{data:s,to:r,index:undefined};const a=t?.findIndex(e=>e.data?.startsWith(l)),i=a!==undefined?t?.[a]:undefined;if(i?.data&&i.to)return{data:i.data,to:i.to,index:a};return undefined}(e)??{};if(!i||!n)return undefined;let o;try{const e=new s.Interface(a.abiERC20).decodeFunctionData("transfer",n);o=(0,r.toHex)(e._value)}catch{}return o===undefined?undefined:p(e,i,o,t)}function d(e,t){const{chainId:n,txParams:s}=e,{gas:r,maxFeePerGas:a}=s,l=(0,c.getNativeToken)(n),u=p(e,l,(0,i.add0x)(new o.BigNumber(r??"0x0").multipliedBy(new o.BigNumber(a??"0x0")).toString(16)),t);if(!u)return undefined;const d=new o.BigNumber(u.amountUsd);if(new o.BigNumber(u.balanceRaw).isGreaterThanOrEqualTo(u.amountRaw)||d.isGreaterThanOrEqualTo(1))return{...u,allowUnderMinimum:!0,skipIfBalance:!0};const h=(0,c.getTokenFiatRate)(t,l,n),m=p(e,l,(0,i.add0x)(new o.BigNumber(1).dividedBy(h.usdRate).shiftedBy(18).toString(16)),t);return m?{...m,allowUnderMinimum:!0,skipIfBalance:!0}:undefined}function p(e,t,n,s){const{chainId:r,txParams:a}=e,i=a.from,{decimals:o,symbol:l}=(0,c.getTokenInfo)(s,t,r)??{},u=(0,c.getTokenFiatRate)(s,t,r),d=(0,c.getTokenBalance)(s,i,r,t);if(o===undefined||!l||u===undefined)return undefined;const{amountHuman:p,amountRaw:m,amountFiat:f,amountUsd:g}=h(d,o,u),{amountHuman:S,amountRaw:E,amountFiat:_,amountUsd:T}=h(n,o,u);return{address:t,allowUnderMinimum:!1,amountFiat:_,amountHuman:S,amountRaw:E,amountUsd:T,balanceFiat:f,balanceHuman:p,balanceRaw:m,balanceUsd:g,chainId:r,decimals:o,skipIfBalance:!1,symbol:l}}function h(e,t,n){const s=new o.BigNumber(e),r=s.shiftedBy(-t),a=r.multipliedBy(n.fiatRate).toString(10),i=r.multipliedBy(n.usdRate).toString(10),c=s.toFixed(0);return{amountFiat:a,amountHuman:r.toString(10),amountRaw:c,amountUsd:i}}n.parseRequiredTokens=function(e,t){return[u(e,t),d(e,t)].filter(Boolean)}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/required-tokens.cjs"}],[3041,{"../constants.cjs":3024,"../index.cjs":3027,"../logger.cjs":3028,"./token.cjs":3043,"./transaction.cjs":3045,"@metamask/utils":3116,"bignumber.js":3087},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.updateSourceAmounts=void 0;const s=e("@metamask/utils"),r=e("bignumber.js"),a=e("./token.cjs"),i=e("./transaction.cjs"),o=e("../index.cjs"),c=e("../constants.cjs"),l=e("../logger.cjs"),u=(0,s.createModuleLogger)(l.projectLogger,"source-amounts");n.updateSourceAmounts=function(e,t,n){if(!t)return;const{paymentToken:s,tokens:l}=t;if(!l.length||!s)return;const d=l.map(t=>function(e,t,n,s){const l=(0,a.getTokenFiatRate)(n,e.address,e.chainId);if(!l)return undefined;const d=new r.BigNumber(t.balanceRaw).gte(t.amountRaw);if(t.skipIfBalance&&d)return u("Skipping token as sufficient balance",{tokenAddress:t.address}),undefined;const p=function(e,t){const n=(0,i.getTransaction)(e,t);return t.call("TransactionPayController:getStrategy",n)}(s,n),h=t.address.toLowerCase()===e.address.toLowerCase()&&t.chainId===e.chainId,m=function(e,t){const n=e.chainId===c.CHAIN_ID_ARBITRUM&&e.address.toLowerCase()===c.ARBITRUM_USDC_ADDRESS.toLowerCase();return t===o.TransactionPayStrategy.Relay&&n}(t,p);if(h&&!m)return u("Skipping token as same as payment token"),undefined;const f=new r.BigNumber(t.amountUsd).div(l.usdRate),g=f.toString(10),S=f.shiftedBy(e.decimals).toFixed(0);if("0"===t.amountRaw)return u("Skipping token as zero amount",{tokenAddress:t.address}),undefined;return{sourceAmountHuman:g,sourceAmountRaw:S,targetTokenAddress:t.address}}(s,t,n,e)).filter(Boolean);u("Updated source amounts",{transactionId:e,sourceAmounts:d}),t.sourceAmounts=d}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/source-amounts.cjs"}],[3042,{"../constants.cjs":3024,"../strategy/bridge/BridgeStrategy.cjs":3029,"../strategy/relay/RelayStrategy.cjs":3032,"../strategy/test/TestStrategy.cjs":3036},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getStrategyByName=n.getStrategy=void 0;const s=e("../constants.cjs"),r=e("../strategy/bridge/BridgeStrategy.cjs"),a=e("../strategy/relay/RelayStrategy.cjs"),i=e("../strategy/test/TestStrategy.cjs");function o(e){switch(e){case s.TransactionPayStrategy.Bridge:return new r.BridgeStrategy;case s.TransactionPayStrategy.Relay:return new a.RelayStrategy;case s.TransactionPayStrategy.Test:return new i.TestStrategy;default:throw new Error(`Unknown strategy: ${e}`)}}n.getStrategy=function(e,t){return o(e.call("TransactionPayController:getStrategy",t))},n.getStrategyByName=o}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/strategy.cjs"}],[3043,{"../constants.cjs":3024,"@metamask/controller-utils":1449,"bignumber.js":3087,lodash:4838},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getNativeToken=n.getTokenFiatRate=n.getTokenInfo=n.getAllTokenBalances=n.getTokenBalance=void 0;const s=e("@metamask/controller-utils"),r=e("bignumber.js"),a=e("lodash"),i=e("../constants.cjs"),o={[i.CHAIN_ID_ARBITRUM]:[i.ARBITRUM_USDC_ADDRESS.toLowerCase()],[i.CHAIN_ID_POLYGON]:[i.POLYGON_USDCE_ADDRESS.toLowerCase()]};function c(e,t,n,a){const i=e.call("TokenBalancesController:getState"),o=t.toLowerCase(),c=(0,s.toChecksumHexAddress)(a),u=c===l(n),d=i.tokenBalances?.[o]?.[n]?.[c];if(!u&&d===undefined)return"0";if(!u&&d)return new r.BigNumber(d,16).toString(10);const p=e.call("AccountTrackerController:getState"),h=p.accountsByChainId?.[n],m=(0,s.toChecksumHexAddress)(o),f=h?.[m]?.balance;return new r.BigNumber(f??"0x0",16).toString(10)}function l(e){return"0x89"===e?"0x0000000000000000000000000000000000001010":i.NATIVE_TOKEN_ADDRESS}function u(e,t){try{const n=t.call("NetworkController:findNetworkClientIdByChainId",e);return t.call("NetworkController:getNetworkClientById",n).configuration.ticker}catch{return undefined}}n.getTokenBalance=c,n.getAllTokenBalances=function(e,t){const n=e.call("TokenBalancesController:getState"),s=e.call("AccountTrackerController:getState"),r=Object.keys(s.accountsByChainId),i=t.toLowerCase(),o=n.tokenBalances?.[i],u=Object.keys(o);return(0,a.uniq)([...u,...r]).flatMap(n=>[...Object.keys(o[n]??{}),l(n)].map(s=>({chainId:n,tokenAddress:s,balance:c(e,t,n,s)})))},n.getTokenInfo=function(e,t,n){const s=e.call("TokensController:getState"),r=t.toLowerCase(),a=r===l(n).toLowerCase(),i=Object.values(s.allTokens?.[n]??{}).flat().find(e=>e.address.toLowerCase()===r);if(!i&&!a)return undefined;if(i&&!a)return{decimals:Number(i.decimals),symbol:i.symbol};const o=u(n,e);return o?{decimals:18,symbol:o}:undefined},n.getTokenFiatRate=function(e,t,n){const a=u(n,e);if(!a)return undefined;const i=e.call("TokenRatesController:getState"),c=e.call("CurrencyRateController:getState"),d=(0,s.toChecksumHexAddress)(t),p=d===l(n),h=i.marketData?.[n]?.[d]?.price;if(h===undefined&&!p)return undefined;const{conversionRate:m,usdConversionRate:f}=c.currencyRates?.[a]??{conversionRate:null,usdConversionRate:null};if(null===m||null===f)return undefined;const g=o[n]?.includes(t.toLowerCase());return{usdRate:g?"1":new r.BigNumber(h??1).multipliedBy(f).toString(10),fiatRate:new r.BigNumber(h??1).multipliedBy(m).toString(10)}},n.getNativeToken=l}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/token.cjs"}],[3044,{"./gas.cjs":3038,"bignumber.js":3087},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.calculateTotals=void 0;const s=e("bignumber.js"),r=e("./gas.cjs");function a(e){return{...i(e),human:o(e,e=>e.human),raw:o(e,e=>e.raw)}}function i(e){return{fiat:o(e,e=>e.fiat),usd:o(e,e=>e.usd)}}function o(e,t){return e.map(t).reduce((e,t)=>e.plus(t),new s.BigNumber(0)).toString(10)}n.calculateTotals=function({quotes:e,messenger:t,tokens:n,transaction:c}){const l=i(e.map(e=>e.fees.provider)),u=a(e.map(e=>e.fees.sourceNetwork.max)),d=a(e.map(e=>e.fees.sourceNetwork.estimate)),p=(0,r.calculateTransactionGasCost)(c,t),h=e?.length?{...i(e.map(e=>e.fees.targetNetwork)),isGasFeeToken:!1}:p,m=a(e.map(e=>e.sourceAmount)),f=n.filter(e=>!e.skipIfBalance),g=o(f,e=>e.amountFiat),S=o(f,e=>e.amountUsd),E=new s.BigNumber(l.fiat).plus(d.fiat).plus(h.fiat).plus(g).toString(10),_=new s.BigNumber(l.usd).plus(d.usd).plus(h.usd).plus(S).toString(10);return{estimatedDuration:Number(o(e,e=>e.estimatedDuration)),fees:{isSourceGasFeeToken:e.some(e=>e.fees.isSourceGasFeeToken),isTargetGasFeeToken:h.isGasFeeToken||e.some(e=>e.fees.isTargetGasFeeToken),provider:l,sourceNetwork:{estimate:d,max:u},targetNetwork:h},sourceAmount:m,total:{fiat:E,usd:_}}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/totals.cjs"}],[3045,{"../logger.cjs":3028,"./required-tokens.cjs":3040,"@metamask/transaction-controller":2994,"@metamask/utils":3116,lodash:4838},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.collectTransactionIds=n.updateTransaction=n.waitForTransactionConfirmed=n.pollTransactionChanges=n.getTransaction=n.FINALIZED_STATUSES=void 0;const s=e("@metamask/transaction-controller"),r=e("@metamask/utils"),a=e("lodash"),i=e("./required-tokens.cjs"),o=e("../logger.cjs"),c=(0,r.createModuleLogger)(o.projectLogger,"transaction");function l(e,t){return t.call("TransactionController:getState").transactions.find(t=>t.id===e)}n.FINALIZED_STATUSES=[s.TransactionStatus.confirmed,s.TransactionStatus.dropped,s.TransactionStatus.failed],n.getTransaction=l,n.pollTransactionChanges=function(e,t,s){e.subscribe("TransactionController:stateChange",(r,a)=>{const o=r.filter(e=>!a?.find(t=>t.id===e.id)),l=r.filter(e=>{const t=a?.find(t=>t.id===e.id);return t&&t?.txParams.data!==e.txParams.data});[...r.filter(e=>{const t=a?.find(t=>t.id===e.id);return t&&!n.FINALIZED_STATUSES.includes(t.status)&&n.FINALIZED_STATUSES.includes(e.status)}),...(a??[]).filter(e=>!r.find(t=>t.id===e.id))].forEach(e=>function(e,t){c("Transaction finalized",{transaction:e}),t(e.id)}(e,s)),[...o,...l].forEach(n=>function(e,t,n){const s=(0,i.parseRequiredTokens)(e,t);c("Transaction changed",{transaction:e,tokens:s}),n(e.id,e=>{e.tokens=s})}(n,e,t))},e=>e.transactions)},n.waitForTransactionConfirmed=function(e,t){return new Promise((n,r)=>{const a=(e,t)=>(c("Checking transaction status",e?.status,e?.type),e?.status===s.TransactionStatus.confirmed?(t?.(),n(),!0):!![s.TransactionStatus.dropped,s.TransactionStatus.failed].includes(e?.status)&&(t?.(),r(new Error(`Transaction failed - ${e?.type} - ${e?.error?.message}`)),!0)),i=t.call("TransactionController:getState").transactions.find(t=>t.id===e);if(a(i))return;const o=e=>{a(e,()=>t.unsubscribe("TransactionController:stateChange",o))};t.subscribe("TransactionController:stateChange",o,t=>t.transactions.find(t=>t.id===e))})},n.updateTransaction=function({transactionId:e,messenger:t,note:n},s){const r=l(e,t);if(!r)throw new Error(`Transaction not found: ${e}`);const i=(0,a.cloneDeep)(r);s(i),t.call("TransactionController:updateTransaction",i,n)},n.collectTransactionIds=function(e,t,n,s){const r=n=>{n.chainId===e&&n.txParams.from.toLowerCase()===t.toLowerCase()&&s(n.id)};return n.subscribe("TransactionController:unapprovedTransactionAdded",r),{end:()=>{n.unsubscribe("TransactionController:unapprovedTransactionAdded",r)}}}}}},{package:"@metamask/transaction-pay-controller",file:"node_modules/@metamask/transaction-pay-controller/dist/utils/transaction.cjs"}],[3046,{"./constants/bridge.cjs":3047,"./constants/chains.cjs":3048,"./constants/swaps.cjs":3049,"./constants/traces.cjs":3051,"./selectors.cjs":3053,"./types.cjs":3054,"./utils/assets.cjs":3055,"./utils/balance.cjs":3056,"./utils/bridge.cjs":3057,"./utils/caip-formatters.cjs":3058,"./utils/feature-flags.cjs":3059,"./utils/fetch.cjs":3061,"./utils/metrics/constants.cjs":3062,"./utils/metrics/properties.cjs":3063,"./utils/quote-fees.cjs":3064,"./utils/quote.cjs":3065,"./utils/snaps.cjs":3067,"@ethersproject/bignumber":737,"@ethersproject/contracts":746,"@ethersproject/providers":784,"@metamask/metamask-eth-abis":2263,"@metamask/polling-controller":2463},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,a,i,o,c,l,u,d,p,h,m,f,g,S,E,_,T,y,w,b,I,A,v,k,C=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},N=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.BridgeController=void 0;const R=e("@ethersproject/bignumber"),P=e("@ethersproject/contracts"),M=e("@ethersproject/providers"),O=e("@metamask/metamask-eth-abis"),D=e("@metamask/polling-controller"),L=e("./constants/bridge.cjs"),j=e("./constants/chains.cjs"),B=e("./constants/swaps.cjs"),x=e("./constants/traces.cjs"),F=e("./selectors.cjs"),U=e("./types.cjs"),H=e("./utils/assets.cjs"),q=e("./utils/balance.cjs"),G=e("./utils/bridge.cjs"),$=e("./utils/caip-formatters.cjs"),W=e("./utils/feature-flags.cjs"),V=e("./utils/fetch.cjs"),Y=e("./utils/metrics/constants.cjs"),K=e("./utils/metrics/properties.cjs"),Q=e("./utils/quote.cjs"),z=e("./utils/quote-fees.cjs"),X=e("./utils/snaps.cjs"),J={quoteRequest:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},quotes:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},quotesInitialLoadTime:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},quotesLastFetched:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},quotesLoadingStatus:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},quoteFetchError:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},quotesRefreshCount:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},assetExchangeRates:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},minimumBalanceForRentExemptionInLamports:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0}};class Z extends((0,D.StaticIntervalPollingController)()){constructor({messenger:e,state:t,clientId:n,clientVersion:D,getLayer1GasFee:Z,fetchFn:ee,config:te,trackMetaMetricsFn:ne,traceFn:se}){super({name:L.BRIDGE_CONTROLLER_NAME,metadata:J,messenger:e,state:{...(0,G.getDefaultBridgeControllerState)(),...t}}),s.add(this),r.set(this,void 0),a.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),d.set(this,void 0),p.set(this,void 0),this._executePoll=async e=>{await N(this,E,"f").call(this,e)},this.updateBridgeQuoteRequestParams=async(e,t)=>{N(this,v,"f").call(this,e),this.resetState(Y.AbortReason.QuoteRequestUpdated);const n={...L.DEFAULT_BRIDGE_CONTROLLER_STATE.quoteRequest,...e};if(this.update(e=>{e.quoteRequest=n}),await N(this,f,"f").call(this,n).catch(e=>console.warn("Failed to fetch asset exchange rates",e)),(0,Q.isValidQuoteRequest)(n)){C(this,a,Date.now(),"f");const r=(0,G.isNonEvmChainId)(n.srcChainId),i=r?undefined:N(this,s,"m",w).call(this,(0,$.formatChainIdToHex)(n.srcChainId))?.configuration;let o,c=Boolean(e.resetApproval);r?o=e.insufficientBal:i?.rpcUrl?.includes("tenderly")?o=!0:(this.update(e=>{e.quotesLoadingStatus=U.RequestStatus.LOADING}),c=await N(this,S,"f").call(this,n),o=e.insufficientBal??await N(this,g,"f").call(this,n)),this.setChainIntervalLength(),this.startPolling({updatedQuoteRequest:{...n,insufficientBal:o,resetApproval:c},context:t})}},this.fetchQuotes=async(e,t=null,n=null)=>{const r=(0,W.getBridgeFeatureFlags)(this.messenger),a=n?r.quoteRequestOverrides?.[n]:undefined,u=await N(this,S,"f").call(this,e),{quotes:d,validationFailures:m}=await(0,V.fetchBridgeQuotes)(a?{...e,...a,resetApproval:u}:{...e,resetApproval:u},t,N(this,i,"f"),N(this,l,"f"),N(this,p,"f").customBridgeApiBaseUrl??L.BRIDGE_PROD_API_BASE_URL,n,N(this,o,"f"));N(this,h,"f").call(this,m);const f=await(0,z.appendFeesToQuotes)(d,this.messenger,N(this,c,"f"),N(this,s,"m",y).call(this,e.walletAddress));return(0,Q.sortQuotes)(f,n)},h.set(this,e=>{0!==e.length&&this.trackUnifiedSwapBridgeEvent(Y.UnifiedSwapBridgeEventName.QuotesValidationFailed,{failures:e})}),m.set(this,()=>({...this.messenger.call("MultichainAssetsRatesController:getState"),...this.messenger.call("CurrencyRateController:getState"),...this.messenger.call("TokenRatesController:getState"),...this.state})),f.set(this,async({srcChainId:e,srcTokenAddress:t,destChainId:n,destTokenAddress:s})=>{const a=new Set([]),c=N(this,m,"f").call(this);t&&e&&!(0,F.selectIsAssetExchangeRateInState)(c,e,t)&&(0,H.getAssetIdsForToken)(t,e).forEach(e=>a.add(e)),s&&n&&!(0,F.selectIsAssetExchangeRateInState)(c,n,s)&&(0,H.getAssetIdsForToken)(s,n).forEach(e=>a.add(e));const u=this.messenger.call("CurrencyRateController:getState").currentCurrency;if(0===a.size)return;const d=await(0,V.fetchAssetPrices)({assetIds:a,currencies:new Set([u]),clientId:N(this,i,"f"),clientVersion:N(this,o,"f"),fetchFn:N(this,l,"f"),signal:N(this,r,"f")?.signal}),p=(0,H.toExchangeRates)(u,d);this.update(e=>{e.assetExchangeRates={...e.assetExchangeRates,...p}})}),g.set(this,async e=>{try{const t=(0,$.formatChainIdToHex)(e.srcChainId),n=N(this,s,"m",w).call(this,t)?.provider,r=(0,$.formatAddressToCaipReference)(e.srcTokenAddress);return!(n&&r&&e.srcTokenAmount&&t&&await(0,q.hasSufficientBalance)(n,e.walletAddress,r,e.srcTokenAmount,t))}catch(e){return console.warn("Failed to set insufficientBal",e),!0}}),S.set(this,async e=>{if((0,G.isNonEvmChainId)(e.srcChainId))return!1;try{const t=(0,$.formatAddressToCaipReference)(e.srcTokenAddress);if((0,G.isEthUsdt)(e.srcChainId,t)){const n=R.BigNumber.from(await N(this,k,"f").call(this,e.walletAddress,t,e.destChainId));return n.lt(e.srcTokenAmount)&&n.gt(0)}return!1}catch(e){return console.warn("Failed to set resetApproval",e),!0}}),this.stopPollingForQuotes=(e,t)=>{this.stopAllPolling(),this.state.quotesLoadingStatus===U.RequestStatus.LOADING&&t&&this.trackUnifiedSwapBridgeEvent(Y.UnifiedSwapBridgeEventName.QuotesReceived,t),N(this,r,"f")?.abort(e)},this.resetState=(e=Y.AbortReason.ResetState)=>{this.stopPollingForQuotes(e),this.update(e=>{e.quoteRequest=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quoteRequest,e.quotesInitialLoadTime=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotesInitialLoadTime,e.quotes=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotes,e.quotesLastFetched=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotesLastFetched,e.quotesLoadingStatus=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotesLoadingStatus,e.quoteFetchError=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quoteFetchError,e.quotesRefreshCount=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotesRefreshCount,e.assetExchangeRates=L.DEFAULT_BRIDGE_CONTROLLER_STATE.assetExchangeRates,e.minimumBalanceForRentExemptionInLamports=L.DEFAULT_BRIDGE_CONTROLLER_STATE.minimumBalanceForRentExemptionInLamports})},this.setChainIntervalLength=()=>{const{state:e}=this,{srcChainId:t}=e.quoteRequest,n=(0,W.getBridgeFeatureFlags)(this.messenger),s=t?n.chains[(0,$.formatChainIdToCaip)(t)]?.refreshRate:undefined,r=n.refreshRate;this.setIntervalLength(s??r)},E.set(this,async({updatedQuoteRequest:e,context:t})=>{N(this,r,"f")?.abort("New quote request"),C(this,r,new AbortController,"f"),this.trackUnifiedSwapBridgeEvent(Y.UnifiedSwapBridgeEventName.QuotesRequested,t);const{sse:n,maxRefreshCount:i}=(0,W.getBridgeFeatureFlags)(this.messenger),c=n?.enabled&&(0,W.hasMinimumRequiredVersion)(N(this,o,"f"),n.minimumVersion);this.update(t=>{t.quoteRequest=e,t.quoteFetchError=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quoteFetchError,t.quotesLastFetched=Date.now(),t.quotesLoadingStatus=U.RequestStatus.LOADING});try{await N(this,d,"f").call(this,{name:(0,G.isCrossChain)(e.srcChainId,e.destChainId)?x.TraceName.BridgeQuotesFetched:x.TraceName.SwapQuotesFetched,data:{srcChainId:(0,$.formatChainIdToCaip)(e.srcChainId),destChainId:(0,$.formatChainIdToCaip)(e.destChainId)}},async()=>{const t=N(this,s,"m",y).call(this,e.walletAddress);if(N(this,T,"f").call(this,e.srcChainId,t?.metadata?.snap?.id),c)return void await N(this,_,"f").call(this,e,t);const n=await this.fetchQuotes(e,N(this,r,"f")?.signal);this.update(e=>{e.quotesRefreshCount===L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotesRefreshCount&&N(this,a,"f")&&(e.quotesInitialLoadTime=Date.now()-N(this,a,"f")),e.quotes=n,e.quotesLoadingStatus=U.RequestStatus.FETCHED})})}catch(e){if(this.update(e=>{e.quotes=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotes}),e.toString().includes("AbortError")||e.toString().includes("FetchRequestCanceledException")||[Y.AbortReason.ResetState,Y.AbortReason.NewQuoteRequest,Y.AbortReason.QuoteRequestUpdated,Y.AbortReason.TransactionSubmitted].includes(e))return;this.update(t=>{let n;try{n=e?.message??e.toString()}catch{}finally{t.quoteFetchError=n??"Unknown error"}t.quotesLoadingStatus=U.RequestStatus.ERROR}),this.trackUnifiedSwapBridgeEvent(Y.UnifiedSwapBridgeEventName.QuotesError,t),console.log(`Failed to ${c?"stream":"fetch"} bridge quotes`,e)}this.update(e=>{e.quotesRefreshCount+=1}),(e.insufficientBal||!e.insufficientBal&&this.state.quotesRefreshCount>=i)&&this.stopAllPolling()}),_.set(this,async(e,t)=>{let n=0;const s=new Set;await(0,V.fetchBridgeQuoteStream)(N(this,l,"f"),e,N(this,r,"f")?.signal,N(this,i,"f"),N(this,p,"f").customBridgeApiBaseUrl??L.BRIDGE_PROD_API_BASE_URL,{onValidationFailure:N(this,h,"f"),onValidQuoteReceived:async e=>{const r=(async()=>{const s=await(0,z.appendFeesToQuotes)([e],this.messenger,N(this,c,"f"),t);s.length>0&&(n+=1),this.update(e=>{1===n&&(e.quotes=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotes,!e.quotesInitialLoadTime&&N(this,a,"f")&&(e.quotesInitialLoadTime=Date.now()-N(this,a,"f"))),e.quotes=[...e.quotes,...s]})})();s.add(r),r.catch(e=>{console.error("Error appending fees to quote",e)}).finally(()=>{s.delete(r)}),await r},onClose:async()=>{await Promise.allSettled(Array.from(s)),this.update(e=>{0===n&&(e.quotes=L.DEFAULT_BRIDGE_CONTROLLER_STATE.quotes),e.quotesLoadingStatus=U.RequestStatus.FETCHED})}},N(this,o,"f"))}),T.set(this,async(e,t)=>{if(!(0,G.isSolanaChainId)(e)||!t)return;const n=await(0,X.getMinimumBalanceForRentExemptionInLamports)(t,this.messenger);this.update(e=>{e.minimumBalanceForRentExemptionInLamports=n})}),b.set(this,()=>({slippage_limit:this.state.quoteRequest.slippage,swap_type:(0,K.getSwapTypeFromQuote)(this.state.quoteRequest),custom_slippage:(0,K.isCustomSlippage)(this.state.quoteRequest.slippage)})),I.set(this,()=>({quotes_count:this.state.quotes.length,quotes_list:this.state.quotes.map(({quote:e})=>(0,K.formatProviderLabel)(e)),initial_load_time_all_quotes:this.state.quotesInitialLoadTime??0})),A.set(this,(e,t)=>{const n={...t,action_type:Y.MetricsActionType.SWAPBRIDGE_V1};switch(e){case Y.UnifiedSwapBridgeEventName.ButtonClicked:case Y.UnifiedSwapBridgeEventName.PageViewed:return{...(0,K.getRequestParams)(this.state.quoteRequest),...n};case Y.UnifiedSwapBridgeEventName.QuotesValidationFailed:return{...(0,K.getRequestParams)(this.state.quoteRequest),refresh_count:this.state.quotesRefreshCount,...n};case Y.UnifiedSwapBridgeEventName.QuotesReceived:return{...(0,K.getRequestParams)(this.state.quoteRequest),...N(this,b,"f").call(this),...N(this,I,"f").call(this),is_hardware_wallet:(0,K.isHardwareWallet)(N(this,s,"m",y).call(this)),refresh_count:this.state.quotesRefreshCount,...n};case Y.UnifiedSwapBridgeEventName.QuotesRequested:return{...(0,K.getRequestParams)(this.state.quoteRequest),...N(this,b,"f").call(this),is_hardware_wallet:(0,K.isHardwareWallet)(N(this,s,"m",y).call(this)),has_sufficient_funds:!this.state.quoteRequest.insufficientBal,...n};case Y.UnifiedSwapBridgeEventName.QuotesError:return{...(0,K.getRequestParams)(this.state.quoteRequest),...N(this,b,"f").call(this),is_hardware_wallet:(0,K.isHardwareWallet)(N(this,s,"m",y).call(this)),error_message:this.state.quoteFetchError,has_sufficient_funds:!this.state.quoteRequest.insufficientBal,...n};case Y.UnifiedSwapBridgeEventName.AllQuotesOpened:case Y.UnifiedSwapBridgeEventName.AllQuotesSorted:case Y.UnifiedSwapBridgeEventName.QuoteSelected:return{...(0,K.getRequestParams)(this.state.quoteRequest),...N(this,b,"f").call(this),...N(this,I,"f").call(this),is_hardware_wallet:(0,K.isHardwareWallet)(N(this,s,"m",y).call(this)),...n};case Y.UnifiedSwapBridgeEventName.Failed:return{...n,...(0,K.getRequestParams)(this.state.quoteRequest),...N(this,b,"f").call(this),...N(this,I,"f").call(this),...t};case Y.UnifiedSwapBridgeEventName.AssetDetailTooltipClicked:return n;case Y.UnifiedSwapBridgeEventName.Submitted:case Y.UnifiedSwapBridgeEventName.Completed:return t;case Y.UnifiedSwapBridgeEventName.InputChanged:default:return n}}),v.set(this,e=>{Object.entries(e).forEach(([t,n])=>{const s=K.toInputChangedPropertyKey[t],r=K.toInputChangedPropertyValue[t]?.(e);s&&r!==undefined&&n!==this.state.quoteRequest[t]&&this.trackUnifiedSwapBridgeEvent(Y.UnifiedSwapBridgeEventName.InputChanged,{input:s,input_value:r})})}),this.trackUnifiedSwapBridgeEvent=(e,t)=>{try{const n=N(this,A,"f").call(this,e,t);N(this,u,"f").call(this,e,n)}catch(t){console.error(`Error tracking cross-chain swaps MetaMetrics event ${e}`,t)}},k.set(this,async(e,t,n)=>{const r=N(this,s,"m",w).call(this,j.CHAIN_IDS.MAINNET),a=r?.provider;if(!a)throw new Error("No provider found");const i=new M.Web3Provider(a),o=new P.Contract(t,O.abiERC20,i),c=(0,G.isCrossChain)(j.CHAIN_IDS.MAINNET,n)?L.METABRIDGE_ETHEREUM_ADDRESS:B.SWAPS_CONTRACT_ADDRESSES[j.CHAIN_IDS.MAINNET];return(await o.allowance(e,c)).toString()}),this.setIntervalLength(L.REFRESH_INTERVAL_MS),C(this,r,new AbortController,"f"),C(this,c,Z,"f"),C(this,i,n,"f"),C(this,o,D,"f"),C(this,l,ee,"f"),C(this,u,ne,"f"),C(this,p,te??{},"f"),C(this,d,se??((e,t)=>t?.()),"f"),this.messenger.registerActionHandler(`${L.BRIDGE_CONTROLLER_NAME}:setChainIntervalLength`,this.setChainIntervalLength.bind(this)),this.messenger.registerActionHandler(`${L.BRIDGE_CONTROLLER_NAME}:updateBridgeQuoteRequestParams`,this.updateBridgeQuoteRequestParams.bind(this)),this.messenger.registerActionHandler(`${L.BRIDGE_CONTROLLER_NAME}:resetState`,this.resetState.bind(this)),this.messenger.registerActionHandler(`${L.BRIDGE_CONTROLLER_NAME}:trackUnifiedSwapBridgeEvent`,this.trackUnifiedSwapBridgeEvent.bind(this)),this.messenger.registerActionHandler(`${L.BRIDGE_CONTROLLER_NAME}:stopPollingForQuotes`,this.stopPollingForQuotes.bind(this)),this.messenger.registerActionHandler(`${L.BRIDGE_CONTROLLER_NAME}:fetchQuotes`,this.fetchQuotes.bind(this))}}n.BridgeController=Z,r=new WeakMap,a=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,p=new WeakMap,h=new WeakMap,m=new WeakMap,f=new WeakMap,g=new WeakMap,S=new WeakMap,E=new WeakMap,_=new WeakMap,T=new WeakMap,b=new WeakMap,I=new WeakMap,A=new WeakMap,v=new WeakMap,k=new WeakMap,s=new WeakSet,y=function(e){const t=e??this.state.quoteRequest.walletAddress;if(!t)throw new Error("Account address is required");return this.messenger.call("AccountsController:getAccountByAddress",t)},w=function(e){const t=this.messenger.call("NetworkController:findNetworkClientIdByChainId",e);if(!t)throw new Error(`No network client found for chainId: ${e}`);return this.messenger.call("NetworkController:getNetworkClientById",t)}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/bridge-controller.cjs"}],[3047,{"./chains.cjs":3048,"@ethersproject/constants":743,"@metamask/keyring-api":2193},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.METABRIDGE_CHAIN_TO_ADDRESS_MAP=n.DEFAULT_BRIDGE_CONTROLLER_STATE=n.DEFAULT_FEATURE_FLAG_CONFIG=n.BRIDGE_CONTROLLER_NAME=n.DEFAULT_MAX_REFRESH_COUNT=n.REFRESH_INTERVAL_MS=n.BRIDGE_MM_FEE_RATE=n.BRIDGE_PREFERRED_GAS_ESTIMATE=n.BRIDGE_QUOTE_MAX_RETURN_DIFFERENCE_PERCENTAGE=n.BRIDGE_QUOTE_MAX_ETA_SECONDS=n.METABRIDGE_ETHEREUM_ADDRESS=n.ETH_USDT_ADDRESS=n.BridgeClientId=n.BRIDGE_PROD_API_BASE_URL=n.BRIDGE_DEV_API_BASE_URL=n.ALLOWED_BRIDGE_CHAIN_IDS=void 0;const s=e("@ethersproject/constants"),r=e("@metamask/keyring-api"),a=e("./chains.cjs");var i;n.ALLOWED_BRIDGE_CHAIN_IDS=[a.CHAIN_IDS.MAINNET,a.CHAIN_IDS.BSC,a.CHAIN_IDS.POLYGON,a.CHAIN_IDS.ZKSYNC_ERA,a.CHAIN_IDS.AVALANCHE,a.CHAIN_IDS.OPTIMISM,a.CHAIN_IDS.ARBITRUM,a.CHAIN_IDS.LINEA_MAINNET,a.CHAIN_IDS.BASE,a.CHAIN_IDS.SEI,a.CHAIN_IDS.MONAD,r.SolScope.Mainnet,r.BtcScope.Mainnet,r.TrxScope.Mainnet],n.BRIDGE_DEV_API_BASE_URL="https://bridge.dev-api.cx.metamask.io",n.BRIDGE_PROD_API_BASE_URL="https://bridge.api.cx.metamask.io",function(e){e.EXTENSION="extension",e.MOBILE="mobile"}(i||(n.BridgeClientId=i={})),n.ETH_USDT_ADDRESS="0xdac17f958d2ee523a2206206994597c13d831ec7",n.METABRIDGE_ETHEREUM_ADDRESS="0x0439e60F02a8900a951603950d8D4527f400C3f1",n.BRIDGE_QUOTE_MAX_ETA_SECONDS=3600,n.BRIDGE_QUOTE_MAX_RETURN_DIFFERENCE_PERCENTAGE=.5,n.BRIDGE_PREFERRED_GAS_ESTIMATE="medium",n.BRIDGE_MM_FEE_RATE=.875,n.REFRESH_INTERVAL_MS=3e4,n.DEFAULT_MAX_REFRESH_COUNT=5,n.BRIDGE_CONTROLLER_NAME="BridgeController",n.DEFAULT_FEATURE_FLAG_CONFIG={minimumVersion:"0.0.0",refreshRate:n.REFRESH_INTERVAL_MS,maxRefreshCount:n.DEFAULT_MAX_REFRESH_COUNT,support:!1,chains:{}},n.DEFAULT_BRIDGE_CONTROLLER_STATE={quoteRequest:{srcTokenAddress:s.AddressZero},quotesInitialLoadTime:null,quotes:[],quotesLastFetched:null,quotesLoadingStatus:null,quoteFetchError:null,quotesRefreshCount:0,assetExchangeRates:{},minimumBalanceForRentExemptionInLamports:"0"},n.METABRIDGE_CHAIN_TO_ADDRESS_MAP={[a.CHAIN_IDS.MAINNET]:n.METABRIDGE_ETHEREUM_ADDRESS}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/constants/bridge.cjs"}],[3048,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.NETWORK_TO_NAME_MAP=n.MONAD_DISPLAY_NAME=n.SEI_DISPLAY_NAME=n.MODE_DISPLAY_NAME=n.MODE_SEPOLIA_DISPLAY_NAME=n.SONEIUM_DISPLAY_NAME=n.INK_DISPLAY_NAME=n.INK_SEPOLIA_DISPLAY_NAME=n.LISK_SEPOLIA_DISPLAY_NAME=n.LISK_DISPLAY_NAME=n.METACHAIN_ONE_DISPLAY_NAME=n.BERACHAIN_DISPLAY_NAME=n.OP_BNB_DISPLAY_NAME=n.SCROLL_SEPOLIA_DISPLAY_NAME=n.SCROLL_DISPLAY_NAME=n.MOONRIVER_DISPLAY_NAME=n.MOONBEAM_DISPLAY_NAME=n.POLYGON_ZKEVM_DISPLAY_NAME=n.CRONOS_DISPLAY_NAME=n.AURORA_DISPLAY_NAME=n.BASE_DISPLAY_NAME=n.ZK_SYNC_ERA_DISPLAY_NAME=n.GNOSIS_DISPLAY_NAME=n.CELO_DISPLAY_NAME=n.PALM_DISPLAY_NAME=n.HARMONY_DISPLAY_NAME=n.FANTOM_DISPLAY_NAME=n.OPTIMISM_DISPLAY_NAME=n.BNB_DISPLAY_NAME=n.ARBITRUM_DISPLAY_NAME=n.AVALANCHE_DISPLAY_NAME=n.POLYGON_DISPLAY_NAME=n.BSC_DISPLAY_NAME=n.LOCALHOST_DISPLAY_NAME=n.LINEA_MAINNET_DISPLAY_NAME=n.LINEA_SEPOLIA_DISPLAY_NAME=n.LINEA_GOERLI_DISPLAY_NAME=n.SEPOLIA_DISPLAY_NAME=n.GOERLI_DISPLAY_NAME=n.MAINNET_DISPLAY_NAME=n.NETWORK_TYPES=n.CHAIN_IDS=void 0,n.CHAIN_IDS={MAINNET:"0x1",GOERLI:"0x5",LOCALHOST:"0x539",BSC:"0x38",BSC_TESTNET:"0x61",OPTIMISM:"0xa",OPTIMISM_TESTNET:"0xaa37dc",OPTIMISM_GOERLI:"0x1a4",BASE:"0x2105",BASE_TESTNET:"0x14a33",OPBNB:"0xcc",OPBNB_TESTNET:"0x15eb",POLYGON:"0x89",POLYGON_TESTNET:"0x13881",AVALANCHE:"0xa86a",AVALANCHE_TESTNET:"0xa869",FANTOM:"0xfa",FANTOM_TESTNET:"0xfa2",CELO:"0xa4ec",ARBITRUM:"0xa4b1",HARMONY:"0x63564c40",PALM:"0x2a15c308d",SEPOLIA:"0xaa36a7",HOLESKY:"0x4268",LINEA_GOERLI:"0xe704",LINEA_SEPOLIA:"0xe705",AMOY:"0x13882",BASE_SEPOLIA:"0x14a34",BLAST_SEPOLIA:"0xa0c71fd",OPTIMISM_SEPOLIA:"0xaa37dc",PALM_TESTNET:"0x2a15c3083",CELO_TESTNET:"0xaef3",ZK_SYNC_ERA_TESTNET:"0x12c",MANTA_SEPOLIA:"0x138b",UNICHAIN_SEPOLIA:"0x515",LINEA_MAINNET:"0xe708",AURORA:"0x4e454152",MOONBEAM:"0x504",MOONBEAM_TESTNET:"0x507",MOONRIVER:"0x505",CRONOS:"0x19",GNOSIS:"0x64",ZKSYNC_ERA:"0x144",TEST_ETH:"0x539",ARBITRUM_GOERLI:"0x66eed",BLAST:"0x13e31",FILECOIN:"0x13a",POLYGON_ZKEVM:"0x44d",SCROLL:"0x82750",SCROLL_SEPOLIA:"0x8274f",WETHIO:"0x4e",CHZ:"0x15b38",NUMBERS:"0x290b",SEI:"0x531",APE_TESTNET:"0x8157",APE_MAINNET:"0x8173",BERACHAIN:"0x138d5",METACHAIN_ONE:"0x1b6e6",ARBITRUM_SEPOLIA:"0x66eee",NEAR:"0x18d",NEAR_TESTNET:"0x18e",B3:"0x208d",B3_TESTNET:"0x7c9",GRAVITY_ALPHA_MAINNET:"0x659",GRAVITY_ALPHA_TESTNET_SEPOLIA:"0x34c1",LISK:"0x46f",LISK_SEPOLIA:"0x106a",INK_SEPOLIA:"0xba5eD",INK:"0xdef1",MODE_SEPOLIA:"0x397",MODE:"0x868b",MONAD:"0x8f"},n.NETWORK_TYPES={GOERLI:"goerli",LOCALHOST:"localhost",MAINNET:"mainnet",SEPOLIA:"sepolia",LINEA_GOERLI:"linea-goerli",LINEA_SEPOLIA:"linea-sepolia",LINEA_MAINNET:"linea-mainnet"},n.MAINNET_DISPLAY_NAME="Ethereum Mainnet",n.GOERLI_DISPLAY_NAME="Goerli",n.SEPOLIA_DISPLAY_NAME="Sepolia",n.LINEA_GOERLI_DISPLAY_NAME="Linea Goerli",n.LINEA_SEPOLIA_DISPLAY_NAME="Linea Sepolia",n.LINEA_MAINNET_DISPLAY_NAME="Linea Mainnet",n.LOCALHOST_DISPLAY_NAME="Localhost 8545",n.BSC_DISPLAY_NAME="Binance Smart Chain",n.POLYGON_DISPLAY_NAME="Polygon",n.AVALANCHE_DISPLAY_NAME="Avalanche Network C-Chain",n.ARBITRUM_DISPLAY_NAME="Arbitrum One",n.BNB_DISPLAY_NAME="BNB Chain",n.OPTIMISM_DISPLAY_NAME="OP Mainnet",n.FANTOM_DISPLAY_NAME="Fantom Opera",n.HARMONY_DISPLAY_NAME="Harmony Mainnet Shard 0",n.PALM_DISPLAY_NAME="Palm",n.CELO_DISPLAY_NAME="Celo Mainnet",n.GNOSIS_DISPLAY_NAME="Gnosis",n.ZK_SYNC_ERA_DISPLAY_NAME="zkSync Era Mainnet",n.BASE_DISPLAY_NAME="Base Mainnet",n.AURORA_DISPLAY_NAME="Aurora Mainnet",n.CRONOS_DISPLAY_NAME="Cronos",n.POLYGON_ZKEVM_DISPLAY_NAME="Polygon zkEVM",n.MOONBEAM_DISPLAY_NAME="Moonbeam",n.MOONRIVER_DISPLAY_NAME="Moonriver",n.SCROLL_DISPLAY_NAME="Scroll",n.SCROLL_SEPOLIA_DISPLAY_NAME="Scroll Sepolia",n.OP_BNB_DISPLAY_NAME="opBNB",n.BERACHAIN_DISPLAY_NAME="Berachain Artio",n.METACHAIN_ONE_DISPLAY_NAME="Metachain One Mainnet",n.LISK_DISPLAY_NAME="Lisk",n.LISK_SEPOLIA_DISPLAY_NAME="Lisk Sepolia",n.INK_SEPOLIA_DISPLAY_NAME="Ink Sepolia",n.INK_DISPLAY_NAME="Ink Mainnet",n.SONEIUM_DISPLAY_NAME="Soneium Mainnet",n.MODE_SEPOLIA_DISPLAY_NAME="Mode Sepolia",n.MODE_DISPLAY_NAME="Mode Mainnet",n.SEI_DISPLAY_NAME="Sei Network",n.MONAD_DISPLAY_NAME="Monad",n.NETWORK_TO_NAME_MAP={[n.NETWORK_TYPES.GOERLI]:n.GOERLI_DISPLAY_NAME,[n.NETWORK_TYPES.MAINNET]:n.MAINNET_DISPLAY_NAME,[n.NETWORK_TYPES.LINEA_GOERLI]:n.LINEA_GOERLI_DISPLAY_NAME,[n.NETWORK_TYPES.LINEA_SEPOLIA]:n.LINEA_SEPOLIA_DISPLAY_NAME,[n.NETWORK_TYPES.LINEA_MAINNET]:n.LINEA_MAINNET_DISPLAY_NAME,[n.NETWORK_TYPES.LOCALHOST]:n.LOCALHOST_DISPLAY_NAME,[n.NETWORK_TYPES.SEPOLIA]:n.SEPOLIA_DISPLAY_NAME,[n.CHAIN_IDS.ARBITRUM]:n.ARBITRUM_DISPLAY_NAME,[n.CHAIN_IDS.AVALANCHE]:n.AVALANCHE_DISPLAY_NAME,[n.CHAIN_IDS.BSC]:n.BSC_DISPLAY_NAME,[n.CHAIN_IDS.BASE]:n.BASE_DISPLAY_NAME,[n.CHAIN_IDS.GOERLI]:n.GOERLI_DISPLAY_NAME,[n.CHAIN_IDS.MAINNET]:n.MAINNET_DISPLAY_NAME,[n.CHAIN_IDS.LINEA_GOERLI]:n.LINEA_GOERLI_DISPLAY_NAME,[n.CHAIN_IDS.LINEA_MAINNET]:n.LINEA_MAINNET_DISPLAY_NAME,[n.CHAIN_IDS.LINEA_SEPOLIA]:n.LINEA_SEPOLIA_DISPLAY_NAME,[n.CHAIN_IDS.LOCALHOST]:n.LOCALHOST_DISPLAY_NAME,[n.CHAIN_IDS.OPTIMISM]:n.OPTIMISM_DISPLAY_NAME,[n.CHAIN_IDS.POLYGON]:n.POLYGON_DISPLAY_NAME,[n.CHAIN_IDS.SCROLL]:n.SCROLL_DISPLAY_NAME,[n.CHAIN_IDS.SCROLL_SEPOLIA]:n.SCROLL_SEPOLIA_DISPLAY_NAME,[n.CHAIN_IDS.SEPOLIA]:n.SEPOLIA_DISPLAY_NAME,[n.CHAIN_IDS.OPBNB]:n.OP_BNB_DISPLAY_NAME,[n.CHAIN_IDS.ZKSYNC_ERA]:n.ZK_SYNC_ERA_DISPLAY_NAME,[n.CHAIN_IDS.BERACHAIN]:n.BERACHAIN_DISPLAY_NAME,[n.CHAIN_IDS.METACHAIN_ONE]:n.METACHAIN_ONE_DISPLAY_NAME,[n.CHAIN_IDS.LISK]:n.LISK_DISPLAY_NAME,[n.CHAIN_IDS.LISK_SEPOLIA]:n.LISK_SEPOLIA_DISPLAY_NAME,[n.CHAIN_IDS.SEI]:n.SEI_DISPLAY_NAME,[n.CHAIN_IDS.MONAD]:n.MONAD_DISPLAY_NAME}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/constants/chains.cjs"}],[3049,{"./chains.cjs":3048},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ALLOWED_CONTRACT_ADDRESSES=n.SWAPS_WRAPPED_TOKENS_ADDRESSES=n.SWAPS_CONTRACT_ADDRESSES=n.SWAPS_API_V2_BASE_URL=void 0;const s=e("./chains.cjs");n.SWAPS_API_V2_BASE_URL="https://swap.api.cx.metamask.io";const r="0x881d40237659c251811cec9c364ef91dc08d300c";n.SWAPS_CONTRACT_ADDRESSES={[s.CHAIN_IDS.MAINNET]:r,[s.CHAIN_IDS.LOCALHOST]:r,[s.CHAIN_IDS.BSC]:"0x1a1ec25dc08e98e5e93f1104b5e5cdd298707d31",[s.CHAIN_IDS.POLYGON]:"0x1a1ec25dc08e98e5e93f1104b5e5cdd298707d31",[s.CHAIN_IDS.AVALANCHE]:"0x1a1ec25dc08e98e5e93f1104b5e5cdd298707d31",[s.CHAIN_IDS.ARBITRUM]:"0x9dda6ef3d919c9bc8885d5560999a3640431e8e6",[s.CHAIN_IDS.OPTIMISM]:"0x9dda6ef3d919c9bc8885d5560999a3640431e8e6",[s.CHAIN_IDS.ZKSYNC_ERA]:"0xf504c1fe13d14df615e66dcd0abf39e60c697f34",[s.CHAIN_IDS.LINEA_MAINNET]:"0x9dda6ef3d919c9bc8885d5560999a3640431e8e6",[s.CHAIN_IDS.BASE]:"0x9dda6ef3d919c9bc8885d5560999a3640431e8e6",[s.CHAIN_IDS.SEI]:"0x962287c9d5B8a682389E61edAE90ec882325d08b"};const a="0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2";n.SWAPS_WRAPPED_TOKENS_ADDRESSES={[s.CHAIN_IDS.MAINNET]:a,[s.CHAIN_IDS.LOCALHOST]:a,[s.CHAIN_IDS.BSC]:"0xbb4cdb9cbd36b01bd1cbaebf2de08d9173bc095c",[s.CHAIN_IDS.POLYGON]:"0x0d500b1d8e8ef31e21c99d1db9a6444d3adf1270",[s.CHAIN_IDS.AVALANCHE]:"0xb31f66aa3c1e785363f0875a1b74e27b85fd66c7",[s.CHAIN_IDS.ARBITRUM]:"0x82af49447d8a07e3bd95bd0d56f35241523fbab1",[s.CHAIN_IDS.OPTIMISM]:"0x4200000000000000000000000000000000000006",[s.CHAIN_IDS.ZKSYNC_ERA]:"0x5AEa5775959fBC2557Cc8789bC1bf90A239D9a91",[s.CHAIN_IDS.LINEA_MAINNET]:"0xe5D7C2a44FfDDf6b295A15c148167daaAf5Cf34f",[s.CHAIN_IDS.BASE]:"0x4200000000000000000000000000000000000006",[s.CHAIN_IDS.SEI]:"0xe30fedd158a2e3b13e9badaeabafc5516e95e8c7"},n.ALLOWED_CONTRACT_ADDRESSES={[s.CHAIN_IDS.MAINNET]:[n.SWAPS_CONTRACT_ADDRESSES[s.CHAIN_IDS.MAINNET],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[s.CHAIN_IDS.MAINNET]],[s.CHAIN_IDS.LOCALHOST]:[n.SWAPS_CONTRACT_ADDRESSES[s.CHAIN_IDS.LOCALHOST],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[s.CHAIN_IDS.LOCALHOST]],[s.CHAIN_IDS.BSC]:[n.SWAPS_CONTRACT_ADDRESSES[s.CHAIN_IDS.BSC],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[s.CHAIN_IDS.BSC]],[s.CHAIN_IDS.POLYGON]:[n.SWAPS_CONTRACT_ADDRESSES[s.CHAIN_IDS.POLYGON],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[s.CHAIN_IDS.POLYGON]],[s.CHAIN_IDS.AVALANCHE]:[n.SWAPS_CONTRACT_ADDRESSES[s.CHAIN_IDS.AVALANCHE],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[s.CHAIN_IDS.AVALANCHE]],[s.CHAIN_IDS.ARBITRUM]:[n.SWAPS_CONTRACT_ADDRESSES[s.CHAIN_IDS.ARBITRUM],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[s.CHAIN_IDS.ARBITRUM]],[s.CHAIN_IDS.OPTIMISM]:[n.SWAPS_CONTRACT_ADDRESSES[s.CHAIN_IDS.OPTIMISM],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[s.CHAIN_IDS.OPTIMISM]],[s.CHAIN_IDS.ZKSYNC_ERA]:[n.SWAPS_CONTRACT_ADDRESSES[s.CHAIN_IDS.ZKSYNC_ERA],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[s.CHAIN_IDS.ZKSYNC_ERA]],[s.CHAIN_IDS.LINEA_MAINNET]:[n.SWAPS_CONTRACT_ADDRESSES[s.CHAIN_IDS.LINEA_MAINNET],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[s.CHAIN_IDS.LINEA_MAINNET]],[s.CHAIN_IDS.BASE]:[n.SWAPS_CONTRACT_ADDRESSES[s.CHAIN_IDS.BASE],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[s.CHAIN_IDS.BASE]],[s.CHAIN_IDS.SEI]:[n.SWAPS_CONTRACT_ADDRESSES[s.CHAIN_IDS.SEI],n.SWAPS_WRAPPED_TOKENS_ADDRESSES[s.CHAIN_IDS.SEI]]}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/constants/swaps.cjs"}],[305,{"../../../shared/lib/promise-with-resolvers":5889,lodash:4838,loglevel:4846},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OperationSafener=void 0;var s,r=e("lodash"),a=(s=e("loglevel"))&&s.__esModule?s:{default:s},i=e("../../../shared/lib/promise-with-resolvers");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function l(e,t){return e.get(d(e,t))}function u(e,t,n){return e.set(d(e,t),n),n}function d(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var p=new WeakMap,h=new WeakMap;n.OperationSafener=class{constructor({op:e,wait:t,options:n}){c(this,p,void 0),c(this,h,null),o(this,"evacuate",()=>{if(l(h,this))return a.default.warn("already evacuating"),l(h,this);const e=l(p,this).flush();if(e){const{promise:t,resolve:n}=(0,i.withResolvers)();e.finally(n),u(h,this,t)}else u(h,this,Promise.resolve());return l(h,this)}),o(this,"execute",(...e)=>l(h,this)?(a.default.warn("evacuating, ignoring call to `execute`"),!1):(l(p,this).call(this,...e),!0));const s={mode:"exclusive"};u(p,this,(0,r.debounce)((...t)=>navigator.locks.request("operation-safener-lock",s,()=>e(...t)),t,n))}}}}},{package:"$root$",file:"app/scripts/lib/operation-safener.ts"}],[3050,{"./chains.cjs":3048,"@metamask/keyring-api":2193},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SYMBOL_TO_SLIP44_MAP=n.SWAPS_CHAINID_DEFAULT_TOKEN_MAP=n.DEFAULT_TOKEN_ADDRESS=void 0;const s=e("@metamask/keyring-api"),r=e("./chains.cjs");n.DEFAULT_TOKEN_ADDRESS="0x0000000000000000000000000000000000000000";const a="AVAX",i="BNB",o="ETH",c="POL",l="TESTETH",u="SOL",d="SEI",p="BTC",h="TRX",m="MON",f={symbol:o,name:"Ether",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""},g={symbol:i,name:"Binance Coin",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""},S={symbol:c,name:"Polygon",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""},E={symbol:a,name:"Avalanche",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""},_={symbol:l,name:"Test Ether",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""},T={symbol:o,name:"Ether",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""},y={symbol:o,name:"Ether",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""},w={...f},b={...f},I={...f},A={...f},v={...f},k={symbol:u,name:"Solana",address:n.DEFAULT_TOKEN_ADDRESS,decimals:9,iconUrl:""},C={symbol:p,name:"Bitcoin",address:n.DEFAULT_TOKEN_ADDRESS,decimals:8,iconUrl:""},N={symbol:d,name:"Sei",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""},R={symbol:h,name:"Tron",address:n.DEFAULT_TOKEN_ADDRESS,decimals:6,iconUrl:""},P={symbol:m,name:"Mon",address:n.DEFAULT_TOKEN_ADDRESS,decimals:18,iconUrl:""};n.SWAPS_CHAINID_DEFAULT_TOKEN_MAP={[r.CHAIN_IDS.MAINNET]:f,[r.CHAIN_IDS.LOCALHOST]:_,[r.CHAIN_IDS.BSC]:g,[r.CHAIN_IDS.POLYGON]:S,[r.CHAIN_IDS.GOERLI]:T,[r.CHAIN_IDS.SEPOLIA]:y,[r.CHAIN_IDS.AVALANCHE]:E,[r.CHAIN_IDS.OPTIMISM]:b,[r.CHAIN_IDS.ARBITRUM]:w,[r.CHAIN_IDS.ZKSYNC_ERA]:I,[r.CHAIN_IDS.LINEA_MAINNET]:A,[r.CHAIN_IDS.BASE]:v,[r.CHAIN_IDS.SEI]:N,[r.CHAIN_IDS.MONAD]:P,[s.SolScope.Mainnet]:k,[s.SolScope.Devnet]:k,[s.BtcScope.Mainnet]:C,[s.TrxScope.Mainnet]:R},n.SYMBOL_TO_SLIP44_MAP={SOL:"slip44:501",BTC:"slip44:0",ETH:"slip44:60",POL:"slip44:966",BNB:"slip44:714",AVAX:"slip44:9000",TESTETH:"slip44:60",SEI:"slip44:19000118",TRX:"slip44:195",MON:"slip44:268435779"}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/constants/tokens.cjs"}],[3051,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s;Object.defineProperty(n,"__esModule",{value:!0}),n.TraceName=void 0,function(e){e.BridgeQuotesFetched="Bridge Quotes Fetched",e.SwapQuotesFetched="Swap Quotes Fetched"}(s||(n.TraceName=s={}))}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/constants/traces.cjs"}],[3052,{"./bridge-controller.cjs":3046,"./constants/bridge.cjs":3047,"./constants/swaps.cjs":3049,"./constants/tokens.cjs":3050,"./selectors.cjs":3053,"./types.cjs":3054,"./utils/balance.cjs":3056,"./utils/bridge.cjs":3057,"./utils/caip-formatters.cjs":3058,"./utils/feature-flags.cjs":3059,"./utils/fetch.cjs":3061,"./utils/metrics/constants.cjs":3062,"./utils/metrics/properties.cjs":3063,"./utils/quote.cjs":3065,"./utils/slippage.cjs":3066,"./utils/swaps.cjs":3068,"./utils/trade-utils.cjs":3069,"./utils/validators.cjs":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isValidQuoteRequest=n.isCrossChain=n.getDefaultBridgeControllerState=n.getNativeAssetForChainId=n.isNonEvmChainId=n.isBitcoinChainId=n.isSolanaChainId=n.isNativeAddress=n.isEthUsdt=n.MetricsSwapType=n.MetricsActionType=n.ALLOWED_CONTRACT_ADDRESSES=n.SWAPS_WRAPPED_TOKENS_ADDRESSES=n.SWAPS_CONTRACT_ADDRESSES=n.SWAPS_API_V2_BASE_URL=n.SWAPS_CHAINID_DEFAULT_TOKEN_MAP=n.BRIDGE_PROD_API_BASE_URL=n.BRIDGE_DEV_API_BASE_URL=n.METABRIDGE_CHAIN_TO_ADDRESS_MAP=n.DEFAULT_BRIDGE_CONTROLLER_STATE=n.DEFAULT_MAX_REFRESH_COUNT=n.REFRESH_INTERVAL_MS=n.BRIDGE_MM_FEE_RATE=n.BRIDGE_PREFERRED_GAS_ESTIMATE=n.BRIDGE_QUOTE_MAX_RETURN_DIFFERENCE_PERCENTAGE=n.BRIDGE_QUOTE_MAX_ETA_SECONDS=n.BRIDGE_CONTROLLER_NAME=n.BridgeClientId=n.ALLOWED_BRIDGE_CHAIN_IDS=n.FeatureId=n.BridgeAssetSchema=n.ActionTypes=n.FeeType=n.BridgeBackgroundAction=n.BridgeUserAction=n.RequestStatus=n.ChainId=n.SortOrder=n.AssetType=n.StatusTypes=n.AbortReason=n.getQuotesReceivedProperties=n.isCustomSlippage=n.isHardwareWallet=n.getSwapType=n.getRequestParams=n.formatProviderLabel=n.UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY=n.UnifiedSwapBridgeEventName=n.BridgeController=void 0,n.fetchTokens=n.getSwapsContractAddress=n.isValidSwapsContractAddress=n.BRIDGE_DEFAULT_SLIPPAGE=n.getBridgeFeatureFlags=n.DEFAULT_FEATURE_FLAG_CONFIG=n.selectMinimumBalanceForRentExemptionInSOL=n.selectBridgeFeatureFlags=n.selectIsQuoteExpired=n.selectExchangeRateByChainIdAndAddress=n.selectDefaultSlippagePercentage=n.selectBridgeQuotes=n.isEvmTxData=n.isTronTrade=n.isBitcoinTrade=n.extractTradeData=n.formatAddressToAssetId=n.formatAddressToCaipReference=n.formatChainIdToHex=n.formatChainIdToCaip=n.getClientHeaders=n.fetchBridgeTokens=n.calcLatestSrcBalance=n.calcSlippagePercentage=n.formatEtaInMinutes=void 0;var s=e("./bridge-controller.cjs");Object.defineProperty(n,"BridgeController",{enumerable:!0,get:function(){return s.BridgeController}});var r=e("./utils/metrics/constants.cjs");Object.defineProperty(n,"UnifiedSwapBridgeEventName",{enumerable:!0,get:function(){return r.UnifiedSwapBridgeEventName}}),Object.defineProperty(n,"UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY",{enumerable:!0,get:function(){return r.UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY}});var a=e("./utils/metrics/properties.cjs");Object.defineProperty(n,"formatProviderLabel",{enumerable:!0,get:function(){return a.formatProviderLabel}}),Object.defineProperty(n,"getRequestParams",{enumerable:!0,get:function(){return a.getRequestParams}}),Object.defineProperty(n,"getSwapType",{enumerable:!0,get:function(){return a.getSwapType}}),Object.defineProperty(n,"isHardwareWallet",{enumerable:!0,get:function(){return a.isHardwareWallet}}),Object.defineProperty(n,"isCustomSlippage",{enumerable:!0,get:function(){return a.isCustomSlippage}}),Object.defineProperty(n,"getQuotesReceivedProperties",{enumerable:!0,get:function(){return a.getQuotesReceivedProperties}});var i=e("./utils/metrics/constants.cjs");Object.defineProperty(n,"AbortReason",{enumerable:!0,get:function(){return i.AbortReason}});var o=e("./types.cjs");Object.defineProperty(n,"StatusTypes",{enumerable:!0,get:function(){return o.StatusTypes}});var c=e("./types.cjs");Object.defineProperty(n,"AssetType",{enumerable:!0,get:function(){return c.AssetType}}),Object.defineProperty(n,"SortOrder",{enumerable:!0,get:function(){return c.SortOrder}}),Object.defineProperty(n,"ChainId",{enumerable:!0,get:function(){return c.ChainId}}),Object.defineProperty(n,"RequestStatus",{enumerable:!0,get:function(){return c.RequestStatus}}),Object.defineProperty(n,"BridgeUserAction",{enumerable:!0,get:function(){return c.BridgeUserAction}}),Object.defineProperty(n,"BridgeBackgroundAction",{enumerable:!0,get:function(){return c.BridgeBackgroundAction}});var l=e("./utils/validators.cjs");Object.defineProperty(n,"FeeType",{enumerable:!0,get:function(){return l.FeeType}}),Object.defineProperty(n,"ActionTypes",{enumerable:!0,get:function(){return l.ActionTypes}}),Object.defineProperty(n,"BridgeAssetSchema",{enumerable:!0,get:function(){return l.BridgeAssetSchema}}),Object.defineProperty(n,"FeatureId",{enumerable:!0,get:function(){return l.FeatureId}});var u=e("./constants/bridge.cjs");Object.defineProperty(n,"ALLOWED_BRIDGE_CHAIN_IDS",{enumerable:!0,get:function(){return u.ALLOWED_BRIDGE_CHAIN_IDS}}),Object.defineProperty(n,"BridgeClientId",{enumerable:!0,get:function(){return u.BridgeClientId}}),Object.defineProperty(n,"BRIDGE_CONTROLLER_NAME",{enumerable:!0,get:function(){return u.BRIDGE_CONTROLLER_NAME}}),Object.defineProperty(n,"BRIDGE_QUOTE_MAX_ETA_SECONDS",{enumerable:!0,get:function(){return u.BRIDGE_QUOTE_MAX_ETA_SECONDS}}),Object.defineProperty(n,"BRIDGE_QUOTE_MAX_RETURN_DIFFERENCE_PERCENTAGE",{enumerable:!0,get:function(){return u.BRIDGE_QUOTE_MAX_RETURN_DIFFERENCE_PERCENTAGE}}),Object.defineProperty(n,"BRIDGE_PREFERRED_GAS_ESTIMATE",{enumerable:!0,get:function(){return u.BRIDGE_PREFERRED_GAS_ESTIMATE}}),Object.defineProperty(n,"BRIDGE_MM_FEE_RATE",{enumerable:!0,get:function(){return u.BRIDGE_MM_FEE_RATE}}),Object.defineProperty(n,"REFRESH_INTERVAL_MS",{enumerable:!0,get:function(){return u.REFRESH_INTERVAL_MS}}),Object.defineProperty(n,"DEFAULT_MAX_REFRESH_COUNT",{enumerable:!0,get:function(){return u.DEFAULT_MAX_REFRESH_COUNT}}),Object.defineProperty(n,"DEFAULT_BRIDGE_CONTROLLER_STATE",{enumerable:!0,get:function(){return u.DEFAULT_BRIDGE_CONTROLLER_STATE}}),Object.defineProperty(n,"METABRIDGE_CHAIN_TO_ADDRESS_MAP",{enumerable:!0,get:function(){return u.METABRIDGE_CHAIN_TO_ADDRESS_MAP}}),Object.defineProperty(n,"BRIDGE_DEV_API_BASE_URL",{enumerable:!0,get:function(){return u.BRIDGE_DEV_API_BASE_URL}}),Object.defineProperty(n,"BRIDGE_PROD_API_BASE_URL",{enumerable:!0,get:function(){return u.BRIDGE_PROD_API_BASE_URL}});var d=e("./constants/tokens.cjs");Object.defineProperty(n,"SWAPS_CHAINID_DEFAULT_TOKEN_MAP",{enumerable:!0,get:function(){return d.SWAPS_CHAINID_DEFAULT_TOKEN_MAP}});var p=e("./constants/swaps.cjs");Object.defineProperty(n,"SWAPS_API_V2_BASE_URL",{enumerable:!0,get:function(){return p.SWAPS_API_V2_BASE_URL}}),Object.defineProperty(n,"SWAPS_CONTRACT_ADDRESSES",{enumerable:!0,get:function(){return p.SWAPS_CONTRACT_ADDRESSES}}),Object.defineProperty(n,"SWAPS_WRAPPED_TOKENS_ADDRESSES",{enumerable:!0,get:function(){return p.SWAPS_WRAPPED_TOKENS_ADDRESSES}}),Object.defineProperty(n,"ALLOWED_CONTRACT_ADDRESSES",{enumerable:!0,get:function(){return p.ALLOWED_CONTRACT_ADDRESSES}});var h=e("./utils/metrics/constants.cjs");Object.defineProperty(n,"MetricsActionType",{enumerable:!0,get:function(){return h.MetricsActionType}}),Object.defineProperty(n,"MetricsSwapType",{enumerable:!0,get:function(){return h.MetricsSwapType}});var m=e("./utils/bridge.cjs");Object.defineProperty(n,"isEthUsdt",{enumerable:!0,get:function(){return m.isEthUsdt}}),Object.defineProperty(n,"isNativeAddress",{enumerable:!0,get:function(){return m.isNativeAddress}}),Object.defineProperty(n,"isSolanaChainId",{enumerable:!0,get:function(){return m.isSolanaChainId}}),Object.defineProperty(n,"isBitcoinChainId",{enumerable:!0,get:function(){return m.isBitcoinChainId}}),Object.defineProperty(n,"isNonEvmChainId",{enumerable:!0,get:function(){return m.isNonEvmChainId}}),Object.defineProperty(n,"getNativeAssetForChainId",{enumerable:!0,get:function(){return m.getNativeAssetForChainId}}),Object.defineProperty(n,"getDefaultBridgeControllerState",{enumerable:!0,get:function(){return m.getDefaultBridgeControllerState}}),Object.defineProperty(n,"isCrossChain",{enumerable:!0,get:function(){return m.isCrossChain}});var f=e("./utils/quote.cjs");Object.defineProperty(n,"isValidQuoteRequest",{enumerable:!0,get:function(){return f.isValidQuoteRequest}}),Object.defineProperty(n,"formatEtaInMinutes",{enumerable:!0,get:function(){return f.formatEtaInMinutes}}),Object.defineProperty(n,"calcSlippagePercentage",{enumerable:!0,get:function(){return f.calcSlippagePercentage}});var g=e("./utils/balance.cjs");Object.defineProperty(n,"calcLatestSrcBalance",{enumerable:!0,get:function(){return g.calcLatestSrcBalance}});var S=e("./utils/fetch.cjs");Object.defineProperty(n,"fetchBridgeTokens",{enumerable:!0,get:function(){return S.fetchBridgeTokens}}),Object.defineProperty(n,"getClientHeaders",{enumerable:!0,get:function(){return S.getClientHeaders}});var E=e("./utils/caip-formatters.cjs");Object.defineProperty(n,"formatChainIdToCaip",{enumerable:!0,get:function(){return E.formatChainIdToCaip}}),Object.defineProperty(n,"formatChainIdToHex",{enumerable:!0,get:function(){return E.formatChainIdToHex}}),Object.defineProperty(n,"formatAddressToCaipReference",{enumerable:!0,get:function(){return E.formatAddressToCaipReference}}),Object.defineProperty(n,"formatAddressToAssetId",{enumerable:!0,get:function(){return E.formatAddressToAssetId}});var _=e("./utils/trade-utils.cjs");Object.defineProperty(n,"extractTradeData",{enumerable:!0,get:function(){return _.extractTradeData}}),Object.defineProperty(n,"isBitcoinTrade",{enumerable:!0,get:function(){return _.isBitcoinTrade}}),Object.defineProperty(n,"isTronTrade",{enumerable:!0,get:function(){return _.isTronTrade}}),Object.defineProperty(n,"isEvmTxData",{enumerable:!0,get:function(){return _.isEvmTxData}});var T=e("./selectors.cjs");Object.defineProperty(n,"selectBridgeQuotes",{enumerable:!0,get:function(){return T.selectBridgeQuotes}}),Object.defineProperty(n,"selectDefaultSlippagePercentage",{enumerable:!0,get:function(){return T.selectDefaultSlippagePercentage}}),Object.defineProperty(n,"selectExchangeRateByChainIdAndAddress",{enumerable:!0,get:function(){return T.selectExchangeRateByChainIdAndAddress}}),Object.defineProperty(n,"selectIsQuoteExpired",{enumerable:!0,get:function(){return T.selectIsQuoteExpired}}),Object.defineProperty(n,"selectBridgeFeatureFlags",{enumerable:!0,get:function(){return T.selectBridgeFeatureFlags}}),Object.defineProperty(n,"selectMinimumBalanceForRentExemptionInSOL",{enumerable:!0,get:function(){return T.selectMinimumBalanceForRentExemptionInSOL}});var y=e("./constants/bridge.cjs");Object.defineProperty(n,"DEFAULT_FEATURE_FLAG_CONFIG",{enumerable:!0,get:function(){return y.DEFAULT_FEATURE_FLAG_CONFIG}});var w=e("./utils/feature-flags.cjs");Object.defineProperty(n,"getBridgeFeatureFlags",{enumerable:!0,get:function(){return w.getBridgeFeatureFlags}});var b=e("./utils/slippage.cjs");Object.defineProperty(n,"BRIDGE_DEFAULT_SLIPPAGE",{enumerable:!0,get:function(){return b.BRIDGE_DEFAULT_SLIPPAGE}});var I=e("./utils/swaps.cjs");Object.defineProperty(n,"isValidSwapsContractAddress",{enumerable:!0,get:function(){return I.isValidSwapsContractAddress}}),Object.defineProperty(n,"getSwapsContractAddress",{enumerable:!0,get:function(){return I.getSwapsContractAddress}}),Object.defineProperty(n,"fetchTokens",{enumerable:!0,get:function(){return I.fetchTokens}})}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/index.cjs"}],[3053,{"./constants/bridge.cjs":3047,"./types.cjs":3054,"./utils/bridge.cjs":3057,"./utils/caip-formatters.cjs":3058,"./utils/feature-flags.cjs":3059,"./utils/quote.cjs":3065,"./utils/slippage.cjs":3066,"@ethersproject/constants":743,"@metamask/utils":3116,"bignumber.js":3087,lodash:4838,reselect:5308},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.selectDefaultSlippagePercentage=n.selectMinimumBalanceForRentExemptionInSOL=n.selectBridgeQuotes=n.selectIsQuoteExpired=n.selectIsAssetExchangeRateInState=n.selectExchangeRateByChainIdAndAddress=n.selectBridgeFeatureFlags=void 0;const s=e("@ethersproject/constants"),r=e("@metamask/utils"),a=e("bignumber.js"),i=e("lodash"),o=e("reselect"),c=e("./constants/bridge.cjs"),l=e("./types.cjs"),u=e("./utils/bridge.cjs"),d=e("./utils/caip-formatters.cjs"),p=e("./utils/feature-flags.cjs"),h=e("./utils/quote.cjs"),m=e("./utils/slippage.cjs"),f=o.createStructuredSelector.withTypes(),g=o.createSelector.withTypes(),S=o.createSelector.withTypes();n.selectBridgeFeatureFlags=S([e=>e.remoteFeatureFlags.bridgeConfig],e=>(0,p.processFeatureFlags)(e));const E=(e,t,n)=>{if(!t||!n)return{};const s=(0,d.formatAddressToAssetId)(n,t);if(!s)return{};const{assetExchangeRates:i,currencyRates:o,marketData:c,conversionRates:l}=e,p=i?.[s]??i?.[s.toLowerCase()];if(p?.exchangeRate)return p;if((0,u.isNonEvmChainId)(t)){const e=l?.[s];return e?{exchangeRate:e.rate,usdExchangeRate:undefined}:{}}if((0,u.isNativeAddress)(n)){const{symbol:e}=(0,u.getNativeAssetForChainId)(t),n=o?.[e];return n?{exchangeRate:n?.conversionRate?.toString(),usdExchangeRate:n?.usdConversionRate?.toString()}:{}}if(!(0,u.isNonEvmChainId)(t)){const e=c?.[(0,d.formatChainIdToHex)(t)],s=(0,r.isStrictHexString)(n)?e?.[n]:null,i=s?o[s?.currency]:undefined;if(s&&i)return{exchangeRate:new a.BigNumber(s.price).multipliedBy(i.conversionRate??0).toString(),usdExchangeRate:new a.BigNumber(s.price).multipliedBy(i.usdConversionRate??0).toString()}}return{}};n.selectExchangeRateByChainIdAndAddress=(e,t,n)=>E(e,t,n);n.selectIsAssetExchangeRateInState=(...e)=>Boolean(E(...e)?.exchangeRate)&&Boolean(E(...e)?.usdExchangeRate);const _=g([({quotes:e})=>e,f({estimatedBaseFeeInDecGwei:({gasFeeEstimates:e})=>e?.estimatedBaseFee,feePerGasInDecGwei:({gasFeeEstimates:e})=>e?.[c.BRIDGE_PREFERRED_GAS_ESTIMATE]?.suggestedMaxFeePerGas,maxFeePerGasInDecGwei:({gasFeeEstimates:e})=>e?.high?.suggestedMaxFeePerGas}),g([e=>e,({quoteRequest:{srcChainId:e}})=>e,({quoteRequest:{srcTokenAddress:e}})=>e],n.selectExchangeRateByChainIdAndAddress),g([e=>e,({quoteRequest:{destChainId:e}})=>e,({quoteRequest:{destTokenAddress:e}})=>e],n.selectExchangeRateByChainIdAndAddress),g([e=>e,({quoteRequest:{srcChainId:e}})=>e],(e,t)=>(0,n.selectExchangeRateByChainIdAndAddress)(e,t,s.AddressZero))],(e,t,n,s,r)=>e.map(e=>{const a=(0,h.calcSentAmount)(e.quote,n),i=(0,h.calcToAmount)(e.quote.destTokenAmount,e.quote.destAsset,s),o=(0,h.calcToAmount)(e.quote.minDestTokenAmount,e.quote.destAsset,s),c=(0,h.calcIncludedTxFees)(e.quote,n,s);let l,d,p,m;(0,u.isEvmQuoteResponse)(e)?(p=(0,h.calcRelayerFee)(e,r),m=(0,h.calcEstimatedAndMaxTotalGasFee)({bridgeQuote:e,...t,...r}),l=(0,h.calcTotalEstimatedNetworkFee)(m,p),d=(0,h.calcTotalMaxNetworkFee)(m,p)):(l=(0,h.calcNonEvmTotalNetworkFee)(e,r),m={effective:l,total:l,max:l},d=l);const f=(0,h.calcAdjustedReturn)(i,l,e.quote),g=(0,h.calcCost)(f,a);return{...e,sentAmount:a,toTokenAmount:i,minToTokenAmount:o,swapRate:(0,h.calcSwapRate)(a.amount,i.amount),totalNetworkFee:l,totalMaxNetworkFee:d,gasFee:m,adjustedReturn:f,cost:g,includedTxFees:c}})),T=g([_,(e,{sortOrder:t})=>t],(e,t)=>t===l.SortOrder.ETA_ASC?(0,i.orderBy)(e,e=>e.estimatedProcessingTimeInSeconds,"asc"):(0,i.orderBy)(e,({cost:e})=>e.valueInCurrency?Number(e.valueInCurrency):0,"asc")),y=g([T],e=>e.length>0?e[0]:null),w=g([y,(e,{selectedQuote:t})=>t],(e,t)=>t??e),b=g([n.selectBridgeFeatureFlags,e=>e.quoteRequest.insufficientBal,e=>e.quotesRefreshCount],(e,t,n)=>!t&&e.maxRefreshCount>n),I=g([n.selectBridgeFeatureFlags,e=>e.quoteRequest.srcChainId],(e,t)=>(t?e.chains[(0,d.formatChainIdToCaip)(t)]?.refreshRate:e.refreshRate)??e.refreshRate);n.selectIsQuoteExpired=g([b,({quotesLastFetched:e})=>e,I,(e,t,n)=>n],(e,t,n,s)=>Boolean(!e&&t&&s-t>n)),n.selectBridgeQuotes=f({sortedQuotes:T,recommendedQuote:y,activeQuote:w,quotesLastFetchedMs:e=>e.quotesLastFetched,isLoading:e=>e.quotesLoadingStatus===l.RequestStatus.LOADING,quoteFetchError:e=>e.quoteFetchError,quotesRefreshCount:e=>e.quotesRefreshCount,quotesInitialLoadTimeMs:e=>e.quotesInitialLoadTime,isQuoteGoingToRefresh:b});n.selectMinimumBalanceForRentExemptionInSOL=e=>new a.BigNumber(e.minimumBalanceForRentExemptionInLamports??0).div(10**9).toString(),n.selectDefaultSlippagePercentage=g([e=>(0,n.selectBridgeFeatureFlags)(e).chains,(e,t)=>t.srcTokenAddress,(e,t)=>t.destTokenAddress,(e,t)=>t.srcChainId?(0,d.formatChainIdToCaip)(t.srcChainId):undefined,(e,t)=>t.destChainId?(0,d.formatChainIdToCaip)(t.destChainId):undefined],(e,t,n,s,r)=>(0,m.getDefaultSlippagePercentage)({srcTokenAddress:t,destTokenAddress:n,srcChainId:s,destChainId:r},s?e[s]?.stablecoins:undefined,r?e[r]?.stablecoins:undefined))}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/selectors.cjs"}],[3054,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,a,i,o,c,l;Object.defineProperty(n,"__esModule",{value:!0}),n.BridgeBackgroundAction=n.BridgeUserAction=n.RequestStatus=n.ChainId=n.StatusTypes=n.SortOrder=n.AssetType=void 0,function(e){e.native="NATIVE",e.token="TOKEN",e.NFT="NFT",e.unknown="UNKNOWN"}(s||(n.AssetType=s={})),function(e){e.COST_ASC="cost_ascending",e.ETA_ASC="time_descending"}(r||(n.SortOrder=r={})),function(e){e.UNKNOWN="UNKNOWN",e.FAILED="FAILED",e.PENDING="PENDING",e.COMPLETE="COMPLETE"}(a||(n.StatusTypes=a={})),function(e){e[e.ETH=1]="ETH",e[e.OPTIMISM=10]="OPTIMISM",e[e.BSC=56]="BSC",e[e.POLYGON=137]="POLYGON",e[e.ZKSYNC=324]="ZKSYNC",e[e.BASE=8453]="BASE",e[e.ARBITRUM=42161]="ARBITRUM",e[e.AVALANCHE=43114]="AVALANCHE",e[e.LINEA=59144]="LINEA",e[e.SOLANA=0x416edef1601be]="SOLANA",e[e.BTC=20000000000001]="BTC",e[e.TRON=728126428]="TRON",e[e.SEI=1329]="SEI",e[e.MONAD=143]="MONAD"}(i||(n.ChainId=i={})),function(e){e[e.LOADING=0]="LOADING",e[e.FETCHED=1]="FETCHED",e[e.ERROR=2]="ERROR"}(o||(n.RequestStatus=o={})),function(e){e.SELECT_DEST_NETWORK="selectDestNetwork",e.UPDATE_QUOTE_PARAMS="updateBridgeQuoteRequestParams"}(c||(n.BridgeUserAction=c={})),function(e){e.SET_CHAIN_INTERVAL_LENGTH="setChainIntervalLength",e.RESET_STATE="resetState",e.TRACK_METAMETRICS_EVENT="trackUnifiedSwapBridgeEvent",e.STOP_POLLING_FOR_QUOTES="stopPollingForQuotes",e.FETCH_QUOTES="fetchQuotes"}(l||(n.BridgeBackgroundAction=l={}))}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/types.cjs"}],[3055,{"./bridge.cjs":3057,"./caip-formatters.cjs":3058},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.toExchangeRates=n.getAssetIdsForToken=void 0;const s=e("./bridge.cjs"),r=e("./caip-formatters.cjs");n.getAssetIdsForToken=(e,t)=>{const n=[],a=(0,r.formatAddressToAssetId)(e,t);return a&&(n.push(a),(0,s.getNativeAssetForChainId)(t)?.assetId&&n.push((0,s.getNativeAssetForChainId)(t).assetId)),n};n.toExchangeRates=(e,t)=>Object.entries(t).reduce((t,[n,s])=>(s&&(t[n]={exchangeRate:s[e],usdExchangeRate:s.usd}),t),{})}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/assets.cjs"}],[3056,{"./bridge.cjs":3057,"@ethersproject/address":730,"@ethersproject/contracts":746,"@ethersproject/providers":784,"@metamask/metamask-eth-abis":2263},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.hasSufficientBalance=n.calcLatestSrcBalance=n.fetchTokenBalance=void 0;const s=e("@ethersproject/address"),r=e("@ethersproject/contracts"),a=e("@ethersproject/providers"),i=e("@metamask/metamask-eth-abis"),o=e("./bridge.cjs");n.fetchTokenBalance=async(e,t,n)=>{const s=new a.Web3Provider(n),o=new r.Contract(e,i.abiERC20,s),c="function"==typeof o?.balanceOf?o.balanceOf(t):Promise.resolve(undefined);return await c};n.calcLatestSrcBalance=async(e,t,r,i)=>{if(r&&i){if((0,o.isNativeAddress)(r)){const n=new a.Web3Provider(e);return await n.getBalance((0,s.getAddress)(t))}return await(0,n.fetchTokenBalance)(r,t,e)}return undefined};n.hasSufficientBalance=async(e,t,s,r,a)=>{const i=await(0,n.calcLatestSrcBalance)(e,t,s,a);return!!i&&i.gte(r)}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/balance.cjs"}],[3057,{"../constants/bridge.cjs":3047,"../constants/chains.cjs":3048,"../constants/swaps.cjs":3049,"../constants/tokens.cjs":3050,"../types.cjs":3054,"./caip-formatters.cjs":3058,"@ethersproject/constants":743,"@ethersproject/contracts":746,"@metamask/keyring-api":2193,"@metamask/metamask-eth-abis":2263,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isEvmQuoteResponse=n.isNonEvmChainId=n.isTronChainId=n.isBitcoinChainId=n.isSolanaChainId=n.isNativeAddress=n.isSwapsDefaultTokenSymbol=n.isSwapsDefaultTokenAddress=n.sumHexes=n.isEthUsdt=n.getEthUsdtResetData=n.getNativeAssetForChainId=n.getDefaultBridgeControllerState=n.isCrossChain=void 0;const s=e("@ethersproject/constants"),r=e("@ethersproject/contracts"),a=e("@metamask/keyring-api"),i=e("@metamask/metamask-eth-abis"),o=e("@metamask/utils"),c=e("./caip-formatters.cjs"),l=e("../constants/bridge.cjs"),u=e("../constants/chains.cjs"),d=e("../constants/swaps.cjs"),p=e("../constants/tokens.cjs"),h=e("../types.cjs");n.isCrossChain=(e,t)=>{try{return!!t&&(0,c.formatChainIdToCaip)(e)!==(0,c.formatChainIdToCaip)(t)}catch{return!1}};n.getDefaultBridgeControllerState=()=>l.DEFAULT_BRIDGE_CONTROLLER_STATE;const m=(e,t)=>`${(0,c.formatChainIdToCaip)(e)}/${p.SYMBOL_TO_SLIP44_MAP[t]}`;n.getNativeAssetForChainId=e=>{const t=(0,c.formatChainIdToCaip)(e),n=p.SWAPS_CHAINID_DEFAULT_TOKEN_MAP[(0,c.formatChainIdToCaip)(e)]??p.SWAPS_CHAINID_DEFAULT_TOKEN_MAP[(0,c.formatChainIdToHex)(e)];if(!n)throw new Error(`No XChain Swaps native asset found for chainId: ${e}`);return{...n,chainId:(0,c.formatChainIdToDec)(e),assetId:m(t,n.symbol)}};n.getEthUsdtResetData=e=>{const t=(0,n.isCrossChain)(u.CHAIN_IDS.MAINNET,e)?l.METABRIDGE_ETHEREUM_ADDRESS:d.SWAPS_CONTRACT_ADDRESSES[u.CHAIN_IDS.MAINNET];return new r.Contract(l.ETH_USDT_ADDRESS,i.abiERC20).interface.encodeFunctionData("approve",[t,"0"])};n.isEthUsdt=(e,t)=>(0,c.formatChainIdToDec)(e)===h.ChainId.ETH&&t.toLowerCase()===l.ETH_USDT_ADDRESS.toLowerCase();n.sumHexes=(...e)=>{if(0===e.length)return"0x0";return`0x${e.reduce((e,t)=>e+BigInt(t),BigInt(0)).toString(16)}`};n.isSwapsDefaultTokenAddress=(e,t)=>!(!e||!t)&&e===(0,n.getNativeAssetForChainId)(t)?.address;n.isSwapsDefaultTokenSymbol=(e,t)=>!(!e||!t)&&e===(0,n.getNativeAssetForChainId)(t)?.symbol;n.isNativeAddress=e=>e===s.AddressZero||""===e||!e||!(0,o.isStrictHexString)(e)&&Object.values(p.SYMBOL_TO_SLIP44_MAP).some(t=>e.includes(t)||t.endsWith(e));n.isSolanaChainId=e=>(0,o.isCaipChainId)(e)?e===a.SolScope.Mainnet.toString():e.toString()===h.ChainId.SOLANA.toString();n.isBitcoinChainId=e=>(0,o.isCaipChainId)(e)?e===a.BtcScope.Mainnet.toString():e.toString()===h.ChainId.BTC.toString();n.isTronChainId=e=>(0,o.isCaipChainId)(e)?e===a.TrxScope.Mainnet.toString():e.toString()===h.ChainId.TRON.toString();n.isNonEvmChainId=e=>(0,n.isSolanaChainId)(e)||(0,n.isBitcoinChainId)(e)||(0,n.isTronChainId)(e);n.isEvmQuoteResponse=e=>!(0,n.isNonEvmChainId)(e.quote.srcChainId)}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/bridge.cjs"}],[3058,{"../types.cjs":3054,"./bridge.cjs":3057,"@ethersproject/address":730,"@ethersproject/constants":743,"@metamask/controller-utils":1449,"@metamask/keyring-api":2193,"@metamask/multichain-network-controller":3075,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.formatAddressToAssetId=n.formatAddressToCaipReference=n.formatChainIdToHex=n.formatChainIdToDec=n.formatChainIdToCaip=void 0;const s=e("@ethersproject/address"),r=e("@ethersproject/constants"),a=e("@metamask/controller-utils"),i=e("@metamask/keyring-api"),o=e("@metamask/multichain-network-controller"),c=e("@metamask/utils"),l=e("./bridge.cjs"),u=e("../types.cjs");n.formatChainIdToCaip=e=>(0,c.isCaipChainId)(e)?e:(0,c.isStrictHexString)(e)?(0,o.toEvmCaipChainId)(e):(0,l.isSolanaChainId)(e)?i.SolScope.Mainnet:(0,l.isBitcoinChainId)(e)?i.BtcScope.Mainnet:(0,l.isTronChainId)(e)?i.TrxScope.Mainnet:(0,o.toEvmCaipChainId)((0,c.numberToHex)(Number(e)));n.formatChainIdToDec=e=>(0,c.isStrictHexString)(e)?(0,a.convertHexToDecimal)(e):e===i.SolScope.Mainnet?u.ChainId.SOLANA:e===i.BtcScope.Mainnet?u.ChainId.BTC:e===i.TrxScope.Mainnet?u.ChainId.TRON:(0,c.isCaipChainId)(e)?Number(e.split(":").at(-1)):"string"==typeof e?parseInt(e,10):e;n.formatChainIdToHex=e=>{if((0,c.isStrictHexString)(e))return e;if("number"==typeof e||parseInt(e,10))return(0,c.numberToHex)(Number(e));if((0,c.isCaipChainId)(e)){const{reference:t}=(0,c.parseCaipChainId)(e);if((0,c.isCaipReference)(t)&&!isNaN(Number(t)))return(0,c.numberToHex)(Number(t))}throw new Error(`Invalid cross-chain swaps chainId: ${e}`)};n.formatAddressToCaipReference=e=>{if((0,c.isStrictHexString)(e))return(0,s.getAddress)(e);if((0,l.isNativeAddress)(e))return r.AddressZero;const t=e.split(":").at(-1);if(!t)throw new Error("Invalid address");return t};n.formatAddressToAssetId=(e,t)=>(0,c.isCaipAssetType)(e)?e:(0,l.isNativeAddress)(e)?(0,l.getNativeAssetForChainId)(t).assetId:t===i.SolScope.Mainnet?c.CaipAssetTypeStruct.create(`${t}/token:${e}`):(0,c.isStrictHexString)(e)?c.CaipAssetTypeStruct.create(`${(0,n.formatChainIdToCaip)(t)}/erc20:${e}`):undefined}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/caip-formatters.cjs"}],[3059,{"../constants/bridge.cjs":3047,"./caip-formatters.cjs":3058,"./validators.cjs":3070},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.hasMinimumRequiredVersion=n.getBridgeFeatureFlags=n.processFeatureFlags=n.formatFeatureFlags=void 0;const s=e("./caip-formatters.cjs"),r=e("./validators.cjs"),a=e("../constants/bridge.cjs");n.formatFeatureFlags=e=>{return{...e,chains:(t=e.chains,Object.entries(t).reduce((e,[t,n])=>({...e,[(0,s.formatChainIdToCaip)(t)]:n}),{}))};var t};n.processFeatureFlags=e=>(0,r.validateFeatureFlagsResponse)(e)?(0,n.formatFeatureFlags)(e):a.DEFAULT_FEATURE_FLAG_CONFIG,n.getBridgeFeatureFlags=function(e){const t=e.call("RemoteFeatureFlagController:getState"),s=t?.remoteFeatureFlags?.bridgeConfigV2,r=t?.remoteFeatureFlags?.bridgeConfig;return(0,n.processFeatureFlags)(s||r)};n.hasMinimumRequiredVersion=(e,t)=>{const[n,s,r]=e.split(".").map(Number),[a,i,o]=t.split(".").map(Number);return n>a||(n===a&&s>i||n===a&&s===i&&r>=o)}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/feature-flags.cjs"}],[306,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function r(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.IndexedDBPPOMStorage=void 0;const a=async(e,t,n)=>{const s=await crypto.subtle.digest("SHA-256",t);if(Array.from(new Uint8Array(s)).map(e=>e.toString(16).padStart(2,"0")).join("")!==n)throw new Error(`Checksum mismatch for key ${e}`)};var i=new WeakSet;function o(e){return new Promise((t,n)=>{const s=indexedDB.open(this.storeName,this.dbVersion);s.onerror=e=>{var t;n(new Error(`Failed to open database ${this.storeName}: ${null===(t=e.target)||void 0===t?void 0:t.error}`))},s.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this.storeName)||t.createObjectStore(this.storeName,{keyPath:["name","chainId"]})},s.onsuccess=n=>{const s=n.target.result.transaction([this.storeName],e).objectStore(this.storeName);t(s)}})}n.IndexedDBPPOMStorage=class{constructor(e,t){s(this,i),r(this,"storeName",void 0),r(this,"dbVersion",void 0),this.storeName=e,this.dbVersion=t}async objectStoreAction(e,t,n="readonly"){return new Promise((s,r)=>{(function(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")})(i,this,o).call(this,n).then(n=>{const a=n[e](t);a.onsuccess=async e=>{s(e)},a.onerror=t=>{var n;r(new Error(`Error in indexDB operation ${e}: ${null===(n=t.target)||void 0===n?void 0:n.error}`))}}).catch(e=>{r(e)})})}async read(e,t){var n;const s=null===(n=(await this.objectStoreAction("get",[e.name,e.chainId])).target)||void 0===n||null===(n=n.result)||void 0===n?void 0:n.data;return await a(e,s,t),s}async write(e,t,n){await a(e,t,n),await this.objectStoreAction("put",{...e,data:t},"readwrite")}async delete(e){await this.objectStoreAction("delete",[e.name,e.chainId],"readwrite")}async dir(){var e;return null===(e=(await this.objectStoreAction("getAllKeys")).target)||void 0===e?void 0:e.result.map(([e,t])=>({name:e,chainId:t}))}}}}},{package:"$root$",file:"app/scripts/lib/ppom/indexed-db-backend.ts"}],[3060,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.fetchServerEvents=void 0;n.fetchServerEvents=async(e,{onMessage:t,onError:n,onClose:s,fetchFn:r,...a})=>{let i;try{const n=await r(e,a);if(!n.ok||!n.body)throw new Error(`${n.status}`);i=n.body.getReader();const o=new TextDecoder("utf-8");let c="";for(;;){const{done:e,value:n}=await i.read();if(e)break;c+=o.decode(n,{stream:!0});const s=c.split("\n\n");c=s.pop()||"";for(const e of s){const n=e.split("\n");let s;const r=[];for(const e of n)e.startsWith("event:")?s=e.slice(6).trim():e.startsWith("data:")&&r.push(e.slice(5).trim());if("error"===s)throw new Error(`Bridge-api error: ${r.join("\n")}`);if(r.length>0){const e=JSON.parse(r.join("\n"));await t(e,s)}}}await(s?.())}catch(e){n?.(e)}finally{try{await(i?.cancel())}catch(e){console.error("Error cleaning up stream reader",e)}}}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/fetch-server-events.cjs"}],[3061,{"./bridge.cjs":3057,"./caip-formatters.cjs":3058,"./fetch-server-events.cjs":3060,"./trade-utils.cjs":3069,"./validators.cjs":3070,"@metamask/superstruct":2936},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.fetchBridgeQuoteStream=n.fetchAssetPrices=n.fetchBridgeQuotes=n.fetchBridgeTokens=n.getClientHeaders=void 0;const s=e("@metamask/superstruct"),r=e("./bridge.cjs"),a=e("./caip-formatters.cjs"),i=e("./fetch-server-events.cjs"),o=e("./trade-utils.cjs"),c=e("./validators.cjs");n.getClientHeaders=(e,t)=>({"X-Client-Id":e,...t?{"Client-Version":t}:{}}),n.fetchBridgeTokens=async function(e,t,s,r,i){const o=`${r}/getTokens?chainId=${(0,a.formatChainIdToDec)(e)}`,l=await s(o,{headers:(0,n.getClientHeaders)(t,i)}),u={};return l.forEach(e=>{(0,c.validateSwapsTokenObject)(e)&&(u[e.address]=e)}),u};const l=e=>{const t=e.destWalletAddress??e.walletAddress,n={walletAddress:(0,a.formatAddressToCaipReference)(e.walletAddress),destWalletAddress:(0,a.formatAddressToCaipReference)(t),srcChainId:(0,a.formatChainIdToDec)(e.srcChainId),destChainId:(0,a.formatChainIdToDec)(e.destChainId),srcTokenAddress:(0,a.formatAddressToCaipReference)(e.srcTokenAddress),destTokenAddress:(0,a.formatAddressToCaipReference)(e.destTokenAddress),srcTokenAmount:e.srcTokenAmount,insufficientBal:Boolean(e.insufficientBal),resetApproval:Boolean(e.resetApproval),gasIncluded:Boolean(e.gasIncluded),gasIncluded7702:Boolean(e.gasIncluded7702)};e.slippage!==undefined&&(n.slippage=e.slippage),e.fee!==undefined&&(n.fee=e.fee),e.aggIds&&e.aggIds.length>0&&(n.aggIds=e.aggIds),e.bridgeIds&&e.bridgeIds.length>0&&(n.bridgeIds=e.bridgeIds);const s=new URLSearchParams;return Object.entries(n).forEach(([e,t])=>{s.append(e,t.toString())}),s};n.fetchBridgeQuotes=async function(e,t,a,i,u,d,p){const h=`${u}/getQuote?${l(e)}`,m=await i(h,{headers:(0,n.getClientHeaders)(a,p),signal:t}),f=new Set([]),g=m.filter(e=>{try{return(0,c.validateQuoteResponse)(e)}catch(t){return t instanceof s.StructError&&t.failures().forEach(({branch:t,path:n})=>{const s=t?.[0]?.quote?.bridgeId||t?.[0]?.quote?.bridges?.[0]||e?.quote?.bridgeId||e?.quote?.bridges?.[0]||"unknown",r=n?.join(".")||"unknown";f.add([s,r].join("|"))}),!1}}).map(t=>({...t,featureId:d??undefined,resetApproval:e.resetApproval&&t.approval&&(0,o.isEvmTxData)(t.approval)?{...t.approval,data:(0,r.getEthUsdtResetData)(e.destChainId)}:undefined})),S=Array.from(f);return f.size>0&&console.warn("Quote validation failed",S),{quotes:g,validationFailures:S}};n.fetchAssetPrices=async e=>{const{currencies:t,...s}=e,r=await Promise.allSettled(Array.from(t).map(async e=>await(async e=>{const{currency:t,assetIds:s,clientId:r,clientVersion:a,fetchFn:i,signal:o}=e,c=Array.from(s).filter(Boolean);if(0===c.length)return{};const l=`https://price.api.cx.metamask.io/v3/spot-prices?${new URLSearchParams({assetIds:c.filter(Boolean).join(","),vsCurrency:t})}`,u=await i(l,{headers:(0,n.getClientHeaders)(r,a),signal:o});return u&&"object"==typeof u?Object.entries(u).reduce((e,[n,s])=>s?(e[n]||(e[n]={}),s[t]&&(e[n][t]=s[t].toString()),e):e,{}):{}})({...s,currency:e}))).then(e=>e.reduce((e,t)=>("fulfilled"===t.status&&Object.entries(t.value).forEach(([t,n])=>{e[t]||(e[t]={}),Object.entries(n).forEach(([n,s])=>{e[t][n]=s})}),e),{}));return r},n.fetchBridgeQuoteStream=async function(e,t,a,u,d,p,h){const m=`${d}/getQuoteStream?${l(t)}`;await(0,i.fetchServerEvents)(m,{headers:{...(0,n.getClientHeaders)(u,h),"Content-Type":"text/event-stream"},signal:a,onMessage:async e=>{const n=new Set([]);try{if((0,c.validateQuoteResponse)(e))return await p.onValidQuoteReceived({...e,resetApproval:t.resetApproval&&e.approval&&(0,o.isEvmTxData)(e.approval)?{...e.approval,data:(0,r.getEthUsdtResetData)(t.destChainId)}:undefined})}catch(t){t instanceof s.StructError&&t.failures().forEach(({branch:t,path:s})=>{const r=t?.[0]?.quote?.bridgeId||t?.[0]?.quote?.bridges?.[0]||e?.quote?.bridgeId||e?.quote?.bridges?.[0]||"unknown",a=s?.join(".")||"unknown";n.add([r,a].join("|"))});const r=Array.from(n);if(n.size>0)return console.warn("Quote validation failed",r),p.onValidationFailure(r);throw t}return undefined},onError:e=>{throw e},onClose:async()=>{await p.onClose()},fetchFn:e})}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/fetch.cjs"}],[3062,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,a,i,o;Object.defineProperty(n,"__esModule",{value:!0}),n.MetricsSwapType=n.MetricsActionType=n.MetaMetricsSwapsEventSource=n.AbortReason=n.UnifiedSwapBridgeEventName=n.UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY=void 0,n.UNIFIED_SWAP_BRIDGE_EVENT_CATEGORY="Unified SwapBridge",function(e){e.ButtonClicked="Unified SwapBridge Button Clicked",e.PageViewed="Unified SwapBridge Page Viewed",e.InputChanged="Unified SwapBridge Input Changed",e.InputSourceDestinationSwitched="Unified SwapBridge Source Destination Switched",e.QuotesRequested="Unified SwapBridge Quotes Requested",e.QuotesReceived="Unified SwapBridge Quotes Received",e.QuotesError="Unified SwapBridge Quotes Error",e.Submitted="Unified SwapBridge Submitted",e.Completed="Unified SwapBridge Completed",e.Failed="Unified SwapBridge Failed",e.AllQuotesOpened="Unified SwapBridge All Quotes Opened",e.AllQuotesSorted="Unified SwapBridge All Quotes Sorted",e.QuoteSelected="Unified SwapBridge Quote Selected",e.AssetDetailTooltipClicked="Unified SwapBridge Asset Detail Tooltip Clicked",e.QuotesValidationFailed="Unified SwapBridge Quotes Failed Validation",e.StatusValidationFailed="Unified SwapBridge Status Failed Validation"}(s||(n.UnifiedSwapBridgeEventName=s={})),function(e){e.NewQuoteRequest="New Quote Request",e.QuoteRequestUpdated="Quote Request Updated",e.ResetState="Reset controller state",e.TransactionSubmitted="Transaction submitted"}(r||(n.AbortReason=r={})),function(e){e.MainView="Main View",e.TokenView="Token View"}(a||(n.MetaMetricsSwapsEventSource=a={})),function(e){e.CROSSCHAIN_V1="crosschain-v1",e.SWAPBRIDGE_V1="swapbridge-v1"}(i||(n.MetricsActionType=i={})),function(e){e.SINGLE="single_chain",e.CROSSCHAIN="crosschain"}(o||(n.MetricsSwapType=o={}))}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/metrics/constants.cjs"}],[3063,{"../../constants/bridge.cjs":3047,"../../types.cjs":3054,"../bridge.cjs":3057,"../caip-formatters.cjs":3058,"./constants.cjs":3062},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getQuotesReceivedProperties=n.isCustomSlippage=n.isHardwareWallet=n.getRequestParams=n.formatProviderLabel=n.getSwapTypeFromQuote=n.getSwapType=n.toInputChangedPropertyValue=n.toInputChangedPropertyKey=void 0;const s=e("./constants.cjs"),r=e("../../constants/bridge.cjs"),a=e("../../types.cjs"),i=e("../bridge.cjs"),o=e("../caip-formatters.cjs");n.toInputChangedPropertyKey={srcTokenAddress:"token_source",destTokenAddress:"token_destination",srcChainId:"chain_source",destChainId:"chain_destination",slippage:"slippage"},n.toInputChangedPropertyValue={srcTokenAddress:({srcTokenAddress:e,srcChainId:t})=>t?(0,o.formatAddressToAssetId)(e??"",t):undefined,destTokenAddress:({destTokenAddress:e,destChainId:t})=>t?(0,o.formatAddressToAssetId)(e??"",t):undefined,srcChainId:({srcChainId:e})=>e?(0,o.formatChainIdToCaip)(e):undefined,destChainId:({destChainId:e})=>e?(0,o.formatChainIdToCaip)(e):undefined,slippage:({slippage:e})=>e?Number(e):e};n.getSwapType=(e,t)=>e&&!(0,i.isCrossChain)(e,t??e)?s.MetricsSwapType.SINGLE:s.MetricsSwapType.CROSSCHAIN;n.getSwapTypeFromQuote=e=>(0,n.getSwapType)(e.srcChainId,e.destChainId);n.formatProviderLabel=({bridgeId:e,bridges:t})=>`${e}_${t[0]}`;n.getRequestParams=({srcChainId:e,destChainId:t,srcTokenAddress:n,destTokenAddress:s})=>{const r=(0,o.formatChainIdToCaip)(e??a.ChainId.ETH);return{chain_id_source:r,chain_id_destination:t?(0,o.formatChainIdToCaip)(t):null,token_address_source:n?(0,o.formatAddressToAssetId)(n,r)??(0,i.getNativeAssetForChainId)(r)?.assetId??null:(0,i.getNativeAssetForChainId)(r)?.assetId??null,token_address_destination:s?(0,o.formatAddressToAssetId)(s,t??r)??null:null}};n.isHardwareWallet=e=>e?.metadata?.keyring.type?.includes("Hardware")??!1;n.isCustomSlippage=e=>e!==r.DEFAULT_BRIDGE_CONTROLLER_STATE.quoteRequest.slippage;n.getQuotesReceivedProperties=(e,t=[],s=!0,r)=>{const a=e?(0,n.formatProviderLabel)(e.quote):"_";return{can_submit:s,gas_included:Boolean(e?.quote?.gasIncluded),gas_included_7702:Boolean(e?.quote?.gasIncluded7702),quoted_time_minutes:e?.estimatedProcessingTimeInSeconds?e.estimatedProcessingTimeInSeconds/60:0,usd_quoted_gas:Number(e?.gasFee?.effective?.usd??0),usd_quoted_return:Number(e?.toTokenAmount?.usd??0),best_quote_provider:r?(0,n.formatProviderLabel)(r.quote):a,provider:a,warnings:t,price_impact:Number(e?.quote.priceData?.priceImpact??0)}}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/metrics/properties.cjs"}],[3064,{"../constants/chains.cjs":3048,"./bridge.cjs":3057,"./caip-formatters.cjs":3058,"./snaps.cjs":3067,"./trade-utils.cjs":3069,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.appendFeesToQuotes=void 0;const s=e("@metamask/utils"),r=e("./bridge.cjs"),a=e("./caip-formatters.cjs"),i=e("./snaps.cjs"),o=e("./trade-utils.cjs"),c=e("../constants/chains.cjs");n.appendFeesToQuotes=async(e,t,n,l)=>{const u=await(async(e,t)=>{if(e.some(({quote:e})=>{const t=(0,a.formatChainIdToCaip)(e.srcChainId);return![c.CHAIN_IDS.OPTIMISM,c.CHAIN_IDS.BASE].map(a.formatChainIdToCaip).includes(t)}))return undefined;const n=Promise.allSettled(e.map(async e=>{const{quote:n,trade:a,approval:i}=e,o=(0,s.numberToHex)(n.srcChainId),c=e=>({from:e.from,to:e.to,value:e.value,data:e.data,gasLimit:e.gasLimit?.toString()}),l=i?await t({transactionParams:c(i),chainId:o}):"0x0",u=await t({transactionParams:c(a),chainId:o});return l===undefined||u===undefined?undefined:{...e,l1GasFeesInHexWei:(0,r.sumHexes)(l,u)}}));return(await n).reduce((e,t)=>("fulfilled"===t.status&&t.value?e.push(t.value):"rejected"===t.status&&console.error("Error calculating L1 gas fees for quote",t.reason),e),[])})(e,n),d=await(async(e,t,n)=>{if(e.some(({quote:{srcChainId:e}})=>!(0,r.isNonEvmChainId)(e)))return undefined;const s=Promise.allSettled(e.map(async e=>{const{trade:s,quote:r}=e;if(!n?.metadata?.snap?.id||!s)return e;try{const c=(0,a.formatChainIdToCaip)(r.srcChainId),l=(0,o.extractTradeData)(s),u=(0,o.isTronTrade)(s)?{visible:s.visible,type:s.raw_data?.contract?.[0]?.type,feeLimit:s.raw_data?.fee_limit}:undefined,d=await t.call("SnapController:handleRequest",(0,i.computeFeeRequest)(n?.metadata?.snap?.id,l,n?.id,c,u)),p=d?.find(e=>"base"===e.type)||d?.find(e=>"priority"===e.type)||d?.[0],h=p?.asset?.amount||"0";return{...e,nonEvmFeesInNative:h}}catch(t){return console.error(`Failed to compute non-EVM fees for quote ${r.requestId}:`,t),{...e,nonEvmFeesInNative:undefined}}}));return(await s).reduce((e,t)=>("fulfilled"===t.status&&t.value&&e.push(t.value),e),[])})(e,t,l);return u??d??e}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/quote-fees.cjs"}],[3065,{"./bridge.cjs":3057,"./validators.cjs":3070,"@metamask/controller-utils":1449,"bignumber.js":3087},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.sortQuotes=n.formatEtaInMinutes=n.calcSlippagePercentage=n.calcCost=n.calcSwapRate=n.calcAdjustedReturn=n.calcIncludedTxFees=n.calcTotalMaxNetworkFee=n.calcTotalEstimatedNetworkFee=n.calcEstimatedAndMaxTotalGasFee=n.calcRelayerFee=n.calcSentAmount=n.calcToAmount=n.calcNonEvmTotalNetworkFee=n.getQuoteIdentifier=n.isValidQuoteRequest=void 0;const s=e("@metamask/controller-utils"),r=e("bignumber.js"),a=e("./bridge.cjs"),i=e("./validators.cjs");n.isValidQuoteRequest=(e,t=!0)=>{const n=["srcTokenAddress","destTokenAddress","srcChainId","destChainId","walletAddress"];if(t&&n.push("srcTokenAmount"),e.destChainId&&e.srcChainId&&e.destChainId!==e.srcChainId&&((0,a.isNonEvmChainId)(e.destChainId)||(0,a.isNonEvmChainId)(e.srcChainId))&&(n.push("destWalletAddress"),!e.destWalletAddress))return!1;const s=[];return e.slippage!==undefined&&s.push("slippage"),n.every(t=>t in e&&"string"==typeof e[t]&&e[t]!==undefined&&""!==e[t]&&null!==e[t])&&s.every(t=>t in e&&"number"==typeof e[t]&&e[t]!==undefined&&!isNaN(Number(e[t]))&&null!==e[t])&&(!t||Boolean((e.srcTokenAmount??"").match(/^[1-9]\d*$/u)))};n.getQuoteIdentifier=e=>`${e.bridgeId}-${e.bridges[0]}-${e.steps.length}`;const o=(e,t)=>{const n=new r.BigNumber(10).pow(t??0);return new r.BigNumber(e).div(n)};n.calcNonEvmTotalNetworkFee=(e,{exchangeRate:t,usdExchangeRate:n})=>{const{nonEvmFeesInNative:s}=e,a=new r.BigNumber(s??"0");return{amount:a.toString(),valueInCurrency:t?a.times(t).toString():null,usd:n?a.times(n).toString():null}};n.calcToAmount=(e,t,{exchangeRate:n,usdExchangeRate:s})=>{const r=o(e,t.decimals);return{amount:r.toString(),valueInCurrency:n?r.times(n).toString():null,usd:s?r.times(s).toString():null}};n.calcSentAmount=({srcTokenAmount:e,srcAsset:t,feeData:n},{exchangeRate:s,usdExchangeRate:a})=>{const i=Object.values(n).filter(e=>e&&e.amount&&e.asset?.assetId===t.assetId).reduce((e,{amount:t})=>e.plus(t),new r.BigNumber(e)),c=o(i,t.decimals);return{amount:c.toString(),valueInCurrency:s?c.times(s).toString():null,usd:a?c.times(a).toString():null}};n.calcRelayerFee=(e,{exchangeRate:t,usdExchangeRate:i})=>{const{quote:c,trade:l}=e,u=new r.BigNumber((0,s.convertHexToDecimal)(l.value||"0x0"));let d=o(u,18);if((0,a.isNativeAddress)(c.srcAsset.address)){const e=(0,n.calcSentAmount)(c,{exchangeRate:t,usdExchangeRate:i}).amount;d=d.minus(e)}return{amount:d,valueInCurrency:t?d.times(t):null,usd:i?d.times(i):null}};const c=({approvalGasLimit:e,resetApprovalGasLimit:t,tradeGasLimit:n,l1GasFeesInHexWei:a,feePerGasInDecGwei:i,nativeToDisplayCurrencyExchangeRate:o,nativeToUsdExchangeRate:c})=>{const l=new r.BigNumber(n?.toString()??"0").plus(e?.toString()??"0").plus(t?.toString()??"0"),u=(0,s.weiHexToGweiDec)((0,s.toHex)(a??"0")),d=l.times(i).plus(u).times(new r.BigNumber(10).pow(-9)),p=o?d.times(o.toString()):null,h=c?d.times(c.toString()):null;return{amount:d.toString(),valueInCurrency:p?.toString()??null,usd:h?.toString()??null}};n.calcEstimatedAndMaxTotalGasFee=({bridgeQuote:{approval:e,trade:t,l1GasFeesInHexWei:n,resetApproval:s},estimatedBaseFeeInDecGwei:r,maxFeePerGasInDecGwei:a,feePerGasInDecGwei:i,exchangeRate:o,usdExchangeRate:l})=>{const{amount:u,valueInCurrency:d,usd:p}=c({approvalGasLimit:e?.effectiveGas??e?.gasLimit,resetApprovalGasLimit:s?.effectiveGas??s?.gasLimit,tradeGasLimit:t?.effectiveGas??t?.gasLimit,l1GasFeesInHexWei:n,feePerGasInDecGwei:i,nativeToDisplayCurrencyExchangeRate:o,nativeToUsdExchangeRate:l}),{amount:h,valueInCurrency:m,usd:f}=c({approvalGasLimit:e?.gasLimit,resetApprovalGasLimit:s?.gasLimit,tradeGasLimit:t?.gasLimit,l1GasFeesInHexWei:n,feePerGasInDecGwei:i,nativeToDisplayCurrencyExchangeRate:o,nativeToUsdExchangeRate:l}),{amount:g,valueInCurrency:S,usd:E}=c({approvalGasLimit:e?.gasLimit,resetApprovalGasLimit:s?.gasLimit,tradeGasLimit:t?.gasLimit,l1GasFeesInHexWei:n,feePerGasInDecGwei:a,nativeToDisplayCurrencyExchangeRate:o,nativeToUsdExchangeRate:l});return{effective:{amount:u,valueInCurrency:d,usd:p},total:{amount:h,valueInCurrency:m,usd:f},max:{amount:g,valueInCurrency:S,usd:E}}};n.calcTotalEstimatedNetworkFee=({total:e},t)=>({amount:new r.BigNumber(e?.amount??"0").plus(t.amount).toString(),valueInCurrency:e?.valueInCurrency?new r.BigNumber(e.valueInCurrency).plus(t.valueInCurrency||"0").toString():null,usd:e?.usd?new r.BigNumber(e.usd).plus(t.usd||"0").toString():null});n.calcTotalMaxNetworkFee=(e,t)=>({amount:new r.BigNumber(e.max.amount).plus(t.amount).toString(),valueInCurrency:e.max.valueInCurrency?new r.BigNumber(e.max.valueInCurrency).plus(t.valueInCurrency||"0").toString():null,usd:e.max.usd?new r.BigNumber(e.max.usd).plus(t.usd||"0").toString():null});n.calcIncludedTxFees=({gasIncluded:e,gasIncluded7702:t,srcAsset:n,feeData:{txFee:s}},r,a)=>{if(!s||!e&&!t)return null;const{exchangeRate:i,usdExchangeRate:c}=s.asset.assetId===n.assetId?r:a,l=o(s.amount,s.asset.decimals);return{amount:l.toString(),valueInCurrency:i?l.times(i).toString():null,usd:c?l.times(c).toString():null}};n.calcAdjustedReturn=(e,t,{feeData:{txFee:n},destAsset:{assetId:s}})=>n?.asset?.assetId===s?{valueInCurrency:e.valueInCurrency,usd:e.usd}:{valueInCurrency:e.valueInCurrency&&t.valueInCurrency?new r.BigNumber(e.valueInCurrency).minus(t.valueInCurrency).toString():null,usd:e.usd&&t.usd?new r.BigNumber(e.usd).minus(t.usd).toString():null};n.calcSwapRate=(e,t)=>new r.BigNumber(t).div(e).toString();n.calcCost=(e,t)=>({valueInCurrency:e.valueInCurrency&&t.valueInCurrency?new r.BigNumber(t.valueInCurrency).minus(e.valueInCurrency).toString():null,usd:e.usd&&t.usd?new r.BigNumber(t.usd).minus(e.usd).toString():null});n.calcSlippagePercentage=(e,t)=>{const s=(0,n.calcCost)(e,t);return s.valueInCurrency&&t.valueInCurrency?new r.BigNumber(s.valueInCurrency).div(t.valueInCurrency).times(100).abs().toString():s.usd&&t.usd?new r.BigNumber(s.usd).div(t.usd).times(100).abs().toString():null};n.formatEtaInMinutes=e=>e<60?"< 1":(e/60).toFixed();n.sortQuotes=(e,t)=>t===i.FeatureId.PERPS?e.sort((e,t)=>e.estimatedProcessingTimeInSeconds-t.estimatedProcessingTimeInSeconds):e}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/quote.cjs"}],[3066,{"./bridge.cjs":3057},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getDefaultSlippagePercentage=n.BRIDGE_DEFAULT_SLIPPAGE=void 0;const s=e("./bridge.cjs");n.BRIDGE_DEFAULT_SLIPPAGE=.5;const r=undefined;n.getDefaultSlippagePercentage=({srcTokenAddress:e,destTokenAddress:t,srcChainId:a,destChainId:i},o,c)=>!a||(0,s.isCrossChain)(a,i)?n.BRIDGE_DEFAULT_SLIPPAGE:(0,s.isSolanaChainId)(a)?r:e&&t&&o?.map(e=>e.toLowerCase()).includes(e.toLowerCase())&&(c??o)?.map(e=>e.toLowerCase()).includes(t.toLowerCase())?.5:2}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/slippage.cjs"}],[3067,{"../constants/bridge.cjs":3047,"@metamask/keyring-api":2193,uuid:5734},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.computeFeeRequest=n.getMinimumBalanceForRentExemptionInLamports=n.getMinimumBalanceForRentExemptionRequest=void 0;const s=e("@metamask/keyring-api"),r=e("uuid"),a=e("../constants/bridge.cjs");n.getMinimumBalanceForRentExemptionRequest=e=>({snapId:e,origin:"metamask",handler:"onProtocolRequest",request:{method:" ",jsonrpc:"2.0",params:{scope:s.SolScope.Mainnet,request:{id:(0,r.v4)(),jsonrpc:"2.0",method:"getMinimumBalanceForRentExemption",params:[0,{commitment:"confirmed"}]}}}});n.getMinimumBalanceForRentExemptionInLamports=async(e,t)=>String(await t.call("SnapController:handleRequest",(0,n.getMinimumBalanceForRentExemptionRequest)(e)).catch(e=>(console.error("Error setting minimum balance for rent exemption",e),a.DEFAULT_BRIDGE_CONTROLLER_STATE.minimumBalanceForRentExemptionInLamports)));n.computeFeeRequest=(e,t,n,s,a)=>({snapId:e,origin:"metamask",handler:"onClientRequest",request:{id:(0,r.v4)(),jsonrpc:"2.0",method:"computeFee",params:{transaction:t,accountId:n,scope:s,...a&&{options:a}}}})}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/snaps.cjs"}],[3068,{"../constants/chains.cjs":3048,"../constants/swaps.cjs":3049,"../constants/tokens.cjs":3050,"./caip-formatters.cjs":3058},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.fetchTokens=n.DEV_BASE_URL=n.API_BASE_URL=n.getSwapsContractAddress=n.isValidSwapsContractAddress=void 0;const s=e("./caip-formatters.cjs"),r=e("../constants/chains.cjs"),a=e("../constants/swaps.cjs"),i=e("../constants/tokens.cjs");function o(e){return e?{"X-Client-Id":e}:undefined}n.isValidSwapsContractAddress=function(e,t){return!(!t||!a.ALLOWED_CONTRACT_ADDRESSES[e])&&a.ALLOWED_CONTRACT_ADDRESSES[e].some(e=>t.toLowerCase()===e.toLowerCase())},n.getSwapsContractAddress=function(e){return a.SWAPS_CONTRACT_ADDRESSES[e]},n.API_BASE_URL="https://swap.api.cx.metamask.io",n.DEV_BASE_URL="https://swap.dev-api.cx.metamask.io",n.fetchTokens=async function(e,t,a){const[c,l]=e===r.CHAIN_IDS.LOCALHOST?[r.CHAIN_IDS.MAINNET,n.DEV_BASE_URL]:[e,n.API_BASE_URL],u=`${l}/networks/${(0,s.formatChainIdToDec)(c)}/tokens`,d=(await t(u,{headers:o(a)})).filter(e=>e.address!==i.DEFAULT_TOKEN_ADDRESS),p=i.SWAPS_CHAINID_DEFAULT_TOKEN_MAP[e];return d.push(p),d}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/swaps.cjs"}],[3069,{buffer:4084},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(e){(function(){Object.defineProperty(n,"__esModule",{value:!0}),n.extractTradeData=n.isTronTrade=n.isBitcoinTrade=n.isEvmTxData=void 0;n.isEvmTxData=e=>"object"==typeof e&&null!==e&&"data"in e&&"chainId"in e&&"to"in e;n.isBitcoinTrade=e=>"object"==typeof e&&null!==e&&"unsignedPsbtBase64"in e;n.isTronTrade=e=>"object"==typeof e&&null!==e&&"raw_data_hex"in e;n.extractTradeData=t=>(0,n.isBitcoinTrade)(t)?t.unsignedPsbtBase64:(0,n.isTronTrade)(t)?e.from(t.raw_data_hex,"hex").toString("base64"):"string"==typeof t?t:(0,n.isEvmTxData)(t)?t.data:""}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/trade-utils.cjs"}],[307,{"../../../../shared/constants/app":5775,"../../../../shared/constants/security-provider":5803,"../../../../shared/constants/transaction":5814,"../../../../shared/lib/trace":5897,"./ppom-util":308,"@metamask/controller-utils":1449},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createPPOMMiddleware=function(e,t,n,u,d,p,h){return async(m,f,g)=>{try{const{securityAlertsEnabled:f}=t.state,{chainId:g}=n.getNetworkConfigurationByNetworkClientId(m.networkClientId)??{};if(!g)throw Error("ChainID not found for networkClientId");if(!f||!l.includes(m.method))return;const S=m.params[0];if("string"==typeof S){const{isSIWEMessage:e}=(0,s.detectSIWE)({data:S});if(e)return}else if(m.method===r.MESSAGE_TYPE.ETH_SEND_TRANSACTION){const{to:e}=S??{},t=d.listAccounts();if(t.some(({address:t})=>(null==t?void 0:t.toLowerCase())===(null==e?void 0:e.toLowerCase())))return}const E=(0,c.generateSecurityAlertId)();(0,i.trace)({name:i.TraceName.PPOMValidation,parentContext:m.traceContext},()=>(0,c.validateRequestWithPPOM)({ppomController:e,request:m,securityAlertId:E,chainId:g,updateSecurityAlertResponse:p,getSecurityAlertsConfig:h}));const _={...o.LOADING_SECURITY_ALERT_RESPONSE,securityAlertId:E};a.SIGNING_METHODS.includes(m.method)&&u.addSignatureSecurityAlertResponse(_),m.securityAlertResponse=_}catch(e){m.securityAlertResponse=(0,c.handlePPOMError)(e,"Error createPPOMMiddleware: ")}finally{g()}}};var s=e("@metamask/controller-utils"),r=e("../../../../shared/constants/app"),a=e("../../../../shared/constants/transaction"),i=e("../../../../shared/lib/trace"),o=e("../../../../shared/constants/security-provider"),c=e("./ppom-util");const l=Object.freeze(["eth_sendRawTransaction","eth_sendTransaction",...a.SIGNING_METHODS])}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom-middleware.ts"}],[3070,{"@metamask/controller-utils":1449,"@metamask/superstruct":2936,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateQuoteResponse=n.QuoteResponseSchema=n.TronTradeDataSchema=n.BitcoinTradeDataSchema=n.TxDataSchema=n.QuoteSchema=n.StepSchema=n.ProtocolSchema=n.FeeDataSchema=n.validateSwapsTokenObject=n.validateFeatureFlagsResponse=n.PlatformConfigSchema=n.PriceImpactThresholdSchema=n.ChainConfigurationSchema=n.BridgeAssetSchema=n.truthyString=n.ActionTypes=n.FeatureId=n.FeeType=void 0;const s=e("@metamask/controller-utils"),r=e("@metamask/superstruct"),a=e("@metamask/utils");var i,o,c;!function(e){e.METABRIDGE="metabridge",e.REFUEL="refuel",e.TX_FEE="txFee"}(i||(n.FeeType=i={})),function(e){e.PERPS="perps"}(o||(n.FeatureId=o={})),function(e){e.BRIDGE="bridge",e.SWAP="swap",e.REFUEL="refuel"}(c||(n.ActionTypes=c={}));const l=(0,r.define)("HexAddress",e=>(0,s.isValidHexAddress)(e,{allowNonPrefixed:!1})),u=(0,r.define)("HexString",e=>(0,a.isStrictHexString)(e)),d=(0,r.define)("VersionString",e=>"string"==typeof e&&/^(\d+\.*){2}\d+$/u.test(e)&&3===e.split(".").length);n.truthyString=e=>Boolean(e?.length);const p=(0,r.pattern)((0,r.string)(),/^\d+$/u),h=(0,r.number)();n.BridgeAssetSchema=(0,r.type)({chainId:h,address:(0,r.string)(),assetId:a.CaipAssetTypeStruct,symbol:(0,r.string)(),name:(0,r.string)(),decimals:(0,r.number)(),icon:(0,r.optional)((0,r.nullable)((0,r.string)())),iconUrl:(0,r.optional)((0,r.nullable)((0,r.string)()))});const m=(0,r.type)({standard:(0,r.record)((0,r.string)(),(0,r.string)()),other:(0,r.record)((0,r.string)(),(0,r.string)())});n.ChainConfigurationSchema=(0,r.type)({isActiveSrc:(0,r.boolean)(),isActiveDest:(0,r.boolean)(),refreshRate:(0,r.optional)((0,r.number)()),topAssets:(0,r.optional)((0,r.array)((0,r.string)())),stablecoins:(0,r.optional)((0,r.array)((0,r.string)())),isUnifiedUIEnabled:(0,r.optional)((0,r.boolean)()),isSingleSwapBridgeButtonEnabled:(0,r.optional)((0,r.boolean)()),isGaslessSwapEnabled:(0,r.optional)((0,r.boolean)()),noFeeAssets:(0,r.optional)((0,r.array)((0,r.string)())),defaultPairs:(0,r.optional)(m)}),n.PriceImpactThresholdSchema=(0,r.type)({gasless:(0,r.number)(),normal:(0,r.number)()});const f=(0,r.type)({aggIds:(0,r.optional)((0,r.array)((0,r.string)())),bridgeIds:(0,r.optional)((0,r.array)((0,r.string)())),fee:(0,r.optional)((0,r.number)())}),g=(0,r.enums)(Object.values(o));n.PlatformConfigSchema=(0,r.type)({priceImpactThreshold:(0,r.optional)(n.PriceImpactThresholdSchema),quoteRequestOverrides:(0,r.optional)((0,r.record)(g,(0,r.optional)(f))),minimumVersion:(0,r.string)(),refreshRate:(0,r.number)(),maxRefreshCount:(0,r.number)(),support:(0,r.boolean)(),chains:(0,r.record)((0,r.string)(),n.ChainConfigurationSchema),bip44DefaultPairs:(0,r.optional)((0,r.record)((0,r.string)(),(0,r.optional)(m))),sse:(0,r.optional)((0,r.type)({enabled:(0,r.boolean)(),minimumVersion:d}))});n.validateFeatureFlagsResponse=e=>(0,r.is)(e,n.PlatformConfigSchema);n.validateSwapsTokenObject=e=>(0,r.is)(e,n.BridgeAssetSchema),n.FeeDataSchema=(0,r.type)({amount:p,asset:n.BridgeAssetSchema}),n.ProtocolSchema=(0,r.type)({name:(0,r.string)(),displayName:(0,r.optional)((0,r.string)()),icon:(0,r.optional)((0,r.string)())}),n.StepSchema=(0,r.type)({action:(0,r.enums)(Object.values(c)),srcChainId:h,destChainId:(0,r.optional)(h),srcAsset:n.BridgeAssetSchema,destAsset:n.BridgeAssetSchema,srcAmount:(0,r.string)(),destAmount:(0,r.string)(),protocol:n.ProtocolSchema});const S=n.StepSchema;n.QuoteSchema=(0,r.type)({requestId:(0,r.string)(),srcChainId:h,srcAsset:n.BridgeAssetSchema,srcTokenAmount:(0,r.string)(),destChainId:h,destAsset:n.BridgeAssetSchema,destTokenAmount:(0,r.string)(),minDestTokenAmount:(0,r.string)(),feeData:(0,r.type)({[i.METABRIDGE]:n.FeeDataSchema,[i.TX_FEE]:(0,r.optional)((0,r.intersection)([n.FeeDataSchema,(0,r.type)({maxFeePerGas:(0,r.string)(),maxPriorityFeePerGas:(0,r.string)()})]))}),gasIncluded:(0,r.optional)((0,r.boolean)()),gasIncluded7702:(0,r.optional)((0,r.boolean)()),bridgeId:(0,r.string)(),bridges:(0,r.array)((0,r.string)()),steps:(0,r.array)(n.StepSchema),refuel:(0,r.optional)(S),priceData:(0,r.optional)((0,r.type)({totalFromAmountUsd:(0,r.optional)((0,r.string)()),totalToAmountUsd:(0,r.optional)((0,r.string)()),priceImpact:(0,r.optional)((0,r.string)()),totalFeeAmountUsd:(0,r.optional)((0,r.string)())})),gasSponsored:(0,r.optional)((0,r.boolean)())}),n.TxDataSchema=(0,r.type)({chainId:(0,r.number)(),to:l,from:l,value:u,data:u,gasLimit:(0,r.nullable)((0,r.number)()),effectiveGas:(0,r.optional)((0,r.number)())}),n.BitcoinTradeDataSchema=(0,r.type)({unsignedPsbtBase64:(0,r.string)(),inputsToSign:(0,r.nullable)((0,r.array)((0,r.type)({})))}),n.TronTradeDataSchema=(0,r.type)({raw_data_hex:(0,r.string)(),visible:(0,r.optional)((0,r.boolean)()),raw_data:(0,r.optional)((0,r.nullable)((0,r.type)({contract:(0,r.optional)((0,r.array)((0,r.type)({type:(0,r.optional)((0,r.string)())})))})))}),n.QuoteResponseSchema=(0,r.type)({quote:n.QuoteSchema,estimatedProcessingTimeInSeconds:(0,r.number)(),approval:(0,r.optional)((0,r.union)([n.TxDataSchema,n.TronTradeDataSchema])),trade:(0,r.union)([n.TxDataSchema,n.BitcoinTradeDataSchema,n.TronTradeDataSchema,(0,r.string)()])});n.validateQuoteResponse=e=>((0,r.assert)(e,n.QuoteResponseSchema),!0)}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/dist/utils/validators.cjs"}],[3071,{"../api/accounts-api.cjs":3073,"../constants.cjs":3074,"../types.cjs":3076,"../utils.cjs":3077,"@metamask/base-controller":1362,"@metamask/keyring-api":2193,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,a,i,o,c,l,u,d,p=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},h=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainNetworkController=void 0;const m=e("@metamask/base-controller"),f=e("@metamask/keyring-api"),g=e("@metamask/utils"),S=e("../api/accounts-api.cjs"),E=e("../constants.cjs"),_=e("../types.cjs"),T=e("../utils.cjs");class y extends m.BaseController{constructor({messenger:e,state:t,networkService:n}){super({messenger:e,name:_.MULTICHAIN_NETWORK_CONTROLLER_NAME,metadata:E.MULTICHAIN_NETWORK_CONTROLLER_METADATA,state:{...(0,E.getDefaultMultichainNetworkControllerState)(),...t,multichainNetworkConfigurationsByChainId:E.AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS}}),s.add(this),r.set(this,void 0),p(this,r,n,"f"),h(this,s,"m",u).call(this),h(this,s,"m",d).call(this)}async setActiveNetwork(e){if((0,g.isCaipChainId)(e)){if(!(0,T.checkIfSupportedCaipChainId)(e))throw new Error(`Unsupported Caip chain ID: ${String(e)}`);return h(this,s,"m",i).call(this,e)}return await h(this,s,"m",a).call(this,e)}async getNetworksWithTransactionActivityByAccounts(){const e=this.messenger.call("AccountsController:listMultichainAccounts").filter(e=>(0,f.isEvmAccountType)(e.type));if(!e||0===e.length)return this.state.networksWithTransactionActivity;const t=e.map(e=>(0,S.toAllowedCaipAccountIds)(e)).flat(),n=await h(this,r,"f").fetchNetworkActivity(t),s=(0,S.toActiveNetworksByAddress)(n);return this.update(e=>{e.networksWithTransactionActivity=s}),this.state.networksWithTransactionActivity}async removeNetwork(e){return(0,T.isEvmCaipChainId)(e)?await h(this,s,"m",o).call(this,e):h(this,s,"m",c).call(this,e)}}n.MultichainNetworkController=y,r=new WeakMap,s=new WeakSet,a=async function(e){const{selectedNetworkClientId:t}=this.messenger.call("NetworkController:getState"),n=!this.state.isEvmSelected,s=e!==t;(n||s)&&(n&&this.update(e=>{e.isEvmSelected=!0}),s&&await this.messenger.call("NetworkController:setActiveNetwork",e),(n||s)&&this.messenger.publish("MultichainNetworkController:networkDidChange",e))},i=function(e){(e!==this.state.selectedMultichainNetworkChainId||this.state.isEvmSelected)&&(this.update(t=>{t.selectedMultichainNetworkChainId=e,t.isEvmSelected=!1}),this.messenger.publish("MultichainNetworkController:networkDidChange",e))},o=async function(e){const t=(0,T.convertEvmCaipToHexChainId)(e);if(this.messenger.call("NetworkController:getSelectedChainId")===t){if(this.state.isEvmSelected)throw new Error("Cannot remove the currently selected network");const e="0x1",t=this.messenger.call("NetworkController:findNetworkClientIdByChainId",e);await this.messenger.call("NetworkController:setActiveNetwork",t)}this.messenger.call("NetworkController:removeNetwork",t)},c=function(e){throw new Error("Removal of non-EVM networks is not supported")},l=function(e){const{type:t,scopes:n}=e;if((0,f.isEvmAccountType)(t)){if(this.state.isEvmSelected)return;return void this.update(e=>{e.isEvmSelected=!0})}if(n.includes(this.state.selectedMultichainNetworkChainId))return void this.update(e=>{e.isEvmSelected=!1});const s=(0,T.getChainIdForNonEvm)(n);this.update(e=>{e.selectedMultichainNetworkChainId=s,e.isEvmSelected=!1})},u=function(){this.messenger.subscribe("AccountsController:selectedAccountChange",e=>h(this,s,"m",l).call(this,e))},d=function(){this.messenger.registerActionHandler("MultichainNetworkController:setActiveNetwork",this.setActiveNetwork.bind(this)),this.messenger.registerActionHandler("MultichainNetworkController:getNetworksWithTransactionActivityByAccounts",this.getNetworksWithTransactionActivityByAccounts.bind(this))}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/node_modules/@metamask/multichain-network-controller/dist/MultichainNetworkController/MultichainNetworkController.cjs"}],[3072,{"../api/accounts-api.cjs":3073,"@metamask/superstruct":2936,lodash:4838},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,a,i,o=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},c=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainNetworkService=void 0;const l=e("@metamask/superstruct"),u=e("lodash"),d=e("../api/accounts-api.cjs");n.MultichainNetworkService=class{constructor({fetch:e,batchSize:t}){s.add(this),r.set(this,void 0),a.set(this,void 0),o(this,r,e,"f"),o(this,a,t??20,"f")}async fetchNetworkActivity(e){if(0===e.length)return{activeNetworks:[]};if(e.length<=c(this,a,"f"))return c(this,s,"m",i).call(this,e);const t=(0,u.chunk)(e,c(this,a,"f"));return{activeNetworks:(await Promise.all(t.map(e=>c(this,s,"m",i).call(this,e)))).flatMap(e=>e.activeNetworks)}}},r=new WeakMap,a=new WeakMap,s=new WeakSet,i=async function(e){try{const t=(0,d.buildActiveNetworksUrl)(e),n=await c(this,r,"f").call(this,t.toString(),{method:"GET",headers:{[d.MULTICHAIN_ACCOUNTS_CLIENT_HEADER]:d.MULTICHAIN_ACCOUNTS_CLIENT_ID,Accept:"application/json"}});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const s=await n.json();return(0,l.assert)(s,d.ActiveNetworksResponseStruct),s}catch(e){if(e instanceof Error){if("AbortError"===e.name)throw new Error("Request timeout: Failed to fetch active networks");throw e}throw new Error(`Failed to fetch active networks: ${String(e)}`)}}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/node_modules/@metamask/multichain-network-controller/dist/MultichainNetworkService/MultichainNetworkService.cjs"}],[3073,{"@metamask/keyring-api":2193,"@metamask/superstruct":2936,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.buildActiveNetworksUrl=n.toActiveNetworksByAddress=n.toAllowedCaipAccountIds=n.MULTICHAIN_ALLOWED_ACTIVE_NETWORK_SCOPES=n.MULTICHAIN_ACCOUNTS_CLIENT_ID=n.MULTICHAIN_ACCOUNTS_CLIENT_HEADER=n.MULTICHAIN_ACCOUNTS_BASE_URL=n.ActiveNetworksResponseStruct=void 0;const s=e("@metamask/keyring-api"),r=e("@metamask/superstruct"),a=e("@metamask/utils");n.ActiveNetworksResponseStruct=(0,r.object)({activeNetworks:(0,r.array)(a.CaipAccountIdStruct)}),n.MULTICHAIN_ACCOUNTS_BASE_URL="https://accounts.api.cx.metamask.io",n.MULTICHAIN_ACCOUNTS_CLIENT_HEADER="x-metamask-clientproduct",n.MULTICHAIN_ACCOUNTS_CLIENT_ID="metamask-multichain-network-controller",n.MULTICHAIN_ALLOWED_ACTIVE_NETWORK_SCOPES=[String(s.BtcScope.Mainnet),String(s.BtcScope.Testnet),String(s.BtcScope.Testnet4),String(s.BtcScope.Signet),String(s.BtcScope.Regtest),String(s.SolScope.Mainnet),String(s.SolScope.Devnet),String(s.EthScope.Mainnet),String(s.EthScope.Testnet),String(s.EthScope.Eoa),String(s.TrxScope.Mainnet),String(s.TrxScope.Nile),String(s.TrxScope.Shasta)],n.toAllowedCaipAccountIds=function(e){const t=[];for(const s of e.scopes)n.MULTICHAIN_ALLOWED_ACTIVE_NETWORK_SCOPES.includes(s)&&t.push(`${s}:${e.address}`);return t},n.toActiveNetworksByAddress=function(e){const t={};return e.activeNetworks.forEach(e=>{const{address:n,chain:{namespace:s,reference:r}}=(0,a.parseCaipAccountId)(e);t[n]||(t[n]={namespace:s,activeChains:[]}),t[n].activeChains.push(r)}),t},n.buildActiveNetworksUrl=function(e){const t=new URL(`${n.MULTICHAIN_ACCOUNTS_BASE_URL}/v2/activeNetworks`);return t.searchParams.append("accountIds",e.join(",")),t}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/node_modules/@metamask/multichain-network-controller/dist/api/accounts-api.cjs"}],[3074,{"@metamask/keyring-api":2193,"@metamask/network-controller":3082},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MULTICHAIN_NETWORK_DECIMAL_PLACES=n.MULTICHAIN_NETWORK_TICKER=n.MULTICHAIN_NETWORK_CONTROLLER_METADATA=n.getDefaultMultichainNetworkControllerState=n.NETWORKS_METADATA=n.NON_EVM_TESTNET_IDS=n.AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS=n.TRX_SHASTA_NATIVE_ASSET=n.TRX_NILE_NATIVE_ASSET=n.TRX_NATIVE_ASSET=n.SOL_DEVNET_NATIVE_ASSET=n.SOL_TESTNET_NATIVE_ASSET=n.SOL_NATIVE_ASSET=n.BTC_REGTEST_NATIVE_ASSET=n.BTC_SIGNET_NATIVE_ASSET=n.BTC_TESTNET4_NATIVE_ASSET=n.BTC_TESTNET_NATIVE_ASSET=n.BTC_NATIVE_ASSET=void 0;const s=e("@metamask/keyring-api"),r=e("@metamask/network-controller");n.BTC_NATIVE_ASSET=`${s.BtcScope.Mainnet}/slip44:0`,n.BTC_TESTNET_NATIVE_ASSET=`${s.BtcScope.Testnet}/slip44:0`,n.BTC_TESTNET4_NATIVE_ASSET=`${s.BtcScope.Testnet4}/slip44:0`,n.BTC_SIGNET_NATIVE_ASSET=`${s.BtcScope.Signet}/slip44:0`,n.BTC_REGTEST_NATIVE_ASSET=`${s.BtcScope.Regtest}/slip44:0`,n.SOL_NATIVE_ASSET=`${s.SolScope.Mainnet}/slip44:501`,n.SOL_TESTNET_NATIVE_ASSET=`${s.SolScope.Testnet}/slip44:501`,n.SOL_DEVNET_NATIVE_ASSET=`${s.SolScope.Devnet}/slip44:501`,n.TRX_NATIVE_ASSET=`${s.TrxScope.Mainnet}/slip44:195`,n.TRX_NILE_NATIVE_ASSET=`${s.TrxScope.Nile}/slip44:195`,n.TRX_SHASTA_NATIVE_ASSET=`${s.TrxScope.Shasta}/slip44:195`,n.AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS={[s.BtcScope.Mainnet]:{chainId:s.BtcScope.Mainnet,name:"Bitcoin",nativeCurrency:n.BTC_NATIVE_ASSET,isEvm:!1},[s.BtcScope.Testnet]:{chainId:s.BtcScope.Testnet,name:"Bitcoin Testnet",nativeCurrency:n.BTC_TESTNET_NATIVE_ASSET,isEvm:!1},[s.BtcScope.Testnet4]:{chainId:s.BtcScope.Testnet4,name:"Bitcoin Testnet4",nativeCurrency:n.BTC_TESTNET4_NATIVE_ASSET,isEvm:!1},[s.BtcScope.Signet]:{chainId:s.BtcScope.Signet,name:"Bitcoin Mutinynet",nativeCurrency:n.BTC_SIGNET_NATIVE_ASSET,isEvm:!1},[s.BtcScope.Regtest]:{chainId:s.BtcScope.Regtest,name:"Bitcoin Regtest",nativeCurrency:n.BTC_REGTEST_NATIVE_ASSET,isEvm:!1},[s.SolScope.Mainnet]:{chainId:s.SolScope.Mainnet,name:"Solana",nativeCurrency:n.SOL_NATIVE_ASSET,isEvm:!1},[s.SolScope.Testnet]:{chainId:s.SolScope.Testnet,name:"Solana Testnet",nativeCurrency:n.SOL_TESTNET_NATIVE_ASSET,isEvm:!1},[s.SolScope.Devnet]:{chainId:s.SolScope.Devnet,name:"Solana Devnet",nativeCurrency:n.SOL_DEVNET_NATIVE_ASSET,isEvm:!1},[s.TrxScope.Mainnet]:{chainId:s.TrxScope.Mainnet,name:"Tron",nativeCurrency:n.TRX_NATIVE_ASSET,isEvm:!1},[s.TrxScope.Nile]:{chainId:s.TrxScope.Nile,name:"Tron Nile",nativeCurrency:n.TRX_NILE_NATIVE_ASSET,isEvm:!1},[s.TrxScope.Shasta]:{chainId:s.TrxScope.Shasta,name:"Tron Shasta",nativeCurrency:n.TRX_SHASTA_NATIVE_ASSET,isEvm:!1}},n.NON_EVM_TESTNET_IDS=[s.BtcScope.Testnet,s.BtcScope.Testnet4,s.BtcScope.Signet,s.BtcScope.Regtest,s.SolScope.Testnet,s.SolScope.Devnet,s.TrxScope.Nile,s.TrxScope.Shasta],n.NETWORKS_METADATA={[s.BtcScope.Mainnet]:{features:[],status:r.NetworkStatus.Available},[s.SolScope.Mainnet]:{features:[],status:r.NetworkStatus.Available},[s.TrxScope.Mainnet]:{features:[],status:r.NetworkStatus.Available}};n.getDefaultMultichainNetworkControllerState=()=>({multichainNetworkConfigurationsByChainId:n.AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS,selectedMultichainNetworkChainId:s.SolScope.Mainnet,isEvmSelected:!0,networksWithTransactionActivity:{}}),n.MULTICHAIN_NETWORK_CONTROLLER_METADATA={multichainNetworkConfigurationsByChainId:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},selectedMultichainNetworkChainId:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},isEvmSelected:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},networksWithTransactionActivity:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0}},n.MULTICHAIN_NETWORK_TICKER={[s.BtcScope.Mainnet]:"BTC",[s.BtcScope.Testnet]:"tBTC",[s.BtcScope.Testnet4]:"tBTC",[s.BtcScope.Signet]:"sBTC",[s.BtcScope.Regtest]:"rBTC",[s.SolScope.Mainnet]:"SOL",[s.SolScope.Testnet]:"tSOL",[s.SolScope.Devnet]:"dSOL",[s.TrxScope.Mainnet]:"TRX",[s.TrxScope.Nile]:"tTRX",[s.TrxScope.Shasta]:"sTRX"},n.MULTICHAIN_NETWORK_DECIMAL_PLACES={[s.BtcScope.Mainnet]:8,[s.BtcScope.Testnet]:8,[s.BtcScope.Testnet4]:8,[s.BtcScope.Signet]:8,[s.BtcScope.Regtest]:8,[s.SolScope.Mainnet]:5,[s.SolScope.Testnet]:5,[s.SolScope.Devnet]:5,[s.TrxScope.Mainnet]:6,[s.TrxScope.Nile]:6,[s.TrxScope.Shasta]:6}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/node_modules/@metamask/multichain-network-controller/dist/constants.cjs"}],[3075,{"./MultichainNetworkController/MultichainNetworkController.cjs":3071,"./MultichainNetworkService/MultichainNetworkService.cjs":3072,"./constants.cjs":3074,"./utils.cjs":3077},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.toEvmCaipChainId=n.toMultichainNetworkConfigurationsByChainId=n.toMultichainNetworkConfiguration=n.checkIfSupportedCaipChainId=n.AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS=n.MULTICHAIN_NETWORK_DECIMAL_PLACES=n.MULTICHAIN_NETWORK_TICKER=n.NON_EVM_TESTNET_IDS=n.getDefaultMultichainNetworkControllerState=n.MultichainNetworkService=n.MultichainNetworkController=void 0;var s=e("./MultichainNetworkController/MultichainNetworkController.cjs");Object.defineProperty(n,"MultichainNetworkController",{enumerable:!0,get:function(){return s.MultichainNetworkController}});var r=e("./MultichainNetworkService/MultichainNetworkService.cjs");Object.defineProperty(n,"MultichainNetworkService",{enumerable:!0,get:function(){return r.MultichainNetworkService}});var a=e("./constants.cjs");Object.defineProperty(n,"getDefaultMultichainNetworkControllerState",{enumerable:!0,get:function(){return a.getDefaultMultichainNetworkControllerState}}),Object.defineProperty(n,"NON_EVM_TESTNET_IDS",{enumerable:!0,get:function(){return a.NON_EVM_TESTNET_IDS}}),Object.defineProperty(n,"MULTICHAIN_NETWORK_TICKER",{enumerable:!0,get:function(){return a.MULTICHAIN_NETWORK_TICKER}}),Object.defineProperty(n,"MULTICHAIN_NETWORK_DECIMAL_PLACES",{enumerable:!0,get:function(){return a.MULTICHAIN_NETWORK_DECIMAL_PLACES}}),Object.defineProperty(n,"AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS",{enumerable:!0,get:function(){return a.AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS}});var i=e("./utils.cjs");Object.defineProperty(n,"checkIfSupportedCaipChainId",{enumerable:!0,get:function(){return i.checkIfSupportedCaipChainId}}),Object.defineProperty(n,"toMultichainNetworkConfiguration",{enumerable:!0,get:function(){return i.toMultichainNetworkConfiguration}}),Object.defineProperty(n,"toMultichainNetworkConfigurationsByChainId",{enumerable:!0,get:function(){return i.toMultichainNetworkConfigurationsByChainId}}),Object.defineProperty(n,"toEvmCaipChainId",{enumerable:!0,get:function(){return i.toEvmCaipChainId}})}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/node_modules/@metamask/multichain-network-controller/dist/index.cjs"}],[3076,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MULTICHAIN_NETWORK_CONTROLLER_NAME=void 0,n.MULTICHAIN_NETWORK_CONTROLLER_NAME="MultichainNetworkController"}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/node_modules/@metamask/multichain-network-controller/dist/types.cjs"}],[3077,{"./constants.cjs":3074,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isKnownCaipNamespace=n.toMultichainNetworkConfigurationsByChainId=n.toMultichainNetworkConfiguration=n.convertEvmCaipToHexChainId=n.toEvmCaipChainId=n.checkIfSupportedCaipChainId=n.getChainIdForNonEvm=n.isEvmCaipChainId=void 0;const s=e("@metamask/utils"),r=e("./constants.cjs");n.isEvmCaipChainId=function(e){const{namespace:t}=(0,s.parseCaipChainId)(e);return t===s.KnownCaipNamespace.Eip155},n.getChainIdForNonEvm=function(e){const t=e.find(e=>Object.keys(r.AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS).includes(e));if(t)return t;throw new Error(`Unsupported scope: ${e.join(", ")}.`)},n.checkIfSupportedCaipChainId=function(e){return Object.keys(r.AVAILABLE_MULTICHAIN_NETWORK_CONFIGURATIONS).includes(e)};n.toEvmCaipChainId=e=>(0,s.toCaipChainId)(s.KnownCaipNamespace.Eip155,(0,s.hexToNumber)(e).toString()),n.convertEvmCaipToHexChainId=function(e){const{namespace:t,reference:n}=(0,s.parseCaipChainId)(e);if(t===s.KnownCaipNamespace.Eip155)return(0,s.add0x)(parseInt(n,10).toString(16));throw new Error(`Unsupported CAIP chain ID namespace: ${t}. Only eip155 is supported.`)};n.toMultichainNetworkConfiguration=e=>{const{chainId:t,name:s,rpcEndpoints:r,defaultRpcEndpointIndex:a,nativeCurrency:i,blockExplorerUrls:o,defaultBlockExplorerUrlIndex:c}=e;return{chainId:(0,n.toEvmCaipChainId)(t),isEvm:!0,name:s||r[a].url,nativeCurrency:i,blockExplorerUrls:o,defaultBlockExplorerUrlIndex:c||0}};n.toMultichainNetworkConfigurationsByChainId=e=>Object.entries(e).reduce((e,[,t])=>({...e,[(0,n.toEvmCaipChainId)(t.chainId)]:(0,n.toMultichainNetworkConfiguration)(t)}),{}),n.isKnownCaipNamespace=function(e){return Object.values(s.KnownCaipNamespace).includes(e)}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/multichain-network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/node_modules/@metamask/multichain-network-controller/dist/utils.cjs"}],[3078,{"./constants.cjs":3079,"./create-auto-managed-network-client.cjs":3080,"./logger.cjs":3083,"./types.cjs":3086,"@metamask/base-controller":1362,"@metamask/controller-utils":1449,"@metamask/eth-query":1991,"@metamask/rpc-errors":2600,"@metamask/swappable-obj-proxy":2945,"@metamask/utils":3116,"fast-deep-equal":4391,immer:4616,lodash:4838,reselect:5308,"uri-js":5708,uuid:5734},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,a,i,o,c,l,u,d,p,h,m,f,g,S,E,_,T,y,w,b,I,A,v,k,C,N,R,P,M=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),O=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),D=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&M(t,e,n);return O(t,e),t},L=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},j=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)},B=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.NetworkController=n.selectAvailableNetworkClientIds=n.getAvailableNetworkClientIds=n.selectNetworkConfigurations=n.getNetworkConfigurations=n.getDefaultNetworkControllerState=n.knownKeysOf=n.RpcEndpointType=void 0;const x=e("@metamask/base-controller"),F=e("@metamask/controller-utils"),U=B(e("@metamask/eth-query")),H=e("@metamask/rpc-errors"),q=e("@metamask/swappable-obj-proxy"),G=e("@metamask/utils"),$=B(e("fast-deep-equal")),W=e("immer"),V=e("lodash"),Y=e("reselect"),K=D(e("uri-js")),Q=e("uuid"),z=e("./constants.cjs"),X=e("./create-auto-managed-network-client.cjs"),J=e("./logger.cjs"),Z=e("./types.cjs"),ee=(0,J.createModuleLogger)(J.projectLogger,"NetworkController"),te=/^https:\/\/(?<networkName>[^.]+)\.infura\.io\/v\d+\/(?<apiKey>.+)$/u;var ne;function se(e){return Object.keys(e)}!function(e){e.Custom="custom",e.Infura="infura"}(ne||(n.RpcEndpointType=ne={})),n.knownKeysOf=se;const re="NetworkController";function ae(e=[]){const t=Object.values(F.InfuraNetworkType).reduce((e,t)=>{const n=F.ChainId[t];if(z.DEPRECATED_NETWORKS.has(n))return e;const s=`https://${t}.infura.io/v3/{infuraProjectId}`,r={blockExplorerUrls:[],chainId:n,defaultRpcEndpointIndex:0,name:F.NetworkNickname[t],nativeCurrency:F.NetworksTicker[t],rpcEndpoints:[{failoverUrls:[],networkClientId:t,type:ne.Infura,url:s}]};return{...e,[n]:r}},{}),n={[F.ChainId["megaeth-testnet"]]:ie(F.CustomNetworkType["megaeth-testnet"]),[F.ChainId["megaeth-testnet-v2"]]:ie(F.CustomNetworkType["megaeth-testnet-v2"]),[F.ChainId["monad-testnet"]]:ie(F.CustomNetworkType["monad-testnet"])};return e.reduce((e,t)=>((0,G.hasProperty)(n,t)&&(e[t]=n[t]),e),t)}function ie(e){const{ticker:t,rpcPrefs:n}=F.BUILT_IN_NETWORKS[e],s=F.BUILT_IN_CUSTOM_NETWORKS_RPC[e];return{blockExplorerUrls:[n.blockExplorerUrl],chainId:F.ChainId[e],defaultRpcEndpointIndex:0,defaultBlockExplorerUrlIndex:0,name:F.NetworkNickname[e],nativeCurrency:t,rpcEndpoints:[{failoverUrls:[],networkClientId:e,type:ne.Custom,url:s}]}}function oe(e){const t=ae(e);return{selectedNetworkClientId:F.InfuraNetworkType.mainnet,networksMetadata:{},networkConfigurationsByChainId:t}}n.getDefaultNetworkControllerState=oe;function ce(e){return Object.values(e.networkConfigurationsByChainId)}function le(e){return e.flatMap(e=>e.rpcEndpoints.map(e=>e.networkClientId))}function ue(e){const t=K.parse(e);return t.error===undefined&&("http"===t.scheme||"https"===t.scheme)}function de(e){const t=te.exec(e);if(t?.groups){if((0,F.isInfuraNetworkType)(t.groups.networkName))return t.groups.networkName;throw new Error(`Unknown Infura network '${t.groups.networkName}'`)}throw new Error("Could not derive Infura network from RPC endpoint URL")}function pe(e){return new Map(Object.values(e).flatMap(e=>e.rpcEndpoints.map(t=>[t.networkClientId,e])))}n.getNetworkConfigurations=ce,n.selectNetworkConfigurations=(0,Y.createSelector)(e=>e.networkConfigurationsByChainId,e=>Object.values(e)),n.getAvailableNetworkClientIds=le,n.selectAvailableNetworkClientIds=(0,Y.createSelector)(n.selectNetworkConfigurations,le);class he extends x.BaseController{constructor(e){const{messenger:t,state:n,infuraProjectId:g,log:S,getRpcServiceOptions:E,getBlockTrackerOptions:_,additionalDefaultNetworks:T,isRpcFailoverEnabled:w=!1}=e,b={...oe(T),...n};!function(e){const t=Object.entries(e.networkConfigurationsByChainId),n=le(ce(e));if(0===t.length)throw new Error("NetworkController state is invalid: `networkConfigurationsByChainId` cannot be empty");for(const[e,n]of t){if(e!==n.chainId)throw new Error(`NetworkController state has invalid \`networkConfigurationsByChainId\`: Network configuration '${n.name}' is filed under '${e}' which does not match its \`chainId\` of '${n.chainId}'`);if(n.blockExplorerUrls.length>0?n.defaultBlockExplorerUrlIndex===undefined||n.blockExplorerUrls[n.defaultBlockExplorerUrlIndex]===undefined:n.defaultBlockExplorerUrlIndex!==undefined)throw new Error(`NetworkController state has invalid \`networkConfigurationsByChainId\`: Network configuration '${n.name}' has a \`defaultBlockExplorerUrlIndex\` that does not refer to an entry in \`blockExplorerUrls\``);if(n.rpcEndpoints[n.defaultRpcEndpointIndex]===undefined)throw new Error(`NetworkController state has invalid \`networkConfigurationsByChainId\`: Network configuration '${n.name}' has a \`defaultRpcEndpointIndex\` that does not refer to an entry in \`rpcEndpoints\``)}if([...new Set(n)].length<n.length)throw new Error("NetworkController state has invalid `networkConfigurationsByChainId`: Every RPC endpoint across all network configurations must have a unique `networkClientId`")}(b);const I=function(e,t){const n=ce(e).sort((e,t)=>e.chainId.localeCompare(t.chainId)),s=le(n),r=Object.keys(e.networksMetadata).filter(e=>!s.includes(e));return(0,W.produce)(e,a=>{if(!s.includes(e.selectedNetworkClientId)){const s=n[0],r=s.rpcEndpoints[s.defaultRpcEndpointIndex].networkClientId;t.captureException?.(new Error(`\`selectedNetworkClientId\` '${e.selectedNetworkClientId}' does not refer to an RPC endpoint within a network configuration; correcting to '${r}'`)),a.selectedNetworkClientId=r}if(r.length>0){for(const e of r)delete a.networksMetadata[e];t.captureException?.(new Error("`networksMetadata` had invalid network client IDs, which have been removed"))}})}(b,t);if(!g||"string"!=typeof g)throw new Error("Invalid Infura project ID");super({name:re,metadata:{selectedNetworkClientId:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},networksMetadata:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},networkConfigurationsByChainId:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0}},messenger:t,state:I}),s.add(this),r.set(this,void 0),a.set(this,void 0),i.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),d.set(this,void 0),p.set(this,void 0),h.set(this,void 0),m.set(this,void 0),f.set(this,void 0),L(this,a,g,"f"),L(this,d,S,"f"),L(this,p,E,"f"),L(this,h,_,"f"),L(this,f,w,"f"),L(this,i,this.state.selectedNetworkClientId,"f"),L(this,m,pe(this.state.networkConfigurationsByChainId),"f"),this.messenger.registerActionHandler(`${this.name}:getEthQuery`,()=>j(this,r,"f")),this.messenger.registerActionHandler(`${this.name}:getNetworkClientById`,this.getNetworkClientById.bind(this)),this.messenger.registerActionHandler(`${this.name}:getEIP1559Compatibility`,this.getEIP1559Compatibility.bind(this)),this.messenger.registerActionHandler(`${this.name}:setActiveNetwork`,this.setActiveNetwork.bind(this)),this.messenger.registerActionHandler(`${this.name}:setProviderType`,this.setProviderType.bind(this)),this.messenger.registerActionHandler(`${this.name}:findNetworkClientIdByChainId`,this.findNetworkClientIdByChainId.bind(this)),this.messenger.registerActionHandler(`${this.name}:getNetworkConfigurationByChainId`,this.getNetworkConfigurationByChainId.bind(this)),this.messenger.registerActionHandler(`${this.name}:getNetworkConfigurationByNetworkClientId`,this.getNetworkConfigurationByNetworkClientId.bind(this)),this.messenger.registerActionHandler(`${this.name}:getSelectedNetworkClient`,this.getSelectedNetworkClient.bind(this)),this.messenger.registerActionHandler(`${this.name}:getSelectedChainId`,this.getSelectedChainId.bind(this)),this.messenger.registerActionHandler(`${this.name}:addNetwork`,this.addNetwork.bind(this)),this.messenger.registerActionHandler(`${this.name}:removeNetwork`,this.removeNetwork.bind(this)),this.messenger.registerActionHandler(`${this.name}:updateNetwork`,this.updateNetwork.bind(this)),this.messenger.subscribe(`${this.name}:rpcEndpointChainUnavailable`,({networkClientId:e})=>{j(this,s,"m",y).call(this,e,{networkStatus:z.NetworkStatus.Unavailable})}),this.messenger.subscribe(`${this.name}:rpcEndpointChainDegraded`,({networkClientId:e})=>{j(this,s,"m",y).call(this,e,{networkStatus:z.NetworkStatus.Degraded})}),this.messenger.subscribe(`${this.name}:rpcEndpointChainAvailable`,({networkClientId:e})=>{j(this,s,"m",y).call(this,e,{networkStatus:z.NetworkStatus.Available})})}enableRpcFailover(){j(this,s,"m",g).call(this,!0)}disableRpcFailover(){j(this,s,"m",g).call(this,!1)}getProviderAndBlockTracker(){return{provider:j(this,o,"f"),blockTracker:j(this,c,"f")}}getSelectedNetworkClient(){return j(this,o,"f")&&j(this,c,"f")?{provider:j(this,o,"f"),blockTracker:j(this,c,"f")}:undefined}getSelectedChainId(){const e=this.getNetworkConfigurationByNetworkClientId(this.state.selectedNetworkClientId);return e?.chainId}getNetworkClientRegistry(){const e=j(this,s,"m",N).call(this);return Object.assign({},e[Z.NetworkClientType.Infura],e[Z.NetworkClientType.Custom])}getNetworkClientById(e){if(!e)throw new Error("No network client ID was provided.");const t=j(this,s,"m",N).call(this);if((0,F.isInfuraNetworkType)(e)){const n=t[Z.NetworkClientType.Infura][e];if(!n)throw new Error(`No Infura network client was found with the ID "${e}".`);return n}const n=t[Z.NetworkClientType.Custom][e];if(!n)throw new Error(`No custom network client was found with the ID "${e}".`);return n}initializeProvider({lookupNetwork:e=!0}={}){return j(this,s,"m",P).call(this,this.state.selectedNetworkClientId),e?this.lookupNetwork():undefined}async lookupNetwork(e){e?await j(this,s,"m",_).call(this,e):await j(this,s,"m",T).call(this)}async lookupNetworkByClientId(e){await j(this,s,"m",_).call(this,e)}async setProviderType(e){if(e===F.NetworkType.rpc)throw new Error(`NetworkController - cannot call "setProviderType" with type "${F.NetworkType.rpc}". Use "setActiveNetwork"`);if(!(0,F.isInfuraNetworkType)(e))throw new Error(`Unknown Infura provider type "${String(e)}".`);await this.setActiveNetwork(e)}async setActiveNetwork(e,t={}){L(this,i,this.state.selectedNetworkClientId,"f"),await j(this,s,"m",S).call(this,e,t)}async getEIP1559Compatibility(e){if(e)return this.get1559CompatibilityWithNetworkClientId(e);if(!j(this,r,"f"))return!1;const{EIPS:t}=this.state.networksMetadata[this.state.selectedNetworkClientId];if(t[1559]!==undefined)return t[1559];const n=await j(this,s,"m",b).call(this,this.state.selectedNetworkClientId);return this.update(e=>{n!==undefined&&(e.networksMetadata[e.selectedNetworkClientId].EIPS[1559]=n)}),n}async get1559CompatibilityWithNetworkClientId(e){let t=this.state.networksMetadata[e];t?.EIPS[1559]===undefined&&(await this.lookupNetwork(e),t=this.state.networksMetadata[e]);const{EIPS:n}=t;return n[1559]}async resetConnection(){await j(this,s,"m",S).call(this,this.state.selectedNetworkClientId)}getNetworkConfigurationByChainId(e){return this.state.networkConfigurationsByChainId[e]}getNetworkConfigurationByNetworkClientId(e){return j(this,m,"f").get(e)}addNetwork(e){const{rpcEndpoints:t}=e,n=j(this,s,"m",N).call(this);j(this,s,"m",I).call(this,{mode:"add",networkFields:e,autoManagedNetworkClientRegistry:n});const r=t.map(e=>({type:"add",rpcEndpoint:e.type===ne.Custom?{...e,networkClientId:(0,Q.v4)()}:e})),a=j(this,s,"m",A).call(this,{networkFields:e,networkClientOperations:r});return j(this,s,"m",v).call(this,{networkFields:e,networkClientOperations:r,autoManagedNetworkClientRegistry:n}),this.update(t=>{j(this,s,"m",C).call(this,{state:t,mode:"add",networkFields:e,networkConfigurationToPersist:a})}),this.messenger.publish(`${re}:networkAdded`,a),a}async updateNetwork(e,t,{replacementSelectedRpcEndpointIndex:n}={}){const r=this.state.networkConfigurationsByChainId[e];if(r===undefined)throw new Error(`Could not update network: Cannot find network configuration for chain '${e}'`);const a=e,{chainId:i,rpcEndpoints:o}=t,c=j(this,s,"m",N).call(this);j(this,s,"m",I).call(this,{mode:"update",networkFields:t,existingNetworkConfiguration:r,autoManagedNetworkClientRegistry:c});const l=[];for(const e of o){const t=r.rpcEndpoints.find(t=>t.type===e.type&&t.url===e.url&&(t.networkClientId===e.networkClientId||e.networkClientId===undefined)),n=r.rpcEndpoints.find(t=>t.type===ne.Infura&&e.type===ne.Infura||t.type===e.type&&t.networkClientId===e.networkClientId&&t.url===e.url),s=r.rpcEndpoints.find(t=>t.type===e.type&&(t.url===e.url||t.networkClientId===e.networkClientId));if(i!==a&&n!==undefined){const t=e.type===ne.Infura?e:{...e,networkClientId:(0,Q.v4)()};l.push({type:"replace",oldRpcEndpoint:n,newRpcEndpoint:t})}else if(t!==undefined){let n;n=t.type===ne.Infura?t:Object.assign({},e,{networkClientId:t.networkClientId}),l.push({type:"noop",rpcEndpoint:n})}else if(s===undefined){const t={type:"add",rpcEndpoint:e.type===ne.Infura?e:{...e,networkClientId:(0,Q.v4)()}};l.push(t)}else{let t;t=e.type===ne.Infura?e:{...e,networkClientId:(0,Q.v4)()},l.push({type:"replace",oldRpcEndpoint:s,newRpcEndpoint:t})}}for(const e of r.rpcEndpoints)if(!l.some(t=>{const n="replace"===t.type?t.oldRpcEndpoint:t.rpcEndpoint;return n.type===e.type&&n.networkClientId===e.networkClientId&&n.url===e.url})){const t={type:"remove",rpcEndpoint:e};l.push(t)}const u=j(this,s,"m",A).call(this,{networkFields:t,networkClientOperations:l});if(n===undefined&&l.some(e=>"remove"===e.type&&e.rpcEndpoint.networkClientId===this.state.selectedNetworkClientId)&&!l.some(e=>"replace"===e.type&&e.oldRpcEndpoint.networkClientId===this.state.selectedNetworkClientId))throw new Error(`Could not update network: Cannot update RPC endpoints in such a way that the selected network '${this.state.selectedNetworkClientId}' would be removed without a replacement. Choose a different RPC endpoint as the selected network via the \`replacementSelectedRpcEndpointIndex\` option.`);j(this,s,"m",v).call(this,{networkFields:t,networkClientOperations:l,autoManagedNetworkClientRegistry:c});const d=l.map((e,t)=>[e,t]).find(([e,t])=>"replace"===e.type&&e.oldRpcEndpoint.networkClientId===this.state.selectedNetworkClientId),p=n??d?.[1];let h;if(p!==undefined&&(h=u.rpcEndpoints[p],h===undefined))throw new Error(`Could not update network: \`replacementSelectedRpcEndpointIndex\` ${p} does not refer to an entry in \`rpcEndpoints\``);return h&&h.networkClientId!==this.state.selectedNetworkClientId?await this.setActiveNetwork(h.networkClientId,{updateState:e=>{j(this,s,"m",C).call(this,{state:e,mode:"update",networkFields:t,networkConfigurationToPersist:u,existingNetworkConfiguration:r})}}):this.update(e=>{j(this,s,"m",C).call(this,{state:e,mode:"update",networkFields:t,networkConfigurationToPersist:u,existingNetworkConfiguration:r})}),j(this,s,"m",k).call(this,{networkClientOperations:l,autoManagedNetworkClientRegistry:c}),u}removeNetwork(e){const t=this.state.networkConfigurationsByChainId[e];if(t===undefined)throw new Error(`Cannot find network configuration for chain '${e}'`);if(t.rpcEndpoints.some(e=>e.networkClientId===this.state.selectedNetworkClientId))throw new Error("Cannot remove the currently selected network");const n=j(this,s,"m",N).call(this),r=t.rpcEndpoints.map(e=>({type:"remove",rpcEndpoint:e}));j(this,s,"m",k).call(this,{networkClientOperations:r,autoManagedNetworkClientRegistry:n}),this.update(e=>{j(this,s,"m",C).call(this,{state:e,mode:"remove",existingNetworkConfiguration:t});for(const n of t.rpcEndpoints)delete e.networksMetadata[n.networkClientId]}),this.messenger.publish("NetworkController:networkRemoved",t)}async rollbackToPreviousProvider(){await j(this,s,"m",S).call(this,j(this,i,"f"))}async destroy(){await(j(this,c,"f")?.destroy())}loadBackup({networkConfigurationsByChainId:e}){this.update(t=>{t.networkConfigurationsByChainId={...t.networkConfigurationsByChainId,...e}})}findNetworkClientIdByChainId(e){const t=this.state.networkConfigurationsByChainId[e];if(!t)throw new Error(`Invalid chain ID "${e}"`);const{networkClientId:n}=t.rpcEndpoints[t.defaultRpcEndpointIndex];return n}}n.NetworkController=he,r=new WeakMap,a=new WeakMap,i=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,p=new WeakMap,h=new WeakMap,m=new WeakMap,f=new WeakMap,s=new WeakSet,g=function(e){if(j(this,f,"f")===e)return;const t=j(this,s,"m",N).call(this);for(const n of Object.values(t))for(const t of Object.keys(n)){const s=n[t];s.configuration.failoverRpcUrls&&s.configuration.failoverRpcUrls.length>0&&(e?s.enableRpcFailover():s.disableRpcFailover())}L(this,f,e,"f")},S=async function(e,t={}){this.messenger.publish("NetworkController:networkWillChange",this.state),j(this,s,"m",P).call(this,e,t),this.messenger.publish("NetworkController:networkDidChange",this.state),await this.lookupNetwork()},E=async function(e){const t=((0,F.isInfuraNetworkType)(e),this.getNetworkClientById(e)).configuration.type===Z.NetworkClientType.Infura;let n,r;try{r=await j(this,s,"m",b).call(this,e),n=z.NetworkStatus.Available}catch(e){if(ee("NetworkController: lookupNetwork: ",e),function(e){return"object"==typeof e&&null!==e&&"code"in e}(e)){let s;if(t&&(0,G.hasProperty)(e,"message")&&"string"==typeof e.message)try{s=JSON.parse(e.message)}catch{j(this,d,"f")?.warn("NetworkController: lookupNetwork: json parse error: ",e)}(0,G.isPlainObject)(s)&&s.error===z.INFURA_BLOCKED_KEY?n=z.NetworkStatus.Blocked:e.code===H.errorCodes.rpc.internal?(n=z.NetworkStatus.Unknown,j(this,d,"f")?.warn("NetworkController: lookupNetwork: rpc internal error: ",e)):(n=z.NetworkStatus.Unavailable,j(this,d,"f")?.warn("NetworkController: lookupNetwork: ",e))}else ee("NetworkController - could not determine network status",e),n=z.NetworkStatus.Unknown,j(this,d,"f")?.warn("NetworkController: lookupNetwork: ",e)}return{isInfura:t,networkStatus:n,isEIP1559Compatible:r}},_=async function(e){const{networkStatus:t,isEIP1559Compatible:n}=await j(this,s,"m",E).call(this,e);j(this,s,"m",y).call(this,e,{networkStatus:t,isEIP1559Compatible:n})},T=async function(){if(!j(this,r,"f"))return;let e=!1;const t=()=>{e=!0;try{this.messenger.unsubscribe("NetworkController:networkDidChange",t)}catch(e){if(!(e instanceof Error)||"Subscription not found for event: NetworkController:networkDidChange"!==e.message)throw e}};this.messenger.subscribe("NetworkController:networkDidChange",t);const{isInfura:n,networkStatus:a,isEIP1559Compatible:i}=await j(this,s,"m",E).call(this,this.state.selectedNetworkClientId);if(!e){try{this.messenger.unsubscribe("NetworkController:networkDidChange",t)}catch(e){if(!(e instanceof Error)||"Subscription not found for event: NetworkController:networkDidChange"!==e.message)throw e}j(this,s,"m",y).call(this,this.state.selectedNetworkClientId,{networkStatus:a,isEIP1559Compatible:i}),n?a===z.NetworkStatus.Available?this.messenger.publish("NetworkController:infuraIsUnblocked"):a===z.NetworkStatus.Blocked&&this.messenger.publish("NetworkController:infuraIsBlocked"):this.messenger.publish("NetworkController:infuraIsUnblocked")}},y=function(e,t){this.update(n=>{var s;(s=n.networksMetadata)[e]??(s[e]={status:z.NetworkStatus.Unknown,EIPS:{}});const r=n.networksMetadata[e];r.status=t.networkStatus,"isEIP1559Compatible"in t&&(t.isEIP1559Compatible===undefined?delete r.EIPS[1559]:r.EIPS[1559]=t.isEIP1559Compatible)})},w=function(e=this.state.selectedNetworkClientId){const t=this.getNetworkClientById(e),n=new U.default(t.provider);return new Promise((e,t)=>{n.sendAsync({method:"eth_getBlockByNumber",params:["latest",!1]},(n,s)=>{n?t(n):e(s)})})},b=async function(e){const t=await j(this,s,"m",w).call(this,e);return t?t.baseFeePerGas!==undefined:undefined},I=function(e){const{mode:t,networkFields:n,autoManagedNetworkClientRegistry:s}=e,r="existingNetworkConfiguration"in e?e.existingNetworkConfiguration:null,a="update"===t?"Could not update network":"Could not add network";if(!(0,G.isStrictHexString)(n.chainId)||!(0,F.isSafeChainId)(n.chainId))throw new Error(`${a}: Invalid \`chainId\` '${n.chainId}' (must start with "0x" and not exceed the maximum)`);if(null===r||n.chainId!==r.chainId){const t=this.state.networkConfigurationsByChainId[n.chainId];if(t!==undefined)throw null===r?new Error(`Could not add network for chain ${e.networkFields.chainId} as another network for that chain already exists ('${t.name}')`):new Error(`Cannot move network from chain ${r.chainId} to ${n.chainId} as another network for that chain already exists ('${t.name}')`)}if(n.blockExplorerUrls.length>0?n.defaultBlockExplorerUrlIndex===undefined||n.blockExplorerUrls[n.defaultBlockExplorerUrlIndex]===undefined:n.defaultBlockExplorerUrlIndex!==undefined)throw new Error(`${a}: \`defaultBlockExplorerUrlIndex\` must refer to an entry in \`blockExplorerUrls\``);if(0===n.rpcEndpoints.length)throw new Error(`${a}: \`rpcEndpoints\` must be a non-empty array`);for(const e of n.rpcEndpoints){if(!ue(e.url))throw new Error(`${a}: An entry in \`rpcEndpoints\` has invalid URL '${e.url}'`);const i="networkClientId"in e?e.networkClientId:undefined;if(e.type===ne.Custom&&i!==undefined&&(0,F.isInfuraNetworkType)(i))throw new Error(`${a}: Custom RPC endpoint '${e.url}' has invalid network client ID '${i}'`);if("update"===t&&i!==undefined&&e.type===ne.Custom&&!Object.values(s).some(e=>i in e))throw new Error(`${a}: RPC endpoint '${e.url}' refers to network client '${i}' that does not exist`);if(n.rpcEndpoints.some(t=>t!==e&&K.equal(t.url,e.url)))throw new Error(`${a}: Each entry in rpcEndpoints must have a unique URL`);const o=Object.values(this.state.networkConfigurationsByChainId).filter(e=>!r||e.chainId!==r.chainId);for(const n of o){if(n.rpcEndpoints.find(t=>K.equal(e.url,t.url)))throw"update"===t?new Error(`Could not update network to point to same RPC endpoint as existing network for chain ${n.chainId} ('${n.name}')`):new Error(`Could not add network that points to same RPC endpoint as existing network for chain ${n.chainId} ('${n.name}')`)}}if([...new Set(n.rpcEndpoints)].length<n.rpcEndpoints.length)throw new Error(`${a}: Each entry in rpcEndpoints must be unique`);const i=n.rpcEndpoints.map(e=>"networkClientId"in e?e.networkClientId:undefined).filter(e=>e!==undefined);if([...new Set(i)].length<i.length)throw new Error(`${a}: Each entry in rpcEndpoints must have a unique networkClientId`);const o=n.rpcEndpoints.filter(e=>e.type===ne.Infura);if(o.length>1)throw new Error(`${a}: There cannot be more than one Infura RPC endpoint`);const c=o[0];if(c){const e=de(c.url),s=F.NetworkNickname[e],r=F.ChainId[e];if(n.chainId!==r)throw new Error("add"===t?`Could not add network with chain ID ${n.chainId} and Infura RPC endpoint for '${s}' which represents ${r}, as the two conflict`:`Could not update network with chain ID ${n.chainId} and Infura RPC endpoint for '${s}' which represents ${r}, as the two conflict`)}if(n.rpcEndpoints[n.defaultRpcEndpointIndex]===undefined)throw new Error(`${a}: \`defaultRpcEndpointIndex\` must refer to an entry in \`rpcEndpoints\``)},A=function({networkFields:e,networkClientOperations:t}){return{...e,rpcEndpoints:t.filter(e=>"add"===e.type||"noop"===e.type).map(e=>e.rpcEndpoint).concat(t.filter(e=>"replace"===e.type).map(e=>e.newRpcEndpoint))}},v=function({networkFields:e,networkClientOperations:t,autoManagedNetworkClientRegistry:n}){const s=t.filter(e=>"add"===e.type).map(e=>e.rpcEndpoint).concat(t.filter(e=>"replace"===e.type).map(e=>e.newRpcEndpoint));for(const t of s)t.type===ne.Infura?n[Z.NetworkClientType.Infura][t.networkClientId]=(0,X.createAutoManagedNetworkClient)({networkClientId:t.networkClientId,networkClientConfiguration:{type:Z.NetworkClientType.Infura,chainId:e.chainId,network:t.networkClientId,failoverRpcUrls:t.failoverUrls,infuraProjectId:j(this,a,"f"),ticker:e.nativeCurrency},getRpcServiceOptions:j(this,p,"f"),getBlockTrackerOptions:j(this,h,"f"),messenger:this.messenger,isRpcFailoverEnabled:j(this,f,"f"),logger:j(this,d,"f")}):n[Z.NetworkClientType.Custom][t.networkClientId]=(0,X.createAutoManagedNetworkClient)({networkClientId:t.networkClientId,networkClientConfiguration:{type:Z.NetworkClientType.Custom,chainId:e.chainId,failoverRpcUrls:t.failoverUrls,rpcUrl:t.url,ticker:e.nativeCurrency},getRpcServiceOptions:j(this,p,"f"),getBlockTrackerOptions:j(this,h,"f"),messenger:this.messenger,isRpcFailoverEnabled:j(this,f,"f"),logger:j(this,d,"f")})},k=function({networkClientOperations:e,autoManagedNetworkClientRegistry:t}){const n=e.filter(e=>"remove"===e.type).map(e=>e.rpcEndpoint).concat(e.filter(e=>"replace"===e.type).map(e=>e.oldRpcEndpoint));for(const e of n){const n=this.getNetworkClientById(e.networkClientId);n.destroy(),delete t[n.configuration.type][e.networkClientId]}},C=function(e){const{state:t,mode:n}=e;("remove"===n||"update"===n&&e.networkFields.chainId!==e.existingNetworkConfiguration.chainId)&&delete t.networkConfigurationsByChainId[e.existingNetworkConfiguration.chainId],"add"!==n&&"update"!==n||((0,$.default)(t.networkConfigurationsByChainId[e.networkFields.chainId],e.networkConfigurationToPersist)||(e.networkConfigurationToPersist.lastUpdatedAt=Date.now()),t.networkConfigurationsByChainId[e.networkFields.chainId]=e.networkConfigurationToPersist),L(this,m,pe((0,V.cloneDeep)(t.networkConfigurationsByChainId)),"f")},N=function(){return L(this,l,j(this,l,"f")??j(this,s,"m",R).call(this),"f")},R=function(){return se(this.state.networkConfigurationsByChainId).flatMap(e=>{const t=this.state.networkConfigurationsByChainId[e];return t.rpcEndpoints.map(e=>{if(e.type===ne.Infura){const n=de(e.url);return[e.networkClientId,(0,X.createAutoManagedNetworkClient)({networkClientId:e.networkClientId,networkClientConfiguration:{type:Z.NetworkClientType.Infura,network:n,failoverRpcUrls:e.failoverUrls,infuraProjectId:j(this,a,"f"),chainId:t.chainId,ticker:t.nativeCurrency},getRpcServiceOptions:j(this,p,"f"),getBlockTrackerOptions:j(this,h,"f"),messenger:this.messenger,isRpcFailoverEnabled:j(this,f,"f"),logger:j(this,d,"f")})]}return[e.networkClientId,(0,X.createAutoManagedNetworkClient)({networkClientId:e.networkClientId,networkClientConfiguration:{type:Z.NetworkClientType.Custom,chainId:t.chainId,failoverRpcUrls:e.failoverUrls,rpcUrl:e.url,ticker:t.nativeCurrency},getRpcServiceOptions:j(this,p,"f"),getBlockTrackerOptions:j(this,h,"f"),messenger:this.messenger,isRpcFailoverEnabled:j(this,f,"f"),logger:j(this,d,"f")})]})}).reduce((e,[t,n])=>({...e,[n.configuration.type]:{...e[n.configuration.type],[t]:n}}),{[Z.NetworkClientType.Custom]:{},[Z.NetworkClientType.Infura]:{}})},P=function(e,{updateState:t}={}){const n=j(this,s,"m",N).call(this);let a;if((0,F.isInfuraNetworkType)(e)){const t=n[Z.NetworkClientType.Infura][e];if(!t)throw new Error(`No Infura network client found with ID '${e}'`);a=t}else{const t=n[Z.NetworkClientType.Custom][e];if(!t)throw new Error(`No network client found with ID '${e}'`);a=t}L(this,u,a,"f"),this.update(n=>{var s;n.selectedNetworkClientId=e,(s=n.networksMetadata)[e]??(s[e]={status:z.NetworkStatus.Unknown,EIPS:{}}),t?.(n)}),j(this,o,"f")?j(this,o,"f").setTarget(j(this,u,"f").provider):L(this,o,(0,q.createSwappableProxy)(j(this,u,"f").provider),"f"),j(this,c,"f")?j(this,c,"f").setTarget(j(this,u,"f").blockTracker):L(this,c,(0,q.createEventEmitterProxy)(j(this,u,"f").blockTracker,{eventFilter:"skipInternal"}),"f"),L(this,r,new U.default(j(this,o,"f")),"f")}}}},{package:"@metamask/transaction-pay-controller>@metamask/bridge-controller>@metamask/network-controller",file:"node_modules/@metamask/transaction-pay-controller/node_modules/@metamask/bridge-controller/node_modules/@metamask/network-controller/dist/NetworkController.cjs"}]],[],{});