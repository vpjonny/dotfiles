LavaPack.loadBundle([[230,{"../../../shared/constants/app":5775,"../../../shared/constants/keyring":5787,"../../../shared/constants/metametrics":5791,"@metamask/base-controller":1362,loglevel:4846},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s,r=(s=e("loglevel"))&&s.__esModule?s:{default:s},i=e("@metamask/base-controller"),a=e("../../../shared/constants/metametrics"),o=e("../../../shared/constants/keyring"),c=e("../../../shared/constants/app");function l(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const u={unapprovedEncryptionPublicKeyMsgs:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0},unapprovedEncryptionPublicKeyMsgCount:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0}};class d extends i.BaseController{constructor({messenger:e,manager:t,getEncryptionPublicKey:n,getAccountKeyringType:s,getState:r,metricsEvent:i}){super({name:"EncryptionPublicKeyController",metadata:u,messenger:e,state:{unapprovedEncryptionPublicKeyMsgs:{},unapprovedEncryptionPublicKeyMsgCount:0}}),l(this,"_getEncryptionPublicKey",void 0),l(this,"_getAccountKeyringType",void 0),l(this,"_getState",void 0),l(this,"_encryptionPublicKeyManager",void 0),l(this,"_metricsEvent",void 0),this._getEncryptionPublicKey=n,this._getAccountKeyringType=s,this._getState=r,this._metricsEvent=i,this._encryptionPublicKeyManager=t,this.messenger.subscribe("EncryptionPublicKeyManager:unapprovedMessage",this._requestApproval.bind(this)),this._subscribeToMessageState(e,(e,t,n)=>{e.unapprovedEncryptionPublicKeyMsgs=t,e.unapprovedEncryptionPublicKeyMsgCount=n})}get unapprovedMsgCount(){return this._encryptionPublicKeyManager.getUnapprovedMessagesCount()}resetState(){this.update(()=>({unapprovedEncryptionPublicKeyMsgs:{},unapprovedEncryptionPublicKeyMsgCount:0}))}async newRequestEncryptionPublicKey(e,t){switch(await this._getAccountKeyringType(e)){case o.KeyringType.ledger:return new Promise((e,t)=>{t(new Error("Ledger does not support eth_getEncryptionPublicKey."))});case o.KeyringType.trezor:return new Promise((e,t)=>{t(new Error("Trezor does not support eth_getEncryptionPublicKey."))});case o.KeyringType.lattice:return new Promise((e,t)=>{t(new Error("Lattice does not support eth_getEncryptionPublicKey."))});case o.KeyringType.qr:return Promise.reject(new Error("QR hardware does not support eth_getEncryptionPublicKey."));default:return this._encryptionPublicKeyManager.addUnapprovedMessageAsync({from:e},t)}}async encryptionPublicKey(e){r.default.info("MetaMaskController - encryptionPublicKey");const t=e.metamaskId;try{const n=await this._encryptionPublicKeyManager.approveMessage(e),s=await this._getEncryptionPublicKey(n.from);return this._encryptionPublicKeyManager.setMessageStatusAndResult(t,s,"received"),this._acceptApproval(t),this._getState()}catch(e){throw r.default.info("MetaMaskController - eth_getEncryptionPublicKey failed.",e),this._cancelAbstractMessage(this._encryptionPublicKeyManager,t),e}}cancelEncryptionPublicKey(e){return this._cancelAbstractMessage(this._encryptionPublicKeyManager,e)}rejectUnapproved(e){Object.keys(this._encryptionPublicKeyManager.getUnapprovedMessages()).forEach(t=>{this._cancelAbstractMessage(this._encryptionPublicKeyManager,t,e)})}clearUnapproved(){this._encryptionPublicKeyManager.clearUnapprovedMessages()}_cancelAbstractMessage(e,t,n){return n&&this._metricsEvent({event:n,category:a.MetaMetricsEventCategory.Messages,properties:{action:"Encryption public key Request"}}),e.rejectMessage(t),this._rejectApproval(t),this._getState()}_subscribeToMessageState(e,t){e.subscribe("EncryptionPublicKeyManager:stateChange",e=>{const n=this._migrateMessages(e.unapprovedMessages);this.update(s=>{t(s,n,e.unapprovedMessagesCount)})})}_migrateMessages(e){const t={};for(const n of Object.keys(e)){const s=e[n],r=this._migrateMessage(s);t[n]=r}return t}_migrateMessage(e){const{messageParams:t,...n}=e;return{...n,rawSig:e.rawSig,msgParams:t.from,origin:t.origin}}_requestApproval(e){const t=e.metamaskId,n=e.origin||c.ORIGIN_METAMASK;this.messenger.call("ApprovalController:addRequest",{id:t,origin:n,type:"eth_getEncryptionPublicKey"},!0).catch(()=>{})}_acceptApproval(e){this.messenger.call("ApprovalController:acceptRequest",e)}_rejectApproval(e){this.messenger.call("ApprovalController:rejectRequest",e,"Cancel")}}n.default=d}}},{package:"$root$",file:"app/scripts/controllers/encryption-public-key.ts"}],[2302,{"@metamask/base-controller":1362,"@metamask/keyring-api":2193,"@metamask/keyring-snap-client":2214,"@metamask/snaps-utils":2903},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,i,a,o,c,l,u,d,h,p=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainTransactionsController=n.getDefaultMultichainTransactionsControllerState=void 0;const f=e("@metamask/base-controller"),m=e("@metamask/keyring-api"),g=e("@metamask/keyring-snap-client"),w=e("@metamask/snaps-utils");function b(){return{nonEvmTransactions:{}}}n.getDefaultMultichainTransactionsControllerState=b;const v={nonEvmTransactions:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0}};class S extends f.BaseController{constructor({messenger:e,state:t}){super({messenger:e,name:"MultichainTransactionsController",metadata:v,state:{nonEvmTransactions:{},...t}}),s.add(this);for(const e of p(this,s,"m",i).call(this))this.updateTransactionsForAccount(e.id).catch(t=>{console.error(`Failed to fetch initial transactions for account ${e.id}:`,t)});this.messenger.subscribe("AccountsController:accountAdded",e=>p(this,s,"m",c).call(this,e)),this.messenger.subscribe("AccountsController:accountRemoved",e=>p(this,s,"m",l).call(this,e)),this.messenger.subscribe("AccountsController:accountTransactionsUpdated",e=>p(this,s,"m",d).call(this,e))}async updateTransactionsForAccount(e){const{isUnlocked:t}=this.messenger.call("KeyringController:getState");if(t)try{const t=p(this,s,"m",i).call(this).find(t=>t.id===e);if(t?.metadata.snap){const e=await p(this,s,"m",a).call(this,t.id,t.metadata.snap.id,{limit:10}),n={};e.data.forEach(e=>{const{chain:t}=e;n[t]||(n[t]=[]),n[t].push(e)});const r=Object.entries(n).map(([t,n])=>({chain:t,entry:{transactions:n,next:e.next,lastUpdated:Date.now()}}));this.update(e=>{e.nonEvmTransactions[t.id]||(e.nonEvmTransactions[t.id]={}),r.forEach(({chain:n,entry:s})=>{e.nonEvmTransactions[t.id][n]=s})})}}catch(t){console.error(`Failed to fetch transactions for account ${e}:`,t)}}}n.MultichainTransactionsController=S,s=new WeakSet,r=function(){return this.messenger.call("AccountsController:listMultichainAccounts")},i=function(){return p(this,s,"m",r).call(this).filter(e=>p(this,s,"m",o).call(this,e))},a=async function(e,t,n){return await p(this,s,"m",h).call(this,t).listAccountTransactions(e,n)},o=function(e){return!(0,m.isEvmAccountType)(e.type)&&e.metadata.snap!==undefined},c=async function(e){p(this,s,"m",o).call(this,e)&&await this.updateTransactionsForAccount(e.id)},l=async function(e){e in this.state.nonEvmTransactions&&this.update(t=>{delete t.nonEvmTransactions[e]})},u=function(e){e.status===m.TransactionStatus.Confirmed&&this.messenger.publish("MultichainTransactionsController:transactionConfirmed",e),e.status===m.TransactionStatus.Submitted&&this.messenger.publish("MultichainTransactionsController:transactionSubmitted",e)},d=function(e){const t={},n=[];e?.transactions&&(Object.entries(e.transactions).forEach(([e,s])=>{t[e]={},s.forEach(s=>{const{chain:r}=s;t[e][r]||(t[e][r]=[]),t[e][r].push(s),n.push(s)}),Object.entries(t[e]).forEach(([n,s])=>{const r=this.state.nonEvmTransactions[e]?.[n]?.transactions??[],i=new Map;r.forEach(e=>{i.set(e.id,e)}),s.forEach(e=>{i.set(e.id,e)}),t[e][n]=Array.from(i.values()).sort((e,t)=>(t.timestamp??0)-(e.timestamp??0))})}),this.update(e=>{Object.entries(t).forEach(([t,n])=>{e.nonEvmTransactions[t]||(e.nonEvmTransactions[t]={}),Object.entries(n).forEach(([n,s])=>{e.nonEvmTransactions[t][n]={transactions:s,next:null,lastUpdated:Date.now()}})})}),n.forEach(e=>{p(this,s,"m",u).call(this,e)}))},h=function(e){return new g.KeyringClient({send:async t=>await this.messenger.call("SnapController:handleRequest",{snapId:e,origin:"metamask",handler:w.HandlerType.OnKeyringRequest,request:t})})}}}},{package:"@metamask/multichain-transactions-controller",file:"node_modules/@metamask/multichain-transactions-controller/dist/MultichainTransactionsController.cjs"}],[2303,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r;Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainNativeAsset=n.MultichainNetwork=void 0,function(e){e.Bitcoin="bip122:000000000019d6689c085ae165831e93",e.BitcoinTestnet="bip122:000000000933ea01ad0ee984209779ba",e.Solana="solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",e.SolanaDevnet="solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1",e.SolanaTestnet="solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z"}(s||(n.MultichainNetwork=s={})),function(e){e.Bitcoin="bip122:000000000019d6689c085ae165831e93/slip44:0",e.BitcoinTestnet="bip122:000000000933ea01ad0ee984209779ba/slip44:0",e.Solana="solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp/slip44:501",e.SolanaDevnet="solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1/slip44:501",e.SolanaTestnet="solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z/slip44:501"}(r||(n.MultichainNativeAsset=r={}))}}},{package:"@metamask/multichain-transactions-controller",file:"node_modules/@metamask/multichain-transactions-controller/dist/constants.cjs"}],[2304,{"./MultichainTransactionsController.cjs":2302,"./constants.cjs":2303},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainNativeAsset=n.MultichainNetwork=n.MultichainTransactionsController=void 0;var s=e("./MultichainTransactionsController.cjs");Object.defineProperty(n,"MultichainTransactionsController",{enumerable:!0,get:function(){return s.MultichainTransactionsController}});var r=e("./constants.cjs");Object.defineProperty(n,"MultichainNetwork",{enumerable:!0,get:function(){return r.MultichainNetwork}}),Object.defineProperty(n,"MultichainNativeAsset",{enumerable:!0,get:function(){return r.MultichainNativeAsset}})}}},{package:"@metamask/multichain-transactions-controller",file:"node_modules/@metamask/multichain-transactions-controller/dist/index.cjs"}],[231,{"../../../../shared/lib/accounts/institutional-wallet-snap":5820,"@metamask/base-controller":1362,"@metamask/controller-utils":1449,"@metamask/snaps-utils":2903,"@metamask/transaction-controller":2994},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.InstitutionalSnapController=void 0;var s=e("@metamask/transaction-controller"),r=e("@metamask/snaps-utils"),i=e("@metamask/base-controller"),a=e("@metamask/controller-utils");function o(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}const l=e("../../../../shared/lib/accounts/institutional-wallet-snap").INSTITUTIONAL_WALLET_SNAP_ID,u="InstitutionalSnapController",d={};var h=new WeakSet;class p extends i.BaseController{constructor({messenger:e}){super({messenger:e,name:u,state:{},metadata:d}),o(this,h),c(h,this,f).call(this)}async deferPublicationHook(e){if(await c(h,this,b).call(this,e)){const t=await c(h,this,g).call(this,e);return await c(h,this,w).call(this,e.id,t),!1}return!0}async beforeCheckPendingTransactionHook(e){return!await c(h,this,b).call(this,e)}}function f(){this.messenger.registerActionHandler(`${u}:publishHook`,this.deferPublicationHook.bind(this)),this.messenger.registerActionHandler(`${u}:beforeCheckPendingTransactionHook`,this.beforeCheckPendingTransactionHook.bind(this))}async function m(e){return await this.messenger.call("SnapController:handleRequest",e)}async function g(e){const t={from:e.txParams.from,to:e.txParams.to,value:e.txParams.value,data:e.txParams.data,chainId:e.chainId},n={snapId:l,origin:a.ORIGIN_METAMASK,handler:r.HandlerType.OnRpcRequest,request:{method:"transactions.getMutableTransactionParameters",params:t}},i=await c(h,this,m).call(this,n);return{hash:i.transaction.transactionHash,nonce:i.transaction.nonce,gasLimit:i.transaction.gasLimit,maxFeePerGas:i.transaction.maxFeePerGas,maxPriorityFeePerGas:i.transaction.maxPriorityFeePerGas,type:i.transaction.type,status:s.TransactionStatus.submitted}}async function w(e,{status:t,hash:n,nonce:s,gasLimit:r,maxFeePerGas:i,maxPriorityFeePerGas:a,type:o}){return await this.messenger.call("TransactionController:updateCustodialTransaction",{transactionId:e,status:t,hash:n,nonce:s,gasLimit:r,maxFeePerGas:i,maxPriorityFeePerGas:a,type:o})}async function b(e){var t;const n=await this.messenger.call("AccountsController:getAccountByAddress",e.txParams.from);return null==n||null===(t=n.options.custodian)||void 0===t?void 0:t.deferPublication}n.InstitutionalSnapController=p}}},{package:"$root$",file:"app/scripts/controllers/institutional-snap/InstitutionalSnapController.ts"}],[232,{"../../../development/build/constants":610,"../../../shared/constants/alarms":5772,"../../../shared/constants/app":5775,"../../../shared/constants/keyring":5787,"../../../shared/constants/metametrics":5791,"../../../shared/constants/time":5812,"../../../shared/constants/transaction":5814,"../../../shared/lib/trace":5897,"../../../shared/modules/mv3.utils":5925,"../lib/util":372,"@metamask/base-controller":1362,"@metamask/name-controller":2307,"@metamask/utils":3116,buffer:4084,"ethereumjs-util":4342,lodash:4838,uuid:5734},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){Object.defineProperty(n,"__esModule",{value:!0}),n.overrideAnonymousEventNames=n.getDefaultMetaMetricsControllerState=n.default=void 0;var s=e("lodash"),r=e("ethereumjs-util"),i=e("uuid"),a=e("@metamask/name-controller"),o=e("@metamask/utils"),c=e("@metamask/base-controller"),l=e("../../../shared/constants/app"),u=e("../../../shared/constants/metametrics"),d=e("../../../shared/constants/time"),h=e("../../../shared/modules/mv3.utils"),p=e("../../../shared/constants/alarms"),f=e("../lib/util"),m=e("../../../shared/constants/transaction"),g=e("../../../shared/lib/trace"),w=e("../../../development/build/constants"),b=e("../../../shared/constants/keyring");function v(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S(e,t,n){y(e,t),t.set(e,n)}function y(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function k(e,t){return e.get(E(e,t))}function T(e,t,n){return e.set(E(e,t),n),n}function E(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}const I=n.overrideAnonymousEventNames={[m.TransactionMetaMetricsEvent.added]:m.AnonymousTransactionMetaMetricsEvent.added,[m.TransactionMetaMetricsEvent.approved]:m.AnonymousTransactionMetaMetricsEvent.approved,[m.TransactionMetaMetricsEvent.finalized]:m.AnonymousTransactionMetaMetricsEvent.finalized,[m.TransactionMetaMetricsEvent.rejected]:m.AnonymousTransactionMetaMetricsEvent.rejected,[m.TransactionMetaMetricsEvent.submitted]:m.AnonymousTransactionMetaMetricsEvent.submitted,[u.MetaMetricsEventName.SignatureRequested]:u.MetaMetricsEventName.SignatureRequestedAnon,[u.MetaMetricsEventName.SignatureApproved]:u.MetaMetricsEventName.SignatureApprovedAnon,[u.MetaMetricsEventName.SignatureRejected]:u.MetaMetricsEventName.SignatureRejectedAnon},M=e=>{setTimeout(()=>{throw e})},_=e=>{const t=[];return e.uniqueIdentifier&&t.push(e.uniqueIdentifier),e.actionId&&t.push(e.actionId),t.length&&e.isDuplicateAnonymizedEvent&&t.push("0x000"),t.length?t.join("-"):(0,f.generateRandomId)()},C={'You must pass either an "anonymousId" or a "userId".':!0},A={metaMetricsId:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},participateInMetaMetrics:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},latestNonAnonymousEventTimestamp:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},fragments:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},eventsBeforeMetricsOptIn:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1},tracesBeforeMetricsOptIn:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1},traits:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1},dataCollectionForMarketing:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},marketingCampaignCookieId:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1},segmentApiCalls:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1}},P=()=>({participateInMetaMetrics:null,metaMetricsId:null,dataCollectionForMarketing:null,marketingCampaignCookieId:null,latestNonAnonymousEventTimestamp:0,eventsBeforeMetricsOptIn:[],tracesBeforeMetricsOptIn:[],traits:{},fragments:{},segmentApiCalls:{}});n.getDefaultMetaMetricsControllerState=P;var O=new WeakMap,j=new WeakMap,R=new WeakMap,N=new WeakMap,D=new WeakSet,x=new WeakMap;class F extends c.BaseController{constructor({state:e={},messenger:t,segment:n,version:r,environment:i,extension:a,captureException:c=M}){var l,u;super({name:"MetaMetricsController",metadata:A,state:{participateInMetaMetrics:null,metaMetricsId:null,dataCollectionForMarketing:null,marketingCampaignCookieId:null,latestNonAnonymousEventTimestamp:0,eventsBeforeMetricsOptIn:[],tracesBeforeMetricsOptIn:[],traits:{},fragments:{},segmentApiCalls:{},...e},messenger:t}),y(l=this,u=D),u.add(l),S(this,O,void 0),v(this,"chainId",void 0),v(this,"locale",void 0),v(this,"previousUserTraits",void 0),v(this,"version",void 0),S(this,j,void 0),S(this,R,void 0),S(this,N,void 0),S(this,x,(0,s.memoize)((e={})=>Object.values(e).reduce((e,t)=>e.concat(...Object.values(t)),[]))),T(O,this,e=>{const t=(0,o.getErrorMessage)(e);C[t]||c(e)}),this.chainId=E(D,this,L).call(this);const m=this.messenger.call("PreferencesController:getState");this.locale=m.currentLocale.replace("_","-"),this.version="production"===i?r:`${r}-${i}`,T(j,this,a),T(R,this,i),this.messenger.registerActionHandler("MetaMetricsController:trackEvent",this.trackEvent.bind(this)),this.messenger.registerActionHandler("MetaMetricsController:getMetaMetricsId",this.getMetaMetricsId.bind(this)),this.messenger.registerActionHandler("MetaMetricsController:createEventFragment",this.createEventFragment.bind(this)),this.messenger.registerActionHandler("MetaMetricsController:getEventFragmentById",this.getEventFragmentById.bind(this)),this.messenger.registerActionHandler("MetaMetricsController:updateEventFragment",this.updateEventFragment.bind(this)),this.messenger.registerActionHandler("MetaMetricsController:deleteEventFragment",this.deleteEventFragment.bind(this)),this.messenger.registerActionHandler("MetaMetricsController:finalizeEventFragment",this.finalizeEventFragment.bind(this));const g=(0,s.omitBy)(e.fragments,"persist");this.messenger.subscribe("PreferencesController:stateChange",({currentLocale:e})=>{this.locale=null==e?void 0:e.replace("_","-")}),this.messenger.subscribe("NetworkController:networkDidChange",({selectedNetworkClientId:e})=>{this.chainId=E(D,this,L).call(this,e)}),T(N,this,n),Object.values(g).forEach(e=>{this.processAbandonedFragment(e)}),h.isManifestV3&&Object.values(e.segmentApiCalls||{}).forEach(({eventType:e,payload:t})=>{try{E(D,this,X).call(this,e,t)}catch(e){k(O,this).call(this,e)}}),h.isManifestV3?(k(j,this).alarms.getAll().then(e=>{(0,f.checkAlarmExists)(e,p.METAMETRICS_FINALIZE_EVENT_FRAGMENT_ALARM)||k(j,this).alarms.create(p.METAMETRICS_FINALIZE_EVENT_FRAGMENT_ALARM,{delayInMinutes:1,periodInMinutes:1})}),k(j,this).alarms.onAlarm.addListener(e=>{e.name===p.METAMETRICS_FINALIZE_EVENT_FRAGMENT_ALARM&&this.finalizeAbandonedFragments()})):setInterval(()=>{this.finalizeAbandonedFragments()},30*d.SECOND)}finalizeAbandonedFragments(){Object.values(this.state.fragments).forEach(e=>{e.timeout&&e.lastUpdated&&Date.now()-e.lastUpdated/1e3>e.timeout&&this.processAbandonedFragment(e)})}generateMetaMetricsId(){return(0,r.bufferToHex)((0,r.keccak)(t.from(String(Date.now())+String(Math.round(Math.random()*Number.MAX_SAFE_INTEGER)))))}createEventFragment(e){if(!e.successEvent)throw new Error(`Must specify success event. Success event was: ${e.event}. Payload keys were: ${Object.keys(e)}. ${"object"==typeof e.properties?`Payload property keys were: ${Object.keys(e.properties)}`:""}`);const{fragments:t}=this.state,n=e.uniqueIdentifier??(0,i.v4)(),r={id:n,...e,lastUpdated:Date.now()},a=e.initialEvent===m.TransactionMetaMetricsEvent.submitted&&t[n]?{...t[n],canDeleteIfAbandoned:!1}:{};return this.update(e=>{e.fragments[n]=(0,s.merge)({},a,r)}),r.initialEvent&&this.trackEvent({event:r.initialEvent,category:r.category,properties:r.properties,sensitiveProperties:r.sensitiveProperties,page:r.page,referrer:r.referrer,revenue:r.revenue,value:r.value,currency:r.currency,environmentType:r.environmentType,actionId:e.actionId,uniqueIdentifier:e.uniqueIdentifier}),r}getEventFragmentById(e){return this.state.fragments[e]}processAbandonedFragment(e){e.canDeleteIfAbandoned?this.deleteEventFragment(e.id):this.finalizeEventFragment(e.id,{abandoned:!0})}updateEventFragment(e,t){const{fragments:n}=this.state,r=n[e];if(!r&&e.includes("transaction-submitted-"))this.update(n=>{n.fragments[e]={canDeleteIfAbandoned:!0,category:u.MetaMetricsEventCategory.Transactions,successEvent:m.TransactionMetaMetricsEvent.finalized,id:e,...t,lastUpdated:Date.now()}});else{if(!r)throw new Error(`Event fragment with id ${e} does not exist.`);this.update(n=>{n.fragments[e]=(0,s.merge)(n.fragments[e],{...t,lastUpdated:Date.now()})})}}deleteEventFragment(e){this.state.fragments[e]&&this.update(t=>{delete t.fragments[e]})}finalizeEventFragment(e,{abandoned:t=!1,page:n,referrer:s}={}){const r=this.state.fragments[e];if(!r)throw new Error(`Funnel with id ${e} does not exist.`);const i=t?r.failureEvent:r.successEvent;this.trackEvent({event:i??"",category:r.category,properties:r.properties,sensitiveProperties:r.sensitiveProperties,page:n??r.page,referrer:r.referrer??s,revenue:r.revenue,value:r.value,currency:r.currency,environmentType:r.environmentType,actionId:r.actionId,uniqueIdentifier:r.uniqueIdentifier?`${r.uniqueIdentifier}-${t?"failure":"success"}`:undefined}),this.update(t=>{delete t.fragments[e]})}identify(e){const{metaMetricsId:t,participateInMetaMetrics:n}=this.state;if(!n||!t||!e)return;if("object"!=typeof e)return void console.warn("MetaMetricsController#identify: userTraits parameter must be an object. Received type: "+typeof e);const s=E(D,this,H).call(this,e);E(D,this,V).call(this,s)}updateExtensionUninstallUrl(e,n){const s={av:this.version};e&&(s.mmi=t.from(n).toString("base64"),s.env=k(R,this));const r=new URLSearchParams(s);k(j,this)&&k(j,this).runtime&&k(j,this).runtime.setUninstallURL(`https://metamask.io/uninstalled?${r}`)}async setParticipateInMetaMetrics(e){const{metaMetricsId:t}=this.state,n=e&&!t?this.generateMetaMetricsId():t;return this.update(t=>{t.participateInMetaMetrics=e,t.metaMetricsId=n}),e?(this.trackEventsAfterMetricsOptIn(),this.clearEventsAfterMetricsOptIn(),this.trackTracesAfterMetricsOptIn(),this.clearTracesAfterMetricsOptIn()):this.state.marketingCampaignCookieId&&this.setMarketingCampaignCookieId(null),k(R,this)!==w.ENVIRONMENT.DEVELOPMENT&&null!==n&&null!==e&&this.updateExtensionUninstallUrl(e,n),n}setDataCollectionForMarketing(e){const{metaMetricsId:t}=this.state;return this.update(t=>{t.dataCollectionForMarketing=e}),!e&&this.state.marketingCampaignCookieId&&this.setMarketingCampaignCookieId(null),t}setMarketingCampaignCookieId(e){this.update(t=>{t.marketingCampaignCookieId=e})}trackPage(e,t){try{if(!1===this.state.participateInMetaMetrics)return;if(null===this.state.participateInMetaMetrics&&(null==t||!t.isOptInPath))return;const{name:n,params:s,environmentType:r,page:i,referrer:a,actionId:o}=e,{metaMetricsId:c}=this.state,l=c?"userId":"anonymousId",d=c??u.METAMETRICS_ANONYMOUS_ID;E(D,this,X).call(this,"page",{messageId:_({actionId:o}),[l]:d,name:n,properties:{params:s,locale:this.locale,chain_id:this.chainId,environment_type:r},context:E(D,this,W).call(this,a,i)})}catch(e){k(O,this).call(this,e)}}trackEvent(e,t){E(D,this,B).call(this,e),E(D,this,U).call(this,e,t).catch(e=>{k(O,this).call(this,e)})}handleMetaMaskStateUpdate(e){const t=this._buildUserTraitsObject(e);t&&this.identify(t)}trackEventsAfterMetricsOptIn(){const{eventsBeforeMetricsOptIn:e}=this.state;e.forEach(e=>{this.trackEvent(e)})}clearEventsAfterMetricsOptIn(){this.update(e=>{e.eventsBeforeMetricsOptIn=[]})}addEventBeforeMetricsOptIn(e){this.update(t=>{t.eventsBeforeMetricsOptIn.push(e)})}trackTracesAfterMetricsOptIn(){const{tracesBeforeMetricsOptIn:e}=this.state;e.forEach(e=>{"start"===e.type?(0,g.trace)(e.request):"end"===e.type&&(0,g.endTrace)(e.request)})}clearTracesAfterMetricsOptIn(){this.update(e=>{e.tracesBeforeMetricsOptIn=[]})}addTraceBeforeMetricsOptIn(e){this.update(t=>{t.tracesBeforeMetricsOptIn.push(e)})}bufferedTrace(e,t){if(this.state.participateInMetaMetrics)return t?(0,g.trace)(e,t):(0,g.trace)(e);let n;if(e.parentContext&&"object"==typeof e.parentContext){const t=e.parentContext;n=null==t?void 0:t._name}return this.addTraceBeforeMetricsOptIn({type:"start",request:{...e,parentContext:undefined,startTime:e.startTime??Date.now()},parentTraceName:n}),undefined}bufferedEndTrace(e){this.state.participateInMetaMetrics?(0,g.endTrace)(e):this.addTraceBeforeMetricsOptIn({type:"end",request:{...e,timestamp:e.timestamp??Date.now()}})}updateTraits(e){this.update(t=>{t.traits={...t.traits,...e}})}getMetaMetricsId(){let{metaMetricsId:e}=this.state;return e||(e=this.generateMetaMetricsId(),this.update(t=>{t.metaMetricsId=e})),e}_buildUserTraitsObject(e){var t,n,r;const{traits:i}=this.state,a=i[u.MetaMetricsUserTrait.StorageKind],o={[u.MetaMetricsUserTrait.AddressBookEntries]:(0,s.sum)(Object.values(e.addressBook).map(s.size)),[u.MetaMetricsUserTrait.InstallDateExt]:i[u.MetaMetricsUserTrait.InstallDateExt]||"",...a?{[u.MetaMetricsUserTrait.StorageKind]:a}:{},[u.MetaMetricsUserTrait.LedgerConnectionType]:e.ledgerTransportType,[u.MetaMetricsUserTrait.NetworksAdded]:Object.values(e.networkConfigurationsByChainId).map(e=>e.chainId),[u.MetaMetricsUserTrait.NetworksWithoutTicker]:Object.values(e.networkConfigurationsByChainId).filter(({nativeCurrency:e})=>!e).map(({chainId:e})=>e),[u.MetaMetricsUserTrait.ChainIdList]:[...Object.keys(e.networkConfigurationsByChainId).map(e=>`eip155:${parseInt(e,16)}`),...Object.keys((null==e?void 0:e.multichainNetworkConfigurationsByChainId)||{})],[u.MetaMetricsUserTrait.NftAutodetectionEnabled]:e.useNftDetection,[u.MetaMetricsUserTrait.NumberOfAccounts]:Object.values(e.internalAccounts.accounts).length,[u.MetaMetricsUserTrait.NumberOfNftCollections]:E(D,this,q).call(this,e.allNfts),[u.MetaMetricsUserTrait.NumberOfNfts]:k(x,this).call(this,e.allNfts).length,[u.MetaMetricsUserTrait.NumberOfTokens]:E(D,this,K).call(this,e.allTokens),[u.MetaMetricsUserTrait.NumberOfHDEntropies]:E(D,this,G).call(this,e)??(null===(t=this.previousUserTraits)||void 0===t?void 0:t.number_of_hd_entropies),[u.MetaMetricsUserTrait.OpenSeaApiEnabled]:e.openSeaEnabled,[u.MetaMetricsUserTrait.ThreeBoxEnabled]:!1,[u.MetaMetricsUserTrait.Theme]:e.theme||"default",[u.MetaMetricsUserTrait.TokenDetectionEnabled]:e.useTokenDetection,[u.MetaMetricsUserTrait.ShowNativeTokenAsMainBalance]:e.preferences.showNativeTokenAsMainBalance,[u.MetaMetricsUserTrait.CurrentCurrency]:e.currentCurrency,[u.MetaMetricsUserTrait.SecurityProviders]:e.securityAlertsEnabled?["blockaid"]:[],[u.MetaMetricsUserTrait.PetnameAddressCount]:E(D,this,Z).call(this,e),[u.MetaMetricsUserTrait.IsMetricsOptedIn]:e.participateInMetaMetrics,[u.MetaMetricsUserTrait.HasMarketingConsent]:e.dataCollectionForMarketing,[u.MetaMetricsUserTrait.TokenSortPreference]:(null===(n=e.preferences.tokenSortConfig)||void 0===n?void 0:n.key)||"",[u.MetaMetricsUserTrait.PrivacyModeEnabled]:e.preferences.privacyMode,[u.MetaMetricsUserTrait.NetworkFilterPreference]:Object.keys(e.preferences.tokenNetworkFilter||{}),[u.MetaMetricsUserTrait.ProfileId]:null===(r=Object.entries(e.srpSessionData||{}))||void 0===r||null===(r=r[0])||void 0===r||null===(r=r[1])||void 0===r||null===(r=r.profile)||void 0===r?void 0:r.profileId};if(!this.previousUserTraits&&e.participateInMetaMetrics)return this.previousUserTraits=o,o;if(this.previousUserTraits&&!(0,s.isEqual)(this.previousUserTraits,o)){const t=(0,s.pickBy)(o,(e,t)=>{const n=this.previousUserTraits[t];return!(0,s.isEqual)(n,e)});return e.participateInMetaMetrics&&(this.previousUserTraits=o),t}return null}}function L(e){const t=e||this.messenger.call("NetworkController:getState").selectedNetworkClientId,{configuration:{chainId:n}}=this.messenger.call("NetworkController:getNetworkClientById",t);return n}async function U(e,t){if(!(this.state.participateInMetaMetrics||null!=t&&t.isOptIn))return;const n=[];if(e.sensitiveProperties){if(!0===(null==t?void 0:t.excludeMetaMetricsId))throw new Error("sensitiveProperties was specified in an event payload that also set the excludeMetaMetricsId flag");const r=I[`${e.event}`],i={...e,event:r??e.event},a=(0,s.merge)({...i.sensitiveProperties},{...i.properties});n.push(E(D,this,J).call(this,E(D,this,$).call(this,{...i,properties:a,isDuplicateAnonymizedEvent:!0}),{...t,excludeMetaMetricsId:!0}))}n.push(E(D,this,J).call(this,E(D,this,$).call(this,e),t)),await Promise.all(n)}function B(e){if(!e.event)throw new Error(`Must specify event. Event was: ${e.event}. Payload keys were: ${Object.keys(e)}. ${"object"==typeof e.properties?`Payload property keys were: ${Object.keys(e.properties)}`:""}`)}function W(e,t=u.METAMETRICS_BACKGROUND_PAGE_OBJECT){return{app:{name:"MetaMask Extension",version:this.version},userAgent:window.navigator.userAgent,page:t,referrer:e,marketingCampaignCookieId:this.state.marketingCampaignCookieId}}function $(e){const{event:t,properties:n,revenue:r,value:i,currency:a,category:o,page:c,referrer:u,environmentType:d=l.ENVIRONMENT_TYPE_BACKGROUND,timestamp:h}=e;let p;return p=n&&"chain_id_caip"in n&&"string"==typeof n.chain_id_caip?null:n&&"chain_id"in n&&"string"==typeof n.chain_id?n.chain_id:this.chainId,{event:t,messageId:_(e),properties:{...(0,s.omit)(n,["revenue","locale","currency","value"]),revenue:r,value:i,currency:a,category:o,locale:this.locale,chain_id:p,environment_type:d},context:E(D,this,W).call(this,u,c),timestamp:h}}function H(e){const t={};for(const[n,s]of Object.entries(e))E(D,this,Y).call(this,s)?t[n]=s.toISOString():E(D,this,Q).call(this,s)?t[n]=s:console.warn(`MetaMetricsController: "${n}" value is not a valid trait type`);return t}function q(e={}){const t=k(x,this).call(this,e).map(e=>e.address);return new Set(t).size}function K(e){return Object.values(e).reduce((e,t)=>e+(0,s.sum)(Object.values(t).map(s.size)),0)}function G(e){var t;return(null===(t=e.keyrings)||void 0===t?void 0:t.filter(e=>e.type===b.KeyringType.hdKeyTree).length)??0}function V(e){const{metaMetricsId:t}=this.state;if(e&&0!==Object.keys(e).length)try{E(D,this,X).call(this,"identify",{userId:t??undefined,traits:e})}catch(e){k(O,this).call(this,e)}else console.warn("MetaMetricsController#_identify: No userTraits found")}function Q(e){const t=typeof e;return"string"===t||"boolean"===t||"number"===t||E(D,this,z).call(this,e)||E(D,this,Y).call(this,e)}function z(e){return Array.isArray(e)&&(e.every(e=>"string"==typeof e)||e.every(e=>"boolean"==typeof e)||e.every(e=>"number"==typeof e))}function Y(e){return"[object Date]"===Object.prototype.toString.call(e)}function J(e,t){const{isOptIn:n,metaMetricsId:s,matomoEvent:r,flushImmediately:i}=t||{};let a="userId",c=this.state.metaMetricsId,l=(null==t?void 0:t.excludeMetaMetricsId)??!1;const d=Boolean(e.event.match(/^send|^confirm/iu));return!1!==(null==t?void 0:t.excludeMetaMetricsId)&&d&&(l=!0),l||n&&!s?(a="anonymousId",c=u.METAMETRICS_ANONYMOUS_ID):n&&s&&(c=s),e[a]=c??undefined,!0===r&&(e.properties.legacy_event=!0),new Promise((t,n)=>{E(D,this,X).call(this,"track",e,e=>{if(e){const t=(0,o.isErrorWithMessage)(e)?e.message:"",s=(0,o.isErrorWithStack)(e)?e.stack:undefined,r=new Error(t);return s&&(r.stack=s),n(r)}return t()}),i&&k(N,this).flush()})}function X(e,t,n){const{metaMetricsId:s,latestNonAnonymousEventTimestamp:r,participateInMetaMetrics:i}=this.state;if(!i||!s)return;const a=t.messageId||(0,f.generateRandomId)();let o=new Date;if(t.timestamp){const e=new Date(t.timestamp);(0,f.isValidDate)(e)&&(o=e)}const c={...t,messageId:a,timestamp:o};this.update(t=>{t.latestNonAnonymousEventTimestamp=c.anonymousId===u.METAMETRICS_ANONYMOUS_ID?r:o.valueOf(),t.segmentApiCalls[a]={eventType:e,payload:{...c,timestamp:c.timestamp.toString()}}});k(N,this)[e](c,e=>(this.update(e=>{delete e.segmentApiCalls[a]}),null==n?void 0:n(e)))}function Z(e){var t;const n=(null===(t=e.names)||void 0===t?void 0:t[a.NameType.ETHEREUM_ADDRESS])??{};return Object.keys(n).reduce((e,t)=>{const s=n[t];return e+Object.keys(s).reduce((e,t)=>{var n;return e+(Boolean(null===(n=s[t].name)||void 0===n?void 0:n.length)?1:0)},0)},0)}n.default=F}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"$root$",file:"app/scripts/controllers/metametrics-controller.ts"}],[233,{"@metamask/base-controller":1362},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MetaMetricsDataDeletionController=void 0;var s=e("@metamask/base-controller");function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t){return e.get(a(e,t))}function a(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}const o="MetaMetricsDataDeletionController",c={metaMetricsDataDeletionId:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},metaMetricsDataDeletionTimestamp:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},metaMetricsDataDeletionStatus:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0}};var l=new WeakMap,u=new WeakSet;class d extends s.BaseController{constructor({dataDeletionService:e,messenger:t,state:n}){var s,i;super({messenger:t,metadata:c,name:o,state:{metaMetricsDataDeletionId:null,metaMetricsDataDeletionTimestamp:0,...n}}),r(s=this,i=u),i.add(s),function(e,t,n){r(e,t),t.set(e,n)}(this,l,void 0),function(e,t,n){e.set(a(e,t),n)}(l,this,e),a(u,this,h).call(this)}async createMetaMetricsDataDeletionTask(){const{metaMetricsId:e}=this.messenger.call("MetaMetricsController:getState");if(!e)throw new Error("MetaMetrics ID not found");const t=await i(l,this).createDataDeletionRegulationTask(e);this.update(e=>{e.metaMetricsDataDeletionId=t??null,e.metaMetricsDataDeletionTimestamp=Date.now()}),await this.updateDataDeletionTaskStatus()}async updateDataDeletionTaskStatus(){const e=this.state.metaMetricsDataDeletionId;if(!e)throw new Error("Delete Regulation id not found");const t=await i(l,this).fetchDeletionRegulationStatus(e);this.update(e=>{e.metaMetricsDataDeletionStatus=t??undefined})}}function h(){this.messenger.registerActionHandler(`${o}:createMetaMetricsDataDeletionTask`,this.createMetaMetricsDataDeletionTask.bind(this)),this.messenger.registerActionHandler(`${o}:updateDataDeletionTaskStatus`,this.updateDataDeletionTaskStatus.bind(this))}n.MetaMetricsDataDeletionController=d}}},{package:"$root$",file:"app/scripts/controllers/metametrics-data-deletion/metametrics-data-deletion.ts"}],[234,{"../../../shared/constants/network":5795,"@metamask/base-controller":1362,"@metamask/keyring-api":2193,"@metamask/multichain-network-controller":2299},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.NetworkOrderController=void 0;var s=e("@metamask/keyring-api"),r=e("@metamask/base-controller"),i=e("@metamask/multichain-network-controller"),a=e("../../../shared/constants/network");const o={orderedNetworkList:[]},c={orderedNetworkList:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0}};class l extends r.BaseController{constructor({messenger:e,state:t}){super({messenger:e,metadata:c,name:"NetworkOrderController",state:{...o,...t}}),this.messenger.subscribe("NetworkController:stateChange",e=>{this.onNetworkControllerStateChange(e)})}onNetworkControllerStateChange({networkConfigurationsByChainId:e}){this.update(t=>{const n=Object.keys(e).filter(e=>!a.TEST_CHAINS.includes(e)).map(i.toEvmCaipChainId),r=[s.BtcScope.Mainnet,s.SolScope.Mainnet,s.TrxScope.Mainnet],o=n.filter(e=>!t.orderedNetworkList.some(({networkId:t})=>t===e)).map(e=>({networkId:e}));t.orderedNetworkList=t.orderedNetworkList.filter(({networkId:e})=>n.includes(e)||r.includes(e)).concat(o)})}updateNetworksList(e){this.update(t=>{t.orderedNetworkList=e.map(e=>({networkId:e}))})}}n.NetworkOrderController=l}}},{package:"$root$",file:"app/scripts/controllers/network-order.ts"}],[2346,{"./constants.cjs":2347,"./utils.cjs":2350,"@metamask/base-controller":1362,"@metamask/controller-utils":1449,"@metamask/keyring-api":2193,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,i,a,o,c=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.NetworkEnablementController=void 0;const l=e("@metamask/base-controller"),u=e("@metamask/controller-utils"),d=e("@metamask/keyring-api"),h=e("@metamask/utils"),p=e("./constants.cjs"),f=e("./utils.cjs"),m={enabledNetworkMap:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0}};class g extends l.BaseController{constructor({messenger:e,state:t}){super({messenger:e,metadata:m,name:"NetworkEnablementController",state:{enabledNetworkMap:{[h.KnownCaipNamespace.Eip155]:{[u.ChainId[u.BuiltInNetworkName.Mainnet]]:!0,[u.ChainId[u.BuiltInNetworkName.LineaMainnet]]:!0,[u.ChainId[u.BuiltInNetworkName.BaseMainnet]]:!0},[h.KnownCaipNamespace.Solana]:{[d.SolScope.Mainnet]:!0,[d.SolScope.Testnet]:!1,[d.SolScope.Devnet]:!1},[h.KnownCaipNamespace.Bip122]:{[d.BtcScope.Mainnet]:!0,[d.BtcScope.Testnet]:!1,[d.BtcScope.Signet]:!1},[h.KnownCaipNamespace.Tron]:{[d.TrxScope.Mainnet]:!0,[d.TrxScope.Nile]:!1,[d.TrxScope.Shasta]:!1}},...t}}),s.add(this),e.subscribe("NetworkController:networkAdded",({chainId:e})=>{c(this,s,"m",o).call(this,e)}),e.subscribe("NetworkController:networkRemoved",({chainId:e})=>{c(this,s,"m",a).call(this,e)})}enableNetwork(e){const{namespace:t,storageKey:n}=(0,f.deriveKeys)(e);this.update(e=>{Object.keys(e.enabledNetworkMap).forEach(t=>{Object.keys(e.enabledNetworkMap[t]).forEach(n=>{e.enabledNetworkMap[t][n]=!1})}),e.enabledNetworkMap[t]&&(e.enabledNetworkMap[t][n]=!0)})}enableNetworkInNamespace(e,t){const{namespace:n,storageKey:i}=(0,f.deriveKeys)(e);if(n!==t)throw new Error(`Chain ID ${e} belongs to namespace ${n}, but namespace ${t} was specified`);this.update(e=>{c(this,s,"m",r).call(this,e,t),e.enabledNetworkMap[t]&&Object.keys(e.enabledNetworkMap[t]).forEach(n=>{e.enabledNetworkMap[t][n]=!1}),e.enabledNetworkMap[t][i]=!0})}enableAllPopularNetworks(){this.update(e=>{Object.keys(e.enabledNetworkMap).forEach(t=>{Object.keys(e.enabledNetworkMap[t]).forEach(n=>{e.enabledNetworkMap[t][n]=!1})});const t=this.messenger.call("NetworkController:getState"),n=this.messenger.call("MultichainNetworkController:getState");p.POPULAR_NETWORKS.forEach(n=>{const{namespace:i,storageKey:a}=(0,f.deriveKeys)(n);t.networkConfigurationsByChainId[n]&&(c(this,s,"m",r).call(this,e,i),e.enabledNetworkMap[i][a]=!0)});const i=(0,f.deriveKeys)(d.SolScope.Mainnet);n.multichainNetworkConfigurationsByChainId[d.SolScope.Mainnet]&&(c(this,s,"m",r).call(this,e,i.namespace),e.enabledNetworkMap[i.namespace][i.storageKey]=!0);const a=(0,f.deriveKeys)(d.BtcScope.Mainnet);n.multichainNetworkConfigurationsByChainId[d.BtcScope.Mainnet]&&(c(this,s,"m",r).call(this,e,a.namespace),e.enabledNetworkMap[a.namespace][a.storageKey]=!0);const o=(0,f.deriveKeys)(d.TrxScope.Mainnet);n.multichainNetworkConfigurationsByChainId[d.TrxScope.Mainnet]&&(c(this,s,"m",r).call(this,e,o.namespace),e.enabledNetworkMap[o.namespace][o.storageKey]=!0)})}init(){this.update(e=>{const t=this.messenger.call("NetworkController:getState"),n=this.messenger.call("MultichainNetworkController:getState");Object.keys(t.networkConfigurationsByChainId).forEach(t=>{const{namespace:n,storageKey:i}=(0,f.deriveKeys)(t);c(this,s,"m",r).call(this,e,n),e.enabledNetworkMap[n][i]===undefined&&(e.enabledNetworkMap[n][i]=!1)}),Object.keys(n.multichainNetworkConfigurationsByChainId).forEach(t=>{const{namespace:n,storageKey:i}=(0,f.deriveKeys)(t);c(this,s,"m",r).call(this,e,n),e.enabledNetworkMap[n][i]===undefined&&(e.enabledNetworkMap[n][i]=!1)})})}disableNetwork(e){const t=(0,f.deriveKeys)(e),{namespace:n,storageKey:s}=t;this.update(e=>{e.enabledNetworkMap[n][s]=!1})}isNetworkEnabled(e){const t=(0,f.deriveKeys)(e),{namespace:n,storageKey:s}=t;return this.state.enabledNetworkMap[n]?.[s]??!1}}n.NetworkEnablementController=g,s=new WeakSet,r=function(e,t){e.enabledNetworkMap[t]||(e.enabledNetworkMap[t]={})},i=function(){const e=this.messenger.call("NetworkController:getState");return p.POPULAR_NETWORKS.reduce((t,n)=>{if(!e.networkConfigurationsByChainId[n])return t;const{namespace:s,storageKey:r}=(0,f.deriveKeys)(n),i=this.state.enabledNetworkMap[s]?.[r];return i?t+1:t},0)>1},a=function(e){const t=(0,f.deriveKeys)(e),{namespace:n,storageKey:s}=t;this.update(e=>{(0,f.isOnlyNetworkEnabledInNamespace)(this.state,t)&&(e.enabledNetworkMap[n][u.ChainId[u.BuiltInNetworkName.Mainnet]]=!0),n in e.enabledNetworkMap&&delete e.enabledNetworkMap[n][s]})},o=function(e){const{namespace:t,storageKey:n,reference:a}=(0,f.deriveKeys)(e);this.update(e=>{c(this,s,"m",r).call(this,e,t);const o=c(this,s,"m",i).call(this),l=(0,f.isPopularNetwork)(a);o&&l||Object.keys(e.enabledNetworkMap).forEach(t=>{Object.keys(e.enabledNetworkMap[t]).forEach(n=>{e.enabledNetworkMap[t][n]=!1})}),e.enabledNetworkMap[t][n]=!0})}}}},{package:"@metamask/network-enablement-controller",file:"node_modules/@metamask/network-enablement-controller/dist/NetworkEnablementController.cjs"}],[2347,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.POPULAR_NETWORKS=void 0,n.POPULAR_NETWORKS=["0x1","0xe708","0x2105","0xa4b1","0xa86a","0x38","0xa","0x89","0x531","0x144","0x2a15c308d","0x3e7","0x8f"]}}},{package:"@metamask/network-enablement-controller",file:"node_modules/@metamask/network-enablement-controller/dist/constants.cjs"}],[2348,{"./NetworkEnablementController.cjs":2346,"./selectors.cjs":2349},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.selectEnabledSolanaNetworks=n.selectEnabledEvmNetworks=n.selectEnabledNetworksCount=n.selectAllEnabledNetworks=n.createSelectorForEnabledNetworksForNamespace=n.selectIsNetworkEnabled=n.selectEnabledNetworkMap=n.NetworkEnablementController=void 0;var s=e("./NetworkEnablementController.cjs");Object.defineProperty(n,"NetworkEnablementController",{enumerable:!0,get:function(){return s.NetworkEnablementController}});var r=e("./selectors.cjs");Object.defineProperty(n,"selectEnabledNetworkMap",{enumerable:!0,get:function(){return r.selectEnabledNetworkMap}}),Object.defineProperty(n,"selectIsNetworkEnabled",{enumerable:!0,get:function(){return r.selectIsNetworkEnabled}}),Object.defineProperty(n,"createSelectorForEnabledNetworksForNamespace",{enumerable:!0,get:function(){return r.createSelectorForEnabledNetworksForNamespace}}),Object.defineProperty(n,"selectAllEnabledNetworks",{enumerable:!0,get:function(){return r.selectAllEnabledNetworks}}),Object.defineProperty(n,"selectEnabledNetworksCount",{enumerable:!0,get:function(){return r.selectEnabledNetworksCount}}),Object.defineProperty(n,"selectEnabledEvmNetworks",{enumerable:!0,get:function(){return r.selectEnabledEvmNetworks}}),Object.defineProperty(n,"selectEnabledSolanaNetworks",{enumerable:!0,get:function(){return r.selectEnabledSolanaNetworks}})}}},{package:"@metamask/network-enablement-controller",file:"node_modules/@metamask/network-enablement-controller/dist/index.cjs"}],[2349,{"./utils.cjs":2350,"@metamask/utils":3116,reselect:5308},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.selectEnabledSolanaNetworks=n.selectEnabledEvmNetworks=n.selectEnabledNetworksCount=n.selectAllEnabledNetworks=n.createSelectorForEnabledNetworksForNamespace=n.selectIsNetworkEnabled=n.selectEnabledNetworkMap=void 0;const s=e("@metamask/utils"),r=e("reselect"),i=e("./utils.cjs");n.selectEnabledNetworkMap=e=>e.enabledNetworkMap;n.selectIsNetworkEnabled=e=>(0,r.createSelector)(n.selectEnabledNetworkMap,t=>{const{namespace:n,storageKey:s}=(0,i.deriveKeys)(e);return n in t&&s in t[n]&&t[n][s]});n.createSelectorForEnabledNetworksForNamespace=e=>(0,r.createSelector)(n.selectEnabledNetworkMap,t=>Object.entries(t[e]??{}).filter(([,e])=>e).map(([e])=>e)),n.selectAllEnabledNetworks=(0,r.createSelector)(n.selectEnabledNetworkMap,e=>Object.keys(e).reduce((t,n)=>(t[n]=Object.entries(e[n]).filter(([,e])=>e).map(([e])=>e),t),{})),n.selectEnabledNetworksCount=(0,r.createSelector)(n.selectAllEnabledNetworks,e=>Object.values(e).flat().length),n.selectEnabledEvmNetworks=(0,r.createSelector)((0,n.createSelectorForEnabledNetworksForNamespace)(s.KnownCaipNamespace.Eip155),e=>e),n.selectEnabledSolanaNetworks=(0,r.createSelector)((0,n.createSelectorForEnabledNetworksForNamespace)(s.KnownCaipNamespace.Solana),e=>e)}}},{package:"@metamask/network-enablement-controller",file:"node_modules/@metamask/network-enablement-controller/dist/selectors.cjs"}],[235,{"../../../shared/constants/onboarding":5798,"../../../shared/modules/environment":5917,"@metamask/base-controller":1362,loglevel:4846},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getDefaultOnboardingControllerState=n.default=void 0;var s,r=e("@metamask/base-controller"),i=(s=e("loglevel"))&&s.__esModule?s:{default:s},a=e("../../../shared/constants/onboarding"),o=e("../../../shared/modules/environment");function c(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const l=()=>({seedPhraseBackedUp:null,firstTimeFlowType:null,completedOnboarding:!1});n.getDefaultOnboardingControllerState=l;const u={onboardingTabs:{}},d={seedPhraseBackedUp:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},firstTimeFlowType:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},completedOnboarding:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},onboardingTabs:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0}};class h extends r.BaseController{constructor({messenger:e,state:t}){super({messenger:e,metadata:d,name:"OnboardingController",state:{seedPhraseBackedUp:null,firstTimeFlowType:null,completedOnboarding:!1,...t,...u}}),c(this,"registerOnboarding",async(e,t)=>{if(this.state.completedOnboarding)return void i.default.debug("Ignoring registerOnboarding; user already onboarded");const{onboardingTabs:n}={...this.state};n&&(n[e]&&n[e]===t||(i.default.debug(`Registering onboarding tab at location '${e}' with tabId '${t}'`),this.update(s=>{s.onboardingTabs={...n,[e]:t}})))})}setSeedPhraseBackedUp(e){this.update(t=>{t.seedPhraseBackedUp=e})}completeOnboarding(){return this.update(e=>{e.completedOnboarding=!0}),!0}setFirstTimeFlowType(e){this.update(t=>{t.firstTimeFlowType=e})}getIsSocialLoginFlow(){if(!(0,o.getIsSeedlessOnboardingFeatureEnabled)())return!1;const{firstTimeFlowType:e}=this.state;return e===a.FirstTimeFlowType.socialCreate||e===a.FirstTimeFlowType.socialImport}resetOnboarding(){this.update(e=>{e.completedOnboarding=!1,e.firstTimeFlowType=null,e.seedPhraseBackedUp=null,e.onboardingTabs={}})}}n.default=h}}},{package:"$root$",file:"app/scripts/controllers/onboarding.ts"}],[2350,{"./constants.cjs":2347,"@metamask/controller-utils":1449,"@metamask/multichain-network-controller":2299,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isPopularNetwork=n.isOnlyNetworkEnabledInNamespace=n.deriveKeys=void 0;const s=e("@metamask/controller-utils"),r=e("@metamask/multichain-network-controller"),i=e("@metamask/utils"),a=e("./constants.cjs");n.deriveKeys=function(e){const t=(0,i.isCaipChainId)(e)?e:(0,r.toEvmCaipChainId)(e),{namespace:n,reference:a}=(0,i.parseCaipChainId)(t);let o;return o=n===i.KnownCaipNamespace.Eip155?(0,i.isHexString)(e)?e:(0,s.toHex)(a):t,{namespace:n,storageKey:o,caipChainId:t,reference:a}},n.isOnlyNetworkEnabledInNamespace=function(e,t){const{namespace:n,storageKey:s}=t;if(!e.enabledNetworkMap[n])return!1;const r=e.enabledNetworkMap[n],i=Object.entries(r).filter(([e,t])=>t);if(1===i.length){const[e]=i[0];return e===s}return!1},n.isPopularNetwork=function(e){try{return a.POPULAR_NETWORKS.includes((0,s.toHex)(e))}catch{return!1}}}}},{package:"@metamask/network-enablement-controller",file:"node_modules/@metamask/network-enablement-controller/dist/utils.cjs"}],[2391,{"./push-utils.cjs":2392},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createSubscribeToPushNotifications=n.deleteRegToken=n.createRegToken=void 0;var s=e("./push-utils.cjs");Object.defineProperty(n,"createRegToken",{enumerable:!0,get:function(){return s.createRegToken}}),Object.defineProperty(n,"deleteRegToken",{enumerable:!0,get:function(){return s.deleteRegToken}}),Object.defineProperty(n,"createSubscribeToPushNotifications",{enumerable:!0,get:function(){return s.createSubscribeToPushNotifications}})}}},{package:"@metamask/notification-services-controller",file:"node_modules/@metamask/notification-services-controller/dist/NotificationServicesPushController/web/index.cjs"}],[2392,{"../../NotificationServicesController/index.cjs":2362,"../../shared/to-raw-notification.cjs":2396,"firebase/app":4412,"firebase/messaging":4413,"firebase/messaging/sw":4414,loglevel:4846},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.createSubscribeToPushNotifications=n.deleteRegToken=n.createRegToken=n.supportedCache=void 0;const r=e("firebase/app"),i=e("firebase/messaging"),a=e("firebase/messaging/sw"),o=s(e("loglevel")),c=e("../../NotificationServicesController/index.cjs"),l=e("../../shared/to-raw-notification.cjs");n.supportedCache=null;const u=async e=>{if(!await(async()=>(n.supportedCache??(n.supportedCache=await(0,a.isSupported)()),n.supportedCache))())return null;const t=await(async e=>{try{return(0,r.getApp)()}catch{const t={apiKey:e.apiKey,authDomain:e.authDomain,storageBucket:e.storageBucket,projectId:e.projectId,messagingSenderId:e.messagingSenderId,appId:e.appId,measurementId:e.measurementId};return(0,r.initializeApp)(t)}})(e);return(0,a.getMessaging)(t)};n.createRegToken=async function(e){try{const t=await u(e);if(!t)return null;return await(0,i.getToken)(t,{serviceWorkerRegistration:self.registration,vapidKey:e.vapidKey})}catch{return null}},n.deleteRegToken=async function(e){try{const t=await u(e);return!t||(await(0,i.deleteToken)(t),!0)}catch{return!1}},n.createSubscribeToPushNotifications=function(e){return async function(t){const n=await async function(e,t){const n=await u(e);if(!n)return null;const s=(0,a.onBackgroundMessage)(n,async e=>{try{const n=e?.data?.data?JSON.parse(e?.data?.data):undefined;if(!n)return;const s=(0,l.toRawAPINotification)(n),r=c.Processors.processNotification(s);await t(r)}catch(t){throw o.default.error("Unable to send push notification:",{notification:e?.data?.data,error:t}),new Error("Unable to send push notification")}});return()=>s()}(t,async t=>{e.messenger.publish("NotificationServicesPushController:onNewNotifications",t),await e.onReceivedHandler(t)}),s=function(e){const t=t=>{const n=t?.notification?.data;e(t,n)};return self.addEventListener("notificationclick",t),()=>self.removeEventListener("notificationclick",t)}((t,n)=>{e.messenger.publish("NotificationServicesPushController:pushNotificationClicked",n),e.onClickHandler(t,n)});return()=>{n?.(),s()}}}}}},{package:"@metamask/notification-services-controller",file:"node_modules/@metamask/notification-services-controller/dist/NotificationServicesPushController/web/push-utils.cjs"}],[24,{"../init-utils":61,"@metamask/assets-controllers":1292},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AssetsContractControllerInit=void 0;var s=e("@metamask/assets-controllers"),r=e("../init-utils");n.AssetsContractControllerInit=({controllerMessenger:e,initMessenger:t})=>({controller:new s.AssetsContractController({messenger:e,chainId:(0,r.getGlobalChainId)(t)}),memStateKey:null,persistedStateKey:null})}}},{package:"$root$",file:"app/scripts/controller-init/assets/assets-contract-controller-init.ts"}],[241,{"../../../../../shared/constants/keyring":5787,"../../../../../shared/constants/snaps/permissions":5806,"@metamask/keyring-controller":2203,"@metamask/snaps-rpc-methods":2730,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSnapPermissionSpecifications=function(e,t){return{...(0,s.buildSnapEndowmentSpecifications)(Object.keys(a.ExcludedSnapEndowments)),...(0,s.buildSnapRestrictedMethodSpecifications)(Object.keys(a.ExcludedSnapPermissions),{getPreferences:()=>{const t=e.call("CurrencyRateController:getState").currentCurrency,{currentLocale:n,openSeaEnabled:s,preferences:{privacyMode:r,showTestNetworks:i},securityAlertsEnabled:a,useCurrencyRateCheck:o,useTransactionSimulations:c,useTokenDetection:l,useMultiAccountBalanceChecker:u,useNftDetection:d}=e.call("PreferencesController:getState");return{locale:n,currency:t,hideBalances:r,useSecurityAlerts:a,useExternalPricingData:o,simulateOnChainActions:c,useTokenDetection:l,batchCheckBalances:u,displayNftMedia:s,useNftDetection:d,showTestnets:i}},clearSnapState:e.call.bind(e,"SnapController:clearSnapState"),getMnemonic:async t=>{if(!t){const[t]=e.call("KeyringController:getKeyringsByType",o.KeyringType.hdKeyTree);if(!t.mnemonic)throw new Error("Primary keyring mnemonic unavailable.");return t.mnemonic}try{const{type:n,mnemonic:s}=await e.call("KeyringController:withKeyring",{id:t},async({keyring:e})=>({type:e.type,mnemonic:(0,i.hasProperty)(e,"mnemonic")?e.mnemonic:undefined}));if(n!==r.KeyringTypes.hd||!s)throw new Error(`Entropy source with ID "${t}" not found.`);return s}catch{throw new Error(`Entropy source with ID "${t}" not found.`)}},getMnemonicSeed:async t=>{if(!t){const[t]=e.call("KeyringController:getKeyringsByType",o.KeyringType.hdKeyTree);if(!t.seed)throw new Error("Primary keyring mnemonic unavailable.");return t.seed}try{const{type:n,seed:s}=await e.call("KeyringController:withKeyring",{id:t},async({keyring:e})=>({type:e.type,seed:(0,i.hasProperty)(e,"seed")?e.seed:undefined}));if(n!==r.KeyringTypes.hd||!s)throw new Error(`Entropy source with ID "${t}" not found.`);return s}catch{throw new Error(`Entropy source with ID "${t}" not found.`)}},getUnlockPromise:e.call.bind(e,"AppStateController:getUnlockPromise"),getSnap:e.call.bind(e,"SnapController:get"),handleSnapRpcRequest:e.call.bind(e,"SnapController:handleRequest"),getSnapState:e.call.bind(e,"SnapController:getSnapState"),requestUserApproval:t.addAndShowApprovalRequest,showNativeNotification:(t,n)=>e.call("RateLimitController:call",t,"showNativeNotification",t,n.message),showInAppNotification:(t,n)=>{const{content:s,message:r,title:i,footerLink:a}=n,o={interfaceId:s,message:r,title:i,footerLink:a};return e.call("RateLimitController:call",t,"showInAppNotification",t,o)},updateSnapState:e.call.bind(e,"SnapController:updateSnapState"),maybeUpdatePhishingList:()=>{const{usePhishDetect:t}=e.call("PreferencesController:getState");t&&e.call("PhishingController:maybeUpdateState")},isOnPhishingList:t=>{const{usePhishDetect:n}=e.call("PreferencesController:getState");return!!n&&e.call("PhishingController:testOrigin",t).result},createInterface:e.call.bind(e,"SnapInterfaceController:createInterface"),getInterface:e.call.bind(e,"SnapInterfaceController:getInterface"),getClientCryptography:()=>({}),getSnapKeyring:async()=>{const[n]=e.call("KeyringController:getKeyringsByType",o.KeyringType.snap);return n||(await t.addNewKeyring(o.KeyringType.snap),e.call("KeyringController:getKeyringsByType",o.KeyringType.snap)[0])}})}};var s=e("@metamask/snaps-rpc-methods"),r=e("@metamask/keyring-controller"),i=e("@metamask/utils"),a=e("../../../../../shared/constants/snaps/permissions"),o=e("../../../../../shared/constants/keyring")}}},{package:"$root$",file:"app/scripts/controllers/permissions/snaps/specifications.ts"}],[2417,{"./ObservableStore":2419},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ComposedStore=void 0;const s=e("./ObservableStore");class r extends s.ObservableStore{constructor(e){super({}),this._children=e||{},Object.keys(this._children).forEach(e=>{const t=this._children[e];this._addChild(e,t)})}_addChild(e,t){const n=t=>{const n=this.getState();n[e]=t,this.putState(n)};t.subscribe(n),n(t.getState())}}n.ComposedStore=r}}},{package:"@metamask/obs-store",file:"node_modules/@metamask/obs-store/dist/ComposedStore.js"}],[2418,{"./ObservableStore":2419},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MergedStore=void 0;const s=e("./ObservableStore");class r extends s.ObservableStore{constructor(e=[]){super({}),this._children=e,e.forEach(e=>this._addChild(e)),this._updateWholeState()}_addChild(e){e.subscribe(()=>this._updateWholeState())}_updateWholeState(){const e=this._children.map(e=>e.getState()),t=Object.assign({},...e);this.putState(t)}}n.MergedStore=r}}},{package:"@metamask/obs-store",file:"node_modules/@metamask/obs-store/dist/MergedStore.js"}],[2419,{"@metamask/safe-event-emitter":2602},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.ObservableStore=void 0;const r=s(e("@metamask/safe-event-emitter"));class i extends r.default{constructor(e){super(),e===undefined?this._state={}:this._state=e}getState(){return this._getState()}putState(e){this._putState(e),this.emit("update",e)}updateState(e){if(e&&"object"==typeof e){const t=this.getState();this.putState(Object.assign(Object.assign({},t),e))}else this.putState(e)}subscribe(e){this.on("update",e)}unsubscribe(e){this.removeListener("update",e)}_getState(){return this._state}_putState(e){this._state=e}}n.ObservableStore=i}}},{package:"@metamask/obs-store",file:"node_modules/@metamask/obs-store/dist/ObservableStore.js"}],[2420,{"readable-stream":2437},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.storeAsStream=void 0;const s=e("readable-stream");class r extends s.Duplex{constructor(e){super({objectMode:!0}),this.resume(),this.handler=e=>this.push(e),this.obsStore=e,this.obsStore.subscribe(this.handler)}pipe(e,t){const n=super.pipe(e,t);return e.write(this.obsStore.getState()),n}_write(e,t,n){this.obsStore.putState(e),n()}_read(e){return undefined}_destroy(e,t){this.obsStore.unsubscribe(this.handler),super._destroy(e,t)}}n.storeAsStream=function(e){return new r(e)}}}},{package:"@metamask/obs-store",file:"node_modules/@metamask/obs-store/dist/asStream.js"}],[2421,{"./ComposedStore":2417,"./MergedStore":2418,"./ObservableStore":2419,"./asStream":2420,"./transform":2422},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./asStream"),n),r(e("./ComposedStore"),n),r(e("./MergedStore"),n),r(e("./ObservableStore"),n),r(e("./transform"),n)}}},{package:"@metamask/obs-store",file:"node_modules/@metamask/obs-store/dist/index.js"}],[2422,{"readable-stream":2437},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.storeTransformStream=void 0;const s=e("readable-stream");n.storeTransformStream=function(e){return new s.Transform({objectMode:!0,transform:(t,n,s)=>{try{const n=e(t);return s(undefined,n),undefined}catch(e){return s(e),undefined}}})}}}},{package:"@metamask/obs-store",file:"node_modules/@metamask/obs-store/dist/transform.js"}],[2423,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s={};function r(e,t,n){n||(n=Error);var r=function(e){var n,s;function r(n,s,r){return e.call(this,function(e,n,s){return"string"==typeof t?t:t(e,n,s)}(n,s,r))||this}return s=e,(n=r).prototype=Object.create(s.prototype),n.prototype.constructor=n,n.__proto__=s,r}(n);r.prototype.name=n.name,r.prototype.code=e,s[e]=r}function i(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map(function(e){return String(e)}),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}r("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError),r("ERR_INVALID_ARG_TYPE",function(e,t,n){var s,r,a,o;if("string"==typeof t&&(r="not ",t.substr(!a||a<0?0:+a,r.length)===r)?(s="must not be",t=t.replace(/^not /,"")):s="must be",function(e,t,n){return(n===undefined||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}(e," argument"))o="The ".concat(e," ").concat(s," ").concat(i(t,"type"));else{var c=function(e,t,n){return"number"!=typeof n&&(n=0),!(n+t.length>e.length)&&-1!==e.indexOf(t,n)}(e,".")?"property":"argument";o='The "'.concat(e,'" ').concat(c," ").concat(s," ").concat(i(t,"type"))}return o+=". Received type ".concat(typeof n)},TypeError),r("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),r("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"}),r("ERR_STREAM_PREMATURE_CLOSE","Premature close"),r("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"}),r("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),r("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),r("ERR_STREAM_WRITE_AFTER_END","write after end"),r("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),r("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError),r("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),t.exports.codes=s}}},{package:"@metamask/obs-store>readable-stream",file:"node_modules/@metamask/obs-store/node_modules/readable-stream/errors-browser.js"}],[2424,{"./_stream_readable":2426,"./_stream_writable":2428,_process:5089,inherits:4617},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var s=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};t.exports=l;var r=e("./_stream_readable"),i=e("./_stream_writable");e("inherits")(l,r);for(var a=s(i.prototype),o=0;o<a.length;o++){var c=a[o];l.prototype[c]||(l.prototype[c]=i.prototype[c])}function l(e){if(!(this instanceof l))return new l(e);r.call(this,e),i.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",u)))}function u(){this._writableState.ended||n.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(l.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(l.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){this._readableState!==undefined&&this._writableState!==undefined&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/obs-store>readable-stream",file:"node_modules/@metamask/obs-store/node_modules/readable-stream/lib/_stream_duplex.js"}],[2425,{"./_stream_transform":2427,inherits:4617},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=r;var s=e("./_stream_transform");function r(e){if(!(this instanceof r))return new r(e);s.call(this,e)}e("inherits")(r,s),r.prototype._transform=function(e,t,n){n(null,e)}}}},{package:"@metamask/obs-store>readable-stream",file:"node_modules/@metamask/obs-store/node_modules/readable-stream/lib/_stream_passthrough.js"}],[2426,{"../errors":2423,"./_stream_duplex":2424,"./internal/streams/async_iterator":2429,"./internal/streams/buffer_list":2430,"./internal/streams/destroy":2431,"./internal/streams/from":2433,"./internal/streams/state":2435,"./internal/streams/stream":2436,_process:5089,buffer:4084,events:4384,inherits:4617,"string_decoder/":5665,util:4036},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var s;t.exports=E,E.ReadableState=T;e("events").EventEmitter;var r=function(e,t){return e.listeners(t).length},i=e("./internal/streams/stream"),a=e("buffer").Buffer,o=("undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var c,l=e("util");c=l&&l.debuglog?l.debuglog("stream"):function(){};var u,d,h,p=e("./internal/streams/buffer_list"),f=e("./internal/streams/destroy"),m=e("./internal/streams/state").getHighWaterMark,g=e("../errors").codes,w=g.ERR_INVALID_ARG_TYPE,b=g.ERR_STREAM_PUSH_AFTER_EOF,v=g.ERR_METHOD_NOT_IMPLEMENTED,S=g.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;e("inherits")(E,i);var y=f.errorOrDestroy,k=["error","close","destroy","pause","resume"];function T(t,n,r){s=s||e("./_stream_duplex"),t=t||{},"boolean"!=typeof r&&(r=n instanceof s),this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=m(this,t,"readableHighWaterMark",r),this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(u||(u=e("string_decoder/").StringDecoder),this.decoder=new u(t.encoding),this.encoding=t.encoding)}function E(t){if(s=s||e("./_stream_duplex"),!(this instanceof E))return new E(t);var n=this instanceof s;this._readableState=new T(t,this,n),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),i.call(this)}function I(e,t,n,s,r){c("readableAddChunk",t);var i,l=e._readableState;if(null===t)l.reading=!1,function(e,t){if(c("onEofChunk"),t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.sync?A(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,P(e)))}(e,l);else if(r||(i=function(e,t){var n;s=t,a.isBuffer(s)||s instanceof o||"string"==typeof t||t===undefined||e.objectMode||(n=new w("chunk",["string","Buffer","Uint8Array"],t));var s;return n}(l,t)),i)y(e,i);else if(l.objectMode||t&&t.length>0)if("string"==typeof t||l.objectMode||Object.getPrototypeOf(t)===a.prototype||(t=function(e){return a.from(e)}(t)),s)l.endEmitted?y(e,new S):M(e,l,t,!0);else if(l.ended)y(e,new b);else{if(l.destroyed)return!1;l.reading=!1,l.decoder&&!n?(t=l.decoder.write(t),l.objectMode||0!==t.length?M(e,l,t,!1):O(e,l)):M(e,l,t,!1)}else s||(l.reading=!1,O(e,l));return!l.ended&&(l.length<l.highWaterMark||0===l.length)}function M(e,t,n,s){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",n)):(t.length+=t.objectMode?1:n.length,s?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&A(e)),O(e,t)}Object.defineProperty(E.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==undefined&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),E.prototype.destroy=f.destroy,E.prototype._undestroy=f.undestroy,E.prototype._destroy=function(e,t){t(e)},E.prototype.push=function(e,t){var n,s=this._readableState;return s.objectMode?n=!0:"string"==typeof e&&((t=t||s.defaultEncoding)!==s.encoding&&(e=a.from(e,t),t=""),n=!0),I(this,e,t,!1,n)},E.prototype.unshift=function(e){return I(this,e,null,!0,!1)},E.prototype.isPaused=function(){return!1===this._readableState.flowing},E.prototype.setEncoding=function(t){u||(u=e("string_decoder/").StringDecoder);var n=new u(t);this._readableState.decoder=n,this._readableState.encoding=this._readableState.decoder.encoding;for(var s=this._readableState.buffer.head,r="";null!==s;)r+=n.write(s.data),s=s.next;return this._readableState.buffer.clear(),""!==r&&this._readableState.buffer.push(r),this._readableState.length=r.length,this};var _=1073741824;function C(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=_?e=_:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function A(e){var t=e._readableState;c("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(c("emitReadable",t.flowing),t.emittedReadable=!0,n.nextTick(P,e))}function P(e){var t=e._readableState;c("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,x(e)}function O(e,t){t.readingMore||(t.readingMore=!0,n.nextTick(j,e,t))}function j(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var n=t.length;if(c("maybeReadMore read 0"),e.read(0),n===t.length)break}t.readingMore=!1}function R(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function N(e){c("readable nexttick read 0"),e.read(0)}function D(e,t){c("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),x(e),t.flowing&&!t.reading&&e.read(0)}function x(e){var t=e._readableState;for(c("flow",t.flowing);t.flowing&&null!==e.read(););}function F(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):n=t.buffer.consume(e,t.decoder),n);var n}function L(e){var t=e._readableState;c("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,n.nextTick(U,t,e))}function U(e,t){if(c("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var n=t._writableState;(!n||n.autoDestroy&&n.finished)&&t.destroy()}}function B(e,t){for(var n=0,s=e.length;n<s;n++)if(e[n]===t)return n;return-1}E.prototype.read=function(e){c("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return c("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?L(this):A(this),null;if(0===(e=C(e,t))&&t.ended)return 0===t.length&&L(this),null;var s,r=t.needReadable;return c("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&c("length less than watermark",r=!0),t.ended||t.reading?c("reading or ended",r=!1):r&&(c("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=C(n,t))),null===(s=e>0?F(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&L(this)),null!==s&&this.emit("data",s),s},E.prototype._read=function(e){y(this,new v("_read()"))},E.prototype.pipe=function(e,t){var s=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,c("pipe count=%d opts=%j",i.pipesCount,t);var a=(!t||!1!==t.end)&&e!==n.stdout&&e!==n.stderr?l:g;function o(t,n){c("onunpipe"),t===s&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,c("cleanup"),e.removeListener("close",f),e.removeListener("finish",m),e.removeListener("drain",u),e.removeListener("error",p),e.removeListener("unpipe",o),s.removeListener("end",l),s.removeListener("end",g),s.removeListener("data",h),d=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||u())}function l(){c("onend"),e.end()}i.endEmitted?n.nextTick(a):s.once("end",a),e.on("unpipe",o);var u=function(e){return function(){var t=e._readableState;c("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&r(e,"data")&&(t.flowing=!0,x(e))}}(s);e.on("drain",u);var d=!1;function h(t){c("ondata");var n=e.write(t);c("dest.write",n),!1===n&&((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==B(i.pipes,e))&&!d&&(c("false write response, pause",i.awaitDrain),i.awaitDrain++),s.pause())}function p(t){c("onerror",t),g(),e.removeListener("error",p),0===r(e,"error")&&y(e,t)}function f(){e.removeListener("finish",m),g()}function m(){c("onfinish"),e.removeListener("close",f),g()}function g(){c("unpipe"),s.unpipe(e)}return s.on("data",h),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",p),e.once("close",f),e.once("finish",m),e.emit("pipe",s),i.flowing||(c("pipe resume"),s.resume()),e},E.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var s=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<r;i++)s[i].emit("unpipe",this,{hasUnpiped:!1});return this}var a=B(t.pipes,e);return-1===a||(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},E.prototype.on=function(e,t){var s=i.prototype.on.call(this,e,t),r=this._readableState;return"data"===e?(r.readableListening=this.listenerCount("readable")>0,!1!==r.flowing&&this.resume()):"readable"===e&&(r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.flowing=!1,r.emittedReadable=!1,c("on readable",r.length,r.reading),r.length?A(this):r.reading||n.nextTick(N,this))),s},E.prototype.addListener=E.prototype.on,E.prototype.removeListener=function(e,t){var s=i.prototype.removeListener.call(this,e,t);return"readable"===e&&n.nextTick(R,this),s},E.prototype.removeAllListeners=function(e){var t=i.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&e!==undefined||n.nextTick(R,this),t},E.prototype.resume=function(){var e=this._readableState;return e.flowing||(c("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,n.nextTick(D,e,t))}(this,e)),e.paused=!1,this},E.prototype.pause=function(){return c("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(c("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},E.prototype.wrap=function(e){var t=this,n=this._readableState,s=!1;for(var r in e.on("end",function(){if(c("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(r){(c("wrapped data"),n.decoder&&(r=n.decoder.write(r)),!n.objectMode||null!==r&&r!==undefined)&&((n.objectMode||r&&r.length)&&(t.push(r)||(s=!0,e.pause())))}),e)this[r]===undefined&&"function"==typeof e[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));for(var i=0;i<k.length;i++)e.on(k[i],this.emit.bind(this,k[i]));return this._read=function(t){c("wrapped _read",t),s&&(s=!1,e.resume())},this},"function"==typeof Symbol&&(E.prototype[Symbol.asyncIterator]=function(){return d===undefined&&(d=e("./internal/streams/async_iterator")),d(this)}),Object.defineProperty(E.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(E.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(E.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),E._fromList=F,Object.defineProperty(E.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(E.from=function(t,n){return h===undefined&&(h=e("./internal/streams/from")),h(E,t,n)})}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/obs-store>readable-stream",file:"node_modules/@metamask/obs-store/node_modules/readable-stream/lib/_stream_readable.js"}],[2427,{"../errors":2423,"./_stream_duplex":2424,inherits:4617},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=u;var s=e("../errors").codes,r=s.ERR_METHOD_NOT_IMPLEMENTED,i=s.ERR_MULTIPLE_CALLBACK,a=s.ERR_TRANSFORM_ALREADY_TRANSFORMING,o=s.ERR_TRANSFORM_WITH_LENGTH_0,c=e("./_stream_duplex");function l(e,t){var n=this._transformState;n.transforming=!1;var s=n.writecb;if(null===s)return this.emit("error",new i);n.writechunk=null,n.writecb=null,null!=t&&this.push(t),s(e);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}function u(e){if(!(this instanceof u))return new u(e);c.call(this,e),this._transformState={afterTransform:l.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",d)}function d(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?h(this,null,null):this._flush(function(t,n){h(e,t,n)})}function h(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new o;if(e._transformState.transforming)throw new a;return e.push(null)}e("inherits")(u,c),u.prototype.push=function(e,t){return this._transformState.needTransform=!1,c.prototype.push.call(this,e,t)},u.prototype._transform=function(e,t,n){n(new r("_transform()"))},u.prototype._write=function(e,t,n){var s=this._transformState;if(s.writecb=n,s.writechunk=e,s.writeencoding=t,!s.transforming){var r=this._readableState;(s.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},u.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},u.prototype._destroy=function(e,t){c.prototype._destroy.call(this,e,function(e){t(e)})}}}},{package:"@metamask/obs-store>readable-stream",file:"node_modules/@metamask/obs-store/node_modules/readable-stream/lib/_stream_transform.js"}],[2428,{"../errors":2423,"./_stream_duplex":2424,"./internal/streams/destroy":2431,"./internal/streams/state":2435,"./internal/streams/stream":2436,_process:5089,buffer:4084,inherits:4617,"util-deprecate":5730},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){function s(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var s=e.entry;e.entry=null;for(;s;){var r=s.callback;t.pendingcb--,r(n),s=s.next}t.corkedRequestsFree.next=e}(t,e)}}var r;t.exports=E,E.WritableState=T;var i={deprecate:e("util-deprecate")},a=e("./internal/streams/stream"),o=e("buffer").Buffer,c=("undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var l,u=e("./internal/streams/destroy"),d=e("./internal/streams/state").getHighWaterMark,h=e("../errors").codes,p=h.ERR_INVALID_ARG_TYPE,f=h.ERR_METHOD_NOT_IMPLEMENTED,m=h.ERR_MULTIPLE_CALLBACK,g=h.ERR_STREAM_CANNOT_PIPE,w=h.ERR_STREAM_DESTROYED,b=h.ERR_STREAM_NULL_VALUES,v=h.ERR_STREAM_WRITE_AFTER_END,S=h.ERR_UNKNOWN_ENCODING,y=u.errorOrDestroy;function k(){}function T(t,i,a){r=r||e("./_stream_duplex"),t=t||{},"boolean"!=typeof a&&(a=i instanceof r),this.objectMode=!!t.objectMode,a&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=d(this,t,"writableHighWaterMark",a),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var o=!1===t.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var s=e._writableState,r=s.sync,i=s.writecb;if("function"!=typeof i)throw new m;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(s),t)!function(e,t,s,r,i){--t.pendingcb,s?(n.nextTick(i,r),n.nextTick(P,e,t),e._writableState.errorEmitted=!0,y(e,r)):(i(r),e._writableState.errorEmitted=!0,y(e,r),P(e,t))}(e,s,r,t,i);else{var a=C(s)||e.destroyed;a||s.corked||s.bufferProcessing||!s.bufferedRequest||_(e,s),r?n.nextTick(M,e,s,a,i):M(e,s,a,i)}}(i,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function E(t){var n=this instanceof(r=r||e("./_stream_duplex"));if(!n&&!l.call(E,this))return new E(t);this._writableState=new T(t,this,n),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),a.call(this)}function I(e,t,n,s,r,i,a){t.writelen=s,t.writecb=a,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new w("write")):n?e._writev(r,t.onwrite):e._write(r,i,t.onwrite),t.sync=!1}function M(e,t,n,s){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,s(),P(e,t)}function _(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),a=t.corkedRequestsFree;a.entry=n;for(var o=0,c=!0;n;)i[o]=n,n.isBuf||(c=!1),n=n.next,o+=1;i.allBuffers=c,I(e,t,!0,t.length,i,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new s(t),t.bufferedRequestCount=0}else{for(;n;){var l=n.chunk,u=n.encoding,d=n.callback;if(I(e,t,!1,t.objectMode?1:l.length,l,u,d),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function C(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function A(e,t){e._final(function(n){t.pendingcb--,n&&y(e,n),t.prefinished=!0,e.emit("prefinish"),P(e,t)})}function P(e,t){var s=C(t);if(s&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,n.nextTick(A,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var r=e._readableState;(!r||r.autoDestroy&&r.endEmitted)&&e.destroy()}return s}e("inherits")(E,a),T.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(T.prototype,"buffer",{get:i.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(l=Function.prototype[Symbol.hasInstance],Object.defineProperty(E,Symbol.hasInstance,{value:function(e){return!!l.call(this,e)||this===E&&(e&&e._writableState instanceof T)}})):l=function(e){return e instanceof this},E.prototype.pipe=function(){y(this,new g)},E.prototype.write=function(e,t,s){var r,i=this._writableState,a=!1,l=!i.objectMode&&(r=e,o.isBuffer(r)||r instanceof c);return l&&!o.isBuffer(e)&&(e=function(e){return o.from(e)}(e)),"function"==typeof t&&(s=t,t=null),l?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof s&&(s=k),i.ending?function(e,t){var s=new v;y(e,s),n.nextTick(t,s)}(this,s):(l||function(e,t,s,r){var i;return null===s?i=new b:"string"==typeof s||t.objectMode||(i=new p("chunk",["string","Buffer"],s)),!i||(y(e,i),n.nextTick(r,i),!1)}(this,i,e,s))&&(i.pendingcb++,a=function(e,t,n,s,r,i){if(!n){var a=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=o.from(t,n));return t}(t,s,r);s!==a&&(n=!0,r="buffer",s=a)}var c=t.objectMode?1:s.length;t.length+=c;var l=t.length<t.highWaterMark;l||(t.needDrain=!0);if(t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:s,encoding:r,isBuf:n,callback:i,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else I(e,t,!1,c,s,r,i);return l}(this,i,l,e,t,s)),a},E.prototype.cork=function(){this._writableState.corked++},E.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||_(this,e))},E.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new S(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(E.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(E.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),E.prototype._write=function(e,t,n){n(new f("_write()"))},E.prototype._writev=null,E.prototype.end=function(e,t,s){var r=this._writableState;return"function"==typeof e?(s=e,e=null,t=null):"function"==typeof t&&(s=t,t=null),null!==e&&e!==undefined&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||function(e,t,s){t.ending=!0,P(e,t),s&&(t.finished?n.nextTick(s):e.once("finish",s));t.ended=!0,e.writable=!1}(this,r,s),this},Object.defineProperty(E.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(E.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==undefined&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),E.prototype.destroy=u.destroy,E.prototype._undestroy=u.undestroy,E.prototype._destroy=function(e,t){t(e)}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/obs-store>readable-stream",file:"node_modules/@metamask/obs-store/node_modules/readable-stream/lib/_stream_writable.js"}],[2429,{"./end-of-stream":2432,_process:5089},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var s;function r(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=e("./end-of-stream"),a=Symbol("lastResolve"),o=Symbol("lastReject"),c=Symbol("error"),l=Symbol("ended"),u=Symbol("lastPromise"),d=Symbol("handlePromise"),h=Symbol("stream");function p(e,t){return{value:e,done:t}}function f(e){var t=e[a];if(null!==t){var n=e[h].read();null!==n&&(e[u]=null,e[a]=null,e[o]=null,t(p(n,!1)))}}function m(e){n.nextTick(f,e)}var g=Object.getPrototypeOf(function(){}),w=Object.setPrototypeOf((r(s={get stream(){return this[h]},next:function(){var e=this,t=this[c];if(null!==t)return Promise.reject(t);if(this[l])return Promise.resolve(p(undefined,!0));if(this[h].destroyed)return new Promise(function(t,s){n.nextTick(function(){e[c]?s(e[c]):t(p(undefined,!0))})});var s,r=this[u];if(r)s=new Promise(function(e,t){return function(n,s){e.then(function(){t[l]?n(p(undefined,!0)):t[d](n,s)},s)}}(r,this));else{var i=this[h].read();if(null!==i)return Promise.resolve(p(i,!1));s=new Promise(this[d])}return this[u]=s,s}},Symbol.asyncIterator,function(){return this}),r(s,"return",function(){var e=this;return new Promise(function(t,n){e[h].destroy(null,function(e){e?n(e):t(p(undefined,!0))})})}),s),g);t.exports=function(e){var t,n=Object.create(w,(r(t={},h,{value:e,writable:!0}),r(t,a,{value:null,writable:!0}),r(t,o,{value:null,writable:!0}),r(t,c,{value:null,writable:!0}),r(t,l,{value:e._readableState.endEmitted,writable:!0}),r(t,d,{value:function(e,t){var s=n[h].read();s?(n[u]=null,n[a]=null,n[o]=null,e(p(s,!1))):(n[a]=e,n[o]=t)},writable:!0}),t));return n[u]=null,i(e,function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=n[o];return null!==t&&(n[u]=null,n[a]=null,n[o]=null,t(e)),void(n[c]=e)}var s=n[a];null!==s&&(n[u]=null,n[a]=null,n[o]=null,s(p(undefined,!0))),n[l]=!0}),e.on("readable",m.bind(null,n)),n}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/obs-store>readable-stream",file:"node_modules/@metamask/obs-store/node_modules/readable-stream/lib/internal/streams/async_iterator.js"}],[243,{"../../../shared/constants/defi-referrals":5780,"../../../shared/constants/hardware-wallets":5785,"../../../shared/constants/network":5795,"../../../shared/constants/preferences":5800,"@metamask/base-controller":1362},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getDefaultPreferencesControllerState=n.ReferralStatus=n.PreferencesController=void 0;var s=e("@metamask/base-controller"),r=e("../../../shared/constants/network"),i=e("../../../shared/constants/hardware-wallets"),a=e("../../../shared/constants/preferences"),o=e("../../../shared/constants/defi-referrals");function c(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}let l=n.ReferralStatus=function(e){return e.Approved="approved",e.Passed="passed",e.Declined="declined",e}({});const u=()=>({addSnapAccountEnabled:!1,advancedGasFee:{},currentLocale:"",dismissSeedBackUpReminder:!1,enableMV3TimestampSave:!0,featureFlags:{},forgottenPassword:!1,identities:{},ipfsGateway:r.IPFS_DEFAULT_GATEWAY_URL,isIpfsGatewayEnabled:!0,knownMethodData:{},ledgerTransportType:window.navigator.hid?i.LedgerTransportTypes.webhid:i.LedgerTransportTypes.u2f,lostIdentities:{},manageInstitutionalWallets:!1,openSeaEnabled:!0,overrideContentSecurityPolicyHeader:!0,preferences:{autoLockTimeLimit:undefined,avatarType:"maskicon",dismissSmartAccountSuggestionEnabled:!1,featureNotificationsEnabled:!1,hideZeroBalanceTokens:!1,petnamesEnabled:!0,privacyMode:!1,showConfirmationAdvancedDetails:!1,showExtensionInFullSizeView:!1,showFiatInTestnets:!1,showMultiRpcModal:!1,showNativeTokenAsMainBalance:!1,showTestNetworks:!1,skipDeepLinkInterstitial:!1,smartAccountOptIn:!0,smartTransactionsOptInStatus:!0,smartTransactionsMigrationApplied:!1,tokenNetworkFilter:{},tokenSortConfig:{key:"tokenFiatAmount",order:"dsc",sortCallback:"stringNumeric"},useNativeCurrencyAsPrimaryCurrency:!0,useSidePanelAsDefault:!1},securityAlertsEnabled:!0,selectedAddress:"",snapRegistryList:{},snapsAddSnapAccountModalDismissed:!1,theme:a.ThemeType.os,use4ByteResolution:!0,useAddressBarEnsResolution:!0,useBlockie:!1,useCurrencyRateCheck:!0,useExternalNameSources:!0,useExternalServices:!0,isMultiAccountBalancesEnabled:!0,useMultiAccountBalanceChecker:!0,useNftDetection:!0,usePhishDetect:!0,useSafeChainsListValidation:!0,useTokenDetection:!0,useTransactionSimulations:!0,watchEthereumAccountEnabled:!1,referrals:{[o.DefiReferralPartner.Hyperliquid]:{}}});n.getDefaultPreferencesControllerState=u;const d={addSnapAccountEnabled:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},advancedGasFee:{persist:!0,includeInStateLogs:!0,includeInDebugSnapshot:!0,usedInUi:!0},currentLocale:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},dismissSeedBackUpReminder:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},enableMV3TimestampSave:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},featureFlags:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},forgottenPassword:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},identities:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},ipfsGateway:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},isIpfsGatewayEnabled:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},knownMethodData:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},ledgerTransportType:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},lostIdentities:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},manageInstitutionalWallets:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},openSeaEnabled:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},overrideContentSecurityPolicyHeader:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},preferences:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},securityAlertsEnabled:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},selectedAddress:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},snapRegistryList:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},snapsAddSnapAccountModalDismissed:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},textDirection:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},theme:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},use4ByteResolution:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},useAddressBarEnsResolution:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},useBlockie:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},useCurrencyRateCheck:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},useExternalNameSources:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},useExternalServices:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},isMultiAccountBalancesEnabled:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},useMultiAccountBalanceChecker:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},useNftDetection:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},usePhishDetect:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},useSafeChainsListValidation:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},useTokenDetection:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},useTransactionSimulations:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},watchEthereumAccountEnabled:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},referrals:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0}};var h=new WeakSet;class p extends s.BaseController{constructor({messenger:e,state:t}){const n=u(),s={...n,...t,preferences:{...n.preferences,...null==t?void 0:t.preferences},referrals:{...n.referrals,...null==t?void 0:t.referrals},isMultiAccountBalancesEnabled:(null==t?void 0:t.useMultiAccountBalanceChecker)??n.isMultiAccountBalancesEnabled};super({messenger:e,metadata:d,name:"PreferencesController",state:s}),c(this,h),this.messenger.subscribe("AccountsController:stateChange",function(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}(h,this,f).bind(this)),globalThis.setPreference=(e,t)=>this.setFeatureFlag(e,t)}setPasswordForgotten(e){this.update(t=>{t.forgottenPassword=e})}setUseBlockie(e){this.update(t=>{t.useBlockie=e})}setUsePhishDetect(e){this.update(t=>{t.usePhishDetect=e})}setUseMultiAccountBalanceChecker(e){this.update(t=>{t.useMultiAccountBalanceChecker=e,t.isMultiAccountBalancesEnabled=e})}setUseSafeChainsListValidation(e){this.update(t=>{t.useSafeChainsListValidation=e})}toggleExternalServices(e){this.update(t=>{t.useExternalServices=e}),this.setUseTokenDetection(e),this.setUseCurrencyRateCheck(e),this.setUsePhishDetect(e),this.setUseAddressBarEnsResolution(e),this.setOpenSeaEnabled(e),this.setUseNftDetection(e),this.setUseSafeChainsListValidation(e)}setUseTokenDetection(e){this.update(t=>{t.useTokenDetection=e})}setUseNftDetection(e){this.update(t=>{t.useNftDetection=e})}setUse4ByteResolution(e){this.update(t=>{t.use4ByteResolution=e})}setUseCurrencyRateCheck(e){this.update(t=>{t.useCurrencyRateCheck=e})}setOpenSeaEnabled(e){this.update(t=>{t.openSeaEnabled=e})}setSecurityAlertsEnabled(e){this.update(t=>{t.securityAlertsEnabled=e})}setAddSnapAccountEnabled(e){this.update(t=>{t.addSnapAccountEnabled=e})}setUseExternalNameSources(e){this.update(t=>{t.useExternalNameSources=e})}setUseTransactionSimulations(e){this.update(t=>{t.useTransactionSimulations=e})}setAdvancedGasFee({chainId:e,gasFeePreferences:t}){const{advancedGasFee:n}=this.state;this.update(s=>{s.advancedGasFee={...n,[e]:t}})}setTheme(e){this.update(t=>{t.theme=e})}addKnownMethodData(e,t){const{knownMethodData:n}=this.state,s={...n};s[e]=t,this.update(e=>{e.knownMethodData=s})}setCurrentLocale(e){const t=["ar","dv","fa","he","ku"].includes(e)?"rtl":"auto";return this.update(n=>{n.currentLocale=e,n.textDirection=t}),t}setSelectedAddress(e){const t=this.messenger.call("AccountsController:getAccountByAddress",e);if(!t)throw new Error(`Identity for '${e} not found`);this.messenger.call("AccountsController:setSelectedAccount",t.id)}getSelectedAddress(){return this.messenger.call("AccountsController:getSelectedAccount").address}setAccountLabel(e,t){if(!e)throw new Error(`setAccountLabel requires a valid address, got ${String(e)}`);const n=this.messenger.call("AccountsController:getAccountByAddress",e);return n?(this.messenger.call("AccountsController:setAccountName",n.id,t),t):undefined}setFeatureFlag(e,t){const n={...this.state.featureFlags,[e]:t};return this.update(e=>{e.featureFlags=n}),n}setPreference(e,t){const n={...this.getPreferences(),[e]:t};return this.update(e=>{e.preferences=n}),n}getPreferences(){return this.state.preferences}getIpfsGateway(){return this.state.ipfsGateway}setIpfsGateway(e){return this.update(t=>{t.ipfsGateway=e}),e}setIsIpfsGatewayEnabled(e){this.update(t=>{t.isIpfsGatewayEnabled=e})}setUseAddressBarEnsResolution(e){this.update(t=>{t.useAddressBarEnsResolution=e})}setLedgerTransportPreference(e){return this.update(t=>{t.ledgerTransportType=e}),e}setDismissSeedBackUpReminder(e){this.update(t=>{t.dismissSeedBackUpReminder=e})}setOverrideContentSecurityPolicyHeader(e){this.update(t=>{t.overrideContentSecurityPolicyHeader=e})}setManageInstitutionalWallets(e){this.update(t=>{t.manageInstitutionalWallets=e})}setServiceWorkerKeepAlivePreference(e){this.update(t=>{t.enableMV3TimestampSave=e})}setUseSidePanelAsDefault(e){this.update(t=>{t.preferences.useSidePanelAsDefault=e})}setSnapsAddSnapAccountModalDismissed(e){this.update(t=>{t.snapsAddSnapAccountModalDismissed=e})}addReferralApprovedAccount(e,t){this.update(n=>{n.referrals[e][t]=l.Approved})}addReferralPassedAccount(e,t){this.update(n=>{n.referrals[e][t]=l.Passed})}addReferralDeclinedAccount(e,t){this.update(n=>{n.referrals[e][t]=l.Declined})}removeReferralDeclinedAccount(e,t){this.update(n=>{delete n.referrals[e][t]})}setAccountsReferralApproved(e,t){this.update(n=>{t.forEach(t=>{n.referrals[e][t]=l.Approved})})}}function f(e){const{accounts:t,selectedAccount:n}=e.internalAccounts,s=t[n],{identities:r,lostIdentities:i}=this.state,a=Object.values(t).map(e=>e.address.toLowerCase()),o=Object.keys(r).reduce((e,t)=>(a.includes(t.toLowerCase())&&(e[t]=r[t]),e),{...i}),c=Object.values(t).reduce((e,t)=>(e[t.address]={address:t.address,name:t.metadata.name,lastSelected:t.metadata.lastSelected},e),{});this.update(e=>{e.identities=c,e.lostIdentities=o,e.selectedAddress=(null==s?void 0:s.address)||""})}n.PreferencesController=p}}},{package:"$root$",file:"app/scripts/controllers/preferences-controller.ts"}],[2430,{buffer:4084,util:4036},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){i(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function i(e,t,n){return(t=o(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,o(s.key),s)}}function o(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(n!==undefined){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var c=e("buffer").Buffer,l=e("util").inspect,u=l&&l.custom||"inspect";function d(e,t,n){c.prototype.copy.call(e,t,n)}t.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,n,s;return t=e,(n=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n}},{key:"concat",value:function(e){if(0===this.length)return c.alloc(0);for(var t=c.allocUnsafe(e>>>0),n=this.head,s=0;n;)d(n.data,t,s),s+=n.data.length,n=n.next;return t}},{key:"consume",value:function(e,t){var n;return e<this.head.data.length?(n=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):n=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),n}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,n=1,s=t.data;for(e-=s.length;t=t.next;){var r=t.data,i=e>r.length?r.length:e;if(i===r.length?s+=r:s+=r.slice(0,e),0===(e-=i)){i===r.length?(++n,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=r.slice(i));break}++n}return this.length-=n,s}},{key:"_getBuffer",value:function(e){var t=c.allocUnsafe(e),n=this.head,s=1;for(n.data.copy(t),e-=n.data.length;n=n.next;){var r=n.data,i=e>r.length?r.length:e;if(r.copy(t,t.length-e,0,i),0===(e-=i)){i===r.length?(++s,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=r.slice(i));break}++s}return this.length-=s,t}},{key:u,value:function(e,t){return l(this,r(r({},t),{},{depth:0,customInspect:!1}))}}])&&a(t.prototype,n),s&&a(t,s),Object.defineProperty(t,"prototype",{writable:!1}),e}()}}},{package:"@metamask/obs-store>readable-stream",file:"node_modules/@metamask/obs-store/node_modules/readable-stream/lib/internal/streams/buffer_list.js"}],[2431,{_process:5089},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(e){(function(){function n(e,t){r(e,t),s(e)}function s(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function r(e,t){e.emit("error",t)}t.exports={destroy:function(t,i){var a=this,o=this._readableState&&this._readableState.destroyed,c=this._writableState&&this._writableState.destroyed;return o||c?(i?i(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,e.nextTick(r,this,t)):e.nextTick(r,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!i&&t?a._writableState?a._writableState.errorEmitted?e.nextTick(s,a):(a._writableState.errorEmitted=!0,e.nextTick(n,a,t)):e.nextTick(n,a,t):i?(e.nextTick(s,a),i(t)):e.nextTick(s,a)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var n=e._readableState,s=e._writableState;n&&n.autoDestroy||s&&s.autoDestroy?e.destroy(t):e.emit("error",t)}}}).call(this)}).call(this,e("_process"))}}},{package:"@metamask/obs-store>readable-stream",file:"node_modules/@metamask/obs-store/node_modules/readable-stream/lib/internal/streams/destroy.js"}],[2432,{"../../../errors":2423},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=e("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function r(){}t.exports=function e(t,n,i){if("function"==typeof n)return e(t,null,n);n||(n={}),i=function(e){var t=!1;return function(){if(!t){t=!0;for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];e.apply(this,s)}}}(i||r);var a=n.readable||!1!==n.readable&&t.readable,o=n.writable||!1!==n.writable&&t.writable,c=function(){t.writable||u()},l=t._writableState&&t._writableState.finished,u=function(){o=!1,l=!0,a||i.call(t)},d=t._readableState&&t._readableState.endEmitted,h=function(){a=!1,d=!0,o||i.call(t)},p=function(e){i.call(t,e)},f=function(){var e;return a&&!d?(t._readableState&&t._readableState.ended||(e=new s),i.call(t,e)):o&&!l?(t._writableState&&t._writableState.ended||(e=new s),i.call(t,e)):void 0},m=function(){t.req.on("finish",u)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(t)?o&&!t._writableState&&(t.on("end",c),t.on("close",c)):(t.on("complete",u),t.on("abort",f),t.req?m():t.on("request",m)),t.on("end",h),t.on("finish",u),!1!==n.error&&t.on("error",p),t.on("close",f),function(){t.removeListener("complete",u),t.removeListener("abort",f),t.removeListener("request",m),t.req&&t.req.removeListener("finish",u),t.removeListener("end",c),t.removeListener("close",c),t.removeListener("finish",u),t.removeListener("end",h),t.removeListener("error",p),t.removeListener("close",f)}}}}},{package:"@metamask/obs-store>readable-stream",file:"node_modules/@metamask/obs-store/node_modules/readable-stream/lib/internal/streams/end-of-stream.js"}],[2433,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=function(){throw new Error("Readable.from is not available in the browser")}}}},{package:"@metamask/obs-store>readable-stream",file:"node_modules/@metamask/obs-store/node_modules/readable-stream/lib/internal/streams/from-browser.js"}],[2434,{"../../../errors":2423,"./end-of-stream":2432},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s;var r=e("../../../errors").codes,i=r.ERR_MISSING_ARGS,a=r.ERR_STREAM_DESTROYED;function o(e){if(e)throw e}function c(e){e()}function l(e,t){return e.pipe(t)}t.exports=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var u,d=function(e){return e.length?"function"!=typeof e[e.length-1]?o:e.pop():o}(n);if(Array.isArray(n[0])&&(n=n[0]),n.length<2)throw new i("streams");var h=n.map(function(t,r){var i=r<n.length-1;return function(t,n,r,i){i=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(i);var o=!1;t.on("close",function(){o=!0}),s===undefined&&(s=e("./end-of-stream")),s(t,{readable:n,writable:r},function(e){if(e)return i(e);o=!0,i()});var c=!1;return function(e){if(!o&&!c)return c=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(t)?t.abort():"function"==typeof t.destroy?t.destroy():void i(e||new a("pipe"))}}(t,i,r>0,function(e){u||(u=e),e&&h.forEach(c),i||(h.forEach(c),d(u))})});return n.reduce(l)}}}},{package:"@metamask/obs-store>readable-stream",file:"node_modules/@metamask/obs-store/node_modules/readable-stream/lib/internal/streams/pipeline.js"}],[2435,{"../../../errors":2423},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=e("../../../errors").codes.ERR_INVALID_OPT_VALUE;t.exports={getHighWaterMark:function(e,t,n,r){var i=function(e,t,n){return null!=e.highWaterMark?e.highWaterMark:t?e[n]:null}(t,r,n);if(null!=i){if(!isFinite(i)||Math.floor(i)!==i||i<0)throw new s(r?n:"highWaterMark",i);return Math.floor(i)}return e.objectMode?16:16384}}}}},{package:"@metamask/obs-store>readable-stream",file:"node_modules/@metamask/obs-store/node_modules/readable-stream/lib/internal/streams/state.js"}],[2436,{events:4384},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports=e("events").EventEmitter}}},{package:"@metamask/obs-store>readable-stream",file:"node_modules/@metamask/obs-store/node_modules/readable-stream/lib/internal/streams/stream-browser.js"}],[2437,{"./lib/_stream_duplex.js":2424,"./lib/_stream_passthrough.js":2425,"./lib/_stream_readable.js":2426,"./lib/_stream_transform.js":2427,"./lib/_stream_writable.js":2428,"./lib/internal/streams/end-of-stream.js":2432,"./lib/internal/streams/pipeline.js":2434},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(n=t.exports=e("./lib/_stream_readable.js")).Stream=n,n.Readable=n,n.Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js"),n.finished=e("./lib/internal/streams/end-of-stream.js"),n.pipeline=e("./lib/internal/streams/pipeline.js")}}},{package:"@metamask/obs-store>readable-stream",file:"node_modules/@metamask/obs-store/node_modules/readable-stream/readable-browser.js"}],[244,{"webextension-polyfill":5763},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getNotificationImage=async function(){return await r.default.runtime.getURL("../../images/icon-64.png")};var s,r=(s=e("webextension-polyfill"))&&s.__esModule?s:{default:s}}}},{package:"$root$",file:"app/scripts/controllers/push-notifications/get-notification-image.ts"}],[245,{"../../../../shared/lib/translate":5902,"@metamask/notification-services-controller":2393},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createNotificationMessage=function(e){return s.NotificationServicesPushController.Utils.createOnChainPushNotificationMessage(e,a)};var s=e("@metamask/notification-services-controller"),r=e("../../../../shared/lib/translate");const i=(...e)=>(0,r.t)(...e)??"",a={...{pushPlatformNotificationsFundsSentTitle:()=>i("pushPlatformNotificationsFundsSentTitle"),pushPlatformNotificationsFundsSentDescriptionDefault:()=>i("pushPlatformNotificationsFundsSentDescriptionDefault"),pushPlatformNotificationsFundsSentDescription:(e,t)=>i("pushPlatformNotificationsFundsSentDescription",e,t),pushPlatformNotificationsFundsReceivedTitle:()=>i("pushPlatformNotificationsFundsReceivedTitle"),pushPlatformNotificationsFundsReceivedDescriptionDefault:()=>i("pushPlatformNotificationsFundsReceivedDescriptionDefault"),pushPlatformNotificationsFundsReceivedDescription:(e,t)=>i("pushPlatformNotificationsFundsReceivedDescription",e,t),pushPlatformNotificationsSwapCompletedTitle:()=>i("pushPlatformNotificationsSwapCompletedTitle"),pushPlatformNotificationsSwapCompletedDescription:()=>i("pushPlatformNotificationsSwapCompletedDescription"),pushPlatformNotificationsNftSentTitle:()=>i("pushPlatformNotificationsNftSentTitle"),pushPlatformNotificationsNftSentDescription:()=>i("pushPlatformNotificationsNftSentDescription"),pushPlatformNotificationsNftReceivedTitle:()=>i("pushPlatformNotificationsNftReceivedTitle"),pushPlatformNotificationsNftReceivedDescription:()=>i("pushPlatformNotificationsNftReceivedDescription"),pushPlatformNotificationsStakingRocketpoolStakeCompletedTitle:()=>i("pushPlatformNotificationsStakingRocketpoolStakeCompletedTitle"),pushPlatformNotificationsStakingRocketpoolStakeCompletedDescription:()=>i("pushPlatformNotificationsStakingRocketpoolStakeCompletedDescription"),pushPlatformNotificationsStakingRocketpoolUnstakeCompletedTitle:()=>i("pushPlatformNotificationsStakingRocketpoolUnstakeCompletedTitle"),pushPlatformNotificationsStakingRocketpoolUnstakeCompletedDescription:()=>i("pushPlatformNotificationsStakingRocketpoolUnstakeCompletedDescription"),pushPlatformNotificationsStakingLidoStakeCompletedTitle:()=>i("pushPlatformNotificationsStakingLidoStakeCompletedTitle"),pushPlatformNotificationsStakingLidoStakeCompletedDescription:()=>i("pushPlatformNotificationsStakingLidoStakeCompletedDescription"),pushPlatformNotificationsStakingLidoStakeReadyToBeWithdrawnTitle:()=>i("pushPlatformNotificationsStakingLidoStakeReadyToBeWithdrawnTitle"),pushPlatformNotificationsStakingLidoStakeReadyToBeWithdrawnDescription:()=>i("pushPlatformNotificationsStakingLidoStakeReadyToBeWithdrawnDescription"),pushPlatformNotificationsStakingLidoWithdrawalRequestedTitle:()=>i("pushPlatformNotificationsStakingLidoWithdrawalRequestedTitle"),pushPlatformNotificationsStakingLidoWithdrawalRequestedDescription:()=>i("pushPlatformNotificationsStakingLidoWithdrawalRequestedDescription"),pushPlatformNotificationsStakingLidoWithdrawalCompletedTitle:()=>i("pushPlatformNotificationsStakingLidoWithdrawalCompletedTitle"),pushPlatformNotificationsStakingLidoWithdrawalCompletedDescription:()=>i("pushPlatformNotificationsStakingLidoWithdrawalCompletedDescription")},...{PositionLiquidatedTitle:()=>i("pushNotificationPositionLiquidatedTitle"),PositionLiquidatedDescriptionLong:e=>i("pushNotificationPositionLiquidatedDescriptionLong",e),PositionLiquidatedDescriptionShort:e=>i("pushNotificationPositionLiquidatedDescriptionShort",e),StopLossTriggeredTitle:()=>i("pushNotificationStopLossTriggeredTitle"),StopLossTriggeredDescriptionLong:e=>i("pushNotificationStopLossTriggeredDescriptionLong",e),StopLossTriggeredDescriptionShort:e=>i("pushNotificationStopLossTriggeredDescriptionShort",e),TakeProfitTriggeredTitle:()=>i("pushNotificationTakeProfitTriggeredTitle"),TakeProfitTriggeredDescriptionLong:e=>i("pushNotificationTakeProfitTriggeredDescriptionLong",e),TakeProfitTriggeredDescriptionShort:e=>i("pushNotificationTakeProfitTriggeredDescriptionShort",e),LimitOrderFilledTitle:()=>i("pushNotificationLimitOrderFilledTitle"),LimitOrderFilledDescriptionLong:e=>i("pushNotificationLimitOrderFilledDescriptionLong",e),LimitOrderFilledDescriptionShort:e=>i("pushNotificationLimitOrderFilledDescriptionShort",e)},...{ShieldSubscriptionTitle:()=>i("pushNotificationShieldSubscriptionTitle"),ShieldSubscriptionCreatedDescriptionShort:()=>i("pushNotificationShieldSubscriptionCreatedDescriptionShort"),ShieldSubscriptionPaymentFailedDescriptionShort:()=>i("pushNotificationShieldSubscriptionPaymentFailedDescriptionShort"),ShieldSubscriptionUpdatePaymentCta:()=>i("pushNotificationShieldUpdatePaymentCta"),ShieldSubscriptionLearnMoreCta:()=>i("pushNotificationShieldLearnMoreCta"),ShieldClaimCreatedTitle:()=>i("pushNotificationShieldClaimCreatedTitle"),ShieldClaimCreatedDescriptionShort:()=>i("pushNotificationShieldClaimCreatedDescriptionShort"),ShieldClaimStatusUpdatedTitle:()=>i("pushNotificationShieldClaimStatusUpdatedTitle"),ShieldClaimStatusUpdatedDescriptionShort:()=>i("pushNotificationShieldClaimStatusUpdatedDescriptionShort")}}}}},{package:"$root$",file:"app/scripts/controllers/push-notifications/get-notification-message.ts"}],[2450,{"./enums.cjs":2451,"@metamask/base-controller":1362,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,i,a,o,c,l,u,d,h=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},p=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.PermissionLogController=void 0;const f=e("@metamask/base-controller"),m=e("@metamask/utils"),g=e("./enums.cjs"),w={permissionHistory:{},permissionActivityLog:[]};class b extends f.BaseController{constructor({messenger:e,restrictedMethods:t,state:n}){super({messenger:e,name:"PermissionLogController",metadata:{permissionHistory:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},permissionActivityLog:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!1}},state:{...w,...n}}),s.add(this),r.set(this,void 0),h(this,r,t,"f")}updateAccountsHistory(e,t){if(0===t.length)return;const n={eth_accounts:{accounts:p(this,s,"m",i).call(this,t,Date.now())}};p(this,s,"m",l).call(this,e,n)}createMiddleware(){return(e,t,n)=>{const{origin:i,method:l}=e,d=l.startsWith(g.WALLET_PREFIX),h="eth_requestAccounts"===l;if(!g.LOG_IGNORE_METHODS.includes(l)&&(d||p(this,r,"f").has(l))||h){const r=p(this,s,"m",a).call(this,e,d),l=p(this,s,"m",u).call(this,e);return void n(e=>{const n=Date.now();p(this,s,"m",o).call(this,r,t,n),l&&!t.error&&t.result&&i&&p(this,s,"m",c).call(this,l,i,t.result,n,h),e()})}n()}}}n.PermissionLogController=b,r=new WeakMap,s=new WeakSet,i=function(e,t){return e.reduce((e,n)=>({...e,[n]:t}),{})},a=function(e,t){const n={id:e.id,method:e.method,methodType:t?g.LOG_METHOD_TYPES.internal:g.LOG_METHOD_TYPES.restricted,origin:e.origin,requestTime:Date.now(),responseTime:null,success:null};return this.update(e=>{const t=[...e.permissionActivityLog,n];e.permissionActivityLog=t.length>g.LOG_LIMIT?t.slice(1):t}),n},o=function(e,t,n){e&&t&&this.update(s=>{s.permissionActivityLog=s.permissionActivityLog.map(s=>s.id===e.id?{...s,success:(0,m.hasProperty)(t,"result"),responseTime:n}:s)})},c=function(e,t,n,r,a){let o;if(a){const e=n;o={eth_accounts:{accounts:p(this,s,"m",i).call(this,e,r),lastApproved:r}}}else{o=n.reduce((t,n)=>{const a=n.parentCapability;if(!e.includes(a))return t;if("eth_accounts"===a){const e=p(this,s,"m",d).call(this,n);return{...t,[a]:{lastApproved:r,accounts:p(this,s,"m",i).call(this,e,r)}}}return{...t,[a]:{lastApproved:r}}},{})}Object.keys(o).length>0&&p(this,s,"m",l).call(this,t,o)},l=function(e,t){const{permissionHistory:n}=this.state,s=n[e]??{},r={...s,...t},i=s.eth_accounts,a=t.eth_accounts;if(i&&a){const e=a.lastApproved??i.lastApproved;r.eth_accounts={lastApproved:e,accounts:{...i.accounts,...a.accounts}}}this.update(t=>{t.permissionHistory={...n,[e]:r}})},u=function(e){const{method:t,params:n}=e;return"eth_requestAccounts"===t?["eth_accounts"]:t===`${g.WALLET_PREFIX}requestPermissions`&&n&&Array.isArray(n)&&n[0]&&"object"==typeof n[0]&&!Array.isArray(n[0])?Object.keys(n[0]):null},d=function(e){if("eth_accounts"!==e.parentCapability||!e.caveats)return[];const t=new Set;for(const n of e.caveats)if(n.type===g.CAVEAT_TYPES.restrictReturnedAccounts&&Array.isArray(n.value))for(const e of n.value)t.add(e);return[...t]}}}},{package:"@metamask/permission-log-controller",file:"node_modules/@metamask/permission-log-controller/dist/PermissionLogController.cjs"}],[2451,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s;Object.defineProperty(n,"__esModule",{value:!0}),n.LOG_LIMIT=n.LOG_METHOD_TYPES=n.LOG_IGNORE_METHODS=n.CAVEAT_TYPES=n.WALLET_PREFIX=void 0,n.WALLET_PREFIX="wallet_",n.CAVEAT_TYPES=Object.freeze({restrictReturnedAccounts:"restrictReturnedAccounts"}),n.LOG_IGNORE_METHODS=["wallet_registerOnboarding","wallet_watchAsset"],function(e){e.restricted="restricted",e.internal="internal"}(s||(n.LOG_METHOD_TYPES=s={})),n.LOG_LIMIT=100}}},{package:"@metamask/permission-log-controller",file:"node_modules/@metamask/permission-log-controller/dist/enums.cjs"}],[2452,{"./PermissionLogController.cjs":2450},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.PermissionLogController=void 0;var s=e("./PermissionLogController.cjs");Object.defineProperty(n,"PermissionLogController",{enumerable:!0,get:function(){return s.PermissionLogController}})}}},{package:"@metamask/permission-log-controller",file:"node_modules/@metamask/permission-log-controller/dist/index.cjs"}],[246,{"../../platforms/extension":595,"./get-notification-image":244,"./get-notification-message":245},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.onPushNotificationClicked=async function(e,t){var n;e.notification.close();const s=t??(null==e||null===(n=e.notification)||void 0===n?void 0:n.data),r=`${c.getExtensionURL(null,null)}#notifications/${s.id}`;e.waitUntil(o.clients.openWindow(r))},n.onPushNotificationReceived=async function(e){const t=(0,a.createNotificationMessage)(e);if(!t)return;const n=null==o?void 0:o.registration;if(!n)return;const s=await(0,i.getNotificationImage)();await n.showNotification(t.title,{body:t.description,icon:s,tag:null==e?void 0:e.id,data:e})};var s,r=(s=e("../../platforms/extension"))&&s.__esModule?s:{default:s},i=e("./get-notification-image"),a=e("./get-notification-message");const o=self,c=new r.default}}},{package:"$root$",file:"app/scripts/controllers/push-notifications/index.ts"}],[247,{"../../../../shared/lib/accounts":5819,"./rewards-data-service":248,"./utils/solana-snap":249,"./utils/sortAccounts":250,"@metamask/base-controller":1362,"@metamask/utils":3116,"@solana/addresses":3197,buffer:4084,"ethers/lib/utils":4380,loglevel:4846},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){Object.defineProperty(n,"__esModule",{value:!0}),n.getRewardsControllerDefaultState=n.defaultRewardsControllerState=n.RewardsController=n.DEFAULT_BLOCKED_REGIONS=void 0,n.wrapWithCache=E;var s,r=e("@metamask/base-controller"),i=(s=e("loglevel"))&&s.__esModule?s:{default:s},a=e("@solana/addresses"),o=e("@metamask/utils"),c=e("ethers/lib/utils"),l=e("../../../../shared/lib/accounts"),u=e("./rewards-data-service"),d=e("./utils/solana-snap"),h=e("./utils/sortAccounts");function p(e,t,n){f(e,t),t.set(e,n)}function f(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function m(e,t){return e.get(w(e,t))}function g(e,t,n){return e.set(w(e,t),n),n}function w(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}const b=n.DEFAULT_BLOCKED_REGIONS=["UK"],v=36e5,S={rewardsActiveAccount:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},rewardsAccounts:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},rewardsSubscriptions:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},rewardsSeasons:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},rewardsSeasonStatuses:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},rewardsSubscriptionTokens:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1},rewardsEnabled:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0}},y=()=>({rewardsActiveAccount:null,rewardsAccounts:{},rewardsSubscriptions:{},rewardsSeasons:{},rewardsSeasonStatuses:{},rewardsSubscriptionTokens:{}});n.getRewardsControllerDefaultState=y;const k=n.defaultRewardsControllerState={rewardsActiveAccount:null,rewardsAccounts:{},rewardsSubscriptions:{},rewardsSeasons:{},rewardsSeasonStatuses:{},rewardsSubscriptionTokens:{}},T=new Date("2025-10-27T00:00:00.000Z");async function E({key:e,ttl:t,readCache:n,fetchFresh:s,writeCache:r,swrCallback:a}){try{const o=n(e);if(o){if(!(!o.lastFetched||Date.now()-o.lastFetched>t))return o.payload;if(a)return(async()=>{try{const t=await s();r(e,t),a(o.payload,t)}catch(e){i.default.error("SWR revalidation failed:",e instanceof Error?e.message:String(e))}})(),o.payload}}catch(e){i.default.error("RewardsController: wrapWithCache cache read failed, fetching fresh",e instanceof Error?e.message:String(e))}const o=await s();try{r(e,o)}catch(e){i.default.error("RewardsController: wrapWithCache writeCache failed",e instanceof Error?e.message:String(e))}return o}var I=new WeakMap,M=new WeakMap,_=new WeakSet;class C extends r.BaseController{calculateTierStatus(e,t,n){const s=[...e].sort((e,t)=>e.pointsNeeded-t.pointsNeeded),r=s.find(e=>e.id===t);if(!r)throw new Error(`Current tier ${t} not found in season tiers`);const i=s.findIndex(e=>e.id===t),a=i<s.length-1?s[i+1]:null;return{currentTier:r,nextTier:a,nextTierPointsNeeded:a?Math.max(0,a.pointsNeeded-n):null}}convertToSeasonStatusDto(e,t){return{season:{id:e.id,name:e.name,startDate:new Date(e.startDate),endDate:new Date(e.endDate),tiers:e.tiers},balance:{total:t.balance,updatedAt:t.updatedAt},currentTierId:t.currentTierId}}constructor({messenger:e,state:t,isDisabled:n}){super({name:"RewardsController",metadata:S,messenger:e,state:{...k,...t}}),function(e,t){f(e,t),t.add(e)}(this,_),p(this,I,null),p(this,M,void 0),w(_,this,O).call(this),w(_,this,j).call(this),g(M,this,n)}resetState(){this.update(()=>({rewardsActiveAccount:null,rewardsAccounts:{},rewardsSubscriptions:{},rewardsSeasons:{},rewardsSeasonStatuses:{},rewardsSubscriptionTokens:{}}))}getActualSubscriptionId(e){const t=w(_,this,R).call(this,e);return(null==t?void 0:t.subscriptionId)||null}async handleAuthenticationTrigger(e){if(this.isRewardsFeatureEnabled())try{const e=this.messenger.call("AccountTreeController:getAccountsFromSelectedAccountGroup");if(e&&0!==e.length){const t=(0,h.sortAccounts)(e);try{await this.getOptInStatus({addresses:t.map(e=>e.address)})}catch{}let n=null;for(const e of t)try{await this.performSilentAuth(e,!1,!0)&&!n&&(n=e)}catch{}const s=n||t[0];if(s){const e=this.convertInternalAccountToCaipAccountId(s);if(e){const t=w(_,this,R).call(this,e);t&&this.update(e=>{e.rewardsActiveAccount=t})}}}else await this.performSilentAuth(null,!0,!0)}catch{}else await this.performSilentAuth(null,!0,!0)}shouldSkipSilentAuth(e,t){if(!this.isOptInSupported(t))return!0;const n=w(_,this,R).call(this,e);return!!n&&(!1===n.hasOptedIn?!!n.lastFreshOptInStatusCheck&&Date.now()-n.lastFreshOptInStatusCheck<=v:Boolean(n.subscriptionId)&&Boolean(w(_,this,L).call(this,n.subscriptionId)))}isOptInSupported(e){try{return!(0,l.isHardwareAccount)(e)&&(!!(0,c.isAddress)(e.address)||!!(0,a.isAddress)(e.address))}catch(e){return i.default.error("RewardsController: Exception checking opt-in support, assuming not supported:",e),!1}}convertInternalAccountToCaipAccountId(e){try{const[t]=e.scopes,{namespace:n,reference:s}=(0,o.parseCaipChainId)(t);return(0,o.toCaipAccountId)(n,s,e.address)}catch(e){return i.default.error("RewardsController: Failed to convert address to CAIP-10 format:",e),null}}async performSilentAuth(e,t=!0,n=!0){var s;if(!e)return t&&this.update(e=>{e.rewardsActiveAccount=null}),null;const r=this.convertInternalAccountToCaipAccountId(e),a=!!r&&this.shouldSkipSilentAuth(r,e);if(a&&n){var o;let e=w(_,this,R).call(this,r);return e?this.update(n=>{t&&(n.rewardsActiveAccount=e)}):(e={account:r,hasOptedIn:!1,subscriptionId:null,perpsFeeDiscount:null,lastPerpsDiscountRateFetched:null},this.update(n=>{n.rewardsAccounts[r]=e,t&&(n.rewardsActiveAccount=e)})),(null===(o=e)||void 0===o?void 0:o.subscriptionId)||null}let c=null,l=!1;if(n&&!a)try{const n=await this.getOptInStatus({addresses:[e.address]});if(n.ois&&!1===n.ois[0])return c=null,this.update(e=>{if(!r)return;const n={account:r,hasOptedIn:!1,subscriptionId:null,perpsFeeDiscount:null,lastPerpsDiscountRateFetched:null,lastFreshOptInStatusCheck:Date.now()};e.rewardsAccounts[r]=n,t&&(e.rewardsActiveAccount=n)}),null}catch{}try{let t,n=Math.floor(Date.now()/1e3),s=0;const r=1;try{t=await w(_,this,D).call(this,e,n)}catch(e){if(i.default.error("RewardsController: Failed to generate signature:",e),e&&"object"==typeof e&&"message"in e){if(e.message.includes("controller is locked"))return null}throw e}const a=async(i,o)=>{try{return await this.messenger.call("RewardsDataService:login",{account:e.address,timestamp:i,signature:o})}catch(i){if(i instanceof u.InvalidTimestampError&&s<r)return s+=1,n=i.timestamp,t=await w(_,this,D).call(this,e,n),await a(n,t);throw i}},o=await a(n,t);c=o.subscription,w(_,this,F).call(this,c.id,o.sessionId)}catch(e){e instanceof Error&&e.message.includes("401")?i.default.error("RewardsController: Account not opt-in",r):(c=null,l=!0)}finally{this.update(e=>{var n;if(!r)return;const s={account:r,hasOptedIn:l?undefined:Boolean(c),subscriptionId:(null===(n=c)||void 0===n?void 0:n.id)||null,perpsFeeDiscount:null,lastPerpsDiscountRateFetched:null};if(e.rewardsAccounts[r]=s,t&&(e.rewardsActiveAccount=s),c){var i;if(null===(i=e.rewardsSubscriptions[c.id])||void 0===i||!i.candidateAt){const t=Object.keys(e.rewardsSubscriptions??{}).length>0?new Date:T;c.candidateAt=t.toISOString()}e.rewardsSubscriptions[c.id]=c}})}return(null===(s=c)||void 0===s?void 0:s.id)||null}async getHasAccountOptedIn(e){var t;return!!this.isRewardsFeatureEnabled()&&((null===(t=w(_,this,R).call(this,e))||void 0===t?void 0:t.hasOptedIn)??!1)}checkOptInStatusAgainstCache(e,t){const n=new Array(e.length).fill(null),s=new Array(e.length).fill(null),r=[];for(let i=0;i<e.length;i++){const a=e[i],o=t.get(a.toLowerCase());if(o){const e=this.convertInternalAccountToCaipAccountId(o);if(e){const t=w(_,this,R).call(this,e);if((null==t?void 0:t.hasOptedIn)!==undefined){const e=!t.lastFreshOptInStatusCheck||Date.now()-t.lastFreshOptInStatusCheck>v;if(!1===t.hasOptedIn&&e){r.push(a);continue}n[i]=t.hasOptedIn,s[i]=t.subscriptionId||null;continue}}}r.push(a)}return{cachedOptInResults:n,cachedSubscriptionIds:s,addressesNeedingFresh:r}}async getOptInStatus(e){if(!this.isRewardsFeatureEnabled())return{ois:e.addresses.map(()=>!1),sids:e.addresses.map(()=>null)};try{const t=this.messenger.call("AccountsController:listMultichainAccounts"),n=new Map;for(const e of t)n.set(e.address.toLowerCase(),e);const{cachedOptInResults:s,cachedSubscriptionIds:r,addressesNeedingFresh:i}=this.checkOptInStatusAgainstCache(e.addresses,n);let a=[],o=[];if(i.length>0){const e=await this.messenger.call("RewardsDataService:getOptInStatus",{addresses:i});a=e.ois,o=e.sids;for(let e=0;e<i.length;e++){const t=i[e],s=a[e],r=Array.isArray(o)&&e<o.length?o[e]:null,c=n.get(t.toLowerCase());if(c){const e=this.convertInternalAccountToCaipAccountId(c);if(e){const t=Date.now();this.update(n=>{var i;n.rewardsAccounts[e]?(n.rewardsAccounts[e].hasOptedIn=s,n.rewardsAccounts[e].subscriptionId=r,n.rewardsAccounts[e].lastFreshOptInStatusCheck=t):n.rewardsAccounts[e]={account:e,hasOptedIn:s,subscriptionId:r,perpsFeeDiscount:null,lastPerpsDiscountRateFetched:null,lastFreshOptInStatusCheck:t},(null===(i=n.rewardsActiveAccount)||void 0===i?void 0:i.account)===e&&(n.rewardsActiveAccount.hasOptedIn=s,n.rewardsActiveAccount.subscriptionId=r,n.rewardsActiveAccount.lastFreshOptInStatusCheck=t)})}}}}const c=[],l=[];let u=0;for(let t=0;t<e.addresses.length;t++)null===s[t]?(c[t]=a[u],l[t]=o[u],u+=1):(c[t]=s[t],l[t]=r[t]);return{ois:c,sids:l}}catch(e){throw i.default.error("RewardsController: Failed to get opt-in status:",e instanceof Error?e.message:String(e)),e}}async estimatePoints(e){if(!this.isRewardsFeatureEnabled())return{pointsEstimate:0,bonusBips:0};try{return await this.messenger.call("RewardsDataService:estimatePoints",e)}catch(e){throw i.default.error("RewardsController: Failed to estimate points:",e instanceof Error?e.message:String(e)),e}}isRewardsFeatureEnabled(){return!m(M,this).call(this)}async getSeasonMetadata(e="current"){return await E({key:e,ttl:6e5,readCache:e=>{const t=this.state.rewardsSeasons[e]||undefined;return t?{payload:t,lastFetched:t.lastFetched}:undefined},fetchFresh:async()=>{var t;const n=await this.messenger.call("RewardsDataService:getDiscoverSeasons");let s=null;if("current"===e?s=n.current:"next"===e&&(s=n.next),null!==(t=s)&&void 0!==t&&t.startDate){const e=await this.messenger.call("RewardsDataService:getSeasonMetadata",s.id);return{...w(_,this,A).call(this,{id:e.id,name:e.name,startDate:e.startDate,endDate:e.endDate,tiers:e.tiers}),lastFetched:Date.now()}}throw new Error(`No valid season metadata could be found for type: ${e}`)},writeCache:(e,t)=>{this.update(n=>{n.rewardsSeasons[e]=t,n.rewardsSeasons[t.id]=t})}})}async getSeasonStatus(e,t){if(!this.isRewardsFeatureEnabled())return null;const n=this.state.rewardsSeasons[t];if(!n)throw new Error(`Failed to get season status: season not found for seasonId: ${t}`);return await E({key:w(_,this,N).call(this,t,e),ttl:6e4,readCache:e=>{const t=this.state.rewardsSeasonStatuses[e]||undefined;return t?{payload:t,lastFetched:t.lastFetched}:undefined},fetchFresh:async()=>{try{const s=w(_,this,L).call(this,e);if(!s)throw new u.AuthorizationFailedError(`No subscription token found for subscription ID: ${e}`);const r=await this.messenger.call("RewardsDataService:getSeasonStatus",t,s),i=this.convertToSeasonStatusDto(n,r);return w(_,this,P).call(this,i)}catch(t){if(t instanceof u.AuthorizationFailedError)try{var s;if((null===(s=this.state.rewardsActiveAccount)||void 0===s?void 0:s.subscriptionId)===e){const e=await this.messenger.call("AccountsController:getSelectedMultichainAccount");await this.performSilentAuth(e,!1,!1)}else if(this.state.rewardsAccounts&&Object.values(this.state.rewardsAccounts).length>0){const t=Object.values(this.state.rewardsAccounts).find(t=>t.subscriptionId===e);if(t){const e=await this.messenger.call("AccountsController:listMultichainAccounts"),{convertInternalAccountToCaipAccountId:n}=this,s=e.find(e=>n(e)===t.account);s&&await this.performSilentAuth(s,!1,!1)}}const t=w(_,this,L).call(this,e);if(!t)throw new Error(`No subscription token found for subscription ID: ${e}`);const r=await this.messenger.call("RewardsDataService:getSeasonStatus",n.id,t),i=this.convertToSeasonStatusDto(n,r);return w(_,this,P).call(this,i)}catch{throw i.default.error("RewardsController: Failed to reauth with a valid account after 403 error",t instanceof Error?t.message:String(t)),this.invalidateSubscriptionCache(e),this.invalidateAccountsAndSubscriptions(),t}else if(t instanceof u.SeasonNotFoundError)throw this.update(e=>{e.rewardsSeasons={}}),t;throw i.default.error("RewardsController: Failed to get season status:",t instanceof Error?t.message:String(t)),t}},writeCache:(e,t)=>{this.update(n=>{n.rewardsSeasonStatuses[e]=t})}})}invalidateAccountsAndSubscriptions(){this.update(e=>{e.rewardsActiveAccount&&(e.rewardsActiveAccount={...e.rewardsActiveAccount,hasOptedIn:!1,subscriptionId:null,lastFreshOptInStatusCheck:null,account:e.rewardsActiveAccount.account}),e.rewardsAccounts={},e.rewardsSubscriptions={},e.rewardsSubscriptionTokens={}})}async optIn(e,t){var n;if(!this.isRewardsFeatureEnabled())return null;if(!e||0===e.length)return null;const s=(0,h.sortAccounts)(e);let r=null,i=null;for(const e of s){try{i=await w(_,this,U).call(this,e,t)}catch{}if(i){r=e;break}}if(!r||!i)throw new Error("Failed to opt in any account from the account group");const a=s.filter(e=>{var t;return e.address!==(null===(t=r)||void 0===t?void 0:t.address)});return a.length>0&&await this.linkAccountsToSubscriptionCandidate(a),(null===(n=i)||void 0===n?void 0:n.subscription.id)||null}async getRewardsGeoMetadata(){if(!this.isRewardsFeatureEnabled())return{geoLocation:"UNKNOWN",optinAllowedForGeo:!1};if(m(I,this))return m(I,this);try{const e=await this.messenger.call("RewardsDataService:fetchGeoLocation"),t=!b.some(t=>e.startsWith(t)),n={geoLocation:e,optinAllowedForGeo:t};return g(I,this,n),n}catch(e){return{geoLocation:"UNKNOWN",optinAllowedForGeo:!0}}}async validateReferralCode(e){if(!this.isRewardsFeatureEnabled())return!1;if(!e.trim())return!1;if(6!==e.length)return!1;return(await this.messenger.call("RewardsDataService:validateReferralCode",e)).valid}async getCandidateSubscriptionId(){var e;if(!this.isRewardsFeatureEnabled())return null;if(null!==(e=this.state.rewardsActiveAccount)&&void 0!==e&&e.subscriptionId)return this.state.rewardsActiveAccount.subscriptionId;const t=Object.keys(this.state.rewardsSubscriptions);if(1===t.length)return t[0];if(t.length>1){const e=Object.values(this.state.rewardsSubscriptions).sort((e,t)=>{try{const n=(null==e?void 0:e.candidateAt)||(null==e?void 0:e.createdAt),s=(null==t?void 0:t.candidateAt)||(null==t?void 0:t.createdAt);return new Date(n).getTime()-new Date(s).getTime()}catch{return 0}});return e.length>0?e[0].id:t[0]}try{var n;const e=this.messenger.call("AccountsController:listMultichainAccounts"),t=(null==e?void 0:e.filter(e=>this.isOptInSupported(e)))||[];if(!t||0===t.length)return null;const s=t.map(e=>e.address),r=await this.getOptInStatus({addresses:s});if(null==r||null===(n=r.ois)||void 0===n||!n.filter(e=>e).length)return null;const a=Math.min(10,r.ois.length);let o=0;for(let e=0;e<t.length&&!(o>a);e++){const n=t[e];if(!n||!1===r.ois[e])continue;let s=Array.isArray(null==r?void 0:r.sids)&&e<r.sids.length?r.sids[e]:null;const a=s?this.state.rewardsSubscriptionTokens[s]:undefined;if(s&&Boolean(a)&&this.state.rewardsSubscriptions[s])return s;try{if(o+=1,s=await this.performSilentAuth(n,!1,!1),s)return s}catch(e){i.default.error("RewardsController: Silent auth failed for account during candidate search:",n.address,e instanceof Error?e.message:String(e))}}}catch(e){i.default.error("RewardsController: Failed to get candidate subscription ID:",e instanceof Error?e.message:String(e))}throw new Error("No candidate subscription ID found after all silent auth attempts. There is an opted in account but we cannot use it to fetch the season status.")}async linkAccountToSubscriptionCandidate(e,t=!0){if(!this.isRewardsFeatureEnabled())return!1;const n=this.convertInternalAccountToCaipAccountId(e);if(!n)throw new Error("Failed to convert account to CAIP-10 format");const s=w(_,this,R).call(this,n);if(null!=s&&s.subscriptionId){if(this.state.rewardsSubscriptions[s.subscriptionId])return!0}const r=await this.getCandidateSubscriptionId();if(!r)throw new Error("No valid subscription found to link account to");if(!this.isOptInSupported(e))return!1;try{let s=Math.floor(Date.now()/1e3),i=await w(_,this,D).call(this,e,s),a=0;const o=1,c=async(t,n)=>{try{const s=w(_,this,L).call(this,r);if(!s)throw new Error(`No subscription token found for subscription ID: ${r}`);return await this.messenger.call("RewardsDataService:mobileJoin",{account:e.address,timestamp:t,signature:n},s)}catch(t){if(t instanceof u.InvalidTimestampError&&a<o)return a+=1,s=t.timestamp,i=await w(_,this,D).call(this,e,s),await c(s,i);if(t instanceof u.AccountAlreadyRegisteredError){const t=await this.performSilentAuth(e,!1,!1);if(t&&this.state.rewardsSubscriptions[t])return this.state.rewardsSubscriptions[t]}throw t}},l=await c(s,i);return this.update(e=>{var t;e.rewardsAccounts[n]={account:n,hasOptedIn:!0,subscriptionId:l.id,perpsFeeDiscount:null,lastPerpsDiscountRateFetched:null},(null===(t=e.rewardsActiveAccount)||void 0===t?void 0:t.account)===n&&(e.rewardsActiveAccount=e.rewardsAccounts[n])}),t&&(this.invalidateSubscriptionCache(l.id),this.messenger.publish("RewardsController:accountLinked",{subscriptionId:l.id,account:n})),!0}catch(e){return i.default.error("RewardsController: Failed to link account to subscription",n,r,e),!1}}async linkAccountsToSubscriptionCandidate(e){var t;if(!this.isRewardsFeatureEnabled())return e.map(e=>({account:e,success:!1}));if(0===e.length)return[];let n=null;const s=[];for(const t of e)try{const e=this.convertInternalAccountToCaipAccountId(t),r=w(_,this,R).call(this,e);if(null!=r&&r.subscriptionId)continue;const i=await this.linkAccountToSubscriptionCandidate(t,!1);if(i){const r=w(_,this,R).call(this,e);r&&(n=r),s.push({account:t,success:i})}else s.push({account:t,success:!1})}catch{s.push({account:t,success:!1})}return null!==(t=n)&&void 0!==t&&t.subscriptionId&&(this.invalidateSubscriptionCache(n.subscriptionId),this.messenger.publish("RewardsController:accountLinked",{subscriptionId:n.subscriptionId,account:n.account})),s}invalidateSubscriptionCache(e,t){if(t){const n=w(_,this,N).call(this,t,e);this.update(e=>{delete e.rewardsSeasonStatuses[n]})}else this.update(t=>{Object.keys(t.rewardsSeasonStatuses).forEach(n=>{n.includes(e)&&delete t.rewardsSeasonStatuses[n]})})}}function A(e){return{id:e.id,name:e.name,startDate:e.startDate.getTime(),endDate:e.endDate.getTime(),tiers:e.tiers}}function P(e){var t;const n=this.calculateTierStatus(e.season.tiers,e.currentTierId,e.balance.total);return{season:w(_,this,A).call(this,e.season),balance:{total:e.balance.total,updatedAt:null===(t=e.balance.updatedAt)||void 0===t?void 0:t.getTime()},tier:n,lastFetched:Date.now()}}function O(){this.messenger.registerActionHandler("RewardsController:getHasAccountOptedIn",this.getHasAccountOptedIn.bind(this)),this.messenger.registerActionHandler("RewardsController:estimatePoints",this.estimatePoints.bind(this)),this.messenger.registerActionHandler("RewardsController:isRewardsFeatureEnabled",this.isRewardsFeatureEnabled.bind(this)),this.messenger.registerActionHandler("RewardsController:getSeasonMetadata",this.getSeasonMetadata.bind(this)),this.messenger.registerActionHandler("RewardsController:getSeasonStatus",this.getSeasonStatus.bind(this)),this.messenger.registerActionHandler("RewardsController:optIn",this.optIn.bind(this)),this.messenger.registerActionHandler("RewardsController:getGeoRewardsMetadata",this.getRewardsGeoMetadata.bind(this)),this.messenger.registerActionHandler("RewardsController:validateReferralCode",this.validateReferralCode.bind(this)),this.messenger.registerActionHandler("RewardsController:linkAccountToSubscriptionCandidate",this.linkAccountToSubscriptionCandidate.bind(this)),this.messenger.registerActionHandler("RewardsController:linkAccountsToSubscriptionCandidate",this.linkAccountsToSubscriptionCandidate.bind(this)),this.messenger.registerActionHandler("RewardsController:getCandidateSubscriptionId",this.getCandidateSubscriptionId.bind(this)),this.messenger.registerActionHandler("RewardsController:getOptInStatus",this.getOptInStatus.bind(this)),this.messenger.registerActionHandler("RewardsController:isOptInSupported",this.isOptInSupported.bind(this)),this.messenger.registerActionHandler("RewardsController:getActualSubscriptionId",this.getActualSubscriptionId.bind(this))}function j(){this.messenger.subscribe("AccountTreeController:selectedAccountGroupChange",()=>this.handleAuthenticationTrigger("Account Group changed")),this.messenger.subscribe("KeyringController:unlock",()=>this.handleAuthenticationTrigger("KeyringController unlocked"))}function R(e){let t=null;var n;null!=e&&e.startsWith("eip155")&&(t=this.state.rewardsAccounts[`eip155:0:${null===(n=e.split(":")[2])||void 0===n?void 0:n.toLowerCase()}`]||this.state.rewardsAccounts[`eip155:0:${e.split(":")[2]}`]);return t||(t=this.state.rewardsAccounts[e]),t||null}function N(e,t){return`${e}:${t}`}async function D(e,n){const s=`rewards,${e.address},${n}`;if((0,a.isAddress)(e.address)){const n=await(0,d.signSolanaRewardsMessage)(this.messenger.call.bind(this.messenger,"SnapController:handleRequest"),e.id,t.from(s,"utf8").toString("base64"));return`0x${t.from(c.base58.decode(n.signature)).toString("hex")}`}if((0,c.isAddress)(e.address)){return await w(_,this,x).call(this,e,s)}throw new Error("Unsupported account type for signing rewards message")}async function x(e,n){const s=`0x${t.from(n,"utf8").toString("hex")}`;return await this.messenger.call("KeyringController:signPersonalMessage",{data:s,from:e.address})}function F(e,t){this.update(n=>{n.rewardsSubscriptionTokens[e]=t})}function L(e){return this.state.rewardsSubscriptionTokens[e]}async function U(e,t){var n;if(!this.isRewardsFeatureEnabled())return null;let s=Math.floor(Date.now()/1e3),r=await w(_,this,D).call(this,e,s),i=0;const a=async(n,o)=>{try{return await this.messenger.call("RewardsDataService:mobileOptin",{account:e.address,timestamp:n,signature:o,referralCode:t})}catch(t){if(t instanceof u.InvalidTimestampError&&i<1)return i+=1,s=t.timestamp,r=await w(_,this,D).call(this,e,s),await a(s,r);if(t instanceof u.AccountAlreadyRegisteredError){const t=await this.performSilentAuth(e,!1,!1);if(t&&this.state.rewardsSubscriptions[t]){const e=this.state.rewardsSubscriptions[t],n=w(_,this,L).call(this,t);if(n)return{sessionId:n,subscription:e}}}throw t}},o=await a(s,r);return null!==(n=o.subscription)&&void 0!==n&&n.id&&o.sessionId&&w(_,this,F).call(this,o.subscription.id,o.sessionId),this.update(t=>{var n,s;const r=this.convertInternalAccountToCaipAccountId(e);if(!r)return;const i={account:r,hasOptedIn:!0,subscriptionId:o.subscription.id,perpsFeeDiscount:null,lastPerpsDiscountRateFetched:null};if(t.rewardsActiveAccount&&t.rewardsActiveAccount.account===r&&(t.rewardsActiveAccount=i),t.rewardsAccounts[r]=i,null!=o&&null!==(n=o.subscription)&&void 0!==n&&n.id&&(null===(s=t.rewardsSubscriptions[o.subscription.id])||void 0===s||!s.candidateAt)){const e=Object.keys(t.rewardsSubscriptions??{}).length>0?new Date:T;o.subscription.candidateAt=e.toISOString()}t.rewardsSubscriptions[o.subscription.id]=o.subscription}),{subscription:o.subscription,sessionId:o.sessionId}}n.RewardsController=C}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"$root$",file:"app/scripts/controllers/rewards/rewards-controller.ts"}],[248,{"../../../../development/build/constants":610,"../../../../shared/constants/rewards":5802,"../../../../shared/modules/i18n":5923,"../../platforms/extension":595,loglevel:4846},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getNormalisedLocale=n.SeasonNotFoundError=n.RewardsDataService=n.InvalidTimestampError=n.AuthorizationFailedError=n.AccountAlreadyRegisteredError=void 0;var s=c(e("loglevel")),r=e("../../../../development/build/constants"),i=c(e("../../platforms/extension")),a=e("../../../../shared/constants/rewards"),o=e("../../../../shared/modules/i18n");function c(e){return e&&e.__esModule?e:{default:e}}function l(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function u(e,t){return e.get(h(e,t))}function d(e,t,n){return e.set(h(e,t),n),n}function h(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function p(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class f extends Error{constructor(e,t){super(e),p(this,"timestamp",void 0),this.name="InvalidTimestampError",this.timestamp=t}}n.InvalidTimestampError=f;class m extends Error{constructor(e=m.defaultMessage){super(e),this.name="AuthorizationFailedError"}}n.AuthorizationFailedError=m,p(m,"defaultMessage",a.REWARDS_ERROR_MESSAGES.AUTHORIZATION_FAILED);class g extends Error{constructor(e=g.defaultMessage){super(e),this.name="SeasonNotFoundError"}}n.SeasonNotFoundError=g,p(g,"defaultMessage",a.REWARDS_ERROR_MESSAGES.SEASON_NOT_FOUND);class w extends Error{constructor(e){super(e),this.name="AccountAlreadyRegisteredError"}}n.AccountAlreadyRegisteredError=w;const b="RewardsDataService",v="https://on-ramp.api.cx.metamask.io/geolocation",S=e=>Intl.getCanonicalLocales(e?e.replace(/_/gu,"-"):o.FALLBACK_LOCALE)[0];n.getNormalisedLocale=S;var y=new WeakMap,k=new WeakMap,T=new WeakMap;n.RewardsDataService=class{constructor({messenger:e,fetch:t}){p(this,"name",b),l(this,y,void 0),l(this,k,void 0),l(this,T,void 0),d(y,this,e),d(k,this,t),d(T,this,this.getRewardsApiBaseUrl()),u(y,this).registerActionHandler(`${b}:login`,this.login.bind(this)),u(y,this).registerActionHandler(`${b}:estimatePoints`,this.estimatePoints.bind(this)),u(y,this).registerActionHandler(`${b}:mobileOptin`,this.mobileOptin.bind(this)),u(y,this).registerActionHandler(`${b}:getSeasonStatus`,this.getSeasonStatus.bind(this)),u(y,this).registerActionHandler(`${b}:fetchGeoLocation`,this.fetchGeoLocation.bind(this)),u(y,this).registerActionHandler(`${b}:validateReferralCode`,this.validateReferralCode.bind(this)),u(y,this).registerActionHandler(`${b}:mobileJoin`,this.mobileJoin.bind(this)),u(y,this).registerActionHandler(`${b}:getOptInStatus`,this.getOptInStatus.bind(this)),u(y,this).registerActionHandler(`${b}:getSeasonMetadata`,this.getSeasonMetadata.bind(this)),u(y,this).registerActionHandler(`${b}:getDiscoverSeasons`,this.getDiscoverSeasons.bind(this))}getRewardsApiBaseUrl(){return"production"===r.ENVIRONMENT.PRODUCTION||"production"===r.ENVIRONMENT.RELEASE_CANDIDATE?a.REWARDS_API_URL.PRD:a.REWARDS_API_URL.UAT}getLocale(){try{const e=u(y,this).call("PreferencesController:getState"),t=(null==e?void 0:e.currentLocale)||"en-US";return/^[a-z]{2}[-_][a-z]{2}$/iu.test(t)?t:S(t)}catch(e){s.default.warn("Failed to get locale from PreferencesController:",e);try{const e=u(y,this).call("PreferencesController:getState");return(null==e?void 0:e.currentLocale)||"en-US"}catch{return"en-US"}}}async makeRequest(e,t={},n,s=1e4){const r={"Content-Type":"application/json"};try{const e=(new i.default).getVersion();r["rewards-client-id"]=`extension-${e}`}catch(e){console.warn("Failed to retrieve app version for client header:",e)}n&&(r["rewards-access-token"]=n);const a=this.getLocale();a&&(r["Accept-Language"]=a);const o=`${u(T,this)}${e}`,c=new AbortController,l=setTimeout(()=>{c.abort()},s);try{const e=await u(k,this).call(this,o,{credentials:"omit",...t,headers:{...r,...t.headers},signal:c.signal});return clearTimeout(l),e}catch(e){if(clearTimeout(l),e instanceof Error&&"AbortError"===e.name)throw new Error(`Request timeout after ${s}ms`);throw e}}checkForAccountAlreadyRegisteredError(e,t){var n;if(409===e.status&&null!=t&&null!==(n=t.message)&&void 0!==n&&n.toLowerCase().includes("already registered"))throw new w(t.message||"Account is already registered")}async login(e){const t=await this.makeRequest("/auth/mobile-login",{method:"POST",body:JSON.stringify(e)});if(!t.ok){var n;const e=await t.json();if(null!=e&&null!==(n=e.message)&&void 0!==n&&n.includes("Invalid timestamp"))throw new f("Invalid timestamp. Please try again with a new timestamp.",Math.floor(Number(e.serverTimestamp)/1e3));throw this.checkForAccountAlreadyRegisteredError(t,e),new Error(`Login failed: ${t.status}`)}return await t.json()}async estimatePoints(e){const t=await this.makeRequest("/points-estimation",{method:"POST",body:JSON.stringify(e)});if(!t.ok)throw new Error(`Points estimation failed: ${t.status}`);return await t.json()}async mobileOptin(e){const t=await this.makeRequest("/auth/mobile-optin",{method:"POST",body:JSON.stringify(e)});if(!t.ok){var n;const e=await t.json();if(s.default.error("RewardsDataService: mobileOptin errorData",e),null!=e&&null!==(n=e.message)&&void 0!==n&&n.includes("Invalid timestamp"))throw new f("Invalid timestamp. Please try again with a new timestamp.",Math.floor(Number(e.serverTimestamp)/1e3));throw this.checkForAccountAlreadyRegisteredError(t,e),new Error(`Optin failed: ${t.status}`)}return await t.json()}async getSeasonStatus(e,t){const n=await this.makeRequest(`/seasons/${e}/state`,{method:"GET"},t);if(!n.ok){var s,r;const e=await n.json();if(null!=e&&null!==(s=e.message)&&void 0!==s&&s.includes("Rewards authorization failed"))throw new m;if(null!=e&&null!==(r=e.message)&&void 0!==r&&r.includes("Season not found"))throw new g;throw new Error(`Get season state failed: ${n.status}`)}const i=await n.json();return i.updatedAt&&(i.updatedAt=new Date(i.updatedAt)),i}async fetchGeoLocation(){let e="UNKNOWN";try{const t=await u(k,this).call(this,v);return t.ok?(e=await(null==t?void 0:t.text()),e):e}catch(t){return console.error("RewardsDataService: Failed to fetch geolocation",t),e}}async validateReferralCode(e){const t=await this.makeRequest(`/referral/validate?code=${encodeURIComponent(e)}`,{method:"GET"});if(!t.ok)throw new Error("Failed to validate referral code. Please try again shortly.");return await t.json()}async mobileJoin(e,t){const n=await this.makeRequest("/wr/subscriptions/mobile-join",{method:"POST",body:JSON.stringify(e)},t);if(!n.ok){var r;const e=await n.json();if(s.default.error("RewardsDataService: mobileJoin errorData",e),null!=e&&null!==(r=e.message)&&void 0!==r&&r.includes("Invalid timestamp"))throw new f("Invalid timestamp. Please try again with a new timestamp.",Math.floor(Number(e.serverTimestamp)/1e3));throw this.checkForAccountAlreadyRegisteredError(n,e),new Error(`Mobile join failed: ${n.status} ${(null==e?void 0:e.message)||""}`)}return await n.json()}async getOptInStatus(e){if(!e.addresses||0===e.addresses.length)throw new Error("Addresses are required");if(e.addresses.length>500)throw new Error("Addresses must be less than 500");const t=await this.makeRequest("/public/rewards/ois",{method:"POST",body:JSON.stringify(e)});if(!t.ok)throw new Error(`Get opt-in status failed: ${t.status}`);return await t.json()}async getDiscoverSeasons(){const e=await this.makeRequest("/public/seasons/status",{method:"GET"});if(!e.ok)throw new Error(`Get discover seasons failed: ${e.status}`);const t=await e.json();return t.current&&(t.current.startDate&&(t.current.startDate=new Date(t.current.startDate)),t.current.endDate&&(t.current.endDate=new Date(t.current.endDate))),t.next&&(t.next.startDate&&(t.next.startDate=new Date(t.next.startDate)),t.next.endDate&&(t.next.endDate=new Date(t.next.endDate))),t}async getSeasonMetadata(e){const t=await this.makeRequest(`/public/seasons/${e}/meta`,{method:"GET"});if(!t.ok)throw new Error(`Get season metadata failed: ${t.status}`);const n=await t.json();return n.startDate&&(n.startDate=new Date(n.startDate)),n.endDate&&(n.endDate=new Date(n.endDate)),n}}}}},{package:"$root$",file:"app/scripts/controllers/rewards/rewards-data-service.ts"}],[2486,{"./ppom-controller":2487},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.PPOMController=n.NETWORK_CACHE_DURATION=void 0;var s=e("./ppom-controller");Object.defineProperty(n,"NETWORK_CACHE_DURATION",{enumerable:!0,get:function(){return s.NETWORK_CACHE_DURATION}}),Object.defineProperty(n,"PPOMController",{enumerable:!0,get:function(){return s.PPOMController}})}}},{package:"@metamask/ppom-validator",file:"node_modules/@metamask/ppom-validator/dist/index.js"}],[2487,{"./ppom-storage":2488,"./util":2489,"@metamask/base-controller":1362,"@metamask/controller-utils":1449,"await-semaphore":3910},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,i,a,o,c,l,u,d,h,p,f,m,g,w,b,v,S,y,k,T,E,I,M,_,C,A,P,O,j,R,N,D=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},x=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.PPOMController=n.NETWORK_CACHE_DURATION=void 0;const F=e("@metamask/base-controller"),L=e("@metamask/controller-utils"),U=e("await-semaphore"),B=e("./ppom-storage"),W=e("./util");n.NETWORK_CACHE_DURATION=6048e5;const $=["eth_call","eth_blockNumber","eth_createAccessList","eth_getLogs","eth_getFilterLogs","eth_getTransactionByHash","eth_chainId","eth_getBlockByHash","eth_getBlockByNumber","eth_getCode","eth_getStorageAt","eth_getBalance","eth_getTransactionCount","trace_call","trace_callMany","debug_traceCall","trace_filter"],H={versionInfo:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1},storageMetadata:{includeInStateLogs:!1,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1}},q="PPOMController",K={headers:{"Content-Type":"application/json"}};class G extends F.BaseController{constructor({chainId:e,messenger:t,provider:n,storageBackend:b,securityAlertsEnabled:v,onPreferencesChange:S,ppomProvider:E,cdnBaseUrl:I,providerRequestLimit:M,state:_,blockaidPublicKey:C,nativeCrypto:A}){super({name:q,metadata:H,messenger:t,state:{versionInfo:_?.versionInfo??[],storageMetadata:_?.storageMetadata??[]}}),s.add(this),r.set(this,void 0),i.set(this,void 0),a.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),d.set(this,0),h.set(this,void 0),p.set(this,void 0),f.set(this,{}),m.set(this,void 0),g.set(this,!1),w.set(this,undefined),D(this,h,(0,W.addHexPrefix)(e),"f"),D(this,i,n,"f"),D(this,c,E,"f"),D(this,a,new B.PPOMStorage({storageBackend:b,readMetadata:()=>[...this.state.storageMetadata],writeMetadata:e=>{this.update(t=>{t.storageMetadata=e})}}),"f"),D(this,o,new U.Mutex,"f"),D(this,l,I,"f"),D(this,u,M??300,"f"),D(this,p,v,"f"),D(this,m,C,"f"),D(this,w,A,"f"),S(x(this,s,"m",y).bind(this)),x(this,s,"m",k).call(this),x(this,s,"m",T).call(this)}async usePPOM(e,t){const n=t??x(this,h,"f");if(!x(this,p,"f"))throw Error("User has securityAlertsEnabled set to false");if(!(0,W.blockaidValidationSupportedForNetwork)(n))throw Error(`Blockaid validation not available on network with chainId: ${n}`);return await x(this,o,"f").use(async()=>{const t=await x(this,s,"m",I).call(this,n);D(this,d,0,"f"),D(this,f,{},"f");return{...await e(t),providerRequestsCount:{...x(this,f,"f")}}})}}n.PPOMController=G,r=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakMap,w=new WeakMap,s=new WeakSet,b=async function(){if(x(this,p,"f")&&!x(this,g,"f")){const{ppomInit:e}=x(this,c,"f");await e("./ppom_bg.wasm"),D(this,g,!0,"f")}},v=function(){x(this,s,"m",E).call(this).catch(e=>{console.error(`Error in resetting ppom: ${e.message}`)});const{storageMetadata:e}=this.state;this.update(e=>{e.versionInfo=[],e.storageMetadata=[]}),x(this,a,"f").deleteAllFiles(e).catch(e=>{console.error(`Error in deleting files: ${e.message}`)})},S=function(e){const t=this.messenger.call("NetworkController:getNetworkClientById",e.selectedNetworkClientId),{chainId:n}=t.configuration,r=(0,W.addHexPrefix)(n);r!==x(this,h,"f")&&(D(this,h,r,"f"),x(this,s,"m",E).call(this).catch(e=>{console.error(`Error in resetting ppom: ${e.message}`)}))},y=function(e){const t=e.securityAlertsEnabled;t!==x(this,p,"f")&&(D(this,p,t,"f"),t||x(this,s,"m",v).call(this))},k=function(){this.messenger.registerActionHandler(`${q}:usePPOM`,this.usePPOM.bind(this))},T=function(){const e=x(this,s,"m",S).bind(this);this.messenger.subscribe("NetworkController:networkDidChange",e)},E=async function(){await x(this,o,"f").use(async()=>{x(this,r,"f")&&(x(this,r,"f").free(),D(this,r,undefined,"f"))})},I=async function(e){const t=await x(this,s,"m",M).call(this);let n;return(x(this,r,"f")===undefined||t)&&(n=await x(this,s,"m",N).call(this,e),x(this,h,"f")===e&&(x(this,r,"f")&&x(this,r,"f").free(),D(this,r,n,"f")),x(this,a,"f").syncMetadata(this.state.versionInfo).catch(e=>{console.error(`Error while trying to sync metadata: ${e.message}`)})),n},M=async function(){const e=await x(this,s,"m",O).call(this);return!!e&&(this.update(t=>{t.versionInfo=e}),!0)},_=function(e,t){return e.find(e=>e.name===t.name&&e.chainId===t.chainId&&e.version===t.version&&e.checksum===t.checksum)},C=async function(e){const t=await Promise.all(e.map(async e=>{let t;try{t=await x(this,s,"m",A).call(this,e)}catch(t){console.error(`Error in getting file ${e.filePath}: ${t.message}`)}return t?[e.name,new Uint8Array(t)]:undefined}));return t?.filter(e=>e?.[1]!==undefined)},A=async function(e){const{storageMetadata:t}=this.state;if(x(this,s,"m",_).call(this,t,e))try{return await x(this,a,"f").readFile(e.name,e.chainId)}catch(e){console.error(`Error in reading file: ${e.message}`)}(0,W.checkFilePath)(e.filePath);const n=(0,W.constructURLHref)(x(this,l,"f"),e.filePath),r=await x(this,s,"m",j).call(this,n);return await(0,W.validateSignature)(r,e.hashSignature,x(this,m,"f"),e.filePath,x(this,w,"f")),await x(this,a,"f").writeFile({data:r,...e}).catch(e=>{console.error(`Error in writing file: ${e.message}`)}),r},P=async function(e,t={},n="GET"){const s=await(0,L.safelyExecute)(async()=>(0,L.timeoutFetch)(e,{method:n,cache:"no-cache",redirect:"error",...t},1e4),!0),r=304===s?.status;if(!s?.status||s?.status<200||s?.status>399)throw new Error(`Failed to fetch file with url: ${e}`);return{cached:r,response:s}},O=async function(){const e=(0,W.constructURLHref)(x(this,l,"f"),"ppom_version.json"),{cached:t,response:n}=await x(this,s,"m",P).call(this,e,{headers:K});return t&&this.state.versionInfo?.length?undefined:n.json()},j=async function(e){const{response:t}=await x(this,s,"m",P).call(this,e);return await t.arrayBuffer()},R=async function(e,t){if(x(this,d,"f")>x(this,u,"f"))return W.PROVIDER_ERRORS.limitExceeded();if(D(this,d,x(this,d,"f")+1,"f"),!$.includes(e))return W.PROVIDER_ERRORS.methodNotSupported();x(this,f,"f")[e]=x(this,f,"f")[e]?Number(x(this,f,"f")[e])+1:1;const n=(0,W.createPayload)(e,t);try{const e=await x(this,i,"f").request(n);return{jsonrpc:"2.0",id:n.id,result:e}}catch(e){return{jsonrpc:"2.0",id:n.id,error:e}}},N=async function(e){await x(this,s,"m",b).call(this);const t=this.state.versionInfo.filter(({chainId:t})=>t===e);if(t?.length===undefined||0===t?.length)throw new Error(`Aborting initialising PPOM as no files are found for the network with chainId: ${e}`);const n=await x(this,s,"m",C).call(this,t);if(n?.length!==t?.length)throw new Error(`Aborting initialising PPOM as not all files could not be downloaded for the network with chainId: ${e}`);const{PPOM:r}=x(this,c,"f");return r.new(x(this,s,"m",R).bind(this),n)}}}},{package:"@metamask/ppom-validator",file:"node_modules/@metamask/ppom-validator/dist/ppom-controller.js"}],[2488,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,i,a=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},o=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.PPOMStorage=void 0;n.PPOMStorage=class{constructor({storageBackend:e,readMetadata:t,writeMetadata:n}){s.set(this,void 0),r.set(this,void 0),i.set(this,void 0),a(this,s,e,"f"),a(this,r,t,"f"),a(this,i,n,"f")}async syncMetadata(e){const t=o(this,r,"f").call(this),n=[];for(const s of t){try{await this.readFile(s.name,s.chainId)}catch(e){console.error("Error: ",e);continue}e.find(e=>e.name===s.name&&e.chainId===s.chainId&&e.version===s.version&&e.checksum===s.checksum)&&n.push(s)}const a=await o(this,s,"f").dir();for(const{name:e,chainId:t}of a)n.find(n=>n.name===e&&n.chainId===t)||await o(this,s,"f").delete({name:e,chainId:t});return o(this,i,"f").call(this,n),n}async deleteAllFiles(e){for(const t of e){const{name:e,chainId:n}=t;try{await o(this,s,"f").delete({name:e,chainId:n})}catch(t){console.error(`Error in deleting file: ${e}, ${n}`,t)}}}async readFile(e,t){const n=o(this,r,"f").call(this).find(n=>n.name===e&&n.chainId===t);if(!n)throw new Error(`File metadata (${e}, ${t}) not found`);const i=await o(this,s,"f").read({name:e,chainId:t},n.checksum);if(!i)throw new Error(`Storage File (${e}, ${t}) not found`);return i}async writeFile({data:e,name:t,chainId:n,version:a,checksum:c}){await o(this,s,"f").write({name:t,chainId:n},e,c);const l=o(this,r,"f").call(this),u=l.find(e=>e.name===t&&e.chainId===n);u?(u.version=a,u.checksum=c):l.push({name:t,chainId:n,version:a,checksum:c}),o(this,i,"f").call(this,l)}},s=new WeakMap,r=new WeakMap,i=new WeakMap}}},{package:"@metamask/ppom-validator",file:"node_modules/@metamask/ppom-validator/dist/ppom-storage.js"}],[2489,{buffer:4084,"crypto-js":4201,elliptic:4257,"json-rpc-random-id":4654},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return r(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.checkFilePath=n.addHexPrefix=n.constructURLHref=n.validateSignature=n.PROVIDER_ERRORS=n.createPayload=n.IdGenerator=n.blockaidValidationSupportedForNetwork=n.SUPPORTED_NETWORK_CHAINIDS=void 0;const o=i(e("crypto-js")),c=a(e("elliptic")),l=a(e("json-rpc-random-id")),u=c.default.eddsa;n.SUPPORTED_NETWORK_CHAINIDS={MAINNET:"0x1",BSC:"0x38",OPTIMISM:"0xa",POLYGON:"0x89",AVALANCHE:"0xa86a",ARBITRUM:"0xa4b1",LINEA_MAINNET:"0xe708",BASE:"0x2105",SEPOLIA:"0xaa36a7",OPBNB:"0xcc",ZKSYNC:"0x144",SCROLL:"0x82750",BERACHAIN:"0x138d4",METACHAIN_ONE:"0x1b6e6"};n.blockaidValidationSupportedForNetwork=e=>Object.values(n.SUPPORTED_NETWORK_CHAINIDS).some(t=>t===e),n.IdGenerator=(0,l.default)();n.createPayload=(e,t)=>({id:(0,n.IdGenerator)(),jsonrpc:"2.0",method:e,params:t??[]}),n.PROVIDER_ERRORS={limitExceeded:()=>({jsonrpc:"2.0",id:(0,n.IdGenerator)(),error:{code:-32005,message:"Limit exceeded"}}),methodNotSupported:()=>({jsonrpc:"2.0",id:(0,n.IdGenerator)(),error:{code:-32601,message:"Method not supported"}})};n.validateSignature=async(e,n,s,r,i,a)=>{const c=await(async(e,t,n=!0)=>{if(t)return t.createHash("sha256").update(e).digest("hex");if("crypto"in globalThis&&"object"==typeof globalThis.crypto&&globalThis.crypto.subtle?.digest&&n){const t=await globalThis.crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(e=>e.toString(16).padStart(2,"0")).join("")}return(0,o.SHA256)(o.default.lib.WordArray.create(e)).toString()})(e,i,a);if(!new u("ed25519").keyFromPublic(s).verify(t.from(c),n))throw Error(`Signature verification failed for file path: ${r}`)};n.constructURLHref=(e,t)=>new URL(`https://${e}/${t}`.replace(/https:\/\/https:\/\//gu,"https://").replace(/\/\//gu,"/")).href;n.addHexPrefix=e=>"string"!=typeof e||e.match(/^-?0x/u)?e:e.match(/^-?0X/u)?e.replace("0X","0x"):`0x${parseInt(e,10).toString(16)}`;n.checkFilePath=e=>{if(!e.match(/^[\w./]+$/u))throw new Error(`Invalid file path for data file: ${e}`)}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/ppom-validator",file:"node_modules/@metamask/ppom-validator/dist/util.js"}],[249,{"../../../../../shared/lib/accounts":5819,"@metamask/snaps-utils":2903,loglevel:4846},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.signSolanaRewardsMessage=async function(e,t,n){try{return await e({origin:"metamask",snapId:a.SOLANA_WALLET_SNAP_ID,handler:r.HandlerType.OnClientRequest,request:{jsonrpc:"2.0",id:Date.now(),method:"signRewardsMessage",params:{accountId:t,message:n}}})}catch(e){throw i.default.error("Error signing Solana rewards message:",e),e}};var s,r=e("@metamask/snaps-utils"),i=(s=e("loglevel"))&&s.__esModule?s:{default:s},a=e("../../../../../shared/lib/accounts")}}},{package:"$root$",file:"app/scripts/controllers/rewards/utils/solana-snap.ts"}],[2490,{"@metamask/polling-controller":2463,"@metamask/utils":3116,"async-mutex":3906},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,i,a,o,c,l,u,d,h,p=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},f=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.ProfileMetricsController=n.getDefaultProfileMetricsControllerState=n.DEFAULT_INITIAL_DELAY_DURATION=n.controllerName=void 0;const m=e("@metamask/polling-controller"),g=e("@metamask/utils"),w=e("async-mutex");n.controllerName="ProfileMetricsController",n.DEFAULT_INITIAL_DELAY_DURATION=(0,g.inMilliseconds)(10,g.Duration.Minute);const b={initialEnqueueCompleted:{persist:!0,includeInDebugSnapshot:!0,includeInStateLogs:!0,usedInUi:!1},syncQueue:{persist:!0,includeInDebugSnapshot:!1,includeInStateLogs:!0,usedInUi:!1},initialDelayEndTimestamp:{persist:!0,includeInDebugSnapshot:!0,includeInStateLogs:!0,usedInUi:!1}};function v(){return{initialEnqueueCompleted:!1,syncQueue:{}}}n.getDefaultProfileMetricsControllerState=v;const S=["skipInitialDelay"];class y extends((0,m.StaticIntervalPollingController)()){constructor({messenger:e,state:t,assertUserOptedIn:l,getMetaMetricsId:u,interval:m=1e4,initialDelayDuration:g=n.DEFAULT_INITIAL_DELAY_DURATION}){super({messenger:e,metadata:b,name:n.controllerName,state:{initialEnqueueCompleted:!1,syncQueue:{},...t}}),s.add(this),r.set(this,new w.Mutex),i.set(this,void 0),a.set(this,void 0),o.set(this,void 0),p(this,i,l,"f"),p(this,a,u,"f"),p(this,o,g,"f"),this.messenger.registerMethodActionHandlers(this,S),this.messenger.subscribe("KeyringController:unlock",()=>{f(this,i,"f").call(this)&&this.skipInitialDelay(),f(this,s,"m",c).call(this).catch(this.messenger.captureException??console.error),this.startPolling(null)}),this.messenger.subscribe("KeyringController:lock",()=>this.stopAllPolling()),this.messenger.subscribe("TransactionController:transactionSubmitted",()=>this.skipInitialDelay()),this.messenger.subscribe("AccountsController:accountAdded",e=>{f(this,s,"m",d).call(this,e).catch(console.error)}),this.messenger.subscribe("AccountsController:accountRemoved",e=>{f(this,s,"m",h).call(this,e).catch(console.error)}),this.setIntervalLength(m)}skipInitialDelay(){this.update(e=>{e.initialDelayEndTimestamp=Date.now()})}async _executePoll(){await f(this,r,"f").runExclusive(async()=>{if(f(this,i,"f").call(this)&&(f(this,s,"m",l).call(this),f(this,s,"m",u).call(this)))for(const[e,t]of Object.entries(this.state.syncQueue))try{await this.messenger.call("ProfileMetricsService:submitMetrics",{metametricsId:f(this,a,"f").call(this),entropySourceId:"null"===e?null:e,accounts:t}),this.update(t=>{delete t.syncQueue[e]})}catch(t){console.error(`Failed to submit profile metrics for entropy source ID ${e}:`,t)}})}}function k(e){return"mnemonic"===e.options.entropy?.type?e.options.entropy.id:null}n.ProfileMetricsController=y,r=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,s=new WeakSet,c=async function(){await f(this,r,"f").runExclusive(async()=>{if(this.state.initialEnqueueCompleted)return;const e=Object.values(this.messenger.call("AccountsController:getState").internalAccounts.accounts).reduce((e,t)=>{const n=k(t)??"null";return e[n]||(e[n]=[]),e[n].push({address:t.address,scopes:t.scopes}),e},{});this.update(t=>{for(const n of Object.keys(e))t.syncQueue[n]||(t.syncQueue[n]=[]),t.syncQueue[n].push(...e[n]);t.initialEnqueueCompleted=!0})})},l=function(){this.update(e=>{e.initialDelayEndTimestamp??(e.initialDelayEndTimestamp=Date.now()+f(this,o,"f"))})},u=function(){return this.state.initialDelayEndTimestamp!==undefined&&Date.now()>=this.state.initialDelayEndTimestamp},d=async function(e){await f(this,r,"f").runExclusive(async()=>{this.update(t=>{const n=k(e)??"null";t.syncQueue[n]||(t.syncQueue[n]=[]),t.syncQueue[n].push({address:e.address,scopes:e.scopes})})})},h=async function(e){await f(this,r,"f").runExclusive(async()=>{this.update(t=>{for(const[n,s]of Object.entries(t.syncQueue)){const r=s.findIndex(({address:t})=>t===e);if(-1!==r){s.splice(r,1),0===s.length&&delete t.syncQueue[n];break}}})})}}}},{package:"@metamask/profile-metrics-controller",file:"node_modules/@metamask/profile-metrics-controller/dist/ProfileMetricsController.cjs"}],[2491,{"@metamask/controller-utils":1449,"@metamask/profile-sync-controller":2509},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,i,a,o=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},c=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.getAuthUrl=n.ProfileMetricsService=n.serviceName=void 0;const l=e("@metamask/controller-utils"),u=e("@metamask/profile-sync-controller");n.serviceName="ProfileMetricsService";const d=["submitMetrics"];class h{constructor({messenger:e,fetch:t,policyOptions:h={},env:f=u.SDK.Env.DEV}){s.set(this,void 0),r.set(this,void 0),i.set(this,void 0),a.set(this,void 0),this.name=n.serviceName,o(this,s,e,"f"),o(this,r,t,"f"),o(this,i,(0,l.createServicePolicy)(h),"f"),o(this,a,p(f),"f"),c(this,s,"f").registerMethodActionHandlers(this,d)}onRetry(e){return c(this,i,"f").onRetry(e)}onBreak(e){return c(this,i,"f").onBreak(e)}onDegraded(e){return c(this,i,"f").onDegraded(e)}async submitMetrics(e){const t=await c(this,s,"f").call("AuthenticationController:getBearerToken",e.entropySourceId??undefined);await c(this,i,"f").execute(async()=>{const n=new URL(`${c(this,a,"f")}/profile/accounts`),s=await c(this,r,"f").call(this,n,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({metametrics_id:e.metametricsId,accounts:e.accounts})});if(!s.ok)throw new l.HttpError(s.status,`Fetching '${n.toString()}' failed with status '${s.status}'`);return s})}}function p(e){return`${u.SDK.getEnvUrls(e).authApiUrl}/api/v2`}n.ProfileMetricsService=h,s=new WeakMap,r=new WeakMap,i=new WeakMap,a=new WeakMap,n.getAuthUrl=p}}},{package:"@metamask/profile-metrics-controller",file:"node_modules/@metamask/profile-metrics-controller/dist/ProfileMetricsService.cjs"}],[2492,{"./ProfileMetricsController.cjs":2490,"./ProfileMetricsService.cjs":2491},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.serviceName=n.ProfileMetricsService=n.getDefaultProfileMetricsControllerState=n.ProfileMetricsController=void 0;var s=e("./ProfileMetricsController.cjs");Object.defineProperty(n,"ProfileMetricsController",{enumerable:!0,get:function(){return s.ProfileMetricsController}}),Object.defineProperty(n,"getDefaultProfileMetricsControllerState",{enumerable:!0,get:function(){return s.getDefaultProfileMetricsControllerState}});var r=e("./ProfileMetricsService.cjs");Object.defineProperty(n,"ProfileMetricsService",{enumerable:!0,get:function(){return r.ProfileMetricsService}}),Object.defineProperty(n,"serviceName",{enumerable:!0,get:function(){return r.serviceName}})}}},{package:"@metamask/profile-metrics-controller",file:"node_modules/@metamask/profile-metrics-controller/dist/index.cjs"}],[25,{"./assets-contract-controller-init":24,"./network-order-controller-init":27,"./nft-controller-init":28,"./nft-detection-controller-init":29,"./token-rates-controller-init":30},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"AssetsContractControllerInit",{enumerable:!0,get:function(){return a.AssetsContractControllerInit}}),Object.defineProperty(n,"NetworkOrderControllerInit",{enumerable:!0,get:function(){return o.NetworkOrderControllerInit}}),Object.defineProperty(n,"NftControllerInit",{enumerable:!0,get:function(){return r.NftControllerInit}}),Object.defineProperty(n,"NftDetectionControllerInit",{enumerable:!0,get:function(){return i.NftDetectionControllerInit}}),Object.defineProperty(n,"TokenRatesControllerInit",{enumerable:!0,get:function(){return s.TokenRatesControllerInit}});var s=e("./token-rates-controller-init"),r=e("./nft-controller-init"),i=e("./nft-detection-controller-init"),a=e("./assets-contract-controller-init"),o=e("./network-order-controller-init")}}},{package:"$root$",file:"app/scripts/controller-init/assets/index.ts"}],[250,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.sortAccounts=function(e){return[...e].sort((e,t)=>{const n=e.type.startsWith("eip155:"),s=t.type.startsWith("eip155:");return n&&!s?-1:!n&&s?1:0})}}}},{package:"$root$",file:"app/scripts/controllers/rewards/utils/sortAccounts.ts"}],[251,{"../../../../shared/constants/common":5778,"../../../../shared/constants/gas":5784,"../../../../shared/constants/metametrics":5791,"../../../../shared/constants/network":5795,"../../../../shared/constants/smartTransactions":5805,"../../../../shared/constants/swaps":5810,"../../../../shared/constants/time":5812,"../../../../shared/lib/fetch-with-cache":5870,"../../../../shared/lib/sentry":5890,"../../../../shared/lib/swaps-utils":5894,"../../../../shared/lib/transactions-controller-utils":5899,"../../../../shared/modules/Numeric":5906,"../../../../shared/modules/conversion.utils":5913,"../../../../shared/modules/string-utils":5945,"../../../../shared/modules/swaps.utils":5946,"./swaps.constants":252,"./swaps.utils":253,"@ethersproject/contracts":746,"@ethersproject/providers":784,"@metamask/base-controller":1362,"bignumber.js":3972,"human-standard-token-abi":4606,lodash:4838},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=e("@ethersproject/contracts"),r=e("@ethersproject/providers"),i=e("@metamask/base-controller"),a=e("bignumber.js"),o=M(e("human-standard-token-abi")),c=e("lodash"),l=e("../../../../shared/lib/sentry"),u=e("../../../../shared/constants/common"),d=e("../../../../shared/constants/gas"),h=e("../../../../shared/constants/metametrics"),p=e("../../../../shared/constants/network"),f=e("../../../../shared/constants/smartTransactions"),m=e("../../../../shared/constants/swaps"),g=e("../../../../shared/constants/time"),w=M(e("../../../../shared/lib/fetch-with-cache")),b=e("../../../../shared/lib/swaps-utils"),v=e("../../../../shared/lib/transactions-controller-utils"),S=e("../../../../shared/modules/conversion.utils"),y=e("../../../../shared/modules/Numeric"),k=e("../../../../shared/modules/string-utils"),T=e("../../../../shared/modules/swaps.utils"),E=e("./swaps.constants"),I=e("./swaps.utils");function M(e){return e&&e.__esModule?e:{default:e}}function _(e,t,n){C(e,t),t.set(e,n)}function C(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function A(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function P(e,t){return e.get(j(e,t))}function O(e,t,n){return e.set(j(e,t),n),n}function j(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}const R={swapsState:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0}};var N=new WeakMap,D=new WeakMap,x=new WeakMap,F=new WeakMap,L=new WeakMap,U=new WeakMap,B=new WeakSet;class W extends i.BaseController{constructor(e,t){var n,s,r;super({name:E.controllerName,metadata:R,messenger:e.messenger,state:{swapsState:{...(0,E.getDefaultSwapsControllerState)().swapsState,swapsFeatureFlags:(null==t||null===(n=t.swapsState)||void 0===n?void 0:n.swapsFeatureFlags)||{}}}}),C(s=this,r=B),r.add(s),A(this,"getBufferedGasLimit",void 0),A(this,"resetState",void 0),A(this,"trackMetaMetricsEvent",void 0),_(this,N,void 0),_(this,D,void 0),_(this,x,null),_(this,F,void 0),_(this,L,void 0),_(this,U,void 0),A(this,"_fetchTradesInfo",b.fetchTradesInfo),A(this,"__test__updateState",e=>{this.update(t=>({swapsState:{...t.swapsState,...e.swapsState}}))}),this.messenger.registerActionHandler("SwapsController:fetchAndSetQuotes",this.fetchAndSetQuotes.bind(this)),this.messenger.registerActionHandler("SwapsController:setSelectedQuoteAggId",this.setSelectedQuoteAggId.bind(this)),this.messenger.registerActionHandler("SwapsController:resetSwapsState",this.resetSwapsState.bind(this)),this.messenger.registerActionHandler("SwapsController:setSwapsTokens",this.setSwapsTokens.bind(this)),this.messenger.registerActionHandler("SwapsController:clearSwapsQuotes",this.clearSwapsQuotes.bind(this)),this.messenger.registerActionHandler("SwapsController:setApproveTxId",this.setApproveTxId.bind(this)),this.messenger.registerActionHandler("SwapsController:setTradeTxId",this.setTradeTxId.bind(this)),this.messenger.registerActionHandler("SwapsController:setSwapsTxGasPrice",this.setSwapsTxGasPrice.bind(this)),this.messenger.registerActionHandler("SwapsController:setSwapsTxGasLimit",this.setSwapsTxGasLimit.bind(this)),this.messenger.registerActionHandler("SwapsController:setSwapsTxMaxFeePerGas",this.setSwapsTxMaxFeePerGas.bind(this)),this.messenger.registerActionHandler("SwapsController:setSwapsTxMaxFeePriorityPerGas",this.setSwapsTxMaxFeePriorityPerGas.bind(this)),this.messenger.registerActionHandler("SwapsController:safeRefetchQuotes",this.safeRefetchQuotes.bind(this)),this.messenger.registerActionHandler("SwapsController:stopPollingForQuotes",this.stopPollingForQuotes.bind(this)),this.messenger.registerActionHandler("SwapsController:setBackgroundSwapRouteState",this.setBackgroundSwapRouteState.bind(this)),this.messenger.registerActionHandler("SwapsController:resetPostFetchState",this.resetPostFetchState.bind(this)),this.messenger.registerActionHandler("SwapsController:setSwapsErrorKey",this.setSwapsErrorKey.bind(this)),this.messenger.registerActionHandler("SwapsController:setInitialGasEstimate",this.setInitialGasEstimate.bind(this)),this.messenger.registerActionHandler("SwapsController:setCustomApproveTxData",this.setCustomApproveTxData.bind(this)),this.messenger.registerActionHandler("SwapsController:setSwapsLiveness",this.setSwapsLiveness.bind(this)),this.messenger.registerActionHandler("SwapsController:setSwapsFeatureFlags",this.setSwapsFeatureFlags.bind(this)),this.messenger.registerActionHandler("SwapsController:setSwapsUserFeeLevel",this.setSwapsUserFeeLevel.bind(this)),this.messenger.registerActionHandler("SwapsController:setSwapsQuotesPollingLimitEnabled",this.setSwapsQuotesPollingLimitEnabled.bind(this)),this.getBufferedGasLimit=e.getBufferedGasLimit,this.trackMetaMetricsEvent=e.trackMetaMetricsEvent,this.resetState=()=>{this.update(e=>{e.swapsState={...(0,E.getDefaultSwapsControllerState)().swapsState,swapsFeatureFlags:null==e?void 0:e.swapsState.swapsFeatureFlags}})},O(F,this,e.getEIP1559GasFeeEstimates),O(L,this,e.getLayer1GasFee),O(N,this,0),O(D,this,0),this._fetchTradesInfo=e.fetchTradesInfo||b.fetchTradesInfo}clearSwapsQuotes(){this.update(e=>{e.swapsState.quotes={},e.swapsState.selectedAggId=null,e.swapsState.topAggId=null})}async fetchAndSetQuotes(e,t,n=!1){var s;if(!e)return null;let r;r=(null===(s=P(U,this))||void 0===s?void 0:s.clientId)===t.networkClientId?P(U,this):j(B,this,$).call(this,t.networkClientId);const{quotesPollingLimitEnabled:i,saveFetchedQuotes:a}=this.state.swapsState;n||O(D,this,0),P(x,this)&&clearTimeout(P(x,this)),n||this.setSwapsErrorKey("");const o=P(N,this)+1;O(N,this,o),a||this._setSaveFetchedQuotes(!0);let[l]=await Promise.all([this._fetchTradesInfo(e,{chainId:r.chainId}),this._setSwapsNetworkConfig(r)]);const{saveFetchedQuotes:u}=this.state.swapsState;if(!u)return[{},null];l=(0,c.mapValues)(l,e=>({...e,sourceTokenInfo:null==t?void 0:t.sourceTokenInfo,destinationTokenInfo:null==t?void 0:t.destinationTokenInfo}));const d=r.chainId===p.CHAIN_IDS.OPTIMISM.toString(),h=r.chainId===p.CHAIN_IDS.BASE.toString();(d||h)&&Object.values(l).length>0&&await Promise.all(Object.values(l).map(async e=>{if(e.trade){const t=await P(L,this).call(this,{transactionParams:e.trade,networkClientId:r.clientId});e.multiLayerL1TradeFeeTotal=t}return e}));const f=Date.now();let g=!1;if(!(0,T.isSwapsDefaultTokenAddress)(e.sourceToken,r.chainId)&&Object.values(l).length){const t=await this._getERC20Allowance(e.sourceToken,e.fromAddress,r),[s]=Object.values(l);if(g=s.approvalNeeded&&(t.eq(0)||t.lt(s.sourceAmount))&&"wrappedNative"!==s.aggregator,g){if(!n&&s.approvalNeeded){const{gasLimit:e}=await this._timedoutGasReturn(s.approvalNeeded,s.aggregator);l=(0,c.mapValues)(l,t=>t.approvalNeeded?{...t,approvalNeeded:{...t.approvalNeeded,gas:e||m.DEFAULT_ERC20_APPROVE_GAS}}:t)}}else l=(0,c.mapValues)(l,e=>({...e,approvalNeeded:null}))}let w=null;if(g||null!=e&&e.balanceError||(l=await this._getAllQuotesWithGasEstimates(l)),0===Object.values(l).length)this.setSwapsErrorKey(m.QUOTES_NOT_AVAILABLE_ERROR);else{const e=await this.getTopQuoteWithCalculatedSavings({quotes:l});Array.isArray(e)&&(w=e[0],l=e[1])}if(P(N,this)!==o)throw new Error(m.SWAPS_FETCH_ORDER_CONFLICT);let{selectedAggId:b}=this.state.swapsState;return b&&l[b]||(b=null),this.update(n=>{n.swapsState.quotes=l,n.swapsState.fetchParams={...e,metaData:t},n.swapsState.quotesLastFetched=f,n.swapsState.selectedAggId=b,n.swapsState.topAggId=w}),i&&O(D,this,P(D,this)+1),!i||P(D,this)<E.POLL_COUNT_LIMIT+1?(this._pollForNewQuotes(),[l,w]):(this.resetPostFetchState(),this.setSwapsErrorKey(m.QUOTES_EXPIRED_ERROR),null)}async getTopQuoteWithCalculatedSavings({quotes:e,networkClientId:t}){var n;let s;if(t){const e=this.messenger.call("NetworkController:getNetworkClientById",t);s=e.configuration.chainId}else{if(P(U,this)===undefined)throw new Error("There is no network set");s=P(U,this).chainId}const{marketData:r}=this._getTokenRatesState(),i=(null==r?void 0:r[s])??{},{customGasPrice:o,customMaxPriorityFeePerGas:l}=this.state.swapsState;if(0===Object.keys(e).length)return{};const h=(0,c.cloneDeep)(e),{gasFeeEstimates:p,gasEstimateType:f}=await P(F,this).call(this,{networkClientId:t});let m="0x0";if(f===d.GasEstimateTypes.feeMarket){const{high:{suggestedMaxPriorityFeePerGas:e},estimatedBaseFee:t}=p,n=(0,S.decGWEIToHexWEI)(Number(e)),s=new y.Numeric(t,10,u.EtherDenomination.GWEI).toDenomination(u.EtherDenomination.WEI);m=new y.Numeric(l||n,16).add(s).round(6).toString()}else f===d.GasEstimateTypes.legacy?m=o||(0,S.decGWEIToHexWEI)(Number(p.high)):f===d.GasEstimateTypes.ethGasPrice&&(m=o||(0,S.decGWEIToHexWEI)(Number(p.gasPrice)));let g,w="";Object.values(h).forEach(e=>{const{aggregator:t,approvalNeeded:n,averageGas:r,destinationAmount:o,destinationToken:c,destinationTokenInfo:l,gasEstimateWithRefund:d,sourceAmount:h,sourceToken:p,trade:f,fee:b,multiLayerL1TradeFeeTotal:I}=e;if(!f||!c)return;const M=(d?new a.BigNumber(d,16):new a.BigNumber(r||E.MAX_GAS_LIMIT,10)).plus((null==n?void 0:n.gas)||"0x0",16).toString(16);let _=(0,v.calcGasTotal)(M,m);null!==I&&(_=(0,S.sumHexes)(_||"0x0",I||"0x0"));const C=new y.Numeric(_,16,u.EtherDenomination.WEI).add(new y.Numeric(f.value,16,u.EtherDenomination.WEI)),A=C.toDenomination(u.EtherDenomination.ETH).round(6).value,P=(0,T.isSwapsDefaultTokenAddress)(p,s)?C.minus(new y.Numeric(h,10)).toDenomination(u.EtherDenomination.ETH).round(6).value:A,O=(0,v.calcTokenAmount)(o??"0",l.decimals),j=new a.BigNumber(100,10).minus(b,10).div(100),R=O.div(j).minus(O),N=Object.keys(i).find(e=>(0,k.isEqualCaseInsensitive)(e,c)),D=N?i[N]:null,x=(null==D?void 0:D.price)||1,F=O.times(x.toString(10),10),L=(0,T.isSwapsDefaultTokenAddress)(c,s)?1:null==D?void 0:D.price,U=L?F.minus(P,10):F;e.ethFee=P.toString(10),L&&(e.ethValueOfTokens=F.toString(10),e.overallValueOfQuote=U.toString(10),e.metaMaskFeeInEth=R.times(L.toString(10)).toString(10)),g&&!U.gt(g||0)||(w=t,g=U)});const b=Object.keys(i).find(e=>{var t;return(0,k.isEqualCaseInsensitive)(e,null===(t=h[w])||void 0===t?void 0:t.destinationToken)}),M=b?i[b]:null;if((0,T.isSwapsDefaultTokenAddress)(null===(n=h[w])||void 0===n?void 0:n.destinationToken,s)||Boolean(null==M?void 0:M.price)){const e=h[w],{ethFee:t,metaMaskFeeInEth:n,ethValueOfTokens:s}=(0,I.getMedianEthValueQuote)(Object.values(h)),r=new a.BigNumber(e.ethValueOfTokens,10).minus(s,10).toString(10),i=new a.BigNumber(t).minus(e.ethFee,10).toString(10),o=e.metaMaskFeeInEth,c={performance:r,fee:i,total:new a.BigNumber(r).plus(i).minus(o).toString(10),metaMaskFee:o,medianMetaMaskFee:n};h[w].isBestQuote=!0,h[w].savings=c}return[w,h]}resetPostFetchState(){this.update(e=>{e.swapsState={...(0,E.getDefaultSwapsControllerState)().swapsState,tokens:e.swapsState.tokens,fetchParams:e.swapsState.fetchParams,swapsFeatureIsLive:e.swapsState.swapsFeatureIsLive,swapsQuoteRefreshTime:e.swapsState.swapsQuoteRefreshTime,swapsQuotePrefetchingRefreshTime:e.swapsState.swapsQuotePrefetchingRefreshTime,swapsFeatureFlags:e.swapsState.swapsFeatureFlags}}),P(x,this)&&clearTimeout(P(x,this))}resetSwapsState(){this.update(e=>{e.swapsState={...(0,E.getDefaultSwapsControllerState)().swapsState,swapsQuoteRefreshTime:e.swapsState.swapsQuoteRefreshTime,swapsQuotePrefetchingRefreshTime:e.swapsState.swapsQuotePrefetchingRefreshTime,swapsFeatureFlags:e.swapsState.swapsFeatureFlags}}),P(x,this)&&clearTimeout(P(x,this))}safeRefetchQuotes(){!P(x,this)&&this.state.swapsState.fetchParams&&this.fetchAndSetQuotes(this.state.swapsState.fetchParams,{...this.state.swapsState.fetchParams.metaData})}setApproveTxId(e){this.update(t=>{t.swapsState.approveTxId=e})}setBackgroundSwapRouteState(e){this.update(t=>{t.swapsState.routeState=e})}setCustomApproveTxData(e){this.update(t=>{t.swapsState.customApproveTxData=e})}async setInitialGasEstimate(e){const t={...this.state.swapsState.quotes[e]},{gasLimit:n,simulationFails:s}=t.trade?await this._timedoutGasReturn(t.trade,t.aggregator):{gasLimit:null,simulationFails:!0};if(n&&!s){const e=(0,I.calculateGasEstimateWithRefund)(t.maxGas,t.estimatedRefund,n);t.gasEstimate=n,t.gasEstimateWithRefund=e}this.update(n=>{n.swapsState.quotes={...n.swapsState.quotes,[e]:t}})}setSelectedQuoteAggId(e){this.update(t=>{t.swapsState.selectedAggId=e})}setSwapsFeatureFlags(e){this.update(t=>{t.swapsState.swapsFeatureFlags=e})}setSwapsErrorKey(e){this.update(t=>{t.swapsState.errorKey=e})}setSwapsLiveness(e){const{swapsFeatureIsLive:t}=e;this.update(e=>{e.swapsState.swapsFeatureIsLive=t})}setSwapsQuotesPollingLimitEnabled(e){this.update(t=>{t.swapsState.quotesPollingLimitEnabled=e})}setSwapsTokens(e){this.update(t=>{t.swapsState.tokens=e})}setSwapsTxGasLimit(e){this.update(t=>{t.swapsState.customMaxGas=e})}setSwapsTxGasPrice(e){this.update(t=>{t.swapsState.customGasPrice=e})}setSwapsTxMaxFeePerGas(e){this.update(t=>{t.swapsState.customMaxFeePerGas=e})}setSwapsTxMaxFeePriorityPerGas(e){this.update(t=>{t.swapsState.customMaxPriorityFeePerGas=e})}setSwapsUserFeeLevel(e){this.update(t=>{t.swapsState.swapsUserFeeLevel=e})}setTradeTxId(e){this.update(t=>{t.swapsState.tradeTxId=e})}stopPollingForQuotes(){P(x,this)&&clearTimeout(P(x,this))}async _fetchSwapsNetworkConfig(e){const t=await(0,w.default)({url:(0,b.getBaseApi)("network",e.chainId),fetchOptions:{method:"GET"},cacheOptions:{cacheRefreshTime:6e5},functionName:"_fetchSwapsNetworkConfig"}),{refreshRates:n,parameters:s={}}=t||{};if(!n||"number"!=typeof n.quotes||"number"!=typeof n.quotesPrefetching)throw new Error(`MetaMask - invalid response for refreshRates: ${t}`);return{quotes:1e3*n.quotes,quotesPrefetching:1e3*n.quotesPrefetching,stxGetTransactions:1e3*n.stxGetTransactions,stxBatchStatus:1e3*n.stxBatchStatus,stxStatusDeadline:n.stxStatusDeadline,stxMaxFeeMultiplier:s.stxMaxFeeMultiplier}}async _getAllQuotesWithGasEstimates(e){const t=await Promise.all(Object.values(e).map(async e=>{if(!e.trade)return{gasLimit:null,simulationFails:!0,aggId:e.aggregator};const{gasLimit:t,simulationFails:n}=await this._timedoutGasReturn(e.trade,e.aggregator);return{gasLimit:t,simulationFails:n,aggId:e.aggregator}})),n={};return t.forEach(({gasLimit:t,simulationFails:s,aggId:r})=>{if(t&&!s){const s=(0,I.calculateGasEstimateWithRefund)(e[r].maxGas,e[r].estimatedRefund,t);n[r]={...e[r],gasEstimate:t,gasEstimateWithRefund:s}}else e[r].approvalNeeded&&(n[r]=e[r])}),n}async _getERC20Allowance(e,t,n){const r=new s.Contract(e,o.default,n.ethersProvider);return await r.allowance(t,m.SWAPS_CHAINID_CONTRACT_ADDRESS_MAP[n.chainId])}_getTokenRatesState(){const{marketData:e}=this.messenger.call("TokenRatesController:getState");return{marketData:e}}_pollForNewQuotes(){const{swapsQuoteRefreshTime:e,swapsQuotePrefetchingRefreshTime:t,quotesPollingLimitEnabled:n}=this.state.swapsState;O(x,this,setTimeout(()=>{var e;this.fetchAndSetQuotes(this.state.swapsState.fetchParams,null===(e=this.state.swapsState.fetchParams)||void 0===e?void 0:e.metaData,!0)},n?e:t))}_setSaveFetchedQuotes(e){this.update(t=>{t.swapsState.saveFetchedQuotes=e})}async _setSwapsNetworkConfig(e){let t=null;try{t=await this._fetchSwapsNetworkConfig(e)}catch(e){console.error("Request for Swaps network config failed: ",e)}this.update(e=>{var n,s,r,i,a,o;e.swapsState.swapsQuoteRefreshTime=(null===(n=t)||void 0===n?void 0:n.quotes)||E.FALLBACK_QUOTE_REFRESH_TIME,e.swapsState.swapsQuotePrefetchingRefreshTime=(null===(s=t)||void 0===s?void 0:s.quotesPrefetching)||E.FALLBACK_QUOTE_REFRESH_TIME,e.swapsState.swapsStxGetTransactionsRefreshTime=(null===(r=t)||void 0===r?void 0:r.stxGetTransactions)||f.FALLBACK_SMART_TRANSACTIONS_REFRESH_TIME,e.swapsState.swapsStxBatchStatusRefreshTime=(null===(i=t)||void 0===i?void 0:i.stxBatchStatus)||f.FALLBACK_SMART_TRANSACTIONS_REFRESH_TIME,e.swapsState.swapsStxMaxFeeMultiplier=(null===(a=t)||void 0===a?void 0:a.stxMaxFeeMultiplier)||f.FALLBACK_SMART_TRANSACTIONS_MAX_FEE_MULTIPLIER,e.swapsState.swapsStxStatusDeadline=(null===(o=t)||void 0===o?void 0:o.stxStatusDeadline)||f.FALLBACK_SMART_TRANSACTIONS_DEADLINE})}_timedoutGasReturn(e,t=""){return new Promise(n=>{let s=!1;const r=setTimeout(()=>{s=!0,this.trackMetaMetricsEvent({event:h.MetaMetricsEventName.QuoteError,category:h.MetaMetricsEventCategory.Swaps,properties:{error_type:h.MetaMetricsEventErrorType.GasTimeout,aggregator:t}}),n({gasLimit:null,simulationFails:!0})},5*g.SECOND),i={data:e.data,from:e.from,to:e.to,value:e.value};this.getBufferedGasLimit({txParams:i},1).then(({gasLimit:e,simulationFails:t})=>{s||(clearTimeout(r),n({gasLimit:e,simulationFails:t}))}).catch(e=>{(0,l.captureException)(e,{extra:{aggregator:t}}),s||(clearTimeout(r),n({gasLimit:null,simulationFails:!0}))})})}}function $(e){const t=this.messenger.call("NetworkController:getNetworkClientById",e),{chainId:n}=t.configuration,s={client:t,clientId:e,chainId:n,ethersProvider:new r.Web3Provider(t.provider)};return O(U,this,s),s}n.default=W}}},{package:"$root$",file:"app/scripts/controllers/swaps/index.ts"}],[252,{"../../../../shared/constants/smartTransactions":5805,"../../../../shared/constants/time":5812},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.controllerName=n.POLL_COUNT_LIMIT=n.MAX_GAS_LIMIT=n.FALLBACK_QUOTE_REFRESH_TIME=void 0,n.getDefaultSwapsControllerState=function(){return{swapsState:{quotes:{},quotesPollingLimitEnabled:!1,fetchParams:null,tokens:null,tradeTxId:null,approveTxId:null,quotesLastFetched:null,customMaxGas:"",customGasPrice:null,customMaxFeePerGas:null,customMaxPriorityFeePerGas:null,swapsUserFeeLevel:"",selectedAggId:null,customApproveTxData:"",errorKey:"",topAggId:null,routeState:"",swapsFeatureIsLive:!0,saveFetchedQuotes:!1,swapsQuoteRefreshTime:i,swapsQuotePrefetchingRefreshTime:i,swapsStxBatchStatusRefreshTime:s.FALLBACK_SMART_TRANSACTIONS_REFRESH_TIME,swapsStxStatusDeadline:s.FALLBACK_SMART_TRANSACTIONS_DEADLINE,swapsStxGetTransactionsRefreshTime:s.FALLBACK_SMART_TRANSACTIONS_REFRESH_TIME,swapsStxMaxFeeMultiplier:s.FALLBACK_SMART_TRANSACTIONS_MAX_FEE_MULTIPLIER,swapsFeatureFlags:{}}}};var s=e("../../../../shared/constants/smartTransactions"),r=e("../../../../shared/constants/time");n.controllerName="SwapsController",n.MAX_GAS_LIMIT=25e5,n.POLL_COUNT_LIMIT=3;const i=n.FALLBACK_QUOTE_REFRESH_TIME=r.MINUTE}}},{package:"$root$",file:"app/scripts/controllers/swaps/swaps.constants.ts"}],[253,{"./swaps.constants":252,"bignumber.js":3972},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.calculateGasEstimateWithRefund=function(e=r.MAX_GAS_LIMIT,t="0",n="0"){const i=new s.BigNumber(e,10).minus(t,10),a=i.lt(0);return!a&&i.lt(n,16)?`0x${i.toString(16)}`:n},n.getMedianEthValueQuote=function(e){if(!Array.isArray(e)||0===e.length)throw new Error("Expected non-empty array param.");const t=[...e];if(t.sort((e,t)=>{const n=new s.BigNumber(e.overallValueOfQuote,10),r=new s.BigNumber(t.overallValueOfQuote,10);return n.equals(r)?0:n.lessThan(r)?-1:1}),t.length%2==1){const e=t[(t.length-1)/2].overallValueOfQuote;return i(t.filter(t=>e===t.overallValueOfQuote))}const n=t.length/2,r=n-1,a=t[n].overallValueOfQuote,o=t[r].overallValueOfQuote,c=t.filter(e=>a===e.overallValueOfQuote),l=t.filter(e=>o===e.overallValueOfQuote),u=i(c),d=i(l);return{ethFee:new s.BigNumber(u.ethFee,10).plus(d.ethFee,10).dividedBy(2).toString(10),metaMaskFeeInEth:new s.BigNumber(u.metaMaskFeeInEth,10).plus(d.metaMaskFeeInEth,10).dividedBy(2).toString(10),ethValueOfTokens:new s.BigNumber(u.ethValueOfTokens,10).plus(d.ethValueOfTokens,10).dividedBy(2).toString(10)}},n.meansOfQuotesFeesAndValue=i;var s=e("bignumber.js"),r=e("./swaps.constants");function i(e){const t=e.reduce((e,t)=>({ethFee:e.ethFee.plus(t.ethFee,10),metaMaskFeeInEth:e.metaMaskFeeInEth.plus(t.metaMaskFeeInEth,10),ethValueOfTokens:e.ethValueOfTokens.plus(t.ethValueOfTokens,10)}),{ethFee:new s.BigNumber(0,10),metaMaskFeeInEth:new s.BigNumber(0,10),ethValueOfTokens:new s.BigNumber(0,10)});return{ethFee:t.ethFee.div(e.length,10).toString(10),metaMaskFeeInEth:t.metaMaskFeeInEth.div(e.length,10).toString(10),ethValueOfTokens:t.ethValueOfTokens.div(e.length,10).toString(10)}}}}},{package:"$root$",file:"app/scripts/controllers/swaps/swaps.utils.ts"}],[254,{"../../shared/constants/app":5775,"./lib/util":372,"webextension-polyfill":5763},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.onMessageReceived=n.checkForMultipleVersionsRunning=void 0;var s,r=(s=e("webextension-polyfill"))&&s.__esModule?s:{default:s},i=e("../../shared/constants/app"),a=e("./lib/util");const o="isRunning";n.onMessageReceived=e=>{e===o&&console.warn("Warning! You have multiple instances of MetaMask running!")};n.checkForMultipleVersionsRunning=async()=>{if((0,a.getPlatform)()!==i.PLATFORM_CHROME&&(0,a.getPlatform)()!==i.PLATFORM_FIREFOX)return;const e=(0,a.getPlatform)()===i.PLATFORM_CHROME?i.CHROME_BUILD_IDS:i.FIREFOX_BUILD_IDS,t=r.default.runtime.id;for(const n of e)if(n!==t)try{await r.default.runtime.sendMessage(n,o)}catch(e){}}}}},{package:"$root$",file:"app/scripts/detect-multiple-instances.js"}],[255,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default={config:{}}}}},{package:"$root$",file:"app/scripts/first-time-state.js"}],[256,{"@metamask/name-controller":2307},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ChangeType=n.AbstractPetnamesBridge=void 0;var s=e("@metamask/name-controller");function r(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t,n){a(e,t),t.set(e,n)}function a(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function o(e,t){return e.get(l(e,t))}function c(e,t,n){return e.set(l(e,t),n),n}function l(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}let u=n.ChangeType=function(e){return e.ADDED="ADDED",e.UPDATED="UPDATED",e.DELETED="DELETED",e}({});var d=function(e){return e.SOURCE_TO_PETNAMES="Source->Petnames",e.PETNAMES_TO_SOURCE="Petnames->Source",e}(d||{});function h({type:e,variation:t,value:n}){return`${e}/${t}/${e===s.NameType.ETHEREUM_ADDRESS?n.toLowerCase():n}`}var p=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakSet;function w(e){if(o(m,this)===e)throw new Error(`Attempted to synchronize recursively in same direction: ${e}`);if(null!==o(m,this))return;c(m,this,e);const[t,n]="Source->Petnames"===e?[this.getSourceEntries(),l(g,this,b).call(this)]:[l(g,this,b).call(this),this.getSourceEntries()],s=l(g,this,S).call(this,n,t);l(g,this,y).call(this,s),c(m,this,null)}function b(){const{names:e}=o(f,this).state,t=[];for(const n of Object.values(s.NameType))for(const s of Object.keys(e[n]))for(const r of Object.keys(e[n][s])){const{name:i,sourceId:a,origin:o}=e[n][s][r];if(!i)continue;const c={value:s,type:n,name:i,variation:r,sourceId:a??undefined,origin:o??undefined};this.shouldSyncPetname(c)&&t.push(c)}return t}function v(e,t){e===u.DELETED?(delete t.sourceId,delete t.origin,o(f,this).setName({...t,name:null})):o(f,this).setName(t)}function S(e,t){const n=[],s=[],r=[],i=new Map(e.map(e=>[h(e),e])),a=new Map(t.map(e=>[h(e),e]));return a.forEach((e,t)=>{const r=i.get(t);r?e.name!==r.name&&s.push(e):n.push(e)}),i.forEach((e,t)=>{a.has(t)||r.push(e)}),{[u.ADDED]:n,[u.UPDATED]:s,[u.DELETED]:r}}function y(e){const t=o(m,this)===d.SOURCE_TO_PETNAMES?l(g,this,v).bind(this):this.updateSourceEntry.bind(this);for(const n of Object.values(u))for(const s of e[n])t(n,s)}n.AbstractPetnamesBridge=class{constructor({isTwoWay:e,nameController:t,messenger:n}){var s,o;a(s=this,o=g),o.add(s),i(this,p,void 0),i(this,f,void 0),i(this,m,null),r(this,"messenger",void 0),c(p,this,e),c(f,this,t),this.messenger=n}init(){o(p,this)&&this.messenger.subscribe("NameController:stateChange",()=>l(g,this,w).call(this,d.PETNAMES_TO_SOURCE)),this.onSourceChange(()=>l(g,this,w).call(this,d.SOURCE_TO_PETNAMES))}updateSourceEntry(e,t){throw new Error("updateSourceEntry must be overridden for two-way bridges")}shouldSyncPetname(e){return!0}}}}},{package:"$root$",file:"app/scripts/lib/AbstractPetnamesBridge.ts"}],[257,{"./AbstractPetnamesBridge":256,"@metamask/name-controller":2307},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AccountIdentitiesPetnamesBridge=void 0;var s=e("@metamask/name-controller"),r=e("./AbstractPetnamesBridge");class i extends r.AbstractPetnamesBridge{constructor({nameController:e,messenger:t}){super({isTwoWay:!1,nameController:e,messenger:t})}getSourceEntries(){return this.messenger.call("AccountsController:listAccounts").map(e=>({value:e.address,type:s.NameType.ETHEREUM_ADDRESS,name:e.metadata.name,sourceId:undefined,variation:s.FALLBACK_VARIATION,origin:s.NameOrigin.ACCOUNT_IDENTITY}))}onSourceChange(e){this.messenger.subscribe("AccountsController:stateChange",e)}shouldSyncPetname(e){return e.origin===s.NameOrigin.ACCOUNT_IDENTITY}}n.AccountIdentitiesPetnamesBridge=i}}},{package:"$root$",file:"app/scripts/lib/AccountIdentitiesPetnamesBridge.ts"}],[258,{"./AbstractPetnamesBridge":256,"@metamask/name-controller":2307,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AddressBookPetnamesBridge=void 0;var s=e("@metamask/name-controller"),r=e("@metamask/utils"),i=e("./AbstractPetnamesBridge");function a(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function o(e,t){return e.get(c(e,t))}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var l=new WeakMap;class u extends i.AbstractPetnamesBridge{constructor({addressBookController:e,nameController:t,messenger:n}){var s,r,i;super({isTwoWay:!0,nameController:t,messenger:n}),a(this,l,void 0),r=this,i=e,(s=l).set(c(s,r),i)}getSourceEntries(){const e=[],{state:t}=o(l,this);for(const n of Object.keys(t.addressBook)){if(!(0,r.isStrictHexString)(n))continue;const i=t.addressBook[n];for(const r of Object.keys(i)){const i=t.addressBook[n][r],a=n.toLowerCase(),{name:o,isEns:c}=i;null!=o&&o.length&&null!=r&&r.length&&e.push({value:r,name:o,variation:a,type:s.NameType.ETHEREUM_ADDRESS,sourceId:c?"ens":undefined,origin:s.NameOrigin.ADDRESS_BOOK})}}return e}updateSourceEntry(e,t){e===i.ChangeType.DELETED?o(l,this).delete(t.variation,t.value):o(l,this).set(t.value,t.name,t.variation)}onSourceChange(e){this.messenger.subscribe("AddressBookController:stateChange",e)}}n.AddressBookPetnamesBridge=u}}},{package:"$root$",file:"app/scripts/lib/AddressBookPetnamesBridge.ts"}],[2588,{"@metamask/base-controller":1362,"@metamask/rpc-errors":2600,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.RateLimitController=void 0;const s=e("@metamask/base-controller"),r=e("@metamask/rpc-errors"),i=e("@metamask/utils"),a="RateLimitController",o={requests:{includeInStateLogs:!1,persist:!1,includeInDebugSnapshot:!1,usedInUi:!1}};class c extends s.BaseController{constructor({rateLimitTimeout:e=5e3,rateLimitCount:t=1,messenger:n,state:s,implementations:r}){const c={requests:(0,i.getKnownPropertyNames)(r).reduce((e,t)=>({...e,[t]:{}}),{})};super({name:a,metadata:o,messenger:n,state:{...c,...s}}),this.implementations=r,this.rateLimitTimeout=e,this.rateLimitCount=t,this.messenger.registerActionHandler(`${a}:call`,(e,t,...n)=>this.call(e,t,...n))}async call(e,t,...n){if(this.isRateLimited(t,e))throw r.rpcErrors.limitExceeded({message:`"${t.toString()}" is currently rate-limited. Please try again later.`});this.recordRequest(t,e);const s=this.implementations[t].method;if(!s)throw new Error("Invalid api type");return s(...n)}isRateLimited(e,t){const n=this.implementations[e].rateLimitCount??this.rateLimitCount;return this.state.requests[e][t]>=n}recordRequest(e,t){const n=this.implementations[e].rateLimitTimeout??this.rateLimitTimeout,s=this.state.requests[e][t]??0;this.update(r=>{0===s&&setTimeout(()=>this.resetRequestCount(e,t),n),Object.assign(r,{requests:{...r.requests,[e]:{[t]:s+1}}})})}resetRequestCount(e,t){this.update(n=>{Object.assign(n,{requests:{...n.requests,[e]:{[t]:0}}})})}}n.RateLimitController=c}}},{package:"@metamask/rate-limit-controller",file:"node_modules/@metamask/rate-limit-controller/dist/RateLimitController.cjs"}],[2589,{"./RateLimitController.cjs":2588},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.RateLimitController=void 0;var s=e("./RateLimitController.cjs");Object.defineProperty(n,"RateLimitController",{enumerable:!0,get:function(){return s.RateLimitController}})}}},{package:"@metamask/rate-limit-controller",file:"node_modules/@metamask/rate-limit-controller/dist/index.cjs"}],[259,{"@metamask/base-controller":1362,"@metamask/obs-store":2421},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=e("@metamask/obs-store"),r=e("@metamask/base-controller");function i(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function c(e,t){return(0,r.deriveStateFromMetadata)(e,t,"persist")}var l=new WeakSet;class u extends s.ObservableStore{constructor({config:e,controllerMessenger:t,state:n,persist:s}){super(n),i(this,l),a(this,"config",{}),this.persist=s,this.controllerMessenger=t,e&&this.updateStructure(e)}updateStructure(e){this.config=e,this.removeAllListeners();const t={};for(const s of Object.keys(e)){var n;if(!e[s])throw new Error(`Undefined '${s}'`);const r=e[s];r.subscribe?e[s].subscribe(e=>{o(l,this,d).call(this,s,e)}):this.persist?this.controllerMessenger.subscribe(`${r.name}:stateChange`,(t,n)=>{o(l,this,h).call(this,e[s].metadata,n)&&o(l,this,d).call(this,s,c(t,e[s].metadata),n)}):this.controllerMessenger.subscribe(`${r.name}:stateChange`,(e,t)=>o(l,this,d).call(this,s,e,t));const i=r.state??(null===(n=r.getState)||void 0===n?void 0:n.call(r));t[s]=this.persist&&e[s].metadata?c(i,e[s].metadata):i}this.updateState(t)}getFlatState(){if(!this.config)return{};const e={};for(const t of Object.keys(this.config)){const n=this.config[t],s=n.getState?n.getState():n.state;Object.assign(e,s)}return e}}function d(e,t,n){const s=this.getState()[e];this.updateState({[e]:t}),this.emit("stateChange",{controllerKey:e,newState:t,oldState:s,patches:n})}function h(e,t){return t.some(t=>{if(0===t.path.length)return!0;const n=t.path[0];return!e[n]||e[n].persist})}n.default=u}}},{package:"$root$",file:"app/scripts/lib/ComposableObservableStore.js"}],[2590,{"../constants.cjs":2591,"@metamask/controller-utils":1449},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,i,a,o,c=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},l=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.ClientConfigApiService=void 0;const u=e("@metamask/controller-utils"),d=e("../constants.cjs");n.ClientConfigApiService=class{constructor({fetch:e,retries:t=u.DEFAULT_MAX_RETRIES,maximumConsecutiveFailures:n=u.DEFAULT_MAX_CONSECUTIVE_FAILURES,circuitBreakDuration:d=u.DEFAULT_CIRCUIT_BREAK_DURATION,onBreak:h,onDegraded:p,config:f}){s.set(this,void 0),r.set(this,void 0),i.set(this,void 0),a.set(this,void 0),o.set(this,void 0),c(this,s,e,"f"),c(this,i,f.client,"f"),c(this,a,f.distribution,"f"),c(this,o,f.environment,"f"),c(this,r,(0,u.createServicePolicy)({maxRetries:t,maxConsecutiveFailures:n,circuitBreakDuration:d}),"f"),h&&l(this,r,"f").onBreak(h),p&&l(this,r,"f").onDegraded(p)}onBreak(...e){return l(this,r,"f").onBreak(...e)}onDegraded(...e){return l(this,r,"f").onDegraded(...e)}async fetchRemoteFeatureFlags(){const e=`${d.BASE_URL}/flags?client=${l(this,i,"f")}&distribution=${l(this,a,"f")}&environment=${l(this,o,"f")}`,t=await l(this,r,"f").execute(()=>l(this,s,"f").call(this,e,{cache:"no-cache"}));if(!t.ok)throw new Error("Failed to fetch remote feature flags");const n=await t.json();if(!Array.isArray(n))throw new Error("Feature flags api did not return an array");return{remoteFeatureFlags:this.flattenFeatureFlags(n),cacheTimestamp:Date.now()}}flattenFeatureFlags(e){return e.reduce((e,t)=>({...e,...t}),{})}},s=new WeakMap,r=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/client-config-api-service/client-config-api-service.cjs"}],[2591,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.BASE_URL=void 0,n.BASE_URL="https://client-config.api.cx.metamask.io/v1"}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/constants.cjs"}],[2592,{"./client-config-api-service/client-config-api-service.cjs":2590,"./remote-feature-flag-controller-types.cjs":2593,"./remote-feature-flag-controller.cjs":2594,"./utils/user-segmentation-utils.cjs":2595},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.generateDeterministicRandomNumber=n.ClientConfigApiService=n.EnvironmentType=n.DistributionType=n.ClientType=n.RemoteFeatureFlagController=void 0;var s=e("./remote-feature-flag-controller.cjs");Object.defineProperty(n,"RemoteFeatureFlagController",{enumerable:!0,get:function(){return s.RemoteFeatureFlagController}});var r=e("./remote-feature-flag-controller-types.cjs");Object.defineProperty(n,"ClientType",{enumerable:!0,get:function(){return r.ClientType}}),Object.defineProperty(n,"DistributionType",{enumerable:!0,get:function(){return r.DistributionType}}),Object.defineProperty(n,"EnvironmentType",{enumerable:!0,get:function(){return r.EnvironmentType}});var i=e("./client-config-api-service/client-config-api-service.cjs");Object.defineProperty(n,"ClientConfigApiService",{enumerable:!0,get:function(){return i.ClientConfigApiService}});var a=e("./utils/user-segmentation-utils.cjs");Object.defineProperty(n,"generateDeterministicRandomNumber",{enumerable:!0,get:function(){return a.generateDeterministicRandomNumber}})}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/index.cjs"}],[2593,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,i;Object.defineProperty(n,"__esModule",{value:!0}),n.EnvironmentType=n.DistributionType=n.ClientType=void 0,function(e){e.Extension="extension",e.Mobile="mobile"}(s||(n.ClientType=s={})),function(e){e.Main="main",e.Flask="flask",e.Beta="beta"}(r||(n.DistributionType=r={})),function(e){e.Production="prod",e.ReleaseCandidate="rc",e.Development="dev",e.Beta="beta",e.Test="test",e.Exp="exp"}(i||(n.EnvironmentType=i={}))}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/remote-feature-flag-controller-types.cjs"}],[2594,{"./utils/user-segmentation-utils.cjs":2595,"./utils/version.cjs":2596,"@metamask/base-controller":1362,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,i,a,o,c,l,u,d,h,p,f=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},m=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.RemoteFeatureFlagController=n.getDefaultRemoteFeatureFlagControllerState=n.DEFAULT_CACHE_DURATION=void 0;const g=e("@metamask/base-controller"),w=e("@metamask/utils"),b=e("./utils/user-segmentation-utils.cjs"),v=e("./utils/version.cjs");n.DEFAULT_CACHE_DURATION=864e5;const S={remoteFeatureFlags:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!0},cacheTimestamp:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!0,usedInUi:!1}};function y(){return{remoteFeatureFlags:{},cacheTimestamp:0}}n.getDefaultRemoteFeatureFlagControllerState=y;class k extends g.BaseController{constructor({messenger:e,state:t,clientConfigApiService:u,fetchInterval:d=n.DEFAULT_CACHE_DURATION,disabled:h=!1,getMetaMetricsId:p,clientVersion:m}){if(!(0,w.isValidSemVerVersion)(m))throw new Error(`Invalid clientVersion: "${m}". Must be a valid 3-part SemVer version string`);super({name:"RemoteFeatureFlagController",metadata:S,messenger:e,state:{remoteFeatureFlags:{},cacheTimestamp:0,...t}}),s.add(this),r.set(this,void 0),i.set(this,void 0),a.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),f(this,r,d,"f"),f(this,i,h,"f"),f(this,a,u,"f"),f(this,c,p,"f"),f(this,l,m,"f")}async updateRemoteFeatureFlags(){if(m(this,i,"f")||!m(this,s,"m",u).call(this))return;let e;if(m(this,o,"f"))await m(this,o,"f");else{try{f(this,o,m(this,a,"f").fetchRemoteFeatureFlags(),"f"),e=await m(this,o,"f")}finally{f(this,o,undefined,"f")}await m(this,s,"m",d).call(this,e.remoteFeatureFlags)}}enable(){f(this,i,!1,"f")}disable(){f(this,i,!0,"f")}}n.RemoteFeatureFlagController=k,r=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,s=new WeakSet,u=function(){return Date.now()-this.state.cacheTimestamp>m(this,r,"f")},d=async function(e){const t=await m(this,s,"m",p).call(this,e);this.update(()=>({remoteFeatureFlags:t,cacheTimestamp:Date.now()}))},h=function(e){return(0,v.isVersionFeatureFlag)(e)?(0,v.getVersionData)(e,m(this,l,"f")):e},p=async function(e){const t={},n=m(this,c,"f").call(this),r=(0,b.generateDeterministicRandomNumber)(n);for(const[n,i]of Object.entries(e)){let e=m(this,s,"m",h).call(this,i);if(null!==e){if(Array.isArray(e)&&r){const t=e.find(e=>!!(0,b.isFeatureFlagWithScopeValue)(e)&&r<=e.scope.value);t&&(e={name:t.name,value:t.value})}t[n]=e}}return t}}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/remote-feature-flag-controller.cjs"}],[2595,{uuid:5734},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isFeatureFlagWithScopeValue=n.generateDeterministicRandomNumber=void 0;const s=e("uuid");function r(e){return BigInt(`0x${e.replace(/-/gu,"")}`)}const i=r("00000000-0000-4000-8000-000000000000"),a=r("ffffffff-ffff-4fff-bfff-ffffffffffff")-i;n.generateDeterministicRandomNumber=function(e){if(!e)throw new Error("MetaMetrics ID cannot be empty");let t,n;if((0,s.validate)(e)){if(4!==(0,s.version)(e))throw new Error(`Invalid UUID version. Expected v4, got v${(0,s.version)(e)}`);t=r(e)-i,n=a}else{if(!e.startsWith("0x"))throw new Error("Hex ID must start with 0x prefix");const s=e.slice(2),r=64;if(s.length!==r)throw new Error(`Invalid hex ID length. Expected ${r} characters, got ${s.length}`);if(!/^[0-9a-f]+$/iu.test(s))throw new Error("Hex ID contains invalid characters");t=BigInt(`0x${s}`),n=BigInt(`0x${"f".repeat(s.length)}`)}return Number(t*BigInt(1e6)/n)/1e6};n.isFeatureFlagWithScopeValue=e=>"object"==typeof e&&null!==e&&"scope"in e}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/utils/user-segmentation-utils.cjs"}],[2596,{"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getVersionData=n.isVersionFeatureFlag=n.MULTI_VERSION_FLAG_KEYS=void 0;const s=e("@metamask/utils");function r(e,t){return e===t||(0,s.gtVersion)(e,t)}n.MULTI_VERSION_FLAG_KEYS={VERSIONS:"versions"},n.isVersionFeatureFlag=function(e){if("object"!=typeof e||null===e||Array.isArray(e)||!(n.MULTI_VERSION_FLAG_KEYS.VERSIONS in e))return!1;const t=e[n.MULTI_VERSION_FLAG_KEYS.VERSIONS];return"object"==typeof t&&null!==t&&!Array.isArray(t)&&Object.keys(t).every(e=>(0,s.isValidSemVerVersion)(e))},n.getVersionData=function(e,t){const n=(s=e.versions,Object.entries(s)).sort(([e],[t])=>r(e,t)?-1:1);var s;for(const[e,s]of n)if(r(t,e))return s;return null}}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/utils/version.cjs"}],[26,{"../../../../shared/constants/network":5795,"@metamask/keyring-api":2193,"@metamask/network-enablement-controller":2348,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.NetworkEnablementControllerInit=void 0;var s=e("@metamask/network-enablement-controller"),r=e("@metamask/keyring-api"),i=e("@metamask/utils"),a=e("../../../../shared/constants/network");const o=(e,t)=>{const n={[i.KnownCaipNamespace.Eip155]:{}};return Object.keys(e).forEach(e=>{n[i.KnownCaipNamespace.Eip155][e]=t.includes(e)}),n},c=(e,t=[])=>{const n={};return Object.keys(e).forEach(e=>{const s=t.includes(e),{namespace:r}=(0,i.parseCaipChainId)(e);(n[r]??(n[r]={}))[e]=s}),n},l=(e,t)=>{const{networkConfigurationsByChainId:n}=e,{multichainNetworkConfigurationsByChainId:s}=t;const i=[r.SolScope.Mainnet];return i.push(r.BtcScope.Mainnet),i.push(r.TrxScope.Mainnet),{enabledNetworkMap:{...o(n,a.FEATURED_NETWORK_CHAIN_IDS),...c(s,i)}}};n.NetworkEnablementControllerInit=({controllerMessenger:e,initMessenger:t,persistedState:n,getController:a})=>{const o=a("MultichainNetworkController").state,c=a("NetworkController").state,u=new s.NetworkEnablementController({messenger:e,state:{...l(c,o),...n.NetworkEnablementController}});return t.subscribe("AccountsController:selectedAccountChange",e=>{e.type===r.SolAccountType.DataAccount&&u.enableNetworkInNamespace(r.SolScope.Mainnet,i.KnownCaipNamespace.Solana)}),t.subscribe("AccountTreeController:selectedAccountGroupChange",()=>{const e=t.call("AccountTreeController:getAccountsFromSelectedAccountGroup",{scopes:[r.SolScope.Mainnet]}),n=t.call("AccountTreeController:getAccountsFromSelectedAccountGroup",{scopes:[r.BtcScope.Mainnet]}),s=t.call("AccountTreeController:getAccountsFromSelectedAccountGroup",{scopes:[r.TrxScope.Mainnet]}),i={};for(const e of Object.values(u.state.enabledNetworkMap))Object.assign(i,e);if(1===Object.keys(i).length){const t=Object.keys(i)[0];let a=!1;t===r.SolScope.Mainnet&&0===e.length&&(a=!0),t===r.BtcScope.Mainnet&&0===n.length&&(a=!0),t===r.TrxScope.Mainnet&&0===s.length&&(a=!0),a&&u.enableNetwork("0x1")}}),{controller:u}}}}},{package:"$root$",file:"app/scripts/controller-init/assets/network-enablement-controller-init.ts"}],[260,{"webextension-polyfill":5763},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.CronjobControllerStorageManager=n.CronjobControllerStorageKey=void 0;var s,r=(s=e("webextension-polyfill"))&&s.__esModule?s:{default:s};function i(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function a(e,t){return e.get(c(e,t))}function o(e,t,n){return e.set(c(e,t),n),n}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}const l=n.CronjobControllerStorageKey="temp-cronjob-storage";var u=new WeakMap,d=new WeakMap;n.CronjobControllerStorageManager=class{constructor(){i(this,u,null),i(this,d,!1)}async init(){o(u,this,(await r.default.storage.local.get(l))[l]),o(d,this,!0)}getInitialState(){if(!a(d,this))throw new Error("CronjobControllerStorageManager not yet initialized");return a(u,this)}set(e){if(!a(d,this))throw new Error("CronjobControllerStorageManager not yet initialized");r.default.storage.local.set({[l]:e}).catch(console.error)}}}}},{package:"$root$",file:"app/scripts/lib/CronjobControllerStorageManager.ts"}],[261,{"./state-utils":344,"@metamask/utils":3116,lodash:4838,uuid:5734},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.PatchStore=void 0;var s=e("@metamask/utils"),r=e("uuid"),i=e("lodash"),a=e("./state-utils");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const c=(0,s.createProjectLogger)("patch-store");n.PatchStore=class{constructor(e){o(this,"id",void 0),o(this,"observableStore",void 0),o(this,"pendingPatches",[]),o(this,"listener",void 0),this.id=(0,r.v4)(),this.observableStore=e,this.listener=this._onStateChange.bind(this),this.observableStore.on("stateChange",this.listener),c("Created",this.id)}flushPendingPatches(){const e=this.pendingPatches;this.pendingPatches=[];for(const t of e)c("Flushed",t.path.join("."),this.id,t);return e}destroy(){this.observableStore.removeListener("stateChange",this.listener),c("Destroyed",this.id)}_onStateChange({newState:e,oldState:t,patches:n}){let s=[];if(n){const e=this._normalizeEventPatches(n,t);s=(0,a.sanitizePatches)(e??[])}else{const n=(0,a.sanitizeUIState)(e);s=this._generatePatches(t,n)}const r=Boolean(e.vault);if(r&&s.push({op:"replace",path:["isInitialized"],value:r}),s.length)for(const e of s){const t=e.path.join(".");this.pendingPatches.push(e),c("Added",t,this.id,e)}}_generatePatches(e,t){return Object.keys(t).map(n=>{const s=e[n],r=t[n];return s===r?null:{op:"replace",path:[n],value:r}}).filter(Boolean)}_normalizeEventPatches(e,t){return null==e?void 0:e.flatMap(e=>{if(e.path.length>0)return[e];return(0,i.uniq)([...Object.keys(t),...Object.keys(e.value)]).map(t=>({op:t in e.value?"replace":"remove",path:[t],...t in e.value?{value:e.value[t]}:{}}))})}}}}},{package:"$root$",file:"app/scripts/lib/PatchStore.ts"}],[262,{"@metamask/name-controller":2307,"@metamask/snaps-rpc-methods":2730,"@metamask/snaps-utils":2903,loglevel:4846},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SnapsNameProvider=void 0;var s,r=e("@metamask/name-controller"),i=e("@metamask/snaps-utils"),a=(s=e("loglevel"))&&s.__esModule?s:{default:s},o=e("@metamask/snaps-rpc-methods");function c(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function l(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){return e.get(d(e,t))}function d(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var h=new WeakMap,p=new WeakSet;function f(e){const t=u(h,this).call("PermissionController:getState").subjects;return u(h,this).call("SnapController:getAll").filter(({id:n})=>{var s;const r=null===(s=t[n])||void 0===s?void 0:s.permissions["endowment:name-lookup"];if(!r)return!1;const i=(0,o.getChainIdsCaveat)(r);return!(e&&i&&!i.includes(e))})}async function m(e,t,n){const s=e,r={chainId:t,address:n};let o,c;try{const t=await u(h,this).call("SnapController:handleRequest",{snapId:e,origin:"metamask",handler:i.HandlerType.OnNameLookup,request:{jsonrpc:"2.0",method:" ",params:r}}),n=null==t?void 0:t.resolvedDomains;o=n?[...new Set(n.map(e=>e.resolvedDomain))]:[]}catch(t){a.default.error("Snap name provider request failed",{snapId:e,request:r,error:t}),c=t}return{sourceId:s,result:{proposedNames:o,error:c}}}n.SnapsNameProvider=class{constructor({messenger:e}){var t,n,s;!function(e,t){c(e,t),t.add(e)}(this,p),l(this,"name","SnapsNameProvider"),l(this,"state",null),function(e,t,n){c(e,t),t.set(e,n)}(this,h,void 0),n=this,s=e,(t=h).set(d(t,n),s)}getMetadata(){const e=d(p,this,f).call(this);return{sourceIds:{[r.NameType.ETHEREUM_ADDRESS]:e.map(e=>e.id)},sourceLabels:e.reduce((e,t)=>{const n=u(h,this).call("SnapController:get",t.id),s=null==n?void 0:n.manifest.proposedName;return{...e,[t.id]:s||t.id}},{})}}async getProposedNames(e){const{variation:t,value:n}=e,s=`eip155:${parseInt(t,16)}`,r=d(p,this,f).call(this,s);return{results:(await Promise.all(r.map(e=>d(p,this,m).call(this,e.id,s,n)))).reduce((e,t)=>{const{sourceId:n,result:s}=t;return{...e,[n]:s}},{})}}}}}},{package:"$root$",file:"app/scripts/lib/SnapsNameProvider.ts"}],[2623,{"@metamask/base-controller":1362,"@metamask/swappable-obj-proxy":2945},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,i,a,o,c,l=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},u=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.SelectedNetworkController=n.SelectedNetworkControllerEventTypes=n.SelectedNetworkControllerActionTypes=n.METAMASK_DOMAIN=void 0;const d=e("@metamask/base-controller"),h=e("@metamask/swappable-obj-proxy"),p="SelectedNetworkController",f={domains:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0}};n.METAMASK_DOMAIN="metamask",n.SelectedNetworkControllerActionTypes={getState:`${p}:getState`,getNetworkClientIdForDomain:`${p}:getNetworkClientIdForDomain`,setNetworkClientIdForDomain:`${p}:setNetworkClientIdForDomain`},n.SelectedNetworkControllerEventTypes={stateChange:`${p}:stateChange`};class m extends d.BaseController{constructor({messenger:e,state:t={domains:{}},domainProxyMap:n}){super({name:p,metadata:f,messenger:e,state:t}),s.add(this),r.set(this,void 0),l(this,r,n,"f"),u(this,s,"m",i).call(this),this.messenger.call("PermissionController:getSubjectNames").filter(e=>this.state.domains[e]===undefined).forEach(e=>this.setNetworkClientIdForDomain(e,this.messenger.call("NetworkController:getState").selectedNetworkClientId)),this.messenger.subscribe("PermissionController:stateChange",(e,t)=>{t.forEach(({op:e,path:t})=>{if("subjects"===t[0]&&t[1]!==undefined&&"string"==typeof t[1]){const n=t[1];"add"===e&&this.state.domains[n]===undefined?this.setNetworkClientIdForDomain(n,this.messenger.call("NetworkController:getState").selectedNetworkClientId):"remove"===e&&this.state.domains[n]!==undefined&&u(this,s,"m",o).call(this,n)}})}),this.messenger.subscribe("NetworkController:stateChange",({selectedNetworkClientId:e,networkConfigurationsByChainId:t},n)=>{const s=n.find(({op:e,path:t})=>("replace"===e||"remove"===e)&&"networkConfigurationsByChainId"===t[0]);if(s){const n=Object.values(t).reduce((e,t)=>(t.rpcEndpoints.forEach(({networkClientId:n})=>e[n]=t.chainId),e),{});Object.entries(this.state.domains).forEach(([r,i])=>{const a=n[i];if("remove"!==s.op||a){if("replace"===s.op){const e=s.path[1];if(!a||a===e){const n=t[e],{networkClientId:s}=n.rpcEndpoints[n.defaultRpcEndpointIndex];i!==s&&this.setNetworkClientIdForDomain(r,s)}}}else this.setNetworkClientIdForDomain(r,e)})}})}setNetworkClientIdForDomain(e,t){if(e===n.METAMASK_DOMAIN)throw new Error(`NetworkClientId for domain "${n.METAMASK_DOMAIN}" cannot be set on the SelectedNetworkController`);if(!u(this,s,"m",c).call(this,e))throw new Error("NetworkClientId for domain cannot be called with a domain that has not yet been granted permissions");u(this,s,"m",a).call(this,e,t)}getNetworkClientIdForDomain(e){const{selectedNetworkClientId:t}=this.messenger.call("NetworkController:getState");return this.state.domains[e]??t}getProviderAndBlockTracker(e){if(e===n.METAMASK_DOMAIN){const e=this.messenger.call("NetworkController:getSelectedNetworkClient");if(e===undefined)throw new Error("Selected network not initialized");return e}let t=u(this,r,"f").get(e);if(t===undefined){let n;if(u(this,s,"m",c).call(this,e)){const t=this.getNetworkClientIdForDomain(e);n=this.messenger.call("NetworkController:getNetworkClientById",t)}else if(n=this.messenger.call("NetworkController:getSelectedNetworkClient"),n===undefined)throw new Error("Selected network not initialized");t={provider:(0,h.createEventEmitterProxy)(n.provider),blockTracker:(0,h.createEventEmitterProxy)(n.blockTracker,{eventFilter:"skipInternal"})},u(this,r,"f").set(e,t)}return t}}n.SelectedNetworkController=m,r=new WeakMap,s=new WeakSet,i=function(){this.messenger.registerActionHandler(n.SelectedNetworkControllerActionTypes.getNetworkClientIdForDomain,this.getNetworkClientIdForDomain.bind(this)),this.messenger.registerActionHandler(n.SelectedNetworkControllerActionTypes.setNetworkClientIdForDomain,this.setNetworkClientIdForDomain.bind(this))},a=function(e,t){const n=this.messenger.call("NetworkController:getNetworkClientById",t);this.update(n=>{n.domains[e]=t});const s=this.getProviderAndBlockTracker(e);s.provider.setTarget(n.provider),s.blockTracker.setTarget(n.blockTracker)},o=function(e){const t=this.messenger.call("NetworkController:getSelectedNetworkClient"),n=u(this,r,"f").get(e);n&&t?(n.provider.setTarget(t.provider),n.blockTracker.setTarget(t.blockTracker)):n&&u(this,r,"f").delete(e),this.update(t=>{delete t.domains[e]})},c=function(e){return this.messenger.call("PermissionController:hasPermissions",e)}}}},{package:"@metamask/selected-network-controller",file:"node_modules/@metamask/selected-network-controller/dist/SelectedNetworkController.cjs"}],[2624,{"./SelectedNetworkController.cjs":2623},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createSelectedNetworkMiddleware=void 0;const s=e("./SelectedNetworkController.cjs");n.createSelectedNetworkMiddleware=e=>(t,n,r)=>{if(!t.origin)throw new Error("Request object is lacking an 'origin'");var i;return t.networkClientId=(i=t.origin,e.call(s.SelectedNetworkControllerActionTypes.getNetworkClientIdForDomain,i)),r()}}}},{package:"@metamask/selected-network-controller",file:"node_modules/@metamask/selected-network-controller/dist/SelectedNetworkMiddleware.cjs"}],[2625,{"./SelectedNetworkController.cjs":2623,"./SelectedNetworkMiddleware.cjs":2624},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createSelectedNetworkMiddleware=n.METAMASK_DOMAIN=n.SelectedNetworkController=n.SelectedNetworkControllerEventTypes=n.SelectedNetworkControllerActionTypes=void 0;var s=e("./SelectedNetworkController.cjs");Object.defineProperty(n,"SelectedNetworkControllerActionTypes",{enumerable:!0,get:function(){return s.SelectedNetworkControllerActionTypes}}),Object.defineProperty(n,"SelectedNetworkControllerEventTypes",{enumerable:!0,get:function(){return s.SelectedNetworkControllerEventTypes}}),Object.defineProperty(n,"SelectedNetworkController",{enumerable:!0,get:function(){return s.SelectedNetworkController}}),Object.defineProperty(n,"METAMASK_DOMAIN",{enumerable:!0,get:function(){return s.METAMASK_DOMAIN}});var r=e("./SelectedNetworkMiddleware.cjs");Object.defineProperty(n,"createSelectedNetworkMiddleware",{enumerable:!0,get:function(){return r.createSelectedNetworkMiddleware}})}}},{package:"@metamask/selected-network-controller",file:"node_modules/@metamask/selected-network-controller/dist/index.cjs"}],[2626,{"./constants.cjs":2628,"./logger.cjs":2630,"@metamask/base-controller":1362,"@metamask/signature-controller":2633,"@metamask/transaction-controller":2994,lodash:4838},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,i,a,o,c,l,u,d,h,p,f,m,g,w,b=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},v=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.ShieldController=n.getDefaultShieldControllerState=void 0;const S=e("@metamask/base-controller"),y=e("@metamask/signature-controller"),k=e("@metamask/transaction-controller"),T=e("lodash"),E=e("./constants.cjs"),I=e("./logger.cjs"),M=(0,I.createModuleLogger)(I.projectLogger,"ShieldController");function _(){return{coverageResults:{},orderedTransactionHistory:[]}}n.getDefaultShieldControllerState=_;const C={coverageResults:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!0},orderedTransactionHistory:{includeInStateLogs:!0,persist:!0,includeInDebugSnapshot:!1,usedInUi:!1}};class A extends S.BaseController{constructor(e){const{messenger:t,state:n,backend:p,transactionHistoryLimit:f=100,coverageHistoryLimit:m=10,normalizeSignatureRequest:g}=e;super({name:E.controllerName,metadata:C,messenger:t,state:{coverageResults:{},orderedTransactionHistory:[],...n}}),s.add(this),r.set(this,void 0),i.set(this,void 0),a.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),b(this,r,p,"f"),b(this,i,m,"f"),b(this,a,f,"f"),b(this,c,v(this,s,"m",h).bind(this),"f"),b(this,l,v(this,s,"m",d).bind(this),"f"),b(this,u,!1,"f"),b(this,o,g,"f")}start(){v(this,u,"f")||(b(this,u,!0,"f"),this.messenger.subscribe("TransactionController:stateChange",v(this,c,"f"),e=>e.transactions),this.messenger.subscribe("SignatureController:stateChange",v(this,l,"f"),e=>e.signatureRequests))}stop(){v(this,u,"f")&&(b(this,u,!1,"f"),this.messenger.unsubscribe("TransactionController:stateChange",v(this,c,"f")),this.messenger.unsubscribe("SignatureController:stateChange",v(this,l,"f")))}async checkCoverage(e){const t=v(this,s,"m",w).call(this,e.id),n=await v(this,r,"f").checkCoverage({txMeta:e,coverageId:t});return this.messenger.publish(`${E.controllerName}:coverageResultReceived`,n),v(this,s,"m",p).call(this,e.id,n),n}async checkSignatureCoverage(e){const t=v(this,s,"m",w).call(this,e.id),n=(0,T.cloneDeep)(e),i=v(this,o,"f")?.call(this,n)??n,a=await v(this,r,"f").checkSignatureCoverage({signatureRequest:i,coverageId:t});return this.messenger.publish(`${E.controllerName}:coverageResultReceived`,a),v(this,s,"m",p).call(this,e.id,a),a}}n.ShieldController=A,r=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,s=new WeakSet,d=function(e,t){const n=Object.values(e),r=Object.values(t??{}),i=new Map(r.map(e=>[e.id,e]));for(const e of n){const t=i.get(e.id);t||this.checkSignatureCoverage(e).catch(e=>M("Error checking coverage:",e)),e.status===y.SignatureRequestStatus.Signed&&e.status!==t?.status&&v(this,s,"m",f).call(this,e).catch(e=>M("Error logging signature:",e))}},h=function(e,t){const n=new Map(t?.map(e=>[e.id,e])??[]);for(const t of e){const e=n.get(t.id);if(t.status!==k.TransactionStatus.submitted&&t.status!==k.TransactionStatus.confirmed){const n=e?.simulationData&&!(0,T.isEqual)(t.simulationData,e.simulationData);e&&!n||this.checkCoverage(t).catch(e=>M("Error checking coverage:",e))}t.status===k.TransactionStatus.submitted&&t.status!==e?.status&&v(this,s,"m",m).call(this,t).catch(e=>M("Error logging transaction:",e))}},p=function(e,t){const n=v(this,s,"m",w).call(this,e);if(n&&t.coverageId!==n)throw new Error("Coverage ID has changed");this.update(n=>{let s=!1,r=n.coverageResults[e];r||(s=!0,r={results:[]},n.coverageResults[e]=r),r.results.length>=v(this,i,"f")&&r.results.pop(),r.results.unshift(t);const{orderedTransactionHistory:o}=n;let c;s&&(o.length>=v(this,a,"f")&&(c=o.pop(),c&&delete n.coverageResults[c]),o.unshift(e))})},f=async function(e){const t=e.rawSig;if(!t)throw new Error("Signature not found");const{status:n}=v(this,s,"m",g).call(this,e.id);await v(this,r,"f").logSignature({signatureRequest:e,signature:t,status:n})},m=async function(e){const t=e.hash;if(!t)throw new Error("Transaction hash not found");const n=e.rawTx;if(!n)throw new Error("Raw transaction hex not found");const{status:i}=v(this,s,"m",g).call(this,e.id);await v(this,r,"f").logTransaction({txMeta:e,transactionHash:t,rawTransactionHex:n,status:i})},g=function(e){let t="shown";return v(this,s,"m",w).call(this,e)||(M("Coverage ID not found for",e),t="not_shown"),{status:t}},w=function(e){return this.state.coverageResults[e]?.results[0]?.coverageId}}}},{package:"@metamask/shield-controller",file:"node_modules/@metamask/shield-controller/dist/ShieldController.cjs"}],[2627,{"./constants.cjs":2628,"./polling-with-policy.cjs":2631,"@metamask/controller-utils":1449,"@metamask/signature-controller":2633},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,i,a,o,c,l,u,d,h=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n},p=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.parseSignatureRequestMethod=n.makeInitCoverageCheckBody=n.ShieldRemoteBackend=void 0;const f=e("@metamask/controller-utils"),m=e("@metamask/signature-controller"),g=e("./constants.cjs"),w=e("./polling-with-policy.cjs");function b(e){return{txParams:[{authorizationList:e.txParams.authorizationList,from:e.txParams.from,to:e.txParams.to,value:e.txParams.value,data:e.txParams.data,nonce:e.txParams.nonce}],chainId:e.chainId,origin:e.origin}}function v(e){const t=S(e);return{chainId:e.chainId,data:e.messageParams.data,from:e.messageParams.from,method:t,origin:e.messageParams.origin}}function S(e){if(e.type===m.SignatureRequestType.TypedSign)switch(e.version){case g.SignTypedDataVersion.V3:return m.EthMethod.SignTypedDataV3;case g.SignTypedDataVersion.V4:return m.EthMethod.SignTypedDataV4;case g.SignTypedDataVersion.V1:default:return m.SignatureRequestType.TypedSign}return e.type}function y(e,t){const n=new Error(e);return n.cause=t,n}n.ShieldRemoteBackend=class{constructor({getAccessToken:e,getCoverageResultTimeout:t=5e3,getCoverageResultPollInterval:n=1e3,baseUrl:l,fetch:u,captureException:d}){s.add(this),r.set(this,void 0),i.set(this,void 0),a.set(this,void 0),o.set(this,void 0),c.set(this,void 0),h(this,r,e,"f"),h(this,i,l,"f"),h(this,a,u,"f");const{backoff:p,maxRetries:m}=function(e,t){const n=new f.ConstantBackoff(t),s=Math.floor(e/t)+1,r=isNaN(s)||!isFinite(s)?f.DEFAULT_MAX_RETRIES:s;return{backoff:n,maxRetries:r}}(t,n);h(this,o,new w.PollingWithCockatielPolicy({backoff:p,maxRetries:m}),"f"),h(this,c,e=>{try{d?.(e)}catch{}},"f")}async checkCoverage(e){let{coverageId:t}=e;if(!t){const n=b(e.txMeta);({coverageId:t}=await p(this,s,"m",l).call(this,"v1/transaction/coverage/init",n))}const n=`${p(this,i,"f")}/v1/transaction/coverage/result`,r=await p(this,s,"m",u).call(this,e.txMeta.id,t,n);return{coverageId:t,message:r.message,reasonCode:r.reasonCode,status:r.status,metrics:r.metrics}}async checkSignatureCoverage(e){let{coverageId:t}=e;if(!t){const n=v(e.signatureRequest);({coverageId:t}=await p(this,s,"m",l).call(this,"v1/signature/coverage/init",n))}const n=`${p(this,i,"f")}/v1/signature/coverage/result`,r=await p(this,s,"m",u).call(this,e.signatureRequest.id,t,n);return{coverageId:t,message:r.message,reasonCode:r.reasonCode,status:r.status,metrics:r.metrics}}async logSignature(e){try{const t=v(e.signatureRequest),n={signature:e.signature,status:e.status,...t};p(this,o,"f").abortPendingRequest(e.signatureRequest.id);const r=await p(this,a,"f").call(this,`${p(this,i,"f")}/v1/signature/coverage/log`,{method:"POST",headers:await p(this,s,"m",d).call(this),body:JSON.stringify(n)});if(200!==r.status)throw new Error(`Failed to log signature: ${r.status}`)}catch(e){const t=y("Failed to log signature",e);throw p(this,c,"f")?.call(this,t),e}}async logTransaction(e){try{const t=b(e.txMeta),n={transactionHash:e.transactionHash,rawTransactionHex:e.rawTransactionHex,status:e.status,...t};p(this,o,"f").abortPendingRequest(e.txMeta.id);const r=await p(this,a,"f").call(this,`${p(this,i,"f")}/v1/transaction/coverage/log`,{method:"POST",headers:await p(this,s,"m",d).call(this),body:JSON.stringify(n)});if(200!==r.status)throw new Error(`Failed to log transaction: ${r.status}`)}catch(e){const t=y("Failed to log transaction",e);throw p(this,c,"f")?.call(this,t),e}}},r=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,c=new WeakMap,s=new WeakSet,l=async function(e,t){try{const n=await p(this,a,"f").call(this,`${p(this,i,"f")}/${e}`,{method:"POST",headers:await p(this,s,"m",d).call(this),body:JSON.stringify(t)});if(200!==n.status)throw new Error(`Failed to init coverage check: ${n.status}`);return await n.json()}catch(e){const t=y("Failed to init coverage check",e);throw p(this,c,"f")?.call(this,t),e}},u=async function(e,t,n){const r={coverageId:t},i=await p(this,s,"m",d).call(this),c=Date.now();return{...await p(this,o,"f").start(e,async e=>{const t=await p(this,a,"f").call(this,n,{method:"POST",headers:i,body:JSON.stringify(r),signal:e});if(200===t.status)return await t.json();let s="Timeout waiting for coverage result";try{const e=await t.json();s=`Failed to get coverage result: ${e.message??e.status}`}catch{s=`Failed to get coverage result: ${t.status}`}throw new f.HttpError(t.status,s)}),metrics:{latency:Date.now()-c}}},d=async function(){return{"Content-Type":"application/json",Authorization:`Bearer ${await p(this,r,"f").call(this)}`}},n.makeInitCoverageCheckBody=b,n.parseSignatureRequestMethod=S}}},{package:"@metamask/shield-controller",file:"node_modules/@metamask/shield-controller/dist/backend.cjs"}],[2628,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s;Object.defineProperty(n,"__esModule",{value:!0}),n.SignTypedDataVersion=n.controllerName=void 0,n.controllerName="ShieldController",function(e){e.V1="V1",e.V3="V3",e.V4="V4"}(s||(n.SignTypedDataVersion=s={}))}}},{package:"@metamask/shield-controller",file:"node_modules/@metamask/shield-controller/dist/constants.cjs"}],[2629,{"./ShieldController.cjs":2626,"./backend.cjs":2627},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.parseSignatureRequestMethod=n.ShieldRemoteBackend=n.getDefaultShieldControllerState=n.ShieldController=void 0;var s=e("./ShieldController.cjs");Object.defineProperty(n,"ShieldController",{enumerable:!0,get:function(){return s.ShieldController}}),Object.defineProperty(n,"getDefaultShieldControllerState",{enumerable:!0,get:function(){return s.getDefaultShieldControllerState}});var r=e("./backend.cjs");Object.defineProperty(n,"ShieldRemoteBackend",{enumerable:!0,get:function(){return r.ShieldRemoteBackend}}),Object.defineProperty(n,"parseSignatureRequestMethod",{enumerable:!0,get:function(){return r.parseSignatureRequestMethod}})}}},{package:"@metamask/shield-controller",file:"node_modules/@metamask/shield-controller/dist/index.cjs"}],[263,{"../../../shared/constants/onboarding":5798,"../../../shared/lib/wallet-funds-obtained-metric":5905,"@metamask/notification-services-controller/notification-services":2362,loglevel:4846},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.WalletFundsObtainedMonitor=void 0;var s,r=e("@metamask/notification-services-controller/notification-services"),i=(s=e("loglevel"))&&s.__esModule?s:{default:s},a=e("../../../shared/lib/wallet-funds-obtained-metric"),o=e("../../../shared/constants/onboarding");function c(e,t,n){l(e,t),t.set(e,n)}function l(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function u(e,t){return e.get(h(e,t))}function d(e,t,n){return e.set(h(e,t),n),n}function h(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var p=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakSet;function w(){try{const e=u(p,this).call("TokenBalancesController:getState"),t=u(p,this).call("MultichainBalancesController:getState");return(0,a.hasNonZeroTokenBalance)(e.tokenBalances)||(0,a.hasNonZeroMultichainBalance)(t.balances)}catch(e){return i.default.error("Error checking for existing funds: ",e),!1}}function b(){return e=>{const t=e.filter(e=>e.type===r.TRIGGER_TYPES.ERC20_RECEIVED||e.type===r.TRIGGER_TYPES.ETH_RECEIVED);if(t.length<1)return;const n=t.at(-1);if(!n)return;const{payload:{chain_id:s}}=n,i=n.type===r.TRIGGER_TYPES.ERC20_RECEIVED?n.payload.data.token.usd:n.payload.data.amount.usd;s&&i&&(u(p,this).call("MetaMetricsController:trackEvent",(0,a.getWalletFundsObtainedEventProperties)({chainId:s,amountUsd:i})),u(p,this).call("AppStateController:setCanTrackWalletFundsObtained",!1),u(m,this)&&(u(p,this).unsubscribe("NotificationServicesController:notificationsListUpdated",u(m,this)),d(m,this,null)))}}n.WalletFundsObtainedMonitor=class{constructor({messenger:e}){!function(e,t){l(e,t),t.add(e)}(this,g),c(this,p,void 0),c(this,f,!1),c(this,m,null),d(p,this,e)}setupMonitoring(){if(u(f,this))return;const e=u(p,this).call("OnboardingController:getState"),{firstTimeFlowType:t}=e;if(t!==o.FirstTimeFlowType.create&&t!==o.FirstTimeFlowType.socialCreate)return void u(p,this).call("AppStateController:setCanTrackWalletFundsObtained",!1);u(p,this).call("NotificationServicesController:getState").isNotificationServicesEnabled?h(g,this,w).call(this)?u(p,this).call("AppStateController:setCanTrackWalletFundsObtained",!1):(d(m,this,h(g,this,b).call(this)),u(p,this).subscribe("NotificationServicesController:notificationsListUpdated",u(m,this)),d(f,this,!0)):u(p,this).call("AppStateController:setCanTrackWalletFundsObtained",!1)}}}}},{package:"$root$",file:"app/scripts/lib/WalletFundsObtainedMonitor.ts"}],[2630,{"./constants.cjs":2628,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createModuleLogger=n.projectLogger=void 0;const s=e("@metamask/utils");Object.defineProperty(n,"createModuleLogger",{enumerable:!0,get:function(){return s.createModuleLogger}});const r=e("./constants.cjs");n.projectLogger=(0,s.createProjectLogger)(r.controllerName)}}},{package:"@metamask/shield-controller",file:"node_modules/@metamask/shield-controller/dist/logger.cjs"}],[2631,{"@metamask/controller-utils":1449,cockatiel:4144},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,r,i,a,o,c,l=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)},u=this&&this.__classPrivateFieldSet||function(e,t,n,s,r){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?r.call(e,n):r?r.value=n:t.set(e,n),n};Object.defineProperty(n,"__esModule",{value:!0}),n.PollingWithCockatielPolicy=void 0;const d=e("@metamask/controller-utils"),h=e("cockatiel");n.PollingWithCockatielPolicy=class{constructor(e={}){s.add(this),r.set(this,void 0),i.set(this,new Map);const t=l(this,s,"m",c).bind(this),n=(0,h.handleWhen)(t);u(this,r,(0,d.createServicePolicy)({...e,retryFilterPolicy:n}),"f")}async start(e,t){const n=l(this,s,"m",a).call(this,e);try{return await l(this,r,"f").execute(async({signal:e})=>t(e),n.signal)}catch(e){if(n.signal.aborted)throw new Error("Request cancelled");throw e}finally{n===l(this,i,"f").get(e)&&l(this,s,"m",o).call(this,e)}}abortPendingRequest(e){const t=l(this,i,"f").get(e);t?.abort(),l(this,s,"m",o).call(this,e)}},r=new WeakMap,i=new WeakMap,s=new WeakSet,a=function(e){this.abortPendingRequest(e);const t=new AbortController;return l(this,i,"f").set(e,t),t},o=function(e){l(this,i,"f").delete(e)},c=function(e){return e instanceof d.HttpError&&(e.httpStatus>400&&e.httpStatus<500)}}}},{package:"@metamask/shield-controller",file:"node_modules/@metamask/shield-controller/dist/polling-with-policy.cjs"}],[264,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.WeakRefObjectMap=void 0;class r{constructor(){s(this,"map",void 0),this.map=new Map}set(e,t){const n={};for(const e in t){if(!Object.prototype.hasOwnProperty.call(t,e))continue;const s=t[e];if("object"!=typeof s||null===s)throw new Error(`Property ${String(e)} is not an object and cannot be weakly referenced.`);n[e]=new WeakRef(s)}return this.map.set(e,n),this}get(e){const t=this.map.get(e);if(!t)return undefined;const n={};for(const s in t){if(!Object.prototype.hasOwnProperty.call(t,s))continue;const r=t[s].deref();if(r===undefined)return this.map.delete(e),undefined;n[s]=r}return n}has(e){return this.get(e)!==undefined}delete(e){return this.get(e)!==undefined&&this.map.delete(e)}clear(){this.map.clear()}get size(){return this.map.size}entries(){const e=[];return this.map.forEach((t,n)=>{const s=this.get(n);s!==undefined&&e.push([n,s])}),e.values()}keys(){return this.map.keys()}values(){const e=[];return this.map.forEach((t,n)=>{const s=this.get(n);s!==undefined&&e.push(s)}),e.values()}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return"WeakRefObjectMap"}forEach(e,t){this.map.forEach((n,s)=>{const r=this.get(s);r!==undefined&&(t?e.call(t,r,s,this):e(r,s,this))})}}n.WeakRefObjectMap=r}}},{package:"$root$",file:"app/scripts/lib/WeakRefObjectMap.ts"}],[265,{"../../../../shared/constants/app":5775,"@metamask/controller-utils":1449,"@metamask/rpc-errors":2600,"@metamask/snaps-rpc-methods":2730,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.rejectAllApprovals=function({approvalController:e,deleteInterface:t}){const n=e.state.pendingApprovals,s=Object.values(n);for(const n of s)l({approvalController:e,approvalRequest:n,deleteInterface:t})},n.rejectOriginApprovals=function({approvalController:e,deleteInterface:t,origin:n}){const s=e.state.pendingApprovals,r=Object.values(s).filter(e=>e.origin===n);for(const n of r)l({approvalController:e,approvalRequest:n,deleteInterface:t})};var s=e("@metamask/controller-utils"),r=e("@metamask/snaps-rpc-methods"),i=e("@metamask/rpc-errors"),a=e("@metamask/utils"),o=e("../../../../shared/constants/app");const c=(0,a.createProjectLogger)("approval-utils");function l({approvalController:e,approvalRequest:t,deleteInterface:n}){var a;const{id:l,type:u,origin:d}=t,h=null===(a=t.requestData)||void 0===a?void 0:a.id;switch(u){case s.ApprovalType.SnapDialogAlert:case s.ApprovalType.SnapDialogPrompt:case r.DIALOG_APPROVAL_TYPES.default:c("Rejecting snap dialog",{id:l,interfaceId:h,origin:d,type:u}),e.accept(l,null),null==n||n(h);break;case s.ApprovalType.SnapDialogConfirmation:c("Rejecting snap confirmation",{id:l,interfaceId:h,origin:d,type:u}),e.accept(l,!1),null==n||n(h);break;case o.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountCreation:case o.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountRemoval:case o.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.showSnapAccountRedirect:c("Rejecting snap account confirmation",{id:l,origin:d,type:u}),e.accept(l,!1);break;default:c("Rejecting pending approval",{id:l,origin:d,type:u}),e.reject(l,i.providerErrors.userRejectedRequest({data:{cause:"rejectAllApprovals"}}))}}}}},{package:"$root$",file:"app/scripts/lib/approval/utils.ts"}],[2652,{"../snaps/Timer.cjs":2674,"../snaps/constants.cjs":2675,"./utils.cjs":2654,"@metamask/base-controller":1362,"@metamask/snaps-rpc-methods":2730,"@metamask/snaps-utils":2903,"@metamask/utils":3116,immer:4616,luxon:4849,nanoid:5037},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t){return e.get(o(e,t))}function a(e,t,n){return e.set(o(e,t),n),n}function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.CronjobController=n.DAILY_TIMEOUT=void 0;const c=e("@metamask/base-controller"),l=e("@metamask/snaps-rpc-methods"),u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),h=e("immer"),p=e("luxon"),f=e("nanoid"),m=e("./utils.cjs"),g=e("../snaps/constants.cjs"),w=e("../snaps/Timer.cjs");n.DAILY_TIMEOUT=(0,d.inMilliseconds)(24,d.Duration.Hour);const b="CronjobController";var v=new WeakMap,S=new WeakMap,y=new WeakMap,k=new WeakSet,T=new WeakMap,E=new WeakMap,I=new WeakMap,M=new WeakMap,_=new WeakMap;class C extends c.BaseController{constructor({messenger:e,state:t,stateManager:c}){var l,u;super({messenger:e,metadata:{events:{includeInStateLogs:!1,persist:!1,includeInDebugSnapshot:!1,usedInUi:!1}},name:b,state:{events:{},...t,...c.getInitialState()}}),r(l=this,u=k),u.add(l),s(this,v,void 0),s(this,S,void 0),s(this,y,new w.Timer(n.DAILY_TIMEOUT)),s(this,T,e=>{this.unregister(e.id),this.register(e.id)}),s(this,E,e=>{const t=this.get(e.id);o(k,this,x).call(this,t),this.register(e.id)}),s(this,I,e=>{this.unregister(e.id)}),s(this,M,e=>{this.unregister(e.id)}),s(this,_,e=>{this.unregister(e.id),this.register(e.id)}),a(v,this,new Map),a(S,this,c),this.messenger.subscribe("SnapController:snapInstalled",i(T,this)),this.messenger.subscribe("SnapController:snapUninstalled",i(I,this)),this.messenger.subscribe("SnapController:snapEnabled",i(E,this)),this.messenger.subscribe("SnapController:snapDisabled",i(M,this)),this.messenger.subscribe("SnapController:snapUpdated",i(_,this)),this.messenger.registerActionHandler(`${b}:init`,(...e)=>this.init(...e)),this.messenger.registerActionHandler(`${b}:schedule`,(...e)=>this.schedule(...e)),this.messenger.registerActionHandler(`${b}:cancel`,(...e)=>this.cancel(...e)),this.messenger.registerActionHandler(`${b}:get`,(...e)=>this.get(...e))}init(){o(k,this,A).call(this),o(k,this,F).call(this),o(k,this,x).call(this)}schedule(e){return o(k,this,P).call(this,{...e,recurring:!1})}cancel(e,t){(0,d.assert)(this.state.events[t],`A background event with the id of "${t}" does not exist.`),(0,d.assert)(this.state.events[t].snapId===e,"Only the origin that scheduled this event can cancel it."),o(k,this,N).call(this,t)}get(e){return Object.values(this.state.events).filter(t=>t.snapId===e&&!t.recurring).map(e=>({...e,date:(0,u.toCensoredISO8601String)(e.date),scheduledAt:(0,u.toCensoredISO8601String)(e.scheduledAt)}))}register(e){const t=o(k,this,D).call(this,e);null==t||t.forEach(e=>o(k,this,P).call(this,e))}unregister(e){for(const[t,n]of Object.entries(this.state.events))n.snapId===e&&o(k,this,N).call(this,t)}destroy(){super.destroy(),this.messenger.unsubscribe("SnapController:snapInstalled",i(T,this)),this.messenger.unsubscribe("SnapController:snapUninstalled",i(I,this)),this.messenger.unsubscribe("SnapController:snapEnabled",i(E,this)),this.messenger.unsubscribe("SnapController:snapDisabled",i(M,this)),this.messenger.unsubscribe("SnapController:snapUpdated",i(_,this)),i(v,this).forEach(e=>e.cancel()),i(v,this).clear(),"running"===i(y,this).status&&i(y,this).cancel()}}function A(){a(y,this,new w.Timer(n.DAILY_TIMEOUT)),i(y,this).start(()=>{o(k,this,x).call(this),o(k,this,A).call(this)})}function P(e){const t=e.id??(0,f.nanoid)(),n={...e,id:t,date:(0,m.getExecutionDate)(e.schedule),scheduledAt:(new Date).toISOString()},{nextState:s}=this.update(e=>{e.events[n.id]=(0,h.castDraft)(n)});return i(S,this).set(s),o(k,this,O).call(this,n),t}function O(e,t=!0){if(!t)return void o(k,this,j).call(this,e);const n=(0,m.getExecutionDate)(e.schedule),{nextState:s}=this.update(t=>{t.events[e.id].date=n});i(S,this).set(s),o(k,this,j).call(this,{...e,date:n})}function j(e){const t=p.DateTime.fromISO(e.date,{setZone:!0}).toMillis()-Date.now();if(t>n.DAILY_TIMEOUT)return;if(t<=0)return void o(k,this,R).call(this,e);const s=new w.Timer(t);s.start(()=>{o(k,this,R).call(this,e)}),i(v,this).set(e.id,s)}function R(e){if(this.messenger.call("SnapController:handleRequest",{snapId:e.snapId,origin:g.METAMASK_ORIGIN,handler:u.HandlerType.OnCronjob,request:e.request}).catch(t=>{(0,u.logError)(`An error occurred while executing an event for Snap "${e.snapId}":`,t)}),i(v,this).delete(e.id),!e.recurring){const{nextState:t}=this.update(t=>{delete t.events[e.id]});return void i(S,this).set(t)}o(k,this,O).call(this,e)}function N(e){const t=i(v,this).get(e);null==t||t.cancel(),i(v,this).delete(e);const{nextState:n}=this.update(t=>{delete t.events[e]});i(S,this).set(n)}function D(e){const t=this.messenger.call("PermissionController:getPermissions",e),n=null==t?void 0:t[l.SnapEndowments.Cronjob],s=(0,l.getCronjobCaveatJobs)(n);return s?s.map((t,n)=>({snapId:e,id:`cronjob-${e}-${n}`,request:t.request,schedule:(0,m.getCronjobSpecificationSchedule)(t),recurring:!0})):[]}function x(e=Object.values(this.state.events)){const t=Date.now();for(const n of e){if(i(v,this).has(n.id))continue;const e=p.DateTime.fromISO(n.date,{setZone:!0}).toUTC().toMillis();n.recurring&&e<=t?o(k,this,R).call(this,n):o(k,this,O).call(this,n,!1)}}function F(){const e=Date.now();for(const t of Object.values(this.state.events)){const n=p.DateTime.fromISO(t.date,{setZone:!0}).toUTC().toMillis();!t.recurring&&n<e&&o(k,this,N).call(this,t.id)}}n.CronjobController=C}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/cronjob/CronjobController.cjs"}],[2653,{"./CronjobController.cjs":2652},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./CronjobController.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/cronjob/index.cjs"}],[2654,{"@metamask/utils":3116,"cron-parser":4189,luxon:4849},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getExecutionDate=n.getCronjobSpecificationSchedule=void 0;const s=e("@metamask/utils"),r=e("cron-parser"),i=e("luxon");n.getCronjobSpecificationSchedule=function(e){return(0,s.hasProperty)(e,"duration")?e.duration:e.expression},n.getExecutionDate=function(e){const t=i.DateTime.fromISO(e,{setZone:!0});if(t.isValid){const e=Date.now(),n=t.toUTC().startOf("second");if(n.toMillis()<e)throw new Error("Cannot schedule an event in the past.");return n.toISO({suppressMilliseconds:!0})}const n=i.Duration.fromISO(e);if(n.isValid){const e=function(e){return e.as("seconds")<1?i.Duration.fromObject({seconds:1}):e}(n);return i.DateTime.now().toUTC().plus(e).toISO()}try{const t=(0,r.parseExpression)(e,{utc:!0}).next(),n=i.DateTime.fromJSDate(t.toDate());return(0,s.assert)(n.isValid),n.toUTC().toISO()}catch{throw new Error(`Unable to parse "${e}" as ISO 8601 date, ISO 8601 duration, or cron expression.`)}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/cronjob/utils.cjs"}],[2655,{"@metamask/utils":3116,"@xstate/fsm":3589},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.forceStrict=n.validateMachine=void 0;const s=e("@metamask/utils"),r=e("@xstate/fsm");n.validateMachine=function(e){(0,s.assert)("_options"in e,"The machine is not an @xstate/fsm machine");const t=e,n=new Set,r=e=>{return(t=e,Array.isArray(t)?t:t===undefined||null===t?[]:[t]).flatMap(e=>"string"==typeof e?[e]:((0,s.assert)("function"==typeof e),[])).forEach(n.add.bind(n));var t};for(const e of Object.values(t.config.states)){r(e.entry),r(e.exit);for(const t of Object.values(e.on??{}))r(t.actions)}n.forEach(e=>(0,s.assert)(t._options.actions!==undefined&&e in t._options.actions,`Action "${e}" doesn't have an implementation`))},n.forceStrict=function(e){let t=!1;e.subscribe(e=>{(0,s.assert)(!t||e.changed,"Invalid state transition"),t=!0});const n=e.send.bind(e);e.send=(...t)=>((0,s.assert)(e.status===r.InterpreterStatus.Running,"Interpreter is stopped"),n(...t))}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/fsm.cjs"}],[2656,{"./cronjob/index.cjs":2653,"./insights/index.cjs":2658,"./interface/index.cjs":2660,"./multichain/index.cjs":2664,"./services/index.cjs":2669,"./snaps/index.cjs":2676,"./utils.cjs":2686,"./websocket/index.cjs":2688},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./services/index.cjs"),n),r(e("./snaps/index.cjs"),n),r(e("./utils.cjs"),n),r(e("./cronjob/index.cjs"),n),r(e("./interface/index.cjs"),n),r(e("./insights/index.cjs"),n),r(e("./multichain/index.cjs"),n),r(e("./websocket/index.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/index.cjs"}],[2657,{"../snaps/index.cjs":2676,"@metamask/base-controller":1362,"@metamask/snaps-rpc-methods":2730,"@metamask/snaps-utils":2903,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function r(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.SnapInsightsController=void 0;const i=e("@metamask/base-controller"),a=e("@metamask/snaps-rpc-methods"),o=e("@metamask/snaps-utils"),c=e("@metamask/utils"),l=e("../snaps/index.cjs");var u=new WeakSet;class d extends i.BaseController{constructor({messenger:e,state:t}){super({messenger:e,metadata:{insights:{includeInStateLogs:!0,persist:!1,includeInDebugSnapshot:!1,usedInUi:!0}},name:"SnapInsightsController",state:{insights:{},...t}}),s(this,u),this.messenger.subscribe("TransactionController:unapprovedTransactionAdded",r(u,this,f).bind(this)),this.messenger.subscribe("TransactionController:transactionStatusUpdated",r(u,this,w).bind(this)),this.messenger.subscribe("SignatureController:stateChange",r(u,this,m).bind(this))}}function h(e){return(0,c.hasProperty)(this.state.insights,e)}function p(e){const t=this.messenger.call("SnapController:getAll");return(0,l.getRunnableSnaps)(t).reduce((t,n)=>{const s=this.messenger.call("PermissionController:getPermissions",n.id);return s&&(0,c.hasProperty)(s,e)&&t.push({snapId:n.id,permission:s[e]}),t},[])}function f(e){const{id:t,txParams:n,chainId:s,origin:i}=e,l=`eip155:${(0,c.hexToBigInt)(s).toString(10)}`;r(u,this,p).call(this,a.SnapEndowments.TransactionInsight).forEach(({snapId:e,permission:s})=>{const c=(0,a.getTransactionOriginCaveat)(s)&&i?i:null;this.update(n=>{var s;(s=n.insights)[t]??(s[t]={}),n.insights[t][e]={snapId:e,loading:!0}}),r(u,this,v).call(this,{snapId:e,handler:o.HandlerType.OnTransaction,params:{transaction:n,chainId:l,transactionOrigin:c}}).then(n=>r(u,this,S).call(this,{id:t,snapId:e,response:n})).catch(n=>r(u,this,S).call(this,{id:t,snapId:e,error:n}))})}function m(e){for(const t of Object.keys(this.state.insights))(0,c.hasProperty)(e.unapprovedTypedMessages,t)||(0,c.hasProperty)(e.unapprovedPersonalMsgs,t)||r(u,this,b).call(this,t);if(e.unapprovedPersonalMsgCount>0||e.unapprovedTypedMessagesCount>0){const t=r(u,this,p).call(this,a.SnapEndowments.SignatureInsight);for(const n of Object.values(e.unapprovedPersonalMsgs))r(u,this,g).call(this,t,n);for(const n of Object.values(e.unapprovedTypedMessages))r(u,this,g).call(this,t,n)}}function g(e,t){const{id:n,msgParams:s}=t;if(r(u,this,h).call(this,n))return;const{from:i,data:c,signatureMethod:l,origin:d}=s,p={from:i,data:"eth_signTypedData_v3"===l||"eth_signTypedData_v4"===l?JSON.parse(c):c,signatureMethod:l};e.forEach(({snapId:e,permission:t})=>{const s=(0,a.getSignatureOriginCaveat)(t),i=d&&s?d:null;this.update(t=>{var s;(s=t.insights)[n]??(s[n]={}),t.insights[n][e]={snapId:e,loading:!0}}),r(u,this,v).call(this,{snapId:e,handler:o.HandlerType.OnSignature,params:{signature:p,signatureOrigin:i}}).then(t=>r(u,this,S).call(this,{id:n,snapId:e,response:t})).catch(t=>r(u,this,S).call(this,{id:n,snapId:e,error:t}))})}function w({transactionMeta:e}){"unapproved"!==e.status&&r(u,this,b).call(this,e.id)}function b(e){r(u,this,h).call(this,e)&&(Object.values(this.state.insights[e]).filter(e=>e.interfaceId).forEach(e=>{this.messenger.call("SnapInterfaceController:deleteInterface",e.interfaceId)}),this.update(t=>{delete t.insights[e]}))}async function v({snapId:e,handler:t,params:n}){return this.messenger.call("SnapController:handleRequest",{snapId:e,origin:"metamask",handler:t,request:{method:"",params:n}})}function S({id:e,snapId:t,response:n,error:s}){r(u,this,h).call(this,e)&&this.update(r=>{r.insights[e][t].loading=!1,r.insights[e][t].interfaceId=null==n?void 0:n.id,r.insights[e][t].severity=null==n?void 0:n.severity,r.insights[e][t].error=null==s?void 0:s.message})}n.SnapInsightsController=d}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/insights/SnapInsightsController.cjs"}],[2658,{"./SnapInsightsController.cjs":2657},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./SnapInsightsController.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/insights/index.cjs"}],[2659,{"./utils.cjs":2661,"@metamask/base-controller":1362,"@metamask/snaps-sdk":2786,"@metamask/snaps-utils":2903,"@metamask/utils":3116,immer:4616,nanoid:5037},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function r(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.SnapInterfaceController=void 0;const i=e("@metamask/base-controller"),a=e("@metamask/snaps-sdk"),o=e("@metamask/snaps-utils"),c=e("@metamask/utils"),l=e("immer"),u=e("nanoid"),d=e("./utils.cjs"),h=1e7,p="SnapInterfaceController";var f=new WeakSet;class m extends i.BaseController{constructor({messenger:e,state:t}){super({messenger:e,metadata:{interfaces:{includeInStateLogs:!0,persist:e=>Object.entries(e).reduce((e,[t,n])=>n.contentType===a.ContentType.Notification?(e[t]=n,e):e,{}),includeInDebugSnapshot:!1,usedInUi:!0}},name:p,state:{interfaces:{},...t}}),s(this,f),this.messenger.subscribe("NotificationServicesController:notificationsListUpdated",r(f,this,A).bind(this)),r(f,this,g).call(this)}createInterface(e,t,n,s){const i=(0,d.getJsxInterface)(t);r(f,this,C).call(this,e,i),(0,d.validateInterfaceContext)(n);const a=(0,u.nanoid)(),c=(0,d.constructState)({},i,{getAssetsState:r(f,this,I).bind(this),getAccountByAddress:r(f,this,E).bind(this),getSelectedAccount:r(f,this,k).bind(this),listAccounts:r(f,this,T).bind(this),snapOwnsAccount:t=>(0,o.snapOwnsAccount)(e,t)});return this.update(t=>{t.interfaces[a]={snapId:e,content:(0,l.castDraft)(i),state:c,context:n??null,contentType:s??null}}),a}getInterface(e,t){return r(f,this,w).call(this,e,t),this.state.interfaces[t]}updateInterface(e,t,n,s){r(f,this,w).call(this,e,t);const i=(0,d.getJsxInterface)(n);r(f,this,C).call(this,e,i),(0,d.validateInterfaceContext)(s);const a=this.state.interfaces[t].state,c=(0,d.constructState)(a,i,{getAssetsState:r(f,this,I).bind(this),getAccountByAddress:r(f,this,E).bind(this),getSelectedAccount:r(f,this,k).bind(this),listAccounts:r(f,this,T).bind(this),snapOwnsAccount:t=>(0,o.snapOwnsAccount)(e,t)});this.update(e=>{e.interfaces[t].state=c,e.interfaces[t].content=(0,l.castDraft)(i),s&&(e.interfaces[t].context=s)})}deleteInterface(e){this.update(t=>{delete t.interfaces[e]})}updateInterfaceState(e,t){this.update(n=>{n.interfaces[e].state=t})}async resolveInterface(e,t,n){r(f,this,w).call(this,e,t),r(f,this,b).call(this,t),await r(f,this,y).call(this,t,n),this.deleteInterface(t)}}function g(){this.messenger.registerActionHandler(`${p}:createInterface`,this.createInterface.bind(this)),this.messenger.registerActionHandler(`${p}:getInterface`,this.getInterface.bind(this)),this.messenger.registerActionHandler(`${p}:updateInterface`,this.updateInterface.bind(this)),this.messenger.registerActionHandler(`${p}:deleteInterface`,this.deleteInterface.bind(this)),this.messenger.registerActionHandler(`${p}:updateInterfaceState`,this.updateInterfaceState.bind(this)),this.messenger.registerActionHandler(`${p}:resolveInterface`,this.resolveInterface.bind(this))}function w(e,t){const n=this.state.interfaces[t];(0,c.assert)(n!==undefined,`Interface with id '${t}' not found.`),(0,c.assert)(n.snapId===e,`Interface not created by ${e}.`)}function b(e){(0,c.assert)(r(f,this,S).call(this,e),`Approval request with id '${e}' not found.`)}function v(e){return this.messenger.call("PhishingController:testOrigin",e).result}function S(e){return this.messenger.call("ApprovalController:hasRequest",{id:e})}async function y(e,t){await this.messenger.call("ApprovalController:acceptRequest",e,t)}function k(){return this.messenger.call("AccountsController:getSelectedMultichainAccount")}function T(e){const t=this.messenger.call("AccountsController:listMultichainAccounts");return e&&0!==e.length?t.filter(t=>t.scopes.some(t=>(0,d.isMatchingChainId)(t,e))):t}function E(e){const{address:t}=(0,c.parseCaipAccountId)(e);return this.messenger.call("AccountsController:getAccountByAddress",t)}function I(){return this.messenger.call("MultichainAssetsController:getState")}function M(e){return this.messenger.call("SnapController:get",e)}function _(e,t){return this.messenger.call("PermissionController:hasPermission",e,t)}function C(e,t){const n=(0,o.getJsonSizeUnsafe)(t);(0,c.assert)(n<=h,"A Snap UI may not be larger than 10 MB."),(0,o.validateJsxElements)(t,{isOnPhishingList:r(f,this,v).bind(this),getSnap:r(f,this,M).bind(this),getAccountByAddress:r(f,this,E).bind(this),hasPermission:r(f,this,_).bind(this,e)})}function A(e){const t=e.filter(e=>"snap"===e.type&&(0,c.hasProperty)(e.data,"detailedView")),n=new Set(t.map(e=>e.data.detailedView.interfaceId));this.update(e=>{Object.entries(e.interfaces).forEach(([t,s])=>{s.contentType!==a.ContentType.Notification||n.has(t)||delete e.interfaces[t]})})}n.SnapInterfaceController=m}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/interface/SnapInterfaceController.cjs"}],[266,{"../../../shared/modules/string-utils":5945},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=e("../../../shared/modules/string-utils");n.default=class{constructor(e={}){const{preferencesController:t,addressBookController:n,accountsController:s,networkController:r,trackMetaMetricsEvent:i}=e;this.preferencesController=t,this.accountsController=s,this.addressBookController=n,this.networkController=r,this._trackMetaMetricsEvent=i}async restoreUserData(e){const t=this.preferencesController.state,{preferences:n,addressBook:s,network:r,internalAccounts:i}=JSON.parse(e);n&&(n.identities=t.identities,n.lostIdentities=t.lostIdentities,n.selectedAddress=t.selectedAddress,this.preferencesController.update(n)),s&&this.addressBookController.update(s,!0),r&&this.networkController.loadBackup(r),i&&this.accountsController.loadBackup(i),(n||s||r||i)&&this._trackMetaMetricsEvent({event:"User Data Imported",category:"Backup"})}async backupUserData(){const e={preferences:{...this.preferencesController.state},internalAccounts:{internalAccounts:this.accountsController.state.internalAccounts},addressBook:{...this.addressBookController.state},network:{networkConfigurationsByChainId:this.networkController.state.networkConfigurationsByChainId}};delete e.preferences.identities,delete e.preferences.lostIdentities,delete e.preferences.selectedAddress;const t=JSON.stringify(e),n=new Date,r=e=>(0,s.prependZero)(e,2);return{fileName:`MetaMaskUserData.${n.getFullYear()}_${r(n.getMonth()+1)}_${r(n.getDay())}_${r(n.getHours())}_${r(n.getMinutes())}_${r(n.getDay())}.json`,data:t}}}}}},{package:"$root$",file:"app/scripts/lib/backup.js"}],[2660,{"./SnapInterfaceController.cjs":2659},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./SnapInterfaceController.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/interface/index.cjs"}],[2661,{"@metamask/snaps-sdk":2786,"@metamask/snaps-sdk/jsx":2873,"@metamask/snaps-utils":2903,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateInterfaceContext=n.constructState=n.getAccountSelectorStateValue=n.getAssetSelectorStateValue=n.getAccountSelectorDefaultStateValue=n.getDefaultAsset=n.formatAccountSelectorStateValue=n.isMatchingChainId=n.assertNameIsUnique=n.getJsxInterface=n.isStatefulComponent=void 0;const s=e("@metamask/snaps-sdk"),r=e("@metamask/snaps-sdk/jsx"),i=e("@metamask/snaps-utils"),a=e("@metamask/utils"),o=["Input","Dropdown","RadioGroup","FileInput","Checkbox","Selector","AssetSelector","AddressInput","AccountSelector","DateTimePicker"];function c(e){return o.includes(e.type)}function l(e,t){(0,s.assert)(e[t]===undefined,`Duplicate component names are not allowed, found multiple instances of: "${t}".`)}function u(e,t){return"eip155:0"===e?t.some(e=>{const{namespace:t}=(0,a.parseCaipChainId)(e);return t===a.KnownCaipNamespace.Eip155}):t.includes(e)}function d(e,t){const{id:n,address:s,scopes:r}=e,a=(0,i.createChainIdList)(r,t);return{accountId:n,addresses:(0,i.createAccountList)(s,a)}}function h(e,t,{getAccountByAddress:n,getAssetsState:r}){var i;const{assetsMetadata:o,accountsAssets:c}=r(),l=e.map(e=>(0,a.parseCaipAccountId)(e)).map(({chainId:e})=>e),u=t&&t.length>0?l.filter(e=>t.includes(e)):l,d=null===(i=n(e[0]))||void 0===i?void 0:i.id;(0,s.assert)(d,`Account not found for address: ${e[0]}.`);const h=c[d];if(0===h.length)return null;const p=h.find(e=>{const{chainId:t,assetNamespace:n}=(0,a.parseCaipAssetType)(e);return u.includes(t)&&"slip44"===n});return p?{asset:p,name:o[p].name,symbol:o[p].symbol}:{asset:h[0],name:o[h[0]].name,symbol:o[h[0]].symbol}}function p(e,{getSelectedAccount:t,listAccounts:n,snapOwnsAccount:s}){const{chainIds:r,hideExternalAccounts:i}=e.props,a=t();if((!r||0===r.length||a.scopes.some(e=>u(e,r)))&&(!i||i&&s(a)))return d(a,r);const o=n(r),c=i?o.filter(e=>s(e)):o;return 0===c.length?null:d(c[0],r)}function f(e,t){if(!e)return null;const{assetsMetadata:n}=t(),s=n[e];return s?{asset:e,name:s.name??s.symbol??"Unknown",symbol:s.symbol??"Unknown"}:null}function m(e,{getAccountByAddress:t,snapOwnsAccount:n}){const{value:s,hideExternalAccounts:r}=e.props;if(!s)return null;const i=t(s);return i?r&&!n(i)?null:d(i,e.props.chainIds):null}function g(e,t,n,s){const r=s?e[s]:e,o=null==r?void 0:r[t.props.name];return"FileInput"===t.type?o??null:function(e,t){switch(e.type){case"Checkbox":return e.props.checked;case"AssetSelector":return f(e.props.value,t.getAssetsState);case"AddressInput":{if(!e.props.value)return null;const{namespace:t,reference:n}=(0,a.parseCaipChainId)(e.props.chainId);return(0,a.toCaipAccountId)(t,n,e.props.value)}case"AccountSelector":return m(e,t);default:return e.props.value}}(t,n)??o??function(e,t){switch(e.type){case"Dropdown":var n;return null===(n=(0,i.getJsxChildren)(e)[0])||void 0===n?void 0:n.props.value;case"RadioGroup":var s;return null===(s=(0,i.getJsxChildren)(e)[0])||void 0===s?void 0:s.props.value;case"Selector":var r;return null===(r=(0,i.getJsxChildren)(e)[0])||void 0===r?void 0:r.props.value;case"AccountSelector":return p(e,t);case"Checkbox":return!1;case"AssetSelector":return h(e.props.addresses,e.props.chainIds,t);default:return null}}(t,n)??null}n.isStatefulComponent=c,n.getJsxInterface=function(e){return(0,r.isJSXElementUnsafe)(e)?e:(0,i.getJsxElementFromComponent)(e)},n.assertNameIsUnique=l,n.isMatchingChainId=u,n.formatAccountSelectorStateValue=d,n.getDefaultAsset=h,n.getAccountSelectorDefaultStateValue=p,n.getAssetSelectorStateValue=f,n.getAccountSelectorStateValue=m,n.constructState=function(e,t,n){const s={},r=[];return(0,i.walkJsx)(t,(t,i)=>{let a=r[r.length-1];if(a&&i<=a.depth&&(r.pop(),a=r[r.length-1]),"Form"===t.type)return l(s,t.props.name),r.push({name:t.props.name,depth:i}),void(s[t.props.name]={});if(a&&c(t)){const r=s[a.name];return l(r,t.props.name),void(r[t.props.name]=g(e,t,n,a.name))}c(t)&&(l(s,t.props.name),s[t.props.name]=g(e,t,n))}),s};const w=5e6;n.validateInterfaceContext=function(e){if(!e)return;const t=(0,i.getJsonSizeUnsafe)(e);(0,s.assert)(t<=w,"A Snap interface context may not be larger than 5 MB.")}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/interface/utils.cjs"}],[2662,{"@metamask/snaps-utils":2903,"@metamask/utils":3116},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.log=void 0;const s=e("@metamask/snaps-utils"),r=e("@metamask/utils");n.log=(0,r.createModuleLogger)(s.snapsLogger,"snaps-controllers")}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/logging.cjs"}],[2663,{"../snaps/index.cjs":2676,"@metamask/rpc-errors":2600,"@metamask/snaps-rpc-methods":2730,"@metamask/snaps-utils":2903,"@metamask/utils":3116,nanoid:5037},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return e.get(c(e,t))}function o(e,t,n){return e.set(c(e,t),n),n}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainRouter=void 0;const l=e("@metamask/rpc-errors"),u=e("@metamask/snaps-rpc-methods"),d=e("@metamask/snaps-utils"),h=e("@metamask/utils"),p=e("nanoid"),f=e("../snaps/index.cjs"),m="MultichainRouter";var g=new WeakMap,w=new WeakMap,b=new WeakSet;async function v(e,t,n){try{const s=await a(w,this).call(this,async({keyring:s})=>s.resolveAccountAddress(e,t,n)),r=null==s?void 0:s.address;return r?(0,h.parseCaipAccountId)(r).address:null}catch{throw l.rpcErrors.internal()}}async function S(e,t,n){const s=a(g,this).call("AccountsController:listMultichainAccounts",t).filter(e=>{var t;return Boolean(null===(t=e.metadata.snap)||void 0===t?void 0:t.enabled)&&e.methods.includes(n.method)});if(0===s.length)return null;const r=s[0].metadata.snap.id,i=await c(b,this,v).call(this,r,t,n),o=e.map(e=>(0,h.parseCaipAccountId)(e).address),u=s.find(e=>o.includes(e.address)&&(!i||e.address===i));if(!u)throw l.rpcErrors.invalidParams({message:"No available account found for request."});return u.id}function y(e){const t=a(g,this).call("SnapController:getAll");return(0,f.getRunnableSnaps)(t).reduce((t,n)=>{const s=a(g,this).call("PermissionController:getPermissions",n.id);if(s&&(0,h.hasProperty)(s,u.SnapEndowments.Protocol)){const r=s[u.SnapEndowments.Protocol],i=(0,u.getProtocolCaveatScopes)(r);i&&(0,h.hasProperty)(i,e)&&t.push({snapId:n.id,methods:i[e].methods})}return t},[])}function k(e){return a(g,this).call("AccountsController:listMultichainAccounts",e).filter(e=>{var t;return null===(t=e.metadata.snap)||void 0===t?void 0:t.enabled})}n.MultichainRouter=class{constructor({messenger:e,withSnapKeyring:t}){var n,c;r(n=this,c=b),c.add(n),i(this,"name",m),i(this,"state",null),s(this,g,void 0),s(this,w,void 0),o(g,this,e),o(w,this,t),a(g,this).registerActionHandler(`${m}:handleRequest`,async(...e)=>this.handleRequest(...e)),a(g,this).registerActionHandler(`${m}:getSupportedMethods`,(...e)=>this.getSupportedMethods(...e)),a(g,this).registerActionHandler(`${m}:getSupportedAccounts`,(...e)=>this.getSupportedAccounts(...e)),a(g,this).registerActionHandler(`${m}:isSupportedScope`,(...e)=>this.isSupportedScope(...e))}async handleRequest({connectedAddresses:e,origin:t,scope:n,request:s}){(0,h.assert)(!n.startsWith(h.KnownCaipNamespace.Eip155)&&!n.startsWith("wallet:eip155"));const r={jsonrpc:"2.0",id:s.id??(0,p.nanoid)(),method:s.method,...s.params?{params:s.params}:{}},{method:i,params:o}=r,u=await c(b,this,S).call(this,e,n,r);if(u)return a(w,this).call(this,async({keyring:e})=>e.submitRequest({origin:t,account:u,scope:n,method:i,params:o}));const f=c(b,this,y).call(this,n).find(e=>e.methods.includes(i));if(f)return a(g,this).call("SnapController:handleRequest",{snapId:f.snapId,origin:t,request:{method:"",params:{request:r,scope:n}},handler:d.HandlerType.OnProtocolRequest});throw l.rpcErrors.methodNotFound()}getSupportedMethods(e){const t=c(b,this,k).call(this,e).flatMap(e=>e.methods),n=c(b,this,y).call(this,e).flatMap(e=>e.methods);return Array.from(new Set([...t,...n]))}getSupportedAccounts(e){return c(b,this,k).call(this,e).map(t=>`${e}:${t.address}`)}isSupportedScope(e){return a(g,this).call("AccountsController:listMultichainAccounts",e).some(e=>{var t;return null===(t=e.metadata.snap)||void 0===t?void 0:t.enabled})||c(b,this,y).call(this,e).length>0}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/multichain/MultichainRouter.cjs"}],[2664,{"./MultichainRouter.cjs":2663},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./MultichainRouter.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/multichain/index.cjs"}],[2665,{"../logging.cjs":2662,"../snaps/Timer.cjs":2674,"../utils.cjs":2686,"@metamask/json-rpc-engine":2109,"@metamask/json-rpc-middleware-stream":2122,"@metamask/object-multiplex":2401,"@metamask/rpc-errors":2600,"@metamask/snaps-utils":2903,"@metamask/utils":3116,nanoid:5037,"readable-stream":2704},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return e.get(c(e,t))}function o(e,t,n){return e.set(c(e,t),n),n}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var l=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.setupMultiplex=n.AbstractExecutionService=void 0;const u=e("@metamask/json-rpc-engine"),d=e("@metamask/json-rpc-middleware-stream"),h=l(e("@metamask/object-multiplex")),p=e("@metamask/rpc-errors"),f=e("@metamask/snaps-utils"),m=e("@metamask/utils"),g=e("nanoid"),w=e("readable-stream"),b=e("../logging.cjs"),v=e("../snaps/Timer.cjs"),S=e("../utils.cjs"),y="ExecutionService";var k=new WeakMap,T=new WeakMap,E=new WeakMap,I=new WeakMap,M=new WeakMap,_=new WeakMap,C=new WeakMap,A=new WeakMap,P=new WeakSet;function O(){a(I,this).registerActionHandler(`${y}:handleRpcRequest`,async(e,t)=>this.handleRpcRequest(e,t)),a(I,this).registerActionHandler(`${y}:executeSnap`,async e=>this.executeSnap(e)),a(I,this).registerActionHandler(`${y}:terminateSnap`,async e=>this.terminateSnap(e)),a(I,this).registerActionHandler(`${y}:terminateAllSnaps`,async()=>this.terminateAllSnaps())}async function j(e,t){const{streams:n,worker:s}=await c(P,this,R).call(this,e,t),r=new u.JsonRpcEngine,i=(0,d.createStreamMiddleware)();(0,w.pipeline)(i.stream,n.command,i.stream,e=>{var t;!e||null!==(t=e.message)&&void 0!==t&&t.match("Premature close")||(0,f.logError)("Command stream failure.",e)}),r.push(i.middleware);const o={id:e,streams:n,rpcEngine:r,worker:s};return a(k,this).set(e,o),o}async function R(e,t){const n=await(0,S.withTimeout)(this.initEnvStream(e),t);if(n===S.hasTimedOut){await this.terminateJob({id:e});if("created"===a(T,this).get(e))throw new Error(`The executor for "${e}" couldn't start initialization. The offscreen document may not exist.`);throw new Error(`The executor for "${e}" failed to initialize. The iframe/webview/worker failed to load.`)}const{worker:s,stream:r}=n,i=D(r,`Snap: "${e}"`),o=i.createStream(f.SNAP_STREAM_NAMES.COMMAND),c=t=>{(0,m.hasProperty)(t,"id")||("OutboundRequest"===t.method?a(I,this).publish("ExecutionService:outboundRequest",e):"OutboundResponse"===t.method?a(I,this).publish("ExecutionService:outboundResponse",e):"UnhandledError"===t.method?(a(I,this).publish("ExecutionService:unhandledError",e,t.params.error),o.removeListener("data",c)):(0,f.logError)(new Error(`Received unexpected command stream notification "${t.method}".`)))};o.on("data",c);const l=i.createStream(f.SNAP_STREAM_NAMES.JSON_RPC);l.on("data",t=>{null!=t&&t.data&&(0,m.hasProperty)(null==t?void 0:t.data,"id")&&a(I,this).publish("ExecutionService:outboundRequest",e)});const u=l.write.bind(l);return l.write=(t,n,s)=>{var r;return"metamask_chainChanged"===(null==t||null===(r=t.data)||void 0===r?void 0:r.method)||(null!=t&&t.data&&(0,m.hasProperty)(null==t?void 0:t.data,"id")&&a(I,this).publish("ExecutionService:outboundResponse",e),u(t,n,s))},{streams:{command:o,rpc:l,connection:r,mux:i},worker:s}}async function N(e,t){const n=a(k,this).get(e);if(!n)throw new Error(`"${e}" is not currently running.`);(0,b.log)("Parent: Sending Command",t);const s=await n.rpcEngine.handle(t);if((0,m.hasProperty)(s,"error")){const e=s.error;throw new p.JsonRpcError(e.code,e.message,e.data)}return s.result}function D(e,t){const n=new h.default;return(0,w.pipeline)(e,n,e,e=>{var n;!e||null!==(n=e.message)&&void 0!==n&&n.match("Premature close")||(0,f.logError)(`"${t}" stream failure.`,e)}),n}n.AbstractExecutionService=class{constructor({setupSnapProvider:e,messenger:t,initTimeout:n=(0,m.inMilliseconds)(60,m.Duration.Second),pingTimeout:a=(0,m.inMilliseconds)(10,m.Duration.Second),terminationTimeout:l=(0,m.inMilliseconds)(1,m.Duration.Second),usePing:u=!0}){var d,h;r(d=this,h=P),h.add(d),i(this,"name",y),i(this,"state",null),s(this,k,void 0),s(this,T,void 0),s(this,E,void 0),s(this,I,void 0),s(this,M,void 0),s(this,_,void 0),s(this,C,void 0),s(this,A,void 0),o(k,this,new Map),o(T,this,new Map),o(E,this,e),o(I,this,t),o(M,this,n),o(_,this,a),o(C,this,l),o(A,this,u),c(P,this,O).call(this)}async terminateSnap(e){const t=a(k,this).get(e);if(t){try{const t=await(0,S.withTimeout)(c(P,this,N).call(this,e,{jsonrpc:"2.0",method:"terminate",params:[],id:(0,g.nanoid)()}),a(C,this));t!==S.hasTimedOut&&"OK"===t||(0,f.logWarning)(`Snap "${e}" failed to terminate gracefully.`)}catch{}Object.values(t.streams).forEach(e=>{try{e.destroyed||e.destroy()}catch(e){(0,f.logError)("Error while destroying stream",e)}}),await this.terminateJob(t),a(k,this).delete(e),a(T,this).delete(e),(0,b.log)(`Snap "${e}" terminated.`)}}setSnapStatus(e,t){a(T,this).set(e,t)}async terminateAllSnaps(){await Promise.all([...a(k,this).keys()].map(async e=>this.terminateSnap(e)))}async executeSnap({snapId:e,sourceCode:t,endowments:n}){if(a(k,this).has(e))throw new Error(`"${e}" is already running.`);this.setSnapStatus(e,"created");const s=new v.Timer(a(M,this)),r=await c(P,this,j).call(this,e,s);if(a(A,this)){if(await(0,S.withTimeout)(c(P,this,N).call(this,r.id,{jsonrpc:"2.0",method:"ping",id:(0,g.nanoid)()}),a(_,this))===S.hasTimedOut)throw new Error(`The executor for "${e}" was unreachable. The executor did not respond in time.`)}const i=r.streams.rpc;a(E,this).call(this,e,i);const o=Math.max(s.remaining,a(M,this)/2);this.setSnapStatus(e,"initialized");const l={jsonrpc:"2.0",method:"executeSnap",params:{snapId:e,sourceCode:t,endowments:n},id:(0,g.nanoid)()};(0,m.assertIsJsonRpcRequest)(l),this.setSnapStatus(e,"executing");const u=await(0,S.withTimeout)(c(P,this,N).call(this,r.id,l),o);if(u===S.hasTimedOut)throw new Error(`${e} failed to start.`);return"OK"===u&&this.setSnapStatus(e,"running"),u}async handleRpcRequest(e,t){const{handler:n,request:s,origin:r}=t;return await c(P,this,N).call(this,e,{id:(0,g.nanoid)(),jsonrpc:"2.0",method:"snapRpc",params:{origin:r,handler:n,request:s,target:e}})}},n.setupMultiplex=D}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/AbstractExecutionService.cjs"}],[2666,{"@metamask/post-message-stream":2465},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){r(e,t),t.set(e,n)}function r(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t){return e.get(o(e,t))}function a(e,t,n){return e.set(o(e,t),n),n}function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.ProxyPostMessageStream=void 0;const c=e("@metamask/post-message-stream");var l=new WeakMap,u=new WeakMap,d=new WeakSet;class h extends c.BasePostMessageStream{constructor({stream:e,jobId:t}){var n,c;super(),r(n=this,c=d),c.add(n),s(this,l,void 0),s(this,u,void 0),a(l,this,e),a(u,this,t),i(l,this).on("data",o(d,this,p).bind(this))}_postMessage(e){i(l,this).write({jobId:i(u,this),data:e})}}function p(e){e.jobId===i(u,this)&&this.push(e.data)}n.ProxyPostMessageStream=h}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/ProxyPostMessageStream.cjs"}],[2667,{"../../utils.cjs":2686,"../AbstractExecutionService.cjs":2665,"@metamask/post-message-stream":2465,"@metamask/snaps-utils":2903},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.IframeExecutionService=void 0;const r=e("@metamask/post-message-stream"),i=e("@metamask/snaps-utils"),a=e("../../utils.cjs"),o=e("../AbstractExecutionService.cjs");class c extends o.AbstractExecutionService{constructor({iframeUrl:e,messenger:t,setupSnapProvider:n,...r}){super({...r,messenger:t,setupSnapProvider:n}),s(this,"iframeUrl",void 0),this.iframeUrl=e}async terminateJob(e){const t=document.getElementById(e.id);t&&(t.id="",await(0,a.withTimeout)(new Promise(e=>{t.addEventListener("load",()=>e(),{once:!0}),t.src="about:blank"}),10),t.remove())}async initEnvStream(e){this.setSnapStatus(e,"initializing");const t=await(0,i.createWindow)({uri:this.iframeUrl.toString(),id:e});return{worker:t,stream:new r.WindowPostMessageStream({name:"parent",target:"child",targetWindow:t,targetOrigin:"*"})}}}n.IframeExecutionService=c}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/iframe/IframeExecutionService.cjs"}],[2668,{"./IframeExecutionService.cjs":2667},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./IframeExecutionService.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/iframe/index.cjs"}],[2669,{"./AbstractExecutionService.cjs":2665,"./ProxyPostMessageStream.cjs":2666,"./iframe/index.cjs":2668,"./offscreen/index.cjs":2671},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./AbstractExecutionService.cjs"),n),r(e("./ProxyPostMessageStream.cjs"),n),r(e("./iframe/index.cjs"),n),r(e("./offscreen/index.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/index.cjs"}],[267,{"../../../shared/constants/defi-referrals":5780,"@metamask/json-rpc-engine":2109,loglevel:4846},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ReferralTriggerType=void 0,n.createDefiReferralMiddleware=function(e){return(0,r.createAsyncMiddleware)(async(t,n,s)=>{if(await s(),!function(e){return Boolean(e.origin)&&Boolean(e.tabId)}(t))return;const r=(0,a.getPartnerByOrigin)(t.origin);if(!r)return;const c="wallet_requestPermissions"===t.method,l=Array.isArray(n.result)&&n.result.some(e=>"eth_accounts"===(null==e?void 0:e.parentCapability));c&&l&&e(r,t.tabId,o.NewConnection).catch(e=>{i.default.error(`Failed to handle ${r.name} referral after wallet_requestPermissions grant: `,e)})})};var s,r=e("@metamask/json-rpc-engine"),i=(s=e("loglevel"))&&s.__esModule?s:{default:s},a=e("../../../shared/constants/defi-referrals");let o=n.ReferralTriggerType=function(e){return e.NewConnection="new_connection",e.OnNavigateConnectedTab="on_navigate_connected_tab",e}({})}}},{package:"$root$",file:"app/scripts/lib/createDefiReferralMiddleware.ts"}],[2670,{"../proxy/ProxyExecutionService.cjs":2672,"@metamask/post-message-stream":2465},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function r(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.OffscreenExecutionService=void 0;const i=e("@metamask/post-message-stream"),a=e("../proxy/ProxyExecutionService.cjs");var o=new WeakMap;class c extends a.ProxyExecutionService{constructor({messenger:e,setupSnapProvider:t,offscreenPromise:n,...a}){var c,l,u;super({...a,messenger:e,setupSnapProvider:t,stream:new i.BrowserRuntimePostMessageStream({name:"parent",target:"child"})}),s(this,o,void 0),l=this,u=n,(c=o).set(r(c,l),u)}async initEnvStream(e){var t,n;return await(t=o,n=this,t.get(r(t,n))),await super.initEnvStream(e)}}n.OffscreenExecutionService=c}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/offscreen/OffscreenExecutionService.cjs"}],[2671,{"./OffscreenExecutionService.cjs":2670},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,r)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},r=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),r(e("./OffscreenExecutionService.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/offscreen/index.cjs"}],[2672,{"../AbstractExecutionService.cjs":2665,"../ProxyPostMessageStream.cjs":2666,nanoid:5037},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function r(e,t){return e.get(i(e,t))}function i(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.ProxyExecutionService=void 0;const a=e("nanoid"),o=e("../AbstractExecutionService.cjs"),c=e("../ProxyPostMessageStream.cjs");var l=new WeakMap;class u extends o.AbstractExecutionService{constructor({stream:e,messenger:t,setupSnapProvider:n,...r}){var a,o,c;super({...r,messenger:t,setupSnapProvider:n,usePing:!1}),s(this,l,void 0),o=this,c=e,(a=l).set(i(a,o),c)}async terminateJob(e){r(l,this).write({jobId:e.id,data:{jsonrpc:"2.0",method:"terminateJob",id:(0,a.nanoid)()}})}async initEnvStream(e){this.setSnapStatus(e,"initializing");const t=new c.ProxyPostMessageStream({stream:r(l,this),jobId:e});return await new Promise(e=>{t.once("data",e),t.write({name:"command",data:{jsonrpc:"2.0",method:"ping",id:(0,a.nanoid)()}})}),{worker:e,stream:t}}}n.ProxyExecutionService=u}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/proxy/ProxyExecutionService.cjs"}]],[],{});