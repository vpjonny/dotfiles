"use strict";(self.webpackChunktemple_wallet=self.webpackChunktemple_wallet||[]).push([[737],{29737:(e,t,n)=>{n.r(t),n.d(t,{default:()=>k});var i=n(13983),o=n(24450),r=n(48287).Buffer;function s(e){const t=r.alloc(2);return t.writeUInt16BE(e,0),t}const c={data:r.alloc(0),dataLength:0,sequence:0},a=(e,t)=>({makeBlocks(n){let i=r.concat([s(n.length),n]);const o=t-5,c=Math.ceil(i.length/o);i=r.concat([i,r.alloc(c*o-i.length+1).fill(0)]);const a=[];for(let t=0;t<c;t++){const n=r.alloc(5);n.writeUInt16BE(e,0),n.writeUInt8(5,2),n.writeUInt16BE(t,3);const s=i.slice(t*o,(t+1)*o);a.push(r.concat([n,s]))}return a},reduceResponse(t,n){let{data:i,dataLength:s,sequence:a}=t||c;if(n.readUInt16BE(0)!==e)throw new o.TransportError("Invalid channel","InvalidChannel");if(5!==n.readUInt8(2))throw new o.TransportError("Invalid tag","InvalidTag");if(n.readUInt16BE(3)!==a)throw new o.TransportError("Invalid sequence","InvalidSequence");t||(s=n.readUInt16BE(5)),a++;const d=n.slice(t?5:7);return i=r.concat([i,d]),i.length>s&&(i=i.slice(0,s)),{data:i,dataLength:s,sequence:a}},getReducedResult(e){if(e&&e.dataLength===e.data.length)return e.data}});var d=n(99589),u=n.n(d);const h={blue:{id:"blue",productName:"Ledger\xa0Blue",productIdMM:0,legacyUsbProductId:0,usbOnly:!0,memorySize:491520,blockSize:4096,getBlockSize:e=>4096},nanoS:{id:"nanoS",productName:"Ledger\xa0Nano\xa0S",productIdMM:16,legacyUsbProductId:1,usbOnly:!0,memorySize:327680,blockSize:4096,getBlockSize:e=>u().lt(u().coerce(e),"2.0.0")?4096:2048},nanoX:{id:"nanoX",productName:"Ledger\xa0Nano\xa0X",productIdMM:64,legacyUsbProductId:4,usbOnly:!1,memorySize:2097152,blockSize:4096,getBlockSize:e=>4096,bluetoothSpec:[{serviceUuid:"d973f2e0-b19e-11e2-9e96-0800200c9a66",notifyUuid:"d973f2e1-b19e-11e2-9e96-0800200c9a66",writeUuid:"d973f2e2-b19e-11e2-9e96-0800200c9a66"},{serviceUuid:"13d63400-2c97-0004-0000-4c6564676572",notifyUuid:"13d63400-2c97-0004-0001-4c6564676572",writeUuid:"13d63400-2c97-0004-0002-4c6564676572"}]}},l=Object.values(h),p=11415,v=e=>{const t=l.find((t=>t.legacyUsbProductId===e));if(t)return t;const n=e>>8;return l.find((e=>e.productIdMM===n))},g=[],m={};for(let e in h){const t=h[e],{bluetoothSpec:n}=t;if(n)for(let e=0;e<n.length;e++){const i=n[e];g.push(i.serviceUuid),m[i.serviceUuid]=m[i.serviceUuid.replace(/-/g,"")]={deviceModel:t,...i}}}var f=n(13648),y=n(48287).Buffer,w=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function c(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((i=i.apply(e,t||[])).next())}))};const x=[{vendorId:p}],b=()=>{const{hid:e}=navigator;if(!e)throw new o.TransportError("navigator.hid is not supported","HIDNotSupported");return e};function I(){return w(this,void 0,void 0,(function*(){const e=yield b().requestDevice({filters:x});return Array.isArray(e)?e:[e]}))}function T(){return w(this,void 0,void 0,(function*(){return(yield b().getDevices()).filter((e=>e.vendorId===p))}))}class E extends i.Ay{constructor(e){super(),this.channel=Math.floor(65535*Math.random()),this.packetSize=64,this.inputs=[],this.read=()=>this.inputs.length?Promise.resolve(this.inputs.shift()):new Promise((e=>{this.inputCallback=e})),this.onInputReport=e=>{const t=y.from(e.data.buffer);this.inputCallback?(this.inputCallback(t),this.inputCallback=null):this.inputs.push(t)},this._disconnectEmitted=!1,this._emitDisconnect=e=>{this._disconnectEmitted||(this._disconnectEmitted=!0,this.emit("disconnect",e))},this.exchange=e=>w(this,void 0,void 0,(function*(){return yield this.exchangeAtomicImpl((()=>w(this,void 0,void 0,(function*(){const{channel:t,packetSize:n}=this;(0,f.Rm)("apdu","=> "+e.toString("hex"));const i=a(t,n),o=i.makeBlocks(e);for(let e=0;e<o.length;e++)yield this.device.sendReport(0,o[e]);let r,s;for(;!(r=i.getReducedResult(s));){const e=yield this.read();s=i.reduceResponse(s,e)}return(0,f.Rm)("apdu","<= "+r.toString("hex")),r})))).catch((e=>{if(e&&e.message&&e.message.includes("write"))throw this._emitDisconnect(e),new o.iX(e.message);throw e}))})),this.device=e,this.deviceModel="number"===typeof e.productId?v(e.productId):void 0,e.addEventListener("inputreport",this.onInputReport)}static request(){return w(this,void 0,void 0,(function*(){const[e]=yield I();return E.open(e)}))}static openConnected(){return w(this,void 0,void 0,(function*(){const e=yield T();return 0===e.length?null:E.open(e[0])}))}static open(e){return w(this,void 0,void 0,(function*(){yield e.open();const t=new E(e),n=i=>{e===i.device&&(b().removeEventListener("disconnect",n),t._emitDisconnect(new o.Ej))};return b().addEventListener("disconnect",n),t}))}close(){return w(this,void 0,void 0,(function*(){yield this.exchangeBusyPromise,this.device.removeEventListener("inputreport",this.onInputReport),yield this.device.close()}))}setScrambleKey(){}}E.isSupported=()=>Promise.resolve(!(!window.navigator||!window.navigator.hid)),E.list=T,E.listen=e=>{let t=!1;return function(){return w(this,void 0,void 0,(function*(){const e=yield T();return e.length>0?e[0]:(yield I())[0]}))}().then((n=>{if(n){if(!t){const t="number"===typeof n.productId?v(n.productId):void 0;e.next({type:"add",descriptor:n,deviceModel:t}),e.complete()}}else e.error(new o.kt("Access denied to use Ledger device"))}),(t=>{e.error(new o.kt(t.message))})),{unsubscribe:function(){t=!0}}};const k=E},13983:(e,t,n)=>{n.d(t,{Ay:()=>u});var i=n(37007),o=n.n(i),r=n(24450),s=n(13648),c=n(48287).Buffer,a=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function c(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((i=i.apply(e,t||[])).next())}))};class d{constructor({context:e,logType:t}={}){this.exchangeTimeout=3e4,this.unresponsiveTimeout=15e3,this.deviceModel=null,this._events=new(o()),this.send=(e,t,n,i,o=c.alloc(0),s=[r.vi.OK],{abortTimeoutMs:d}={})=>a(this,void 0,void 0,(function*(){const a=this.tracer.withUpdatedContext({function:"send"});if(o.length>=256)throw a.trace("data.length exceeded 256 bytes limit",{dataLength:o.length}),new r.TransportError("data.length exceed 256 bytes limit. Got: "+o.length,"DataLengthTooBig");a.trace("Starting an exchange",{abortTimeoutMs:d});const u=yield this.exchange(c.concat([c.from([e,t,n,i]),c.from([o.length]),o]),{abortTimeoutMs:d});a.trace("Received response from exchange");const h=u.readUInt16BE(u.length-2);if(!s.some((e=>e===h)))throw new r._3(h);return u})),this._appAPIlock=null,this.tracer=new s.PR(null!==t&&void 0!==t?t:"transport",e)}exchange(e,{abortTimeoutMs:t}={}){throw new Error("exchange not implemented")}exchangeBulk(e,t){let n=!1;return(()=>a(this,void 0,void 0,(function*(){if(!n)for(const i of e){const e=yield this.exchange(i);if(n)return;const o=e.readUInt16BE(e.length-2);if(o!==r.vi.OK)throw new r._3(o);t.next(e)}})))().then((()=>!n&&t.complete()),(e=>!n&&t.error(e))),{unsubscribe:()=>{n=!0}}}setScrambleKey(e){}close(){return Promise.resolve()}on(e,t){this._events.on(e,t)}off(e,t){this._events.removeListener(e,t)}emit(e,...t){this._events.emit(e,...t)}setDebugMode(){}setExchangeTimeout(e){this.exchangeTimeout=e}setExchangeUnresponsiveTimeout(e){this.unresponsiveTimeout=e}static create(e=3e3,t){return new Promise(((n,i)=>{let o=!1;const s=this.listen({next:t=>{o=!0,s&&s.unsubscribe(),c&&clearTimeout(c),this.open(t.descriptor,e).then(n,i)},error:e=>{c&&clearTimeout(c),i(e)},complete:()=>{c&&clearTimeout(c),o||i(new r.TransportError(this.ErrorMessage_NoDeviceFound,"NoDeviceFound"))}}),c=t?setTimeout((()=>{s.unsubscribe(),i(new r.TransportError(this.ErrorMessage_ListenTimeout,"ListenTimeout"))}),t):null}))}exchangeAtomicImpl(e){return a(this,void 0,void 0,(function*(){const t=this.tracer.withUpdatedContext({function:"exchangeAtomicImpl",unresponsiveTimeout:this.unresponsiveTimeout});if(this.exchangeBusyPromise)throw t.trace("Atomic exchange is already busy"),new r.IO("An action was already pending on the Ledger device. Please deny or reconnect.");let n;const i=new Promise((e=>{n=e}));this.exchangeBusyPromise=i;let o=!1;const s=setTimeout((()=>{t.trace('Timeout reached, emitting Transport event "unresponsive"',{unresponsiveTimeout:this.unresponsiveTimeout}),o=!0,this.emit("unresponsive")}),this.unresponsiveTimeout);try{const n=yield e();return o&&(t.trace("Device was unresponsive, emitting responsive"),this.emit("responsive")),n}finally{t.trace("Finalize, clearing busy guard"),clearTimeout(s),n&&n(),this.exchangeBusyPromise=null}}))}decorateAppAPIMethods(e,t,n){for(const i of t)e[i]=this.decorateAppAPIMethod(i,e[i],e,n)}decorateAppAPIMethod(e,t,n,i){return(...o)=>a(this,void 0,void 0,(function*(){const{_appAPIlock:s}=this;if(s)return Promise.reject(new r.TransportError("Ledger Device is busy (lock "+s+")","TransportLocked"));try{return this._appAPIlock=e,this.setScrambleKey(i),yield t.apply(n,o)}finally{this._appAPIlock=null}}))}setTraceContext(e){this.tracer=this.tracer.withContext(e)}updateTraceContext(e){this.tracer.updateContext(e)}getTraceContext(){return this.tracer.getContext()}}d.ErrorMessage_ListenTimeout="No Ledger device found (timeout)",d.ErrorMessage_NoDeviceFound="No Ledger device found";const u=d},13648:(e,t,n)=>{n.d(t,{PR:()=>s,Rm:()=>r});let i=0;const o=[],r=(e,t,n)=>{const o={type:e,id:String(++i),date:new Date};t&&(o.message=t),n&&(o.data=n),a(o)};class s{constructor(e,t){this.type=e,this.context=t}trace(e,t){(({type:e,message:t,data:n,context:o})=>{const r={type:e,id:String(++i),date:new Date};t&&(r.message=t),n&&(r.data=n),o&&(r.context=o),a(r)})({type:this.type,message:e,data:t,context:this.context})}getContext(){return this.context}setContext(e){this.context=e}updateContext(e){this.context=Object.assign(Object.assign({},this.context),e)}getType(){return this.type}setType(e){this.type=e}withType(e){return new s(e,this.context)}withContext(e){return new s(this.type,e)}withUpdatedContext(e){return new s(this.type,Object.assign(Object.assign({},this.context),e))}}const c=e=>(o.push(e),()=>{const t=o.indexOf(e);-1!==t&&(o[t]=o[o.length-1],o.pop())});function a(e){for(let t=0;t<o.length;t++)try{o[t](e)}catch(e){}}"undefined"!==typeof window&&(window.__ledgerLogsListen=c)}}]);