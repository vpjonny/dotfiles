"use strict";(self.webpackChunktemple_wallet=self.webpackChunktemple_wallet||[]).push([[45,847],{6045:(e,t,r)=>{r.r(t),r.d(t,{PartnersPromotion:()=>Z,PartnersPromotionVariant:()=>A});var a,n=r(96540),s=r(20053),l=r(11655),o=r(41007),c=r(56668),i=r(43215),u=r(47402);!function(e){e.HypeLab="HypeLab",e.Temple="Temple Wallet"}(a||(a={}));var m=r(40847),d=r(52781),p=r(56229),f=r(28081),h=r(9531),g=r(32957),b=r(27644);const v=(0,n.memo)((({className:e,onClick:t})=>n.createElement("button",{className:(0,s.A)("w-5 h-5 flex justify-center items-center z-20 rounded-circle absolute top-2 right-2","bg-grey-4 hover:bg-secondary-hover-low",e),onClick:t,title:(0,f.t)("hideAd")},n.createElement(g.zP,{Icon:b.h,size:12,className:"text-secondary"}))));var A;!function(e){e.Text="Text",e.Image="Image"}(A||(A={}));var E=r(21396),k=r(48076),w=r(94147);const y=(e,t,r=1e4)=>{(0,w.Z3)(t,r,!e,[t])};var N=r(13695),P=r(11084),I=r(34184),x=r(48795);const R=(e,t,r)=>(0,x.B)(e,(e=>{t(e.isIntersecting)}),{threshold:.5},r);var L;!function(e){e.promoLink="Partners Promotion/Promo Link"}(L||(L={}));const T=(e,t,r,a,n)=>({variant:e,provider:t,page:r,accountPkh:a,href:n}),S=(0,n.memo)((({accountPkh:e,children:t,href:r,isVisible:a,providerTitle:l,pageName:o,backgroundAssetUrl:c,backgroundAssetType:i="image",onAdRectVisible:u})=>{const m=(0,n.useRef)(null);R(m,u,a);const d=(0,n.useMemo)((()=>T(A.Image,l,o,e,r)),[r,l,o,e]);return n.createElement(I.M,{className:(0,s.A)("relative w-full h-[101px] rounded-lg overflow-hidden bg-grey-4",!a&&"invisible"),href:r,target:"_blank",rel:"noreferrer",ref:m,testID:L.promoLink,testIDProperties:d},c&&n.createElement(n.Fragment,null,"image"===i?n.createElement("img",{className:"absolute inset-0 w-full h-full object-cover filter blur-[20px]",src:c,alt:""}):n.createElement("video",{className:"absolute inset-0 w-full h-full object-cover filter blur-[20px]",src:c,autoPlay:!0,preload:"auto",playsInline:!0,muted:!0,loop:!0})),n.createElement("div",{className:"w-full h-full flex justify-center items-center z-10 relative"},t),n.createElement(_,null))})),_=(0,n.memo)((()=>n.createElement("div",{className:(0,s.A)("absolute top-0 left-0 p-1 rounded-tl-lg rounded-br-lg z-20","bg-secondary text-font-small-bold text-white")},"AD"))),D=({accountPkh:e,isVisible:t,pageName:r,onImpression:s,onError:l,onReady:o})=>{const c=(0,P.MU)(),i=(0,n.useRef)(null),[u,m]=(0,n.useState)(!1),[d,p]=(0,n.useState)(null),[f,h]=(0,n.useState)({width:320,height:100}),g=(0,n.useRef)(""),{backgroundAssetType:b,backgroundAssetUrl:v}=(0,n.useMemo)((()=>{const e=d?.creative_set;return e?"image"in e?{backgroundAssetType:"image",backgroundAssetUrl:e.image.url}:{backgroundAssetType:"video",backgroundAssetUrl:e.video.url}:{}}),[d]),[A,E]=(0,n.useState)(!1),N=(0,w.jY)(A);y(u,l);const I=(0,n.useMemo)((()=>(0,k.nanoid)()),[]);(0,n.useEffect)((()=>{if(!i.current)return;const e=e=>{if(e.source&&e.source===i.current?.contentWindow)try{const t="string"===typeof e.data?JSON.parse(e.data):e.data;if(t.id!==I)return;switch(t.type){case"ready":(e=>{const t=e?.ad;t&&(t&&g.current!==t.cta_url&&"e55d2795d2"===t.campaign_slug?l():t&&g.current!==t.cta_url&&(p(t),g.current=t.cta_url,m(!0),o()))})(t);break;case"error":l();break;case"resize":0!==t.width&&0!==t.height&&h({width:t.width,height:t.height});break;case"impression":N.current&&s()}}catch(e){}};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)}),[I,l,o,s,N]);const x=(0,n.useMemo)((()=>C({origin:globalThis.location.origin,width:320,height:100,id:I,evmAccountAddress:c})),[I,c]);return n.createElement(S,{accountPkh:e,href:d?.cta_url??"#",isVisible:t,providerTitle:a.HypeLab,pageName:r,backgroundAssetUrl:v,backgroundAssetType:b,onAdRectVisible:E},n.createElement("div",null,n.createElement("iframe",{title:"Ad",sandbox:"allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox",className:"block border-none rounded overflow-hidden",style:f,src:x,ref:i})))},V={width:"w",height:"h",slug:"p",id:"id",evmAccountAddress:"ea",chainName:"cn"},C=({origin:e,...t})=>{const r=new URL(N.et.HYPELAB_ADS_WINDOW_URL),a=(e,t)=>{r.searchParams.set(e,String(t))};var n;return a("ps",N.et.HYPELAB_PROPERTY_SLUG),a("ap","hypelab"),Object.entries({slug:N.et.HYPELAB_INTERNAL_MEDIUM_PLACEMENT_SLUG,...t}).forEach((([e,t])=>{(t||0===t)&&a(V[e],t)})),a("o",(n=e,E.AES.encrypt(n,N.et.TEMPLE_ADS_ORIGIN_PASSPHRASE).toString())),r.toString()};var M=r(32022);const U=(e,t,r,a)=>{const[s,l]=(0,n.useState)((()=>e.current?t(e.current):r)),o=(0,n.useCallback)((()=>{l(e.current?t(e.current):r)}),[t,r,e]),c=(0,n.useMemo)((()=>new MutationObserver(o)),[o]),i=(0,n.useCallback)((()=>!!e.current&&(c.observe(e.current,a),!0)),[a,c,e]);return(0,n.useEffect)((()=>{if(i())return o(),()=>c.disconnect();const e=setInterval((()=>{i()&&(o(),clearInterval(e))}),50);return()=>{clearInterval(e),c.disconnect()}}),[c,i,o]),s};var z=r(24281),O=r(42627);const H=(0,n.memo)((({accountPkh:e,imageSrc:t,href:r,headline:a,isVisible:l,contentText:o="",providerTitle:c,pageName:i,onAdRectVisible:u,onImageError:m})=>{const d=(0,n.useRef)(null);R(d,u,l);const p=(0,n.useMemo)((()=>T(A.Text,c,i,e,r)),[r,c,i,e]),f=i===z.P||i===O.J;return n.createElement(I.M,{className:(0,s.A)("rounded-lg relative w-full flex bg-grey-4 hover:bg-secondary-low group-hover:bg-secondary-low",!l&&"invisible"),href:r,target:"_blank",rel:"noreferrer",ref:d,testID:L.promoLink,testIDProperties:p},n.createElement("div",{className:(0,s.A)(f?"p-3":"p-2","w-full flex-1 flex gap-2 pr-9")},n.createElement("div",{className:"shrink-0"},n.createElement("img",{className:(0,s.A)(f?"p-0.5":"p-1","w-10 h-auto rounded-circle"),src:t,alt:"Partners promotion",onError:m})),n.createElement("div",{className:"flex-1 flex flex-col gap-1 justify-center overflow-hidden"},n.createElement("div",{className:"flex gap-1 items-center"},n.createElement("span",{className:"text-font-medium truncate"},a),n.createElement("div",{className:"bg-secondary text-white text-font-small-bold px-1 py-0.5 rounded"},"AD")),o&&n.createElement("span",{className:"text-font-description text-grey-1 line-clamp-2"},o))))})),Y={childList:!0,subtree:!0};const j=e=>e.innerText,B=e=>e.href,G=e=>e.src,q={childList:!0},F={attributes:!0},J="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==",W=({accountPkh:e,isVisible:t,pageName:r,onImpression:s,onReady:l,onError:o})=>{const[c,i]=(0,n.useState)(!1),u=(0,w.jY)(c),m=(0,n.useRef)(null),d=(0,n.useRef)(null),p=(0,n.useRef)(null),f=(0,n.useRef)(null),h=(0,n.useRef)(null),g=function(e,t){const r=(0,n.useCallback)((()=>e.current?.querySelector(t)??null),[e,t]),a=U(e,r,null,Y),s=(0,n.useRef)(null);return(0,n.useEffect)((()=>{s.current=a}),[a]),s}(h,"hype-native"),b=U(m,j,"",q),v=U(d,j,"",q),A=U(p,B,"/",F),E=U(f,G,J,F),k=b.length>0;return y(k,o),(0,n.useEffect)((()=>{const e=e=>{u.current&&e.target===g.current&&s()};return globalThis.addEventListener("impression",e),()=>globalThis.removeEventListener("impression",e)}),[u,s,g]),(0,n.useEffect)((()=>{k&&l()}),[k,l]),(0,n.useEffect)((()=>{let e=g.current,t=null;return e||(t=setInterval((()=>{e=g.current,e&&clearInterval(t)}),20)),()=>{t&&clearInterval(t),e&&e.disconnectedCallback()}}),[g]),n.createElement("div",{className:"w-full",ref:h},n.createElement(M.we,{class:"w-full",placement:N.et.HYPELAB_INTERNAL_NATIVE_PLACEMENT_SLUG,onError:o},n.createElement("span",{className:"hidden",ref:m,"data-ref":"headline"}),n.createElement("span",{className:"hidden",ref:d,"data-ref":"body"}),n.createElement("a",{className:"hidden",ref:p,href:"/","data-ref":"ctaLink"},n.createElement("img",{className:"hidden",ref:f,"data-ref":"icon",alt:""})),n.createElement(H,{accountPkh:e,href:A||"/",imageSrc:E||J,isVisible:t,headline:b,contentText:v,providerTitle:a.HypeLab,pageName:r,onAdRectVisible:i,onImageError:o})))},K=(0,n.memo)((({variant:e,...t})=>e===A.Image?n.createElement(D,{...t}):n.createElement(W,{...t}))),Q=e=>Date.now()-e<d.Gt,Z=(0,n.memo)((0,n.forwardRef)((({variant:e,id:t,pageName:r,className:g},b)=>{const E=e===A.Image,k=(0,c.G)(),{evmAddress:w}=(0,o.P)(),y=(0,l.wA)(),N=(0,u.B)(t),P=(0,u.x)(),[I,x]=(0,n.useState)(Q(N)),[R,L]=(0,n.useState)(!1),[T,S]=(0,n.useState)(!1);(0,n.useEffect)((()=>{const e=Q(N);if(x(e),e){const e=setTimeout((()=>x(!1)),Math.max(Date.now()-N+d.Gt,0));return()=>clearTimeout(e)}}),[N]);const _=(0,n.useCallback)((()=>{(0,m.postAdImpression)(k,a.HypeLab,{pageName:r})}),[r,k]),D=(0,n.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),y((0,i.m)({timestamp:Date.now(),id:t}))}),[t,y]),V=(0,n.useCallback)((()=>L(!0)),[]),C=(0,n.useCallback)((()=>S(!0)),[]),{data:M,isLoading:U}=(0,h.u)("enable-internal-hypelab-ads",m.fetchEnableInternalHypelabAds,{revalidateOnFocus:!1,revalidateOnMount:!0,revalidateOnReconnect:!1,refreshInterval:p.t}),z=(0,n.useRef)(M),O=I||U&&void 0===M;return(0,n.useEffect)((()=>{const e=z.current;z.current=M,!1===M&&V(),!1===e&&M&&(S(!1),L(!1))}),[M,V]),!P||R||O?null:n.createElement("div",{ref:b,className:(0,s.A)("group w-full relative flex flex-col items-center",!T&&(E?"min-h-[101px]":"min-h-16"),g)},n.createElement(K,{accountPkh:w,variant:e,isVisible:T,pageName:r,onImpression:_,onReady:C,onError:V}),!T&&n.createElement("div",{className:"absolute inset-0 bg-grey-4 text-secondary flex justify-center items-center rounded-lg"},n.createElement("span",{className:"text-font-description-bold text-grey-2"},n.createElement(f.T,{id:"thanksForSupportingTemple"}))),n.createElement(v,{className:"opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto",onClick:D}))})))},40847:(e,t,r)=>{r.r(t),r.d(t,{fetchEnableInternalHypelabAds:()=>v,fetchReferralsAffiliateLinks:()=>p,fetchReferralsRules:()=>d,fetchRpForMonth:()=>g,fetchRpForToday:()=>h,fetchTempleReferralLinkItems:()=>f,postAdImpression:()=>c,postAnonymousAdImpression:()=>i,postLinkAdsImpressions:()=>m,postReactivationCheck:()=>b,postReferralClick:()=>u});var a=r(71083),n=r(43391),s=r(13695),l=r(9493);const o=a.A.create({baseURL:s.et.TEMPLE_ADS_API_URL,adapter:"fetch",headers:{"x-temple-browser":n.x}});async function c({tezosAddress:e,evmAddress:t},r,{urlDomain:a,pageName:n}){await o.post("/impression",{accountPkh:e,evmPkh:t,urlDomain:a,pageName:n,provider:r,appVersion:s.hl})}async function i(e,t,r){await o.post("/impression",{installId:e,urlDomain:t,provider:r,appVersion:s.hl})}async function u({tezosAddress:e,evmAddress:t},r,{urlDomain:a,pageDomain:n,provider:l}){await o.post("/takeads/referrals/click",{provider:l,accountPkh:e,evmPkh:t,installId:r,urlDomain:a,pageDomain:n,appVersion:s.hl})}async function m({tezosAddress:e,evmAddress:t},r,a){await o.post("/link-impressions",{accountPkh:e,evmPkh:t,installId:r,signature:a,appVersion:s.hl})}const d=(0,l.q)((()=>o.get("/takeads/referrals/rules"))),p=(0,l.q)((e=>o.post("/takeads/referrals/affiliate-links",e).catch((e=>{throw e})))),f=(0,l.q)((e=>o.get("/temple/referrals/links",{params:{browser:e}}))),h=(0,l.q)((e=>o.get("/rp/today",{params:{accountPkh:e,tzOffset:(new Date).getTimezoneOffset()}}))),g=(0,l.q)(((e,t)=>o.get("/rp/month",{params:{accountPkh:e,monthYearIndex:t,tzOffset:(new Date).getTimezoneOffset()}})));async function b(e){const{data:t}=await o.post("/reactivation/check",{tezos:e,appVersion:s.hl});return t}const v=(0,l.q)((()=>o.get(`/ads-rules/${s.hl}/enable-internal-hypelab-ads`)))}}]);