"use strict";(globalThis.webpackChunk_coral_xyz_app_extension=globalThis.webpackChunk_coral_xyz_app_extension||[]).push([[3334],{173334:(e,t,n)=>{n.r(t),n.d(t,{HardwareSignRequest:()=>xe});var r=n(817967),a=n(813586),s=n(997246),i=n(639784),o=n(337288),c=n(622845),u=n(382740),d=n(713979),g=n(285997),_=n.n(g),l=n(187254),E=n(202784),S=n(639460),A=n(270254),m=n(369297),p=n(762520),R=n.n(p),h=n(817022),f=n(374196),w=n(997797),I=n(317271),q=n(202784),T=n(348834).Buffer;function v({currentRequest:e}){const[t,n]=(0,E.useState)(null),[r,s]=(0,E.useState)(l.ag._({id:"62q4zJ"})),i="USB_PERMISSIONS_NOT_AVAILABLE"===t,u=(0,E.useCallback)((()=>{!async function(){const t={HARDWARE_SVM_SIGN_TX:N,HARDWARE_SVM_SIGN_MESSAGE:D,HARDWARE_EVM_SIGN_TX:y,HARDWARE_EVM_SIGN_MESSAGE:x,HARDWARE_EVM_SIGN_TYPED_DATA:M,HARDWARE_SUIVM_SIGN_TRANSACTION:()=>Promise.reject(new Error(l.ag._({id:"z7w0ty"}))),HARDWARE_SUIVM_SIGN_MESSAGE:()=>Promise.reject(new Error(l.ag._({id:"z7w0ty"}))),HARDWARE_APTOSVM_SIGN_TRANSACTION:()=>Promise.reject(new Error(l.ag._({id:"O3dexd"}))),HARDWARE_TRONVM_SIGN_MESSAGE:()=>Promise.reject(new Error(l.ag._({id:"akjw1v"}))),HARDWARE_TRONVM_SIGN_TRANSACTION:()=>Promise.reject(new Error(l.ag._({id:"akjw1v"})))}[e.name];await(t?.(e,s).catch((e=>{s((0,I.F)(e)),n(e.message)})))}()}),[e.id]);let d;if((0,E.useEffect)((()=>{u()}),[u]),"HARDWARE_SVM_SIGN_TX"===e.event.name){const t=e.request,n=`${t.transactionNumber}/${t.totalTransactions}`;d=l.ag._({id:"SarLqU",values:{progress:n}})}return q.createElement(w.Q,{title:d,leftButton:l.ag._({id:"dEgA5A"}),onApprove:()=>{i?((0,a._S)("usb"),window.close()):(n(null),u())},rightButton:i?l.ag._({id:"fysFqu"}):l.ag._({id:"KDw4GX"}),onDeny:()=>e.error(new Error(l.ag._({id:"5VjndA"}))),buttonDirection:"column-reverse"},q.createElement(o.FA,{gap:40},t?q.createElement(o.FA,{alignItems:"center"},q.createElement(c.Jc,{height:100,width:100})):q.createElement(A.s,{title:r,icon:()=>q.createElement(c.VO,{height:48,width:48})})))}async function N(e,t){t(l.ag._({id:"/ezF4k"}));const n=JSON.parse(e.request.deviceData).mfp;return(0,I.J)().then((r=>(t(l.ag._({id:"62q4zJ"})),new(R())(r,n).signTransaction(e.request.derivationPath,T.from((0,h.decode)(e.request.txMessage)))))).then((t=>{e.respond({signature:(0,h.encode)(t.signature)})}))}async function D(e,t){t(l.ag._({id:"/ezF4k"}));const n=JSON.parse(e.request.deviceData).mfp;return(0,I.J)().then((r=>(t(l.ag._({id:"62q4zJ"})),new(R())(r,n).signOffchainMessage(e.request.derivationPath,T.from((0,h.decode)(e.request.message)))))).then((t=>{e.respond({signature:(0,h.encode)(t.signature)})}))}async function y(e,t){t(l.ag._({id:"VyAElD"}));const n=JSON.parse(e.request.deviceData).mfp,r=e.request.txHex,a=0===f.Y.from(r).type;return(0,I.J)().then((s=>(t(l.ag._({id:"62q4zJ"})),new m.Eth(s,n).signTransaction(e.request.derivationPath,r.startsWith("0x")?r.slice(2):r,a)))).then((t=>{const n=f.Y.from(e.request.txHex);n.signature=`0x${t.r}${t.s}${t.v}`,e.respond({signedTxHex:n.serialized})}))}async function x(e,t){t(l.ag._({id:"VyAElD"}));const n=JSON.parse(e.request.deviceData).mfp;return(0,I.J)().then((r=>(t(l.ag._({id:"62q4zJ"})),new m.Eth(r,n).signPersonalMessage(e.request.derivationPath,T.from((0,h.decode)(e.request.message58)).toString("utf-8"))))).then((t=>{e.respond({signatureHex:`0x${t.r}${t.s}${t.v}`})}))}async function M(e,t){t(l.ag._({id:"VyAElD"}));const n=JSON.parse(e.request.deviceData).mfp,r=JSON.parse(e.request.payload);return(0,I.J)().then((a=>(t(l.ag._({id:"62q4zJ"})),new m.Eth(a,n).signEIP712Message(e.request.derivationPath,r)))).then((t=>{e.respond({signatureHex:`0x${t.r}${t.s}${t.v}`})}))}var H=n(348888),G=n(71093),P=n(348834).Buffer;var V=n(894733),O=n(202784),W=n(348834).Buffer;function b({currentRequest:e}){const[t,n]=(0,E.useState)(null);return"HARDWARE_SUIVM_SIGN_TRANSACTION"===e.event.name||"HARDWARE_SUIVM_SIGN_MESSAGE"===e.event.name||"HARDWARE_APTOSVM_SIGN_TRANSACTION"===e.event.name?O.createElement(B,{currentRequest:e}):null!==t?O.createElement(V.$,{onReset:()=>e.error(new Error(l.ag._({id:"tVV+OU"})))},"QR"===t?O.createElement(B,{currentRequest:e}):O.createElement(X,{currentRequest:e})):O.createElement(w.Q,{leftButton:l.ag._({id:"qc9CAh"}),rightButton:l.ag._({id:"dl77xO"}),onApprove:()=>n("USB"),onDeny:()=>n("QR"),buttonDirection:"column"},O.createElement(o.FA,{gap:40},O.createElement(i.V,{title:l.ag._({id:"H0o67n"})}),O.createElement(o.FA,{alignItems:"center"},O.createElement(c.mN,{height:150,width:150}))))}function U(){return O.createElement("svg",{width:"48",height:"48",viewBox:"0 0 96 96",fill:"none",xmlns:"http://www.w3.org/2000/svg"},O.createElement("path",{d:"M18 15H54L30 66H12L18 15Z",fill:"white"}),O.createElement("path",{d:"M78 81L42 81L66 30L84 30L78 81Z",fill:"#1F5AFF"}))}function B({currentRequest:e}){const[t,n]=(0,E.useState)(null),[r,i]=(0,E.useState)(!1),A=(0,E.useMemo)((()=>(0,S.Z)()),[]),m=function(e,t){switch(e.name){case"HARDWARE_SVM_SIGN_MESSAGE":return function(e,t){const n={requestId:t,xfp:JSON.parse(e.request.deviceData).mfp,path:`m/${e.request.derivationPath}`,signData:P.from((0,h.decode)(e.request.message)).toString("hex"),origin:"Backpack",dataType:g.KeystoneSolanaSDK.DataType.Message};return(new(_())).sol.generateSignRequest(n)}(e,t);case"HARDWARE_SVM_SIGN_TX":return function(e,t){const n={requestId:t,xfp:JSON.parse(e.request.deviceData).mfp,path:`m/${e.request.derivationPath}`,signData:P.from((0,h.decode)(e.request.txMessage)).toString("hex"),origin:"Backpack",dataType:g.KeystoneSolanaSDK.DataType.Transaction};return(new(_())).sol.generateSignRequest(n)}(e,t);case"HARDWARE_EVM_SIGN_MESSAGE":return function(e,t){const n={requestId:t,xfp:JSON.parse(e.request.deviceData).mfp,path:e.request.derivationPath,signData:P.from((0,h.decode)(e.request.message58)).toString("hex"),origin:"Backpack",dataType:g.KeystoneEthereumSDK.DataType.personalMessage};return(new(_())).eth.generateSignRequest(n)}(e,t);case"HARDWARE_EVM_SIGN_TYPED_DATA":return function(e,t){const n={requestId:t,xfp:JSON.parse(e.request.deviceData).mfp,path:e.request.derivationPath,signData:P.from(e.request.payload,"utf-8").toString("hex"),origin:"Backpack",dataType:g.KeystoneEthereumSDK.DataType.typedData};return(new(_())).eth.generateSignRequest(n)}(e,t);case"HARDWARE_EVM_SIGN_TX":return function(e,t){const n=e.request.txHex,r=0===f.Y.from(n).type?g.KeystoneEthereumSDK.DataType.transaction:g.KeystoneEthereumSDK.DataType.typedTransaction,a={requestId:t,xfp:JSON.parse(e.request.deviceData).mfp,path:e.request.derivationPath,signData:n.startsWith("0x")?n.slice(2):n,origin:"Backpack",dataType:r};return(new(_())).eth.generateSignRequest(a)}(e,t);case"HARDWARE_SUIVM_SIGN_TRANSACTION":return function(e,t){const n={requestId:t,intentMessage:(0,H.NC)((0,G.Gh)(e.request.tx)),accounts:[{xfp:JSON.parse(e.request.deviceData).mfp,path:`m/${e.request.derivationPath}`}],origin:"Backpack"};return(new(_())).sui.generateSignRequest(n)}(e,t);case"HARDWARE_SUIVM_SIGN_MESSAGE":return function(e,t){const n={requestId:t,intentMessage:(0,H.NC)((0,G.Gh)(e.request.message)),accounts:[{xfp:JSON.parse(e.request.deviceData).mfp,path:`m/${e.request.derivationPath}`}],origin:"Backpack"};return(new(_())).sui.generateSignRequest(n)}(e,t);case"HARDWARE_APTOSVM_SIGN_TRANSACTION":return function(e,t){const n={requestId:t,signData:e.request.tx,accounts:[{xfp:JSON.parse(e.request.deviceData).mfp,path:`m/${e.request.derivationPath}`}],origin:"Backpack",signType:1};return(new(_())).aptos.generateSignRequest(n)}(e,t);default:throw new Error(l.ag._({id:"71Xwww"}))}}(e,A),[p,R]=(0,E.useState)(!1),I=(0,E.useCallback)((({type:t,cbor:r})=>{const a=new g.UR(W.from(r,"hex"),t);try{!function(e,t,n){const r=new(_()),a=e.name.includes("SVM"),s=e.name.includes("EVM"),i=e.name.includes("SUIVM"),o=e.name.includes("APTOSVM");if(a){const{requestId:a,signature:s}=r.sol.parseSignature(n);if(a!==t)throw new Error(l.ag._({id:"qf1gj7"}));e.respond({signature:(0,h.encode)(P.from(s,"hex"))})}if(s){const{requestId:a,signature:s}=r.eth.parseSignature(n);if(a!==t)throw new Error(l.ag._({id:"Ed/vRe"}));if("HARDWARE_EVM_SIGN_TX"===e.name){const t=e.request.txHex,n=f.Y.from(t);n.signature=`0x${s}`,e.respond({signedTxHex:n.serialized})}else e.respond({signatureHex:`0x${s}`})}if(i){const{requestId:a,signature:s}=r.sui.parseSignature(n);if(a!==t)throw new Error(l.ag._({id:"Ed/vRe"}));e.respond({signature:(0,G.s3)((0,H.H_)(s))})}if(o){const{requestId:a,signature:s}=r.aptos.parseSignature(n);if(a!==t)throw new Error(l.ag._({id:"Ed/vRe"}));e.respond({signature:s})}}(e,A,a)}catch(e){n(e.message)}}),[e,A,n]),q=(0,E.useCallback)((()=>{n(l.ag._({id:"74mWE3"}))}),[n]);let T;if("HARDWARE_SVM_SIGN_TX"===e.event.name){const t=e.request,n=`${t.transactionNumber}/${t.totalTransactions}`;T=l.ag._({id:"SarLqU",values:{progress:n}})}return O.createElement(O.Fragment,null,O.createElement(w.Q,{title:T,leftButton:l.ag._({id:"dEgA5A"}),onApprove:()=>{i(!0)},rightButton:p?O.createElement(s.x,{variant:"primary",label:l.ag._({id:"fysFqu"}),onPress:()=>{(0,a._S)("qr"),window.close()}}):r?null:l.ag._({id:"MKUQhN"}),onDeny:()=>e.error(new Error(l.ag._({id:"5VjndA"}))),buttonDirection:"column-reverse"},O.createElement(o.FA,{gap:40,mt:40,ai:"center"},O.createElement(o.FA,{gap:16,ai:"center"},O.createElement(U,null),O.createElement(u.q,{color:"$baseTextMedEmphasis",textAlign:"center"},r?l.ag._({id:"Dgyv4v"}):l.ag._({id:"zGo5SX"}))),O.createElement(o.FA,{ai:"center",width:200,height:200,borderRadius:8,overflow:"hidden",position:"relative"},r?O.createElement(O.Fragment,null,O.createElement(d.AnimatedQRScanner,{handleScan:I,handleError:q,urTypes:[d.URType.SOL_SIGNATURE,d.URType.ETH_SIGNATURE,g.URType.SuiSignature,g.URType.AptosSignature],options:{width:200,height:200},videoLoaded:(e,t)=>{R("NO_WEBCAM_ACCESS"===t&&!e),n(e?"":l.ag._({id:"xCc1BX"}))}}),""!==t&&O.createElement(o.FA,{gap:16,position:"absolute",height:200,width:200,zIndex:1,top:0,left:0,borderRadius:16,jc:"center",ai:"center"},O.createElement(c.Jc,{height:40,width:40}),O.createElement(u.q,{textAlign:"center"},t))):O.createElement(d.AnimatedQRCode,{type:m.type,cbor:m.cbor.toString("hex"),options:{size:200}})))))}function X({currentRequest:e}){return O.createElement(v,{currentRequest:e})}var Z=n(801384),$=n(201462),C=n(849810),J=n(616102),L=n(819009),z=n(219968),j=n(858106),k=n(204534),K=n(484914),F=n(322492),Q=n(197699),Y=n.n(Q),ee=n(870201),te=n(311954),ne=n(202784),re=n(348834).Buffer;function ae({currentRequest:e}){return ne.createElement(V.$,{onReset:()=>e.error(new Error(l.ag._({id:"tVV+OU"})))},ne.createElement(se,{currentRequest:e}))}function se({currentRequest:e}){const[t,n]=(0,E.useState)(null),[r,s]=(0,E.useState)("Approve the signature request using your Ledger"),i="HID_PERMISSIONS_NOT_AVAILABLE"===t,u="HID_GESTURE_REQUIRED"===t,d=t?.includes("blind signing")??!1,g=(0,E.useCallback)((()=>{!async function(){const t={HARDWARE_SVM_SIGN_TX:ie,HARDWARE_SVM_SIGN_MESSAGE:oe,HARDWARE_EVM_SIGN_TX:ce,HARDWARE_EVM_SIGN_MESSAGE:ue,HARDWARE_EVM_SIGN_TYPED_DATA:de,HARDWARE_SUIVM_SIGN_TRANSACTION:ge,HARDWARE_SUIVM_SIGN_MESSAGE:_e,HARDWARE_APTOSVM_SIGN_TRANSACTION:le,HARDWARE_TRONVM_SIGN_TRANSACTION:Se,HARDWARE_TRONVM_SIGN_MESSAGE:Ee}[e.name];await(t?.(e,s).catch((t=>{"HID_PERMISSIONS_NOT_AVAILABLE"===t.message?(n(t.message),s("Missing HID browser permissions.")):"HID_GESTURE_REQUIRED"===t.message?(n(t.message),s("Ledger Connection lost.")):"SOLANA_VERSION_1-8-0"===t.message?(n(t.message),s("Update Solana App to >= v1.8.0 on your Ledger")):t.message?.includes("blind signing")?(n(t.message),s(l.ag._({id:"tU8+on"}))):(s(t.message),n(t.message),e.error(t instanceof Error?t:new Error(t)))})))}()}),[e.id]);let _;if((0,E.useEffect)((()=>{g()}),[g]),"HARDWARE_SVM_SIGN_TX"===e.event.name){const t=e.request,n=`${t.transactionNumber}/${t.totalTransactions}`;_=l.ag._({id:"SarLqU",values:{progress:n}})}return ne.createElement(w.Q,{title:_,leftButton:l.ag._({id:"dEgA5A"}),onApprove:()=>{i&&((0,a.YX)(),window.close()),(u||d)&&(n(null),s("Approve the signature request using your Ledger"),g())},rightButton:i?l.ag._({id:"ta324B"}):u||d?l.ag._({id:"7yQXR4"}):null,onDeny:()=>e.error(new Error(l.ag._({id:"5VjndA"}))),buttonDirection:"column-reverse"},ne.createElement(o.FA,{flex:1,gap:40,justifyContent:"center",alignItems:"center"},t?ne.createElement(o.FA,{alignItems:"center",gap:"$4"},ne.createElement(c.Jc,{height:100,width:100}),ne.createElement($.h,{textAlign:"center",fontSize:"$lg",fontWeight:"$medium",color:"$baseTextMedEmphasis"},r)):ne.createElement(A.s,{title:r,icon:()=>ne.createElement(c.pN,null)})))}async function ie(e,t){const[n,r]=(0,te.j)((()=>j.Z.create()),(t=>()=>new L.Z(t).signTransaction(e.request.derivationPath,re.from((0,h.decode)(e.request.txMessage)))),(e=>{const n=[l.ag._({id:"dXlKXl"}),l.ag._({id:"av0w1U"}),l.ag._({id:"UwXdNn"}),l.ag._({id:"xs1dhA"}),l.ag._({id:"WbR/7S"})];t(n[e])}));return e.addBeforeResponseHandler((async()=>r(new Error(l.ag._({id:"bAZT1E"}))))),n.then((t=>{e.respond({signature:(0,h.encode)(t.signature)})}))}async function oe(e,t){const[n,r]=(0,te.j)((()=>j.Z.create()),(t=>async()=>{const n=new L.Z(t),r=await n.getAppConfiguration();if(!Y().satisfies(r.version,">=1.8.0"))throw new Error("SOLANA_VERSION_1-8-0");return n.signOffchainMessage(e.request.derivationPath,re.from((0,h.decode)(e.request.message)))}),(e=>{const n=[l.ag._({id:"dXlKXl"}),l.ag._({id:"av0w1U"}),l.ag._({id:"UwXdNn"}),l.ag._({id:"xs1dhA"}),l.ag._({id:"WbR/7S"})];t(n[e])}));return e.addBeforeResponseHandler((async()=>r(new Error(l.ag._({id:"bAZT1E"}))))),n.then((t=>{e.respond({signature:(0,h.encode)(t.signature)})}))}async function ce(e,t){const n=e.request.txHex;if(!n||"0x"===n||n.length<3)throw new Error("Invalid transaction hex");const r=n.substring(2);let a=null,s=!1;const i=async function(e,t=5e3){return Promise.race([J.Jb.resolveTransaction(e,{},{erc20:!0,nft:!0}),new Promise((e=>setTimeout((()=>e(null)),t)))]).catch((()=>null))}(r).then((e=>{null!==a||s||(a=e)})),[o,c]=(0,te.j)((()=>j.Z.create()),(t=>async()=>{await i;const n=new J.ZP(t);return await n.signTransaction(e.request.derivationPath,r,a)}),(e=>{const n=[l.ag._({id:"dXlKXl"}),l.ag._({id:"av0w1U"}),l.ag._({id:"zBAeQW"}),l.ag._({id:"GcWOv+"}),l.ag._({id:"WbR/7S"})];t(n[e])}),(()=>null===a||(s=!0,a=null,!1)));return e.addBeforeResponseHandler((async()=>c(new Error(l.ag._({id:"bAZT1E"}))))),o.then((t=>{const n=f.Y.from(e.request.txHex);n.signature={r:"0x"+t.r,s:"0x"+t.s,v:parseInt(t.v)},e.respond({signedTxHex:n.serialized})}))}async function ue(e,t){const[n,r]=(0,te.j)((()=>j.Z.create()),(t=>()=>new J.ZP(t).signPersonalMessage(e.request.derivationPath,re.from((0,h.decode)(e.request.message58)).toString("hex"))),(e=>{const n=[l.ag._({id:"dXlKXl"}),l.ag._({id:"av0w1U"}),l.ag._({id:"zBAeQW"}),l.ag._({id:"xs1dhA"}),l.ag._({id:"WbR/7S"})];t(n[e]??"")}));return e.addBeforeResponseHandler((async()=>r(new Error(l.ag._({id:"bAZT1E"}))))),n.then((t=>{e.respond({signatureHex:K.P.from({r:"0x"+t.r,s:"0x"+t.s,v:t.v}).serialized})}))}async function de(e,t){const{domain:n,message:r,types:a}=JSON.parse(e.request.payload);delete a.EIP712Domain;const s=F.E.from(a).hash(r),i=F.E.hashDomain(n),[o,c]=(0,te.j)((()=>j.Z.create()),(t=>()=>new J.ZP(t).signEIP712HashedMessage(e.request.derivationPath,i,s)),(e=>{const n=[l.ag._({id:"dXlKXl"}),l.ag._({id:"av0w1U"}),l.ag._({id:"zBAeQW"}),l.ag._({id:"xs1dhA"}),l.ag._({id:"WbR/7S"})];t(n[e]??"")}));return e.addBeforeResponseHandler((async()=>c(new Error(l.ag._({id:"bAZT1E"}))))),o.then((t=>{e.respond({signatureHex:K.P.from({r:"0x"+t.r,s:"0x"+t.s,v:t.v}).serialized})}))}async function ge(e,t){const[n,r]=(0,te.j)((()=>j.Z.create()),(t=>()=>new k.Z(t).signTransaction(e.request.derivationPath,(0,G.Gh)(e.request.tx))),(e=>{const n=[l.ag._({id:"dXlKXl"}),l.ag._({id:"av0w1U"}),l.ag._({id:"y3jvcW"}),l.ag._({id:"GcWOv+"}),l.ag._({id:"WbR/7S"})];t(n[e])}));return e.addBeforeResponseHandler((async()=>r(new Error(l.ag._({id:"bAZT1E"}))))),n.then((t=>{e.respond({signature:(0,G.s3)(t.signature)})}))}async function _e(e,t){const[n,r]=(0,te.j)((()=>j.Z.create()),(t=>()=>new k.Z(t).signTransaction(e.request.derivationPath,(0,G.Gh)(e.request.message))),(e=>{const n=[l.ag._({id:"dXlKXl"}),l.ag._({id:"av0w1U"}),l.ag._({id:"y3jvcW"}),l.ag._({id:"vB5rsZ"}),l.ag._({id:"WbR/7S"})];t(n[e])}));return e.addBeforeResponseHandler((async()=>r(new Error(l.ag._({id:"bAZT1E"}))))),n.then((t=>{e.respond({signature:(0,G.s3)(t.signature)})}))}async function le(e,t){const[n,r]=(0,te.j)((()=>j.Z.create()),(t=>async()=>{const n=new C.Z(t),{publicKey:r}=await n.getAddress(e.request.derivationPath),a=re.from(e.request.tx,"base64"),{signature:s}=await n.signTransaction(e.request.derivationPath,a);return{signature:s,publicKey:r}}),(e=>{const n=[l.ag._({id:"dXlKXl"}),l.ag._({id:"av0w1U"}),l.ag._({id:"LdsSh0"}),l.ag._({id:"GcWOv+"}),l.ag._({id:"WbR/7S"})];t(n[e])}));return e.addBeforeResponseHandler((async()=>r(new Error(l.ag._({id:"bAZT1E"}))))),n.then((t=>{const n=new Z.EZS(t.publicKey),r=new Z.AoU(t.signature),a=new Z.rEE(n,r).bcsToBytes();e.respond({signature:re.from(a).toString("base64")})}))}async function Ee(e,t){const[n,r]=(0,te.j)((()=>j.Z.create()),(t=>()=>new z.Z(t).signPersonalMessage(e.request.derivationPath,e.request.message)),(e=>{const n=[l.ag._({id:"dXlKXl"}),l.ag._({id:"av0w1U"}),l.ag._({id:"icv2/H"}),l.ag._({id:"vB5rsZ"}),l.ag._({id:"WbR/7S"})];t(n[e])}));return e.addBeforeResponseHandler((async()=>r(new Error(l.ag._({id:"bAZT1E"}))))),n.then((t=>{e.respond({signature:t})}))}async function Se(e,t){const[n,r]=(0,te.j)((()=>j.Z.create()),(t=>()=>{const n=new z.Z(t),r=re.from(e.request.tx,"base64").toString(),a=ee.P6.transaction.txJsonToPb(JSON.parse(r));return n.signTransaction(e.request.derivationPath,ee.P6.transaction.txPbToRawDataHex(a),[])}),(e=>{const n=[l.ag._({id:"dXlKXl"}),l.ag._({id:"av0w1U"}),l.ag._({id:"icv2/H"}),l.ag._({id:"GcWOv+"}),l.ag._({id:"WbR/7S"})];t(n[e])}));return e.addBeforeResponseHandler((async()=>r(new Error(l.ag._({id:"bAZT1E"}))))),n.then((t=>{e.respond({signature:t})}))}function Ae(e){return null}var me=n(594696),pe=n(798534),Re=n(724542),he=n(202784),fe=n(348834).Buffer;function we({currentRequest:e}){return(0,pe.k)()?he.createElement(V.$,{onReset:()=>e.error(new Error(l.ag._({id:"tVV+OU"})))},he.createElement(Ie,{currentRequest:e})):he.createElement(me.Z,null)}function Ie({currentRequest:e}){const[t,n]=(0,E.useState)(null),[r,a]=(0,E.useState)("Continue in Trezor Connect popup."),s="HID_PERMISSIONS_NOT_AVAILABLE"===t,i="HID_GESTURE_REQUIRED"===t,u=(0,E.useCallback)((()=>{!async function(){const t={HARDWARE_SVM_SIGN_TX:qe,HARDWARE_SVM_SIGN_MESSAGE:Te,HARDWARE_EVM_SIGN_TX:ve,HARDWARE_EVM_SIGN_MESSAGE:Ne,HARDWARE_EVM_SIGN_TYPED_DATA:De,HARDWARE_SUIVM_SIGN_TRANSACTION:()=>Promise.reject(new Error(l.ag._({id:"tJqie5"}))),HARDWARE_SUIVM_SIGN_MESSAGE:()=>Promise.reject(new Error(l.ag._({id:"tJqie5"}))),HARDWARE_APTOSVM_SIGN_TRANSACTION:()=>Promise.reject(new Error(l.ag._({id:"noCc0J"}))),HARDWARE_TRONVM_SIGN_TRANSACTION:()=>Promise.reject(new Error(l.ag._({id:"R9VvwO"}))),HARDWARE_TRONVM_SIGN_MESSAGE:()=>Promise.reject(new Error(l.ag._({id:"R9VvwO"})))}[e.name];await(t?.(e,a).catch((t=>{"HID_PERMISSIONS_NOT_AVAILABLE"===t.message?(n(t.message),a("Missing HID browser permissions.")):"HID_GESTURE_REQUIRED"===t.message?(n(t.message),a("Trezor Connection lost.")):(a(t.message),n(t.message),e.error(t instanceof Error?t:new Error(t)))})))}()}),[e.id]);let d;if((0,E.useEffect)((()=>{u()}),[u]),"HARDWARE_SVM_SIGN_TX"===e.event.name){const t=e.request,n=`${t.transactionNumber}/${t.totalTransactions}`;d=l.ag._({id:"SarLqU",values:{progress:n}})}return he.createElement(w.Q,{title:d,leftButton:l.ag._({id:"dEgA5A"}),onApprove:()=>{s&&window.close(),i&&(n(null),u())},rightButton:s?l.ag._({id:"nXGc4v"}):i?l.ag._({id:"KDw4GX"}):null,onDeny:()=>e.error(new Error(l.ag._({id:"5VjndA"}))),buttonDirection:"column-reverse"},he.createElement(o.FA,{gap:40},t?he.createElement(o.FA,{alignItems:"center"},he.createElement(c.Jc,{height:100,width:100})):he.createElement(A.s,{title:l.ag._({id:"hoMane"}),subtitle:r,icon:()=>he.createElement("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"currentColor"},he.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})),spinnerSize:100,iconSize:48})))}async function qe(e,t){const{derivationPath:n,txMessage:r}=e.request,a=fe.from((0,h.decode)(r)).toString("hex"),s=n.startsWith("m/")?n:`m/${n}`,i=await Re.Z.solanaSignTransaction({path:s,serializedTx:a});if(!1===i.success)throw new Error(i.payload.error);e.respond({signature:(0,h.encode)(fe.from(i.payload.signature,"hex"))})}async function Te(e,t){throw new Error("Not implemented")}async function ve(e,t){const{derivationPath:n}=e.request,r=f.Y.from(e.request.txHex),a=n.startsWith("m/")?n:`m/${n}`,s=await Re.Z.ethereumSignTransaction({path:a,transaction:r.gasPrice?{to:r.to,value:r.value.toString(16),data:r.data,chainId:parseInt(r.chainId.toString(),10),nonce:r.nonce.toString(16),gasPrice:r.gasPrice.toString(16),gasLimit:r.gasLimit.toString(16)}:{to:r.to,value:r.value.toString(16),data:r.data,chainId:parseInt(r.chainId.toString(),10),nonce:r.nonce.toString(16),maxFeePerGas:r.maxFeePerGas.toString(16),maxPriorityFeePerGas:r.maxPriorityFeePerGas.toString(16),gasLimit:r.gasLimit.toString(16)}});if(!1===s.success)throw new Error(s.payload.error);e.respond({signedTxHex:s.payload.serializedTx})}async function Ne(e,t){const n=await Re.Z.ethereumSignMessage({path:e.request.derivationPath,message:fe.from((0,h.decode)(e.request.message58)).toString("hex"),hex:!0});if(!1===n.success)throw new Error(n.payload.error);e.respond({signatureHex:n.payload.signature})}async function De(e,t){const n=JSON.parse(e.request.payload),{domain:r,message:a,types:s}=n,i={...s};delete i.EIP712Domain;const o=F.E.from(i).hash(a),c=F.E.hashDomain(r),u=await Re.Z.ethereumSignTypedData({path:e.request.derivationPath,data:n,metamask_v4_compat:!0,domain_separator_hash:c,message_hash:o});if(!1===u.success)throw new Error(u.payload.error);e.respond({signatureHex:u.payload.signature})}var ye=n(202784);function xe({currentRequest:e}){switch(e.request.device){case r.$I.KEYSTONE:return ye.createElement(b,{currentRequest:e});case r.$I.LEDGER:return ye.createElement(ae,{currentRequest:e});case r.$I.TREZOR:return ye.createElement(we,{currentRequest:e});case r.$I.SAGA_SEED_VAULT:return ye.createElement(Ae,{currentRequest:e})}}}}]);