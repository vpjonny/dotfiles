(()=>{function a(){function a(){return(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)).substring(0,22)}const G=document.head.querySelector("script[bis_use][data-dynamic-id]")?.getAttribute("data-dynamic-id")||"",E=function(){let E=sessionStorage.getItem("bis_data");if(null!==E)return JSON.parse(E);try{let E={posdMessageId:"PANELOS_MESSAGE",posdHash:a(),type:"CONFIG_NOT_FOUND",from:"",to:"",content:"configuration not found",dynamicAppId:G};window.postMessage(E)}catch(a){}return null}(),K=E?E.config.facebookConfig.videoDetectorConfigNew:null,q=E?E.id+"_w":null;const o="SCRIPT",i="XML_HTTP_REQUEST",D="INSTREAM_CONFIG",j="MARKETPLACE_VIDEO_AD",A="FEED_VIDEO_AD",F=function(a,G,E="",K="",q="",o="",i="",D="",j="",A=""){return{detectionTime:Date.now()/1e3|0,videoId:a,videoUrl:G,previewImageUrl:K,audioUrl:E,linkDisplay:q,userName:o,adName:i,adLogo:D,videoResolutionId:j,audioResolutionId:A}},d=function(a,G){const E=new RegExp(G,"i"),K=a.match(E),q=G.match(new RegExp("\\?<(?<groupName>.[^>]*)>"))?.groups.groupName;if(!K)return"";if(K.groups&&q)return 0===K.groups[q].search(/"/)?K.groups[q].replace(/"/,""):K.groups[q];let o=K.filter((a=>a));return!!o[1]&&o[1]},c=function(a,G){try{let E=G.replace(/}([\r\n])/g,"}BIS_SEPARATOR").split(/BIS_SEPARATOR/g);const K=a.CHECKER;E=E.filter((a=>K.some((G=>new RegExp(G).test(a)))));const q=[];if(E.length){for(let G of E){let E=G;if("string"==typeof G&&(E=JSON.parse(G)),E.data?.hasOwnProperty("sponsored_auction_distance")&&null===E.data.sponsored_auction_distance)continue;const K=x(E,a);if(!K)continue;const o=p(E,a),i=X(E,a),D=$(E,a.PATH_USER_NAME),j=$(E,a.PATH_VIDEO_REPRESENTATION_ID,parseInt(i)),A=$(E,a.PATH_AUDIO_REPRESENTATION_ID,parseInt(i)),d=F(i,K,"",o,"",D,"","",j,A);i&&q.push(d)}q.forEach((a=>{setTimeout(l(a,"FACEBOOK_VIDEO_DATA"),0)}))}}catch(a){}},Q=function(a,G,E){let K=[];const q=[];try{K.push(JSON.parse(G)),setTimeout(l({url:E,requestMethod:"POST",content:K},"FACEBOOK_INSTREAM_DATA"),0)}catch(o){K=G.replace(/\}([\r\n])/g,"}BIS_SEPARATOR").split(/BIS_SEPARATOR/g),K.forEach((G=>{if(G.length<=3||!a.CHECKER.some((a=>G.includes(a))))return;let E=JSON.parse(G),K=E,o=E;for(let G of a.PATH_NODES){const E=a.PATH_NODES.indexOf(G),o=a.PATH_NODES.length-1;E!==o&&K[G]&&(K=K[G]),E===o&&K[G]&&(K=K[G],K.length?K.forEach((G=>{G.bisLinks={aboutPageLink:N(G,a.PATH_USER_ID)},G.video_id=J(G,a.PATH_VIDEO_ID),q.push(G)})):(K.bisLinks={aboutPageLink:N(K,a.PATH_USER_ID)},K.video_id=J(K,a.PATH_VIDEO_ID),q.push(K)))}for(let G of a.PATH_ALL_VIDEO){const E=a.PATH_ALL_VIDEO.indexOf(G),K=a.PATH_ALL_VIDEO.length-1;if(E!==K&&o[G]&&(o=o[G]),"string"!=typeof G&&E===K&&G.length)if(o.length)o.forEach(((a,E)=>{const K=q[E];if(K.video_id===a.video_id)for(let E of G)if(a[E]){K[E]=a[E];break}}));else if(1===q.length){const a=q[0];if(a.video_id===o.video_id)for(let E of G)if(o[E]){a[E]=o[E];break}}}})),q.forEach((a=>{setTimeout(l({url:E,requestMethod:"POST",content:a},"FACEBOOK_INSTREAM_DATA"),0)}))}},J=function(a,G){let E=a,K=null;for(let a of G){const q=G.indexOf(a),o=G.length-1;q!==o&&E[a]&&(E=E[a]),q===o&&E[a]&&(K=E[a])}return parseInt(K,10)},N=function(a,G){let E=a,K=null;for(let a of G){const q=G.indexOf(a),o=G.length-1;q!==o&&E[a]&&(E=E[a]),q===o&&E[a]&&(K=`https://www.facebook.com/${E[a]}/about`)}return K},u=function(a,G){G=G.replace(/ /g,"");const E=d(G,a.VIDEO_ID);if(!E)return;let q=null,o=null,i="",D="",j="",A="",c="";a.VIDEO_HD_URL&&(q=d(G,a.VIDEO_HD_URL)),a.VIDEO_SD_URL&&!q&&(o=d(G,a.VIDEO_SD_URL)),a.LINK_DISPLAY&&(j=d(G,a.LINK_DISPLAY)),K.VIDEO_AUDIO_URL&&(i=d(G,a.VIDEO_AUDIO_URL),i=i?i.split("\\").join(""):i),a.THUMBNAIL&&(D=d(G,a.THUMBNAIL),D=D?D.split("\\").join(""):D),a.VIDEO_REPRESENTATION_ID&&(A=d(G,a.VIDEO_REPRESENTATION_ID)),a.AUDIO_REPRESENTATION_ID&&(c=d(G,a.AUDIO_REPRESENTATION_ID));let Q=q||o;if(Q){Q=Q.split("\\").join("");const a=F(E,Q,i,D,j,"","","",A,c);setTimeout(l(a,"FACEBOOK_VIDEO_DATA"),0)}},s=function(a,G){try{let E=G.replace(/\}([\r\n])/g,"}BIS_SEPARATOR").split(/BIS_SEPARATOR/g);const K=a.CHECKER;E=E.filter((a=>K.some((G=>new RegExp(G).test(a)))));const q=[];if(E.length){for(let G of E){let E=G;"string"==typeof G&&(E=JSON.parse(G));const K=R(E,a),o=x(E,a),i=p(E,a),D=X(E,a),j=$(E,a.PATH_NAME),A=$(E,a.PATH_LOGO),d=$(E,a.PATH_VIDEO_REPRESENTATION_ID,parseInt(D)),c=$(E,a.PATH_AUDIO_REPRESENTATION_ID,parseInt(D)),Q=F(D,o,K,i,"","",j,A,d,c);D&&o&&q.push(Q)}q.forEach((a=>{setTimeout(l(a,"FACEBOOK_VIDEO_DATA"),0)}))}}catch(a){}},$=function(a,G,E=null){let K="";for(const q of G){const G=q.length;let o=a;for(let a=0;a<G;a++){const i=q[a],D=G-1;if("*"===i&&E){if([o]=o.filter((a=>E===parseInt(a.video_id))),!o)break}else if(i<0)o=o.slice(i,o.length)[0];else{if(!o[i])break;if(a===D){K=o[i];break}a!==D&&(o=o[i])}}}return K},R=function(a,G){let E="";for(const K of G.PATH_AUDIO_URL){const G=K.length;let q=a;for(let a=0;a<G;a++){const o=K[a],i=G-1;if(!q[o])break;a!==i&&q[o]&&(q=q[o]),a===i&&q[o]&&(E=q[o])}}return E},x=function(a,G){let E=null;for(const K of G.PATH_VIDEO_URL){const G=K.length;let q=a;for(let a=0;a<G;a++){const o=K[a],i=G-1;if("object"==typeof q&&q.hasOwnProperty("sponsored_auction_distance")&&null===q.sponsored_auction_distance)break;if(!q[o]&&o.includes&&!o.includes("%%%"))break;if(a!==i&&q[o]&&(q=q[o]),o.includes&&o.includes("%%%")){let[G,K]=o.split("%%%");if(q[G]||q[K]){if(a===i){E=q[G]?q[G]:q[K];break}q=q[G]?q[G]:q[K]}}a===i&&q[o]&&(E=q[o])}}return E},p=function(a,G){let E=null;for(const K of G.PATH_THUMBNAIL){const G=K.length;let q=a;for(let a=0;a<G;a++){const o=K[a],i=G-1;if(!q[o])break;a!==i&&q[o]&&(q=q[o]),a===i&&q[o]&&(E=q[o])}}return E},X=function(a,G){let E=null;for(const K of G.PATH_VIDEO_ID){const G=K.length;let q=a;for(let a=0;a<G;a++){const o=K[a],i=G-1;if(!q[o])break;a!==i&&q[o]&&(q=q[o]),a===i&&q[o]&&(E=q[o])}}return E},w=function(a,G,E=null){const q=function(a,G){G=String(G);const E=K.PARSER_CONFIG[a];return E.SEPARATOR?G.split(E.SEPARATOR):[G]}(G,a);q.forEach((a=>{setTimeout((()=>function(a,G=null,E=null){const q=G?K.PARSERS.filter((a=>a.TYPE===G)):K.PARSERS;for(const K of q)if(K.CHECKER.some((G=>a.includes(G))))try{switch(G){case D:setTimeout((()=>Q(K,a,E)),0);break;case j:setTimeout((()=>s(K,a,E)),0);break;case A:setTimeout((()=>c(K,a,E)),0);break;default:setTimeout((()=>u(K,a)),0)}}catch(a){}}(a,G,E)),0)}))},l=function(E,K){return function(){!function(E,K,q){let o;try{o={posdMessageId:"PANELOS_MESSAGE",posdHash:a(),type:q,from:E,to:E.substring(0,E.length-2),content:K,dynamicAppId:G},window.postMessage(o)}catch(a){}}(q,E,K)}};if(K?.PARSER_CONFIG.SCRIPT.USE){const a=function(){const a=document.querySelectorAll("script");for(const G of a)G.hasAttribute("bis_use")||(G.setAttribute("bis_use","true"),w(G.innerHTML,o))};a(),setInterval(a,K.PARSER_CONFIG.SCRIPT.INTERVAL_MS||5e3)}if(K?.PARSER_CONFIG.LISTEN_HTTP_REQUESTS){let a=XMLHttpRequest.prototype.open,G=XMLHttpRequest.prototype.setRequestHeader,E=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.setRequestHeader=function(){const a=arguments[0].toLowerCase(),E=arguments[1];this.requestHeaders||(this.requestHeaders={}),this.requestHeaders[a]=E,G.apply(this,arguments)},XMLHttpRequest.prototype.open=function(){this.requestMethod=arguments[0],a.apply(this,arguments)},XMLHttpRequest.prototype.send=function(){let a=this.onreadystatechange;return this.onreadystatechange=function(){const G=K.MATCH_URLS,E=K.MATCH_HEADERS,q=this.requestHeaders?Object.keys(this.requestHeaders):null,o=K.PARSER_CONFIG.INSTREAM_CONFIG,F=K.PARSER_CONFIG.MARKETPLACE_VIDEO_AD,d=K.PARSER_CONFIG.FEED_VIDEO_AD;let c=!1,Q=null,J=null;if(q&&(c=q.some((a=>{if(E[a]&&E[a].includes(this.requestHeaders[a]))return Q=a,J=this.requestHeaders[a],!0}))),4===this.readyState&&G.filter((a=>a.indexOf(this.responseURL))).length>0)if(c)switch(!0){case o.USE&&o.HEADERS[Q].includes(J):setTimeout((()=>w(this.response,D,this.responseURL)),0);break;case F.USE&&F.HEADERS[Q].includes(J):setTimeout((()=>w(this.response,j,this.responseURL)),0);break;case d.USE&&d.HEADERS[Q].includes(J):setTimeout((()=>w(this.response,A,this.responseURL)),0)}else setTimeout((()=>w(this.response,i)),0);if(a)return a.apply(this,arguments)},E.apply(this,arguments)}}}a(),window.addEventListener("message",(G=>{switch(G.data?.type){case"CONFIG_UPDATED_IN_STORAGE":return void a();case"FACEBOOK_CANVAS_TEXT":let E=Array.from(document.querySelectorAll(bis_data.config.facebookConfig.QUERY_GET_SPONSORED_CANVAS)),K=null,q=G.data.content.attribute;const o=bis_data.config.facebookConfig.PATH_TO_CANVAS_TEXT;for(let a of E){if(!Object.entries(a).some((a=>{if(a[0].search(/reactFiber/)>=0)return K=a[0],!0})))return void a.setAttribute(q,"");let G=a[K];for(let a of o)G[a]&&(G=G[a]);a.setAttribute(q,G)}}}))})();