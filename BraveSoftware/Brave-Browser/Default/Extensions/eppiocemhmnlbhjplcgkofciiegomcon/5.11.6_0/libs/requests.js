(()=>{"use strict";var e={15913(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.decodeString=void 0;t.decodeString=e=>e.toString(),t.default=t.decodeString},24769(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t._$getRegex=void 0;t._$getRegex=e=>{const t="object"==typeof e;try{return t?new RegExp(e.regex,e.flags):new RegExp(e,"i")}catch{return t?new RegExp(e.regex,"i"):new RegExp(e,"i")}}},35263(e,t,s){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t._$MessageScriptType=t._$MessageContentType=void 0;const o=n(s(15913));t._$MessageContentType=Object.freeze({_$ECOMMERCE_INIT:(0,o.default)("ECOMMERCE_INIT"),_$ECOMMERCE_RE_INIT:(0,o.default)("ECOMMERCE_RE_INIT"),_$ECOMMERCE_TRACK:(0,o.default)("ECOMMERCE_TRACK"),_$ECOMMERCE_STORAGE_SAVE:(0,o.default)("ECOMMERCE_STORAGE_SAVE"),_$ECOMMERCE_STORAGE_REMOVE:(0,o.default)("ECOMMERCE_STORAGE_REMOVE"),_$ERROR_TRACE:(0,o.default)("ERROR_TRACE"),_$ECOMMERCE_INIT_SHOPIFY:(0,o.default)("ECOMMERCE_INIT_SHOPIFY")}),t._$MessageScriptType=Object.freeze({_$INIT_HTTP_CONFIG:(0,o.default)("INIT_HTTP_CONFIG"),_$HTTP_CONFIG_INJECTED:(0,o.default)("HTTP_CONFIG_INJECTED"),_$SAVE_HTTP_DATA:(0,o.default)("SAVE_HTTP_DATA"),_$CUSTOM_ON_URL_CHANGED:(0,o.default)("CUSTOM_ON_URL_CHANGED"),_$SHOPIFY_DETECTED:(0,o.default)("SHOPIFY_DETECTED")})},57309(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t._$InterceptorAdapter=t._$RequestValidator=void 0;t._$RequestValidator=class{_$onHttpRequest;_$onHttpResponse};t._$InterceptorAdapter=class{static _$instance;static _$init}},65334(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.WatcherHandler=void 0,function(e){e.onLoad="onLoad",e.onClick="onClick",e.onInputChange="onInputChange",e.onIframeLoaded="onIframeLoaded",e.onUrlChanged="onUrlChanged",e.onPostMessage="onPostMessage",e.onWindowLoad="onWindowLoad",e.onDomLoad="onDomLoad",e.onDomChanged="onDomChanged",e.onHttpRequest="onHttpRequest",e.onHttpResponse="onHttpResponse",e.onKeyDown="onKeyDown"}(t.WatcherHandler||(t.WatcherHandler={}))}},t={};function s(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,s),a.exports}(()=>{const e=s(35263),t=s(57309),n=s(65334),o=s(24769);(s=>{const a=t=>{const n={_custom_type_:e._$MessageScriptType._$SAVE_HTTP_DATA,payload:JSON.parse(JSON.stringify(t))};s.postMessage(n)};class r extends t._$RequestValidator{_$validateRequest(e,t="GET"){return!!this._$onHttpRequest?.length&&(this._$onHttpRequest.find(this._$httpMatherPredicate(e,t))??!1)}_$validateResponse(e,t="GET"){return!!this._$onHttpResponse?.length&&(this._$onHttpResponse.find(this._$httpMatherPredicate(e,t))??!1)}_$setConfig(e,t){this._$onHttpRequest=e,this._$onHttpResponse=t}_$httpMatherPredicate(e,t){return({regex:s,methods:n})=>{const a=(0,o._$getRegex)(s);return n.includes(t)&&a.test(e)}}}class _ extends t._$InterceptorAdapter{validator;constructor(e){super(),this.validator=e,this._$initInterceptor()}static _$init(e){this._$instance||(this._$instance=new _(e))}async _$interceptRequest(e,t){const s=t?.method,o=this.validator._$validateRequest(e,s);o&&a({payload:{url:e,params:t},handler:o,watcher:n.WatcherHandler.onHttpRequest})}async _$interceptResponse(e,[t,s]){const n=s?.method,o=this.validator._$validateResponse(t,n);o&&await this._$proceedResponse(e,o)}async _$proceedResponse(e,t){const s=await e.clone(),o=e.headers.get("content-type");o&&(o.includes("json")?a({payload:await s.json(),handler:t,watcher:n.WatcherHandler.onHttpResponse}):o.includes("text")&&a({payload:await s.text(),handler:t,watcher:n.WatcherHandler.onHttpResponse}))}_$initInterceptor(){const e=s.fetch;s.fetch=async(...t)=>{this._$interceptRequest(...t);const s=await e(...t);return this._$interceptResponse(s,t),s}}}class i extends t._$InterceptorAdapter{validator;constructor(e){super(),this.validator=e,this._$initInterceptor()}static _$init(e){this._$instance||(this._$instance=new i(e))}async _$interceptRequest({method:e,url:t,body:s}){const o=this.validator._$validateRequest(t,e);o&&a({payload:{url:t,params:{method:e,body:s}},handler:o,watcher:n.WatcherHandler.onHttpRequest})}async _$interceptResponse({status:e,response:t,responseType:s,method:n,url:o}){const a=this.validator._$validateResponse(o,n);`${e}`.startsWith("20")&&a&&this._$proceedResponse(t,s,a)}_$proceedResponse(e,t,s){if("json"===t)a({payload:e,handler:s,watcher:n.WatcherHandler.onHttpResponse});else if("text"===t||""===t){let t;try{t=JSON.parse(e)}catch{t=e}a({payload:t,handler:s,watcher:n.WatcherHandler.onHttpResponse})}}_$initInterceptor(){const e=XMLHttpRequest.prototype.open,t=XMLHttpRequest.prototype.send,n=this;s.XMLHttpRequest.prototype.open=function(...t){return this.__METHOD__=t[0],this.__URL__=t[1],this.addEventListener("load",function({target:e}){n._$interceptResponse({status:e.status,response:e.response,responseType:e.responseType,method:t[0],url:t[1]})}),e.apply(this,t)},s.XMLHttpRequest.prototype.send=function(...e){return n._$interceptRequest({method:this.__METHOD__,url:this.__URL__,body:e[0]}),t.apply(this,e)}}}const p=new r;_._$init(p),i._$init(p),s.addEventListener("message",t=>{if(t.data?._custom_type_!==e._$MessageScriptType._$INIT_HTTP_CONFIG)return;const{onHttpRequest:s,onHttpResponse:n}=t.data.payload;p._$setConfig(s,n)}),s.postMessage({_custom_type_:e._$MessageScriptType._$HTTP_CONFIG_INJECTED})})(window||globalThis)})()})();