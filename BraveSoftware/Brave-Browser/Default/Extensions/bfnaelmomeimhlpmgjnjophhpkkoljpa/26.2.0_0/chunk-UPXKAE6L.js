import{a as F}from"./chunk-3POTW42L.js";import{v as Ue}from"./chunk-UE7TCZBL.js";import{h as Ve}from"./chunk-3H3VDE2B.js";import{d as ee,l as te,m as re}from"./chunk-44HH5QGP.js";import{a as q,b as Oe}from"./chunk-NMTPXQAP.js";import{C as Le,D as U,E as Q,ha as Ke,u as N}from"./chunk-N6SSDFMX.js";import{Aa as Me,Ba as Re,Da as $e,Sa as Be,oa as Ce,pa as B,qa as Ee,ra as Te,ta as O,ua as be,va as Ie,wa as De,xa as ve,ya as ke,za as Pe}from"./chunk-W7IWPUIQ.js";import{Ae as we,B as R,Cd as ge,Dd as ye,Ed as xe,G as me,Gb as he,H as C,I as E,L as A,La as w,cf as P,dc as K,ge as Se,ra as k,xf as Ae}from"./chunk-DJGGVTSJ.js";import{B as x,V as l,W as v}from"./chunk-FATTDLFQ.js";import{b as Ne}from"./chunk-2RWUL32J.js";import{a as o,d as H,e as mt,g as Z,i as f,m as Buffer,n as d}from"./chunk-WKJYWAXG.js";var Xe=H(D=>{"use strict";f();d();Object.defineProperty(D,"__esModule",{value:!0});D.TokenData=void 0;D.parse=ae;D.compile=Lt;D.match=Ot;D.pathToRegexp=Je;D.stringify=qt;var oe="/",se=o(e=>e,"NOOP_VALUE"),ze=/^[$_\p{ID_Start}]$/u,ie=/^[$\u200c\u200d\p{ID_Continue}]$/u,W="https://git.new/pathToRegexpError",Bt={"{":"{","}":"}","(":"(",")":")","[":"[","]":"]","+":"+","?":"?","!":"!"};function Nt(e){return e.replace(/[{}()\[\]+?!:*]/g,"\\$&")}o(Nt,"escapeText");function T(e){return e.replace(/[.+*?^${}()[\]|/\\]/g,"\\$&")}o(T,"escape");function*Ut(e){let t=[...e],r=0;function n(){let s="";if(ze.test(t[++r]))for(s+=t[r];ie.test(t[++r]);)s+=t[r];else if(t[r]==='"'){let i=r;for(;r<t.length;){if(t[++r]==='"'){r++,i=0;break}t[r]==="\\"?s+=t[++r]:s+=t[r]}if(i)throw new TypeError(`Unterminated quote at ${i}: ${W}`)}if(!s)throw new TypeError(`Missing parameter name at ${r}: ${W}`);return s}for(o(n,"name");r<t.length;){let s=t[r],i=Bt[s];if(i)yield{type:i,index:r++,value:s};else if(s==="\\")yield{type:"ESCAPED",index:r++,value:t[r++]};else if(s===":"){let a=n();yield{type:"PARAM",index:r,value:a}}else if(s==="*"){let a=n();yield{type:"WILDCARD",index:r,value:a}}else yield{type:"CHAR",index:r,value:t[r++]}}return{type:"END",index:r,value:""}}o(Ut,"lexer");var ne=class{static{o(this,"Iter")}constructor(t){this.tokens=t}peek(){if(!this._peek){let t=this.tokens.next();this._peek=t.value}return this._peek}tryConsume(t){let r=this.peek();if(r.type===t)return this._peek=void 0,r.value}consume(t){let r=this.tryConsume(t);if(r!==void 0)return r;let{type:n,index:s}=this.peek();throw new TypeError(`Unexpected ${n} at ${s}, expected ${t}: ${W}`)}text(){let t="",r;for(;r=this.tryConsume("CHAR")||this.tryConsume("ESCAPED");)t+=r;return t}},L=class{static{o(this,"TokenData")}constructor(t){this.tokens=t}};D.TokenData=L;function ae(e,t={}){let{encodePath:r=se}=t,n=new ne(Ut(e));function s(a){let c=[];for(;;){let p=n.text();p&&c.push({type:"text",value:r(p)});let g=n.tryConsume("PARAM");if(g){c.push({type:"param",name:g});continue}let y=n.tryConsume("WILDCARD");if(y){c.push({type:"wildcard",name:y});continue}if(n.tryConsume("{")){c.push({type:"group",tokens:s("}")});continue}return n.consume(a),c}}o(s,"consume");let i=s("END");return new L(i)}o(ae,"parse");function Lt(e,t={}){let{encode:r=encodeURIComponent,delimiter:n=oe}=t,s=e instanceof L?e:ae(e,t),i=Ge(s.tokens,n,r);return o(function(c={}){let[p,...g]=i(c);if(g.length)throw new TypeError(`Missing parameters: ${g.join(", ")}`);return p},"path")}o(Lt,"compile");function Ge(e,t,r){let n=e.map(s=>Kt(s,t,r));return s=>{let i=[""];for(let a of n){let[c,...p]=a(s);i[0]+=c,i.push(...p)}return i}}o(Ge,"tokensToFunction");function Kt(e,t,r){if(e.type==="text")return()=>[e.value];if(e.type==="group"){let s=Ge(e.tokens,t,r);return i=>{let[a,...c]=s(i);return c.length?[""]:[a]}}let n=r||se;return e.type==="wildcard"&&r!==!1?s=>{let i=s[e.name];if(i==null)return["",e.name];if(!Array.isArray(i)||i.length===0)throw new TypeError(`Expected "${e.name}" to be a non-empty array`);return[i.map((a,c)=>{if(typeof a!="string")throw new TypeError(`Expected "${e.name}/${c}" to be a string`);return n(a)}).join(t)]}:s=>{let i=s[e.name];if(i==null)return["",e.name];if(typeof i!="string")throw new TypeError(`Expected "${e.name}" to be a string`);return[n(i)]}}o(Kt,"tokenToFunction");function Ot(e,t={}){let{decode:r=decodeURIComponent,delimiter:n=oe}=t,{regexp:s,keys:i}=Je(e,t),a=i.map(c=>r===!1?se:c.type==="param"?r:p=>p.split(n).map(r));return o(function(p){let g=s.exec(p);if(!g)return!1;let y=g[0],S=Object.create(null);for(let I=1;I<g.length;I++){if(g[I]===void 0)continue;let M=i[I-1],Y=a[I-1];S[M.name]=Y(g[I])}return{path:y,params:S}},"match")}o(Ot,"match");function Je(e,t={}){let{delimiter:r=oe,end:n=!0,sensitive:s=!1,trailing:i=!0}=t,a=[],c=[],p=s?"":"i",y=(Array.isArray(e)?e:[e]).map(M=>M instanceof L?M:ae(M,t));for(let{tokens:M}of y)for(let Y of j(M,0,[])){let pt=Vt(Y,r,a);c.push(pt)}let S=`^(?:${c.join("|")})`;return i&&(S+=`(?:${T(r)}$)?`),S+=n?"$":`(?=${T(r)}|$)`,{regexp:new RegExp(S,p),keys:a}}o(Je,"pathToRegexp");function*j(e,t,r){if(t===e.length)return yield r;let n=e[t];if(n.type==="group"){let s=r.slice();for(let i of j(n.tokens,0,s))yield*j(e,t+1,i)}else r.push(n);yield*j(e,t+1,r)}o(j,"flatten");function Vt(e,t,r){let n="",s="",i=!0;for(let a=0;a<e.length;a++){let c=e[a];if(c.type==="text"){n+=T(c.value),s+=c.value,i||(i=c.value.includes(t));continue}if(c.type==="param"||c.type==="wildcard"){if(!i&&!s)throw new TypeError(`Missing text after "${c.name}": ${W}`);c.type==="param"?n+=`(${Ht(t,i?"":s)}+)`:n+="([\\s\\S]+)",r.push(c),s="",i=!1;continue}}return n}o(Vt,"sequenceToRegExp");function Ht(e,t){return t.length<2?e.length<2?`[^${T(e+t)}]`:`(?:(?!${T(e)})[^${T(t)}])`:e.length<2?`(?:(?!${T(t)})[^${T(e)}])`:`(?:(?!${T(t)}|${T(e)})[\\s\\S])`}o(Ht,"negate");function qt(e){return e.tokens.map(o(function t(r,n,s){if(r.type==="text")return Nt(r.value);if(r.type==="group")return`{${r.tokens.map(t).join("")}}`;let a=Ft(r.name)&&_t(s[n+1])?r.name:JSON.stringify(r.name);if(r.type==="param")return`:${a}`;if(r.type==="wildcard")return`*${a}`;throw new TypeError(`Unexpected token: ${r}`)},"stringifyToken")).join("")}o(qt,"stringify");function Ft(e){let[t,...r]=e;return ze.test(t)?r.every(n=>ie.test(n)):!1}o(Ft,"isNameSafe");function _t(e){return e?.type!=="text"?!0:!ie.test(e.value[0])}o(_t,"isNextNameSafe")});var z=H(m=>{"use strict";f();d();Object.defineProperty(m,"__esModule",{value:!0});m.isHexString=m.getKeys=m.fromAscii=m.fromUtf8=m.toAscii=m.arrayContainsArray=m.getBinarySize=m.padToEven=m.stripHexPrefix=m.isHexPrefixed=void 0;function Ze(e){if(typeof e!="string")throw new Error(`[isHexPrefixed] input must be type 'string', received type ${typeof e}`);return e[0]==="0"&&e[1]==="x"}o(Ze,"isHexPrefixed");m.isHexPrefixed=Ze;var Xt=o(e=>{if(typeof e!="string")throw new Error(`[stripHexPrefix] input must be type 'string', received ${typeof e}`);return Ze(e)?e.slice(2):e},"stripHexPrefix");m.stripHexPrefix=Xt;function Qe(e){let t=e;if(typeof t!="string")throw new Error(`[padToEven] value must be type 'string', received ${typeof t}`);return t.length%2&&(t=`0${t}`),t}o(Qe,"padToEven");m.padToEven=Qe;function Yt(e){if(typeof e!="string")throw new Error(`[getBinarySize] method requires input type 'string', received ${typeof e}`);return Buffer.byteLength(e,"utf8")}o(Yt,"getBinarySize");m.getBinarySize=Yt;function Zt(e,t,r){if(Array.isArray(e)!==!0)throw new Error(`[arrayContainsArray] method requires input 'superset' to be an array, got type '${typeof e}'`);if(Array.isArray(t)!==!0)throw new Error(`[arrayContainsArray] method requires input 'subset' to be an array, got type '${typeof t}'`);return t[r===!0?"some":"every"](n=>e.indexOf(n)>=0)}o(Zt,"arrayContainsArray");m.arrayContainsArray=Zt;function Qt(e){let t="",r=0,n=e.length;for(e.substring(0,2)==="0x"&&(r=2);r<n;r+=2){let s=parseInt(e.substr(r,2),16);t+=String.fromCharCode(s)}return t}o(Qt,"toAscii");m.toAscii=Qt;function er(e){let t=Buffer.from(e,"utf8");return`0x${Qe(t.toString("hex")).replace(/^0+|0+$/g,"")}`}o(er,"fromUtf8");m.fromUtf8=er;function tr(e){let t="";for(let r=0;r<e.length;r++){let s=e.charCodeAt(r).toString(16);t+=s.length<2?`0${s}`:s}return`0x${t}`}o(tr,"fromAscii");m.fromAscii=tr;function rr(e,t,r){if(!Array.isArray(e))throw new Error(`[getKeys] method expects input 'params' to be an array, got ${typeof e}`);if(typeof t!="string")throw new Error(`[getKeys] method expects input 'key' to be type 'string', got ${typeof e}`);let n=[];for(let s=0;s<e.length;s++){let i=e[s][t];if(r===!0&&!i)i="";else if(typeof i!="string")throw new Error(`invalid abi - expected type 'string', received ${typeof i}`);n.push(i)}return n}o(rr,"getKeys");m.getKeys=rr;function nr(e,t){return!(typeof e!="string"||!e.match(/^0x[0-9A-Fa-f]*$/)||typeof t<"u"&&t>0&&e.length!==2+2*t)}o(nr,"isHexString");m.isHexString=nr});var et=H(b=>{"use strict";f();d();Object.defineProperty(b,"__esModule",{value:!0});b.assertIsString=b.assertIsArray=b.assertIsBuffer=b.assertIsHexString=void 0;var or=z(),sr=o(function(e){if(!(0,or.isHexString)(e)){let t=`This method only supports 0x-prefixed hex strings but input was: ${e}`;throw new Error(t)}},"assertIsHexString");b.assertIsHexString=sr;var ir=o(function(e){if(!Buffer.isBuffer(e)){let t=`This method only supports Buffer but input was: ${e}`;throw new Error(t)}},"assertIsBuffer");b.assertIsBuffer=ir;var ar=o(function(e){if(!Array.isArray(e)){let t=`This method only supports number arrays but input was: ${e}`;throw new Error(t)}},"assertIsArray");b.assertIsArray=ar;var ur=o(function(e){if(typeof e!="string"){let t=`This method only supports strings but input was: ${e}`;throw new Error(t)}},"assertIsString");b.assertIsString=ur});var ot=H(u=>{"use strict";f();d();Object.defineProperty(u,"__esModule",{value:!0});u.intToUnpaddedBuffer=u.bigIntToUnpaddedBuffer=u.bigIntToHex=u.bufArrToArr=u.arrToBufArr=u.validateNoLeadingZeroes=u.baToJSON=u.toUtf8=u.short=u.addHexPrefix=u.toUnsigned=u.fromSigned=u.bufferToInt=u.bigIntToBuffer=u.bufferToBigInt=u.bufferToHex=u.toBuffer=u.unpadHexString=u.unpadArray=u.unpadBuffer=u.setLengthRight=u.setLengthLeft=u.zeros=u.intToBuffer=u.intToHex=void 0;var V=et(),$=z(),cr=o(function(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Received an invalid integer type: ${e}`);return`0x${e.toString(16)}`},"intToHex");u.intToHex=cr;var fr=o(function(e){let t=(0,u.intToHex)(e);return Buffer.from((0,$.padToEven)(t.slice(2)),"hex")},"intToBuffer");u.intToBuffer=fr;var dr=o(function(e){return Buffer.allocUnsafe(e).fill(0)},"zeros");u.zeros=dr;var tt=o(function(e,t,r){let n=(0,u.zeros)(t);return r?e.length<t?(e.copy(n),n):e.slice(0,t):e.length<t?(e.copy(n,t-e.length),n):e.slice(-t)},"setLength"),lr=o(function(e,t){return(0,V.assertIsBuffer)(e),tt(e,t,!1)},"setLengthLeft");u.setLengthLeft=lr;var pr=o(function(e,t){return(0,V.assertIsBuffer)(e),tt(e,t,!0)},"setLengthRight");u.setLengthRight=pr;var ce=o(function(e){let t=e[0];for(;e.length>0&&t.toString()==="0";)e=e.slice(1),t=e[0];return e},"stripZeros"),mr=o(function(e){return(0,V.assertIsBuffer)(e),ce(e)},"unpadBuffer");u.unpadBuffer=mr;var hr=o(function(e){return(0,V.assertIsArray)(e),ce(e)},"unpadArray");u.unpadArray=hr;var gr=o(function(e){return(0,V.assertIsHexString)(e),e=(0,$.stripHexPrefix)(e),"0x"+ce(e)},"unpadHexString");u.unpadHexString=gr;var yr=o(function(e){if(e==null)return Buffer.allocUnsafe(0);if(Buffer.isBuffer(e))return Buffer.from(e);if(Array.isArray(e)||e instanceof Uint8Array)return Buffer.from(e);if(typeof e=="string"){if(!(0,$.isHexString)(e))throw new Error(`Cannot convert string to buffer. toBuffer only supports 0x-prefixed hex strings and this string was given: ${e}`);return Buffer.from((0,$.padToEven)((0,$.stripHexPrefix)(e)),"hex")}if(typeof e=="number")return(0,u.intToBuffer)(e);if(typeof e=="bigint"){if(e<BigInt(0))throw new Error(`Cannot convert negative bigint to buffer. Given: ${e}`);let t=e.toString(16);return t.length%2&&(t="0"+t),Buffer.from(t,"hex")}if(e.toArray)return Buffer.from(e.toArray());if(e.toBuffer)return Buffer.from(e.toBuffer());throw new Error("invalid type")},"toBuffer");u.toBuffer=yr;var xr=o(function(e){return e=(0,u.toBuffer)(e),"0x"+e.toString("hex")},"bufferToHex");u.bufferToHex=xr;function fe(e){let t=(0,u.bufferToHex)(e);return BigInt(t==="0x"?0:t)}o(fe,"bufferToBigInt");u.bufferToBigInt=fe;function de(e){return(0,u.toBuffer)("0x"+e.toString(16))}o(de,"bigIntToBuffer");u.bigIntToBuffer=de;var Sr=o(function(e){let t=Number(fe(e));if(!Number.isSafeInteger(t))throw new Error("Number exceeds 53 bits");return t},"bufferToInt");u.bufferToInt=Sr;var wr=o(function(e){return BigInt.asIntN(256,fe(e))},"fromSigned");u.fromSigned=wr;var Ar=o(function(e){return de(BigInt.asUintN(256,e))},"toUnsigned");u.toUnsigned=Ar;var Cr=o(function(e){return typeof e!="string"||(0,$.isHexPrefixed)(e)?e:"0x"+e},"addHexPrefix");u.addHexPrefix=Cr;function Er(e,t=50){let r=Buffer.isBuffer(e)?e.toString("hex"):e;return r.length<=t?r:r.slice(0,t)+"\u2026"}o(Er,"short");u.short=Er;var Tr=o(function(e){let t=/^(00)+|(00)+$/g;if(e=(0,$.stripHexPrefix)(e),e.length%2!==0)throw new Error("Invalid non-even hex string input for toUtf8() provided");return Buffer.from(e.replace(t,""),"hex").toString("utf8")},"toUtf8");u.toUtf8=Tr;var br=o(function(e){if(Buffer.isBuffer(e))return`0x${e.toString("hex")}`;if(e instanceof Array){let t=[];for(let r=0;r<e.length;r++)t.push((0,u.baToJSON)(e[r]));return t}},"baToJSON");u.baToJSON=br;var Ir=o(function(e){for(let[t,r]of Object.entries(e))if(r!==void 0&&r.length>0&&r[0]===0)throw new Error(`${t} cannot have leading zeroes, received: ${r.toString("hex")}`)},"validateNoLeadingZeroes");u.validateNoLeadingZeroes=Ir;function rt(e){return Array.isArray(e)?e.map(t=>rt(t)):Buffer.from(e)}o(rt,"arrToBufArr");u.arrToBufArr=rt;function nt(e){return Array.isArray(e)?e.map(t=>nt(t)):Uint8Array.from(e??[])}o(nt,"bufArrToArr");u.bufArrToArr=nt;var Dr=o(e=>"0x"+e.toString(16),"bigIntToHex");u.bigIntToHex=Dr;function vr(e){return(0,u.unpadBuffer)(de(e))}o(vr,"bigIntToUnpaddedBuffer");u.bigIntToUnpaddedBuffer=vr;function kr(e){return(0,u.unpadBuffer)((0,u.intToBuffer)(e))}o(kr,"intToUnpaddedBuffer");u.intToUnpaddedBuffer=kr});f();d();f();d();var He=o(e=>{let t=new q,r=new xe({storage:t,getPassword:e}),n=ye.fromStorage(t,r),s=new he,i=new Re({[B.KeyPair]:{[k.Solana]:Pe(),[k.EVM]:Ie(),[k.BitcoinTaproot]:O(),[k.BitcoinNativeSegwit]:O(),[k.BitcoinNestedSegwit]:O(),[k.BitcoinLegacy]:O(),[k.Sui]:Me(),JWT:De(),KMSPKIAuthenticator:ke(),Agent:Te(),Cash:be()},[B.Ledger]:Ue(),[B.SeedVault]:{type:B.SeedVault,async sign(){return Ee(Ce.UnsupportedOperation)}},[B.KMS]:ve()}),a=o(()=>Promise.resolve(Se()),"getChainAvailability"),c={generalStorage:t,secretsStorage:n,secureCache:Be({isEnabled:o(()=>!F("kill-vault-secure-cache"),"isEnabled"),generalStorage:t,secretsStorage:n}),fetchChainAvailability:a,keypairGenerator:s,vaultSigner:i};return{vault:$e(c),getChainAvailability:a,encryptedStorage:n,storageEncryptionKeyManager:r}},"createBrowserVault");f();d();var ht=/^\.phantom-labs\.vault\.seed\.[0-9A-Fa-f]+$/,gt=/^\.phantom-labs\.vault\.privateKey\.[0-9A-Fa-f]+$/;async function Fe(e){let t;try{if(t=await e.storageEncryptionKeyManager.hasPersistedDeviceEncryptionKey(),!t)return{status:"noMiddleEncryptionKey"}}catch{return{status:"errorRetrievingMiddleEncryptionKey"}}let r;try{r=(await e.vault.checkVaultIntegrity()).status}catch{return{status:"errorUnableToCheckVaultIntegrity"}}try{let n=await e.generalStorage.getAll(),[s,i]=await qe(e,n,ht),[a,c]=await qe(e,n,gt);return{status:"hasMiddleEncryptionKey",vaultStatus:r,numberOfEncryptedSeeds:s,numberOfDecryptableSeeds:i,numberOfEncryptedPrivateKeys:a,numberOfDecryptablePrivateKeys:c}}catch{return{status:"errorUnableToCountDecryptableValues",vaultStatus:r}}}o(Fe,"checkExtensionStorageIntegrity");async function qe(e,t,r){let n=0,s=0;for(let[i,a]of Object.entries(t))if(!(!i.match(r)||!ge.safeParse(a).success)){n++;try{await e.secretsStorage.getSecureValue(i),s++}catch{}}return[n,s]}o(qe,"countDecryptableValues");var sn="HAS_ONBOARDING_BEEN_OPENED",an="EXTENSION_LOCKED",_=null,un=o(()=>_,"getInMemoryPassword"),yt=o(e=>{_=e},"setInMemoryPassword"),cn=o(()=>{_=null},"resetInMemoryPassword"),xt=o(()=>_??null,"getInMemoryPasswordCallback"),{vault:_e,getChainAvailability:fn,encryptedStorage:St,storageEncryptionKeyManager:je}=He(xt),dn=o(async e=>!e||!await A.startSpan("storageEncryptionKeyManager.verifyPassword",()=>je.verifyPassword(e))?!1:(yt(e),!0),"verifyAndSetInMemoryPassword"),ln=o(async()=>{let e=await _e.deriveAddresses();return e&&(A.addBreadcrumb(E.Account,"\u2705 Derived new addresses in Vault",C.Info),await Ve.invalidateQueries({refetchType:"all"})),e},"deriveNewVaultAddresses"),pn=o(async()=>{if(!F("kill-extension-storage-integrity-check"))try{let e=await Fe({generalStorage:new q,secretsStorage:St,storageEncryptionKeyManager:je,vault:_e});e.status!=="hasMiddleEncryptionKey"&&Oe.capture("extensionStorageIntegrityCheck",{data:{extensionStorageIntegrityCheck:e}})}catch{}},"logExtensionStorageIntegrity");var We={};mt(We,{any:()=>Ct,cancelled:()=>$t,chainDisconnected:()=>Et,error:()=>At,internalError:()=>bt,invalidInput:()=>Tt,methodNotFound:()=>It,rateLimited:()=>Mt,resourceUnavailable:()=>Dt,result:()=>wt,transactionRejected:()=>vt,unauthorized:()=>kt,unsupportedMethod:()=>Pt,userRejectedRequest:()=>Rt});f();d();var wt=o((e,t)=>({jsonrpc:"2.0",id:e,result:t}),"result"),At=o((e,t)=>({jsonrpc:"2.0",id:e,error:t}),"error"),Ct=o((e,t)=>({...t,jsonrpc:"2.0",id:e}),"any"),Et=o((e,t)=>({id:e,jsonrpc:"2.0",error:{code:x.ChainDisconnected,message:t??"The Provider is not connected to the requested chain."}}),"chainDisconnected"),Tt=o((e,t)=>({id:e,jsonrpc:"2.0",error:{code:x.InvalidInput,message:t??"Missing or invalid parameters."}}),"invalidInput"),bt=o((e,t)=>({id:e,jsonrpc:"2.0",error:{code:x.InternalError,message:t??"Something went wrong."}}),"internalError"),It=o((e,t)=>({id:e,jsonrpc:"2.0",error:{code:x.MethodNotFound,message:t??"Method does not exist."}}),"methodNotFound"),Dt=o((e,t)=>({id:e,jsonrpc:"2.0",error:{code:x.ResourceUnavailable,message:t??"Requested resource not available."}}),"resourceUnavailable"),vt=o((e,t)=>({id:e,jsonrpc:"2.0",error:{code:x.TransactionRejected,message:t??"Transaction creation failed."}}),"transactionRejected"),kt=o((e,t)=>({id:e,jsonrpc:"2.0",error:{code:x.Unauthorized,message:t??"The requested method and/or account has not been authorized by the user."}}),"unauthorized"),Pt=o((e,t)=>({id:e,jsonrpc:"2.0",error:{code:x.UnsupportedMethod,message:t??"The requested method is not supported."}}),"unsupportedMethod"),Mt=o((e,t)=>({id:e,jsonrpc:"2.0",error:{code:x.RateLimited,message:t??"The requested method has been rate limited."}}),"rateLimited"),Rt=o((e,t)=>({id:e,jsonrpc:"2.0",error:{code:x.UserRejectedRequest,message:t??"User rejected the request."}}),"userRejectedRequest"),$t=o((e,t)=>({id:e,jsonrpc:"2.0",error:{code:x.RequestCancelled,message:t??"The request was cancelled."}}),"cancelled");f();d();f();d();var Ye=Z(Xe());function jt(e,t){return{request:e,source:t,id:me()}}o(jt,"rpcRequestData");function Wt(){return{parse(e){return Gt(e)}}}o(Wt,"route");function zt(e,t){let r=new URL(e),n=r.host+r.pathname;return(0,Ye.match)(t)(n)}o(zt,"parseDeepLinkUrl");function Gt(e){function t(r,n,s){return o(async a=>{if(e.path&&a.source?.type==="DeepLinkRpcRequestSource"){let y=zt(a.source.deepLinkUrl,e.path);y&&a.request.params&&typeof a.request.params=="object"&&(a.request.params={...a.request.params,...y.params})}let c={...a,request:e.request.parse(a.request)},p=[];for(let y of n){let S=await y(c,r);if(S){if(typeof S!="function")return setTimeout(()=>{for(let I of p)I(S)},0),S;p.push(S)}}let g=e.response.parse(await s(c,r));if(g.id!==a.request.id){let y="Request id does not match response id";throw console.error(y,{request:a.request,response:g}),new Error(y)}return setTimeout(()=>{for(let y of p)y(g)},0),g},"handleRpcRequest")}return o(t,"build"),{context(r){return{use:o((n,s)=>t(r,n,s),"use")}},use:o((r,n)=>t(void 0,r,n),"use")}}o(Gt,"createRouteHandler");f();d();var ue=class{static{o(this,"RpcRouter")}#e;constructor(t){this.#e=t}init(t,r){let n=new AbortController,{signal:s}=n,i=Jt(this.#e.routes,this.#e.concurrent);return{start:o(async()=>{if(s.aborted){console.warn("stream already closed");return}try{await t.pipeThrough(i,{signal:s}).pipeTo(r,{signal:s})}catch(a){s.aborted||console.error("RPC router stream error",a)}},"start"),stop:o(a=>{n.abort(a)},"stop")}}};function Jt(e,t){return new TransformStream({async transform(r,n){let s=o(async()=>{let i=e[r.request.method];if(!i){let a={jsonrpc:"2.0",id:r.request.id,error:{code:0,message:`${r.request.method} isn't implemented`}};return n.enqueue([r,a])}try{let a=await i(r);return n.enqueue([r,a])}catch(a){console.error(`RPC ROUTER: Unexpected error in method: ${r.request.method}, message: ${a?.message}`);let c={jsonrpc:"2.0",id:r.request.id,error:{code:x.InternalError,message:"Unexpected error"}};return n.enqueue([r,c])}},"process");t?s().catch(i=>{i?.name!=="AbortError"&&A.addBreadcrumb(E.Provider,"[RpcRouter] Unhandled error in concurrent process",C.Error,{error:String(i)})}):await s()}})}o(Jt,"createRpcRequestHandlerStream");f();d();var le=Z(ot(),1),st=Z(z(),1);var Pr=/^[0-9A-Fa-f]+$/gu;function it(e){try{let t=(0,st.stripHexPrefix)(e);if(t.match(Pr))return Mr(t)}catch{return(0,le.bufferToHex)(Buffer.from(e,"utf8"))}return(0,le.bufferToHex)(Buffer.from(e,"utf8"))}o(it,"normalizeMsgData");var Mr=o(e=>typeof e!="string"||e.match(/^-?0x/u)?e:e.match(/^-?0X/u)?e.replace("0X","0x"):e.startsWith("-")?e.replace("-","-0x"):`0x${e}`,"addHexPrefix"),Rr=o(e=>{let t=Buffer.from(e.substring(2),"hex"),r=t.length===32?"hex":"utf8",n;switch(r){case"hex":n=it(e);break;case"utf8":default:n=t.toString("utf8")}return n},"toDisplayMessage");f();d();f();d();var $r={[l.UnsupportedDapp]:"autoConfirmReasonDappNotWhitelisted",[l.Disabled]:"autoConfirmReasonSessionNotActive",[l.RateLimitExceeded]:"autoConfirmReasonRateLimited",[l.SimulationFailed]:"autoConfirmReasonSimulationFailed",[l.UnsupportedNetworkId]:"autoConfirmReasonUnsupportedNetwork",[l.TabNotFocused]:"autoConfirmReasonTabNotFocused",[l.WalletLocked]:"autoConfirmReasonNotUnlocked"},Br=o(e=>e?$r[e]:void 0,"getAutoConfirmReasonKey");f();d();f();d();f();d();async function at(e){let t=await R.api().post("/auto-confirm/v1/dapp",{domain:P(e)}),{data:r}=t;return!r?.supportedChainIds||!Array.isArray(r.supportedChainIds)?[]:r.supportedChainIds}o(at,"fetchEnabledNetworkIdsForOrigin");f();d();var G=o(e=>`/auto-confirm/v1/${e}`,"createApiUrl");async function ut(e){return K.isEVMNetworkID(e.chainId)?(await R.api().post(G("transaction"),{txObjects:e.txObjects,chainId:e.chainId,domain:e.domain})).data?.isEligible===!0:K.isSolanaNetworkID(e.chainId)?(await R.api().post(G("transaction"),{transactions:e.transactions,chainId:e.chainId,domain:e.domain})).data?.isEligible===!0:!1}o(ut,"isDappWhitelistedForTransaction");async function ct(e){if(K.isEVMNetworkID(e.chainId)){let t=JSON.parse(JSON.stringify(e.data));return delete t.message,delete t.primaryType,delete t.types,(await(await R.api().post(G("message"),{chainId:e.chainId,domain:e.domain,data:[t]})).data)?.isEligible===!0}return K.isSolanaNetworkID(e.chainId)?(await(await R.api().post(G("message"),{chainId:e.chainId,domain:e.domain,solanaMessage:{message:e.data}})).data)?.isEligible===!0:!1}o(ct,"isDappWhitelistedForMessage");var Nr=10,J=[],pe=class{static{o(this,"AbstractAutoConfirmService")}storage;executedChecksAudit=[];constructor(t){this.storage=t}isDappWhitelistedForMessage=ct;isDappWhitelistedForTransaction=ut;async isEthTransactionAutoConfirmable(t,r){this.executedChecksAudit=[];let n=await this.didPassGenericChecks(t);if(n.status!==l.OK)return n;let s=P(t.url.origin);if(!(await this.isAutoConfirmLocalhostDomain(s)?!0:await this.isDappWhitelistedForTransaction({chainId:t.networkID,domain:P(t.url.origin),txObjects:t.data})))return{...n,status:l.UnsupportedDapp,auditTrail:this.executedChecksAudit};let{success:c,...p}=await this.didPassEthTransactionSimulation(t,r);return c?{...n,...p,status:l.OK,auditTrail:this.executedChecksAudit}:{...n,...p,status:l.SimulationFailed,auditTrail:this.executedChecksAudit}}async isEthMessageAutoConfirmable(t,r){this.executedChecksAudit=[];let n=await this.didPassGenericChecks(t);if(n.status!==l.OK)return n;let s=P(t.url.origin);return(await this.isAutoConfirmLocalhostDomain(s)?!0:await this.isDappWhitelistedForMessage({chainId:t.networkID,domain:s,data:t.data}))?await this.didPassEthMessageSimulation(t,r)?{...n,status:l.OK,auditTrail:this.executedChecksAudit}:{...n,status:l.SimulationFailed,auditTrail:this.executedChecksAudit}:{...n,status:l.UnsupportedDapp,auditTrail:this.executedChecksAudit}}async isSolTransactionAutoConfirmable(t,r){this.executedChecksAudit=[];let n=await this.didPassGenericChecks(t);if(n.status!==l.OK)return n;let s=P(t.url.origin);if(!(await this.isAutoConfirmLocalhostDomain(s)?!0:await this.isDappWhitelistedForTransaction({chainId:t.networkID,domain:s,transactions:t.data})))return{...n,status:l.UnsupportedDapp,auditTrail:this.executedChecksAudit};let{success:c,...p}=await this.didPassSolTransactionSimulation(t,r);return c?{...n,...p,status:l.OK,auditTrail:this.executedChecksAudit}:{...n,...p,status:l.SimulationFailed,auditTrail:this.executedChecksAudit}}async isSolMessageAutoConfirmable(t,r){this.executedChecksAudit=[];let n=await this.didPassGenericChecks(t);if(n.status!==l.OK)return n;let s=P(t.url.origin);return(await this.isAutoConfirmLocalhostDomain(s)?!0:await this.isDappWhitelistedForMessage({chainId:t.networkID,domain:s,data:t.data}))?await this.didPassSolMessageSimulation(t,{locale:r.locale,deviceId:r.deviceId||""})?{...n,status:l.OK,auditTrail:this.executedChecksAudit}:{...n,status:l.SimulationFailed,auditTrail:this.executedChecksAudit}:{...n,status:l.UnsupportedDapp,auditTrail:this.executedChecksAudit}}async fetchAutoConfirmSupportedNetworks(t){return await this.isAutoConfirmLocalhostDomain(t)?[w.Solana.Mainnet,w.Solana.Testnet,w.Solana.Devnet,w.Ethereum.Mainnet,w.Ethereum.Sepolia,w.Polygon.Mainnet,w.Polygon.Amoy,w.Bitcoin.Mainnet,w.Bitcoin.Testnet,w.Sui.Mainnet,w.Sui.Testnet]:await at(t)}async getAutoConfirmStatus({origin:t,accountIdentifier:r}){let n=N(),s=await U(this.storage,r,t,n);return{enabled:Object.values(s?.networks??{}).some(i=>i===!0),networkIDs:Object.keys(s?.networks??{}).filter(i=>s?.networks?.[i]===!0)}}async enableAutoConfirm({origin:t,accountIdentifier:r,networkIDs:n}){let s=N(),i=await U(this.storage,r,t,s);i.networks=n.reduce((a,c)=>(a[c]=!0,a),i.networks),i.sessionStartTime=Date.now(),await Q(this.storage,r,t,i,s)}async disableAutoConfirm({origin:t,accountIdentifier:r}){let n=N(),s=await U(this.storage,r,t,n);s.networks=Object.keys(s.networks).reduce((i,a)=>(i[a]=!1,i),s.networks),s.sessionStartTime=Date.now(),await Q(this.storage,r,t,s,n)}async isAutoConfirmEnabledInUserSettings({origin:t,accountIdentifier:r,networkID:n}){this.executedChecksAudit.push(v.IsAutoConfirmEnabledInUserSettings);let s=N();return(await U(this.storage,r,t,s))?.networks?.[n]===!0}async isAutoConfirmSessionActive(t,r){this.executedChecksAudit.push(v.IsAutoConfirmSessionActive);let n=N(),s=await U(this.storage,t,r,n),i=Le(s);return{sessionStartTime:s.sessionStartTime,sessionMaxDuration:s.maxSessionDuration,success:i}}async didPassGenericChecks(t){try{if(!await this.isFeatureEnabled())return{status:l.FeatureKilled};if(!await this.isWalletUnlocked())return{status:l.WalletLocked};if(!await this.isTabFocused(t.url.origin))return{status:l.TabNotFocused};if(!await this.isAutoConfirmEnabledInUserSettings({origin:t.url.origin,networkID:t.networkID,accountIdentifier:t.accountIdentifier}))return{status:l.Disabled};let r=await this.isAutoConfirmSessionActive(t.accountIdentifier,t.url.origin);return r.success?this.isNotRateLimited()?{status:l.OK,sessionStartTime:r.sessionStartTime,sessionMaxDuration:r.sessionMaxDuration}:{status:l.RateLimitExceeded,sessionStartTime:r.sessionStartTime,sessionMaxDuration:r.sessionMaxDuration}:{status:l.SessionExpired,sessionStartTime:r.sessionStartTime,sessionMaxDuration:r.sessionMaxDuration}}catch{return{status:l.Unknown}}}isNotRateLimited(){this.executedChecksAudit.push(v.IsNotRateLimited);let t=J.findIndex(r=>r<=Date.now()-6e4);return t>-1&&J.splice(t),J.length>=Nr?!1:(J.push(Date.now()),!0)}async didPassEthTransactionSimulation(t,r){this.executedChecksAudit.push(v.DidPassEthTransactionSimulation);try{let n=await re(r.locale,r.deviceId,{networkID:t.networkID,type:"transaction",url:t.url?.href,userAccount:t.userAccountAddress,params:{transactions:t.data,userAddresses:[]}});return ft(n)}catch{return{success:!1}}}async didPassSolTransactionSimulation(t,r){this.executedChecksAudit.push(v.DidPassSolTransactionSimulation);try{let n=await re(r.locale,r.deviceId,{networkID:t.networkID,type:"transaction",url:t.url.href,userAccount:t.userAccountAddress,params:{transactions:t.data,method:"signAndSendTransaction"}});return ft(n)}catch{return{success:!1}}}async didPassEthMessageSimulation(t,r){this.executedChecksAudit.push(v.DidPassEthMessageSimulation);try{let n=await te(r.locale,r.deviceId,{params:{message:"0x"+Buffer.from(JSON.stringify(t.data)).toString("hex")},type:"message",userAccount:t.userAccountAddress,networkID:t.networkID,url:t.url?.href});return dt(n)}catch{return!1}}async didPassSolMessageSimulation(t,r){this.executedChecksAudit.push(v.DidPassSolMessageSimulation);try{let n=await te(r.locale,r.deviceId,{params:{message:t.data},type:"message",userAccount:t.userAccountAddress,networkID:t.networkID,url:t.url?.href});return dt(n)}catch{return!1}}async isAutoConfirmLocalhostDomain(t){try{return await Ke(this.storage)&&Ae(t)}catch{return!1}}};function ft(e){let t=!!e.warnings.find(s=>s.severity<=ee.criticalError),r=!!e.block,n=e.expectedChanges.map(s=>s.type==="AssetChange"&&s.asset.usdValue||0).reduce((s,i)=>s+i,0);return{success:!t&&!r&&!e.error,dollarValue:parseFloat((n||0).toFixed(6))}}o(ft,"transactionSimulationPasses");function dt(e){let t=!!e.warnings.find(n=>n.severity<=ee.criticalError),r=!!e.block;return!t&&!r&&!e.error}o(dt,"messageSimulationPasses");f();d();var lt=7,Ho=we(Ne,e=>new X(e)),X=class{static{o(this,"AutoConfirmAnalytics")}#e;constructor(t){this.#e=t}onAutoConfirmSettingsChanged({origin:t,networkID:r,enabled:n,sessionStartTime:s,maxSessionDuration:i,view:a}){A.addBreadcrumb(`Auto-Confirm: ${n?"Enabling":"Disabling"} network ID ${r}`,E.AutoConfirm,C.Info),this.#e.capture("autoConfirmSettingsChanged",{data:{origin:t,networkId:r,enabled:n,sessionStartTime:n?s:void 0,maxSessionDuration:n?i:void 0,view:a}})}transactionAutoConfirmed(t){let r={type:"transaction",data:t};return t.autoConfirm.auditTrail?.length&&t.autoConfirm.auditTrail.length<lt&&(t.autoConfirm.suspectSettingsTamper=!0),A.addBreadcrumb(`Auto-Confirm: transaction on origin ${t.origin} for network ${t.networkId} auto-confirmed`,E.AutoConfirm,C.Info),t.autoConfirm.suspectSettingsTamper&&A.addBreadcrumb("Auto-Confirm: suspected tampering with settings...",E.AutoConfirm,C.Info),this.#e.capture("transactionAutoConfirmed",r)}messageAutoConfirmed(t){let r={type:"message",data:t};return t.autoConfirm.auditTrail?.length&&t.autoConfirm.auditTrail.length<lt&&(t.autoConfirm.suspectSettingsTamper=!0),A.addBreadcrumb(`Auto-Confirm: message on origin ${t.origin} for network ${t.networkId} auto-confirmed`,E.AutoConfirm,C.Info),t.autoConfirm.suspectSettingsTamper&&A.addBreadcrumb("Auto-Confirm: suspected tampering with settings...",E.AutoConfirm,C.Info),this.#e.capture("transactionAutoConfirmed",r)}};export{at as a,pe as b,Ho as c,X as d,Br as e,sn as f,an as g,un as h,yt as i,cn as j,_e as k,fn as l,St as m,je as n,dn as o,ln as p,pn as q,it as r,Rr as s,jt as t,Wt as u,ue as v,We as w};
//# sourceMappingURL=chunk-UPXKAE6L.js.map
