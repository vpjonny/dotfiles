import{d as ge}from"./chunk-X6Z5FRDC.js";import{g as ue}from"./chunk-VQU4JTIB.js";import{a as le}from"./chunk-ZMU6KWZP.js";import{a as N,b as D,e as C,f as y,g as ee,h as te,i as re,j as O,k as ne,m as u,n as L,p as oe,q as ie,r as se,s as q,t as B,u as R}from"./chunk-UE7TCZBL.js";import{b as ae}from"./chunk-N3C6FBKY.js";import{a as de,c as pe,d as me}from"./chunk-HLSJ3VIL.js";import{A as ce,db as W,m as x}from"./chunk-57EVB5FV.js";import{I as z,L as V,Ma as J,_e as K,af as Y,qd as S,vd as T}from"./chunk-DJGGVTSJ.js";import{Z}from"./chunk-FATTDLFQ.js";import{a as X}from"./chunk-RWWUDPHX.js";import{Ca as H,Z as _,a as U,b as G,o as j}from"./chunk-LQZGQEJ6.js";import{a as i,g as k,i as p,n as m}from"./chunk-WKJYWAXG.js";p();m();p();m();p();m();var $=i(()=>{let n=y.isLedgerSupported();return T({queryKey:n,queryFn:i(async()=>R().isSupported(),"queryFn")})},"default");p();m();var Ae=i((n,e=[],o=!1,t=!1,l=()=>{})=>{let{defaultTransportTimeout:f}=R(),c=S(),a=oe(J.getAddressType(e[0].pathType)),d=n.isConnected&&e.length>0&&a===n.selectedApp?.app,g=y.ledgerAddresses(e,t);return T({enabled:d,queryKey:g,queryFn:i(async()=>{let s=await c.getQueryData(y.ledgerTransportState());if(!s)throw new ne;return ie({transportTimeout:f,state:s,derivationPathParams:e,enableDebugLogs:o,enableLedgerXPubDerivation:t,onSuccess:l})},"queryFn"),retry:!1})},"default");p();m();var w=i((n=!1,e,o)=>{if(e?.status===o.status)return;let t,l="";switch(o.status){case"connected":t="\u{1F7E2} Connected",l=`, selected app: ${o.selectedApp?L(o.selectedApp.app):"None"}`;break;case"needs-permission":t="\u{1F7E0} Needs Permission";break;case"reconnecting":t="\u{1F7E0} Reconnecting";break;case"waiting-for-approval":t="\u{1F7E0} Waiting For Approval";break;case"not-connected":t="\u26AA\uFE0F Not Connected";break}u(n,`${t}${l}`)},"debugLogStateChange");p();m();var E=k(U());var ye=5,Te=500,I=i((n=!0,e=!1,o=2e3)=>{let t=S(),[l,f]=(0,E.useState)(o),c=(0,E.useCallback)(()=>{u(e,"disconnect event received from Ledger transport."),re(t)},[e,t]);(0,E.useEffect)(()=>("hid"in self.navigator&&self.navigator.hid.addEventListener("disconnect",c),()=>"hid"in self.navigator&&self.navigator.hid.removeEventListener("disconnect",c)),[c]);let{data:a=!1}=$(),d=n&&a,g=y.ledgerTransportState();return T({enabled:d,queryKey:g,queryFn:i(async()=>{if(!d)return N;let s=t.getQueryData(g),A,F=!1,M=0;do{try{A=(await Promise.all([Y(q(B(),e,M>0?D:s),o),K(200)]))[0]}catch{A=N}F=!!s?.isConnected&&A.status==="not-connected"&&++M<ye,F&&(O(t,D),u(e,"Attempting to reconnect..."),M===1&&w(e,s,D),await K(Te))}while(F);return M>0&&(s=D),w(e,s,A),s?.isConnected&&!A.isConnected&&ee(t).then(()=>te(t)),f(A.isConnected?3500:o),A},"queryFn"),refetchOnMount:!0,refetchInterval:l,initialData:N})},"useLedgerWireTransportState");p();m();var Ce=i((n=!0,e=!1)=>{let o=B(),t=S(),l=y.requestLedgerPermission();return T({enabled:n,queryKey:l,queryFn:i(async()=>{let c;try{u(e,"Requesting permission to connect to Ledger..."),c=await o.request()}catch(d){if(u(e,`Received error trying to request permission: ${d}`),typeof d.message=="string"&&d.message?.includes("device is already open")){u(e,"\u2705 Permission granted, device already open. Connecting to device...");let g=y.ledgerTransportState(),h=await t.getQueryData(g),s;try{s=await q(o,e,h)}catch{}return s?.isConnected?(u(e,`\u2705 Permission granted. Connected to Ledger device: ${s.transport.deviceModel?.productName??"Unknown device"}. Selected app: ${s?.selectedApp?.app??"none"}`),await O(t,s),w(e,void 0,s),{type:"granted",transport:s.transport}):(u(e,"\u274C Unable to connect. Try again and make sure device is unlocked."),{type:"unable-to-connect"})}return u(e,"\u274C Permission denied."),{type:"denied"}}if(!c)return u(e,"\u274C Unable to connect to Ledger device. Permission granted, but no Transport received."),{type:"unable-to-connect"};let a={status:"connected",isConnected:!0,transport:c,selectedApp:await se(c,o.defaultTransportTimeout)};return await O(t,a),w(e,void 0,a),u(e,`\u2705 Permission granted. Connected to Ledger device: ${c.deviceModel?.productName??"Unknown device"}`),{type:"granted",transport:c}},"queryFn"),gcTime:0,staleTime:0,refetchOnMount:!0})},"default");var P=k(U(),1);var r=k(G(),1),Le=x.div`
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  height: 100%;
  width: 100%;
`,xe=x(ge)`
  margin: auto 0px;
  padding-left: 10px;
  padding-right: 10px;
`,he=x.div`
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
`,Se=x.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-top: 55px;
`,b=x(W).attrs({size:28,lineHeight:34,weight:500})`
  margin-bottom: 8px;
  margin-top: 22px;
`,Q=x(W).attrs({size:16,color:H.colors.legacy.textDiminished})`
  max-width: 275px;
  span {
    color: white;
  }
`,Ne={ledgerActionNeedToConfirm:"ledgerActionNeedToConfirm",ledgerActionNeedToConfirmMany:"ledgerActionNeedToConfirmMany",ledgerActionNeedToConfirmBlind:"ledgerActionNeedToConfirmBlind",ledgerActionNeedToConfirmBlindMany:"ledgerActionNeedToConfirmBlindMany",ledgerActionPleaseConnect:"ledgerActionPleaseConnect",ledgerActionConfirm:"ledgerActionConfirm",ledgerActionNeedPermission:"ledgerActionNeedPermission",ledgerActionPleaseConnectAndConfirm:"ledgerActionPleaseConnectAndConfirm",commandContinue:"commandContinue",commandCancel:"commandCancel"},Xt=i(n=>!!(n&&(n.statusCode===26632||n.statusCode===27013||n.statusCode===27404||n.name==="DisconnectedDeviceDuringOperation")),"isKnownLedgerActionError"),fe=i(n=>{switch(n){case C.Bitcoin:return!1;case C.EVM:return!0;case C.Solana:return!0;case C.Sui:return!1}},"ledgerAppHasBlindSigning"),ve=i(n=>{let{data:e=N}=I(!0,j());return(0,P.useMemo)(()=>({status:e.status,isConnected:e.isConnected,isExpectedSelectedAppOpen:e.isConnected&&e.selectedApp?.app===n,transport:e.isConnected?e.transport:void 0}),[n,e])},"useMultiChainLedgerConnectivity"),we=i((n,e,o)=>{let{ledgerApp:t=C.Solana,ledgerAction:l,numberOfTransactions:f=1,cancel:c=Z}=n,{t:a}=_(),d,g;f>1?fe(t)?g=a(o.ledgerActionNeedToConfirmBlindMany,{numberOfTransactions:f,chainType:L(t)}):g=a(o.ledgerActionNeedToConfirmMany,{numberOfTransactions:f,chainType:L(t)}):fe(t)?g=a(o.ledgerActionNeedToConfirmBlind,{chainType:L(t)}):g=a(o.ledgerActionNeedToConfirm,{chainType:L(t)});let h=a(o.commandCancel),s="default",A=c;switch(e.status){case"not-connected":{d=a(o.ledgerActionPleaseConnect);break}case"reconnecting":case"waiting-for-approval":case"connected":{d=a(o.ledgerActionConfirm);break}case"needs-permission":{d=a(o.ledgerActionNeedPermission),g=a(o.ledgerActionPleaseConnectAndConfirm),s="primary",h=a(o.commandContinue),A=i(()=>{ae({url:"connect_hardware.html?permission=true"}),c()},"buttonAction");break}}return(0,P.useEffect)(()=>{if(e.isConnected&&e.transport&&(e.isExpectedSelectedAppOpen===null||e.isExpectedSelectedAppOpen))try{l(e.transport)}catch(F){V.captureError(F,z.Ledger)}},[e,l]),{primaryText:d,secondaryText:g,buttonTheme:s,buttonText:h,buttonAction:A}},"useStatelessLedgerActionProps"),Ee=P.default.memo(n=>{let{primaryText:e,secondaryText:o,buttonAction:t,buttonTheme:l,buttonText:f}=n;return(0,r.jsxs)(Le,{children:[(0,r.jsx)(xe,{icon:(0,r.jsx)(de,{diameter:75}),primaryText:e,secondaryText:o}),(0,r.jsx)(pe,{onClick:t,theme:l,children:f})]})}),Pe=i(n=>{let e=ve(n.ledgerApp??C.Solana),o=we(n,e,Ne);return(0,r.jsx)(Ee,{...o})},"MultiChainLedgerAction"),Yt=i(n=>(0,r.jsx)(Pe,{...n}),"LedgerAction"),Zt=i(({ledgerActionError:n,onRetryClick:e,onCancelClick:o})=>{let{t}=_();return(0,r.jsxs)(he,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(ue,{children:t("ledgerActionErrorHeader")}),(0,r.jsxs)(Se,{children:[(0,r.jsx)(le,{color:X(H.colors.legacy.spotNegative,.1),diameter:94,children:(0,r.jsx)(ce,{width:32})}),n?.statusCode===26632?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b,{children:t("ledgerActionErrorBlindSignDisabledPrimaryText")}),(0,r.jsx)(Q,{children:t("ledgerActionErrorBlindSignDisabledSecondaryText")})]}):(0,r.jsx)(r.Fragment,{}),n?.statusCode===27013?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b,{children:t("ledgerActionErrorUserRejectionPrimaryText")}),(0,r.jsx)(Q,{children:t("ledgerActionErrorUserRejectionSecondaryText")})]}):(0,r.jsx)(r.Fragment,{}),n?.statusCode===27404?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b,{children:t("ledgerActionErrorDeviceLockedPrimaryText")}),(0,r.jsx)(Q,{children:t("ledgerActionErrorDeviceLockedSecondaryText")})]}):(0,r.jsx)(r.Fragment,{}),n?.name==="DisconnectedDeviceDuringOperation"?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b,{children:t("ledgerActionErrorDeviceDisconnectedDuringOperationPrimaryText")}),(0,r.jsx)(Q,{children:t("ledgerActionErrorDeviceDisconnectedDuringOperationSecondaryText")})]}):(0,r.jsx)(r.Fragment,{})]})]}),(0,r.jsx)(me,{primaryText:t("commandRetry"),secondaryText:t("commandCancel"),onPrimaryClicked:e,onSecondaryClicked:o})]})},"LedgerActionError");export{$ as a,Ae as b,I as c,Ce as d,Xt as e,Yt as f,Zt as g};
//# sourceMappingURL=chunk-QW5UCU4W.js.map
