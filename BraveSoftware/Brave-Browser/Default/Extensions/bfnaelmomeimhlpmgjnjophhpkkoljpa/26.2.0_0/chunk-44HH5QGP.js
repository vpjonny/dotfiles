import{a as Ut,b as Nt,c as ut}from"./chunk-WVRYN4MY.js";import{C as Vy,H as Pi,L as Wy,M as qo,P as vt,_a as nw,a as Ag,ba as Zy,ea as Yy,fa as Xy,g as fd,ja as os,k as $y,q as hc,qa as yc,r as Oo,ra as Jy,sa as ew,ta as tw,va as rw,x as gc,y as jy,za as ow}from"./chunk-5JGASDWN.js";import{a as sw,b as iw}from"./chunk-ZDPKBPMV.js";import{V as hy,aa as gy,e as Yt,o as fy,pa as yy,ta as No}from"./chunk-N6SSDFMX.js";import{a as xg}from"./chunk-YJCG6GWC.js";import{A as Wn,C as ld,D as ki,Hb as ry,Lb as tc,M as zg,Mb as Er,Pb as oy,Sb as ny,Tb as sy,Ub as iy,Z as Xg,Zb as ay,_ as Jg,b as Mg,cb as ec,e as Ug,ea as Do,fa as pr,i as Og,j as Ro,ja as Ja,jc as cy,mc as uy,na as ey,o as qg,qc as st,sb as ty,uc as ly,vb as ye}from"./chunk-W7IWPUIQ.js";import{$c as qy,Cb as vy,Cd as Gy,Eb as _y,Fd as dc,Gb as Ry,Ib as Dy,Kb as By,Kd as X,L as nc,Mb as Ny,Nb as Ly,Ob as ac,P as Ay,Pb as cc,Q as xy,Qd as mc,R as Ey,Rd as Ky,S as Cy,T as sc,Ua as Mo,Uc as pc,Vd as md,Wd as kr,Zc as ae,_c as Xt,ab as ky,ae as Le,be as fc,c as wy,d as dt,e as Xn,f as Or,g as Lo,gb as ic,hb as es,ic as My,id as Cr,kc as Uo,kd as zy,ld as Qy,mc as uc,md as Hy,nc as ts,ob as dd,oc as rs,p as Sy,pb as Iy,pc as Uy,q as by,qc as Oy,td as un,u as Ty,vc as de,w as Jn,wc as Fi,xb as Fy,xc as lc,yb as Py}from"./chunk-4SCKDS7G.js";import{$c as j,$d as Wa,$e as Xa,Ad as Lg,Ae as Ya,B as G,Be as Qg,Ce as Hg,Dc as jn,E as J,Ec as Vn,G as Oe,H as D,Ha as Ei,I as v,Ia as Ig,K as $n,Ka as xr,L as k,La as oe,Lb as ud,Oe as Gg,Pe as Kg,Qe as Tt,Re as Ae,Te as Zn,Vb as HI,Ve as $g,We as jg,Xb as GI,Yd as bt,Zb as Fg,Zd as Va,_ as Eg,_e as Vg,aa as Cg,ae as _o,be as Mr,cf as Zg,dc as C,de as qt,e as $a,ec as to,ee as zt,ef as Yg,fc as V,fd as lt,ff as Ur,g as yg,gc as vo,h as wg,hc as Pg,i as It,ic as Ft,jc as We,jd as Rg,kc as L,kd as Dg,l as Sg,lc as Ci,m as ja,mc as vg,md as Bg,n as bg,oc as Lr,p as Tg,qd as Be,qf as q,ra as se,sd as cn,ta as kg,td as Ng,ua as ce,v as pe,vd as te,wa as Ot,wd as ge,yc as _g,zc as lr,ze as Za}from"./chunk-DJGGVTSJ.js";import{D as gg,d as fg,h as xi,t as hg,u as Kn}from"./chunk-FATTDLFQ.js";import{b as ue}from"./chunk-2RWUL32J.js";import{Aa as pd,D as Re,F as Lt,G as an,Ga as Bo,H as Nr,La as rc,Lb as dy,Na as we,Pb as VI,Qb as WI,Ra as ro,Sb as ZI,U as R,Ua as Pt,Wa as oc,Wb as Yn,Z as qe,_ as tt,_b as my,a as z,b as Ve,ba as KI,ea as $I,fb as jI,j as a,k as x,l as K,nb as Ii,vb as py,xa as Wg}from"./chunk-LQZGQEJ6.js";import{a as i,d as et,g as N,i as u,j as h,l as QI,m as Buffer,n as l}from"./chunk-WKJYWAXG.js";var uw=et((oo,cw)=>{u();l();var aw=typeof self<"u"?self:oo,wc=function(){function t(){this.fetch=!1,this.DOMException=aw.DOMException}return i(t,"F"),t.prototype=aw,new t}();(function(t){var e=function(r){var o={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};function n(F){return F&&DataView.prototype.isPrototypeOf(F)}if(i(n,"isDataView"),o.arrayBuffer)var s=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],c=ArrayBuffer.isView||function(F){return F&&s.indexOf(Object.prototype.toString.call(F))>-1};function p(F){if(typeof F!="string"&&(F=String(F)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(F))throw new TypeError("Invalid character in header field name");return F.toLowerCase()}i(p,"normalizeName");function d(F){return typeof F!="string"&&(F=String(F)),F}i(d,"normalizeValue");function m(F){var B={next:i(function(){var W=F.shift();return{done:W===void 0,value:W}},"next")};return o.iterable&&(B[Symbol.iterator]=function(){return B}),B}i(m,"iteratorFor");function f(F){this.map={},F instanceof f?F.forEach(function(B,W){this.append(W,B)},this):Array.isArray(F)?F.forEach(function(B){this.append(B[0],B[1])},this):F&&Object.getOwnPropertyNames(F).forEach(function(B){this.append(B,F[B])},this)}i(f,"Headers"),f.prototype.append=function(F,B){F=p(F),B=d(B);var W=this.map[F];this.map[F]=W?W+", "+B:B},f.prototype.delete=function(F){delete this.map[p(F)]},f.prototype.get=function(F){return F=p(F),this.has(F)?this.map[F]:null},f.prototype.has=function(F){return this.map.hasOwnProperty(p(F))},f.prototype.set=function(F,B){this.map[p(F)]=d(B)},f.prototype.forEach=function(F,B){for(var W in this.map)this.map.hasOwnProperty(W)&&F.call(B,this.map[W],W,this)},f.prototype.keys=function(){var F=[];return this.forEach(function(B,W){F.push(W)}),m(F)},f.prototype.values=function(){var F=[];return this.forEach(function(B){F.push(B)}),m(F)},f.prototype.entries=function(){var F=[];return this.forEach(function(B,W){F.push([W,B])}),m(F)},o.iterable&&(f.prototype[Symbol.iterator]=f.prototype.entries);function g(F){if(F.bodyUsed)return Promise.reject(new TypeError("Already read"));F.bodyUsed=!0}i(g,"consumed");function w(F){return new Promise(function(B,W){F.onload=function(){B(F.result)},F.onerror=function(){W(F.error)}})}i(w,"fileReaderReady");function y(F){var B=new FileReader,W=w(B);return B.readAsArrayBuffer(F),W}i(y,"readBlobAsArrayBuffer");function S(F){var B=new FileReader,W=w(B);return B.readAsText(F),W}i(S,"readBlobAsText");function b(F){for(var B=new Uint8Array(F),W=new Array(B.length),re=0;re<B.length;re++)W[re]=String.fromCharCode(B[re]);return W.join("")}i(b,"readArrayBufferAsText");function T(F){if(F.slice)return F.slice(0);var B=new Uint8Array(F.byteLength);return B.set(new Uint8Array(F)),B.buffer}i(T,"bufferClone");function A(){return this.bodyUsed=!1,this._initBody=function(F){this._bodyInit=F,F?typeof F=="string"?this._bodyText=F:o.blob&&Blob.prototype.isPrototypeOf(F)?this._bodyBlob=F:o.formData&&FormData.prototype.isPrototypeOf(F)?this._bodyFormData=F:o.searchParams&&URLSearchParams.prototype.isPrototypeOf(F)?this._bodyText=F.toString():o.arrayBuffer&&o.blob&&n(F)?(this._bodyArrayBuffer=T(F.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):o.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(F)||c(F))?this._bodyArrayBuffer=T(F):this._bodyText=F=Object.prototype.toString.call(F):this._bodyText="",this.headers.get("content-type")||(typeof F=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):o.searchParams&&URLSearchParams.prototype.isPrototypeOf(F)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o.blob&&(this.blob=function(){var F=g(this);if(F)return F;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?g(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(y)}),this.text=function(){var F=g(this);if(F)return F;if(this._bodyBlob)return S(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(b(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o.formData&&(this.formData=function(){return this.text().then(U)}),this.json=function(){return this.text().then(JSON.parse)},this}i(A,"Body");var E=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function I(F){var B=F.toUpperCase();return E.indexOf(B)>-1?B:F}i(I,"normalizeMethod");function P(F,B){B=B||{};var W=B.body;if(F instanceof P){if(F.bodyUsed)throw new TypeError("Already read");this.url=F.url,this.credentials=F.credentials,B.headers||(this.headers=new f(F.headers)),this.method=F.method,this.mode=F.mode,this.signal=F.signal,!W&&F._bodyInit!=null&&(W=F._bodyInit,F.bodyUsed=!0)}else this.url=String(F);if(this.credentials=B.credentials||this.credentials||"same-origin",(B.headers||!this.headers)&&(this.headers=new f(B.headers)),this.method=I(B.method||this.method||"GET"),this.mode=B.mode||this.mode||null,this.signal=B.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&W)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(W)}i(P,"Request"),P.prototype.clone=function(){return new P(this,{body:this._bodyInit})};function U(F){var B=new FormData;return F.trim().split("&").forEach(function(W){if(W){var re=W.split("="),ee=re.shift().replace(/\+/g," "),Y=re.join("=").replace(/\+/g," ");B.append(decodeURIComponent(ee),decodeURIComponent(Y))}}),B}i(U,"decode");function O(F){var B=new f,W=F.replace(/\r?\n[\t ]+/g," ");return W.split(/\r?\n/).forEach(function(re){var ee=re.split(":"),Y=ee.shift().trim();if(Y){var at=ee.join(":").trim();B.append(Y,at)}}),B}i(O,"parseHeaders"),A.call(P.prototype);function _(F,B){B||(B={}),this.type="default",this.status=B.status===void 0?200:B.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in B?B.statusText:"OK",this.headers=new f(B.headers),this.url=B.url||"",this._initBody(F)}i(_,"Response"),A.call(_.prototype),_.prototype.clone=function(){return new _(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new f(this.headers),url:this.url})},_.error=function(){var F=new _(null,{status:0,statusText:""});return F.type="error",F};var H=[301,302,303,307,308];_.redirect=function(F,B){if(H.indexOf(B)===-1)throw new RangeError("Invalid status code");return new _(null,{status:B,headers:{location:F}})},r.DOMException=t.DOMException;try{new r.DOMException}catch{r.DOMException=function(B,W){this.message=B,this.name=W;var re=Error(B);this.stack=re.stack},r.DOMException.prototype=Object.create(Error.prototype),r.DOMException.prototype.constructor=r.DOMException}function Q(F,B){return new Promise(function(W,re){var ee=new P(F,B);if(ee.signal&&ee.signal.aborted)return re(new r.DOMException("Aborted","AbortError"));var Y=new XMLHttpRequest;function at(){Y.abort()}i(at,"abortXhr"),Y.onload=function(){var Ee={status:Y.status,statusText:Y.statusText,headers:O(Y.getAllResponseHeaders()||"")};Ee.url="responseURL"in Y?Y.responseURL:Ee.headers.get("X-Request-URL");var St="response"in Y?Y.response:Y.responseText;W(new _(St,Ee))},Y.onerror=function(){re(new TypeError("Network request failed"))},Y.ontimeout=function(){re(new TypeError("Network request failed"))},Y.onabort=function(){re(new r.DOMException("Aborted","AbortError"))},Y.open(ee.method,ee.url,!0),ee.credentials==="include"?Y.withCredentials=!0:ee.credentials==="omit"&&(Y.withCredentials=!1),"responseType"in Y&&o.blob&&(Y.responseType="blob"),ee.headers.forEach(function(Ee,St){Y.setRequestHeader(St,Ee)}),ee.signal&&(ee.signal.addEventListener("abort",at),Y.onreadystatechange=function(){Y.readyState===4&&ee.signal.removeEventListener("abort",at)}),Y.send(typeof ee._bodyInit>"u"?null:ee._bodyInit)})}return i(Q,"fetch"),Q.polyfill=!0,t.fetch||(t.fetch=Q,t.Headers=f,t.Request=P,t.Response=_),r.Headers=f,r.Request=P,r.Response=_,r.fetch=Q,Object.defineProperty(r,"__esModule",{value:!0}),r}({})})(wc);wc.fetch.ponyfill=!0;delete wc.fetch.polyfill;var ns=wc;oo=ns.fetch;oo.default=ns.fetch;oo.fetch=ns.fetch;oo.Headers=ns.Headers;oo.Request=ns.Request;oo.Response=ns.Response;cw.exports=oo});var pw=et((X2,lw)=>{u();l();(function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e={rotl:i(function(r,o){return r<<o|r>>>32-o},"rotl"),rotr:i(function(r,o){return r<<32-o|r>>>o},"rotr"),endian:i(function(r){if(r.constructor==Number)return e.rotl(r,8)&16711935|e.rotl(r,24)&4278255360;for(var o=0;o<r.length;o++)r[o]=e.endian(r[o]);return r},"endian"),randomBytes:i(function(r){for(var o=[];r>0;r--)o.push(Math.floor(Math.random()*256));return o},"randomBytes"),bytesToWords:i(function(r){for(var o=[],n=0,s=0;n<r.length;n++,s+=8)o[s>>>5]|=r[n]<<24-s%32;return o},"bytesToWords"),wordsToBytes:i(function(r){for(var o=[],n=0;n<r.length*32;n+=8)o.push(r[n>>>5]>>>24-n%32&255);return o},"wordsToBytes"),bytesToHex:i(function(r){for(var o=[],n=0;n<r.length;n++)o.push((r[n]>>>4).toString(16)),o.push((r[n]&15).toString(16));return o.join("")},"bytesToHex"),hexToBytes:i(function(r){for(var o=[],n=0;n<r.length;n+=2)o.push(parseInt(r.substr(n,2),16));return o},"hexToBytes"),bytesToBase64:i(function(r){for(var o=[],n=0;n<r.length;n+=3)for(var s=r[n]<<16|r[n+1]<<8|r[n+2],c=0;c<4;c++)n*8+c*6<=r.length*8?o.push(t.charAt(s>>>6*(3-c)&63)):o.push("=");return o.join("")},"bytesToBase64"),base64ToBytes:i(function(r){r=r.replace(/[^A-Z0-9+\/]/ig,"");for(var o=[],n=0,s=0;n<r.length;s=++n%4)s!=0&&o.push((t.indexOf(r.charAt(n-1))&Math.pow(2,-2*s+8)-1)<<s*2|t.indexOf(r.charAt(n))>>>6-s*2);return o},"base64ToBytes")};lw.exports=e})()});var gd=et((rq,dw)=>{u();l();var hd={utf8:{stringToBytes:i(function(t){return hd.bin.stringToBytes(unescape(encodeURIComponent(t)))},"stringToBytes"),bytesToString:i(function(t){return decodeURIComponent(escape(hd.bin.bytesToString(t)))},"bytesToString")},bin:{stringToBytes:i(function(t){for(var e=[],r=0;r<t.length;r++)e.push(t.charCodeAt(r)&255);return e},"stringToBytes"),bytesToString:i(function(t){for(var e=[],r=0;r<t.length;r++)e.push(String.fromCharCode(t[r]));return e.join("")},"bytesToString")}};dw.exports=hd});var fw=et((iq,mw)=>{u();l();(function(){var t=pw(),e=gd().utf8,r=gd().bin,o=i(function(s){s.constructor==String?s=e.stringToBytes(s):typeof Buffer<"u"&&typeof Buffer.isBuffer=="function"&&Buffer.isBuffer(s)?s=Array.prototype.slice.call(s,0):Array.isArray(s)||(s=s.toString());var c=t.bytesToWords(s),p=s.length*8,d=[],m=1732584193,f=-271733879,g=-1732584194,w=271733878,y=-1009589776;c[p>>5]|=128<<24-p%32,c[(p+64>>>9<<4)+15]=p;for(var S=0;S<c.length;S+=16){for(var b=m,T=f,A=g,E=w,I=y,P=0;P<80;P++){if(P<16)d[P]=c[S+P];else{var U=d[P-3]^d[P-8]^d[P-14]^d[P-16];d[P]=U<<1|U>>>31}var O=(m<<5|m>>>27)+y+(d[P]>>>0)+(P<20?(f&g|~f&w)+1518500249:P<40?(f^g^w)+1859775393:P<60?(f&g|f&w|g&w)-1894007588:(f^g^w)-899497514);y=w,w=g,g=f<<30|f>>>2,f=m,m=O}m+=b,f+=T,g+=A,w+=E,y+=I}return[m,f,g,w,y]},"sha1"),n=i(function(s,c){var p=t.wordsToBytes(o(s));return c&&c.asBytes?p:c&&c.asString?r.bytesToString(p):t.bytesToHex(p)},"api");n._blocksize=16,n._digestsize=20,mw.exports=n})()});var yw=et((hq,XI)=>{XI.exports={name:"@phantom-labs/blocklist",version:"0.13.0",main:"index.js",types:"index.d.ts",repository:"git@github.com:phantom-labs/blocklist.git",author:"Jordan Leigh <AlwaysBCoding@gmail.com>",license:"MIT",scripts:{build:"node build.js"},dependencies:{"js-yaml":"^4.1.0",sha3:"^2.1.4"}}});var ww=et((gq,JI)=>{JI.exports={blocklist:["phantomweb.app","aurory.app","solvision.io","staratlas.art","starsatlas.com","sollet.cc","raydlum.io","aurorynft.com","sneks.gg","solletweb.io","i-sollet.com","fancyfrenchienft.art","solanawebwallet.online","phahtom.com","server-syncwallet.com","staratias.app","raydium.network","grapesnetwork.me","staratias.art","soistarter.org","audius-nft.top","aurory.me","degenapes.app","phantom-app.online","phantomwallet.net","dapps-node.com","phantom-app.link","solanaoutage.com","walletconnectdapps.net","staratlas.cx","web-phantom.app","0120tt.com"],whitelist:[],fuzzylist:[],contentHash:"830ea1c9a833213eabc17990adf053081f503b1203ca9a2c711db7199e657293"}});var Sw=et(Sd=>{u();l();var{version:eF}=yw(),tF=ww(),rF=i(()=>eF,"getVersion"),oF=i(()=>tF,"getBlocklist");Sd.getVersion=rF;Sd.getBlocklist=oF});var Tw=et(is=>{"use strict";u();l();is.__esModule=!0;is.distance=is.closest=void 0;var no=new Uint32Array(65536),nF=i(function(t,e){for(var r=t.length,o=e.length,n=1<<r-1,s=-1,c=0,p=r,d=r;d--;)no[t.charCodeAt(d)]|=1<<d;for(d=0;d<o;d++){var m=no[e.charCodeAt(d)],f=m|c;m|=(m&s)+s^s,c|=~(m|s),s&=m,c&n&&p++,s&n&&p--,c=c<<1|1,s=s<<1|~(f|c),c&=f}for(d=r;d--;)no[t.charCodeAt(d)]=0;return p},"myers_32"),sF=i(function(t,e){for(var r=e.length,o=t.length,n=[],s=[],c=Math.ceil(r/32),p=Math.ceil(o/32),d=0;d<c;d++)s[d]=-1,n[d]=0;for(var m=0;m<p-1;m++){for(var f=0,g=-1,w=m*32,y=Math.min(32,o)+w,S=w;S<y;S++)no[t.charCodeAt(S)]|=1<<S;for(var d=0;d<r;d++){var b=no[e.charCodeAt(d)],T=s[d/32|0]>>>d&1,A=n[d/32|0]>>>d&1,E=b|f,I=((b|A)&g)+g^g|b|A,P=f|~(I|g),U=g&I;P>>>31^T&&(s[d/32|0]^=1<<d),U>>>31^A&&(n[d/32|0]^=1<<d),P=P<<1|T,U=U<<1|A,g=U|~(E|P),f=P&E}for(var S=w;S<y;S++)no[t.charCodeAt(S)]=0}for(var O=0,_=-1,H=m*32,Q=Math.min(32,o-H)+H,S=H;S<Q;S++)no[t.charCodeAt(S)]|=1<<S;for(var F=o,d=0;d<r;d++){var b=no[e.charCodeAt(d)],T=s[d/32|0]>>>d&1,A=n[d/32|0]>>>d&1,E=b|O,I=((b|A)&_)+_^_|b|A,P=O|~(I|_),U=_&I;F+=P>>>o-1&1,F-=U>>>o-1&1,P>>>31^T&&(s[d/32|0]^=1<<d),U>>>31^A&&(n[d/32|0]^=1<<d),P=P<<1|T,U=U<<1|A,_=U|~(E|P),O=P&E}for(var S=H;S<Q;S++)no[t.charCodeAt(S)]=0;return F},"myers_x"),bw=i(function(t,e){if(t.length<e.length){var r=e;e=t,t=r}return e.length===0?t.length:t.length<=32?nF(t,e):sF(t,e)},"distance");is.distance=bw;var iF=i(function(t,e){for(var r=1/0,o=0,n=0;n<e.length;n++){var s=bw(t,e[n]);s<r&&(r=s,o=n)}return e[o]},"closest");is.closest=iF});var Aw=et((bd,vi)=>{u();l();(function(){"use strict";var t;try{t=typeof Intl<"u"&&typeof Intl.Collator<"u"?Intl.Collator("generic",{sensitivity:"base"}):null}catch{console.log("Collator could not be initialized and wouldn't be used")}var e=Tw(),r=[],o=[],n={get:i(function(s,c,p){var d=p&&t&&p.useCollator;if(d){var m=s.length,f=c.length;if(m===0)return f;if(f===0)return m;var g,w,y,S,b;for(y=0;y<f;++y)r[y]=y,o[y]=c.charCodeAt(y);r[f]=f;var T;for(y=0;y<m;++y){for(w=y+1,S=0;S<f;++S)g=w,T=t.compare(s.charAt(y),String.fromCharCode(o[S]))===0,w=r[S]+(T?0:1),b=g+1,w>b&&(w=b),b=r[S+1]+1,w>b&&(w=b),r[S]=g;r[S]=w}return w}return e.distance(s,c)},"get")};typeof define<"u"&&define!==null&&define.amd?define(function(){return n}):typeof vi<"u"&&vi!==null&&typeof bd<"u"&&vi.exports===bd?vi.exports=n:(typeof self<"u"&&typeof self.postMessage=="function"&&typeof self.importScripts=="function"||typeof self<"u"&&self!==null)&&(self.Levenshtein=n)})()});var Y0=et(Z0=>{"use strict";u();l();var zs=z();function Q1(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}i(Q1,"is");var H1=typeof Object.is=="function"?Object.is:Q1,G1=zs.useState,K1=zs.useEffect,$1=zs.useLayoutEffect,j1=zs.useDebugValue;function V1(t,e){var r=e(),o=G1({inst:{value:r,getSnapshot:e}}),n=o[0].inst,s=o[1];return $1(function(){n.value=r,n.getSnapshot=e,Ff(n)&&s({inst:n})},[t,r,e]),K1(function(){return Ff(n)&&s({inst:n}),t(function(){Ff(n)&&s({inst:n})})},[t]),j1(r),r}i(V1,"useSyncExternalStore$2");function Ff(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!H1(t,r)}catch{return!0}}i(Ff,"checkIfSnapshotChanged");function W1(t,e){return e()}i(W1,"useSyncExternalStore$1");var Z1=typeof self>"u"||typeof self.document>"u"||typeof self.document.createElement>"u"?W1:V1;Z0.useSyncExternalStore=zs.useSyncExternalStore!==void 0?zs.useSyncExternalStore:Z1});var J0=et(X0=>{"use strict";u();l();h.NODE_ENV!=="production"&&function(){function t(y,S){return y===S&&(y!==0||1/y===1/S)||y!==y&&S!==S}i(t,"is");function e(y,S){f||n.startTransition===void 0||(f=!0,console.error("You are using an outdated, pre-release alpha of React 18 that does not support useSyncExternalStore. The use-sync-external-store shim will not work correctly. Upgrade to a newer pre-release."));var b=S();if(!g){var T=S();s(b,T)||(console.error("The result of getSnapshot should be cached to avoid an infinite loop"),g=!0)}T=c({inst:{value:b,getSnapshot:S}});var A=T[0].inst,E=T[1];return d(function(){A.value=b,A.getSnapshot=S,r(A)&&E({inst:A})},[y,b,S]),p(function(){return r(A)&&E({inst:A}),y(function(){r(A)&&E({inst:A})})},[y]),m(b),b}i(e,"useSyncExternalStore$2");function r(y){var S=y.getSnapshot;y=y.value;try{var b=S();return!s(y,b)}catch{return!0}}i(r,"checkIfSnapshotChanged");function o(y,S){return S()}i(o,"useSyncExternalStore$1"),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var n=z(),s=typeof Object.is=="function"?Object.is:t,c=n.useState,p=n.useEffect,d=n.useLayoutEffect,m=n.useDebugValue,f=!1,g=!1,w=typeof self>"u"||typeof self.document>"u"||typeof self.document.createElement>"u"?o:e;X0.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:w,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()});var vf=et((Eae,Pf)=>{"use strict";u();l();h.NODE_ENV==="production"?Pf.exports=Y0():Pf.exports=J0()});var tA=et(eA=>{"use strict";u();l();var yl=z(),Y1=vf();function X1(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}i(X1,"is");var J1=typeof Object.is=="function"?Object.is:X1,eB=Y1.useSyncExternalStore,tB=yl.useRef,rB=yl.useEffect,oB=yl.useMemo,nB=yl.useDebugValue;eA.useSyncExternalStoreWithSelector=function(t,e,r,o,n){var s=tB(null);if(s.current===null){var c={hasValue:!1,value:null};s.current=c}else c=s.current;s=oB(function(){function d(y){if(!m){if(m=!0,f=y,y=o(y),n!==void 0&&c.hasValue){var S=c.value;if(n(S,y))return g=S}return g=y}if(S=g,J1(f,y))return S;var b=o(y);return n!==void 0&&n(S,b)?(f=y,S):(f=y,g=b)}i(d,"memoizedSelector");var m=!1,f,g,w=r===void 0?null:r;return[function(){return d(e())},w===null?void 0:function(){return d(w())}]},[e,r,o,n]);var p=eB(t,s[0],s[1]);return rB(function(){c.hasValue=!0,c.value=p},[p]),nB(p),p}});var oA=et(rA=>{"use strict";u();l();h.NODE_ENV!=="production"&&function(){function t(m,f){return m===f&&(m!==0||1/m===1/f)||m!==m&&f!==f}i(t,"is"),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(Error());var e=z(),r=vf(),o=typeof Object.is=="function"?Object.is:t,n=r.useSyncExternalStore,s=e.useRef,c=e.useEffect,p=e.useMemo,d=e.useDebugValue;rA.useSyncExternalStoreWithSelector=function(m,f,g,w,y){var S=s(null);if(S.current===null){var b={hasValue:!1,value:null};S.current=b}else b=S.current;S=p(function(){function A(O){if(!E){if(E=!0,I=O,O=w(O),y!==void 0&&b.hasValue){var _=b.value;if(y(_,O))return P=_}return P=O}if(_=P,o(I,O))return _;var H=w(O);return y!==void 0&&y(_,H)?(I=O,_):(I=O,P=H)}i(A,"memoizedSelector");var E=!1,I,P,U=g===void 0?null:g;return[function(){return A(f())},U===null?void 0:function(){return A(U())}]},[f,g,w,y]);var T=n(m,S[0],S[1]);return c(function(){b.hasValue=!0,b.value=T},[T]),d(T),T},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(Error())}()});var nA=et((Nae,_f)=>{"use strict";u();l();h.NODE_ENV==="production"?_f.exports=tA():_f.exports=oA()});var TE=et((mEe,bE)=>{"use strict";u();l();bE.exports=t=>{if(Object.prototype.toString.call(t)!=="[object Object]")return!1;let e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}});var IE=et((CE,kE)=>{"use strict";u();l();var ql=TE(),{hasOwnProperty:xE}=Object.prototype,{propertyIsEnumerable:wL}=Object,ti=i((t,e,r)=>Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!0,configurable:!0}),"defineProperty"),SL=CE,AE={concatArrays:!1,ignoreUndefined:!1},zl=i(t=>{let e=[];for(let r in t)xE.call(t,r)&&e.push(r);if(Object.getOwnPropertySymbols){let r=Object.getOwnPropertySymbols(t);for(let o of r)wL.call(t,o)&&e.push(o)}return e},"getEnumerableOwnPropertyKeys");function ri(t){return Array.isArray(t)?bL(t):ql(t)?TL(t):t}i(ri,"clone");function bL(t){let e=t.slice(0,0);return zl(t).forEach(r=>{ti(e,r,ri(t[r]))}),e}i(bL,"cloneArray");function TL(t){let e=Object.getPrototypeOf(t)===null?Object.create(null):{};return zl(t).forEach(r=>{ti(e,r,ri(t[r]))}),e}i(TL,"cloneOptionObject");var EE=i((t,e,r,o)=>(r.forEach(n=>{typeof e[n]>"u"&&o.ignoreUndefined||(n in t&&t[n]!==Object.getPrototypeOf(t)?ti(t,n,nh(t[n],e[n],o)):ti(t,n,ri(e[n])))}),t),"mergeKeys"),AL=i((t,e,r)=>{let o=t.slice(0,0),n=0;return[t,e].forEach(s=>{let c=[];for(let p=0;p<s.length;p++)xE.call(s,p)&&(c.push(String(p)),s===t?ti(o,n++,s[p]):ti(o,n++,ri(s[p])));o=EE(o,s,zl(s).filter(p=>!c.includes(p)),r)}),o},"concatArrays");function nh(t,e,r){return r.concatArrays&&Array.isArray(t)&&Array.isArray(e)?AL(t,e,r):!ql(e)||!ql(t)?ri(e):EE(t,e,zl(e),r)}i(nh,"merge");kE.exports=function(...t){let e=nh(ri(AE),this!==SL&&this||{},AE),r={_:{}};for(let o of t)if(o!==void 0){if(!ql(o))throw new TypeError("`"+o+"` is not an Option Object");r=nh(r,{_:o},e)}return r._}});var Ik=et((i2e,kk)=>{u();l();function DU(t,e,r,o){for(var n=-1,s=t==null?0:t.length;++n<s;){var c=t[n];e(o,c,r(c),t)}return o}i(DU,"arrayAggregator");kk.exports=DU});var Pk=et((l2e,Fk)=>{u();l();var BU=WI();function NU(t,e,r,o){return BU(t,function(n,s,c){e(o,n,r(n),c)}),o}i(NU,"baseAggregator");Fk.exports=NU});var _k=et((f2e,vk)=>{u();l();var LU=Ik(),MU=Pk(),UU=jI(),OU=$I();function qU(t,e){return function(r,o){var n=OU(r)?LU:MU,s=e?e():{};return n(r,t,UU(o,2),s)}}i(qU,"createAggregator");vk.exports=qU});var Dk=et((w2e,Rk)=>{u();l();var zU=KI(),QU=_k(),HU=QU(function(t,e,r){zU(t,r,e)});Rk.exports=HU});u();l();u();l();var hw=N(uw(),1),gw=N(fw(),1),yd=N(QI(),1);var ss=(t=>(t.BLOCK="BLOCK",t.NONE="NONE",t))(ss||{});function YI(t,e){for(let r=0;r<t.k;r++){let o=(0,gw.default)(`${t.salt}_${e}_${r}`,{asBytes:!0}),s=yd.Buffer.from(o).subarray(0,4).readUInt32BE(0)%t.bits,c=Math.floor(s/24),p=yd.Buffer.from(t.bitVector.slice(c*4,c*4+4),"base64"),d=s%24,m=Math.floor(d/8),f=d%8;if(!(p[m]&1<<7-f))return!1}return!0}i(YI,"lookup");var lq=typeof self<"u"&&self.fetch?self.fetch:hw.default;function wd(t,e,r,o){let s=new URL(o).hostname.toLowerCase().replace(/\.$/,"").split(".");for(let c=0;c<s.length-1;c++){let p=s.slice(c).join(".");if(e.includes(p)||YI(t,p)&&!r.includes(p))return"BLOCK"}return"NONE"}i(wd,"scanDomain");var Sc=N(Sw());var Iw=N(Aw());u();l();var xw="https://blocklist.phantom.app/multichain.json",Td="https://blowfish-blocklist-proxy.phantom.app",aF="https://github.com/phantom-labs/blocklist",Ad=i((t=3)=>({retry:t,retryDelay:i(e=>Math.min(1e3*2**e,3e4),"retryDelay")}),"reactQueryExponentialBackoff"),qr={SLIPPAGE_EXCEEDED:"SLIPPAGE_EXCEEDED",INSUFFICIENT_FUNDS:"INSUFFICIENT_FUNDS",INSUFFICIENT_GAS:"INSUFFICIENT_GAS",UNKNOWN_ERROR:"UNKNOWN_ERROR",SIMULATION_FAILED:"SIMULATION_FAILED",TRANSACTION_EXPIRED:"TRANSACTION_EXPIRED",ACCOUNT_FROZEN:"ACCOUNT_FROZEN",SIMULATION_TIMEOUT:"SIMULATION_TIMEOUT",STALE_QUOTE:"STALE_QUOTE"},zo;(function(t){t[t.info=5]="info",t[t.error=4]="error",t[t.criticalError=3]="criticalError",t[t.alert=2]="alert",t[t.criticalAlert=1]="criticalAlert"})(zo||(zo={}));function cF(t){return{[zo.criticalAlert]:"1-critical-alert",[zo.alert]:"2-alert",[zo.criticalError]:"3-critical-error",[zo.error]:"4-error",[zo.info]:"5-information"}[t]}i(cF,"scanWarningVariantToUiLevel");var uF=3,kd=6e5,lF=6e4,Oq=a.object({type:a.union([a.literal("all"),a.literal("blocklist"),a.literal("whitelist"),a.literal("error"),a.literal("fuzzy"),a.literal("blowfishBloomFilter")]),result:a.boolean(),source:a.optional(a.string()),match:a.string().optional(),isSubdomainDomainWhitelisted:a.boolean().optional()}),qq=a.object({localHash:a.any(),cursor:a.any()}),Id=a.object({bitVector:a.string(),k:a.number(),hash:a.string(),bits:a.number(),salt:a.string()}),Fw=a.union([a.object({bloomFilter:Id,bloomFilterHash:a.string(),recentlyAdded:a.array(a.string()),recentlyRemoved:a.array(a.string()),nextCursor:a.string()}),a.object({bloomFilter:Id.optional(),bloomFilterHash:a.optional(a.string()),recentlyAdded:a.array(a.string()),recentlyRemoved:a.array(a.string()),nextCursor:a.string()})]),Pw=a.object({bloomFilter:Id,lastUpdated:a.number()}).nullish(),vw=a.object({recentlyAdded:a.array(a.string()),recentlyRemoved:a.array(a.string()),lastUpdated:a.number().optional()}).nullish(),_i=class{static{i(this,"PhishingDetector")}blocklist;whitelist;fuzzylist;tolerance;constructor(e,r,o,n){this.blocklist=xd(e),this.whitelist=xd(r),this.fuzzylist=xd(o),this.tolerance=n||uF}check(e,r){if(!e)return{type:"all",result:!1,isSubdomainDomainWhitelisted:!1};let o=bc(e),n=Fd(o);if(dF(n,this.whitelist)){let d=new URL(e).hostname;if(Ed(Fd(d),this.blocklist)){let f={type:"blocklist",result:!0,source:d,isSubdomainDomainWhitelisted:!0};return r.capture("blockedDomain",{data:f}),f}else return{type:"whitelist",result:!1,source:d,isSubdomainDomainWhitelisted:!0}}if(Ed(n,this.whitelist))return{type:"whitelist",result:!1,source:o,isSubdomainDomainWhitelisted:!1};if(Ed(n,this.blocklist)){let d={type:"blocklist",result:!0,source:o,isSubdomainDomainWhitelisted:!1};return r.capture("blockedDomain",{data:d}),d}if(this.tolerance>0){let d=Ew(n);d=d.replace("www.","");let m=this.fuzzylist.find(f=>{let g=Ew(f);return Iw.default.get(d,g)<=this.tolerance});if(m)return{type:"fuzzy",result:!0,match:pF(m),source:o,isSubdomainDomainWhitelisted:!1}}return{type:"all",result:!1,source:o,isSubdomainDomainWhitelisted:!1}}},bc=i(t=>{let e=new URL(t).hostname.replace(/\.$/,"").split(".");return e.slice(0).slice(-(e.length===4?3:2)).join(".")},"removeSubdomainFromDomain"),xd=i(t=>t.map(Fd),"processDomainList"),Fd=i(t=>t.split(".").reverse(),"domainToParts"),pF=i(t=>t.slice().reverse().join("."),"domainPartsToDomain"),Ew=i(t=>t.slice(1).reverse().join("."),"domainPartsToFuzzyForm"),Ed=i((t,e)=>e.some(r=>r.length>t.length?!1:r.every((o,n)=>t[n]===o)),"matchPartsAgainstList"),dF=i((t,e)=>e.some(r=>r[0]===t[0]&&r[1]===t[1]&&r[2]==="*"),"matchWhitelistedHostingDomain"),mF=i(async t=>{let e=(0,Sc.getBlocklist)(),r=await t.get(ge.CachedBlocklistDiff),o=null;try{o=JSON.parse(`${r}`)}catch(n){k.captureError(new Error(`Error parsing blocklist diff: ${n?.message}`),v.Generic)}if(o&&o.expiresAt&&o.expiresAt>Date.now())return new _i(e.blocklist.concat(o.blocklist),e.whitelist.concat(o.whitelist),e.fuzzylist.concat(o.fuzzylist));{let n={},s=(0,Sc.getVersion)();o&&(n.lastContentHash=`${o.contentHash}`),s&&(n.localBlocklistVersion=`${s}`);let c=await G.headers(n).noBearer().get(xw);if(c.status===200){let p=c.data;return p.expiresAt=Date.now()+kd,t.set(ge.CachedBlocklistDiff,JSON.stringify(p)),new _i(e.blocklist.concat(p.blocklist),e.whitelist.concat(p.whitelist),e.fuzzylist.concat(p.fuzzylist))}else{if(c.status===304)return o.expiresAt=Date.now()+kd,t.set(ge.CachedBlocklistDiff,JSON.stringify(o)),new _i(e.blocklist.concat(o.blocklist),e.whitelist.concat(o.whitelist),e.fuzzylist.concat(o.fuzzylist));throw new Error("Invalid response from blocklist")}}},"updateLocalBlocklist"),Pd=i(async(t,e,r)=>{let o,n;try{o=await zt.isFeatureEnabledAsync("kill-blowfish-blocklist-cursor"),n=await zt.isFeatureEnabledAsync("kill-previous-blocklist")}catch{o=!1,n=!1}let s;try{if(n)return o?kw(r,t,e):Cw(r,t,e);{s=await mF(t);let c=s.check(r,e);return c.type==="all"?o?kw(r,t,e):Cw(r,t,e):c}}catch{return{result:!1,type:"error",isSubdomainDomainWhitelisted:!1}}},"detectPhishing"),Cw=i(async(t,e,r)=>{if(!t)return{type:"all",result:!1,isSubdomainDomainWhitelisted:!1};let o=bc(t),n=await e.getAll([ge.CachedBloomFilter,ge.CachedBloomFilterHash,ge.CachedScanDataRecents,ge.CachedScanDataCursor]),s=n[ge.CachedBloomFilter]??null,c=n[ge.CachedBloomFilterHash]??null,p=n[ge.CachedScanDataCursor]??null,d=n[ge.CachedScanDataRecents]??null,m=null,f={recentlyAdded:[],recentlyRemoved:[],lastUpdated:0},g=null;if(s){let y=Pw.safeParse(s);y.success?m=y.data:await Cd(e)}if(d){let y=vw.safeParse(d);y.success?f=y.data:await Cd(e)}if(p){let S=a.string().safeParse(p);S.success?g=S.data:await Cd(e)}if(!f||f.lastUpdated==null||Date.now()>f.lastUpdated+lF){let y={localHash:c,cursor:g},S=await G.noBearer().post(Td,y);if(S.status!==200)return{result:!1,type:"error",isSubdomainDomainWhitelisted:!1};let b=S.data,T,A=Fw.safeParse(b);if(A.success)T=A.data;else return{result:!1,type:"error",isSubdomainDomainWhitelisted:!1};let E=[],I=[],P=typeof c=="string"&&T.bloomFilterHash?c!==T.bloomFilterHash:!1;f!=null&&!P&&(E=f.recentlyAdded,I=f.recentlyRemoved),E=E.concat(T.recentlyAdded),I=I.concat(T.recentlyRemoved),E=E.filter(O=>T.recentlyRemoved.indexOf(O)<0),I=I.filter(O=>T.recentlyAdded.indexOf(O)<0);let U={recentlyAdded:E,recentlyRemoved:I,lastUpdated:Date.now()};if(await e.set(ge.CachedScanDataRecents,U),f=U,T.nextCursor!==g&&await e.set(ge.CachedScanDataCursor,T.nextCursor),T.bloomFilter!=null){let O={bloomFilter:T.bloomFilter,lastUpdated:Date.now()};await Promise.all([e.set(ge.CachedBloomFilter,O),e.set(ge.CachedBloomFilterHash,T.bloomFilterHash)]),m=O}}if(!m)return{type:"all",result:!1,isSubdomainDomainWhitelisted:!1};let w=wd(m.bloomFilter,f.recentlyAdded,f.recentlyRemoved,t);if(w===ss.BLOCK){let y={result:!0,source:o,type:"blowfishBloomFilter"};return r.capture("blockedDomain",{data:y}),y}else if(w===ss.NONE)return{result:!1,type:"all",isSubdomainDomainWhitelisted:!1};return{result:!1,type:"error",isSubdomainDomainWhitelisted:!1}},"checkBlowfishBlocklist");async function Cd(t){await t.remove([ge.CachedBloomFilter,ge.CachedBloomFilterHash,ge.CachedScanDataRecents,ge.CachedScanDataCursor])}i(Cd,"resetState");var kw=i(async(t,e,r)=>{if(!t)return{type:"all",result:!1,isSubdomainDomainWhitelisted:!1};let o=bc(t),n=await e.getAll([ge.CachedBloomFilter,ge.CachedBloomFilterHash,ge.CachedScanDataRecents]),s=n[ge.CachedBloomFilter]??null,c=n[ge.CachedBloomFilterHash]??null,p=n[ge.CachedScanDataRecents]??null,d=null,m={recentlyAdded:[],recentlyRemoved:[],lastUpdated:0};if(s){let g=Pw.safeParse(s);g.success?d=g.data:await e.remove([ge.CachedBloomFilter,ge.CachedBloomFilterHash,ge.CachedScanDataRecents])}if(p){let g=vw.safeParse(p);g.success?m=g.data:await e.remove([ge.CachedBloomFilter,ge.CachedBloomFilterHash,ge.CachedScanDataRecents])}if(!m||m.lastUpdated==null||Date.now()>m.lastUpdated+kd){let g={localHash:c},w=await G.noBearer().post(Td,g);if(w.status!==200)return{result:!1,type:"error",isSubdomainDomainWhitelisted:!1};let y=w.data,S,b=Fw.safeParse(y);if(b.success)S=b.data;else return{result:!1,type:"error",isSubdomainDomainWhitelisted:!1};let T={recentlyAdded:S.recentlyAdded,recentlyRemoved:S.recentlyRemoved,lastUpdated:Date.now()};if(await e.set(ge.CachedScanDataRecents,T),m=T,S.bloomFilter!=null){let A={bloomFilter:S.bloomFilter,lastUpdated:Date.now()};await Promise.all([e.set(ge.CachedBloomFilter,A),e.set(ge.CachedBloomFilterHash,S.bloomFilterHash)]),d=A}}if(!d)return{type:"all",result:!1,isSubdomainDomainWhitelisted:!1};let f=wd(d.bloomFilter,m.recentlyAdded,m.recentlyRemoved,t);if(f===ss.BLOCK){let g={result:!0,source:o,type:"blowfishBloomFilter"};return r.capture("blockedDomain",{data:g}),g}else if(f===ss.NONE)return{result:!1,type:"all",isSubdomainDomainWhitelisted:!1};return{result:!1,type:"error",isSubdomainDomainWhitelisted:!1}},"checkBlowfishBlocklistOld");u();l();u();l();var fF=i(t=>t/1e8,"satsToBTC");u();l();u();l();var ln;(function(t){t.Plus="PLUS",t.Minus="MINUS",t.Equal="EQUAL"})(ln||(ln={}));var vd;(function(t){t.fungible="fungible",t.collectible="collectible",t.native="native",t.unknown="unknown"})(vd||(vd={}));var _d;(function(t){t.approval="approval",t.revokal="revokal",t.transfer="transfer",t.mint="mint",t.unknown="unknown"})(_d||(_d={}));var as;(function(t){t.Green="GREEN",t.Red="RED",t.White="WHITE"})(as||(as={}));var Tc={[as.Green]:"spotPositive",[as.Red]:"spotNegative",[as.White]:"textBase"};function hF(t){switch(t){case ln.Plus:return Tc.GREEN;case ln.Minus:return Tc.RED;case ln.Equal:return Tc.WHITE;default:return Tc.WHITE}}i(hF,"getColorForStateChangeSign");function gF(t){let e=t?.advancedDetails&&"safeguard"in t.advancedDetails?t?.advancedDetails?.safeguard:void 0;if(e?.recommended&&!e?.shouldBundle&&!e.error&&!e.verifyError&&e?.transactions&&e.transactions.length>0)return e.transactions}i(gF,"extractSafeguardTransactions");function _w(t,e){if(t.params&&"safeguard"in t.params&&t.params.safeguard&&e?.advancedDetails&&"safeguard"in e.advancedDetails&&e.advancedDetails.safeguard?.transactions){let r=e.advancedDetails.safeguard;if(r.error)return r.error;let o=t.params.transactions,n=r.transactions;if(n){let s;try{Oy(o,n)}catch(c){c instanceof rs?s=c:c instanceof Error?s=rs.createUnknownError(c.message):s=rs.createUnknownError("Non error type",c)}if(s)return e.advancedDetails.safeguard.verifyError=s,s}}}i(_w,"processSafeguardErrors");function Rw(t){if(t.advancedDetails&&"requestId"in t.advancedDetails)return t.advancedDetails.requestId}i(Rw,"extractRequestId");u();l();var Rd=i(async(t,e,r)=>{let o=`/simulation/v1?language=${t}`,n=await G.api().post(o,{...r,chainId:r.networkID,appVersion:Re,platform:Lt,deviceId:e});if(!J(n))throw new Error("Failed to scan message");return n.data},"getScanMessage"),pn=i(async(t,e,r)=>{let o=`/simulation/v1?language=${t}`,n={...r.params,...r.params&&"safeguard"in r.params?{safeguard:{...r.params.safeguard,lighthouseProgramId:Uy}}:{}};try{let s=await G.api().post(o,{...r,chainId:r.networkID,params:n,metadata:r.metadata,appVersion:Re,platform:Lt,deviceId:e});if(!J(s)){let d=await yF(s),m=`Failed to scan transaction: ${s.status} ${d}`;throw new Error(m)}let c=s.data,p=_w(r,c);if(p instanceof rs){let d=Rw(c);k.captureMessage(`Verify error ${d??""}: ${p.message}`,v.Safeguard)}return c}catch(s){throw k.captureError(s,v.Simulation),s}},"getScanTransaction");async function yF(t){let{data:e,blob:r}=t;if(typeof e=="string")return e;if(e&&typeof e=="object")return JSON.stringify(e);try{return await r?.text()??"Unknown error"}catch{return"Unknown error"}}i(yF,"getResponseErrorMessage");var f8=a.union([a.literal("signTransaction"),a.literal("signAllTransactions"),a.literal("signAndSendTransaction"),a.literal("signAndSendAllTransactions")]);u();l();var Dw=a.enum(["Native","Fungible","SemiFungible","NonFungible","Unknown"]),so=a.object({id:a.string(),displayName:a.string().optional(),logoURI:a.union([a.string(),a.null()]).optional(),tokenType:Dw,decimals:a.number().optional(),symbol:a.string().optional(),isSpam:a.boolean().optional()}),Bw=a.object({id:to,displayName:a.string(),logoURI:a.union([a.string(),a.null()]).optional()}),Ac=a.object({token:so,amount:a.string(),to,from:to}),Dd=a.literal("UNCLASSIFIED_APP_INTERACTION"),Bd=a.literal("TOKEN_SEND"),Nd=a.literal("TOKEN_BURN"),Ld=a.literal("TOKEN_SWAP"),Md=a.literal("TOKEN_UNWRAP"),Ud=a.literal("WITHDRAW_STAKE"),Od=a.literal("DEACTIVATE_STAKE"),qd=a.literal("STAKE"),zd=a.literal("COLLECTIBLE_LIST"),Qd=a.literal("COLLECTIBLE_BUY_ITEM"),Hd=a.literal("COLLECTIBLE_CANCEL_BID"),Gd=a.literal("COLLECTIBLE_BID_ITEM"),Kd=a.literal("COLLECTIBLE_UNLIST"),$d=a.literal("COLLECTIBLE_SELL_ITEM"),jd=a.literal("CANCEL_TX"),Vd=a.literal("TOKEN_APPROVAL"),Wd=a.literal("CANCEL_ORDER"),Zd=a.literal("COLLECTION_APPROVAL"),Yd=a.literal("BRIDGE_INIT"),wF=a.union([Dd,Bd,Nd,Ld,Md,Ud,Od,qd,zd,Qd,Hd,Gd,Kd,$d,jd,Vd,Wd,Zd,Yd]),Nw=a.object({transactionType:Dd,balanceChanges:a.array(Ac),dapp:a.union([Or,a.null()]).optional()}),Lw=a.object({transactionType:Bd,balanceChanges:a.array(Ac).nonempty(),dapp:a.union([Or,a.null()]).optional()}),Mw=a.object({transactionType:Nd,dapp:a.union([Or,a.null()]).optional(),token:so,amount:a.string()}),Uw=a.object({transactionType:Ld,dapp:a.union([Or,a.null()]).optional(),receiveToken:so,sendToken:so,receiveAmount:a.string(),sendAmount:a.string()}),Ow=a.object({transactionType:Md,token:so,amount:a.string()}),qw=a.object({transactionType:Ud,stakeAccount:to,amount:a.string()}),zw=a.object({transactionType:Od,stakeAccount:to,amount:a.string()}),Qw=a.object({transactionType:qd,stakeAccount:to,amount:a.string(),validatorName:a.string().optional(),validatorWebsite:a.string().optional(),keybaseUsername:a.string().optional()}),Hw=a.object({transactionType:jd}),cs=a.object({dapp:a.union([Or,a.null()]),itemAmount:a.string().optional(),item:so,forAmount:a.string(),forAsset:so,listingUrl:a.string().optional()}),Gw=cs.merge(a.object({transactionType:zd})),Kw=cs.merge(a.object({transactionType:Qd})),$w=cs.merge(a.object({transactionType:Hd})),jw=cs.merge(a.object({transactionType:Gd})),Vw=cs.merge(a.object({transactionType:Kd})),Ww=cs.merge(a.object({transactionType:$d})),Zw=a.object({transactionType:Vd,dapp:a.union([Or,a.null()]).optional(),token:so,value:a.string().optional(),isApproved:a.boolean()}),Yw=a.object({transactionType:Wd,dapp:a.union([Or,a.null()]).optional(),orderId:a.string()}),Xw=a.object({transactionType:Zd,collection:Bw,dapp:a.union([Or,a.null()]).optional(),isApproved:a.boolean()}),Jw=a.object({transactionType:Yd,dapp:a.union([Or,a.null()]).optional(),balanceChanges:a.array(Ac).nonempty(),explorerUrl:a.string().optional()}),eS=a.enum(["success","failed"]),tS=a.object({networkFee:a.string().optional(),networkFeePayer:a.string().optional(),status:eS,errorMessage:a.union([a.string(),a.null()]),blockNumber:a.string(),chainId:xr,transactionId:a.string()}),xc=a.object({timestamp:a.number(),owner:to,id:to,interactionData:a.union([Nw,Lw,Mw,Uw,Ow,qw,zw,Qw,Gw,Kw,$w,jw,Vw,Ww,Hw,Zw,Yw,Xw,Jw]),chainMeta:tS}),_t=i(t=>t.split("/")[1]?.split(":").slice(1).join(":"),"extractAddressfromBri");u();l();var dn=i(t=>{switch(t){case"SemiFungible":case"NonFungible":return!0;default:return!1}},"isCollectibleTokenType"),Xd=i((t,e)=>{let r=_t(t.to),o=_t(t.from),n=e.some(c=>c.address.toLowerCase()===r.toLowerCase()),s=e.some(c=>c.address.toLowerCase()===o.toLowerCase());return n&&!s},"isReceiveTransaction");u();l();var Jd=N(Ve());u();l();var rS=i(({interactionData:t,isError:e,selectedAccountAddresses:r,getKnownAddressLabel:o,start:n,networkID:s})=>{let p=t.balanceChanges[0],{token:{symbol:d,displayName:m,tokenType:f,decimals:g},amount:w}=p,y=Xd(p,r),S=dn(f),T=SF({isCollectible:S,sign:y?"+":"-",amount:w,decimals:g,tokenSymbol:d,tokenType:f,isError:e});if(y){let I=_t(p.from),P=ld(I,void 0,o(I,s));return{topLeft:{text:`${R.t("transactionsReceived")} ${S?m||R.t("richTransactionDetailUnknownNFT"):""}`},topRight:{text:`${T}`,color:"spotPositive"},bottomLeft:{text:R.t("transactionsFromParagraphInterpolated",{from:P,defaultValue:`From ${P}`})},start:n}}let A=_t(p.to),E=ld(A,void 0,o(A,s));return{topLeft:{text:e?R.t("transactionsSendFailed"):`${R.t("transactionsSent")} ${S?m||R.t("richTransactionDetailUnknownNFT"):""}`},topRight:{text:`${T}`,color:"textBase"},bottomLeft:{text:R.t("transactionsToParagraphInterpolated",{to:E,defaultValue:`To ${E}`})},start:n}},"tokenSendLabel");function SF({isCollectible:t,sign:e,amount:r,decimals:o,tokenSymbol:n,tokenType:s,isError:c}){return c||o===void 0||s==="NonFungible"?"":t?`${e}${Tt(r,o)}`:`${e}${Tt(r,o)}${n?` ${Ur(n,6)}`:""}`}i(SF,"getValueDisplay");var bF=["So11111111111111111111111111111111111111112","501"],TF=i((t,e,r,o,n)=>{let{interactionData:s,chainMeta:c}=t,{transactionType:p}=s,d=c.status==="failed",m=c.chainId,f=C.getTokenSymbol(m),g=C.getTokenDecimals(m),w=e("historyUnknownDappName"),y=(0,Jd.jsx)(r,{activityItem:t,size:"small",isDetailViewOrSvg:!1});switch(p){case"TOKEN_SEND":return rS({interactionData:s,isError:d,selectedAccountAddresses:n,getKnownAddressLabel:o,start:y,networkID:m});case"TOKEN_BURN":{let{amount:S,token:b}=s,T="";return b.displayName?S==="1"?T=b.displayName:T=`${b.displayName} (${S})`:T=e("richTransactionDetailUnknownNFT"),{topLeft:{text:d?`${e("transactionsFailedBurn")}`:`${e("transactionsBurned")}`},bottomLeft:{text:T},start:y}}case"TOKEN_UNWRAP":{let{amount:S,token:b}=s;return{topLeft:{text:d?`${e("transactionsUnwrappedFailed")}`:`${e("transactionsUnwrapped")}`},topRight:{text:d?"":`${Tt(S,b.decimals??0)} ${b.symbol}`,color:"textBase"},start:y}}case"TOKEN_SWAP":{let{receiveAmount:S,receiveToken:b,sendAmount:T,sendToken:A,dapp:E}=s,I=E?E.displayName:e("historyUnknownDappName"),P=ki(_t(A.id)||""),U=ki(_t(b.id)||""),O="";!d&&b.decimals!==void 0&&(O=`+${Tt(S,b.decimals)} ${Ur(b.symbol||U,6)}`);let _="";return!d&&A.decimals!==void 0&&(_=`-${Tt(T,A.decimals)} ${Ur(A.symbol||P,6)}`),{topLeft:{text:e(d?"transactionsFailedSwap":"transactionsSwapped")},topRight:{text:O,color:"spotPositive"},bottomLeft:{text:I},bottomRight:{text:_,color:"textBase"},start:y}}case"BRIDGE_INIT":{let S=s.dapp?s.dapp.displayName:w,T=s.balanceChanges[0],{token:{symbol:A,decimals:E},amount:I}=T,P=A?` ${Ur(A,6)}`:"";if(!d&&E!==void 0){let U=`-${Tt(I,E)}${P}`;return{topLeft:{text:d?e("transactionBridgeInitiatedFailed"):`${e("transactionBridgeInitiated")}`},bottomLeft:{text:S},topRight:{text:`${U}`,color:"textBase"},start:y}}return{topLeft:{text:d?e("transactionBridgeInitiatedFailed"):`${e("transactionBridgeInitiated")}`},bottomLeft:{text:S},start:y}}case"WITHDRAW_STAKE":{let{amount:S,stakeAccount:b}=s,T=_t(b),A=C.getTokenSymbol(m);return{topLeft:{text:e(d?"transactionsWithdrawStakeFailed":"transactionsWithdrawStake")},topRight:{text:d?"":`${Tt(S,g)} ${Ur(A,6)}`,color:"textBase"},bottomLeft:{text:Wn(T,4)},start:y}}case"DEACTIVATE_STAKE":{let{stakeAccount:S}=s,b=_t(S);return{topLeft:{text:e(d?"transactionsDeactivateStakeFailed":"transactionsDeactivateStake")},bottomLeft:{text:Wn(b,4)},start:y}}case"STAKE":{let{amount:S,stakeAccount:b,validatorName:T}=s,A=_t(b);return{topLeft:{text:e(d?"transactionsStakedFailed":"transactionsStaked")},topRight:{text:d?"":`${Tt(S,g)} ${Ur(f,6)}`,color:"textBase"},bottomLeft:{text:T||Wn(A,4)},start:y}}case"COLLECTIBLE_LIST":{let{dapp:S,item:b}=s,T=S?S.displayName:e("historyUnknownDappName"),A=b.displayName||e("richTransactionDetailUnknownNFT");return{topLeft:{text:d?e("transactionsListedFailed"):e("transactionsListedInterpolated",{name:A})},bottomLeft:{text:T},start:y}}case"COLLECTIBLE_BUY_ITEM":{let{dapp:S,itemAmount:b,item:T,forAsset:A,forAmount:E}=s,I=S?S.displayName:e("historyUnknownDappName"),P=oS(E,A.decimals,Ur(A.symbol||"",6)),U=T.symbol||ki(_t(T.id)),O=b&&T.tokenType==="SemiFungible"?`+${b} ${U}`:`+${U}`;return{topLeft:{text:e(d?"transactionsBuyFailed":"transactionsBoughtCollectible")},topRight:{text:d?"":O,color:"spotPositive"},bottomRight:{text:d?"":`${P}`,color:"textBase"},bottomLeft:{text:I},start:y}}case"COLLECTIBLE_CANCEL_BID":{let{dapp:S,item:b}=s,T=S?S.displayName:e("historyUnknownDappName"),A=b.displayName||e("richTransactionDetailUnknownNFT");return{topLeft:{text:d?e("transactionsCancelBidOnFailed"):e("transactionsCancelBidOnInterpolated",{name:A})},bottomLeft:{text:T},start:y}}case"COLLECTIBLE_BID_ITEM":{let{dapp:S,item:b}=s,T=S?S.displayName:e("historyUnknownDappName"),A=b.displayName||e("richTransactionDetailUnknownNFT");return{topLeft:{text:d?e("transactionsBidFailed"):e("transactionsBidOnInterpolated",{name:A})},bottomLeft:{text:T},start:y}}case"COLLECTIBLE_UNLIST":{let{dapp:S,item:b}=s,T=S?S.displayName:e("historyUnknownDappName"),A=b.displayName||e("richTransactionDetailUnknownNFT");return{topLeft:{text:d?e("transactionsUnlistedFailed"):e("transactionsUnlistedInterpolated",{name:A})},bottomLeft:{text:T},start:y}}case"COLLECTIBLE_SELL_ITEM":{let{dapp:S,itemAmount:b,item:T,forAsset:A,forAmount:E}=s,I=S?S.displayName:e("historyUnknownDappName"),P=A.decimals!==void 0?`+${Tt(E,A.decimals)} ${Ur(A.symbol||"",6)}`:e("transactionsUnknownAmount"),U=T.symbol||ki(_t(T.id)),O=b&&T.tokenType==="SemiFungible"?`-${b} ${U}`:`-${U}`;return{topLeft:{text:e(d?"transactionsSoldFailed":"transactionsSoldCollectible")},topRight:{text:d?"":`${P}`,color:"spotPositive"},bottomRight:{text:d?"":O,color:"textBase"},bottomLeft:{text:I},start:y}}case"CANCEL_TX":return{topLeft:{text:e(d?"transactionCancelledFailed":"transactionCancelled")},start:y};case"TOKEN_APPROVAL":{let{dapp:S,token:b,isApproved:T}=s,A=dn(b.tokenType)?b.displayName:b.symbol,E;return d?T?dn(b.tokenType)?E=e("transactionApproveTokenFailed",{tokenSymbol:A}):E=e("transactionApprovalFailed"):dn(b.tokenType)?E=e("transactionRevokeApproveTokenFailed",{tokenSymbol:A}):E=e("transactionRevokeFailed"):T?E=e("transactionApproveToken",{tokenSymbol:A}):E=e("transactionRevokeApproveToken",{tokenSymbol:A}),{topLeft:{text:E},bottomLeft:{text:S?S.displayName:w,color:"textIncidental"},start:y}}case"COLLECTION_APPROVAL":{let{collection:S,isApproved:b,dapp:T}=s,A=S.displayName,E;return d?b?E=e("transactionApproveTokenFailed",{tokenSymbol:A}):E=e("transactionRevokeApproveTokenFailed",{tokenSymbol:A}):b?E=e("transactionApproveToken",{tokenSymbol:A}):E=e("transactionRevokeApproveToken",{tokenSymbol:A}),{topLeft:{text:E},bottomLeft:{text:T?T.displayName:w,color:"textIncidental"},start:y}}case"CANCEL_ORDER":{let{dapp:S}=s;return{topLeft:{text:e(d?"transactionCancelOrderFailed":"transactionCancelOrder")},bottomLeft:{text:S?.displayName||e("historyUnknownDappName"),color:"textIncidental"},start:y}}case"UNCLASSIFIED_APP_INTERACTION":{let{dapp:S}=s,b=S?S.displayName:w;return{topLeft:{text:e(d?"transactionsFailedAppInteraction":"transactionsAppInteraction")},bottomLeft:{text:b},start:y}}}},"createActivityRowLabels"),AF=i((t,e)=>{let{display:r,type:o}=t,{topLeft:n,topRight:s,bottomLeft:c,bottomRight:p}=r.summary,d=(0,Jd.jsx)(e,{logoUri:r.summary.logoUri,pendingTransactionType:o,size:"small"});return{topLeft:n,topRight:s,bottomLeft:c,bottomRight:p,start:d}},"createPendingTransactionRowLabels"),em=i((t,e,r)=>{let o=(t??[]).map(Iy);if(e){let n=o.find(s=>s.chainId===e)?.address;if(n){let s={chainId:e,address:n};r&&(s.filters=[{type:"token",value:r}]),o=[s]}}return o},"getAccountsWithFilter"),tm=i(t=>{if(!t)return;let e=X(t);if(e.resourceType!==V.nativeToken)return t.type===ae.SPL?t.data.splTokenAccountPubkey:e.address},"getTokenActivityFilterId"),xF=i((t,e)=>{let r=_t(t.id);return bF.includes(r)&&(t.tokenType="Native"),t.tokenType==="Native"?{chainId:e,slip44:C.getSlip44(e),resourceType:V.nativeToken}:{chainId:e,address:r,resourceType:V.address}},"getFungibleCaip19FromToken"),oS=i((t,e,r)=>{if(!t||!e)return R.t("transactionsUnknownAmount");let o=Ae(t,e),n=o.abs(),s=o.isZero()?"":o.isPositive()?"-":"+",c=kr(n);return`${s}${c} ${r}`},"formatPaidAmount");u();l();var Ri=N(z());var EF=a.object({orderIds:a.array(a.object({bytesValue:a.string(),bytesArrayValue:a.string(),stringValue:a.string()}))}),CF=i(async(t,e)=>{if(e==="LI.FI")return{label:R.t("transactionBridgeStatusLink",{dappName:"LI.FI"}),value:`https://explorer.li.fi/tx/${t}`};if(e==="deBridge")try{let r=await G.get(`https://stats-api.dln.trade/api/Transaction/${t}/orderIds`),o=EF.safeParse(r.data);if(!o.success){k.captureError(new Error("Failed to parse deBridge response"),v.History);return}let n=o.data.orderIds[0]?.stringValue;if(!n){k.captureError(new Error("No orderId found in deBridge response"),v.History);return}return{label:R.t("transactionBridgeStatusLink",{dappName:"DeBridge"}),value:`https://app.debridge.finance/order?orderId=${n}`}}catch(r){k.captureError(new Error(`Could not fetch bridge explorer url: ${r}`),v.History);return}},"getBridgeExplorerUrl"),kF=i((t,e)=>{let[r,o]=(0,Ri.useState)(),[n,s]=(0,Ri.useState)(!1);return(0,Ri.useEffect)(()=>{t&&e&&i(async()=>{s(!0);try{let p=await CF(t,e);o(p)}finally{s(!1)}},"fetchBridgeUrl")().catch(p=>{k.addBreadcrumb(v.History,"[useBridgeExplorerUrl] Failed to fetch bridge URL",D.Error,{error:String(p)})})},[t,e]),{bridgeUrl:r,isLoading:n}},"useBridgeExplorerUrl");u();l();u();l();u();l();var Qt={showTimeToMineRowInPendingTransactionDetail:!1,showFeeRowInPendingTransactionDetail:!0};var nS={...Qt};u();l();var sS={...Qt};u();l();var iS={showTimeToMineRowInPendingTransactionDetail:!1,showFeeRowInPendingTransactionDetail:!1};u();l();var aS={...Qt,showTimeToMineRowInPendingTransactionDetail:!0};u();l();var cS={...Qt};u();l();var uS={...Qt};u();l();var lS={...Qt};u();l();var pS={...Qt};u();l();var dS={showTimeToMineRowInPendingTransactionDetail:!1,showFeeRowInPendingTransactionDetail:!1};u();l();var mS={showTimeToMineRowInPendingTransactionDetail:!1,showFeeRowInPendingTransactionDetail:!1};var IF=new Vn({[ce.Solana]:dS,[ce.Ethereum]:aS,[ce.Polygon]:pS,[ce.Monad]:lS,[ce.Base]:sS,[ce.Arbitrum]:nS,[ce.Bitcoin]:iS,[ce.Sui]:mS,[ce.Hypercore]:cS,[ce.Hyperevm]:uS}),fS=jn(IF);u();l();u();l();u();l();var TS=N(z());u();l();var SS=N(z());u();l();var FF=10,PF="/history/v2",Di=class extends Error{static{i(this,"ActivityItemsFetchCacheBustError")}message="406: Cache bust!"},Ec=class extends Error{static{i(this,"ActivityItemsFetchResponseMalformed")}message="Server response malformed."},rm=class extends Error{static{i(this,"ActivityItemsFetchServerError")}},om=class extends Error{static{i(this,"ActivityItemsFetchClientError")}},hS=a.object({next:a.union([a.null(),a.string()]),results:a.array(xc)}),gS=i(async t=>{let e=await G.api().retry(3,2e3).post(`${PF}`,t);if(e.status===406)throw new Di;if(e.status>=400&&e.status<500)throw new om(`FetchActivityItem: Status code: ${e.status}`);if(e.status>=500)throw new rm(`FetchActivityItem: Status code: ${e.status}`);return e.data},"_fetch"),yS=i(t=>!Array.isArray(t.results)||typeof t.next!="string"&&t.next!==null,"isResponseMalformed"),nm=i(async t=>{let e=await gS(t);if(yS(e))throw new Ec;for(;e.results?.length<FF&&e.next;){if(yS(e))throw new Ec;let r=await gS({next:e.next,isSpam:t.isSpam});e.next=r.next,e.results=[...e.results,...r.results]}try{return hS.parse(e)}catch(r){let o=r,n=[],s=o.issues;for(let d=0;d<s.length;++d){let m=s[d].path;if(m[0]!=="results")throw k.captureError(o,v.History),o;let f=m[1];if(typeof f!="number")throw k.captureError(o,v.History),o;n.push(f)}n.sort(function(d,m){return m-d});let c=n.map(d=>e.results[d]).map(d=>d.interactionData?.transactionType||""),p=[];for(let d=0;d<n.length;++d){let m=n[d],f=e.results[m],g={timestamp:f?.timestamp,owner:f?.owner,id:f?.id,chainMeta:f?.chainMeta,interactionData:{transactionType:"UNCLASSIFIED_APP_INTERACTION",balanceChanges:[]}};try{xc.parse(g),e.results[m]=g,p.push(m)}catch{}}for(let d=0;d<n.length;++d){let m=n[d];p.indexOf(m)===-1&&e.results.splice(m,1)}n.length&&console.error(`Removed history items, ${c.join(",")}`);try{return hS.parse(e)}catch(d){let m=d;throw k.captureError(m,v.History),m}}},"fetchActivityItems");var vF=3e5,sm="fetch-infinite-activity-items",bS=i(({accounts:t,isSpam:e})=>[sm,t,e],"infiniteActivityItemsQueryKey"),_F=i((t,e)=>{t.removeQueries({queryKey:e})},"bustCache"),im=i(({accounts:t,isSpam:e})=>{let r=Be();(0,SS.useEffect)(()=>()=>{r.cancelQueries({queryKey:[sm],exact:!1}).catch(s=>{k.addBreadcrumb(v.History,"[useFetchInfiniteActivityItems] Failed to cancel queries",D.Error,{error:String(s)})})},[r]);let o=bS({accounts:t,isSpam:e});return Ng({queryKey:o,queryFn:i(async({pageParam:s})=>{try{let c;s&&s!==""?c=await nm({next:s,isSpam:e}):c=await nm({accounts:t||[],isSpam:e});let p=c.results.map(d=>(d.interactionData.transactionType==="TOKEN_SEND"&&d.interactionData.balanceChanges.sort(RF(t)),d));return{...c,results:p}}catch(c){throw c instanceof Di&&_F(r,o),k.captureError(c,v.History),c}},"queryFn"),getNextPageParam:i(s=>s?.next,"getNextPageParam"),staleTime:vF,retry:!1,enabled:!!t?.length&&t.every(s=>!C.isLocalNetworkID(s.chainId)),initialPageParam:""})},"useFetchInfiniteActivityItems");function RF(t){return(e,r)=>{let o=wS(e,t),n=wS(r,t);return o?-1:n?1:0}}i(RF,"balanceChangeSort");function wS(t,e){let r=t.to.split("/address:")[1],o=t.from.split("/address:")[1];return e.some(n=>n.address.toLowerCase()===r.toLowerCase()||n.address.toLowerCase()===o.toLowerCase())}i(wS,"findRelevantTransfers");var DF=i(({fungible:t,isSpam:e=!1})=>{let{data:r=Ug,status:o}=ty(),n=r.isDeveloperMode,s=tm(t),{data:c}=uy({address:t?.data.walletAddress,networkID:t?.data.chain.id}),p=(0,TS.useMemo)(()=>em(c?[c]:[],t?.data.chain.id,s),[c,t?.data.chain.id,s]),d=im({accounts:p,isSpam:e}),m=d.isPending||o==="pending";return{activityItemsData:d,isLoadingHistory:m,isDeveloperMode:n}},"useFungibleActivityByFungible");u();l();u();l();var dr="Auto";var ze={buyFungible:void 0,buyUsdValue:void 0,sellFungible:void 0,sellUsdValue:void 0,sellAmount:"",uiSellAmountCryptoInput:"",amountType:"sell",quoteResponse:void 0,selectedProviderIndex:0,selectedBaseProvider:dr,gasEstimation:{isFetching:!1,estimate:void 0,estimateWithBuffer:void 0},hasNoRoutes:!1,isFetchingQuote:!1,error:null,searchQuery:"",numSearchResults:0,primaryCurrency:"crypto",uiSellAmountLocalFiatInput:"",uiBuyAmountCryptoInput:"",uiBuyAmountLocalFiatInput:"",canInputFiatSellAmount:!1,swapFilter:void 0},$=st(t=>({...ze,resetQuote:i(()=>t({quoteResponse:ze.quoteResponse,isFetchingQuote:ze.isFetchingQuote,hasNoRoutes:ze.hasNoRoutes,selectedProviderIndex:ze.selectedProviderIndex,error:ze.error,uiSellAmountLocalFiatInput:ze.uiSellAmountLocalFiatInput,selectedBaseProvider:ze.selectedBaseProvider}),"resetQuote"),resetSwapper:i(()=>t({quoteResponse:ze.quoteResponse,gasEstimation:ze.gasEstimation,error:ze.error,sellAmount:"",uiSellAmountCryptoInput:"",uiBuyAmountCryptoInput:ze.uiBuyAmountCryptoInput,swapFilter:ze.swapFilter,selectedBaseProvider:ze.selectedBaseProvider,selectedProviderIndex:ze.selectedProviderIndex}),"resetSwapper"),setBuyFungible:i(e=>t({buyFungible:e}),"setBuyFungible"),setBuyUsdValue:i(e=>t({buyUsdValue:e}),"setBuyUsdValue"),setHasNoRoutes:i(e=>t({hasNoRoutes:e}),"setHasNoRoutes"),setIsFetchingQuote:i(e=>t({isFetchingQuote:e}),"setIsFetchingQuote"),setQuoteResponse:i(e=>t({quoteResponse:e,hasNoRoutes:!1}),"setQuoteResponse"),setSelectedProviderIndex:i(e=>t({selectedProviderIndex:e}),"setSelectedProviderIndex"),setSelectedBaseProvider:i(e=>t({selectedBaseProvider:e}),"setSelectedBaseProvider"),setGasEstimation:i(({estimate:e,estimateWithBuffer:r,isFetching:o})=>t(n=>({gasEstimation:{...n.gasEstimation,...e!==void 0&&{estimate:e},...r!==void 0&&{estimateWithBuffer:r},...o!==void 0&&{isFetching:o}}})),"setGasEstimation"),setSellAmount:i(e=>t({sellAmount:e}),"setSellAmount"),setAmountType:i(e=>t({amountType:e}),"setAmountType"),setSellUsdValue:i(e=>t({sellUsdValue:e}),"setSellUsdValue"),setSellFungible:i(e=>t({sellFungible:e}),"setSellFungible"),setUiSellAmountCryptoInput:i(e=>t({uiSellAmountCryptoInput:e}),"setUiSellAmountCryptoInput"),setError:i(e=>t({error:e}),"setError"),setSearchQuery:i(e=>t({searchQuery:e}),"setSearchQuery"),setNumSearchResults:i(e=>t({numSearchResults:e}),"setNumSearchResults"),setPrimaryCurrency:i(e=>t({primaryCurrency:e}),"setPrimaryCurrency"),setUiSellAmountLocalFiatInput:i(e=>t({uiSellAmountLocalFiatInput:e}),"setUiSellAmountLocalFiatInput"),setUiBuyAmountCryptoInput:i(e=>t({uiBuyAmountCryptoInput:e}),"setUiBuyAmountCryptoInput"),setUiBuyAmountLocalFiatInput:i(e=>t({uiBuyAmountLocalFiatInput:e}),"setUiBuyAmountLocalFiatInput"),setCanInputFiatSellAmount:i(e=>t({canInputFiatSellAmount:e}),"setCanInputFiatSellAmount"),setSwapFilter:i(e=>t({swapFilter:e}),"setSwapFilter"),switchTokensForSell:i(()=>{t(e=>{let r=e.sellFungible??e.buyFungible,o=e.buyFungible??e.sellFungible,n=e.uiBuyAmountCryptoInput,s=e.uiBuyAmountLocalFiatInput;return{sellFungible:o,buyFungible:r,uiSellAmountCryptoInput:n,uiSellAmountLocalFiatInput:s,uiBuyAmountCryptoInput:ze.uiBuyAmountCryptoInput,uiBuyAmountLocalFiatInput:ze.uiBuyAmountLocalFiatInput,sellAmount:n,swapFilter:void 0,selectedBaseProvider:e.selectedBaseProvider}})},"switchTokensForSell"),switchTokensForBuy:i(()=>{t(e=>{let r=e.sellFungible??e.buyFungible,o=e.buyFungible??e.sellFungible,n=e.uiSellAmountCryptoInput,s=e.uiSellAmountLocalFiatInput;return{sellFungible:o,buyFungible:r,uiSellAmountCryptoInput:ze.uiSellAmountCryptoInput,uiSellAmountLocalFiatInput:ze.uiSellAmountLocalFiatInput,uiBuyAmountCryptoInput:n,uiBuyAmountLocalFiatInput:s,sellAmount:n,swapFilter:void 0,selectedBaseProvider:e.selectedBaseProvider}})},"switchTokensForBuy"),resetUiAmounts:i(()=>t({uiSellAmountCryptoInput:ze.uiSellAmountCryptoInput,uiSellAmountLocalFiatInput:ze.uiSellAmountLocalFiatInput,uiBuyAmountCryptoInput:ze.uiBuyAmountCryptoInput,uiBuyAmountLocalFiatInput:ze.uiBuyAmountLocalFiatInput,sellAmount:ze.sellAmount,selectedBaseProvider:ze.selectedBaseProvider}),"resetUiAmounts"),setPairAndAmount:i(({sell:e,buy:r,swapAmount:o})=>t(n=>{let s="uiSellAmountCryptoInput";return o.perspective==="sell"?n.primaryCurrency==="crypto"?s="uiSellAmountCryptoInput":s="uiSellAmountLocalFiatInput":n.primaryCurrency==="crypto"?s="uiBuyAmountCryptoInput":s="uiBuyAmountLocalFiatInput",{...n,sellFungible:e,buyFungible:r,[s]:o.amount,sellAmount:o.amount}}),"setPairAndAmount")}));u();l();var Cc=a.object({name:a.string(),message:a.string()}),xS=a.object({chainId:xr,name:a.string(),symbol:a.string(),decimals:a.number(),logoURI:a.optional(a.string()),includesBridge:a.optional(a.boolean())}),BF=xS.extend({address:a.string(),resourceType:a.literal(V.address)}),NF=xS.extend({slip44:a.string(),resourceType:a.literal(V.nativeToken)}),m9=a.union([BF,NF]),ES=a.object({id:a.string(),name:a.string(),logoUri:a.string()}),LF=a.union([a.enum(["network","phantom","gasless","ata","gasless_network","tips","priority_fee","prediction_fee_per_contract"]),a.string()]),MF=a.object({name:a.string(),percentage:a.number(),amount:a.number(),token:a.optional(Ft),type:LF}),UF=a.object({name:a.string(),proportion:a.string()}),CS=a.object({sellAmount:a.string(),buyAmount:a.string(),rfqProps:a.optional(a.object({expireAt:a.number(),quoteId:a.string()})),analyticsContext:a.optional(a.string())}),kc=CS.extend({priceImpact:a.number(),sources:a.array(UF),fees:a.array(MF),slippageTolerance:a.optional(a.number()),baseProvider:ES}),OF=a.object({success:a.boolean(),error:a.string().optional(),data:a.object({ataFeeUSD:a.number().optional(),networkFeeUSD:a.number().optional(),totalAmountUSD:a.number().optional()}).optional()}),qF=a.enum(["sync","async"]),Ic=kc.extend({transactionData:a.array(a.string()),gaslessSignature:a.optional(a.string()),cashQuoteSignerSignature:a.optional(a.string()),gaslessSwapFeeResult:a.optional(OF),executionMode:a.optional(qF)}),zF=Ic,f9=kc.extend({transactionData:a.array(a.string())}),lm=kc.extend({allowanceTarget:a.string(),exchangeAddress:a.string(),gas:a.number(),value:a.string(),transactionData:a.string()}),pm=kc.extend({transactionData:a.array(a.string())}),AS=a.object({name:a.string(),amount:a.string(),token:Ft,percentage:a.string(),included:a.boolean(),amountUSD:a.optional(a.string())}),QF=a.object({name:a.string(),key:a.string(),logoURI:a.string()}),kS=a.object({name:a.string(),symbol:a.string()}),HF=a.object({transactionData:a.string(),buyToken:Ft,sellToken:Ft,nonIncludedNonGasFees:a.string(),feeCosts:a.array(AS),chainId:xr,tool:QF,value:a.optional(a.string()),allowanceTarget:a.optional(a.string()),approvalMetadata:a.optional(kS),approvalExactAmount:a.optional(a.string()),exchangeAddress:a.optional(a.string()),gasCosts:a.optional(a.array(a.number())),includedFeeCosts:a.optional(a.array(AS))}),dm=CS.extend({baseProvider:ES,executionDuration:a.number(),tags:a.array(a.string()),steps:a.array(HF)}),GF=a.union([Ic,lm,pm,dm,zF]),Bi=a.enum(["solana","eip155","sui","xchain"]),Ni=a.object({type:Bi,taker:Ft,buyToken:Ft,sellToken:Ft,slippageTolerance:a.number(),simulationTolerance:a.optional(a.number()),gasBuffer:a.optional(a.number()),quotes:a.array(GF),tradeFee:a.optional(a.array(a.number())),estimateGasFee:a.optional(a.array(a.number())),includesAllProviders:a.optional(a.boolean())}),KF=a.enum(["swap-approval","swap","bridge-approval","bridge"]),$F=a.enum(["swap","bridge"]),jF=a.enum(["swap","bridge"]),VF=a.enum(["bridge"]),Fc=a.object({sellToken:Ft,buyToken:Ft,approvalMetadata:a.optional(kS)}),WF=a.object({type:a.literal("solana"),transactions:a.array(a.string()),transactionTypes:a.array($F),transactionPairs:a.optional(a.array(Fc))});var ZF=a.object({type:a.literal("evm"),transactions:a.array(Kn),transactionTypes:a.array(KF),transactionPairs:a.optional(a.array(Fc))}),YF=a.object({type:a.literal("sui"),transactions:a.array(a.string()),transactionTypes:a.array(jF),transactionPairs:a.optional(a.array(Fc))}),XF=a.object({type:a.literal("bitcoin"),transactions:a.array(a.string()),transactionTypes:a.array(VF),transactionPairs:a.optional(a.array(Fc))}),h9=a.union([WF,ZF,YF,XF]),am;(function(t){t.Pricing="pricing",t.Provider="provider",t.ProviderPressable="providerPressable",t.ExchangeRate="exchangeRate",t.PriceImpact="priceImpact",t.Network="network",t.ExecutionDuration="executionDuration",t.Slippage="slippage",t.SlippagePressable="slippagePressable",t.Fees="fees",t.HighPriceImpact="highPriceImpact",t.HighSlippage="highSlippage",t.TransferFees="transferFees"})(am||(am={}));var mm=a.object({name:a.string(),amount:a.string()}).strict(),Pc=a.object({name:a.string(),feeUsd:a.number().nullish(),amount:a.string(),time:a.object({text:a.string(),isFast:a.boolean()}),logoURI:a.string()}),g9=a.union([mm,Pc]),cm;(function(t){t.Buy="buy",t.Sell="sell"})(cm||(cm={}));var um;(function(t){t.SwapProviders="SwapProviders",t.SwapReview="SwapReview",t.SwapTermsOfService="SwapTermsOfService",t.SwapConfirmation="SwapConfirmation",t.InsufficientBalance="InsufficientBalance"})(um||(um={}));u();l();var JF=i(t=>Pc.safeParse(t).success,"isBridgeProviderRow");u();l();function le(t){return dm.safeParse(t).success}i(le,"isBridgeQuote");var Ht=i(t=>Ic.safeParse(t).success,"isSolanaSwapQuote"),IS=i(t=>Ht(t),"isCashSwapQuote");function Ir(t){return lm.safeParse(t).success}i(Ir,"isEvmSwapQuote");function io(t){return pm.safeParse(t).success}i(io,"isSuiSwapQuote");function FS(t){return t?"gaslessSignature"in t:!1}i(FS,"isGaslessSwapQuote");function zr(t){return Ht(t)||Ir(t)||io(t)}i(zr,"isSingleNetworkSwapQuote");u();l();var Ce;(function(t){t.Idle="idle",t.Started="started",t.Simulating="simulating",t.SimulationRequestErrored="simulationRequestErrored",t.SimulationFailed="simulationFailed",t.SimulationSkipped="simulationSkipped",t.Simulated="simulated",t.SubmittingTransaction="submittingTransaction",t.TransactionSubmissionFailed="transactionSubmissionFailed",t.TransactionSubmitted="transactionSubmitted",t.ConfirmingTransaction="confirmingTransaction",t.TransactionNotConfirmed="transactionNotConfirmed",t.TransactionConfirmed="transactionConfirmed"})(Ce||(Ce={}));u();l();var Z;(function(t){t.ExecuteSwapStarted="executeSwapStarted",t.SimulationRequestStarted="simulationRequestStarted",t.SimulationPassed="simulationPassed",t.SimulationFailed="simulationFailed",t.SimulationSkipped="simulationSkipped",t.SubmittingTransaction="submittingTransaction",t.TransactionSubmissionFailed="transactionSubmissionFailed",t.TransactionSubmissionStarted="transactionSubmissionStarted",t.TransactionSubmissionSuccess="transactionSubmissionSuccess",t.TransactionConfirmationStarted="transactionConfirmationStarted",t.TransactionConfirmationFailed="transactionConfirmationFailed",t.TransactionConfirmed="transactionConfirmed"})(Z||(Z={}));u();l();function mt(t){return t.type==="pair"||t.type==="changingToken"||t.type==="refreshing"}i(mt,"hasPair");u();l();var wf=N(Ve());var gr=N(z());u();l();u();l();u();l();u();l();var ao="cash-account",eP="grouped-balances",Li=[ao,eP],fm=[ao,"cash-activity"],Qr={account:i((t,e)=>[ao,"account",{userId:t,isCashEnabled:e}],"account"),balance:i((t,e)=>[ao,"balance",{userId:t,isCashEnabled:e}],"balance"),cashKMSAccount:i(t=>[ao,"kms-account",{user:t}],"cashKMSAccount"),bankDetails:i(t=>[ao,"bankDetails",{user:t}],"bankDetails"),enrollment:i(t=>[ao,"enrollment",{userId:t}],"enrollment"),groupedBalances:i((t,e,r)=>[...Li,{userID:t,addresses:e,isCashEnabled:r}],"groupedBalances"),lastBroadcastDate:i(()=>[ao,"lastBroadcastDate"],"lastBroadcastDate"),cashActivity:i((t,e)=>[...fm,{userID:t?.userID,params:e}],"cashActivity"),waitlistEntry:i(t=>[ao,"waitlist-entry",t],"waitlistEntry")};var vc=i(async(t,e)=>t.invalidateQueries({queryKey:Qr.balance(e)}),"invalidateCashBalance"),PS=i(async t=>t.invalidateQueries({queryKey:Li}),"invalidateGroupedBalances"),vS=i(async t=>t.invalidateQueries({queryKey:fm}),"invalidateCashActivity");var _S=i(async(t,e)=>{let r=new Date().toISOString();await e.set("cash-account:lastBroadcastDate",r),t.setQueryData(Qr.lastBroadcastDate(),r),await t.invalidateQueries({queryKey:Qr.lastBroadcastDate()})},"invalidateLastBroadcastDate");u();l();u();l();u();l();var us;(function(t){t.NotEnrolled="not_enrolled",t.Unverified="unverified",t.Verified="verified",t.Suspended="suspended",t.Closed="closed"})(us||(us={}));var hm;(function(t){t.Crypto="crypto",t.CryptoRecover="crypto_recover",t.Banking="banking",t.Fiat="fiat",t.Cards="cards",t.PaymentLinks="payment_links",t.AccountManagement="account_management"})(hm||(hm={}));var gm;(function(t){t.NotEnrolled="not_enrolled",t.Unverified="unverified",t.Verified="verified"})(gm||(gm={}));var co;(function(t){t.PhantomUsername="phantom_username",t.Signup="signup",t.Tos="tos",t.Kyc="kyc",t.EmailVerification="email_verification",t.DataSharingConsent="data_sharing_consent",t.L1KycVerification="l1_kyc_verification",t.L2DocumentVerification="l2_document_verification"})(co||(co={}));var _c;(function(t){t.Pending="pending",t.Completed="completed",t.Verified="verified",t.Failed="failed",t.Rejected="rejected",t.NotStarted="not_started",t.Expired="expired",t.NotApplicable="not_applicable"})(_c||(_c={}));var RS=a.nativeEnum(us),tP=a.nativeEnum(hm),DS=a.nativeEnum(gm),rP=a.nativeEnum(co),oP=a.nativeEnum(_c),nP=a.object({type:rP,status:oP.nullish().transform(q),description:a.string().nullish().transform(q),url:a.string().nullish().transform(q),errorMessage:a.string().nullish().transform(q),metadata:a.record(a.string(),a.any()).nullish().transform(q)}),Rc;(function(t){t.NotStarted="not_started",t.Pending="pending",t.Failed="failed",t.Rejected="rejected",t.Verified="verified"})(Rc||(Rc={}));var sP=a.object({kycStartedAt:a.string().nullish().transform(q),idVerificationStatus:a.nativeEnum(Rc).nullish().transform(q),kycVerificationStatus:a.nativeEnum(Rc).nullish().transform(q)}),iP=a.object({consentTimestamp:a.string().nullish().transform(q),consented:a.boolean().nullish().transform(q)}),aP=a.object({authIntentId:a.string().nullish().transform(q)}),cP=a.object({kycMetadata:sP.nullish().transform(q),dataSharing:iP.nullish().transform(q),authIntent:aP.nullish().transform(q)}),uP=a.object({type:a.string(),required:a.boolean(),description:a.string().nullish().transform(q)}),lP=a.object({type:a.nativeEnum(co),required:a.boolean(),description:a.string(),data:a.object({type:a.union([a.literal(co.DataSharingConsent),a.literal(co.L1KycVerification),a.literal(co.L2DocumentVerification)]).nullish().transform(q),currentStatus:a.nativeEnum(_c).nullish().transform(q),authIntentId:a.string().nullish().transform(q),consentRequired:a.boolean().nullish().transform(q)}).nullish().transform(q)}),Dc;(function(t){t.NotStarted="not_started",t.Pending="pending",t.Failed="failed",t.RegionLocked="region_locked",t.NeedsMoreInfo="needs_more_info",t.Completed="completed",t.CardReady="card_ready"})(Dc||(Dc={}));var Ui=a.object({accountStatus:RS.nullish().transform(q),features:a.array(tP).optional().default([]),availableTransitions:a.array(RS).optional().default([]),canAdvance:a.boolean().optional().default(!1),currentTier:DS.nullish().transform(q),nextTier:DS.nullish().transform(q),nextTierDescription:a.string().nullish().transform(q),nextTierRequirements:a.array(nP).optional().default([]),nextTierRequiredFields:a.record(a.string(),uP).nullish().transform(q),nextSteps:a.array(lP).optional().default([]),verificationState:a.nativeEnum(Dc).nullish().transform(q),metadata:cP.nullish().transform(q)}),Mi=class extends Error{static{i(this,"EnrollmentNotFoundError")}constructor(e){super(`Enrollment data not found for user ${e}. User is not enrolled.`),this.name="EnrollmentNotFoundError"}},Bc=class extends Error{static{i(this,"EnrollmentValidationError")}zodError;responseData;constructor(e,r){let o=e.issues.map(n=>`${n.path.length>0?n.path.join("."):"root"}: ${n.message}`).join("; ");super(`Enrollment validation failed: ${o}`),this.name="EnrollmentValidationError",this.zodError=e,this.responseData=r}};var zc=Fi,ym;(function(t){t.NotSubmitted="not_submitted",t.Accepted="accepted",t.NotAccepted="not_accepted"})(ym||(ym={}));var wm;(function(t){t.NotSubmitted="not_submitted",t.Incomplete="incomplete",t.PendingReview="pending",t.Approved="approved",t.Rejected="rejected"})(wm||(wm={}));var Sm;(function(t){t.Crypto="crypto",t.CryptoRecover="crypto_recover",t.Banking="banking",t.Fiat="fiat",t.Cards="cards",t.PaymentLinks="payment_links",t.AccountManagement="account_management"})(Sm||(Sm={}));var pP=i(t=>Object.values(Sm).includes(t),"canUseCashAccountFeature"),Qe;(function(t){t.Pending="pending",t.Processing="processing",t.Completed="completed",t.Refunded="refunded",t.Failed="failed",t.Canceled="canceled",t.Unknown="unknown"})(Qe||(Qe={}));var Nc;(function(t){t.Debit="debit",t.Credit="credit"})(Nc||(Nc={}));var Lc;(function(t){t.Transfer="transfer",t.Swap="swap",t.PerpsFunding="perps_funding",t.Refund="refund",t.KycUpdate="kyc_update",t.AccountUpdate="account_update",t.Microdeposit="microdeposit",t.UserCardLock="user_card_lock",t.UserCardUnlock="user_card_unlock",t.PhantomCardLock="phantom_card_lock",t.PhantomCardUnlock="phantom_card_unlock",t.CardTransaction="card_transaction",t.CardPinUpdated="card_pin_updated",t.Onramp="onramp",t.Delegation="delegation",t.Recovery="recovery",t.Unknown="unknown"})(Lc||(Lc={}));var Oi=class extends Error{static{i(this,"CashAccountNotFoundError")}constructor(e){super(`Cash account not found for user ${e}. User is not enrolled in cash account.`),this.name="CashAccountNotFoundError"}},Mc=class extends Error{static{i(this,"CashAccountValidationError")}zodError;responseData;constructor(e,r){let o=e.issues.map(n=>`${n.path.length>0?n.path.join("."):"root"}: ${n.message}`).join("; ");super(`Cash account validation failed: ${o}`),this.name="CashAccountValidationError",this.zodError=e,this.responseData=r}},Qc=a.object({id:a.string(),primaryEmail:a.string().nullish().transform(q),accountStatus:a.string().nullish().transform(q),addressDetails:a.object({address:a.string()}),features:a.array(a.string()).transform(t=>t.filter(pP)),limits:a.object({dailyFiatTransfer:a.string().nullish().transform(q),monthlyFiatTransfer:a.string().nullish().transform(q)}).nullish().transform(q),waitlistDetails:a.object({waitlist:a.boolean(),priorityWaitlist:a.boolean()}).nullish().transform(q),isRegionLocked:a.boolean().nullish().transform(q),linkDetails:a.object({cryptoCustomerId:a.string().nullish().transform(q),authIntentId:a.string().nullish().transform(q),linkEmail:a.string().nullish().transform(q)}).nullish().transform(q)});var i3=a.object({sourceCurrency:a.string().nullish().transform(q),destinationCurrency:a.string().nullish().transform(q),destinationBlockchain:a.string().nullish().transform(q),destinationAddress:a.string().nullish().transform(q),accountNumber:a.string().nullish().transform(q),routingNumber:a.string().nullish().transform(q),accountType:a.string().nullish().transform(q),bankName:a.string().nullish().transform(q),bankAddress:a.string().nullish().transform(q),bankBeneficiaryName:a.string().transform(Yg).nullish().transform(q),bankBeneficiaryAddress:a.string().nullish().transform(q)}),dP=a.object({price:a.number(),priceChange24h:a.number(),lastUpdatedAt:a.string().transform(t=>new Date(t))}),mP=a.object({account:a.string(),quantity:a.number(),quantityString:a.string()}),fP=a.object({address:a.string(),quantity:a.number(),quantityString:a.string(),lastTransferredDate:a.string().nullish().transform(q),subaccounts:a.array(mP).nullish().transform(q)}),hP=a.object({isMutable:a.boolean().nullish().transform(q),creators:a.array(a.string()).nullish().transform(q),tokenProgram:a.string().nullish().transform(q),extensions:a.array(a.any()).nullish().transform(q),compression:a.record(a.any()).nullish().transform(q)}),a3=a.object({caip19:a.string(),name:a.string(),symbol:a.string(),decimals:a.number(),spamStatus:zc.nullish().default(null),logoUri:a.string().nullish().default(""),totalQuantity:a.number(),totalQuantityString:a.string(),price:dP.nullish().transform(q),queriedWalletBalances:a.array(fP),extraMetadata:hP}),c3=a.object({email:a.string().email(),cashAccountAddress:a.string(),idempotencyKey:a.string()}),u3=a.object({enrollmentDetails:a.object({kycStatus:a.nativeEnum(wm),kycUrl:a.string(),tosStatus:a.nativeEnum(ym),tosUrl:a.string()})}),Uc;(function(t){t.TRANSFER_TO_BANK="transfer_to_bank",t.TRANSFER_TO_USERNAME="transfer_to_username",t.TRANSFER_TO_WALLET="transfer_to_wallet",t.WITHDRAWAL_TO_WALLET="withdrawal_to_wallet",t.SELL_TOKENS="sell_tokens",t.CARD_BANK_DEPOSIT="card_bank_deposit",t.VIRTUAL_ACCOUNT_DEPOSIT="virtual_account_deposit",t.DELEGATE_WALLET_ACCOUNT="delegate_wallet_account"})(Uc||(Uc={}));var gP=a.object({account:a.string(),quantity:a.number(),quantityString:a.string()}),yP=a.object({address:a.string(),quantity:a.number(),quantityString:a.string(),lastTransferredDate:a.string().nullish().transform(q),subaccounts:a.array(gP).nullish().transform(q)}),wP=a.object({isMutable:a.boolean().nullish().default(null),creators:a.array(a.unknown()).nullish().transform(q),tokenProgram:a.string().nullish().transform(q),extensions:a.array(a.unknown()).nullish().transform(q)}),BS=a.object({caip19:a.string(),name:a.string(),symbol:a.string(),decimals:a.number(),logoUri:a.string(),spamStatus:zc,totalQuantity:a.number(),totalQuantityString:a.string(),queriedWalletBalances:a.array(yP),extraMetadata:wP.nullish().transform(q),price:a.object({price:a.number(),priceChange24h:a.number().nullish().transform(q),lastUpdatedAt:a.coerce.date(),marketCap:a.number().nullish().transform(q)}).nullish()}),l3=a.object({stablecoins:a.array(BS),otherTokens:a.array(BS),totalStablecoinsValueUsd:a.string().nullish().transform(q),totalOtherTokensValueUsd:a.string().nullish().transform(q)}),Oc;(function(t){t.UNVERIFIED="unverified",t.VERIFIED="verified"})(Oc||(Oc={}));var NS;(function(t){t.AlreadyExists="already_exists",t.InProgress="in_progress",t.Pending="pending",t.Completed="completed"})(NS||(NS={}));var SP=a.object({targetState:a.nativeEnum(Oc),data:a.object({email:a.string().email().optional(),cashAccountAddress:a.string().optional()}),idempotencyKey:a.string().optional()}),bP=Ui.extend({account:Qc}),TP=a.object({requirementType:a.nativeEnum(co),evidence:a.object({authIntentId:a.string(),providerCustomerId:a.string(),dataSharing:a.object({consented:a.boolean()})})}),AP=Ui.extend({account:Qc}),uo;(function(t){t.BankAccountId="bank_account_id",t.Bank="bank",t.Crypto="crypto",t.PhantomUsername="phantom_username",t.Merchant="merchant"})(uo||(uo={}));var xP=a.nativeEnum(uo),EP=a.object({type:a.literal("fiat"),currency:a.string(),value:a.string()}),CP=a.object({type:a.literal("token"),token:a.string(),symbol:a.string(),value:a.string(),decimals:a.number()}),US=a.discriminatedUnion("type",[EP,CP]),LS;(function(t){t.Fiat="fiat",t.Token="token"})(LS||(LS={}));var kP=a.record(a.string(),US),OS=a.object({accountHolderName:a.string().nullish().transform(q),accountNumber:a.string().nullish().transform(q),accountType:a.string().nullish().transform(q),bankName:a.string().nullish().transform(q),nickname:a.string().nullish().transform(q)}),zi=a.object({type:xP,currency:a.string(),name:a.string().nullish().transform(q),phantomUsername:a.string().nullish().transform(q)}),IP=zi.extend({type:a.literal(uo.BankAccountId),bankDetails:OS.nullish().transform(q)}),FP=zi.extend({type:a.literal(uo.Bank),bankDetails:OS.nullish().transform(q)}),PP=zi.extend({type:a.literal(uo.Crypto),address:a.string().nullish().transform(q),phantomUsername:a.string().nullish().transform(q)}),vP=a.object({merchantName:a.string().nullish().transform(q),merchantCategoryCode:a.string().nullish().transform(q)}),_P=a.object({name:a.string().nullish().transform(q),categoryPrimary:a.string().nullish().transform(q),categoryDetailed:a.string().nullish().transform(q),icon:a.string().nullish().transform(q),website:a.string().nullish().transform(q),location:a.any().nullish().transform(q)}),RP=zi.extend({type:a.literal(uo.Merchant),merchantDetails:vP.nullish().transform(q),enrichedMerchantDetails:_P.nullish().transform(q),category:a.string().nullish().transform(q),icon:a.string().nullish().transform(q),website:a.string().nullish().transform(q)}),bm;(function(t){t.Following="following"})(bm||(bm={}));var DP=zi.extend({type:a.literal(uo.PhantomUsername),phantomUsername:a.string().nullish().transform(q),icon:a.string().nullish().transform(q),relationship:a.nativeEnum(bm).nullish().transform(q)}),BP=a.union([IP,FP,PP,DP,RP]),MS=a.object({amount:a.string(),decimals:a.number(),logoUri:a.string().nullish().transform(q),mint:a.string(),name:a.string().nullish().transform(q),owner:a.string(),symbol:a.string().nullish().transform(q),spamStatus:zc.nullish().transform(q)}),mn;(function(t){t.CashOut="cash_out",t.Swap="swap"})(mn||(mn={}));var NP=a.object({input:MS,output:MS,quoteId:a.string().nullish().transform(q),quoteSource:a.string().nullish().transform(q),type:a.nativeEnum(mn).nullish().transform(q)}),p3=a.object({type:a.nativeEnum(Lc),id:a.string(),state:a.nativeEnum(Qe),occurredAt:a.string(),counterparty:BP,direction:a.nativeEnum(Nc),amount:US,feeBreakdown:kP.nullish().default(null),spamStatus:zc.nullish().transform(q),metadata:a.object({swapInfo:NP.nullish().default(null),merchant:a.any().nullish().default(null),enrichment:a.object({lastEnrichedAt:a.string().nullish().transform(q),source:a.string().nullish().transform(q)}).nullish().transform(q)}).nullish().default(null),onchainTxId:a.string().nullish().transform(q)}),qc;(function(t){t.PENDING="pending",t.ACTIVATED="activated",t.REJECTED="rejected"})(qc||(qc={}));var qi;(function(t){t.EXTERNAL="external",t.USER="user"})(qi||(qi={}));var LP=i(t=>Object.values(qc).includes(t),"canUseWaitlistStatus"),MP=i(t=>Object.values(qi).includes(t),"canUseWaitlistSource"),d3=a.object({email:a.string().email(),country:a.string().length(2).nullish().transform(q),state:a.string().nullish().transform(q),referralCode:a.string().nullish().transform(q),marketingOptIn:a.boolean().default(!0),source:a.string().refine(MP).default(qi.USER)}),m3=a.object({id:a.string(),referralCode:a.string(),position:a.number().nullish().transform(q)}),f3=a.object({id:a.string(),referralBoost:a.number(),referralCode:a.string(),referralCount:a.number(),status:a.string().refine(LP)});u();l();u();l();var qS=i(t=>{if(!t?.accountStatus)return!1;let{accountStatus:e}=t;return e===us.Unverified||e===us.Verified},"hasCashAccount");u();l();var zS=N(z());var UP=j({seconds:5}),QS=i(t=>{let{data:e}=pr(),{userID:r}=e??{},o=OP();return te({...t,queryKey:Qr.enrollment(r),queryFn:r?async()=>{try{let n=await G.api().bearer(!0).get(`/cash/v1/users/${r}/cash-account/enrollment`);if(n.status===204||n.status===404)throw new Mi(r);if(n.status===403)throw new Error(`Access denied to enrollment data for user ${r}`);let s=Ui.safeParse(n.data);if(!s.success)throw new Bc(s.error,n.data);return s.data}catch(n){throw n instanceof Mi||(await o(),k.captureError(n,v.Cash)),n}}:Dg,retry:!0,retryDelay:UP})},"useEnrollment");function OP(){let t=Do(),e=Be(),r=_o("kill-cash-invalidate-auth-bandaid");return(0,zS.useCallback)(async()=>{r||(k.addBreadcrumb(v.Cash,"Invalidating auth for cash due to 401",D.Debug),await t.logOut(),await Promise.all([Xg(e),sy(e)]),await Promise.all([Jg(e),iy(e)]))},[t,e,r])}i(OP,"useInvalidateAuthIfNeeded");var HS=i(()=>{let{data:t}=QS();return qS(t)},"useHasCashAccount");var Qi=i(t=>{let{data:e}=pr(),{userID:r}=e??{},o=bt("enable-cash"),{canUseCash:n}=ly(),s=o&&n&&Lt!=="extension",{data:c}=ay(),p=!!c?.username,d=HS(),m=!!(r&&t?.enabled!==!1&&s&&p);return te({...t,queryKey:Qr.account(r,s),enabled:m,queryFn:i(async()=>{if(!r)throw new Error("useCashAccount: userID is required");let f=r;try{if(!d)throw new Oi(r);let g=await G.api().bearer(!0).get(`/cash/v1/users/${f}/cash-account`),w=Qc.safeParse(g.data);if(!w.success)throw new Mc(w.error,g.data);return w.data}catch(g){switch(g?.response?.status||g?.response?.data?.statusCode){case 204:case 404:case 403:throw new Oi(f);default:break}throw k.captureError(g,v.Cash),g}},"queryFn")})},"useCashAccount");u();l();var qP=N(z());var zP=i((t,e,r)=>{let o=i(c=>{if(c.caip19!==e)return c;let d=new x(c.totalQuantity).plus(r),m=d.isLessThan(0)?new x(0):d;return{...c,totalQuantity:m.toNumber(),totalQuantityString:m.toString(),queriedWalletBalances:c.queriedWalletBalances}},"updateTokenBalance"),n=t.stablecoins.some(c=>c.caip19===e),s=t.otherTokens.some(c=>c.caip19===e);return!n&&!s?t:{...t,stablecoins:n?t.stablecoins.map(o):t.stablecoins,otherTokens:s?t.otherTokens.map(o):t.otherTokens}},"transformGroupedBalances");function Tm(t,e,r){t.getQueriesData({queryKey:Li,exact:!1}).forEach(([n,s])=>{if(s){let c=zP(s,e,r);t.setQueryData(n,c)}})}i(Tm,"updateGroupedBalances");u();l();u();l();function Am(t,e,r){if(Mr("kill-cash-balance-optimistic-update")||!r)return;let n=Qr.balance(r,!0);t.setQueryData(n,s=>{if(!s)return s;let p=new x(s.totalQuantity).plus(e);return{...s,totalQuantity:p.toNumber(),totalQuantityString:p.toString()}}),vc(t,r)}i(Am,"updateCashBalance");var QP=j({seconds:3}),xm=i(async({queryClient:t,storage:e,authRepository:r,sellCaip19:o,sellAddress:n,sellAmountBN:s,buyCaip19:c,buyAddress:p,buyAmountBN:d,cashAccountAddress:m})=>{let g=(await r.getUser())?.userID??"";GP({queryClient:t,sellCaip19:o,sellAmountBN:s,sellAddress:n,buyCaip19:c,buyAmountBN:d,buyAddress:p,cashAccountAddress:m,userId:g}),await _S(t,e),await new Promise(w=>setTimeout(w,QP)),await HP(t,g)},"invalidateCashSwap"),HP=i(async(t,e)=>Promise.all([PS(t),vc(t,e),vS(t)]),"invalidateCashSwapQueries"),GP=i(({queryClient:t,sellCaip19:e,sellAmountBN:r,sellAddress:o,buyCaip19:n,buyAmountBN:s,buyAddress:c,cashAccountAddress:p,userId:d})=>{if(!d)return;let m=L(e),f=L(n);p&&o===p?Am(t,r.negated(),d):Tm(t,m,r.negated()),p&&c===p?Am(t,s,d):Tm(t,f,s),KP({sellCaip19:e,sellAmountBN:r,sellAddress:o,buyCaip19:n,buyAmountBN:s,buyAddress:c,cashAccountAddress:p})},"optimisticUpdate"),KP=i(({sellCaip19:t,sellAmountBN:e,sellAddress:r,buyCaip19:o,buyAmountBN:n,buyAddress:s,cashAccountAddress:c})=>{let p=Mr("kill-cash-balance-optimistic-update");r===c?k.addBreadcrumb(v.Cash,`[optimisticUpdate] buying ${n.toString()} ${o} w/ ${e.toString()} cash, isKillSwitchEnabled: ${p}`,D.Debug):s===c?k.addBreadcrumb(v.Cash,`[optimisticUpdate] buying ${n.toString()} (cash) w/ ${e.toString()} ${t}, isKillSwitchEnabled: ${p}`,D.Debug,{amount:n.toString()}):k.addBreadcrumb(v.Cash,`[optimisticUpdate] [non-cash] buying ${n.toString()} ${o} w/ ${e.toString()} ${t}`,D.Debug)},"logOptimisticUpdate");var GS=N(z());u();l();var Hi=i(t=>{let e=t?.addressDetails?.address;return e?{[oe.Solana.Mainnet]:e}:{}},"createSwapperCashAddresses");var Hc=i(()=>{let{data:t}=Qi();return(0,GS.useMemo)(()=>Hi(t),[t])},"useSwapperCashAddresses");u();l();u();l();u();l();var $P=["SwapperNoQuotes","UnsupportedCountry","UnknownError"],KS=i((t,e,r,o)=>{t instanceof tt&&$P.includes(t.code)||(!e||e>=400&&e<500)&&k.addBreadcrumb(r,JSON.stringify(o),D.Info)},"captureClientError");u();l();var $S=i(async(t,e,r=void 0)=>{if(J(t))return Promise.resolve();let o;try{o=t.data}catch{throw new tt({key:r})}let n=Cc.safeParse(o);throw n.success?(k.addBreadcrumb(e,JSON.stringify(n.data),D.Info),new tt({key:n.data.name})):new tt({key:r})},"handleBadResponse");u();l();var jS=i(t=>{let e=new tt({key:"SwapperNoQuotes"});if(Bi.safeParse(t?.type).success===!1)throw k.captureError(new Error("Failed to parse a valid quote type."),v.Swapper),new Error("Invalid input");let r=Ni.safeParse(t);if(!r.success)throw k.captureError(new Error("Failed to parse a valid swap quotes response."),v.Swapper),e;if(r.data.quotes.length===0)throw e;return r.data},"parseSwapQuotesResponse");var VS="swap-quotes";async function Gc({sellTokenCaip19:t,buyTokenCaip19:e,taker:r,takerDestination:o,exactOut:n,sellAmount:s,sellAmountUsd:c,slippageTolerance:p,signal:d,enableAutoSlippage:m,priorityFee:f,tipAmount:g,phantomCashAccount:w,isPrediction:y,predictions:S}){let b;try{Ci(r)&&(r.address=r.address.toLowerCase()),o&&Ci(o)&&(o.address=o.address.toLowerCase()),Ci(e)&&(e.address=e.address.toLowerCase()),Ci(t)&&(t.address=t.address.toLowerCase());let T="/swap/v2/quotes",A={sellToken:t,buyToken:e,taker:r,takerDestination:o,exactOut:n,sellAmount:s,sellAmountUsd:c,slippageTolerance:p,autoSlippage:m,priorityFee:f,tipAmount:g,phantomCashAccount:w,isPrediction:y,predictions:S},E=await G.api().post(T,A,{signal:d});return b=E.status,await $S(E,VS,"SwapperNoQuotes"),jS(E.data)}catch(T){let A=T instanceof tt?T:new tt;throw KS(A,b,VS,{sellToken:t,buyToken:e,sellAmount:s,sellAmountUsd:c,slippageTolerance:p}),A}}i(Gc,"getSwapQuotes");var Kc=class{static{i(this,"WalletSwapApiClient")}getQuotes(e){return Gc({sellTokenCaip19:e.sell,buyTokenCaip19:e.buy,taker:e.taker,takerDestination:e.takerDestination,sellAmount:e.amount,sellAmountUsd:e.amountUsd,slippageTolerance:e.slippageTolerance,signal:e.signal,exactOut:e.exactOutEnabled,priorityFee:e.priorityFee,tipAmount:e.tipAmount,enableAutoSlippage:e.autoSlippageEnabled,phantomCashAccount:e.phantomCashAccount})}};u();l();u();l();var $c=class{static{i(this,"BridgeTrackingSwapCommand")}inner;bridgeStatusManager;executingQuote;takerAddress;networkId;quote;executionId;constructor(e,r,o){this.inner=e,this.bridgeStatusManager=r,this.executingQuote=o,this.takerAddress=e.takerAddress,this.networkId=e.networkId,this.quote=e.quote,this.executionId=e.executionId}createTransaction(){return this.inner.createTransaction()}swap(e,r,o,n,s){return this.inner.swap(e,r,o,n,s)}async waitForConfirmation(e){await this.bridgeStatusManager.track({executionId:this.executionId,executingQuote:this.executingQuote,transactionHash:e.id}),await this.inner.waitForConfirmation(e)}};u();l();u();l();u();l();var Gt="swapper",pt;(function(t){t.quotes="quotes",t.transactions="transactions",t.slippageTolerance="slippageTolerance",t.priorityFee="priorityFee",t.tipAmount="tipAmount",t.presence="presence",t.lastSubmittedPairs="lastSubmittedPairsV2",t.lastSelectedTokens="lastSelectedTokens",t.slippageSettings="slippageSettings",t.priorityFeeSettings="priorityFeeSettings",t.tipSettings="tipSettings",t.hasViewedAutoSlippageOptIn="hasViewedAutoSlippageOptIn",t.optimisticUpdates="optimisticUpdates",t.autoSlippageMigrationVersion="autoSlippageMigrationVersion"})(pt||(pt={}));var WS=[Gt,pt.quotes],me={quotesScope:i(()=>WS,"quotesScope"),quotes:i(({sellTokenCaip19:t,buyTokenCaip19:e,taker:r,amountValue:o,amountType:n,slippageTolerance:s,priorityFee:c,tipAmount:p,takerDestination:d,enableAutoSlippage:m,preferredProvider:f,phantomCashAccount:g})=>[...WS,{sellToken:t,buyToken:e,taker:r,takerDestination:d,amountValue:o,amountType:n,slippageTolerance:s,priorityFee:c,tipAmount:p,enableAutoSlippage:m,preferredProvider:f,phantomCashAccount:g}],"quotes"),transactions:i(t=>[Gt,pt.transactions,t],"transactions"),presence:i(t=>[Gt,pt.presence,t],"presence"),slippageTolerance:i(()=>[Gt,pt.slippageTolerance],"slippageTolerance"),priorityFee:i(()=>[Gt,pt.priorityFee],"priorityFee"),tipAmount:i(()=>[Gt,pt.tipAmount],"tipAmount"),lastSubmittedPairs:i(()=>[Gt,pt.lastSubmittedPairs],"lastSubmittedPairs"),lastSelectedTokens:i(()=>[Gt,pt.lastSelectedTokens],"lastSelectedTokens"),slippageSettings:i(()=>[Gt,pt.slippageSettings],"slippageSettings"),priorityFeeSettings:i(()=>[Gt,pt.priorityFeeSettings],"priorityFeeSettings"),tipSettings:i(()=>[Gt,pt.tipSettings],"tipSettings"),hasViewedAutoSlippageOptIn:i(()=>[Gt,pt.hasViewedAutoSlippageOptIn],"hasViewedAutoSlippageOptIn"),optimisticUpdates:i(()=>[Gt,pt.optimisticUpdates],"optimisticUpdates"),autoSlippageMigrationVersion:i(()=>[Gt,pt.autoSlippageMigrationVersion],"autoSlippageMigrationVersion")};u();l();var jc;(function(t){t[t.Always=1/0]="Always",t[t.Short=j({days:1})]="Short",t[t.Medium=j({days:3})]="Medium",t[t.Long=j({days:7})]="Long"})(jc||(jc={}));var Vc;(function(t){t[t.Immediate=0]="Immediate",t[t.Short=j({minutes:1})]="Short",t[t.Medium=j({minutes:2.5})]="Medium",t[t.Long=j({minutes:60})]="Long",t[t.Never=1/0]="Never"})(Vc||(Vc={}));var ls;(function(t){t[t.Short=j({seconds:20})]="Short",t[t.Medium=j({minutes:2.5})]="Medium",t[t.Long=j({minutes:5})]="Long"})(ls||(ls={}));var ZS=i(async({callerAddress:t,contractAddress:e,networkId:r,sellAmount:o,allowanceTarget:n,approvalExactAmount:s,exchangeAddress:c,value:p,transactionData:d,type:m})=>{let f=[],g=[];if(e&&(await Ry({callerAddress:t,spender:n,networkId:r,contractAddress:e})).lt(s??o.toString())){let S=await Dy({callerAddress:t,spender:n,networkId:r,contractAddress:e,exactAmount:s});f.push(S),g.push(`${m}-approval`)}let w=Kn.parse({type:hg.eip1559,from:t,data:d,chainId:C.getEVMNetworkIDValue(r),to:c,...p==="0"?{}:{value:`0x${new K(p).toString(16)}`}});return f.push(w),g.push(m),{transactions:f,transactionTypes:g}},"createEVMTransactions"),Gi=i(async({networkId:t,callerAddress:e,quote:r})=>{let{sellAmount:o,steps:n}=r,s=[],c=[],p=[];for(let d of n){let{allowanceTarget:m,exchangeAddress:f,value:g,transactionData:w,sellToken:y,buyToken:S,approvalMetadata:b}=d,T=y.resourceType===V.address?y.address:null,A=C.compareNetworkID(y.chainId,S.chainId)===0?"swap":"bridge";if(!m||!f||!w||!g)throw new Error("Missing bridge step data for EVM bridge quote.");let E=await ZS({callerAddress:e,contractAddress:T,networkId:t,sellAmount:o,allowanceTarget:m,approvalExactAmount:d.approvalExactAmount,exchangeAddress:f,value:g,transactionData:w,type:A});s.push(...E.transactions),c.push(...E.transactionTypes),p.push({sellToken:y,buyToken:S,approvalMetadata:b}),E.transactionTypes.length==2&&E.transactionTypes.find(I=>I.includes("approval"))&&p.push({sellToken:y,buyToken:S,approvalMetadata:b})}return{type:"evm",transactions:s,transactionTypes:c,transactionPairs:p}},"processEVMBridgeQuote"),Ki=i(async({quote:t,connection:e})=>{let r=[],o=[],n=[];for(let s of t.steps){let{transactionData:c,sellToken:p,buyToken:d}=s,m=C.compareNetworkID(p.chainId,d.chainId)===0?"swap":"bridge",f=await YS(c,e);r.push(dd.serialize(f).transaction),o.push(m),n.push({sellToken:p,buyToken:d})}return{type:"solana",transactions:r,transactionTypes:o,transactionPairs:n}},"processSolanaBridgeQuote"),$i=i(async({networkId:t,callerAddress:e,quote:r,sellFungible:o})=>{let n=o.type===ae.ERC20&&o?.data.tokenAddress?o.data.tokenAddress:null,{allowanceTarget:s,exchangeAddress:c,sellAmount:p,value:d}=r;return{type:"evm",...await ZS({callerAddress:e,contractAddress:n,networkId:t,sellAmount:p,allowanceTarget:s,exchangeAddress:c,value:d,transactionData:r.transactionData,type:"swap"})}},"processEVMSwapQuote"),ji=i(async({quote:t})=>{let e=[],r=[],o=[];for(let n of t.steps){let{transactionData:s,sellToken:c,buyToken:p}=n,d=C.compareNetworkID(c.chainId,p.chainId)===0?"swap":"bridge";e.push(s),r.push(d),o.push({sellToken:c,buyToken:p})}return{type:"sui",transactions:e,transactionTypes:r,transactionPairs:o}},"processSuiBridgeQuote"),Wc=i(async({quote:t})=>{let e=[],r=[],o=[];for(let n of t.steps){let{transactionData:s,sellToken:c,buyToken:p}=n;e.push(s),r.push("bridge"),o.push({sellToken:c,buyToken:p})}return{type:"bitcoin",transactions:e,transactionTypes:r,transactionPairs:o}},"processBitcoinBridgeQuote"),YS=i(async(t,e)=>{let r=It(t,"bs58");return await es(r,{connection:e,transactionType:Xn.Swap})},"addPriorityFeeToEncodedTx"),ps=i(async({quote:t,connection:e})=>{let r=t.transactionData.map(c=>YS(c,e)),n=(await Promise.all(r)).map(c=>dd.serialize(c).transaction);return{type:"solana",transactionTypes:n.map(()=>"swap"),transactions:n}},"processSolanaSwapQuote"),XS=i(async({quote:t,connection:e})=>ps({quote:t,connection:e}),"processCashSwapQuote"),Vi=i(async({quote:t})=>({type:"sui",transactionTypes:Array(t.transactionData.length).fill("swap"),transactions:t.transactionData}),"processSuiSwapQuote"),ds=i(({callerAddress:t,sellFungible:e,quote:r})=>{let{connection:o}=qo(),n=me.transactions(r);return te({queryKey:n,enabled:!!r&&!!e,gcTime:0,staleTime:0,refetchInterval:ls.Short,async queryFn(){try{if(!r)throw new Error("Missing quote");if(!e)throw new Error("Missing sell token");let s=e.data.chain.id;if(zr(r)){if(C.isEVMNetworkID(s)&&Ir(r))return await $i({networkId:s,callerAddress:t,quote:r,sellFungible:e});if(C.isSolanaNetworkID(s)&&Ht(r))return ps({quote:r,connection:o});if(C.isSuiNetworkID(s)&&io(r))return Vi({quote:r});throw new Error(`Single network swap quote not supported for network ID ${s}`)}if(le(r)){if(C.isEVMNetworkID(s))return await Gi({networkId:s,callerAddress:t,quote:r});if(C.isSolanaNetworkID(s))return await Ki({quote:r,connection:o});if(C.isSuiNetworkID(s))return await ji({quote:r});throw new Error(`Bridge quote not supported for network ID ${s}`)}throw new Error("Swap quote type not supported")}catch(s){throw s instanceof Error&&k.captureError(s,v.Swapper),s}}})},"useSwapTransactions");u();l();var Qo=N(Fg());u();l();var ob=N(z());u();l();var JS=N(z());u();l();function De(t){let e=t.reduce((r,o)=>r.add(o.name),new Set);return Array.from(e).join(" + ")}i(De,"parseSwapSources");function Zc(t){return(0,JS.useMemo)(()=>De(t),[t])}i(Zc,"useProvider");u();l();var tb=N(z());u();l();var Wi=N(z());var eb=i(()=>{let[t,e]=(0,Wi.useState)(!1),r=$(d=>d.selectedProviderIndex),o=$(d=>d.selectedBaseProvider),n=$(d=>d.quoteResponse),s=(0,Wi.useMemo)(()=>n?n.quotes:[],[n]),c=(0,Wi.useMemo)(()=>{if(an){if(!n||n.quotes.length===0)return 0;let d=jP(n,o);return d===-1?(e(o!==dr),0):(e(!1),d)}return r},[n,o,r]),p=s.length>0?s[c]:void 0;return{selectedQuoteIndex:c,selectedBaseProvider:an?o:"",currentQuote:p,hasDefaultedToBestQuote:t}},"useSelectedQuote"),jP=i((t,e)=>t.quotes.findIndex(r=>r.baseProvider.id===e),"getQuoteIndexByProvider");function xe(){let t=$(m=>m.quoteResponse),e=$(m=>m.hasNoRoutes),r=$(m=>m.isFetchingQuote),o=(0,tb.useMemo)(()=>t?t.quotes:[],[t]),n=o[0]?.buyAmount??"",{selectedQuoteIndex:s,selectedBaseProvider:c,currentQuote:p,hasDefaultedToBestQuote:d}=eb();return{bestBuyAmount:n,currentQuote:p,hasNoRoutes:e,quoteResponse:t,quotes:o,selectedProviderIndex:s,selectedBaseProvider:c,isFetchingQuote:r,hasDefaultedToBestQuote:d}}i(xe,"useQuote");u();l();u();l();var ms=i(t=>t.steps.map(e=>e.tool),"getBridgeTools");var Me=i(t=>t?le(t)?ms(t):t?.sources??[]:[],"getSwapQuoteSources");function nb({sender:t}){let{t:e}=qe(),{currentQuote:r}=xe(),o=$(g=>g.buyFungible),n=$(g=>g.sellFungible),s=Zc(Me(r)),{data:c}=ds({callerAddress:t,quote:r,sellFungible:n}),p=c?.transactionPairs?.flatMap(g=>[...un(g.sellToken)??[],...un(g.buyToken)??[]])??[],d=[...new Set(p)],{fungibles:m}=os({keys:d});return{pendingActivityRows:(0,ob.useMemo)(()=>Fr({swapTransactions:c,sellFungible:n,buyFungible:o,fungibles:m,t:e,currentQuote:r,provider:s}),[c,n,o,m,e,r,s])}}i(nb,"usePendingActivity");function Fr({swapTransactions:t,sellFungible:e,buyFungible:r,fungibles:o,currentQuote:n,provider:s,t:c}){let p={pendingSwapActivityRows:[],pendingApprovalActivityRows:[]};return t?t.type==="evm"?t.transactionTypes.reduce((d,m,f)=>{let g=e,w=r,y,S=t.transactionPairs;if(S&&S[f]){let b=S[f];g=Yc(b.sellToken,o)??e,w=Yc(b.buyToken,o)??r,y=b.approvalMetadata}if(m.includes("approval")){let b=g?.data.symbol??"";d.pendingApprovalActivityRows.push({topLeft:y?{text:`${c("transactionsPendingApproving")} ${y.symbol}`}:{text:`${c("transactionsPendingApproving")} ${b}`}})}else g&&w&&d.pendingSwapActivityRows.push(rb({sellFungible:g,buyFungible:w,sellAmount:n?.sellAmount,buyAmount:n?.buyAmount,provider:s,isBridge:m.includes("bridge"),t:c}));return d},p):t.transactionTypes.reduce((d,m,f)=>{let g=e,w=r,y=t.transactionPairs;if(y&&y[f]){let S=y[f];g=Yc(S.sellToken,o)??e,w=Yc(S.buyToken,o)??r}return g&&w&&d.pendingSwapActivityRows.push(rb({sellFungible:g,buyFungible:w,sellAmount:n?.sellAmount,buyAmount:n?.buyAmount,provider:s,isBridge:m.includes("bridge"),t:c})),d},p):p}i(Fr,"getPendingActivityRows");var rb=i(({sellFungible:t,buyFungible:e,sellAmount:r,buyAmount:o,provider:n,isBridge:s,t:c})=>{let p=t.data.symbol,d=e.data.symbol,m=Ae(r??0,t.data.decimals??0),f=Ae(o??0,e.data.decimals??0);return{topLeft:{text:`${c(s?"transactionsPendingBridging":"transactionsPendingSwapping")} on ${n}`},topRight:{text:`${f} ${d}`,color:"spotPositive"},bottomLeft:{text:`${p} \u2192 ${d}`},bottomRight:{text:`${m} ${p}`}}},"getPendingSwapActivityRows"),Yc=i((t,e)=>e.find(r=>(un(t)??[]).includes(r.data.key)),"getFungibleFromFungibleCaip19");var Xc=class{static{i(this,"BitcoinSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;constructor(e,r,o,n,s){this.executingQuote=e,this.takerAddress=r,this.networkId=o,this.quote=n,this.executionId=s}async createTransaction(){return Wc({quote:this.quote})}async swap(e,r,o,n,s){let c=r.transactions[0];if(!c)throw new Error("No transaction found");let p=Qo.Psbt.fromHex(c),d=this.analyzePsbtInputs(p,this.takerAddress),m=await vy({accountSigner:n,storage:s,accountIdentifier:e,pendingTransactionInput:this.parsePendingTransactionInput(this.executingQuote,r,p),psbt:p,psbtChain:void 0,inputsToSign:d,utxoManager:Py(new Fy(s))});return{networkID:this.networkId,id:m}}async waitForConfirmation(e){await _y(this.networkId,e.id)}analyzePsbtInputs(e,r){let o=[];if(e.data.inputs.forEach((n,s)=>{let c;if(n.witnessUtxo?c=n.witnessUtxo.script:n.nonWitnessUtxo&&(c=Qo.Transaction.fromBuffer(n.nonWitnessUtxo).outs[e.txInputs[s].index].script),c)try{Qo.address.fromOutputScript(c,Qo.networks.bitcoin)===r&&o.push(s)}catch(p){console.warn(`Could not decode script for input ${s}:`,p)}}),o.length===0)throw new Error(`No inputs found for user address ${r}`);return[{address:r,signingIndexes:o}]}parsePendingTransactionInput(e,r,o){let n=De(Me(e.quote)),c=Fr({swapTransactions:r,sellFungible:e.sell,buyFungible:e.buy,fungibles:[],currentQuote:e.quote,provider:n,t:R.t}).pendingSwapActivityRows[0];return{ownerAddress:this.takerAddress,networkID:this.networkId,data:{txID:"",psbtHex:o.toHex()},type:dt.Swap,display:{summary:{topLeft:c.topLeft,topRight:c.topRight,bottomLeft:c.bottomLeft,bottomRight:c.bottomRight}}}}};var Jc=class{static{i(this,"BtcBridgeSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;bitcoinSwapCommand;constructor(e,r,o,n,s){this.executingQuote=e,this.takerAddress=r,this.networkId=o,this.quote=n,this.executionId=s,this.bitcoinSwapCommand=new Xc(e,r,o,n,s)}async createTransaction(){return Wc({quote:this.quote})}async swap(e,r,o,n,s){return this.bitcoinSwapCommand.swap(e,r,o,n,s)}async waitForConfirmation(e){return this.bitcoinSwapCommand.waitForConfirmation(e)}};u();l();u();l();u();l();u();l();u();l();function VP(t){if(t.length>=255)throw new TypeError("Alphabet too long");let e=new Uint8Array(256);for(let m=0;m<e.length;m++)e[m]=255;for(let m=0;m<t.length;m++){let f=t.charAt(m),g=f.charCodeAt(0);if(e[g]!==255)throw new TypeError(f+" is ambiguous");e[g]=m}let r=t.length,o=t.charAt(0),n=Math.log(r)/Math.log(256),s=Math.log(256)/Math.log(r);function c(m){if(m instanceof Uint8Array||(ArrayBuffer.isView(m)?m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength):Array.isArray(m)&&(m=Uint8Array.from(m))),!(m instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(m.length===0)return"";let f=0,g=0,w=0,y=m.length;for(;w!==y&&m[w]===0;)w++,f++;let S=(y-w)*s+1>>>0,b=new Uint8Array(S);for(;w!==y;){let E=m[w],I=0;for(let P=S-1;(E!==0||I<g)&&P!==-1;P--,I++)E+=256*b[P]>>>0,b[P]=E%r>>>0,E=E/r>>>0;if(E!==0)throw new Error("Non-zero carry");g=I,w++}let T=S-g;for(;T!==S&&b[T]===0;)T++;let A=o.repeat(f);for(;T<S;++T)A+=t.charAt(b[T]);return A}i(c,"encode");function p(m){if(typeof m!="string")throw new TypeError("Expected String");if(m.length===0)return new Uint8Array;let f=0,g=0,w=0;for(;m[f]===o;)g++,f++;let y=(m.length-f)*n+1>>>0,S=new Uint8Array(y);for(;m[f];){let E=e[m.charCodeAt(f)];if(E===255)return;let I=0;for(let P=y-1;(E!==0||I<w)&&P!==-1;P--,I++)E+=r*S[P]>>>0,S[P]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");w=I,f++}let b=y-w;for(;b!==y&&S[b]===0;)b++;let T=new Uint8Array(g+(y-b)),A=g;for(;b!==y;)T[A++]=S[b++];return T}i(p,"decodeUnsafe");function d(m){let f=p(m);if(f)return f;throw new Error("Non-base"+r+" character")}return i(d,"decode"),{encode:c,decodeUnsafe:p,decode:d}}i(VP,"base");var sb=VP;var WP="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",eu=sb(WP);u();l();var ZP=a.object({id:a.string(),state:a.nativeEnum(Qe)}).passthrough(),Em=class extends Error{static{i(this,"CashActivityError")}activityId;userId;constructor(e,r,o){super(e),this.activityId=r,this.userId=o,this.name="CashActivityError"}},Zi=class extends Error{static{i(this,"CashActivityNotFoundError")}constructor(e,r){super(`Cash activity ${e} not found for user ${r}`),this.name="CashActivityNotFoundError"}},ib=i(async({userID:t,activityId:e,accessToken:r})=>{let o=await G.api().bearer(r).get(`/cash/v1/users/${t}/cash-activity/${e}`);if(o.status===404)throw new Zi(e,t);let n=ZP.safeParse(o.data);if(!n.success)throw new Em(`Failed to parse cash activity response: ${n.error.message}`,e,t);return n.data},"fetchCashActivity");u();l();var Cm;(function(t){t.Base58="base58",t.Base64="base64"})(Cm||(Cm={}));var YP=a.object({activityId:a.string(),transactionId:a.string()}),XP=3,JP=1e3,ab=i(async({accessToken:t,userID:e,idempotencyKey:r,signedTransaction:o,skipActivityRecording:n,skipNotification:s,cashQuoteSignerSignature:c,swapInfo:p,perpsInfo:d,skipPreflight:m,awaitConfirmation:f})=>{if(!t)throw new Error("Access token is required");if(!e)throw new Error("User ID is required");return Xa(async()=>{let g=await G.api().bearer(t).post(`/cash/v1/users/${e}/cash-account/send`,{idempotencyKey:r,chainId:Ot.Mainnet,signedTransaction:eu.encode(yg(o)?o.serialize():o.serialize({requireAllSignatures:!1,verifySignatures:!1})),encoding:Cm.Base58,skipActivityRecording:n,skipNotification:s,...c&&{cashQuoteSignerSignature:c},...p&&{swapInfo:p},...d&&{perpsInfo:d},...m!==void 0&&{skipPreflight:m},...f!==void 0&&{awaitConfirmation:f}}),w=YP.safeParse(g.data);if(!w.success)throw new Error("Failed to parse transaction response");return w.data},()=>!0,XP,JP)},"broadcastTransaction");var ev=8,tv=j({seconds:1.5}),rv=i(t=>{switch(t){case Qe.Failed:case Qe.Canceled:case Qe.Completed:case Qe.Processing:case Qe.Refunded:return!0;case Qe.Pending:case Qe.Unknown:return!1}},"isTerminalState"),ov=i(t=>{switch(t){case Qe.Completed:case Qe.Processing:case Qe.Refunded:return!0;case Qe.Failed:case Qe.Canceled:case Qe.Pending:case Qe.Unknown:return!1}},"isSuccessTerminalState");var Yi=i(async({unsignedTransaction:t,vaultProxy:e,accountIdentifier:r,signerAddress:o,idempotencyKey:n,isCash:s=!0,accessToken:c,userID:p,skipActivityRecording:d,skipNotification:m,cashQuoteSignerSignature:f,swapInfo:g,perpsInfo:w,skipPreflight:y,awaitConfirmation:S})=>{let b;typeof t=="string"?b=It(t,"bs58"):b=t,s&&await e.updateCashAccountMapping(o);let T=s&&await nv(e,o);k.addBreadcrumb(v.Cash,"Signing transaction ...",D.Info),k.addBreadcrumb(v.Cash,`Using vault proxy signing (isCash: ${s}, isCashKMS: ${T})`,D.Info);let A;s&&T?A={isCash:s,isCashKMS:T,cashAccountAddress:o,data:{chainType:se.Solana,signingType:"transaction",message:new Uint8Array($a(b))}}:s?A={isCash:s,data:{chainType:se.Solana,signingType:"transaction",message:new Uint8Array($a(b))}}:A={chainType:se.Solana,signingType:"transaction",message:new Uint8Array($a(b))};let E=await e.sign(r,A);if(E.status==="error")throw new Error(E.message);let{signature:I}=E;if(!I)throw new Error("Failed to sign transaction: No signature returned");b.addSignature(new pe.PublicKey(o),eu.decode(I));let P=b;if(k.addBreadcrumb(v.Cash,"Signed transaction",D.Info),!Mr("kill-cash-out-tx-simulation")){k.addBreadcrumb(v.Cash,"Simulating transaction before broadcast...",D.Info);try{let _={type:"transaction",userAccount:o,params:{transactions:[t],method:"signAndSendTransaction"},url:"https://phantom.com",networkID:Ot.Mainnet,context:"swap"},H=await pn("en","deviceId",_);if(H.error){let Q=new Error(`Simulation error: ${H.error}`);throw k.addBreadcrumb(v.Cash,`Simulation failed: ${H.error}`,D.Error),Q}k.addBreadcrumb(v.Cash,"Simulation passed",D.Info)}catch(_){throw k.captureError(_,v.Cash),_}}k.addBreadcrumb(v.Cash,"Broadcasting transaction ...",D.Info);let{activityId:U,transactionId:O}=await ab({accessToken:c,userID:p,idempotencyKey:n,signedTransaction:P,skipActivityRecording:d,skipNotification:m,cashQuoteSignerSignature:f,swapInfo:g,perpsInfo:w,skipPreflight:y,awaitConfirmation:S});k.addBreadcrumb(v.Cash,"Polling for cash activity...",D.Info);try{await Xa(async()=>{let _=await ib({userID:p,activityId:U,accessToken:c});if(rv(_.state)){if(ov(_.state))return k.addBreadcrumb(v.Cash,`Activity reached success terminal state: ${_.state}`,D.Info),_;{let H=`Activity reached failed terminal state: ${_.state}.`;throw k.addBreadcrumb(v.Cash,H,D.Info),new Error(H)}}else throw new Error(`Activity state is ${_.state}, waiting for a terminal state.`)},_=>_ instanceof Zi||!!(_ instanceof Error&&_.message.includes("waiting for")),ev,tv,!0)}catch(_){throw k.addBreadcrumb(v.Cash,`Failed to poll for cash activity: ${_}`,D.Error),new Error(`Transaction broadcast succeeded but activity confirmation failed: ${_}`)}return k.addBreadcrumb(v.Cash,"Broadcasted transaction",D.Info),O},"signAndBroadcastTransaction");async function nv(t,e){try{k.addBreadcrumb(v.Cash,"Fetching Cash KMS account...",D.Info);let o=(await t.getCashKMSAccount({cashAccountAddress:e})).account.address;return e!==o&&k.addBreadcrumb(v.Cash,"Cash-KMS account mismatch",D.Error,{cashAddress:e?.slice(0,5),kmsAddress:o?.slice(0,5)}),e===o}catch{return k.addBreadcrumb(v.Cash,"Unable to get Cash-KMS account.",D.Error),!1}}i(nv,"isCashKMSEnabled");u();l();var sv=a.object({activityId:a.string()}),km=i(async({accessToken:t,userID:e,idempotencyKey:r,swapInfo:o,chainId:n,signedTransaction:s,encoding:c,onchainTxId:p,failureReason:d,skipActivityRecording:m,skipNotification:f,occurredAt:g})=>{if(Mr("kill-cash-swap-listener"))return;if(!t)throw new Error("Access token is required");if(!e)throw new Error("User ID is required");let y=await G.api().bearer(t).post(`/cash/v1/users/${e}/cash-account/transaction/failed`,{idempotencyKey:r,swapInfo:o,...n&&{chainId:n},...s&&{signedTransaction:s},...c&&{encoding:c},...p&&{onchainTxId:p},...d&&{failureReason:d},...m!==void 0&&{skipActivityRecording:m},...f!==void 0&&{skipNotification:f},...g&&{occurredAt:g}}),S=sv.safeParse(y.data);if(!S.success)throw new Error("Failed to parse record failed swap response");return S.data},"recordFailedCashSwap");u();l();var Xi=i((t,e)=>!t||!e?{}:{sellAmount:e.sellAmount,buyAmount:e.buyAmount,sellToken:t.sell.data.symbol||"unknown",buyToken:t.buy.data.symbol||"unknown"},"swapTelemetryMetadata"),tu=class{static{i(this,"CashSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;connection;authRepository;cashAccount;constructor(e,r,o,n,s,c,p,d){this.executingQuote=e,this.takerAddress=r,this.networkId=o,this.quote=n,this.executionId=s,this.connection=c,this.authRepository=p,this.cashAccount=d}async createTransaction(){k.addBreadcrumb(v.Cash,"Creating cash swap transaction",D.Info,Xi(this.executingQuote,this.quote));try{return await XS({quote:this.quote,connection:this.connection})}catch(e){throw k.addBreadcrumb(v.Cash,"Failed to create cash swap transaction",D.Error,Xi(this.executingQuote,this.quote)),e}}async swap(e,r,o,n,s){k.addBreadcrumb(v.Cash,"Starting cash swap",D.Info,Xi(this.executingQuote,this.quote));let c=r.transactions[0],p=It(c,"bs58"),d=Tg(p),m=p.message.header.numRequiredSignatures,f=d.slice(0,m),g=this.cashAccount?.addressDetails.address;if(!g)throw new Error("Cash account address not found");let w=f[0]?.toBase58(),y=w===this.takerAddress?"taker address":w===g?"cash account address":null;y&&k.addBreadcrumb(v.Cash,`Fee payer is ${y}`,D.Info,Xi(this.executingQuote,this.quote));let S=f.some(P=>P.toBase58()===g),b=S?g:this.takerAddress,T=await this.authRepository?.getUser();if(!T)throw new Error("User not found for swap");let{accessToken:A,userID:E}=T,I=this.getSwapInfo(this.executingQuote,this.quote);try{return{id:await Yi({unsignedTransaction:c,vaultProxy:n,accountIdentifier:e,signerAddress:b,idempotencyKey:this.executionId,isCash:S,accessToken:A,userID:E,skipActivityRecording:!1,skipNotification:!0,cashQuoteSignerSignature:this.quote.cashQuoteSignerSignature,swapInfo:I,waitForActivityState:Qe.Completed}),networkID:this.networkId}}catch(P){throw k.addBreadcrumb(v.Cash,"Swap failed",D.Error,Xi(this.executingQuote,this.quote)),P}}async waitForConfirmation(e){}parsePendingActivity(e,r){let o=De(Me(e.quote));return Fr({swapTransactions:r,sellFungible:e.sell,buyFungible:e.buy,fungibles:[],currentQuote:e.quote,provider:o,t:R.t})}getSwapInfo(e,r){let o=e.sell,n=e.buy,s=e.quoteInput,c=o.data.walletAddress,p=n.data.walletAddress;if(!c&&s?.taker){let d=We(s?.taker);d.resourceType===V.address&&(c=d.address)}if(!p&&s?.takerDestination){let d=We(s?.takerDestination);d.resourceType===V.address&&(p=d.address)}return{type:mn.Swap,input:{owner:c,mint:o.data.tokenAddress??"",amount:r.sellAmount,symbol:o.data.symbol??void 0,name:o.data.name??void 0,decimals:o.data.decimals,logoUri:o.data.logoUri??void 0},output:{owner:p,mint:n.data.tokenAddress??"",amount:r.buyAmount,symbol:n.data.symbol??void 0,name:n.data.name??void 0,decimals:n.data.decimals,logoUri:n.data.logoUri??void 0},quoteId:r.rfqProps?.quoteId,quoteSource:Me(r).map(d=>d.name).join(",")}}};u();l();var ru=class{static{i(this,"EvmBridgeSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;evmSwapCommand;constructor(e,r,o,n,s,c){this.executingQuote=e,this.takerAddress=r,this.networkId=o,this.quote=n,this.executionId=s,this.evmSwapCommand=c}createTransaction(){return Gi({networkId:this.networkId,callerAddress:this.takerAddress,quote:this.quote})}async swap(e,r,o,n,s){return this.evmSwapCommand.swap(e,r,o,n,s)}async waitForConfirmation(e){return this.evmSwapCommand.waitForConfirmation(e)}};u();l();u();l();var iv=1.3,av=i(t=>{switch(t){case oe.Ethereum.Mainnet:case oe.Ethereum.Sepolia:return 8e5;case oe.Polygon.Mainnet:case oe.Polygon.Amoy:return 5e5;case oe.Base.Mainnet:case oe.Base.Sepolia:return 5e5;case oe.Arbitrum.Mainnet:case oe.Arbitrum.Sepolia:return 5e5;case oe.Hyperevm.Mainnet:case oe.Hyperevm.Testnet:return 5e5;case oe.Monad.Mainnet:case oe.Monad.Testnet:return 5e5;default:return 0}},"getDefaultBridgeGasLimit"),cv=i(t=>{switch(t){case oe.Ethereum.Mainnet:case oe.Ethereum.Sepolia:return 6e4;case oe.Polygon.Mainnet:case oe.Polygon.Amoy:return 6e4;case oe.Base.Mainnet:case oe.Base.Sepolia:return 6e4;case oe.Arbitrum.Mainnet:case oe.Arbitrum.Sepolia:return 6e4;case oe.Hyperevm.Mainnet:case oe.Hyperevm.Testnet:return 6e4;case oe.Monad.Mainnet:case oe.Monad.Testnet:return 6e4;default:return 0}},"getDefaultApprovalGasLimit"),uv=i((t,e)=>t.steps.flatMap(r=>r.gasCosts??[av(e)]),"getBridgeGasLimit"),lv=i((t,e,r)=>{let o=Ir(e)?[e.gas]:uv(e,r);return t?t.transactionTypes.map(n=>n.includes("approval")?cv(r):o.shift()??0):o},"getQuoteGasLimit"),fs={estimateGas:i(({swapTransactions:t,evmGasEstimation:e,currentQuote:r,scanResult:o,networkID:n,includeGasBuffer:s,gasBuffer:c})=>{let{maxFeePerGas:p,maxPriorityFeePerGas:d}=e,m=lv(t,r,n),f=o?.advancedDetails?.gas;return o?.advancedDetails?.gasLimit>0&&(m=f),m.map(w=>({maxFeePerGas:p,maxPriorityFeePerGas:d,networkID:n,gasLimit:new x(w).multipliedBy(s?c??iv:1).integerValue(x.ROUND_CEIL)}))},"estimateGas")};u();l();var pv=i(({networkID:t,unsignedTransaction:e,pendingActivityRows:r,accountIdentifier:o,accountSigner:n,storage:s,includeCallPayload:c})=>({accountSigner:n,accountIdentifier:o,networkID:t,unsignedTransaction:e,...c&&{callPayload:{from:e.from,to:e.to,data:e.data,value:e.value}},pendingTransactionInput:{ownerAddress:e.from,networkID:t,data:{nonce:"",unsignedTransaction:e,hash:""},type:dt.Swap,display:{summary:r}},storage:s}),"buildArgs"),ou=i(async({transactions:t,transactionTypes:e,networkID:r,gasEstimation:o,pendingApprovalActivityRows:n,pendingSwapActivityRows:s,accountIdentifier:c,accountSigner:p,storage:d})=>{let m=!0,f="";for(let[g,w]of t.entries()){let y=o[g],S={gas:`0x${y.gasLimit.toString(16)}`,maxFeePerGas:`0x${y.maxFeePerGas.toString(16)}`,maxPriorityFeePerGas:`0x${y.maxPriorityFeePerGas.toString(16)}`},b=Kn.parse({...w,...S}),A=e[g].includes("approval")?n:s,E=pv({networkID:r,accountIdentifier:c,pendingActivityRows:A.shift(),accountSigner:p,storage:d,unsignedTransaction:b,includeCallPayload:m});try{f="",f=await By(E)}catch(I){return{signature:f,error:I instanceof Error?I:new Error("Failed to process EVM swap transaction")}}m&&(m=!1)}return{signature:f}},"swapTransactionEvm");var cb=Lo.standard,nu=class{static{i(this,"EvmSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;gasEstimation;constructor(e,r,o,n,s,c){this.executingQuote=e,this.takerAddress=r,this.networkId=o,this.quote=n,this.executionId=s,this.gasEstimation=c}createTransaction(){return $i({quote:this.quote,callerAddress:this.takerAddress,networkId:this.networkId,sellFungible:this.executingQuote.sell})}async swap(e,r,o,n,s){let c=this.gasEstimation??await this.estimateGas(this.quote,this.executingQuote.response,cb,r,o);if(!c)throw new Error(`No gas estimation found for ${cb}`);let p=this.parsePendingActivity(this.executingQuote,r),{signature:d,error:m}=await k.startSpan("Process EVM Swap Txns",()=>ou({transactions:r.transactions,transactionTypes:r.transactionTypes,networkID:this.networkId,gasEstimation:c,pendingSwapActivityRows:p.pendingSwapActivityRows,pendingApprovalActivityRows:p.pendingApprovalActivityRows,accountIdentifier:e,accountSigner:n,storage:s}));if(m)throw m;return{networkID:this.networkId,id:d}}async waitForConfirmation(e){await Ty(e.networkID,e.id)}async estimateGas(e,r,o,n,s){let c=await Jn(this.networkId,!0);if(!c)return;let p=c[o];if(!p)return;let d={networkID:this.networkId,gasLimit:new K(1),maxFeePerGas:p.maxFeePerGas,maxPriorityFeePerGas:p.maxPriorityFeePerGas};return fs.estimateGas({swapTransactions:n,evmGasEstimation:d,currentQuote:e,scanResult:s??void 0,includeGasBuffer:!0,networkID:this.networkId,gasBuffer:r.gasBuffer})}parsePendingActivity(e,r){let o=De(Me(e.quote));return Fr({swapTransactions:r,sellFungible:e.sell,buyFungible:e.buy,fungibles:[],currentQuote:e.quote,provider:o,t:R.t})}};u();l();var ub=N(fg());u();l();u();l();var dv=i(({networkID:t,transaction:e,feePayer:r,connection:o,pendingActivityRows:n,accountIdentifier:s,accountSigner:c,storage:p})=>({accountSigner:c,accountIdentifier:s,transaction:e,feePayer:r,connection:o,opts:{skipPreflight:!0},pendingTransactionInput:{ownerAddress:r.toBase58(),networkID:t,data:{signature:""},type:dt.Swap,display:{summary:n}},storage:p}),"buildArgs"),su=i(async({callerAddress:t,connection:e,networkID:r,transactions:o,pendingSwapActivityRows:n,accountIdentifier:s,accountSigner:c,storage:p})=>{let d=new pe.PublicKey(t),m="";for(let[f,g]of o.entries()){let w=It(g,"bs58"),y=dv({networkID:r,transaction:w,feePayer:d,connection:e,pendingActivityRows:n[f],accountIdentifier:s,accountSigner:c,storage:p});try{m="",m=await ts(y),f!==o.length-1&&await Uo({connection:e,signature:m})}catch(S){return{signature:m??"",error:S instanceof Error?S:new Error("Failed to process solana swap transaction")}}}return{signature:m??""}},"swapTransactionSolana");var Hr=class{static{i(this,"SolanaSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;connection;constructor(e,r,o,n,s,c){this.executingQuote=e,this.takerAddress=r,this.networkId=o,this.quote=n,this.executionId=s,this.connection=c}async createTransaction(){return ps({quote:this.quote,connection:this.connection})}async swap(e,r,o,n,s){let c=this.parsePendingActivity(this.executingQuote,r),{signature:p,error:d}=await su({callerAddress:this.takerAddress,connection:this.connection,networkID:this.networkId,transactions:r.transactions,pendingSwapActivityRows:c.pendingSwapActivityRows,accountIdentifier:e,accountSigner:n,storage:s});if(d)throw d;return{networkID:this.networkId,id:p}}async waitForConfirmation(e){let r=Mo(e.networkID);await Uo({connection:r,signature:e.id})}parsePendingActivity(e,r){let o=De(Me(e.quote));return Fr({swapTransactions:r,sellFungible:e.sell,buyFungible:e.buy,fungibles:[],currentQuote:e.quote,provider:o,t:R.t})}};var mv=a.object({signature:a.string()}),iu=class extends Hr{static{i(this,"GaslessSolanaSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;connection;gaslessSignature;constructor(e,r,o,n,s,c,p){super(e,r,o,n,s,c),this.executingQuote=e,this.takerAddress=r,this.networkId=o,this.quote=n,this.executionId=s,this.connection=c,this.gaslessSignature=p}async swap(e,r,o,n,s){let c=this.quote.transactionData[0];if(!c)throw new Error("No transaction data found in quote");let p=new pe.PublicKey(this.takerAddress),m=this.parsePendingActivity(this.executingQuote,r).pendingSwapActivityRows[0];if(!m)throw new Error("Unable to create pending activity for gasless");let f=await uc({accountIdentifier:e,feePayer:p,connection:this.connection,accountSigner:n,transaction:It(c,"bs58"),pendingTransactionInput:{ownerAddress:p.toBase58(),networkID:this.networkId,data:{signature:this.gaslessSignature},type:dt.Swap,display:{summary:m}},storage:s,opts:{}});return{id:(await this.submitGaslessSwap(this.gaslessSignature,f)).signature,networkID:this.networkId}}async submitGaslessSwap(e,r){let o=await G.api().post("/gasless-swap/v1/submit",{quoteSignature:e,encoding:"bs58",chainId:this.networkId,transaction:ub.default.encode(r.serialize())}),n=mv.safeParse(o.data);if(!n.success)throw new Error("Failed to submit gasless swap");return n.data}};u();l();var fv=a.object({quoteId:a.string(),transactionId:a.string()}),au=class extends Hr{static{i(this,"RFQSolanaSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;connection;constructor(e,r,o,n,s,c){super(e,r,o,n,s,c),this.executingQuote=e,this.takerAddress=r,this.networkId=o,this.quote=n,this.executionId=s,this.connection=c}async swap(e,r,o,n,s){let c=this.quote.transactionData[0];if(!c)throw new Error("No transaction data found in quote");let p=new pe.PublicKey(this.takerAddress),m=this.parsePendingActivity(this.executingQuote,r).pendingSwapActivityRows[0];if(!m)throw new Error("Unable to create pending activity for rfq");let f=await uc({accountIdentifier:e,feePayer:p,connection:this.connection,accountSigner:n,transaction:It(c,"bs58"),pendingTransactionInput:{ownerAddress:p.toBase58(),networkID:this.networkId,data:{signature:""},type:dt.Swap,display:{summary:m}},storage:s,opts:{}});return{id:(await this.submitRFQSwap(f)).transactionId,networkID:this.networkId}}async submitRFQSwap(e){let r=Buffer.from(e.serialize()).toString("base64"),o=await G.api().post("/v0/rfq/swap",{chainId:this.networkId,quoteId:this.quote.rfqProps?.quoteId,signedPayload:r},{headers:{"X-Request-Id":this.executionId}}),n=fv.safeParse(o.data);if(!n.success)throw new Error("Failed to submit rfq swap");return n.data}};u();l();var cu=class{static{i(this,"SolanaBridgeSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;connection;solanaSwapCommand;constructor(e,r,o,n,s,c){this.executingQuote=e,this.takerAddress=r,this.networkId=o,this.quote=n,this.executionId=s,this.connection=c,this.solanaSwapCommand=new Hr(e,r,o,e.quote,s,c)}createTransaction(){return Ki({quote:this.quote,connection:this.connection})}async swap(e,r,o,n,s){return this.solanaSwapCommand.swap(e,r,o,n,s)}async waitForConfirmation(e){return this.solanaSwapCommand.waitForConfirmation(e)}};u();l();u();l();u();l();var hv=i(({networkID:t,transaction:e,feePayer:r,pendingActivityRows:o,accountIdentifier:n,accountSigner:s,storage:c})=>({accountSigner:s,accountIdentifier:n,transaction:e,pendingTransactionInput:{ownerAddress:r,networkID:t,data:{digest:""},type:dt.Swap,display:{summary:o}},storage:c}),"buildArgs"),uu=i(async({callerAddress:t,networkID:e,transactions:r,pendingSwapActivityRows:o,accountIdentifier:n,accountSigner:s,storage:c})=>{let p="";for(let[d,m]of r.entries()){let f=hv({networkID:e,transaction:ac.deserializeTransactionString(m),feePayer:t,pendingActivityRows:o[d],accountIdentifier:n,accountSigner:s,storage:c});try{p=(await Ly(f)).digest,d!==r.length-1&&await cc(e,p)}catch(g){return{signature:p??"",error:g instanceof Error?g:new Error("Failed to process sui swap transaction")}}}return{signature:p??""}},"swapTransactionSui");var hs=class{static{i(this,"SuiSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;constructor(e,r,o,n,s){this.executingQuote=e,this.takerAddress=r,this.networkId=o,this.quote=n,this.executionId=s}async createTransaction(){return Vi({quote:this.quote})}async swap(e,r,o,n,s){let c=this.parsePendingActivity(this.executingQuote,r),{signature:p,error:d}=await uu({callerAddress:this.takerAddress,networkID:this.networkId,transactions:r.transactions,pendingSwapActivityRows:c.pendingSwapActivityRows,accountIdentifier:e,accountSigner:n,storage:s});if(d)throw d;return{networkID:this.networkId,id:p}}async waitForConfirmation(e){await cc(this.networkId,e.id)}parsePendingActivity(e,r){let o=De(Me(e.quote));return Fr({swapTransactions:r,sellFungible:e.sell,buyFungible:e.buy,fungibles:[],currentQuote:e.quote,provider:o,t:R.t})}};var lu=class{static{i(this,"SuiBridgeSwapCommand")}executingQuote;takerAddress;networkId;quote;executionId;suiSwapCommand;constructor(e,r,o,n,s){this.executingQuote=e,this.takerAddress=r,this.networkId=o,this.quote=n,this.executionId=s,this.suiSwapCommand=new hs(e,r,o,e.quote,s)}async createTransaction(){return ji({quote:this.quote})}async swap(e,r,o,n,s){return this.suiSwapCommand.swap(e,r,o,n,s)}async waitForConfirmation(e){return this.suiSwapCommand.waitForConfirmation(e)}};var pu=class{static{i(this,"WalletSwapCommandFactory")}bridgeStatusManager;constructor(e){this.bridgeStatusManager=e}create(e,r,o,n,s,c,p){if(IS(e.quote)&&(Le(e.buy)||Le(e.sell)))return new tu(e,r,o,e.quote,Oe(),n,s,c);if(C.isSolanaNetworkID(o)&&Ht(e.quote)){let d=new Hr(e,r,o,e.quote,Oe(),n);return e.quote.rfqProps?new au(e,r,o,e.quote,Oe(),n):e.quote.gaslessSignature?new iu(e,r,o,e.quote,Oe(),n,e.quote.gaslessSignature):d}else{if(C.isEVMNetworkID(o)&&Ir(e.quote))return this.createEvmSwapCommand(e,r,o,p);if(C.isSuiNetworkID(o)&&io(e.quote))return new hs(e,r,o,e.quote,Oe());if(le(e.quote)){if(C.isSolanaNetworkID(o))return this.wrapBridgeTrackingCommand(new cu(e,r,o,e.quote,Oe(),n),e);if(C.isEVMNetworkID(o)){let d=this.createEvmSwapCommand(e,r,o,p);return this.wrapBridgeTrackingCommand(new ru(e,r,o,e.quote,Oe(),d),e)}else{if(C.isSuiNetworkID(o))return this.wrapBridgeTrackingCommand(new lu(e,r,o,e.quote,Oe()),e);if(C.isBitcoinNetworkID(o))return this.wrapBridgeTrackingCommand(new Jc(e,r,o,e.quote,Oe()),e)}}}throw new Error("Unsupported SwapQuote}")}createEvmSwapCommand(e,r,o,n){let s=n?n.filter(sc):void 0;return s&&s.length===0&&(s=void 0),new nu(e,r,o,e.quote,Oe(),s)}wrapBridgeTrackingCommand(e,r){return!this.bridgeStatusManager||!le(r.quote)?e:new $c(e,this.bridgeStatusManager,r)}};u();l();u();l();var Ji={name:"SwapperNoQuotes",message:"No quotes found"},gs=class extends jy{static{i(this,"SwapperQuoteStreamEventProducer")}createStreamUrl({amount:e,amountUsd:r,buy:o,sell:n,taker:s,takerDestination:c,slippageTolerance:p,exactOut:d,autoSlippage:m,priorityFee:f,tipAmount:g,isLedger:w,phantomCashAccount:y,isPrediction:S,predictions:b}){let T=new URLSearchParams({taker:s,takerDestination:c,buyToken:L(X(o)),sellToken:L(X(n)),sellAmount:e,sellAmountUsd:r??"",exactOut:d?"true":"false",autoSlippage:m?"true":"false",clientEnableGaslessSwap:"true",phantomCashAccount:y?"true":"false"});return p&&T.set("slippageTolerance",String(p)),f&&T.set("priorityFee",String(f)),g&&T.set("tipAmount",String(g)),w!==void 0&&T.set("isLedger",String(w)),S&&T.set("isPrediction","true"),b&&(T.set("predictionsPlatform",b.platform),T.set("predictionsMintAddress",b.mintAddress),T.set("predictionsTokenPerspective",b.tokenPerspective)),`${this.getApiEnvironment()}/swap/v2/stream/quotes?${T.toString()}`}handleNewQuoteResponse(e,r){let o=this.safeJsonParse(e);if(!o.success||!o.data){r({type:"error",errorResponse:Ji});return}try{let n=this.parseSwapQuotesResponse(o.data);r({type:"newQuoteResponse",quoteResponse:n})}catch{r({type:"error",errorResponse:Ji})}}handleErrorQuoteResponse(e,r){let o=this.safeJsonParse(e);if(!o.success||!o.data){r({type:"error",errorResponse:Ji});return}try{let n=Cc.safeParse(o.data);r({type:"error",errorResponse:n.success?n.data:Ji})}catch{r({type:"error",errorResponse:Ji})}}parseSwapQuotesResponse(e){let r=new tt({key:"SwapperNoQuotes"});if(Bi.safeParse(e?.type).success===!1)throw k.captureError(new Error("Failed to parse a valid quote type."),v.Swapper),new Error("Invalid input");let o=Ni.safeParse(e);if(!o.success)throw k.captureError(new Error("Failed to parse a valid swap quotes response."),v.Swapper),r;if(o.data.includesAllProviders&&o.data.quotes.length===0)throw r;return o.data}};var du=class extends gs{static{i(this,"EventStreamQuoteStreamProducer")}eventSource;open(e,r){this.close();let o=this.createStreamUrl(e);this.eventSource=new gc(o,this.getOptionsWithAuth(o));let n=i(s=>{switch(s.type){case"new-quote-response":this.handleNewQuoteResponse(s.data,r);break;case"error-quote-response":this.handleErrorQuoteResponse(s.data,r);break;case"open":r({type:"open"});break;case"error":r({type:"error",errorResponse:{name:"UnknownError",message:s.message}});break;case"close":r({type:"close"});break}},"eventSourceListener");this.eventSource.addEventListener("new-quote-response",n),this.eventSource.addEventListener("error-quote-response",n),this.eventSource.addEventListener("open",n),this.eventSource.addEventListener("error",n),this.eventSource.addEventListener("close",n)}close(){this.eventSource&&(this.eventSource.removeAllEventListeners(),this.eventSource.close())}};u();l();var mu=class extends gs{static{i(this,"NativeEventStreamQuoteStreamProducer")}eventSource;open(e,r){this.close();let o=this.createStreamUrl(e);this.eventSource=new gc(o,this.getOptionsWithAuth(o));let n=i(s=>{switch(s.type){case"new-quote-response":this.handleNewQuoteResponse(s.data,r);break;case"error-quote-response":this.handleErrorQuoteResponse(s.data,r);break;case"open":r({type:"open"});break;case"error":r({type:"error",errorResponse:{name:"UnknownError",message:s.message}});break;case"close":r({type:"close"});break}},"eventSourceListener");this.eventSource.addEventListener("new-quote-response",n),this.eventSource.addEventListener("error-quote-response",n),this.eventSource.addEventListener("open",n),this.eventSource.addEventListener("error",n),this.eventSource.addEventListener("close",n)}close(){this.eventSource&&(this.eventSource.removeAllEventListeners(),this.eventSource.close())}};u();l();var fu=class{static{i(this,"QuoteStreamer")}producer;listeners=new Set;constructor(e){this.producer=e}openStream(e){this.listeners.forEach(r=>r.onEvent({type:"openRequested"})),this.producer.close(),this.producer.open(e,r=>{this.listeners.forEach(o=>o.onEvent(r)),r.type==="error"&&this.closeStream()})}closeStream(){this.producer.close()}subscribe(e){this.listeners.add(e)}unsubscribe(e){this.listeners.delete(e)}};u();l();u();l();function lb(t){return t<3e5?1e4:t<6e5?15e3:3e4}i(lb,"getBridgeStatusPollInterval");function gv(t){let e="pending";switch(t.status){case"DONE":e="completed";break;case"FAILED":e="failed";break;case"PENDING":case"NOT_FOUND":default:e="pending";break}return{state:e,rawStatus:t.status,updatedAt:Date.now(),fromAddress:t.fromAddress,toAddress:t.toAddress}}i(gv,"normalizeSwapperStatus");var Im=class{static{i(this,"BridgeStatusPoller")}args;timeoutId=null;isActive=!1;client;constructor(e){this.args=e,this.client=e.client}start(){this.isActive||(this.isActive=!0,this.scheduleNext(0))}stop(){this.isActive=!1,this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}scheduleNext(e){this.isActive&&(this.timeoutId=setTimeout(()=>{this.poll()},e))}async poll(){if(this.isActive)try{let e=await this.client.fetchStatus(this.args.record.transactionHash),r=gv(e),o;switch(r.state){case"completed":o={type:"completed",status:r},this.stop();break;case"failed":o={type:"failed",status:r},this.stop();break;case"pending":default:{o={type:"pending",status:r};let n=Date.now()-this.args.record.startedAt;this.scheduleNext(lb(n));break}}this.args.onEvent(o)}catch(e){this.args.onEvent({type:"error",error:e});let r=Date.now()-this.args.record.startedAt;this.scheduleNext(lb(r))}}};function pb(t){return new Im(t)}i(pb,"createBridgeStatusPoller");u();l();var yv=a.object({status:a.string(),sending:a.object({txHash:a.string().optional()}).optional(),receiving:a.object({txHash:a.string().optional()}).optional(),fromAddress:a.string().optional(),toAddress:a.string().optional()}).passthrough(),hu=class{static{i(this,"SwapperStatusClient")}async fetchStatus(e){let r=await G.api().get("/swap/v2/status/lifi",{params:{txHash:e}}),o=r?.data??r,n=yv.safeParse(o);if(!n.success)throw new Error("Unable to parse bridge status response");return n.data}};u();l();var Fm="sdk.bridgeStatus.pending";var Pm=class{static{i(this,"BridgeStatusManager")}storage;client;createPoller;records=new Map;pollers=new Map;listeners=new Set;hydratePromise;constructor(e,r={}){this.storage=e,this.client=r.client??new hu,this.createPoller=r.createPoller??pb}async initialize(){this.hydratePromise||(this.hydratePromise=this.hydrate()),await this.hydratePromise}destroy(){this.pollers.forEach(e=>e.stop()),this.pollers.clear(),this.records.clear()}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}getPendingRecords(){return Array.from(this.records.values())}getPendingActivityRows(e,r){return this.getPendingBridgeActivities(e,r).map(o=>o.row)}getPendingBridgeActivities(e,r){return this.filterRecordsByAddresses(r?.addresses).map(n=>({record:n,row:hb(n,e)}))}getPendingBridgeTransactions(e,r){return this.filterRecordsByAddresses(r?.addresses).map(n=>db(n,e))}getPendingBridgeTransactionById(e,r){let o=this.records.get(e);if(o)return db(o,r)}isPendingBridgeTransaction(e){return this.records.has(e)}async track(e){if(await this.initialize(),!this.shouldTrackQuote(e.executingQuote))return;let r=wv(e.executingQuote),o=this.records.get(e.executionId),n={executionId:e.executionId,transactionHash:e.transactionHash,startedAt:o?.startedAt??Date.now(),quote:r,status:o?.status};this.records.set(e.executionId,n),this.restartPoller(n),await this.persistRecords()}async hydrate(){try{let e=await this.storage.get(Fm)??"[]",r=JSON.parse(e);for(let o of r){let n=this.normalizePersistedRecord(o);n&&(this.records.set(n.executionId,n),this.startPoller(n))}}catch(e){console.error("Failed to hydrate bridge status records",e)}}shouldTrackQuote(e){if(!le(e.quote))return!1;let r=e.sell?.data?.chain?.id,o=e.buy?.data?.chain?.id;return o&&C.isBitcoinNetworkID(o)||r&&C.isBitcoinNetworkID(r)||!1}startPoller(e){let r=this.createPoller({record:e,client:this.client,onEvent:i(o=>this.handlePollerEvent(e.executionId,o),"onEvent")});this.pollers.set(e.executionId,r),r.start()}restartPoller(e){this.stopPoller(e.executionId),this.startPoller(e)}stopPoller(e){let r=this.pollers.get(e);r&&(r.stop(),this.pollers.delete(e))}async persistRecords(){try{let e=Array.from(this.records.values()).map(r=>({executionId:r.executionId,transactionHash:r.transactionHash,startedAt:r.startedAt,quote:r.quote,status:r.status}));await this.storage.set(Fm,JSON.stringify(e))}catch(e){console.error("Failed to persist bridge status records",e)}}removeRecord(e){this.records.delete(e),this.stopPoller(e),this.persistRecords()}normalizePersistedRecord(e){return"quote"in e&&Sv(e.quote)?e:null}handlePollerEvent(e,r){let o=this.records.get(e);if(o)switch(r.type){case"pending":o.status=r.status,this.notifyListeners({type:"pending",record:o,status:r.status}),this.persistRecords();break;case"completed":o.status=r.status,this.notifyListeners({type:"completed",record:o,status:r.status}),this.removeRecord(e);break;case"failed":o.status=r.status,this.notifyListeners({type:"failed",record:o,status:r.status}),this.removeRecord(e);break;case"error":this.notifyListeners({type:"error",record:o,error:r.error});break}}notifyListeners(e){this.listeners.forEach(r=>{try{r.onBridgeStatusChange(e)}catch(o){console.error("BridgeStatusListener error",o)}})}filterRecordsByAddresses(e){if(!e?.length)return this.getPendingRecords();let r=bv(e);return this.getPendingRecords().filter(o=>o.quote.accountAddresses.some(n=>r.has(fb(n))))}};function wv(t){if(!le(t.quote))throw new Error("Non-bridge quotes cannot be tracked");return{sell:t.sell,buy:t.buy,quote:t.quote,amount:t.amount,accountAddresses:t.account.addresses}}i(wv,"createQuoteSnapshot");function Sv(t){return!!(t&&le(t.quote))}i(Sv,"isValidSnapshot");function bv(t){return new Set(t.map(fb))}i(bv,"createAddressLookup");function fb(t){return`${t.networkID}:${Tv(t.address,t.networkID)}`}i(fb,"createAddressKey");function Tv(t,e){return C.isEVMNetworkID(e)?t.toLowerCase():t}i(Tv,"normalizeAddress");function hb(t,e){let r=t.quote.quote,o=t.quote.sell,n=t.quote.buy,s=Ae(r.sellAmount,o?.data.decimals??0),c=Ae(r.buyAmount,n?.data.decimals??0),p=o?.data.symbol??"",d=n?.data.symbol??"",m=t.startedAt+j({minutes:20}),f=Date.now(),g=m-f,w=Math.max(0,Math.ceil(g/(60*1e3))),y=w>0?`Est. ${w}m`:"Est. <1m";return{topLeft:{text:e("transactionsPendingSwapping")},topRight:{text:`${c} ${d}`,color:"spotPositive"},bottomLeft:{text:y},bottomRight:{text:`${s} ${p}`}}}i(hb,"createPendingBridgeActivityRow");function Av(t,e){if(C.isEVMNetworkID(t))return{nonce:0,transactions:[{hash:e.transactionHash,timestamp:e.startedAt,unsignedTransaction:{},confirmations:0}]};if(C.isBitcoinNetworkID(t))return{txID:e.transactionHash,psbtHex:"",confirmations:0};if(C.isSolanaNetworkID(t))return{signature:e.transactionHash};if(C.isSuiNetworkID(t))return{digest:e.transactionHash};throw new Error(`Unsupported network for bridge transaction: ${t}`)}i(Av,"createBridgePendingTransactionData");function db(t,e){let r=t.quote.sell,o=t.quote.buy,n=r?.data.chain?.id;if(!n)throw new Error("Cannot create pending transaction: missing network ID");let s=hb(t,e),c=t.quote.accountAddresses.find(y=>y.networkID===n)?.address??"",p=o?.data.chain?.id,d=p?t.quote.accountAddresses.find(y=>y.networkID===p)?.address:void 0,m=d?Wn(d,4):"",f=Ae(t.quote.quote.buyAmount,o?.data.decimals??0),g=o?.data.symbol??"",w=`${f} ${g}`;return{id:t.executionId,timestamp:t.startedAt,ownerAddress:c,networkID:n,type:dt.Swap,display:{summary:{topLeft:s.topLeft,topRight:s.topRight,bottomLeft:s.bottomLeft,bottomRight:s.bottomRight},detail:{header:w,assetSymbol:g,uiRecipient:m}},data:Av(n,t)}}i(db,"createPendingTransactionFromBridgeRecord");var gu=null,mb=null;function gb(t){return gu||(gu=new Pm(t)),mb||(mb=gu.initialize()),gu}i(gb,"getBridgeStatusManager");u();l();u();l();var Kt=i((t,e)=>!!t&&!!e&&C.compareNetworkID(t,e)!==0,"isBridgeSwap");u();l();var wu=N(Fg()),yb=N(GI()),Su=N(HI());u();l();u();l();function Jt(t,e,r){if(e.lte(0))return null;let o=L({chainId:t,resourceType:V.nativeToken,slip44:C.getSlip44(t)}),n=C.getTokenDecimals(t),s=C.getTokenSymbol(t);if(!o||!n||!s)return null;let c=e.div(Kg(n)),p=r[o];return p?.usd?c.times(p.usd).toNumber():null}i(Jt,"getFeeInUsd");var xv={"Allbridge's fee":"destinationNetwork","Allbridge Liquidity Fee":"liquidityProvider"};function Ev(t,e){return{type:t,amountUsd:new x(e.amountUSD??0),amount:new x(e.amount??0)}}i(Ev,"bridgeFeeToFee");function Ho(t){return t.steps.flatMap(e=>e.includedFeeCosts).reduce((e,r)=>{if(!r)return e;let o=xv[r.name];return o&&new x(r.amount).gt(0)&&e.push(Ev(o,r)),e},[])}i(Ho,"getIncludedBridgeFees");function Go(t,e,r){let o=t.steps.reduce((n,s)=>n.plus(s.nonIncludedNonGasFees),new x(0));return o.isZero()?[]:[{type:"nonIncludedNonGas",amountUsd:new x(Jt(e,o,r)??0),amount:o}]}i(Go,"getNonIncludedBridgeFees");var yu=class{static{i(this,"BtcProcessBridgeQuoteCommand")}networkID;priceClient;constructor(e,r){this.networkID=e,this.priceClient=r}getNativeTokenCaip19(){return L({chainId:this.networkID,resourceType:V.nativeToken,slip44:C.getSlip44(this.networkID)})}async processQuote(e,r){let o=await this.createSwapTransactions(e),n=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!n.usd)throw new Error("Price data not found");let s=await this.calculateNetworkFee(e,n),c=this.appendBridgeFees([s],e,n),p=this.appendPhantomFee(c,e);return{quote:e,fees:{totalFees:this.sumFees(p),fees:p},swapTransactions:o}}createSwapTransactions(e){let r=[],o=[],n=[];for(let s of e.steps){let{transactionData:c,sellToken:p,buyToken:d}=s;r.push(c),o.push("bridge"),n.push({sellToken:p,buyToken:d})}return Promise.resolve({type:"bitcoin",transactions:r,transactionTypes:o,transactionPairs:n})}appendPhantomFee(e,r){let o=r.steps.flatMap(n=>n.feeCosts).find(n=>n.name==="phantom");return o?[...e,{type:"phantom",percentage:new x(o.percentage),amountUsd:new x(0),amount:new x(0)}]:e}appendBridgeFees(e,r,o){let n={[this.getNativeTokenCaip19()]:o},s=Go(r,this.networkID,n),c=Ho(r);return[...e,...c,...s]}async calculateNetworkFee(e,r){if(!r.usd)throw new Error("Price data not found");let o=e.steps.flatMap(n=>n.gasCosts??[]);if(o.length>0){let n=o.reduce((p,d)=>p+d,0);return{type:"bitcoinNetwork",amountUsd:new x(n).shiftedBy(-8).times(r.usd),amount:new x(n)}}try{let n=e.steps[0];if(!n?.transactionData)throw new Error("No transaction data available for fee estimation");let s=wu.Psbt.fromHex(n.transactionData),c=Cv(s),d=(await Vy(this.networkID))[Lo.standard]?.btcPerKilobyte;if(!d)throw new Error("Failed to get standard fee rate");let f=Ay(d).times(c).integerValue(x.ROUND_UP);return{type:"bitcoinNetwork",amountUsd:f.shiftedBy(-8).times(r.usd),amount:f}}catch{let s=new x(1e4);return{type:"bitcoinNetwork",amountUsd:s.shiftedBy(-8).times(r.usd),amount:s}}}sumFees(e){return e.reduce((r,o)=>r.plus(o.amountUsd),new x(0))}};function Cv(t){let{header:e,perInput:r}=nc[xy(t)],{inputs:o}=t.data,n=new x(e),s=new x(o.length).times(r),c=t.txOutputs.reduce((p,d)=>{let m=Su.decompile(d.script);if(m&&m[0]===Su.OPS.OP_RETURN)return p;let f;if(d.address)f=d.address;else try{f=(0,yb.fromOutputScript)(d.script,wu.networks.bitcoin)}catch{return p.plus(nc[se.BitcoinNativeSegwit].perOutput)}let g=_g(oe.Bitcoin.Mainnet,f);return p.plus(nc[g].perOutput)},new x(0));return n.plus(s).plus(c)}i(Cv,"calculateVirtualBytes");u();l();u();l();var wb=N(z());u();l();var Pe;(function(t){t.SlippageTolerance="slippageTolerance",t.PriorityFee="priorityFee",t.TipAmount="tipAmount",t.LastSubmittedPairs="lastSubmittedPairsV2",t.LastSelectedTokens="lastSelectedTokens",t.SlippageSettings="slippageSettings",t.HasViewedAutoSlippageOptIn="hasViewedAutoSlippageOptIn",t.PriorityFeeSettings="priorityFeeSettings",t.TipSettings="tipSettings"})(Pe||(Pe={}));function Rt({key:t,queryKey:e,defaultValue:r=null}){let o=lt();return te({enabled:!0,queryKey:e,gcTime:jc.Long,staleTime:Vc.Never,async queryFn(){try{return await o.get(t)}catch(n){return n instanceof Error&&k.captureError(n,v.Swapper),r}}})}i(Rt,"useSwapStorageValue");function Dt({key:t,queryKey:e}){let r=lt(),o=Be();return cn({async mutationFn(n){try{return await r.set(t,n)}catch(s){s instanceof Error&&k.captureError(s,v.Swapper);return}},async onMutate(n){await o.cancelQueries({queryKey:e});let s=o.getQueryData(e);return o.setQueryData(e,n),{previousValue:s}},onError(n,s,c){o.setQueryData(e,c?.previousValue)}})}i(Dt,"useSetSwapStorageValue");var fe;(function(t){t.Auto="auto",t.Fixed="fixed"})(fe||(fe={}));var kv={type:fe.Auto},$t=i(()=>{let{slippageSetting:t,isFetched:e,save:r}=Iv();return{isFetched:e,selectedSetting:t??kv,setSlippageSetting:r}},"useSlippageSettings"),Iv=i(()=>{let{data:t,isFetched:e}=Rt({key:Pe.SlippageSettings,queryKey:me.slippageSettings()}),{mutateAsync:r}=Dt({key:Pe.SlippageSettings,queryKey:me.slippageSettings()}),o=(0,wb.useCallback)(async n=>{await r(n)},[r]);return{isFetched:e,slippageSetting:t,save:o}},"useSlippageSettingsStore");u();l();async function ys({transactions:t,locale:e,url:r,deviceId:o,takerAddress:n,networkId:s,slippageType:c,quote:p,quoteResponse:d,isSimulationKilled:m}){try{return m?{status:"skipped",skipReason:"isSimulationKilled"}:C.isHyperevmNetworkID(s)?{status:"skipped",skipReason:"unsupportedNetwork"}:{status:"success",result:await pn(e,o,{type:"transaction",userAccount:n,params:Fv(t),url:r,networkID:s,context:le(p)?"bridge":FS(p)?"gaslessSwap":"swap",provider:Pv(p),slippageType:c,metadata:{swapper:{quoteOutputAmount:p.buyAmount,quoteOutputToken:L(d.buyToken),quoteInputAmount:p.sellAmount,quoteInputToken:L(d.sellToken)}}})}}catch(f){return{status:"error",error:f,skipReason:"simulationError"}}}i(ys,"simulateSwap");var Fv=i(t=>{switch(t.type){case"evm":return{transactions:t.transactions};case"solana":return{transactions:t.transactions,method:"signAndSendTransaction",simulatorConfig:{decodeAccounts:!1}};case"sui":case"bitcoin":return{transactions:t.transactions,method:"signAndSendTransaction"}}},"getScannedTransactionParams"),Pv=i(t=>{let e=le(t)?ms(t):t?.sources??[];return De(e)},"getProvider");var bu=class{static{i(this,"EVMProcessBridgeQuoteCommand")}networkID;account;priceClient;quoteInput;quoteResponse;constructor(e,r,o,n,s){this.networkID=e,this.account=r,this.priceClient=o,this.quoteInput=n,this.quoteResponse=s}getNativeTokenCaip19(){return L({chainId:this.networkID,resourceType:V.nativeToken,slip44:C.getSlip44(this.networkID)})}async processQuote(e,r){let o=await this.createSwapTransactions(e),n=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!n.usd)throw new Error("Price data not found");let s=await this.calculateNetworkFee(o,e,n,r),c=this.appendBridgeFees([s],e,n),p=this.appendPhantomFee(c,e);return{quote:e,fees:{totalFees:this.sumFees(p),fees:p},swapTransactions:o}}createSwapTransactions(e){return Gi({networkId:this.networkID,callerAddress:this.checkChainAddress().address,quote:e})}appendPhantomFee(e,r){let o=r.steps.flatMap(n=>n.feeCosts).find(n=>n.name==="phantom");return o?[...e,{type:"phantom",percentage:new x(o.percentage),amountUsd:new x(0),amount:new x(0)}]:e}appendBridgeFees(e,r,o){let n={[this.getNativeTokenCaip19()]:o},s=Go(r,this.networkID,n),c=Ho(r);return[...e,...c,...s]}async calculateNetworkFee(e,r,o,n){let s=await this.estimateGas(r,e,n);if(!s)throw new Error("Unable to estimate gas");if(!o.usd)throw new Error("Price data not found");let c=s[0],p=C.getTokenDecimals(this.networkID),d=c.gasLimit.times(c.maxFeePerGas);return{type:"evmGas",amountUsd:new x(d).shiftedBy(-p).times(o.usd),amount:d}}async estimateGas(e,r,o){let n=await Jn(this.networkID,!0);if(!n)return;let s=n[Lo.standard];if(!s)return;let c={networkID:this.networkID,gasLimit:new x(1),maxFeePerGas:s.maxFeePerGas,maxPriorityFeePerGas:s.maxPriorityFeePerGas},p=await ys({transactions:r,locale:"en-us",url:"https://phantom.app",deviceId:"123",takerAddress:this.checkChainAddress().address,networkId:this.networkID,slippageType:this.quoteInput.autoSlippage?fe.Auto:fe.Fixed,quote:e,quoteResponse:this.quoteResponse,isSimulationKilled:o});return fs.estimateGas({swapTransactions:r,evmGasEstimation:c,currentQuote:e,scanResult:p.status==="success"?p.result:void 0,includeGasBuffer:!0,networkID:this.networkID,gasBuffer:this.quoteResponse.gasBuffer})}checkChainAddress(){let e=this.account.addresses.find(o=>o.networkID===this.networkID);if(!e)throw new Error(`No address found for chain ${this.networkID}`);let r={...e};return Lr(r)&&(r.address=r.address.toLowerCase()),r}sumFees(e){return e.reduce((r,o)=>r.plus(o.amountUsd),new x(0))}};u();l();var Tu=class{static{i(this,"EVMProcessQuoteCommand")}networkID;account;priceClient;quoteInput;quoteResponse;constructor(e,r,o,n,s){this.networkID=e,this.account=r,this.priceClient=o,this.quoteInput=n,this.quoteResponse=s}getNativeTokenCaip19(){return L({chainId:this.networkID,resourceType:V.nativeToken,slip44:C.getSlip44(this.networkID)})}async processQuote(e,r){let o=await this.createSwapTransactions(e),n=await this.calculateNetworkFee(o,e,r),s=this.appendPhantomFee([n],e);return{quote:e,fees:{totalFees:this.sumFees(s),fees:s},swapTransactions:o}}createSwapTransactions(e){return $i({networkId:this.networkID,callerAddress:this.checkChainAddress().address,quote:e,sellFungible:this.quoteInput.sell})}appendPhantomFee(e,r){let o=r.fees.find(n=>n.type==="phantom");return o?[...e,{type:"phantom",percentage:new x(o.percentage),amountUsd:new x(0),amount:new x(0)}]:e}async calculateNetworkFee(e,r,o){let n=await this.estimateGas(r,e,o);if(!n)throw new Error("Unable to estimate gas");let s=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!s.usd)throw new Error("Price data not found");let c=n[0],p=C.getTokenDecimals(this.networkID),d=c.gasLimit.times(c.maxFeePerGas);return{type:"evmGas",amountUsd:new x(d).shiftedBy(-p).times(s.usd),amount:d}}async estimateGas(e,r,o){let n=await Jn(this.networkID,!0);if(!n)return;let s=n[Lo.standard];if(!s)return;let c={networkID:this.networkID,gasLimit:new x(1),maxFeePerGas:s.maxFeePerGas,maxPriorityFeePerGas:s.maxPriorityFeePerGas},p=await ys({transactions:r,locale:"en-us",url:"https://phantom.app",deviceId:"123",takerAddress:this.checkChainAddress().address,networkId:this.networkID,slippageType:this.quoteInput.autoSlippage?fe.Auto:fe.Fixed,quote:e,quoteResponse:this.quoteResponse,isSimulationKilled:o});return fs.estimateGas({swapTransactions:r,evmGasEstimation:c,currentQuote:e,scanResult:p.status==="success"?p.result:void 0,includeGasBuffer:!0,networkID:this.networkID,gasBuffer:this.quoteResponse.gasBuffer})}checkChainAddress(){let e=this.account.addresses.find(o=>o.networkID===this.networkID);if(!e)throw new Error(`No address found for chain ${this.networkID}`);let r={...e};return Lr(r)&&(r.address=r.address.toLowerCase()),r}sumFees(e){return e.reduce((r,o)=>r.plus(o.amountUsd),new x(0))}};u();l();var Au=class{static{i(this,"SolanaProcessBridgeQuoteCommand")}networkID;priceClient;connection;constructor(e,r,o){this.networkID=e,this.priceClient=r,this.connection=o}getNativeTokenCaip19(){return L({chainId:this.networkID,resourceType:V.nativeToken,slip44:C.getSlip44(this.networkID)})}async processQuote(e,r){let o=await this.createSwapTransactions(e),n=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!n.usd)throw new Error("Price data not found");let s=await this.calculateNetworkFee(o,n),c=this.appendBridgeFees([s],e,n),p=this.appendPhantomFee(c,e);return{quote:e,fees:{totalFees:this.sumFees(p),fees:p},swapTransactions:o}}createSwapTransactions(e){return Ki({quote:e,connection:this.connection})}appendPhantomFee(e,r){let o=r.steps.flatMap(n=>n.feeCosts).find(n=>n.name==="phantom");return o?[...e,{type:"phantom",percentage:new x(o.percentage),amountUsd:new x(0),amount:new x(0)}]:e}appendBridgeFees(e,r,o){let n={[this.getNativeTokenCaip19()]:o},s=Go(r,this.networkID,n),c=Ho(r);return[...e,...c,...s]}async calculateNetworkFee(e,r){if(!r.usd)throw new Error("Price data not found");let o=e.transactions.map(m=>this.processEncodedTx(m,this.networkID,this.connection)),s=(await Promise.all(o)).map(m=>m.networkFeeEstimation.value),c=new x(s[0]);return{type:"solanaNetwork",amountUsd:c.div(new x(pe.LAMPORTS_PER_SOL)).times(r.usd),amount:c}}async processEncodedTx(e,r,o){let n=It(e,"bs58");return await ja(n,o),{networkFeeEstimation:await My(r,[n.message])}}sumFees(e){return e.reduce((r,o)=>r.plus(o.amountUsd),new x(0))}};u();l();u();l();function Sb(t,e){return vv(t.fees,r=>{switch(r.type){case"gasless":return{type:"gasless",amountUsd:new x(0),amount:new x(0),percentage:new x(r.percentage)};case"phantom":return{type:"phantom",percentage:new x(r.percentage),amountUsd:new x(0),amount:new x(0)};case"ata":return new x(r.amount).isZero()?void 0:{type:"ata",amountUsd:new x(r.amount),amount:new x(0)};case"gasless_network":return{type:"solanaGaslessNetwork",amountUsd:new x(r.amount),amount:new x(0)};case"network":{let{amountUsd:o,amount:n}=vm(r,e);return{type:"solanaNetwork",amountUsd:o,amount:n}}case"tips":{let{amountUsd:o,amount:n}=vm(r,e);return{type:"tips",amountUsd:o,amount:n}}case"priority_fee":{let{amountUsd:o,amount:n}=vm(r,e);return{type:"priorityFee",amountUsd:o,amount:n}}case"prediction_fee_per_contract":return{type:"predictionFeePerContract",amountUsd:new x(r.amount),amount:new x(r.amount)};default:return}})}i(Sb,"parseFees");function vm(t,e){let r=new x(t.amount);return{amountUsd:r.div(new x(pe.LAMPORTS_PER_SOL)).times(e),amount:r}}i(vm,"getAmountsFromNativeAmount");function vv(t,e){return t.reduce((r,o,n)=>{let s=e(o,n,t);return s!=null&&r.push(s),r},[])}i(vv,"compactMap");var bb=["solanaNetwork","tips","priorityFee"],xu=class{static{i(this,"SolanaProcessQuoteCommand")}networkID;priceClient;connection;constructor(e,r,o){this.networkID=e,this.priceClient=r,this.connection=o}getNativeTokenCaip19(){return L({chainId:this.networkID,resourceType:V.nativeToken,slip44:C.getSlip44(this.networkID)})}async processQuote(e,r){let n=(await this.priceClient.getPrice(this.getNativeTokenCaip19())).usd;if(!n)throw new Error(`Price data not found for native token ${this.getNativeTokenCaip19()}`);let s=await this.createSwapTransactions(e),c=Sb(e,n),p=await this.processParsedFees(c,n);return{quote:e,fees:{totalFees:this.sumFees(p),fees:p},swapTransactions:s}}async processParsedFees(e,r){if(e.find(d=>d.type==="solanaGaslessNetwork"))return e;let o=e.filter(d=>!bb.includes(d.type)),n=e.filter(d=>bb.includes(d.type)),s=e.find(d=>d.type==="priorityFee"),c=await this.calculateNetworkFee(s,r),p=this.sumNetworkFees(c,n);return[...o,p]}sumNetworkFees(e,r){return r.reduce((o,n)=>({...o,amount:o.amount.plus(n.amount),amountUsd:o.amountUsd.plus(n.amountUsd)}),e)}createSwapTransactions(e){return ps({quote:e,connection:this.connection})}getAmountsFromNativeAmount(e,r){let o=new x(e.amount);return{amountUsd:o.div(new x(pe.LAMPORTS_PER_SOL)).times(r),amount:o}}async calculateNetworkFee(e,r){let o=new x(e?.amount??0);return{type:"solanaNetwork",amountUsd:o.div(new x(pe.LAMPORTS_PER_SOL)).times(r),amount:o}}sumFees(e){return e.reduce((r,o)=>r.plus(o.amountUsd),new x(0))}};u();l();u();l();var ws=class{static{i(this,"SuiProcessQuoteCommand")}networkID;priceClient;constructor(e,r){this.networkID=e,this.priceClient=r}getNativeTokenCaip19(){return L({chainId:this.networkID,resourceType:V.nativeToken,slip44:C.getSlip44(this.networkID)})}async processQuote(e,r){let o=await this.createSwapTransactions(e),n=await this.calculateNetworkFee(o),s=this.appendPhantomFee([n],e);return{quote:e,fees:{totalFees:this.sumFees(s),fees:s},swapTransactions:o}}createSwapTransactions(e){return Vi({quote:e})}appendPhantomFee(e,r){let o=r.fees.find(n=>n.type==="phantom");return o?[...e,{type:"phantom",percentage:new x(o.percentage),amountUsd:new x(0),amount:new x(0)}]:e}async calculateNetworkFee(e){let r=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!r.usd)throw new Error("Price data not found");let o=new x(0),n=new x(0);try{let s=await Promise.all(e.transactions.map(c=>Ny({networkID:this.networkID,transaction:ac.deserializeTransactionString(c)})));n=new x(s.reduce((c,p)=>c+p.gasBudget.toNumber(),0)),o=n.dividedBy(1e9).multipliedBy(r.usd)}catch{return{type:"suiNetwork",amountUsd:new x(0),amount:new x(0)}}return{type:"suiNetwork",amountUsd:o,amount:n}}sumFees(e){return e.reduce((r,o)=>r.plus(o.amountUsd),new x(0))}};var Eu=class{static{i(this,"SuiBridgeProcessQuoteCommand")}networkID;priceClient;suiProcessQuoteCommand;constructor(e,r){this.networkID=e,this.priceClient=r,this.suiProcessQuoteCommand=new ws(e,r)}getNativeTokenCaip19(){return this.suiProcessQuoteCommand.getNativeTokenCaip19()}async processQuote(e,r){let o=await this.createSwapTransactions(e),n=await this.priceClient.getPrice(this.getNativeTokenCaip19());if(!n.usd)throw new Error("Price data not found");let s=await this.suiProcessQuoteCommand.calculateNetworkFee(o),c=this.appendBridgeFees([s],e,n),p=this.appendPhantomFee(c,e);return{quote:e,fees:{totalFees:this.sumFees(p),fees:p},swapTransactions:o}}appendBridgeFees(e,r,o){let n={[this.getNativeTokenCaip19()]:o},s=Go(r,this.networkID,n),c=Ho(r);return[...e,...c,...s]}appendPhantomFee(e,r){let o=r.steps.flatMap(n=>n.feeCosts).find(n=>n.name==="phantom");return o?[...e,{type:"phantom",percentage:new x(o.percentage),amountUsd:new x(0),amount:new x(0)}]:e}createSwapTransactions(e){return ji({quote:e})}sumFees(e){return e.reduce((r,o)=>r.plus(o.amountUsd),new x(0))}};var Cu=class{static{i(this,"ProcessQuoteCommandFactoryImpl")}create(e,r,o,n){let s=r.sell.data.chain.id,c=r.buy.data.chain.id,p=Kt(s,c);if(C.isSolanaNetworkID(s)){let d=Wy(e).connection;return p?new Au(s,this.priceClient,d):new xu(s,this.priceClient,d)}else{if(C.isEVMNetworkID(s))return p?new bu(s,e,this.priceClient,r,o):new Tu(s,e,this.priceClient,r,o);if(C.isSuiNetworkID(s))return p?new Eu(s,this.priceClient):new ws(s,this.priceClient);if(C.isBitcoinNetworkID(s)&&p)return new yu(s,this.priceClient)}throw new Error(`Unsupported network ID: ${s}`)}priceClient={getPrice:i(async e=>(await hc({tokens:[We(e)]}))[e],"getPrice")};isSupportedNetwork(e){return C.isSolanaNetworkID(e)||C.isEVMNetworkID(e)}},ku=class{static{i(this,"NoOpProcessQuoteCommandFactory")}create(e,r,o,n){return{processQuote:i(async(s,c)=>({quote:s,fees:{totalFees:new x(0),fees:[]}}),"processQuote")}}};u();l();u();l();u();l();var Tb="CASH";u();l();var Ab=i(t=>t.reduce((e,r)=>{if(!r||r.type!==ae.SPL)return e;let o;return r.type===ae.SPL&&(o=_v(r)),o?{fees:[...e.fees,o],totalPercentFees:e.totalPercentFees+o.percentFee}:e},{fees:[],totalPercentFees:0}),"getSwapTransferFees"),_v=i(t=>{if(t.type!==ae.SPL)return;let r=(t.data.mintExtensions??[]).find(o=>o.extension===pc.transferFeeConfig);if(r)return{caip19:L(X(t)),fungibleKey:t.data.key,symbol:t.data.symbol??"",name:t.data.name??"",percentFee:r.state.newerTransferFee.transferFeeBasisPoints/100}},"getSplTransferFee");u();l();var Rv=i(t=>t.isGreaterThanOrEqualTo(1)?"0,0.[00]":"0,0.[00000]","getFormatString"),Ss=i(t=>{let e=x(t);return Gg(t,Rv(e))},"formatTokenAmountGreaterThan1");var Dv=.05,Bv=5,Nv=.5;function _m(t,e,r,o){let{priceImpact:n,quoteSlippageTolerance:s}=Lv(t),c=e.autoSlippage?s??r.slippageTolerance:r.slippageTolerance,p={type:"slippage",slippage:c,slippageType:e.autoSlippage?fe.Auto:fe.Fixed,alert:c&&c>=Bv?"highSlippage":void 0},d={type:"priceImpact",priceImpactPercentage:n.gt(0)?$g(n.toNumber()):"-",alert:n&&n.gte(Dv)?"highPriceImpact":void 0,warning:n&&n.gte(Nv)?"veryHighPriceImpact":void 0},f=[Rm(t,e.buy,e.sell),p,d],g=Ab([e.sell,e.buy]);return g.fees.length>0&&f.push({type:"transferFees",transferFees:g.totalPercentFees,transferTokenSymbol:e.sell.data.symbol??"",alert:"transferFees"}),o&&f.push({type:"fees",quoteFees:o}),f}i(_m,"entriesForQuote");function Lv(t){return Ht(t)?{priceImpact:t.priceImpact?x(t.priceImpact):x(0),quoteSlippageTolerance:t.slippageTolerance}:Ir(t)?{priceImpact:t.priceImpact?x(t.priceImpact):x(0),quoteSlippageTolerance:t.slippageTolerance}:io(t)?{priceImpact:t.priceImpact?x(t.priceImpact):x(0),quoteSlippageTolerance:t.slippageTolerance}:{priceImpact:x(0),quoteSlippageTolerance:void 0}}i(Lv,"extractQuoteInfo");function Rm(t,e,r){let{buyAmount:o,sellAmount:n}=t,s=new x(o).shiftedBy(-e.data.decimals).dividedBy(new x(n).shiftedBy(-r.data.decimals));return{type:"pricing",ratio:s,exchangeRate:`1 ${Iu(r)} \u2248 ${Ss(s)} ${Iu(e)}`,exchangeRateFlipped:`1 ${Iu(e)} \u2248 ${Ss(x(1).dividedBy(s))} ${Iu(r)}`}}i(Rm,"parsePricing");function Iu(t){return fc(t)?Tb:t.data.symbol??""}i(Iu,"cashDeobfuscatedSymbol");u();l();var Fu=class{static{i(this,"AsyncQueue")}queue=[];processing=!1;enqueue(e){this.queue.push(e),this.processNext()}clearQueue(){this.queue=[],this.processing=!1}async processNext(){if(this.processing||this.queue.length===0)return;this.processing=!0;let e=this.queue.shift();if(e)try{await e()}catch(r){console.error("Error processing task:",r)}this.processing=!1,this.processNext()}};u();l();var ea=class{static{i(this,"QuoteDetails")}entries;alerts=[];warnings=[];constructor(e){this.entries=e;for(let r of e)r.alert&&this.alerts.push(r.alert),r.warning&&this.warnings.push(r.warning)}};u();l();var Dm;(function(t){t.SwapperNoQuotes="SwapperNoQuotes",t.InsufficientSellAmount="InsufficientSellAmount",t.CrossChainUnavailable="CrossChainUnavailable",t.TokenNotTradable="TokenNotTradable",t.NotEnoughSuiObjects="NotEnoughSuiObjects",t.FromTokenIsHoneyPotToken="FromTokenIsHoneyPotToken",t.ToTokenIsHoneyPotToken="ToTokenIsHoneyPotToken",t.InsufficientLiquidity="InsufficientLiquidity",t.SwapInitializationFailed="SwapInitializationFailed",t.pSolHighImpactError="pSolHighImpactError"})(Dm||(Dm={}));var Pu=class t extends Error{static{i(this,"QuoteError")}name;type;constructor(e,r,o){super(r),this.name=e,this.type=o}static fromErrorResponse(e,r){return i(n=>Object.values(Dm).includes(n),"isValidType")(e)?new t(e,r,e):new t(e,r)}};var Mv="swap-quotes",vu=class{static{i(this,"QuoteProcessor")}quoteStreamer;commandFactory;state={type:"idle"};listeners=[];swapTransactionQueue=new Fu;constructor(e,r){this.quoteStreamer=e,this.commandFactory=r}start(e,r){this.setState({type:"starting",input:e,account:r}),this.quoteStreamer.subscribe(this.quoteStreamListener),this.quoteStreamer.openStream(e)}stop(){this.swapTransactionQueue.clearQueue(),this.setState({type:"idle"}),this.quoteStreamer.closeStream(),this.quoteStreamer.unsubscribe(this.quoteStreamListener)}setQuoteStreamer(e){this.stop(),this.quoteStreamer=e}quoteStreamListener={onEvent:i(e=>{switch(e.type){case"newQuoteResponse":switch(this.state.type){case"starting":let n=this.findPreferredQuote(this.state.input,e.quoteResponse);this.setState({type:"firstQuoteReceived",input:this.state.input,quote:n,response:e.quoteResponse,account:this.state.account,quoteDetails:new ea(_m(n,this.state.input,e.quoteResponse))}),this.enqueueQuoteToProcess(this.state.input,e.quoteResponse,this.state.account);break;case"quoteProcessed":this.enqueueQuoteToProcess(this.state.input,e.quoteResponse,this.state.account,this.state.prevProcessedQuote);break}break;case"error":let r=Pu.fromErrorResponse(e.errorResponse.name,e.errorResponse.message),o=new tt({key:r.name});switch(k.addBreadcrumb(Mv,JSON.stringify(r.name),D.Info),this.state.type){case"starting":case"firstQuoteReceived":case"quoteProcessed":case"error":this.setState({type:"error",error:o,quoteError:r,account:this.state.account,input:this.state.input});break}break;case"openRequested":break;case"close":this.setState({type:"idle"});break}},"onEvent")};enqueueQuoteToProcess(e,r,o,n){this.swapTransactionQueue.enqueue(()=>this.processQuote(r,e,o,n))}async processQuote(e,r,o,n){try{let s=this.findPreferredQuote(r,e),p=await this.commandFactory.create(o,r,e,r.isSimulationKilled).processQuote(s,r.isSimulationKilled);switch(this.state.type){case"firstQuoteReceived":case"quoteProcessed":case"error":this.setState({type:"quoteProcessed",input:r,response:e,quote:s,prevProcessedQuote:n,nextProcessedQuote:p,account:o,quoteDetails:new ea(_m(s,r,e,p.fees))});break}return p}catch(s){throw k.captureError(s,v.Swapper),s}}subscribe(e){this.listeners.push(e)}unsubscribe(e){this.listeners=this.listeners.filter(r=>r!==e)}getState(){return this.state}findPreferredQuote(e,r){let o=e.preferredProvider;return o&&r.quotes.find(n=>n.baseProvider.id===o)||r.quotes[0]}setState(e){let r=this.state;this.state=e,this.listeners.forEach(o=>o.onStateChange(r,e))}};u();l();u();l();u();l();u();l();function Cs(t){let e=t.length;for(;--e>=0;)t[e]=0}i(Cs,"zero$1");var Uv=0,aT=1,Ov=2,qv=3,zv=258,of=29,ha=256,aa=ha+1+of,As=30,nf=19,cT=2*aa+1,fn=15,Bm=16,Qv=7,sf=256,uT=16,lT=17,pT=18,Vm=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Lu=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Hv=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),dT=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Gv=512,po=new Array((aa+2)*2);Cs(po);var na=new Array(As*2);Cs(na);var ca=new Array(Gv);Cs(ca);var ua=new Array(zv-qv+1);Cs(ua);var af=new Array(of);Cs(af);var Mu=new Array(As);Cs(Mu);function Nm(t,e,r,o,n){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=o,this.max_length=n,this.has_stree=t&&t.length}i(Nm,"StaticTreeDesc");var mT,fT,hT;function Lm(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}i(Lm,"TreeDesc");var gT=i(t=>t<256?ca[t]:ca[256+(t>>>7)],"d_code"),la=i((t,e)=>{t.pending_buf[t.pending++]=e&255,t.pending_buf[t.pending++]=e>>>8&255},"put_short"),jt=i((t,e,r)=>{t.bi_valid>Bm-r?(t.bi_buf|=e<<t.bi_valid&65535,la(t,t.bi_buf),t.bi_buf=e>>Bm-t.bi_valid,t.bi_valid+=r-Bm):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)},"send_bits"),Kr=i((t,e,r)=>{jt(t,r[e*2],r[e*2+1])},"send_code"),yT=i((t,e)=>{let r=0;do r|=t&1,t>>>=1,r<<=1;while(--e>0);return r>>>1},"bi_reverse"),Kv=i(t=>{t.bi_valid===16?(la(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},"bi_flush"),$v=i((t,e)=>{let r=e.dyn_tree,o=e.max_code,n=e.stat_desc.static_tree,s=e.stat_desc.has_stree,c=e.stat_desc.extra_bits,p=e.stat_desc.extra_base,d=e.stat_desc.max_length,m,f,g,w,y,S,b=0;for(w=0;w<=fn;w++)t.bl_count[w]=0;for(r[t.heap[t.heap_max]*2+1]=0,m=t.heap_max+1;m<cT;m++)f=t.heap[m],w=r[r[f*2+1]*2+1]+1,w>d&&(w=d,b++),r[f*2+1]=w,!(f>o)&&(t.bl_count[w]++,y=0,f>=p&&(y=c[f-p]),S=r[f*2],t.opt_len+=S*(w+y),s&&(t.static_len+=S*(n[f*2+1]+y)));if(b!==0){do{for(w=d-1;t.bl_count[w]===0;)w--;t.bl_count[w]--,t.bl_count[w+1]+=2,t.bl_count[d]--,b-=2}while(b>0);for(w=d;w!==0;w--)for(f=t.bl_count[w];f!==0;)g=t.heap[--m],!(g>o)&&(r[g*2+1]!==w&&(t.opt_len+=(w-r[g*2+1])*r[g*2],r[g*2+1]=w),f--)}},"gen_bitlen"),wT=i((t,e,r)=>{let o=new Array(fn+1),n=0,s,c;for(s=1;s<=fn;s++)n=n+r[s-1]<<1,o[s]=n;for(c=0;c<=e;c++){let p=t[c*2+1];p!==0&&(t[c*2]=yT(o[p]++,p))}},"gen_codes"),jv=i(()=>{let t,e,r,o,n,s=new Array(fn+1);for(r=0,o=0;o<of-1;o++)for(af[o]=r,t=0;t<1<<Vm[o];t++)ua[r++]=o;for(ua[r-1]=o,n=0,o=0;o<16;o++)for(Mu[o]=n,t=0;t<1<<Lu[o];t++)ca[n++]=o;for(n>>=7;o<As;o++)for(Mu[o]=n<<7,t=0;t<1<<Lu[o]-7;t++)ca[256+n++]=o;for(e=0;e<=fn;e++)s[e]=0;for(t=0;t<=143;)po[t*2+1]=8,t++,s[8]++;for(;t<=255;)po[t*2+1]=9,t++,s[9]++;for(;t<=279;)po[t*2+1]=7,t++,s[7]++;for(;t<=287;)po[t*2+1]=8,t++,s[8]++;for(wT(po,aa+1,s),t=0;t<As;t++)na[t*2+1]=5,na[t*2]=yT(t,5);mT=new Nm(po,Vm,ha+1,aa,fn),fT=new Nm(na,Lu,0,As,fn),hT=new Nm(new Array(0),Hv,0,nf,Qv)},"tr_static_init"),ST=i(t=>{let e;for(e=0;e<aa;e++)t.dyn_ltree[e*2]=0;for(e=0;e<As;e++)t.dyn_dtree[e*2]=0;for(e=0;e<nf;e++)t.bl_tree[e*2]=0;t.dyn_ltree[sf*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},"init_block"),bT=i(t=>{t.bi_valid>8?la(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},"bi_windup"),xb=i((t,e,r,o)=>{let n=e*2,s=r*2;return t[n]<t[s]||t[n]===t[s]&&o[e]<=o[r]},"smaller"),Mm=i((t,e,r)=>{let o=t.heap[r],n=r<<1;for(;n<=t.heap_len&&(n<t.heap_len&&xb(e,t.heap[n+1],t.heap[n],t.depth)&&n++,!xb(e,o,t.heap[n],t.depth));)t.heap[r]=t.heap[n],r=n,n<<=1;t.heap[r]=o},"pqdownheap"),Eb=i((t,e,r)=>{let o,n,s=0,c,p;if(t.sym_next!==0)do o=t.pending_buf[t.sym_buf+s++]&255,o+=(t.pending_buf[t.sym_buf+s++]&255)<<8,n=t.pending_buf[t.sym_buf+s++],o===0?Kr(t,n,e):(c=ua[n],Kr(t,c+ha+1,e),p=Vm[c],p!==0&&(n-=af[c],jt(t,n,p)),o--,c=gT(o),Kr(t,c,r),p=Lu[c],p!==0&&(o-=Mu[c],jt(t,o,p)));while(s<t.sym_next);Kr(t,sf,e)},"compress_block"),Wm=i((t,e)=>{let r=e.dyn_tree,o=e.stat_desc.static_tree,n=e.stat_desc.has_stree,s=e.stat_desc.elems,c,p,d=-1,m;for(t.heap_len=0,t.heap_max=cT,c=0;c<s;c++)r[c*2]!==0?(t.heap[++t.heap_len]=d=c,t.depth[c]=0):r[c*2+1]=0;for(;t.heap_len<2;)m=t.heap[++t.heap_len]=d<2?++d:0,r[m*2]=1,t.depth[m]=0,t.opt_len--,n&&(t.static_len-=o[m*2+1]);for(e.max_code=d,c=t.heap_len>>1;c>=1;c--)Mm(t,r,c);m=s;do c=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Mm(t,r,1),p=t.heap[1],t.heap[--t.heap_max]=c,t.heap[--t.heap_max]=p,r[m*2]=r[c*2]+r[p*2],t.depth[m]=(t.depth[c]>=t.depth[p]?t.depth[c]:t.depth[p])+1,r[c*2+1]=r[p*2+1]=m,t.heap[1]=m++,Mm(t,r,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],$v(t,e),wT(r,d,t.bl_count)},"build_tree"),Cb=i((t,e,r)=>{let o,n=-1,s,c=e[0*2+1],p=0,d=7,m=4;for(c===0&&(d=138,m=3),e[(r+1)*2+1]=65535,o=0;o<=r;o++)s=c,c=e[(o+1)*2+1],!(++p<d&&s===c)&&(p<m?t.bl_tree[s*2]+=p:s!==0?(s!==n&&t.bl_tree[s*2]++,t.bl_tree[uT*2]++):p<=10?t.bl_tree[lT*2]++:t.bl_tree[pT*2]++,p=0,n=s,c===0?(d=138,m=3):s===c?(d=6,m=3):(d=7,m=4))},"scan_tree"),kb=i((t,e,r)=>{let o,n=-1,s,c=e[0*2+1],p=0,d=7,m=4;for(c===0&&(d=138,m=3),o=0;o<=r;o++)if(s=c,c=e[(o+1)*2+1],!(++p<d&&s===c)){if(p<m)do Kr(t,s,t.bl_tree);while(--p!==0);else s!==0?(s!==n&&(Kr(t,s,t.bl_tree),p--),Kr(t,uT,t.bl_tree),jt(t,p-3,2)):p<=10?(Kr(t,lT,t.bl_tree),jt(t,p-3,3)):(Kr(t,pT,t.bl_tree),jt(t,p-11,7));p=0,n=s,c===0?(d=138,m=3):s===c?(d=6,m=3):(d=7,m=4)}},"send_tree"),Vv=i(t=>{let e;for(Cb(t,t.dyn_ltree,t.l_desc.max_code),Cb(t,t.dyn_dtree,t.d_desc.max_code),Wm(t,t.bl_desc),e=nf-1;e>=3&&t.bl_tree[dT[e]*2+1]===0;e--);return t.opt_len+=3*(e+1)+5+5+4,e},"build_bl_tree"),Wv=i((t,e,r,o)=>{let n;for(jt(t,e-257,5),jt(t,r-1,5),jt(t,o-4,4),n=0;n<o;n++)jt(t,t.bl_tree[dT[n]*2+1],3);kb(t,t.dyn_ltree,e-1),kb(t,t.dyn_dtree,r-1)},"send_all_trees"),Zv=i(t=>{let e=4093624447,r;for(r=0;r<=31;r++,e>>>=1)if(e&1&&t.dyn_ltree[r*2]!==0)return 0;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return 1;for(r=32;r<ha;r++)if(t.dyn_ltree[r*2]!==0)return 1;return 0},"detect_data_type"),Ib=!1,Yv=i(t=>{Ib||(jv(),Ib=!0),t.l_desc=new Lm(t.dyn_ltree,mT),t.d_desc=new Lm(t.dyn_dtree,fT),t.bl_desc=new Lm(t.bl_tree,hT),t.bi_buf=0,t.bi_valid=0,ST(t)},"_tr_init$1"),TT=i((t,e,r,o)=>{jt(t,(Uv<<1)+(o?1:0),3),bT(t),la(t,r),la(t,~r),r&&t.pending_buf.set(t.window.subarray(e,e+r),t.pending),t.pending+=r},"_tr_stored_block$1"),Xv=i(t=>{jt(t,aT<<1,3),Kr(t,sf,po),Kv(t)},"_tr_align$1"),Jv=i((t,e,r,o)=>{let n,s,c=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=Zv(t)),Wm(t,t.l_desc),Wm(t,t.d_desc),c=Vv(t),n=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=n&&(n=s)):n=s=r+5,r+4<=n&&e!==-1?TT(t,e,r,o):t.strategy===4||s===n?(jt(t,(aT<<1)+(o?1:0),3),Eb(t,po,na)):(jt(t,(Ov<<1)+(o?1:0),3),Wv(t,t.l_desc.max_code+1,t.d_desc.max_code+1,c+1),Eb(t,t.dyn_ltree,t.dyn_dtree)),ST(t),o&&bT(t)},"_tr_flush_block$1"),e_=i((t,e,r)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=r,e===0?t.dyn_ltree[r*2]++:(t.matches++,e--,t.dyn_ltree[(ua[r]+ha+1)*2]++,t.dyn_dtree[gT(e)*2]++),t.sym_next===t.sym_end),"_tr_tally$1"),t_=Yv,r_=TT,o_=Jv,n_=e_,s_=Xv,i_={_tr_init:t_,_tr_stored_block:r_,_tr_flush_block:o_,_tr_tally:n_,_tr_align:s_},a_=i((t,e,r,o)=>{let n=t&65535|0,s=t>>>16&65535|0,c=0;for(;r!==0;){c=r>2e3?2e3:r,r-=c;do n=n+e[o++]|0,s=s+n|0;while(--c);n%=65521,s%=65521}return n|s<<16|0},"adler32"),pa=a_,c_=i(()=>{let t,e=[];for(var r=0;r<256;r++){t=r;for(var o=0;o<8;o++)t=t&1?3988292384^t>>>1:t>>>1;e[r]=t}return e},"makeTable"),u_=new Uint32Array(c_()),l_=i((t,e,r,o)=>{let n=u_,s=o+r;t^=-1;for(let c=o;c<s;c++)t=t>>>8^n[(t^e[c])&255];return t^-1},"crc32"),ft=l_,yn={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},bn={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:p_,_tr_stored_block:Zm,_tr_flush_block:d_,_tr_tally:jo,_tr_align:m_}=i_,{Z_NO_FLUSH:Vo,Z_PARTIAL_FLUSH:f_,Z_FULL_FLUSH:h_,Z_FINISH:mr,Z_BLOCK:Fb,Z_OK:At,Z_STREAM_END:Pb,Z_STREAM_ERROR:$r,Z_DATA_ERROR:g_,Z_BUF_ERROR:Um,Z_DEFAULT_COMPRESSION:y_,Z_FILTERED:w_,Z_HUFFMAN_ONLY:_u,Z_RLE:S_,Z_FIXED:b_,Z_DEFAULT_STRATEGY:T_,Z_UNKNOWN:A_,Z_DEFLATED:qu}=bn,x_=9,E_=15,C_=8,k_=29,I_=256,Ym=I_+1+k_,F_=30,P_=19,v_=2*Ym+1,__=15,Se=3,$o=258,jr=$o+Se+1,R_=32,xs=42,cf=57,Xm=69,Jm=73,ef=91,tf=103,hn=113,ra=666,Mt=1,ks=2,wn=3,Is=4,D_=3,gn=i((t,e)=>(t.msg=yn[e],e),"err"),vb=i(t=>t*2-(t>4?9:0),"rank"),Ko=i(t=>{let e=t.length;for(;--e>=0;)t[e]=0},"zero"),B_=i(t=>{let e,r,o,n=t.w_size;e=t.hash_size,o=e;do r=t.head[--o],t.head[o]=r>=n?r-n:0;while(--e);e=n,o=e;do r=t.prev[--o],t.prev[o]=r>=n?r-n:0;while(--e)},"slide_hash"),N_=i((t,e,r)=>(e<<t.hash_shift^r)&t.hash_mask,"HASH_ZLIB"),Wo=N_,er=i(t=>{let e=t.state,r=e.pending;r>t.avail_out&&(r=t.avail_out),r!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+r),t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,e.pending===0&&(e.pending_out=0))},"flush_pending"),tr=i((t,e)=>{d_(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,er(t.strm)},"flush_block_only"),ve=i((t,e)=>{t.pending_buf[t.pending++]=e},"put_byte"),ta=i((t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=e&255},"putShortMSB"),rf=i((t,e,r,o)=>{let n=t.avail_in;return n>o&&(n=o),n===0?0:(t.avail_in-=n,e.set(t.input.subarray(t.next_in,t.next_in+n),r),t.state.wrap===1?t.adler=pa(t.adler,e,n,r):t.state.wrap===2&&(t.adler=ft(t.adler,e,n,r)),t.next_in+=n,t.total_in+=n,n)},"read_buf"),AT=i((t,e)=>{let r=t.max_chain_length,o=t.strstart,n,s,c=t.prev_length,p=t.nice_match,d=t.strstart>t.w_size-jr?t.strstart-(t.w_size-jr):0,m=t.window,f=t.w_mask,g=t.prev,w=t.strstart+$o,y=m[o+c-1],S=m[o+c];t.prev_length>=t.good_match&&(r>>=2),p>t.lookahead&&(p=t.lookahead);do if(n=e,!(m[n+c]!==S||m[n+c-1]!==y||m[n]!==m[o]||m[++n]!==m[o+1])){o+=2,n++;do;while(m[++o]===m[++n]&&m[++o]===m[++n]&&m[++o]===m[++n]&&m[++o]===m[++n]&&m[++o]===m[++n]&&m[++o]===m[++n]&&m[++o]===m[++n]&&m[++o]===m[++n]&&o<w);if(s=$o-(w-o),o=w-$o,s>c){if(t.match_start=e,c=s,s>=p)break;y=m[o+c-1],S=m[o+c]}}while((e=g[e&f])>d&&--r!==0);return c<=t.lookahead?c:t.lookahead},"longest_match"),Es=i(t=>{let e=t.w_size,r,o,n;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-jr)&&(t.window.set(t.window.subarray(e,e+e-o),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),B_(t),o+=e),t.strm.avail_in===0)break;if(r=rf(t.strm,t.window,t.strstart+t.lookahead,o),t.lookahead+=r,t.lookahead+t.insert>=Se)for(n=t.strstart-t.insert,t.ins_h=t.window[n],t.ins_h=Wo(t,t.ins_h,t.window[n+1]);t.insert&&(t.ins_h=Wo(t,t.ins_h,t.window[n+Se-1]),t.prev[n&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=n,n++,t.insert--,!(t.lookahead+t.insert<Se)););}while(t.lookahead<jr&&t.strm.avail_in!==0)},"fill_window"),xT=i((t,e)=>{let r=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,o,n,s,c=0,p=t.strm.avail_in;do{if(o=65535,s=t.bi_valid+42>>3,t.strm.avail_out<s||(s=t.strm.avail_out-s,n=t.strstart-t.block_start,o>n+t.strm.avail_in&&(o=n+t.strm.avail_in),o>s&&(o=s),o<r&&(o===0&&e!==mr||e===Vo||o!==n+t.strm.avail_in)))break;c=e===mr&&o===n+t.strm.avail_in?1:0,Zm(t,0,0,c),t.pending_buf[t.pending-4]=o,t.pending_buf[t.pending-3]=o>>8,t.pending_buf[t.pending-2]=~o,t.pending_buf[t.pending-1]=~o>>8,er(t.strm),n&&(n>o&&(n=o),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+n),t.strm.next_out),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n,t.block_start+=n,o-=n),o&&(rf(t.strm,t.strm.output,t.strm.next_out,o),t.strm.next_out+=o,t.strm.avail_out-=o,t.strm.total_out+=o)}while(c===0);return p-=t.strm.avail_in,p&&(p>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=p&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-p,t.strm.next_in),t.strstart),t.strstart+=p,t.insert+=p>t.w_size-t.insert?t.w_size-t.insert:p),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),c?Is:e!==Vo&&e!==mr&&t.strm.avail_in===0&&t.strstart===t.block_start?ks:(s=t.window_size-t.strstart,t.strm.avail_in>s&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,s+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),s>t.strm.avail_in&&(s=t.strm.avail_in),s&&(rf(t.strm,t.window,t.strstart,s),t.strstart+=s,t.insert+=s>t.w_size-t.insert?t.w_size-t.insert:s),t.high_water<t.strstart&&(t.high_water=t.strstart),s=t.bi_valid+42>>3,s=t.pending_buf_size-s>65535?65535:t.pending_buf_size-s,r=s>t.w_size?t.w_size:s,n=t.strstart-t.block_start,(n>=r||(n||e===mr)&&e!==Vo&&t.strm.avail_in===0&&n<=s)&&(o=n>s?s:n,c=e===mr&&t.strm.avail_in===0&&o===n?1:0,Zm(t,t.block_start,o,c),t.block_start+=o,er(t.strm)),c?wn:Mt)},"deflate_stored"),Om=i((t,e)=>{let r,o;for(;;){if(t.lookahead<jr){if(Es(t),t.lookahead<jr&&e===Vo)return Mt;if(t.lookahead===0)break}if(r=0,t.lookahead>=Se&&(t.ins_h=Wo(t,t.ins_h,t.window[t.strstart+Se-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),r!==0&&t.strstart-r<=t.w_size-jr&&(t.match_length=AT(t,r)),t.match_length>=Se)if(o=jo(t,t.strstart-t.match_start,t.match_length-Se),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=Se){t.match_length--;do t.strstart++,t.ins_h=Wo(t,t.ins_h,t.window[t.strstart+Se-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Wo(t,t.ins_h,t.window[t.strstart+1]);else o=jo(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(o&&(tr(t,!1),t.strm.avail_out===0))return Mt}return t.insert=t.strstart<Se-1?t.strstart:Se-1,e===mr?(tr(t,!0),t.strm.avail_out===0?wn:Is):t.sym_next&&(tr(t,!1),t.strm.avail_out===0)?Mt:ks},"deflate_fast"),bs=i((t,e)=>{let r,o,n;for(;;){if(t.lookahead<jr){if(Es(t),t.lookahead<jr&&e===Vo)return Mt;if(t.lookahead===0)break}if(r=0,t.lookahead>=Se&&(t.ins_h=Wo(t,t.ins_h,t.window[t.strstart+Se-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=Se-1,r!==0&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-jr&&(t.match_length=AT(t,r),t.match_length<=5&&(t.strategy===w_||t.match_length===Se&&t.strstart-t.match_start>4096)&&(t.match_length=Se-1)),t.prev_length>=Se&&t.match_length<=t.prev_length){n=t.strstart+t.lookahead-Se,o=jo(t,t.strstart-1-t.prev_match,t.prev_length-Se),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=n&&(t.ins_h=Wo(t,t.ins_h,t.window[t.strstart+Se-1]),r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=Se-1,t.strstart++,o&&(tr(t,!1),t.strm.avail_out===0))return Mt}else if(t.match_available){if(o=jo(t,0,t.window[t.strstart-1]),o&&tr(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return Mt}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(o=jo(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<Se-1?t.strstart:Se-1,e===mr?(tr(t,!0),t.strm.avail_out===0?wn:Is):t.sym_next&&(tr(t,!1),t.strm.avail_out===0)?Mt:ks},"deflate_slow"),L_=i((t,e)=>{let r,o,n,s,c=t.window;for(;;){if(t.lookahead<=$o){if(Es(t),t.lookahead<=$o&&e===Vo)return Mt;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=Se&&t.strstart>0&&(n=t.strstart-1,o=c[n],o===c[++n]&&o===c[++n]&&o===c[++n])){s=t.strstart+$o;do;while(o===c[++n]&&o===c[++n]&&o===c[++n]&&o===c[++n]&&o===c[++n]&&o===c[++n]&&o===c[++n]&&o===c[++n]&&n<s);t.match_length=$o-(s-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=Se?(r=jo(t,1,t.match_length-Se),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=jo(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(tr(t,!1),t.strm.avail_out===0))return Mt}return t.insert=0,e===mr?(tr(t,!0),t.strm.avail_out===0?wn:Is):t.sym_next&&(tr(t,!1),t.strm.avail_out===0)?Mt:ks},"deflate_rle"),M_=i((t,e)=>{let r;for(;;){if(t.lookahead===0&&(Es(t),t.lookahead===0)){if(e===Vo)return Mt;break}if(t.match_length=0,r=jo(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(tr(t,!1),t.strm.avail_out===0))return Mt}return t.insert=0,e===mr?(tr(t,!0),t.strm.avail_out===0?wn:Is):t.sym_next&&(tr(t,!1),t.strm.avail_out===0)?Mt:ks},"deflate_huff");function Gr(t,e,r,o,n){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=o,this.func=n}i(Gr,"Config");var oa=[new Gr(0,0,0,0,xT),new Gr(4,4,8,4,Om),new Gr(4,5,16,8,Om),new Gr(4,6,32,32,Om),new Gr(4,4,16,16,bs),new Gr(8,16,32,32,bs),new Gr(8,16,128,128,bs),new Gr(8,32,128,256,bs),new Gr(32,128,258,1024,bs),new Gr(32,258,258,4096,bs)],U_=i(t=>{t.window_size=2*t.w_size,Ko(t.head),t.max_lazy_match=oa[t.level].max_lazy,t.good_match=oa[t.level].good_length,t.nice_match=oa[t.level].nice_length,t.max_chain_length=oa[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=Se-1,t.match_available=0,t.ins_h=0},"lm_init");function O_(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=qu,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(v_*2),this.dyn_dtree=new Uint16Array((2*F_+1)*2),this.bl_tree=new Uint16Array((2*P_+1)*2),Ko(this.dyn_ltree),Ko(this.dyn_dtree),Ko(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(__+1),this.heap=new Uint16Array(2*Ym+1),Ko(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Ym+1),Ko(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}i(O_,"DeflateState");var ga=i(t=>{if(!t)return 1;let e=t.state;return!e||e.strm!==t||e.status!==xs&&e.status!==cf&&e.status!==Xm&&e.status!==Jm&&e.status!==ef&&e.status!==tf&&e.status!==hn&&e.status!==ra?1:0},"deflateStateCheck"),ET=i(t=>{if(ga(t))return gn(t,$r);t.total_in=t.total_out=0,t.data_type=A_;let e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?cf:e.wrap?xs:hn,t.adler=e.wrap===2?0:1,e.last_flush=-2,p_(e),At},"deflateResetKeep"),CT=i(t=>{let e=ET(t);return e===At&&U_(t.state),e},"deflateReset"),q_=i((t,e)=>ga(t)||t.state.wrap!==2?$r:(t.state.gzhead=e,At),"deflateSetHeader"),kT=i((t,e,r,o,n,s)=>{if(!t)return $r;let c=1;if(e===y_&&(e=6),o<0?(c=0,o=-o):o>15&&(c=2,o-=16),n<1||n>x_||r!==qu||o<8||o>15||e<0||e>9||s<0||s>b_||o===8&&c!==1)return gn(t,$r);o===8&&(o=9);let p=new O_;return t.state=p,p.strm=t,p.status=xs,p.wrap=c,p.gzhead=null,p.w_bits=o,p.w_size=1<<p.w_bits,p.w_mask=p.w_size-1,p.hash_bits=n+7,p.hash_size=1<<p.hash_bits,p.hash_mask=p.hash_size-1,p.hash_shift=~~((p.hash_bits+Se-1)/Se),p.window=new Uint8Array(p.w_size*2),p.head=new Uint16Array(p.hash_size),p.prev=new Uint16Array(p.w_size),p.lit_bufsize=1<<n+6,p.pending_buf_size=p.lit_bufsize*4,p.pending_buf=new Uint8Array(p.pending_buf_size),p.sym_buf=p.lit_bufsize,p.sym_end=(p.lit_bufsize-1)*3,p.level=e,p.strategy=s,p.method=r,CT(t)},"deflateInit2"),z_=i((t,e)=>kT(t,e,qu,E_,C_,T_),"deflateInit"),Q_=i((t,e)=>{if(ga(t)||e>Fb||e<0)return t?gn(t,$r):$r;let r=t.state;if(!t.output||t.avail_in!==0&&!t.input||r.status===ra&&e!==mr)return gn(t,t.avail_out===0?Um:$r);let o=r.last_flush;if(r.last_flush=e,r.pending!==0){if(er(t),t.avail_out===0)return r.last_flush=-1,At}else if(t.avail_in===0&&vb(e)<=vb(o)&&e!==mr)return gn(t,Um);if(r.status===ra&&t.avail_in!==0)return gn(t,Um);if(r.status===xs&&r.wrap===0&&(r.status=hn),r.status===xs){let n=qu+(r.w_bits-8<<4)<<8,s=-1;if(r.strategy>=_u||r.level<2?s=0:r.level<6?s=1:r.level===6?s=2:s=3,n|=s<<6,r.strstart!==0&&(n|=R_),n+=31-n%31,ta(r,n),r.strstart!==0&&(ta(r,t.adler>>>16),ta(r,t.adler&65535)),t.adler=1,r.status=hn,er(t),r.pending!==0)return r.last_flush=-1,At}if(r.status===cf){if(t.adler=0,ve(r,31),ve(r,139),ve(r,8),r.gzhead)ve(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),ve(r,r.gzhead.time&255),ve(r,r.gzhead.time>>8&255),ve(r,r.gzhead.time>>16&255),ve(r,r.gzhead.time>>24&255),ve(r,r.level===9?2:r.strategy>=_u||r.level<2?4:0),ve(r,r.gzhead.os&255),r.gzhead.extra&&r.gzhead.extra.length&&(ve(r,r.gzhead.extra.length&255),ve(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=ft(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=Xm;else if(ve(r,0),ve(r,0),ve(r,0),ve(r,0),ve(r,0),ve(r,r.level===9?2:r.strategy>=_u||r.level<2?4:0),ve(r,D_),r.status=hn,er(t),r.pending!==0)return r.last_flush=-1,At}if(r.status===Xm){if(r.gzhead.extra){let n=r.pending,s=(r.gzhead.extra.length&65535)-r.gzindex;for(;r.pending+s>r.pending_buf_size;){let p=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+p),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>n&&(t.adler=ft(t.adler,r.pending_buf,r.pending-n,n)),r.gzindex+=p,er(t),r.pending!==0)return r.last_flush=-1,At;n=0,s-=p}let c=new Uint8Array(r.gzhead.extra);r.pending_buf.set(c.subarray(r.gzindex,r.gzindex+s),r.pending),r.pending+=s,r.gzhead.hcrc&&r.pending>n&&(t.adler=ft(t.adler,r.pending_buf,r.pending-n,n)),r.gzindex=0}r.status=Jm}if(r.status===Jm){if(r.gzhead.name){let n=r.pending,s;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>n&&(t.adler=ft(t.adler,r.pending_buf,r.pending-n,n)),er(t),r.pending!==0)return r.last_flush=-1,At;n=0}r.gzindex<r.gzhead.name.length?s=r.gzhead.name.charCodeAt(r.gzindex++)&255:s=0,ve(r,s)}while(s!==0);r.gzhead.hcrc&&r.pending>n&&(t.adler=ft(t.adler,r.pending_buf,r.pending-n,n)),r.gzindex=0}r.status=ef}if(r.status===ef){if(r.gzhead.comment){let n=r.pending,s;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>n&&(t.adler=ft(t.adler,r.pending_buf,r.pending-n,n)),er(t),r.pending!==0)return r.last_flush=-1,At;n=0}r.gzindex<r.gzhead.comment.length?s=r.gzhead.comment.charCodeAt(r.gzindex++)&255:s=0,ve(r,s)}while(s!==0);r.gzhead.hcrc&&r.pending>n&&(t.adler=ft(t.adler,r.pending_buf,r.pending-n,n))}r.status=tf}if(r.status===tf){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(er(t),r.pending!==0))return r.last_flush=-1,At;ve(r,t.adler&255),ve(r,t.adler>>8&255),t.adler=0}if(r.status=hn,er(t),r.pending!==0)return r.last_flush=-1,At}if(t.avail_in!==0||r.lookahead!==0||e!==Vo&&r.status!==ra){let n=r.level===0?xT(r,e):r.strategy===_u?M_(r,e):r.strategy===S_?L_(r,e):oa[r.level].func(r,e);if((n===wn||n===Is)&&(r.status=ra),n===Mt||n===wn)return t.avail_out===0&&(r.last_flush=-1),At;if(n===ks&&(e===f_?m_(r):e!==Fb&&(Zm(r,0,0,!1),e===h_&&(Ko(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),er(t),t.avail_out===0))return r.last_flush=-1,At}return e!==mr?At:r.wrap<=0?Pb:(r.wrap===2?(ve(r,t.adler&255),ve(r,t.adler>>8&255),ve(r,t.adler>>16&255),ve(r,t.adler>>24&255),ve(r,t.total_in&255),ve(r,t.total_in>>8&255),ve(r,t.total_in>>16&255),ve(r,t.total_in>>24&255)):(ta(r,t.adler>>>16),ta(r,t.adler&65535)),er(t),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?At:Pb)},"deflate$2"),H_=i(t=>{if(ga(t))return $r;let e=t.state.status;return t.state=null,e===hn?gn(t,g_):At},"deflateEnd"),G_=i((t,e)=>{let r=e.length;if(ga(t))return $r;let o=t.state,n=o.wrap;if(n===2||n===1&&o.status!==xs||o.lookahead)return $r;if(n===1&&(t.adler=pa(t.adler,e,r,0)),o.wrap=0,r>=o.w_size){n===0&&(Ko(o.head),o.strstart=0,o.block_start=0,o.insert=0);let d=new Uint8Array(o.w_size);d.set(e.subarray(r-o.w_size,r),0),e=d,r=o.w_size}let s=t.avail_in,c=t.next_in,p=t.input;for(t.avail_in=r,t.next_in=0,t.input=e,Es(o);o.lookahead>=Se;){let d=o.strstart,m=o.lookahead-(Se-1);do o.ins_h=Wo(o,o.ins_h,o.window[d+Se-1]),o.prev[d&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=d,d++;while(--m);o.strstart=d,o.lookahead=Se-1,Es(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=Se-1,o.match_available=0,t.next_in=c,t.input=p,t.avail_in=s,o.wrap=n,At},"deflateSetDictionary"),K_=z_,$_=kT,j_=CT,V_=ET,W_=q_,Z_=Q_,Y_=H_,X_=G_,J_="pako deflate (from Nodeca project)",sa={deflateInit:K_,deflateInit2:$_,deflateReset:j_,deflateResetKeep:V_,deflateSetHeader:W_,deflate:Z_,deflateEnd:Y_,deflateSetDictionary:X_,deflateInfo:J_},eR=i((t,e)=>Object.prototype.hasOwnProperty.call(t,e),"_has"),tR=i(function(t){let e=Array.prototype.slice.call(arguments,1);for(;e.length;){let r=e.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(let o in r)eR(r,o)&&(t[o]=r[o])}}return t},"assign"),rR=i(t=>{let e=0;for(let o=0,n=t.length;o<n;o++)e+=t[o].length;let r=new Uint8Array(e);for(let o=0,n=0,s=t.length;o<s;o++){let c=t[o];r.set(c,n),n+=c.length}return r},"flattenChunks"),zu={assign:tR,flattenChunks:rR},IT=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{IT=!1}var da=new Uint8Array(256);for(let t=0;t<256;t++)da[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;da[254]=da[254]=1;var oR=i(t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,r,o,n,s,c=t.length,p=0;for(n=0;n<c;n++)r=t.charCodeAt(n),(r&64512)===55296&&n+1<c&&(o=t.charCodeAt(n+1),(o&64512)===56320&&(r=65536+(r-55296<<10)+(o-56320),n++)),p+=r<128?1:r<2048?2:r<65536?3:4;for(e=new Uint8Array(p),s=0,n=0;s<p;n++)r=t.charCodeAt(n),(r&64512)===55296&&n+1<c&&(o=t.charCodeAt(n+1),(o&64512)===56320&&(r=65536+(r-55296<<10)+(o-56320),n++)),r<128?e[s++]=r:r<2048?(e[s++]=192|r>>>6,e[s++]=128|r&63):r<65536?(e[s++]=224|r>>>12,e[s++]=128|r>>>6&63,e[s++]=128|r&63):(e[s++]=240|r>>>18,e[s++]=128|r>>>12&63,e[s++]=128|r>>>6&63,e[s++]=128|r&63);return e},"string2buf"),nR=i((t,e)=>{if(e<65534&&t.subarray&&IT)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let r="";for(let o=0;o<e;o++)r+=String.fromCharCode(t[o]);return r},"buf2binstring"),sR=i((t,e)=>{let r=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let o,n,s=new Array(r*2);for(n=0,o=0;o<r;){let c=t[o++];if(c<128){s[n++]=c;continue}let p=da[c];if(p>4){s[n++]=65533,o+=p-1;continue}for(c&=p===2?31:p===3?15:7;p>1&&o<r;)c=c<<6|t[o++]&63,p--;if(p>1){s[n++]=65533;continue}c<65536?s[n++]=c:(c-=65536,s[n++]=55296|c>>10&1023,s[n++]=56320|c&1023)}return nR(s,n)},"buf2string"),iR=i((t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let r=e-1;for(;r>=0&&(t[r]&192)===128;)r--;return r<0||r===0?e:r+da[t[r]]>e?r:e},"utf8border"),ma={string2buf:oR,buf2string:sR,utf8border:iR};function aR(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}i(aR,"ZStream");var FT=aR,PT=Object.prototype.toString,{Z_NO_FLUSH:cR,Z_SYNC_FLUSH:uR,Z_FULL_FLUSH:lR,Z_FINISH:pR,Z_OK:Uu,Z_STREAM_END:dR,Z_DEFAULT_COMPRESSION:mR,Z_DEFAULT_STRATEGY:fR,Z_DEFLATED:hR}=bn;function ya(t){this.options=zu.assign({level:mR,method:hR,chunkSize:16384,windowBits:15,memLevel:8,strategy:fR},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new FT,this.strm.avail_out=0;let r=sa.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==Uu)throw new Error(yn[r]);if(e.header&&sa.deflateSetHeader(this.strm,e.header),e.dictionary){let o;if(typeof e.dictionary=="string"?o=ma.string2buf(e.dictionary):PT.call(e.dictionary)==="[object ArrayBuffer]"?o=new Uint8Array(e.dictionary):o=e.dictionary,r=sa.deflateSetDictionary(this.strm,o),r!==Uu)throw new Error(yn[r]);this._dict_set=!0}}i(ya,"Deflate$1");ya.prototype.push=function(t,e){let r=this.strm,o=this.options.chunkSize,n,s;if(this.ended)return!1;for(e===~~e?s=e:s=e===!0?pR:cR,typeof t=="string"?r.input=ma.string2buf(t):PT.call(t)==="[object ArrayBuffer]"?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){if(r.avail_out===0&&(r.output=new Uint8Array(o),r.next_out=0,r.avail_out=o),(s===uR||s===lR)&&r.avail_out<=6){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(n=sa.deflate(r,s),n===dR)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),n=sa.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Uu;if(r.avail_out===0){this.onData(r.output);continue}if(s>0&&r.next_out>0){this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;continue}if(r.avail_in===0)break}return!0};ya.prototype.onData=function(t){this.chunks.push(t)};ya.prototype.onEnd=function(t){t===Uu&&(this.result=zu.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function uf(t,e){let r=new ya(e);if(r.push(t,!0),r.err)throw r.msg||yn[r.err];return r.result}i(uf,"deflate$1");function gR(t,e){return e=e||{},e.raw=!0,uf(t,e)}i(gR,"deflateRaw$1");function yR(t,e){return e=e||{},e.gzip=!0,uf(t,e)}i(yR,"gzip$1");var wR=ya,SR=uf,bR=gR,TR=yR,AR=bn,xR={Deflate:wR,deflate:SR,deflateRaw:bR,gzip:TR,constants:AR},Ru=16209,ER=16191,CR=i(function(e,r){let o,n,s,c,p,d,m,f,g,w,y,S,b,T,A,E,I,P,U,O,_,H,Q,F,B=e.state;o=e.next_in,Q=e.input,n=o+(e.avail_in-5),s=e.next_out,F=e.output,c=s-(r-e.avail_out),p=s+(e.avail_out-257),d=B.dmax,m=B.wsize,f=B.whave,g=B.wnext,w=B.window,y=B.hold,S=B.bits,b=B.lencode,T=B.distcode,A=(1<<B.lenbits)-1,E=(1<<B.distbits)-1;e:do{S<15&&(y+=Q[o++]<<S,S+=8,y+=Q[o++]<<S,S+=8),I=b[y&A];t:for(;;){if(P=I>>>24,y>>>=P,S-=P,P=I>>>16&255,P===0)F[s++]=I&65535;else if(P&16){U=I&65535,P&=15,P&&(S<P&&(y+=Q[o++]<<S,S+=8),U+=y&(1<<P)-1,y>>>=P,S-=P),S<15&&(y+=Q[o++]<<S,S+=8,y+=Q[o++]<<S,S+=8),I=T[y&E];r:for(;;){if(P=I>>>24,y>>>=P,S-=P,P=I>>>16&255,P&16){if(O=I&65535,P&=15,S<P&&(y+=Q[o++]<<S,S+=8,S<P&&(y+=Q[o++]<<S,S+=8)),O+=y&(1<<P)-1,O>d){e.msg="invalid distance too far back",B.mode=Ru;break e}if(y>>>=P,S-=P,P=s-c,O>P){if(P=O-P,P>f&&B.sane){e.msg="invalid distance too far back",B.mode=Ru;break e}if(_=0,H=w,g===0){if(_+=m-P,P<U){U-=P;do F[s++]=w[_++];while(--P);_=s-O,H=F}}else if(g<P){if(_+=m+g-P,P-=g,P<U){U-=P;do F[s++]=w[_++];while(--P);if(_=0,g<U){P=g,U-=P;do F[s++]=w[_++];while(--P);_=s-O,H=F}}}else if(_+=g-P,P<U){U-=P;do F[s++]=w[_++];while(--P);_=s-O,H=F}for(;U>2;)F[s++]=H[_++],F[s++]=H[_++],F[s++]=H[_++],U-=3;U&&(F[s++]=H[_++],U>1&&(F[s++]=H[_++]))}else{_=s-O;do F[s++]=F[_++],F[s++]=F[_++],F[s++]=F[_++],U-=3;while(U>2);U&&(F[s++]=F[_++],U>1&&(F[s++]=F[_++]))}}else if(P&64){e.msg="invalid distance code",B.mode=Ru;break e}else{I=T[(I&65535)+(y&(1<<P)-1)];continue r}break}}else if(P&64)if(P&32){B.mode=ER;break e}else{e.msg="invalid literal/length code",B.mode=Ru;break e}else{I=b[(I&65535)+(y&(1<<P)-1)];continue t}break}}while(o<n&&s<p);U=S>>3,o-=U,S-=U<<3,y&=(1<<S)-1,e.next_in=o,e.next_out=s,e.avail_in=o<n?5+(n-o):5-(o-n),e.avail_out=s<p?257+(p-s):257-(s-p),B.hold=y,B.bits=S},"inflate_fast"),Ts=15,_b=852,Rb=592,Db=0,qm=1,Bb=2,kR=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),IR=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),FR=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),PR=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),vR=i((t,e,r,o,n,s,c,p)=>{let d=p.bits,m=0,f=0,g=0,w=0,y=0,S=0,b=0,T=0,A=0,E=0,I,P,U,O,_,H=null,Q,F=new Uint16Array(Ts+1),B=new Uint16Array(Ts+1),W=null,re,ee,Y;for(m=0;m<=Ts;m++)F[m]=0;for(f=0;f<o;f++)F[e[r+f]]++;for(y=d,w=Ts;w>=1&&F[w]===0;w--);if(y>w&&(y=w),w===0)return n[s++]=1<<24|64<<16|0,n[s++]=1<<24|64<<16|0,p.bits=1,0;for(g=1;g<w&&F[g]===0;g++);for(y<g&&(y=g),T=1,m=1;m<=Ts;m++)if(T<<=1,T-=F[m],T<0)return-1;if(T>0&&(t===Db||w!==1))return-1;for(B[1]=0,m=1;m<Ts;m++)B[m+1]=B[m]+F[m];for(f=0;f<o;f++)e[r+f]!==0&&(c[B[e[r+f]]++]=f);if(t===Db?(H=W=c,Q=20):t===qm?(H=kR,W=IR,Q=257):(H=FR,W=PR,Q=0),E=0,f=0,m=g,_=s,S=y,b=0,U=-1,A=1<<y,O=A-1,t===qm&&A>_b||t===Bb&&A>Rb)return 1;for(;;){re=m-b,c[f]+1<Q?(ee=0,Y=c[f]):c[f]>=Q?(ee=W[c[f]-Q],Y=H[c[f]-Q]):(ee=96,Y=0),I=1<<m-b,P=1<<S,g=P;do P-=I,n[_+(E>>b)+P]=re<<24|ee<<16|Y|0;while(P!==0);for(I=1<<m-1;E&I;)I>>=1;if(I!==0?(E&=I-1,E+=I):E=0,f++,--F[m]===0){if(m===w)break;m=e[r+c[f]]}if(m>y&&(E&O)!==U){for(b===0&&(b=y),_+=g,S=m-b,T=1<<S;S+b<w&&(T-=F[S+b],!(T<=0));)S++,T<<=1;if(A+=1<<S,t===qm&&A>_b||t===Bb&&A>Rb)return 1;U=E&O,n[U]=y<<24|S<<16|_-s|0}}return E!==0&&(n[_+E]=m-b<<24|64<<16|0),p.bits=y,0},"inflate_table"),ia=vR,_R=0,vT=1,_T=2,{Z_FINISH:Nb,Z_BLOCK:RR,Z_TREES:Du,Z_OK:Sn,Z_STREAM_END:DR,Z_NEED_DICT:BR,Z_STREAM_ERROR:fr,Z_DATA_ERROR:RT,Z_MEM_ERROR:DT,Z_BUF_ERROR:NR,Z_DEFLATED:Lb}=bn,Qu=16180,Mb=16181,Ub=16182,Ob=16183,qb=16184,zb=16185,Qb=16186,Hb=16187,Gb=16188,Kb=16189,Ou=16190,lo=16191,zm=16192,$b=16193,Qm=16194,jb=16195,Vb=16196,Wb=16197,Zb=16198,Bu=16199,Nu=16200,Yb=16201,Xb=16202,Jb=16203,eT=16204,tT=16205,Hm=16206,rT=16207,oT=16208,Ge=16209,BT=16210,NT=16211,LR=852,MR=592,UR=15,OR=UR,nT=i(t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24),"zswap32");function qR(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}i(qR,"InflateState");var Tn=i(t=>{if(!t)return 1;let e=t.state;return!e||e.strm!==t||e.mode<Qu||e.mode>NT?1:0},"inflateStateCheck"),LT=i(t=>{if(Tn(t))return fr;let e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=Qu,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(LR),e.distcode=e.distdyn=new Int32Array(MR),e.sane=1,e.back=-1,Sn},"inflateResetKeep"),MT=i(t=>{if(Tn(t))return fr;let e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,LT(t)},"inflateReset"),UT=i((t,e)=>{let r;if(Tn(t))return fr;let o=t.state;return e<0?(r=0,e=-e):(r=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?fr:(o.window!==null&&o.wbits!==e&&(o.window=null),o.wrap=r,o.wbits=e,MT(t))},"inflateReset2"),OT=i((t,e)=>{if(!t)return fr;let r=new qR;t.state=r,r.strm=t,r.window=null,r.mode=Qu;let o=UT(t,e);return o!==Sn&&(t.state=null),o},"inflateInit2"),zR=i(t=>OT(t,OR),"inflateInit"),sT=!0,Gm,Km,QR=i(t=>{if(sT){Gm=new Int32Array(512),Km=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(ia(vT,t.lens,0,288,Gm,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;ia(_T,t.lens,0,32,Km,0,t.work,{bits:5}),sT=!1}t.lencode=Gm,t.lenbits=9,t.distcode=Km,t.distbits=5},"fixedtables"),qT=i((t,e,r,o)=>{let n,s=t.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),o>=s.wsize?(s.window.set(e.subarray(r-s.wsize,r),0),s.wnext=0,s.whave=s.wsize):(n=s.wsize-s.wnext,n>o&&(n=o),s.window.set(e.subarray(r-o,r-o+n),s.wnext),o-=n,o?(s.window.set(e.subarray(r-o,r),0),s.wnext=o,s.whave=s.wsize):(s.wnext+=n,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=n))),0},"updatewindow"),HR=i((t,e)=>{let r,o,n,s,c,p,d,m,f,g,w,y,S,b,T=0,A,E,I,P,U,O,_,H,Q=new Uint8Array(4),F,B,W=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Tn(t)||!t.output||!t.input&&t.avail_in!==0)return fr;r=t.state,r.mode===lo&&(r.mode=zm),c=t.next_out,n=t.output,d=t.avail_out,s=t.next_in,o=t.input,p=t.avail_in,m=r.hold,f=r.bits,g=p,w=d,H=Sn;e:for(;;)switch(r.mode){case Qu:if(r.wrap===0){r.mode=zm;break}for(;f<16;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}if(r.wrap&2&&m===35615){r.wbits===0&&(r.wbits=15),r.check=0,Q[0]=m&255,Q[1]=m>>>8&255,r.check=ft(r.check,Q,2,0),m=0,f=0,r.mode=Mb;break}if(r.head&&(r.head.done=!1),!(r.wrap&1)||(((m&255)<<8)+(m>>8))%31){t.msg="incorrect header check",r.mode=Ge;break}if((m&15)!==Lb){t.msg="unknown compression method",r.mode=Ge;break}if(m>>>=4,f-=4,_=(m&15)+8,r.wbits===0&&(r.wbits=_),_>15||_>r.wbits){t.msg="invalid window size",r.mode=Ge;break}r.dmax=1<<r.wbits,r.flags=0,t.adler=r.check=1,r.mode=m&512?Kb:lo,m=0,f=0;break;case Mb:for(;f<16;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}if(r.flags=m,(r.flags&255)!==Lb){t.msg="unknown compression method",r.mode=Ge;break}if(r.flags&57344){t.msg="unknown header flags set",r.mode=Ge;break}r.head&&(r.head.text=m>>8&1),r.flags&512&&r.wrap&4&&(Q[0]=m&255,Q[1]=m>>>8&255,r.check=ft(r.check,Q,2,0)),m=0,f=0,r.mode=Ub;case Ub:for(;f<32;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}r.head&&(r.head.time=m),r.flags&512&&r.wrap&4&&(Q[0]=m&255,Q[1]=m>>>8&255,Q[2]=m>>>16&255,Q[3]=m>>>24&255,r.check=ft(r.check,Q,4,0)),m=0,f=0,r.mode=Ob;case Ob:for(;f<16;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}r.head&&(r.head.xflags=m&255,r.head.os=m>>8),r.flags&512&&r.wrap&4&&(Q[0]=m&255,Q[1]=m>>>8&255,r.check=ft(r.check,Q,2,0)),m=0,f=0,r.mode=qb;case qb:if(r.flags&1024){for(;f<16;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}r.length=m,r.head&&(r.head.extra_len=m),r.flags&512&&r.wrap&4&&(Q[0]=m&255,Q[1]=m>>>8&255,r.check=ft(r.check,Q,2,0)),m=0,f=0}else r.head&&(r.head.extra=null);r.mode=zb;case zb:if(r.flags&1024&&(y=r.length,y>p&&(y=p),y&&(r.head&&(_=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(o.subarray(s,s+y),_)),r.flags&512&&r.wrap&4&&(r.check=ft(r.check,o,y,s)),p-=y,s+=y,r.length-=y),r.length))break e;r.length=0,r.mode=Qb;case Qb:if(r.flags&2048){if(p===0)break e;y=0;do _=o[s+y++],r.head&&_&&r.length<65536&&(r.head.name+=String.fromCharCode(_));while(_&&y<p);if(r.flags&512&&r.wrap&4&&(r.check=ft(r.check,o,y,s)),p-=y,s+=y,_)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=Hb;case Hb:if(r.flags&4096){if(p===0)break e;y=0;do _=o[s+y++],r.head&&_&&r.length<65536&&(r.head.comment+=String.fromCharCode(_));while(_&&y<p);if(r.flags&512&&r.wrap&4&&(r.check=ft(r.check,o,y,s)),p-=y,s+=y,_)break e}else r.head&&(r.head.comment=null);r.mode=Gb;case Gb:if(r.flags&512){for(;f<16;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}if(r.wrap&4&&m!==(r.check&65535)){t.msg="header crc mismatch",r.mode=Ge;break}m=0,f=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=lo;break;case Kb:for(;f<32;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}t.adler=r.check=nT(m),m=0,f=0,r.mode=Ou;case Ou:if(r.havedict===0)return t.next_out=c,t.avail_out=d,t.next_in=s,t.avail_in=p,r.hold=m,r.bits=f,BR;t.adler=r.check=1,r.mode=lo;case lo:if(e===RR||e===Du)break e;case zm:if(r.last){m>>>=f&7,f-=f&7,r.mode=Hm;break}for(;f<3;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}switch(r.last=m&1,m>>>=1,f-=1,m&3){case 0:r.mode=$b;break;case 1:if(QR(r),r.mode=Bu,e===Du){m>>>=2,f-=2;break e}break;case 2:r.mode=Vb;break;case 3:t.msg="invalid block type",r.mode=Ge}m>>>=2,f-=2;break;case $b:for(m>>>=f&7,f-=f&7;f<32;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}if((m&65535)!==(m>>>16^65535)){t.msg="invalid stored block lengths",r.mode=Ge;break}if(r.length=m&65535,m=0,f=0,r.mode=Qm,e===Du)break e;case Qm:r.mode=jb;case jb:if(y=r.length,y){if(y>p&&(y=p),y>d&&(y=d),y===0)break e;n.set(o.subarray(s,s+y),c),p-=y,s+=y,d-=y,c+=y,r.length-=y;break}r.mode=lo;break;case Vb:for(;f<14;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}if(r.nlen=(m&31)+257,m>>>=5,f-=5,r.ndist=(m&31)+1,m>>>=5,f-=5,r.ncode=(m&15)+4,m>>>=4,f-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=Ge;break}r.have=0,r.mode=Wb;case Wb:for(;r.have<r.ncode;){for(;f<3;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}r.lens[W[r.have++]]=m&7,m>>>=3,f-=3}for(;r.have<19;)r.lens[W[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,F={bits:r.lenbits},H=ia(_R,r.lens,0,19,r.lencode,0,r.work,F),r.lenbits=F.bits,H){t.msg="invalid code lengths set",r.mode=Ge;break}r.have=0,r.mode=Zb;case Zb:for(;r.have<r.nlen+r.ndist;){for(;T=r.lencode[m&(1<<r.lenbits)-1],A=T>>>24,E=T>>>16&255,I=T&65535,!(A<=f);){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}if(I<16)m>>>=A,f-=A,r.lens[r.have++]=I;else{if(I===16){for(B=A+2;f<B;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}if(m>>>=A,f-=A,r.have===0){t.msg="invalid bit length repeat",r.mode=Ge;break}_=r.lens[r.have-1],y=3+(m&3),m>>>=2,f-=2}else if(I===17){for(B=A+3;f<B;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}m>>>=A,f-=A,_=0,y=3+(m&7),m>>>=3,f-=3}else{for(B=A+7;f<B;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}m>>>=A,f-=A,_=0,y=11+(m&127),m>>>=7,f-=7}if(r.have+y>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=Ge;break}for(;y--;)r.lens[r.have++]=_}}if(r.mode===Ge)break;if(r.lens[256]===0){t.msg="invalid code -- missing end-of-block",r.mode=Ge;break}if(r.lenbits=9,F={bits:r.lenbits},H=ia(vT,r.lens,0,r.nlen,r.lencode,0,r.work,F),r.lenbits=F.bits,H){t.msg="invalid literal/lengths set",r.mode=Ge;break}if(r.distbits=6,r.distcode=r.distdyn,F={bits:r.distbits},H=ia(_T,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,F),r.distbits=F.bits,H){t.msg="invalid distances set",r.mode=Ge;break}if(r.mode=Bu,e===Du)break e;case Bu:r.mode=Nu;case Nu:if(p>=6&&d>=258){t.next_out=c,t.avail_out=d,t.next_in=s,t.avail_in=p,r.hold=m,r.bits=f,CR(t,w),c=t.next_out,n=t.output,d=t.avail_out,s=t.next_in,o=t.input,p=t.avail_in,m=r.hold,f=r.bits,r.mode===lo&&(r.back=-1);break}for(r.back=0;T=r.lencode[m&(1<<r.lenbits)-1],A=T>>>24,E=T>>>16&255,I=T&65535,!(A<=f);){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}if(E&&!(E&240)){for(P=A,U=E,O=I;T=r.lencode[O+((m&(1<<P+U)-1)>>P)],A=T>>>24,E=T>>>16&255,I=T&65535,!(P+A<=f);){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}m>>>=P,f-=P,r.back+=P}if(m>>>=A,f-=A,r.back+=A,r.length=I,E===0){r.mode=tT;break}if(E&32){r.back=-1,r.mode=lo;break}if(E&64){t.msg="invalid literal/length code",r.mode=Ge;break}r.extra=E&15,r.mode=Yb;case Yb:if(r.extra){for(B=r.extra;f<B;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}r.length+=m&(1<<r.extra)-1,m>>>=r.extra,f-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=Xb;case Xb:for(;T=r.distcode[m&(1<<r.distbits)-1],A=T>>>24,E=T>>>16&255,I=T&65535,!(A<=f);){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}if(!(E&240)){for(P=A,U=E,O=I;T=r.distcode[O+((m&(1<<P+U)-1)>>P)],A=T>>>24,E=T>>>16&255,I=T&65535,!(P+A<=f);){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}m>>>=P,f-=P,r.back+=P}if(m>>>=A,f-=A,r.back+=A,E&64){t.msg="invalid distance code",r.mode=Ge;break}r.offset=I,r.extra=E&15,r.mode=Jb;case Jb:if(r.extra){for(B=r.extra;f<B;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}r.offset+=m&(1<<r.extra)-1,m>>>=r.extra,f-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=Ge;break}r.mode=eT;case eT:if(d===0)break e;if(y=w-d,r.offset>y){if(y=r.offset-y,y>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=Ge;break}y>r.wnext?(y-=r.wnext,S=r.wsize-y):S=r.wnext-y,y>r.length&&(y=r.length),b=r.window}else b=n,S=c-r.offset,y=r.length;y>d&&(y=d),d-=y,r.length-=y;do n[c++]=b[S++];while(--y);r.length===0&&(r.mode=Nu);break;case tT:if(d===0)break e;n[c++]=r.length,d--,r.mode=Nu;break;case Hm:if(r.wrap){for(;f<32;){if(p===0)break e;p--,m|=o[s++]<<f,f+=8}if(w-=d,t.total_out+=w,r.total+=w,r.wrap&4&&w&&(t.adler=r.check=r.flags?ft(r.check,n,w,c-w):pa(r.check,n,w,c-w)),w=d,r.wrap&4&&(r.flags?m:nT(m))!==r.check){t.msg="incorrect data check",r.mode=Ge;break}m=0,f=0}r.mode=rT;case rT:if(r.wrap&&r.flags){for(;f<32;){if(p===0)break e;p--,m+=o[s++]<<f,f+=8}if(r.wrap&4&&m!==(r.total&4294967295)){t.msg="incorrect length check",r.mode=Ge;break}m=0,f=0}r.mode=oT;case oT:H=DR;break e;case Ge:H=RT;break e;case BT:return DT;case NT:default:return fr}return t.next_out=c,t.avail_out=d,t.next_in=s,t.avail_in=p,r.hold=m,r.bits=f,(r.wsize||w!==t.avail_out&&r.mode<Ge&&(r.mode<Hm||e!==Nb))&&qT(t,t.output,t.next_out,w-t.avail_out),g-=t.avail_in,w-=t.avail_out,t.total_in+=g,t.total_out+=w,r.total+=w,r.wrap&4&&w&&(t.adler=r.check=r.flags?ft(r.check,n,w,t.next_out-w):pa(r.check,n,w,t.next_out-w)),t.data_type=r.bits+(r.last?64:0)+(r.mode===lo?128:0)+(r.mode===Bu||r.mode===Qm?256:0),(g===0&&w===0||e===Nb)&&H===Sn&&(H=NR),H},"inflate$2"),GR=i(t=>{if(Tn(t))return fr;let e=t.state;return e.window&&(e.window=null),t.state=null,Sn},"inflateEnd"),KR=i((t,e)=>{if(Tn(t))return fr;let r=t.state;return r.wrap&2?(r.head=e,e.done=!1,Sn):fr},"inflateGetHeader"),$R=i((t,e)=>{let r=e.length,o,n,s;return Tn(t)||(o=t.state,o.wrap!==0&&o.mode!==Ou)?fr:o.mode===Ou&&(n=1,n=pa(n,e,r,0),n!==o.check)?RT:(s=qT(t,e,r,r),s?(o.mode=BT,DT):(o.havedict=1,Sn))},"inflateSetDictionary"),jR=MT,VR=UT,WR=LT,ZR=zR,YR=OT,XR=HR,JR=GR,eD=KR,tD=$R,rD="pako inflate (from Nodeca project)",mo={inflateReset:jR,inflateReset2:VR,inflateResetKeep:WR,inflateInit:ZR,inflateInit2:YR,inflate:XR,inflateEnd:JR,inflateGetHeader:eD,inflateSetDictionary:tD,inflateInfo:rD};function oD(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}i(oD,"GZheader");var nD=oD,zT=Object.prototype.toString,{Z_NO_FLUSH:sD,Z_FINISH:iD,Z_OK:fa,Z_STREAM_END:$m,Z_NEED_DICT:jm,Z_STREAM_ERROR:aD,Z_DATA_ERROR:iT,Z_MEM_ERROR:cD}=bn;function wa(t){this.options=zu.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});let e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new FT,this.strm.avail_out=0;let r=mo.inflateInit2(this.strm,e.windowBits);if(r!==fa)throw new Error(yn[r]);if(this.header=new nD,mo.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=ma.string2buf(e.dictionary):zT.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=mo.inflateSetDictionary(this.strm,e.dictionary),r!==fa)))throw new Error(yn[r])}i(wa,"Inflate$1");wa.prototype.push=function(t,e){let r=this.strm,o=this.options.chunkSize,n=this.options.dictionary,s,c,p;if(this.ended)return!1;for(e===~~e?c=e:c=e===!0?iD:sD,zT.call(t)==="[object ArrayBuffer]"?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(o),r.next_out=0,r.avail_out=o),s=mo.inflate(r,c),s===jm&&n&&(s=mo.inflateSetDictionary(r,n),s===fa?s=mo.inflate(r,c):s===iT&&(s=jm));r.avail_in>0&&s===$m&&r.state.wrap>0&&t[r.next_in]!==0;)mo.inflateReset(r),s=mo.inflate(r,c);switch(s){case aD:case iT:case jm:case cD:return this.onEnd(s),this.ended=!0,!1}if(p=r.avail_out,r.next_out&&(r.avail_out===0||s===$m))if(this.options.to==="string"){let d=ma.utf8border(r.output,r.next_out),m=r.next_out-d,f=ma.buf2string(r.output,d);r.next_out=m,r.avail_out=o-m,m&&r.output.set(r.output.subarray(d,d+m),0),this.onData(f)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(!(s===fa&&p===0)){if(s===$m)return s=mo.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(r.avail_in===0)break}}return!0};wa.prototype.onData=function(t){this.chunks.push(t)};wa.prototype.onEnd=function(t){t===fa&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=zu.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function lf(t,e){let r=new wa(e);if(r.push(t),r.err)throw r.msg||yn[r.err];return r.result}i(lf,"inflate$1");function uD(t,e){return e=e||{},e.raw=!0,lf(t,e)}i(uD,"inflateRaw$1");var lD=wa,pD=lf,dD=uD,mD=lf,fD=bn,hD={Inflate:lD,inflate:pD,inflateRaw:dD,ungzip:mD,constants:fD},{Deflate:gD,deflate:yD,deflateRaw:wD,gzip:SD}=xR,{Inflate:bD,inflate:TD,inflateRaw:AD,ungzip:xD}=hD,ED=gD,CD=yD,kD=wD,ID=SD,FD=bD,PD=TD,vD=AD,_D=xD,RD=bn,pf={Deflate:ED,deflate:CD,deflateRaw:kD,gzip:ID,Inflate:FD,inflate:PD,inflateRaw:vD,ungzip:_D,constants:RD};u();l();var Hu=class{static{i(this,"StreamedQuoteQueue")}maxSize=5;items=[];enqueue(e,r,o){let n=this.processQuoteResponse(e,r,o?.join(","));this.items.push(n),this.items.length>this.maxSize&&this.items.shift()}getItems(){return[...this.items]}size(){return this.items.length}clear(){this.items=[]}processQuoteResponse(e,r,o){return{quotes:e.quotes.map(s=>({amountIn:s.sellAmount,amountOut:s.buyAmount,tokenIn:L(e.sellToken),tokenOut:L(e.buyToken),provider:s.baseProvider.name})),timestamp:Date.now(),selectedProvider:r,alerts:o}}};var DD="Sq+",df=class{static{i(this,"StreamedQuoteLogger")}queue=new Hu;addQuoteResponse(e,r,o){this.queue.enqueue(e,r,o)}reset(){this.queue.clear()}getQuotes(){return this.queue.getItems()}logState(e){let r=this.getStateData(e);k.addBreadcrumb(v.Generic,`${DD}${r}`,D.Info)}processQuoteProcessorState(e){switch(e.type){case"starting":this.reset();break;case"quoteProcessed":this.addQuoteResponse(e.response,e.input.preferredProvider,[...e.quoteDetails.alerts,...e.quoteDetails.warnings].map(r=>r.toString()));break;default:break}}getStateData(e){let r=this.queue.getItems(),o=this.compactData(r,e),n=pf.gzip(JSON.stringify(o));return Buffer.from(n).toString("base64")}compactData(e,r){return e.length===0?null:{items:e.map(o=>({q:o.quotes.map(n=>({i:n.amountIn,o:n.amountOut,p:n.provider,ti:n.tokenIn,to:n.tokenOut})),t:o.timestamp,sp:o.selectedProvider,a:o.alerts})),th:r}}expandData(e){return e.items.map(r=>({quotes:r.q.map(o=>({amountIn:o.i,amountOut:o.o,tokenIn:o.ti,tokenOut:o.to,provider:o.p})),timestamp:r.t,selectedProvider:r.sp,alerts:r.a}))}decode(e){try{let r=Buffer.from(e,"base64"),o=pf.inflate(r,{to:"string"}),n=JSON.parse(o);return n?{items:this.expandData(n),txnHash:n.th}:{items:[]}}catch(r){return console.error("Failed to decode compressed data:",r),{items:[]}}}},Zo=new df;u();l();u();l();var M;(function(t){t.AccountFrozen="AccountFrozen",t.NoCurrentQuoteError="Trying to execute swap with no current quote",t.NoQuoteResponseError="Trying to execute swap with no quote response",t.NoGasEstimation="No gas estimation available",t.NoSwapTransactions="No swap transactions available",t.InsufficientFunds="INSUFFICIENT_FUNDS",t.InsufficientGas="INSUFFICIENT_GAS",t.SlippageExceeded="slippageToleranceExceeded",t.SimulationTimeout="SIMULATION_TIMEOUT",t.NotValidScanResultsError="Scan results are not valid",t.StaleQuote="STALE_QUOTE",t.NotEnoughSol="NotEnoughSol",t.TransactionConfirmationFailed="Transaction confirmation failed",t.SimulationUnknownError="SimulationUnknownError",t.UnknownError="UnknownError",t.MissingArgument="MissingArgument",t.EmptyRoute="EmptyRoute",t.InvalidCalculation="InvalidCalculation",t.MissingPlatformFeeAccount="MissingPlatformFeeAccount",t.InvalidSlippage="InvalidSlippage",t.NotEnoughPercent="NotEnoughPercent",t.InvalidInputIndex="InvalidInputIndex",t.InvalidOutputIndex="InvalidOutputIndex",t.NotEnoughAccountKeys="NotEnoughAccountKeys",t.NonZeroMinimumOutAmountNotSupported="NonZeroMinimumOutAmountNotSupported",t.InvalidRoutePlan="InvalidRoutePlan",t.InvalidReferralAuthority="InvalidReferralAuthority",t.LedgerTokenAccountDoesNotMatch="LedgerTokenAccountDoesNotMatch",t.InvalidTokenLedger="InvalidTokenLedger",t.IncorrectTokenProgramID="IncorrectTokenProgramID",t.TokenProgramNotProvided="TokenProgramNotProvided",t.SwapNotSupported="SwapNotSupported",t.ExactOutAmountNotMatched="ExactOutAmountNotMatched",t.SourceAndDstinationMintCannotBeTheSame="SourceAndDstinationMintCannotBeTheSame",t.LedgerConnectionError="LedgerConnectionError",t.LedgerRejectAction="LedgerRejectAction",t.LedgerUnknownSignError="LedgerUnknownSignError",t.LedgerUnknownError="LedgerUnknownError"})(M||(M={}));var _e=class extends Error{static{i(this,"SwapperError")}code;detailMessage;constructor(e,r){super(e),this.code=e,this.detailMessage=r}};var BD=M.SlippageExceeded,ND=M.InsufficientFunds,LD=by,MD="insufficient lamports",UD="lower balance than rent-exempt minimum",OD=Sy,qD="Transaction confirmation failed",zD=["Ledger App not open","Ledger not connected","Unable to connect to Ledger","Unable to connect to Ledger device","Need permission to connect to Ledger"],QD="Ledger user rejected action",HD="Ledger Sign Error";function GD(t){try{return Number(t.split('"Custom":')[1].split("}")[0])}catch{return null}}i(GD,"parseProgramErrorCode");var KD={301:M.SlippageExceeded,6e3:M.EmptyRoute,6001:M.SlippageExceeded,6002:M.InvalidCalculation,6003:M.MissingPlatformFeeAccount,6004:M.InvalidSlippage,6005:M.NotEnoughPercent,6006:M.InvalidInputIndex,6007:M.InvalidOutputIndex,6008:M.NotEnoughAccountKeys,6009:M.NonZeroMinimumOutAmountNotSupported,6010:M.InvalidRoutePlan,6011:M.InvalidReferralAuthority,6012:M.LedgerTokenAccountDoesNotMatch,6013:M.InvalidTokenLedger,6014:M.IncorrectTokenProgramID,6015:M.TokenProgramNotProvided,6016:M.SwapNotSupported,6017:M.ExactOutAmountNotMatched,6018:M.SourceAndDstinationMintCannotBeTheSame},$D={6019:M.InvalidSlippage,6020:M.MissingArgument,6021:M.MissingArgument,6022:M.SwapNotSupported,6023:M.SwapNotSupported,6024:M.SwapNotSupported,6025:M.SwapNotSupported,6026:M.SwapNotSupported,6027:M.MissingArgument,6028:M.InvalidCalculation,6035:M.MissingPlatformFeeAccount,6036:M.InsufficientFunds,6038:M.MissingArgument,6039:M.MissingPlatformFeeAccount,6047:M.MissingArgument,6048:M.MissingArgument,6049:M.MissingArgument,6051:M.MissingPlatformFeeAccount,6072:M.InsufficientFunds,6073:M.InsufficientFunds,6080:M.InsufficientFunds,6074:M.IncorrectTokenProgramID,6077:M.TokenProgramNotProvided},jD={15e3:M.SwapNotSupported,15001:M.SlippageExceeded,15004:M.InsufficientFunds,15006:M.StaleQuote,15015:M.InvalidCalculation,15016:M.InvalidCalculation,15017:M.InvalidCalculation,15021:M.MissingArgument,15022:M.TokenProgramNotProvided,15025:M.SlippageExceeded,15028:M.MissingArgument};function VD(t){let e=GD(t.message);return e===null?null:KD[e]??$D[e]??jD[e]??null}i(VD,"parseProgramError");function WD(t){return zD.some(r=>t.message.includes(r))?M.LedgerConnectionError:t.message.includes(QD)?M.LedgerRejectAction:t.message.includes(HD)?M.LedgerUnknownSignError:t.message.toLowerCase().includes("ledger")?M.LedgerUnknownError:null}i(WD,"parseLedgerError");function Yo(t){if(t===void 0)return new _e(M.UnknownError,"No error provided");if(t instanceof _e)return t;let e=ZD(t);if(e.message.includes(ND))return new _e(M.InsufficientFunds);if(YD(e.message))return new _e(M.SlippageExceeded);if(e.message===M.NotValidScanResultsError)return new _e(M.NotValidScanResultsError);if([LD,MD,OD,UD].some(d=>e.message.includes(d)))return new _e(M.NotEnoughSol);let s=VD(e);if(s!==null)return new _e(s);if(e.message.includes(qD))return new _e(M.TransactionConfirmationFailed);let p=WD(e);return p!==null?new _e(p):new _e(M.UnknownError,e.message)}i(Yo,"parseSwapError");function ZD(t){return typeof t=="string"?new Error(t):typeof t=="object"&&"logs"in t&&t.logs?.length?new Error(t.logs.join(`
`)):t}i(ZD,"normalizeError");function YD(t){return t.includes(BD)}i(YD,"errorMessageFailsFromSlippage");u();l();u();l();var QT=3;function Gu(){try{let t=zt.getMultivariateAssignment("swapper-high-slippage-threshold"),e=Number(t);return!t||isNaN(e)?QT:e}catch{return QT}}i(Gu,"getHighSlippageThreshold");var HT=i(({currentQuote:t,quoteResponse:e,gasEstimation:r,swapTransactions:o,scanResults:n,isSwapSimulationDisabled:s,slippageTolerance:c})=>{if(!t)throw new _e(M.NoCurrentQuoteError);if(!e)throw new _e(M.NoQuoteResponseError);if(C.isEVMNetworkID(e.sellToken.chainId)&&(!r||r?.length===0||r?.length<(o?.transactions.length??1)))throw new _e(M.NoGasEstimation);if(!o)throw new _e(M.NoSwapTransactions);if(n.state!=="valid"&&(k.addBreadcrumb(v.Swapper,"swapSimulationNotValid",D.Info,$n({scanResults:n.state})),!s)){let d=[M.NotValidScanResultsError,M.AccountFrozen,M.InsufficientFunds,M.InsufficientGas,M.SlippageExceeded,M.SimulationTimeout,M.MissingArgument,M.StaleQuote,M.SimulationUnknownError];if(JD(n.state)&&d.includes(n.state.code)){if(XD(n.state,c))return;throw n.state}else throw new _e(M.NotValidScanResultsError)}},"validateSwap");function XD(t,e){return t.code===M.SlippageExceeded&&e&&e>=Gu()}i(XD,"shouldSuppressError");function JD(t){return t instanceof _e}i(JD,"isSwapperError");var e1={swap:{solana:"executeSolanaSwap",evm:"executeEvmSwap",sui:"executeSuiSwap",bitcoin:"executeBitcoinSwap"},bridge:{solana:"executeSolanaBridge",evm:"executeEvmBridge",sui:"executeSuiBridge",bitcoin:"executeBitcoinBridge"}},mf=i((t,e)=>e1[t?"bridge":"swap"][e??"solana"],"getExecuteSwapSpanName"),GT=i(async({isBridge:t,addressType:e,isSwapSimulationDisabled:r,sender:o,currentQuote:n,quoteResponse:s,gasEstimation:c,swapTransactions:p,scanResults:d,pendingActivityRows:m,connection:f,logSwapFailureNoSignature:g,logTransactionSubmitted:w,onTransactionReceiptReceived:y,onTransactionSubmissionError:S,resetToInitialState:b,slippageTolerance:T,swapFungibles:A})=>{await k.startSpan(mf(t,p?.type),async()=>{b();let E;try{HT({currentQuote:n,quoteResponse:s,gasEstimation:c,swapTransactions:p,scanResults:d,isSwapSimulationDisabled:r,slippageTolerance:T});let I=await A({type:e,callerAddress:o,swapTransactions:p,pendingSwapActivityRows:m.pendingSwapActivityRows,pendingApprovalActivityRows:m.pendingApprovalActivityRows,gasEstimation:c,connection:f});if(y(I),I.error)throw I.id||g(),E=I.id,I.error;w(I),Zo.logState(I.id)}catch(I){let P=Yo(I);S(P,E)}})},"executeSwap");u();l();var xt;(function(t){t.SetPair="setPair",t.QuoteRequestStarted="quoteRequestStarted",t.QuoteResponseReceived="quoteResponseReceived",t.QuoteResponseStreamed="quoteResponseStreamed",t.QuoteRequestError="quoteRequestError",t.UserSelectedQuote="userSelectedQuote"})(xt||(xt={}));u();l();u();l();var ke;(function(t){t.SlippageExceeded="SLIPPAGE_EXCEEDED",t.InsufficientFunds="INSUFFICIENT_FUNDS",t.InsufficientGas="INSUFFICIENT_GAS",t.AccountFrozen="ACCOUNT_FROZEN",t.SimulationTimeout="SIMULATION_TIMEOUT",t.StaleQuote="STALE_QUOTE",t.UnknownError="UNKNOWN_ERROR",t.SimulationFailed="SIMULATION_FAILED"})(ke||(ke={}));var Fs=class t extends Error{static{i(this,"SimulationError")}scannedTransactionResult;type;detailMessage;constructor(e,r,o){super(e),this.scannedTransactionResult=r,this.type=o,r&&(this.detailMessage=r.simulationError?.humanReadableError??(r.warnings.length>0?r.warnings[0].message:void 0)),this.type=o}static fromError(e){return e instanceof t?e:new t(e.message)}static fromScannedTransactionResult(e,r){return i(n=>Object.values(ke).includes(n),"isSimulationErrorType")(e)?new t(e,r,e):new t(e,r)}};u();l();var Ps=class t extends Error{static{i(this,"SubmissionError")}type;constructor(e,r){super(e),this.type=r}static fromError(e){return new t(e.message)}static fromType(e){return new t(e,e)}};var KT="https://phantom.com",Ku=class{static{i(this,"EventfulSwapCommand")}swapCommand;send;executingQuote;takerAddress;networkId;quote;executionId;constructor(e,r,o){this.swapCommand=e,this.send=r,this.executingQuote=o,this.takerAddress=e.takerAddress,this.networkId=e.networkId,this.quote=e.quote,this.executionId=e.executionId}createTransaction(){return this.send({type:Z.ExecuteSwapStarted,executionId:this.executionId,executingQuote:this.executingQuote}),this.swapCommand.createTransaction()}async fetchSimulation(e){let{transactions:r,deviceId:o,isSimulationKilled:n}=e,s=Yt(R.language)??"en";if(C.isSuiNetworkID(this.networkId))return{result:{type:"transaction",expectedChanges:[],warnings:[],advancedDetails:void 0,error:void 0,simulationError:void 0,block:void 0}};if(C.isBitcoinNetworkID(this.networkId))return{result:{type:"transaction",expectedChanges:[],warnings:[],advancedDetails:void 0,error:void 0,simulationError:void 0,block:void 0}};let c=await ys({transactions:r,locale:s,url:KT,deviceId:o,takerAddress:this.takerAddress,networkId:this.networkId,slippageType:this.executingQuote.slippageType,quote:this.quote,quoteResponse:this.executingQuote.response,isSimulationKilled:n});return c.status==="success"?{result:c.result}:{result:null,skipReason:c.skipReason}}async simulate(e,r,o,n){try{this.send({type:Z.SimulationRequestStarted,executionId:this.executionId,executingQuote:this.executingQuote,networkId:this.networkId});let s=await this.fetchSimulation({transactions:e,deviceId:o,isSimulationKilled:n});if(!s.result)return this.send({type:Z.SimulationSkipped,executionId:this.executionId,networkId:this.networkId,skipReason:s.skipReason}),null;let c=s.result;switch(c.error){case void 0:break;case ke.SimulationFailed:break;case ke.SlippageExceeded:if(this.executingQuote.response.slippageTolerance>=Gu())break;default:throw Fs.fromScannedTransactionResult(c.error,c)}return this.send({type:Z.SimulationPassed,scannedTransactionResult:c,executionId:this.executionId,networkId:this.networkId}),c}catch(s){throw this.send({type:Z.SimulationFailed,error:Fs.fromError(s),executionId:this.executionId,networkId:this.networkId,url:KT}),s}}async swap(e,r,o,n,s){this.send({type:Z.TransactionSubmissionStarted,executionId:this.executionId});try{let c=await this.swapCommand.swap(e,r,o,n,s);if(!c.id)throw Ps.fromType("noSignature");return this.send({type:Z.TransactionSubmissionSuccess,txReceipt:c,executionId:this.executionId}),c}catch(c){let p=c instanceof Ps?c:Ps.fromError(c);throw this.send({type:Z.TransactionSubmissionFailed,error:p,executionId:this.executionId}),p}}async waitForConfirmation(e){this.send({type:Z.TransactionConfirmationStarted,executionId:this.executionId,txReceipt:e});try{let r=await this.swapCommand.waitForConfirmation(e);return this.send({type:Z.TransactionConfirmed,executionId:this.executionId,txReceipt:e}),r}catch(r){throw this.send({type:Z.TransactionConfirmationFailed,error:r,txReceipt:e,executionId:this.executionId}),r}}};u();l();var $u=class extends Error{static{i(this,"ExecuteSwapIllegalTransitionError")}constructor(e,r){let n=(Array.isArray(r)?r:[r]).join(", ");super(`Can't transition to ${n} from ${e.type}`)}},ju=class{static{i(this,"ExecuteSwapStateMachine")}state=new Map;listeners=new Set;send(e){e.type===Z.ExecuteSwapStarted&&this.state.set(e.executionId,{type:Ce.Idle,executingQuote:e.executingQuote});let r=this.state.get(e.executionId);if(!r)throw new Error(`No previous state found for execution id: ${e.executionId}`);let o=r;try{return o=this.detectNextState(r,e),o.type===Ce.TransactionConfirmed?this.state.delete(e.executionId):this.state.set(e.executionId,o),o}catch{return r}finally{this.notifyListeners(e,r,o,this.state)}}notifyListeners(e,r,o,n){this.listeners.forEach(s=>{try{s.onStateChange(e,r,o,n)}catch(c){console.error("Error notifying ExecuteSwapStateListener:",c)}})}getState(){return this.state}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}detectNextState(e,r){switch(r.type){case Z.ExecuteSwapStarted:return Vr(e,Ce.Idle),{type:Ce.Started,executingQuote:r.executingQuote};case Z.SimulationRequestStarted:return Vr(e,Ce.Started),{type:Ce.Simulating,executingQuote:e.executingQuote};case Z.SimulationPassed:return Vr(e,Ce.Simulating),{type:Ce.Simulated,scannedTransactionResult:r.scannedTransactionResult,executingQuote:e.executingQuote};case Z.SimulationFailed:return Vr(e,Ce.Simulating),{type:Ce.SimulationFailed,error:r.error,executingQuote:e.executingQuote};case Z.SimulationSkipped:return Vr(e,Ce.Simulating),{type:Ce.SimulationSkipped,executingQuote:e.executingQuote};case Z.TransactionSubmissionStarted:return t1(e,[Ce.Simulated,Ce.SimulationSkipped]),{type:Ce.SubmittingTransaction,executingQuote:e.executingQuote,scannedTransactionResult:e.type===Ce.Simulated?e.scannedTransactionResult:void 0};case Z.TransactionSubmissionFailed:return Vr(e,Ce.SubmittingTransaction),{type:Ce.TransactionSubmissionFailed,error:r.error,executingQuote:e.executingQuote,scannedTransactionResult:e.scannedTransactionResult};case Z.TransactionSubmissionSuccess:return Vr(e,Ce.SubmittingTransaction),{type:Ce.TransactionSubmitted,txReceipt:r.txReceipt,executingQuote:e.executingQuote,scannedTransactionResult:e.scannedTransactionResult};case Z.TransactionConfirmationStarted:return Vr(e,Ce.TransactionSubmitted),{type:Ce.ConfirmingTransaction,txReceipt:e.txReceipt,scannedTransactionResult:e.scannedTransactionResult,executingQuote:e.executingQuote};case Z.TransactionConfirmationFailed:return Vr(e,Ce.TransactionSubmitted),{type:Ce.TransactionNotConfirmed,txReceipt:e.txReceipt,scannedTransactionResult:e.scannedTransactionResult,error:r.error,executingQuote:e.executingQuote};case Z.TransactionConfirmed:return Vr(e,Ce.ConfirmingTransaction),{type:Ce.TransactionConfirmed,txReceipt:e.txReceipt,scannedTransactionResult:e.scannedTransactionResult,executingQuote:e.executingQuote}}}};function Vr(t,e){if(t.type!==e)throw new $u(t,e)}i(Vr,"checkState");function t1(t,e){if(!e.includes(t.type))throw new $u(t,e)}i(t1,"checkStateAny");u();l();var Ke;(function(t){t.Idle="idle",t.Pair="pair",t.FetchingQuote="fetchingQuote",t.QuoteError="quoteError",t.Quote="quote",t.ExecutingSwap="executingSwap",t.SwapConfirmed="swapConfirmed"})(Ke||(Ke={}));function $T(t){return t.type===Ke.Quote}i($T,"isExecutableSwapState");u();l();u();l();var r1={"Could not find any routes":"noRoute"},Vu=class t extends Error{static{i(this,"QuoteError")}type;constructor(e,r){super(r??e),this.type=e}static fromMessage(e){let r=e?r1[e]??"undefinedError":"undefinedError";return new t(r,e)}};var An=class extends Error{static{i(this,"SwapperIllegalTransitionError")}constructor(e,r){super(`Can't transition to ${r} from ${e.type}`)}},Wu=class{static{i(this,"SwapperStateMachine")}state;listeners=new Set;constructor(e){this.state=e??{type:Ke.Idle}}send(e){let r=this.state;try{return r=this.detectNextState(this.state,e),this.state=r,r}catch{return this.state}finally{this.notifyListeners(e,this.state,r)}}getState(){return this.state}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}notifyListeners(e,r,o){try{this.listeners.forEach(n=>n.onStateChange(e,r,o))}catch{}}detectNextState(e,r){switch(r.type){case xt.SetPair:return{type:Ke.Pair,buy:r.buy,sell:r.sell,amount:r.amount};case xt.QuoteRequestStarted:switch(e.type){case Ke.Pair:case Ke.Quote:case Ke.QuoteError:return{type:Ke.FetchingQuote,buy:e.buy,sell:e.sell,amount:r.amount,slippageType:r.slippageType};default:throw new An(e,r.type)}case xt.QuoteRequestError:if(e.type!==Ke.FetchingQuote)throw new An(e,r.type);return{type:Ke.QuoteError,buy:e.buy,sell:e.sell,amount:e.amount,error:r.error,slippageType:e.slippageType};case xt.QuoteResponseReceived:if(e.type!==Ke.FetchingQuote)throw new An(e,r.type);let o=r.response.quotes[0];return o?{type:Ke.Quote,response:r.response,buy:e.buy,sell:e.sell,quote:o,amount:e.amount,slippageType:e.slippageType}:{type:Ke.QuoteError,buy:e.buy,sell:e.sell,amount:e.amount,error:new Vu("noRoute"),slippageType:e.slippageType};case xt.QuoteResponseStreamed:switch(e.type){case Ke.Pair:case Ke.FetchingQuote:case Ke.Quote:case Ke.QuoteError:return{type:Ke.Quote,response:r.response,buy:e.buy,sell:e.sell,quote:r.quote,amount:{amount:r.quoteInput.amount,perspective:r.quoteInput.exactOut?"buy":"sell"},slippageType:r.quoteInput.autoSlippage?fe.Auto:fe.Fixed,input:r.quoteInput};default:throw new An(e,r.type)}case xt.UserSelectedQuote:if(e.type!==Ke.Quote)throw new An(e,r.type);return{type:Ke.Quote,quote:r.quote,buy:e.buy,sell:e.sell,response:e.response,amount:e.amount,slippageType:e.slippageType}}}};u();l();u();l();var jT=a.object({buyToken:a.custom(),sellToken:a.custom(),buyTokenPrice:a.custom().optional(),sellTokenPrice:a.custom().optional(),maxSellAmount:a.string().optional(),isPrediction:a.boolean().optional()}),Sa=class t extends Error{static{i(this,"SwapInitializationError")}type;constructor(e,r){super(r??e.name),this.type=e}static fromError(e){return new t({name:"unknown"},e.message)}};function ff(t,e){if(t.type!==e.type)return!1;switch(t.type){case"buy":return e.type!=="buy"?!1:t.buyCaip19===e.buyCaip19&&t.sellCaip19===e.sellCaip19&&t.takerCaip19===e.takerCaip19&&t.takerDestinationCaip19===e.takerDestinationCaip19&&t.options===e.options&&t.buyFungibleKey===e.buyFungibleKey;case"sell":return e.type!=="sell"?!1:t.sellCaip19===e.sellCaip19&&t.buyCaip19===e.buyCaip19&&t.takerCaip19===e.takerCaip19&&t.takerDestinationCaip19===e.takerDestinationCaip19&&t.options===e.options&&t.sellFungibleKey===e.sellFungibleKey;case"swap":return e.type!=="swap"?!1:t.network===e.network&&t.sellCaip19===e.sellCaip19&&t.buyCaip19===e.buyCaip19&&t.takerCaip19===e.takerCaip19&&t.takerDestinationCaip19===e.takerDestinationCaip19&&t.options===e.options;case"prediction":{if(e.type!=="prediction"||t.mode.direction!==e.mode.direction||t.outcomeType!==e.outcomeType||t.network!==e.network||t.takerCaip19!==e.takerCaip19||t.takerDestinationCaip19!==e.takerDestinationCaip19||t.options!==e.options)return!1;if(t.mode.direction==="buy"){if(e.mode.direction!=="buy"||t.mode.sellCaip19!==e.mode.sellCaip19)return!1}else if(e.mode.direction!=="sell"||t.mode.sellMintAddress!==e.mode.sellMintAddress)return!1;return t.mintAccounts===e.mintAccounts}default:{let r=t;return!1}}}i(ff,"isSwapModeEqual");var fo=class{static{i(this,"BackendSwapInitializer")}async initialize(e,r,o,n){let s=r.reduce((d,m)=>(d[m.networkID]=m.address,d),{}),c=await G.api().headers({"Content-Type":"application/json"}).timeout(j({seconds:20})).post("/swap/v2/initialize",{...e,addresses:s,cashAddresses:Nr?o:void 0,...n?{settings:n}:{}});if(c.status!==200)throw new tt({key:"SwapInitializationFailed"});let p=jT.safeParse(c.data);if(!p.success)throw new tt({key:"SwapInitializationFailed"});return{...p.data,takerCaip19:this.takerCaip19ForToken({token:p.data.sellToken,addresses:r}),takerDestinationCaip19:this.takerCaip19ForToken({token:p.data.buyToken,addresses:r})}}takerCaip19ForToken({token:e,addresses:r}){if(e.data.walletAddress&&fc(e))return L({chainId:e.data.chain.id,resourceType:V.address,address:e.data.walletAddress});let o=this.findChainAddress({chain:e.data.chain,addresses:r});return L({chainId:o.networkID,resourceType:V.address,address:o.address})}findChainAddress({chain:e,addresses:r}){let{id:o}=e,n=r.find(c=>c.networkID===o);if(!n)throw new Error(`No address found for chain ${o}`);let s={...n};return Lr(s)&&(s.address=s.address.toLowerCase()),s}};u();l();var vs=class{static{i(this,"BitcoinSwapInitializer")}proxyInitializer;constructor(e){this.proxyInitializer=e}async initialize(e,r,o,n){let s=this.getBitcoinAddressTypeForKey(e);if(!s)return this.proxyInitializer.initialize(e,r,o,n);let{key:c,addressType:p,direction:d}=s,m=o1(r,w=>{if(!(vg(w)&&w.addressType!==p))return w}),f=r.find(w=>w.addressType===p);if(!f)return this.proxyInitializer.initialize(e,r,o,n);switch(d){case"buy":e.takerDestinationCaip19=L({chainId:f.networkID,resourceType:V.address,address:f.address});break;case"sell":e.takerCaip19=L({chainId:f.networkID,resourceType:V.address,address:f.address});break}let g=await this.proxyInitializer.initialize(e,m,o,n);switch(d){case"buy":g.buyToken.data.key=c;break;case"sell":g.sellToken.data.key=c;break}switch(d){case"buy":g.takerCaip19=this.takerCaip19ForToken({token:g.sellToken,addresses:m});break;case"sell":g.takerDestinationCaip19=this.takerCaip19ForToken({token:g.buyToken,addresses:m});break}return g}keyToAddressType={"BitcoinNative-bip122_p2wpkh":se.BitcoinNativeSegwit,"BitcoinNative-bip122_p2tr":se.BitcoinTaproot,BitcoinNative:se.BitcoinTaproot};getBitcoinAddressTypeForKey(e){if(!(e.type!=="buy"&&e.type!=="sell"&&e.type!=="swap")){if(e.sellFungibleKey){let r=this.keyToAddressType[e.sellFungibleKey];if(r)return{key:e.sellFungibleKey,addressType:r,direction:"sell"}}if(e.buyFungibleKey){let r=this.keyToAddressType[e.buyFungibleKey];if(r)return{key:e.buyFungibleKey,addressType:r,direction:"buy"}}}}takerCaip19ForToken({token:e,addresses:r}){if(e.data.walletAddress)return L({chainId:e.data.chain.id,resourceType:V.address,address:e.data.walletAddress});let o=this.findChainAddress({chain:e.data.chain,addresses:r});return L({chainId:o.networkID,resourceType:V.address,address:o.address})}findChainAddress({chain:e,addresses:r}){let{id:o}=e,n=r.find(c=>c.networkID===o);if(!n)throw new Error(`No address found for chain ${o}`);let s={...n};return Lr(s)&&(s.address=s.address.toLowerCase()),s}};function o1(t,e){return t.reduce((r,o)=>{let n=e(o);return n!=null&&r.push(n),r},[])}i(o1,"compactMap");u();l();function VT(t){if(t.type!=="pair")return;let{mode:e,buyToken:r,sellToken:o}=t;if(e.type!=="swap")throw new Error("Can't switch swap mode for: "+e.type);let n=L(X(t.buyToken)),s=L(X(t.sellToken)),c=t.takerDestinationCaip19,p=t.takerCaip19,d=r.data.key,m=o.data.key;return{type:"swap",network:n?We(n).chainId:C.solana.mainnetID,sellCaip19:n,buyCaip19:s,takerCaip19:c,takerDestinationCaip19:p,sellFungibleKey:d,buyFungibleKey:m}}i(VT,"switchSwapMode");u();l();u();l();u();l();u();l();u();l();u();l();var hf={id:C.solana.mainnetID,imageUrl:C.solana.iconUrl,name:C.solana.name,symbol:C.solana.tokenSymbol},xn={type:ae.SolanaNative,data:{amount:"0",balance:new K(0),chain:hf,decimals:9,key:"SolanaNative",logoUri:"https://cdn.jsdelivr.net/gh/solana-labs/token-list@main/assets/mainnet/So11111111111111111111111111111111111111112/logo.png",name:"Solana",symbol:"SOL",tokenAddress:void 0,walletAddress:"",spamStatus:de.Verified}},WT={type:ae.SPL,data:{amount:"0",balance:new K(0),chain:hf,decimals:6,key:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",logoUri:"https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v/logo.png",mintAddress:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",name:"USD Coin",splTokenAccountPubkey:"EAF7dH8Jy43Xgp68PhyybKhfKxk46NFRkWN4PMCLqMfS",symbol:"USDC",tokenAddress:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",walletAddress:"",programId:"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA",spamStatus:de.Verified}},dX={type:ae.SPL,data:{amount:"0",balance:new K(0),chain:hf,decimals:6,key:"cash-account",logoUri:"https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v/logo.png",mintAddress:"CASHx9KJUStyftLFWGvEVf59SGeG9sh5FfcnZMVPCASH",name:"Cash",splTokenAccountPubkey:"8mK7wXFmkUYZnXmKWyKvP3jN9vQxT4R2pLsD6aGcHqYz",symbol:"CASH",tokenAddress:"CASHx9KJUStyftLFWGvEVf59SGeG9sh5FfcnZMVPCASH",walletAddress:"9vKHN2wXQPzJ4mR5sYtL3bUfD6eWcX7aGpMqS8hV4nTz",programId:"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA",spamStatus:de.Verified}},ZT={type:ae.SuiNative,data:{chain:{id:C.sui.mainnetID,name:C.sui.name,symbol:C.sui.tokenSymbol,imageUrl:C.sui.iconUrl},walletAddress:"",decimals:18,amount:"0",logoUri:"https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/sui/info/logo.png",name:"Sui",symbol:"SUI",balance:new K(0),key:"SuiNative",usd:85.14215868842653,price:1858.01,usd_24h_change:.0009391170983548136,tokenAddress:void 0,spamStatus:de.Verified}},YT={type:ae.SuiCoin,data:{chain:{id:C.sui.mainnetID,name:C.sui.name,symbol:C.sui.tokenSymbol,imageUrl:C.sui.iconUrl},walletAddress:"",contractAddress:"0xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7::usdc::USDC",decimals:6,amount:"0",logoUri:"https://assets.coingecko.com/coins/images/6319/large/USD_Coin_icon.png?1547042389",name:"USD Coin",symbol:"USDC",balance:new K(0),key:"0xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7::usdc::USDC",tokenAddress:"0xdba34672e30cb065b1f93e3ab55318768fd6fef66c15942c9f7cb846e2f900e7::usdc::USDC",usd:1.8807026139560001,price:.999793,usd_24h_change:-.0005475429199477411,spamStatus:de.Verified}},XT={type:ae.PolygonNative,data:{chain:{id:C.polygon.mainnetID,name:C.polygon.name,symbol:C.polygon.tokenSymbol,imageUrl:C.polygon.iconUrl},walletAddress:"",decimals:18,amount:"72172806352057410682",logoUri:"https://wallet-asset.matic.network/img/tokens/matic.svg",name:"Polygon",symbol:C.polygon.tokenSymbol,balance:new K(0),key:"PolygonNative",usd:79.02922295550286,price:1.095,usd_24h_change:-.19903579005681138,tokenAddress:void 0,spamStatus:de.Verified}},JT={type:ae.BaseNative,data:{chain:{id:C.base.mainnetID,name:C.base.name,symbol:C.base.tokenSymbol,imageUrl:C.base.iconUrl},walletAddress:"",decimals:18,amount:"72172806352057410682",logoUri:"https://cdn.jsdelivr.net/gh/trustwallet/assets@master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png",name:"Base",symbol:C.base.tokenSymbol,balance:new K(0),key:"BaseNative",usd:79.02922295550286,price:1.095,usd_24h_change:-.19903579005681138,tokenAddress:void 0,spamStatus:de.Verified}},e0={type:ae.ArbitrumNative,data:{chain:{id:C.arbitrum.mainnetID,name:C.arbitrum.name,symbol:C.arbitrum.tokenSymbol,imageUrl:C.arbitrum.iconUrl},walletAddress:"",decimals:18,amount:"72172806352057410682",logoUri:"https://cdn.jsdelivr.net/gh/trustwallet/assets@master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png",name:"Ethereum",symbol:"ETH",balance:new K(0),key:"ArbitrumNative",usd:79.02922295550286,price:1.095,usd_24h_change:-.19903579005681138,tokenAddress:void 0,spamStatus:de.Verified}},t0={type:ae.MonadNative,data:{chain:{id:C.monad.mainnetID,name:C.monad.name,symbol:C.monad.tokenSymbol,imageUrl:C.monad.iconUrl},walletAddress:"",decimals:18,amount:"0",logoUri:"https://static.phantom.app/assets/monad.png",name:"Monad",symbol:C.monad.tokenSymbol,balance:new K(0),key:"MonadNative",usd:0,price:0,usd_24h_change:0,tokenAddress:void 0,spamStatus:de.Verified}},r0={type:ae.ERC20,data:{amount:"0",balance:new K(0),decimals:6,key:"0x3c499c542cef5e3811e1192ce70d8cc03d5c3359",logoUri:"https://wallet-asset.matic.network/img/tokens/usdc.svg",name:"USD Coin",symbol:"USDC",tokenAddress:"0x3c499c542cef5e3811e1192ce70d8cc03d5c3359",walletAddress:"",chain:{id:C.polygon.mainnetID,imageUrl:C.polygon.iconUrl,name:C.polygon.name,symbol:C.polygon.tokenSymbol},contractAddress:"0x3c499c542cef5e3811e1192ce70d8cc03d5c3359",spamStatus:de.Verified}},o0={type:ae.ERC20,data:{amount:"0",balance:new K(0),decimals:6,key:"0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",logoUri:"https://wallet-asset.matic.network/img/tokens/usdc.svg",name:"USD Coin",symbol:"USDC",tokenAddress:"0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",walletAddress:"",chain:{id:C.base.mainnetID,imageUrl:C.base.iconUrl,name:C.base.name,symbol:C.base.tokenSymbol},contractAddress:"0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",spamStatus:de.Verified}},n0={type:ae.ERC20,data:{amount:"0",balance:new K(0),decimals:6,key:"0xaf88d065e77c8cC2239327C5EDb3A432268e5831",logoUri:"https://wallet-asset.matic.network/img/tokens/usdc.svg",name:"USD Coin",symbol:"USDC",tokenAddress:"0xaf88d065e77c8cC2239327C5EDb3A432268e5831",walletAddress:"",chain:{id:C.arbitrum.mainnetID,imageUrl:C.arbitrum.iconUrl,name:C.arbitrum.name,symbol:C.arbitrum.tokenSymbol},contractAddress:"0xaf88d065e77c8cC2239327C5EDb3A432268e5831",spamStatus:de.Verified}},s0={type:ae.ERC20,data:{amount:"0",balance:new K(0),decimals:6,key:"0x0000000000000000000000000000000000000000",logoUri:"https://wallet-asset.matic.network/img/tokens/usdc.svg",name:"USD Coin",symbol:"USDC",tokenAddress:"0x0000000000000000000000000000000000000000",walletAddress:"",chain:{id:C.monad.mainnetID,imageUrl:C.monad.iconUrl,name:C.monad.name,symbol:C.monad.tokenSymbol},contractAddress:"0x0000000000000000000000000000000000000000",spamStatus:de.Verified}},i0={type:ae.HyperevmNative,data:{chain:{id:C.hyperevm.mainnetID,name:C.hyperevm.name,symbol:C.hyperevm.tokenSymbol,imageUrl:C.hyperevm.iconUrl},walletAddress:"",decimals:18,amount:"0",logoUri:"",name:"Ethereum",symbol:"ETH",balance:new K(0),key:"HyperevmNative",usd:79.02922295550286,price:1.095,usd_24h_change:-.19903579005681138,tokenAddress:void 0,spamStatus:de.Verified}},a0={type:ae.ERC20,data:{amount:"0",balance:new K(0),decimals:6,key:"0xb88339cb7199b77e23db6e890353e22632ba630f",logoUri:"https://wallet-asset.matic.network/img/tokens/usdc.svg",name:"USD Coin",symbol:"USDC",tokenAddress:"0xb88339cb7199b77e23db6e890353e22632ba630f",walletAddress:"",chain:{id:C.hyperevm.mainnetID,imageUrl:C.hyperevm.iconUrl,name:C.hyperevm.name,symbol:C.hyperevm.tokenSymbol},contractAddress:"0xb88339cb7199b77e23db6e890353e22632ba630f",spamStatus:de.Verified}},c0={type:ae.EthereumNative,data:{chain:{id:C.ethereum.mainnetID,name:C.ethereum.name,symbol:C.ethereum.tokenSymbol,imageUrl:C.ethereum.iconUrl},walletAddress:"",decimals:18,amount:"45824381294194610",logoUri:"https://cdn.jsdelivr.net/gh/trustwallet/assets@master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png",name:"Ethereum",symbol:"ETH",balance:new K(0),key:"EthereumNative",usd:85.14215868842653,price:1858.01,usd_24h_change:.0009391170983548136,tokenAddress:void 0,spamStatus:de.Verified}},u0={type:ae.ERC20,data:{chain:{id:C.ethereum.mainnetID,name:C.ethereum.name,symbol:C.ethereum.tokenSymbol,imageUrl:C.ethereum.iconUrl},walletAddress:"",contractAddress:"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",decimals:6,amount:"1881092",logoUri:"https://assets.coingecko.com/coins/images/6319/large/USD_Coin_icon.png?1547042389",name:"USD Coin",symbol:"USDC",balance:new K(0),key:"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",tokenAddress:"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",usd:1.8807026139560001,price:.999793,usd_24h_change:-.0005475429199477411,spamStatus:de.Verified}};var Zu="https://help.phantom.com/hc/en-us/articles/5985106844435",l0="https://help.phantom.com/hc/en-us/articles/29763090277139";var Xo={amount:new K(0),amountUsd:null,pct:0};u();l();var hr={};var p0={...hr,bridgeMinimumUsdAmounts:0,swapDefaultFee:new K(15e-5*10**18),bridgeDefaultFee:new K(.025*10**18),averageNetworkFee:new K(15e-5*10**18),nativeFungible:e0,usdcFungible:n0};u();l();var d0={...hr,bridgeMinimumUsdAmounts:0,swapDefaultFee:new K(15e-5*10**18),bridgeDefaultFee:new K(.025*10**18),averageNetworkFee:new K(15e-5*10**18),nativeFungible:JT,usdcFungible:o0};u();l();var m0={bridgeMinimumUsdAmounts:10,swapDefaultFee:new K(1e4),bridgeDefaultFee:new K(1e4),averageNetworkFee:new K(1e4),nativeFungible:{type:ae.BitcoinNative,data:{chain:{id:C.bitcoin.mainnetID,name:C.bitcoin.name,symbol:C.bitcoin.tokenSymbol,imageUrl:C.bitcoin.iconUrl},walletAddress:"",decimals:18,amount:"45824381294194610",logoUri:"https://cdn.jsdelivr.net/gh/trustwallet/assets@master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png",name:"Bitcoin",symbol:"BTC",balance:new K(0),key:"BitcoinNative",usd:85.14215868842653,price:1858.01,usd_24h_change:.0009391170983548136,tokenAddress:void 0,spamStatus:de.Verified}},usdcFungible:{type:ae.BitcoinNative,data:{chain:{id:C.bitcoin.mainnetID,name:C.bitcoin.name,symbol:C.bitcoin.tokenSymbol,imageUrl:C.bitcoin.iconUrl},walletAddress:"",decimals:18,amount:"45824381294194610",logoUri:"https://cdn.jsdelivr.net/gh/trustwallet/assets@master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png",name:"Bitcoin",symbol:"BTC",balance:new K(0),key:"BitcoinNative",usd:85.14215868842653,price:1858.01,usd_24h_change:.0009391170983548136,tokenAddress:void 0,spamStatus:de.Verified}}};u();l();var f0={...hr,bridgeMinimumUsdAmounts:20,swapDefaultFee:new K(2.5*10**16),bridgeDefaultFee:new K(3.75*10**16),averageNetworkFee:new K(0),nativeFungible:c0,usdcFungible:u0};u();l();var h0={...hr,bridgeMinimumUsdAmounts:0,swapDefaultFee:new K(15e-5*10**18),bridgeDefaultFee:new K(.025*10**18),averageNetworkFee:new K(15e-5*10**18),nativeFungible:i0,usdcFungible:a0};u();l();var g0={...hr,bridgeMinimumUsdAmounts:0,swapDefaultFee:new K(.015*10**18),bridgeDefaultFee:new K(.025*10**18),averageNetworkFee:new K(.0021*10**18),nativeFungible:t0,usdcFungible:s0,requiredFeatureFlag:"enable-monad-swapper"};u();l();var y0={...hr,bridgeMinimumUsdAmounts:2,swapDefaultFee:new K(6*10**16),bridgeDefaultFee:new K(6*10**16),averageNetworkFee:new K(.0015*10**18),nativeFungible:XT,usdcFungible:r0};u();l();var w0={bridgeMinimumUsdAmounts:1,swapDefaultFee:new K(3*10**6),bridgeDefaultFee:new K(30*10**6),averageNetworkFee:new K(15e3),nativeFungible:xn,usdcFungible:WT};u();l();var S0={bridgeMinimumUsdAmounts:1,swapDefaultFee:new K(50*10**6),bridgeDefaultFee:new K(50*10**6),averageNetworkFee:new K(50*10**6),nativeFungible:ZT,usdcFungible:YT};var FJ=[ce.Solana,ce.Ethereum,ce.Polygon,ce.Monad,ce.Base,ce.Sui,ce.Arbitrum,ce.Hyperevm,ce.Bitcoin],n1=new Vn({[ce.Solana]:w0,[ce.Ethereum]:f0,[ce.Polygon]:y0,[ce.Monad]:g0,[ce.Base]:d0,[ce.Sui]:S0,[ce.Arbitrum]:p0,[ce.Hyperevm]:h0,[ce.Bitcoin]:m0}),ho=jn(n1);var ba=i((t,e)=>{let r=[];if(s1(t)&&r.push({type:"permanentDelegate",level:"warn",titleKey:"swapAssetWarningPermanentDelegate",shortTitleKey:"swapAssetWarningPermanentDelegateShort",modalTitleKey:"swapAssetWarningPermanentDelegateModalTitle"}),(t.data.spamStatus===de.NotVerified||t.data.spamStatus===de.Spam||t.data.spamStatus===de.PossibleSpam)&&r.push({type:"unverified",level:"info",titleKey:"swapAssetWarningUnverified",shortTitleKey:"swapAssetWarningUnverifiedShort",modalTitleKey:"swapAssetWarningUnverifiedModalTitle"}),!Xt(t.type)&&e&&i1(e)){let o=ho.get(t.data.chain.id).nativeFungible;r.push({type:"lowBalance",level:"info",titleKey:"swapAssetWarningLowTokenBalance",shortTitleKey:"swapAssetWarningLowTokenBalanceShort",modalTitleKey:"swapAssetWarningLowTokenBalanceModalTitle",options:{token:o.data.symbol??"",network:o.data.chain.name}})}return r},"detectAssetWarnings");function s1(t){let e=t.data;return e?.mintExtensions?e.mintExtensions.some(r=>r.extension===pc.permanentDelegate):!1}i(s1,"hasPermanentDelegateExtension");function i1(t){let e=ho.get(t.data.chain.id);return new x(t.data.amount?t.data.amount:0).lt(e.swapDefaultFee)}i(i1,"isLowNativeTokenBalance");u();l();var a1=3,b0=new x(2039280),c1=new x(356190);function Yu(t,e){if(!Xt(t.type))return new x(t.data.balance);let{balance:r,decimals:o}=t.data,n=r?new x(r).multipliedBy(10**o):new x(0),s=u1(t,e);return(n.gt(s)?n.minus(s):n).dividedBy(10**o)}i(Yu,"getMaxSellAmountWithDefaults");function u1(t,e){let r=t.data.chain.id;if(C.isSolanaNetworkID(r))return l1(t,e);if(C.isEVMNetworkID(r))return p1(t,e);if(C.isSuiNetworkID(r))return d1(t,e);throw new Error("Chain not supported by swapper")}i(u1,"calculateFees");function l1(t,e){let{defaultSwapFee:r,networkFeeBuffer:o}=gf(t,e),n=r.plus(o),s=b0,c=!e||new x(e.data.balance).isZero()?b0:new x(0);return n.plus(s).plus(c)}i(l1,"calculateSolanaFees");function p1(t,e){let{networkFeeBuffer:r}=gf(t,e),o=m1(t.data.chain.id),n=new x(o.maxFeePerGas),s=new x(o.maxPriorityFeePerGas);return c1.multipliedBy(n.plus(s)).plus(r)}i(p1,"calculateEVMFees");function d1(t,e){let{defaultSwapFee:r,networkFeeBuffer:o}=gf(t,e);return r.plus(o)}i(d1,"calculateSuiFees");function gf(t,e){let r=Kt(t.data.chain.id,e?.data.chain.id),o=ho.get(t.data.chain.id),n=r?o.bridgeDefaultFee:o.swapDefaultFee,s=o.averageNetworkFee.multipliedBy(a1);return{defaultSwapFee:n,networkFeeBuffer:s}}i(gf,"getCommonFeeComponents");function m1(t){if(C.isEthereumNetworkID(t))return{maxFeePerGas:new x("5000000000"),maxPriorityFeePerGas:new x("79000000")};if(C.isPolygonNetworkID(t))return{maxFeePerGas:new x("30000000000"),maxPriorityFeePerGas:new x("30000000000")};if(C.isBaseNetworkID(t))return{maxFeePerGas:new x("25000000"),maxPriorityFeePerGas:new x("1100000")};if(C.isArbitrumNetworkID(t))return{maxFeePerGas:new x("29000000"),maxPriorityFeePerGas:new x("0")};throw new Error("Chain not supported by swapper")}i(m1,"getEVMDefaultTransactionUnitCost");var Xu=class{static{i(this,"TokenStateMachine")}state={type:"idle"};eventListeners=[];send(e){let r=this.state,o=r;try{return o=this.detectNextState(e),this.state=o,o}catch{return r}finally{this.eventListeners.forEach(n=>n.onStateChange(e,r,o))}}detectNextState(e){switch(e.type){case"initializeStarted":return{type:"initializing",mode:e.mode};case"initializeCompleted":if(this.state.type==="initializing"||this.state.type==="refreshing"){let r=new x(e.result.maxSellAmount??e.result.sellToken.data.balance);return{type:"pair",mode:this.state.mode,sellToken:e.result.sellToken,buyToken:e.result.buyToken,sellTokenPrice:e.result.sellTokenPrice,buyTokenPrice:e.result.buyTokenPrice,warnings:ba(e.result.buyToken),maxSellAmount:r,takerCaip19:e.result.takerCaip19,takerDestinationCaip19:e.result.takerDestinationCaip19,isPrediction:e.result.isPrediction??!1,predictionsQuoteInput:e.result.predictionsQuoteInput}}throw new Error("Invalid state");case"initializeFailed":if(this.state.type!=="initializing")throw new Error("Invalid state");return{type:"error",error:e.error};case"switchTokens":{if(this.state.type!=="pair")throw new Error("Invalid state");let r=this.state.buyToken,o=this.state.sellToken,n=this.state.buyTokenPrice,s=this.state.sellTokenPrice;return{type:"pair",mode:e.mode,sellToken:r,buyToken:o,sellTokenPrice:n,buyTokenPrice:s,maxSellAmount:Yu(r,o),warnings:ba(o),takerCaip19:this.state.takerDestinationCaip19,takerDestinationCaip19:this.state.takerCaip19,isPrediction:this.state.isPrediction}}case"changeToken":{if(this.state.type!=="pair")throw new Error("Invalid state");let r=e.perspective==="sell"?e.token:this.state.sellToken,o=e.perspective==="buy"?e.token:this.state.buyToken;return{type:"pair",mode:e.mode,sellToken:r,buyToken:o,sellTokenPrice:e.sellTokenPrice??this.state.buyTokenPrice,buyTokenPrice:e.buyTokenPrice??this.state.sellTokenPrice,maxSellAmount:Yu(r,o),warnings:ba(e.perspective==="buy"?e.token:this.state.buyToken),takerCaip19:this.state.takerCaip19,takerDestinationCaip19:this.state.takerDestinationCaip19,isPrediction:this.state.isPrediction}}case"updateBalances":{if(this.state.type!=="pair")throw new Error("Invalid state");if(L(X(this.state.sellToken))!==e.sellTokenCaip19)throw new Error("Invalid state");let r={...this.state.sellToken,data:{...this.state.sellToken.data,balance:e.sellTokenBalance}},o=this.state.buyToken;return{type:"pair",mode:this.state.mode,sellToken:r,buyToken:o,sellTokenPrice:this.state.sellTokenPrice,buyTokenPrice:this.state.buyTokenPrice,warnings:ba(o),maxSellAmount:Yu(r,o),takerCaip19:this.state.takerCaip19,takerDestinationCaip19:this.state.takerDestinationCaip19,isPrediction:this.state.isPrediction}}case"refreshing":if(this.state.type!=="pair")throw new Error("Invalid state");return{type:"refreshing",mode:this.state.mode,sellToken:this.state.sellToken,buyToken:this.state.buyToken,sellTokenPrice:this.state.sellTokenPrice,buyTokenPrice:this.state.buyTokenPrice,maxSellAmount:this.state.maxSellAmount,warnings:this.state.warnings,takerCaip19:this.state.takerCaip19,takerDestinationCaip19:this.state.takerDestinationCaip19,isPrediction:this.state.isPrediction}}}getState(){return this.state}subscribe(e){this.eventListeners.push(e)}unsubscribe(e){this.eventListeners=this.eventListeners.filter(r=>r!==e)}};var Ju=class{static{i(this,"Swapper")}apiClient;swapCommandFactory;quoteProcessor;stateMachine=new Wu;executeSwapStateMachine=new ju;account;cashAccount;config={slippageType:fe.Auto,slippageTolerance:1.3,isSimulationKilled:!1};swapInitializer=new vs(new fo);tokenStateMachine=new Xu;accountChangeListeners=[];constructor(e,r,o,n){this.apiClient=e,this.swapCommandFactory=r,this.quoteProcessor=o,this.quoteProcessor.subscribe(this.quoteProcessorListener),this.tokenStateMachine.subscribe(this.tokenStateListener),n&&(this.account=n)}tokenStateListener={onStateChange:i((e,r,o)=>{o.type==="pair"&&(this.setPair(o.buyToken,o.sellToken,{amount:"0",perspective:"sell"}),e.type==="changeToken"&&this.refreshQuoteProcessor())},"onStateChange")};refreshPair({swapMode:e,cashAddresses:r,settings:o}){this.initializeSwap({swapMode:e,cashAddresses:r,settings:o,refresh:!0})}initializeSwap({swapMode:e,cashAddresses:r,settings:o,refresh:n=!1}){let s=this.checkAccount();this.getTokenState().type==="pair"&&n?this.tokenStateMachine.send({type:"refreshing"}):this.tokenStateMachine.send({type:"initializeStarted",mode:e}),this.swapInitializer.initialize(e,s.addresses,r,o).then(p=>{this.tokenStateMachine.send({type:"initializeCompleted",result:p})}).catch(p=>{k.captureError(p,v.Swapper),p instanceof Sa?this.tokenStateMachine.send({type:"initializeFailed",error:p}):this.tokenStateMachine.send({type:"initializeFailed",error:Sa.fromError(p)})})}updateBalances({sellTokenBalance:e,sellTokenCaip19:r}){this.getTokenState().type==="pair"&&this.tokenStateMachine.send({type:"updateBalances",sellTokenBalance:e,sellTokenCaip19:r})}getTokenState(){return this.tokenStateMachine.getState()}subscribeToken(e){return this.tokenStateMachine.subscribe(e),()=>this.unsubscribeToken(e)}unsubscribeToken(e){this.tokenStateMachine.unsubscribe(e)}quoteProcessorListener={onStateChange:i((e,r)=>{(r.type==="firstQuoteReceived"||r.type==="quoteProcessed")&&this.send({type:xt.QuoteResponseStreamed,response:r.response,quoteInput:r.input,quote:r.quote})},"onStateChange")};isValidAmount(e){try{let r=new x(e);return r.isFinite()?!r.isNegative():!1}catch{return!1}}setAmount(e,r){let o=this.getTokenState();if(!mt(o)){console.error(`Can't set amount from tokenState ${o.type}`);return}let{amount:n}=e;if(n===""&&(n="0"),!this.isValidAmount(n))return;this.quoteProcessor.stop();let s=this.checkAccount(),c={...this.config,...r,isSimulationKilled:r?.isSimulationKilled??this.config.isSimulationKilled??!1};if(n==="0"||n===""){this.send({type:xt.SetPair,buy:o.buyToken,sell:o.sellToken,amount:e});return}let{buyToken:p,sellToken:d,takerCaip19:m,takerDestinationCaip19:f,isPrediction:g,predictionsQuoteInput:w}=o,y=Le(p)||Le(d);try{let S={amount:new x(e.amount).shiftedBy(e.perspective==="buy"?p.data.decimals:d.data.decimals).toString(),amountUsd:x(e.amount).times(e.perspective==="buy"?p.data.price??0:d.data.price??0).toString(),buy:p,sell:d,taker:m,takerDestination:f,slippageTolerance:c.slippageTolerance,autoSlippage:c.slippageType===fe.Auto,exactOut:e.perspective==="buy",priorityFee:c.priorityFee,tipAmount:c.tipAmount,preferredProvider:c.preferredProvider,isLedger:s.type==="ledger",phantomCashAccount:y,isSimulationKilled:c.isSimulationKilled,isPrediction:g??!1,predictions:w};this.quoteProcessor.start(S,s)}catch(S){console.error("Error when streaming quotes",S)}}setPair(e,r,o){this.send({type:xt.SetPair,buy:e,sell:r,amount:o})}switchTokens(){let e=this.getTokenState();if(e.type!=="pair")return;let r=VT(e);r&&this.tokenStateMachine.send({type:"switchTokens",mode:r})}setAccount(e){this.account=e,this.accountChangeListeners.forEach(r=>r.onAccountChange(e))}setCashAccount(e){this.cashAccount=e}getAccount(){return this.account}getInitializer(){return this.swapInitializer}setInitializer(e){this.swapInitializer=e}async fetchQuotes({amount:e,amountUsd:r,buy:o,sell:n,slippageTolerance:s,autoSlippageEnabled:c,priorityFee:p,tipAmount:d,signal:m,phantomCashAccount:f}){let g=X(n),w=X(o),y=e.perspective==="buy",S=new x(e.amount).shiftedBy(e.perspective==="buy"?o.data.decimals:n.data.decimals).toString();this.send({type:xt.QuoteRequestStarted,amount:e,slippageType:c?fe.Auto:fe.Fixed});let b=this.checkChainAddress(n.data),T={chainId:b.networkID,resourceType:V.address,address:b.address},A;if(Kt(n.data.chain.id,o.data.chain.id)){let E=this.checkChainAddress(o.data);A={chainId:E.networkID,resourceType:V.address,address:E.address}}try{let E=await this.apiClient.getQuotes({sell:g,buy:w,amount:S,amountUsd:r,taker:T,takerDestination:A,slippageTolerance:s??0,autoSlippageEnabled:c,exactOutEnabled:y,priorityFee:p,tipAmount:d,signal:m,phantomCashAccount:f});return this.send({type:xt.QuoteResponseReceived,response:E}),E}catch(E){throw this.send({type:xt.QuoteRequestError,error:E}),E}}async swap(e){let{signer:r,storage:o,locale:n,deviceId:s,connection:c,authRepository:p,isSimulationKilled:d,gasEstimation:m,preprocessor:f}=e,g=this.getState();if(!$T(g))throw new Error(`Can't swap from ${g.type}`);this.quoteProcessor.stop();let w=this.checkAccount(),y={account:w,buy:g.buy,sell:g.sell,amount:g.amount,quote:g.quote,response:g.response,slippageType:g.slippageType,quoteInput:g.input},S=this.getAddressFromCaip19({caip19:g.response.taker}),b=this.swapCommandFactory.create(y,S,g.sell.data.chain.id,c,p,this.cashAccount,m),T=new Ku(b,E=>this.executeSwapStateMachine.send(E),y),A=await T.createTransaction();await k.startSpan(mf(le(g.quote),A.type),async()=>{let E=await T.simulate(A,n,s,d),I=i(async()=>{let P=await T.swap(w.identifier,A,E,r,o);await T.waitForConfirmation(P)},"performSwap");f?await f(I):await I()})}changeToken(e,r,o){let n=this.getTokenState();if(n.type!=="pair")return;let s=r==="buy"?e:n.buyToken,c=r==="sell"?e:n.sellToken,p=X(c),d=X(s),m;n.mode.type==="swap"?m={...n.mode,network:c.data.chain.id,sellCaip19:L(p),buyCaip19:L(d),takerCaip19:r==="sell"?o:n.mode.takerCaip19,takerDestinationCaip19:r==="buy"?o:n.mode.takerDestinationCaip19,sellFungibleKey:r==="sell"?e.data.key:n.mode.sellFungibleKey,buyFungibleKey:r==="buy"?e.data.key:n.mode.buyFungibleKey}:n.mode.type==="buy"?m={...n.mode,buyCaip19:L(d),sellCaip19:L(p),takerCaip19:r==="buy"?o:n.mode.takerCaip19}:n.mode.type==="sell"&&(m={...n.mode,sellCaip19:L(p),buyCaip19:L(d),takerDestinationCaip19:r==="sell"?o:n.mode.takerDestinationCaip19}),hc({tokens:[d,p]}).then(f=>{let g=f[L(d)],w=f[L(p)];this.tokenStateMachine.send({type:"changeToken",mode:m,token:e,perspective:r,buyTokenPrice:g,sellTokenPrice:w})}).catch(f=>{k.captureError(f,v.Swapper),this.tokenStateMachine.send({type:"changeToken",mode:m,token:e,perspective:r})})}selectQuote(e){this.send({type:xt.UserSelectedQuote,quote:e})}setQuoteConfig(e){this.config={...this.config,...e},this.refreshQuoteProcessor()}refreshQuoteProcessor(){let e=this.getLastQuoteProcessorSwapAmount();e&&this.setAmount(e)}getLastQuoteProcessorSwapAmount(){let e=this.getQuoteProcessorState();switch(e.type){case"starting":case"firstQuoteReceived":case"quoteProcessed":case"error":let r=e.input;return{amount:new x(r.amount).shiftedBy(-1*(r.exactOut?r.buy.data.decimals:r.sell.data.decimals)).toString(),perspective:r.exactOut?"buy":"sell"};default:return}}getState(){return this.stateMachine.getState()}getExecuteState(){return this.executeSwapStateMachine.getState()}stopProcessingQuotes(){this.quoteProcessor.stop()}subscribeExecution(e){return this.executeSwapStateMachine.addListener(e),()=>this.unsubscribeExecution(e)}unsubscribeExecution(e){this.executeSwapStateMachine.removeListener(e)}getQuoteProcessorState(){return this.quoteProcessor.getState()}subscribeQuoteProcessor(e){return this.quoteProcessor.subscribe(e),()=>this.unsubscribeQuoteProcessor(e)}unsubscribeQuoteProcessor(e){this.quoteProcessor.unsubscribe(e)}stopQuoteProcessor(){this.quoteProcessor.stop()}subscribeAccountChange(e){return this.accountChangeListeners.push(e),()=>this.unsubscribeAccountChange(e)}unsubscribeAccountChange(e){this.accountChangeListeners=this.accountChangeListeners.filter(r=>r!==e)}setQuoteStreamer(e){this.quoteProcessor.setQuoteStreamer(e)}getSwapCommandFactory(){return this.swapCommandFactory}setSwapCommandFactory(e){this.swapCommandFactory=e}send(e){return this.stateMachine.send(e)}checkAccount(){if(!this.account)throw new Error("Must set a MultiChainAccount");return this.account}checkChainAddress({chain:e,walletAddress:r}){let{id:o}=e;if(r)return{networkID:o,address:r};let s=this.checkAccount().addresses.find(p=>p.networkID===o);if(!s)throw new Error(`No address found for chain ${o}`);let c={...s};return Lr(c)&&(c.address=c.address.toLowerCase()),c}getAddressFromCaip19(e){let r;if("encodedCaip19"in e?r=We(e.encodedCaip19):r=e.caip19,r.resourceType===V.address)return r.address;throw new Error(`CAIP19 ${r} is not an address`)}};u();l();var el=N(z());var T0=(0,el.createContext)(null),A0=T0.Provider;function _s(){let t=(0,el.useContext)(T0);if(!t)throw new Error("useBridgeStatusManager must be used within a BridgeStatusManagerProvider");return t}i(_s,"useBridgeStatusManager");u();l();var x0=N(z());u();l();u();l();var Ta=class{static{i(this,"WarmSwapAnalytics")}analytics;constructor(e){this.analytics=e}warmingStarted(e){this.analytics.capture("swapperWarmingStarted",{data:{mode:e.type,caip19:this.getCaip19(e)}})}warmingCompleted(e,r){this.analytics.capture("swapperWarmingCompleted",{data:{mode:e.type,caip19:this.getCaip19(e),durationMs:r}})}warmingFailed(e){this.analytics.capture("swapperWarmingFailed",{data:{mode:e.type,caip19:this.getCaip19(e)}})}cacheHit(e){this.analytics.capture("swapperWarmCacheHit",{data:{mode:e.type,caip19:this.getCaip19(e)}})}cacheMiss(e){this.analytics.capture("swapperWarmCacheMiss",{data:{mode:e.type,caip19:this.getCaip19(e)}})}warmingAwaited(e){this.analytics.capture("swapperWarmingAwaited",{data:{mode:e.type,caip19:this.getCaip19(e)}})}getCaip19(e){switch(e.type){case"buy":return e.buyCaip19;case"sell":return e.sellCaip19;default:return}}};var tl=class{static{i(this,"WarmSwapInitializer")}proxyInitializer;multiChainAccount;cashAddresses;cache;analytics;constructor(e,r,o){this.proxyInitializer=e,this.cache=new yf(r),this.analytics=o?new Ta(o):void 0}async initialize(e,r,o,n){let s=this.cache.get(e);if(!s)return this.analytics?.cacheMiss(e),this.proxyInitializer.initialize(e,r,o,n);switch(s.type){case"idle":return this.analytics?.cacheMiss(e),this.proxyInitializer.initialize(e,r,o,n);case"warming":return this.analytics?.warmingAwaited(e),s.promise.catch(()=>this.proxyInitializer.initialize(e,r,o,n)).finally(()=>{this.cache.delete(e)});case"warmed":return this.analytics?.cacheHit(e),this.cache.delete(e),s.initializationResult}}warmInitialization(e){if(!this.multiChainAccount)return;let r=this.cache.peek(e);if(r&&r.type==="warmed"&&ff(r.swapMode,e))return;this.analytics?.warmingStarted(e);let o=Date.now(),n=this.proxyInitializer.initialize(e,this.multiChainAccount.addresses,this.cashAddresses??{},{});this.cache.set(e,{type:"warming",swapMode:e,promise:n}),n.then(s=>{let c=Date.now()-o;this.analytics?.warmingCompleted(e,c),this.cache.set(e,{type:"warmed",swapMode:e,initializationResult:s})}).catch(()=>{this.analytics?.warmingFailed(e),this.cache.delete(e)})}setMultiChainAccount(e){this.cache.clear(),this.multiChainAccount=e}setCashAddresses(e){this.cache.clear(),this.cashAddresses=e}setAnalytics(e){this.analytics||(this.analytics=new Ta(e))}},yf=class{static{i(this,"Cache")}capacity;entries=new Map;constructor(e){this.capacity=e}getKey(e){let r={type:e.type},o=i(n=>{if(n?.minimumOrderSize)return{minimumOrderSize:{base:n.minimumOrderSize.base?.toString(),quote:n.minimumOrderSize.quote?.toString()}}},"serializeOptions");switch(e.type){case"buy":return JSON.stringify({...r,buyCaip19:e.buyCaip19,sellCaip19:e.sellCaip19,takerCaip19:e.takerCaip19,takerDestinationCaip19:e.takerDestinationCaip19,options:o(e.options)});case"sell":return JSON.stringify({...r,sellCaip19:e.sellCaip19,buyCaip19:e.buyCaip19,takerCaip19:e.takerCaip19,takerDestinationCaip19:e.takerDestinationCaip19,options:o(e.options)});case"swap":return JSON.stringify({...r,network:e.network,sellCaip19:e.sellCaip19,buyCaip19:e.buyCaip19,takerCaip19:e.takerCaip19,takerDestinationCaip19:e.takerDestinationCaip19,options:o(e.options)});case"prediction":return JSON.stringify({...r,network:e.network,mode:e.mode,outcomeType:e.outcomeType,mintAccounts:e.mintAccounts,takerCaip19:e.takerCaip19,takerDestinationCaip19:e.takerDestinationCaip19,options:o(e.options)});default:let n=e;return JSON.stringify(r)}}get(e){return this.entries.get(this.getKey(e))}peek(e){return this.entries.get(this.getKey(e))}set(e,r){let o=this.getKey(e);if(this.entries.set(o,r),this.entries.size>this.capacity){let n=Array.from(this.entries.keys())[0];this.entries.delete(n)}}delete(e){this.entries.delete(this.getKey(e))}clear(){this.entries.clear()}};var f1=2,rl=new tl(new vs(new fo),f1);var E0=(0,gr.createContext)(null);function h1({children:t,processorMode:e="noOp",quoteStreamer:r}){let{data:o}=ye(),n=lt(),s=(0,gr.useMemo)(()=>gb(n),[n]);(0,gr.useEffect)(()=>{s.initialize()},[s]);let c=(0,gr.useMemo)(()=>C0(e,s),[e,s]);(0,gr.useEffect)(()=>{o&&(c.setAccount(o),rl.setMultiChainAccount(o))},[o,c]),(0,gr.useEffect)(()=>{r&&c.setQuoteStreamer(r)},[r,c]);let p=Hc();return(0,gr.useEffect)(()=>{p&&rl.setCashAddresses(p)},[p,c]),(0,wf.jsx)(A0,{value:s,children:(0,wf.jsx)(E0.Provider,{value:c,children:t})})}i(h1,"SwapperProvider");function rt(){let t=(0,gr.useContext)(E0);return t||C0("noOp")}i(rt,"useSwapper");function C0(t,e){let r=new Ju(new Kc,new pu(e),new vu(new fu(Nr?new mu:new du),t==="noOp"?new ku:new Cu));return r.setInitializer(rl),r}i(C0,"createSwapper");u();l();var k0=N(z());var g1=i(t=>{let e=lt(),r=_s(),{t:o}=qe(),n=(0,k0.useRef)(void 0),s=wy.pendingTransactionById(t);return te({queryKey:s,queryFn:i(async()=>{try{let d=(await ky(e))[t],m=d?void 0:r.getPendingBridgeTransactionById(t,o),f=d??m;return f?(Ag(f,n.current)||(n.current=f),n.current):void 0}catch(p){throw k.captureError(p,v.Transaction),p}},"queryFn"),refetchInterval:j({milliseconds:200}),staleTime:j({milliseconds:200}),gcTime:0,refetchOnMount:!0})},"usePendingTransactionByIdWithBridge");u();l();var yr=N(z());u();l();var Wr=i(t=>{let e=Math.floor(t/3600),r=Math.floor((t-e*3600)/60),o=t%60;if(e>0)return R.t("swapProviderEstimatedTimeHM",{hours:e,minutes:r});if(r>0){let n=o>0?r+1:r;return R.t("swapProviderEstimatedTimeM",{minutes:n})}return R.t("swapProviderEstimatedTimeS",{seconds:o})},"formatSecondsAsSwapTime");u();l();var ol=i(t=>t.steps.reduce((e,r)=>e.plus(new K(r.nonIncludedNonGasFees)),new K(0)),"getBridgeStepsFees"),Rs=i(t=>t.steps.flatMap(r=>r.feeCosts).reduce((r,o)=>r.plus(o.amountUSD??0),new K(0)),"getBridgeStepsFeesInUsd");u();l();var Jo=i(t=>t&&le(t)?t.executionDuration:0,"getSwapExecutionDuration");var I0=i((t,e)=>(t==="firstQuoteReceived"||t==="quoteProcessed")&&e==="pair","isQuoteStateValid"),y1=i(({selectProvider:t,dismiss:e})=>{let{currencySymbol:r,fromUsd:o}=vt(),n=rt(),[s,c]=(0,yr.useState)(!1),[p,d]=(0,yr.useState)(n.getQuoteProcessorState());(0,yr.useEffect)(()=>{let y=n.subscribeQuoteProcessor({onStateChange(S,b){d(b)}});return()=>y()},[n]);let[m,f]=(0,yr.useState)(n.getTokenState());(0,yr.useEffect)(()=>{let y=n.subscribeToken({onStateChange(S,b,T){f(T)}});return()=>y()},[n]);let g=(0,yr.useRef)(I0(p.type,m.type));return(0,yr.useEffect)(()=>{I0(p.type,m.type)?g.current=!0:g.current&&e&&e()},[p.type,m.type,e]),{details:(0,yr.useMemo)(()=>{if(p.type!=="quoteProcessed"&&p.type!=="firstQuoteReceived"||m.type!=="pair")return[];let y=p.quote,S=T1(y),b=y.baseProvider.name,T=b1({currentQuote:y,buyToken:m.buyToken,sellToken:m.sellToken,isFlipped:s,setIsFlipped:c});return le(y)?S1({quote:y,selectProvider:t,exchangeRate:T,currencySymbol:r,fromUsd:o}):w1({provider:b,sources:S,exchangeRate:T,selectProvider:t})},[p,m,t,r,o,s]),footnote:R.t("swapProviderPricingFootnote")}},"useSwapPricing"),w1=i(({provider:t,sources:e,exchangeRate:r,selectProvider:o})=>[{label:R.t("swapProviderPricingProvider"),value:t,icon:"chevron-right",onPress:o},{label:R.t("swapProviderPricingMarket"),value:e},{label:R.t("swapProviderPricingPrice"),value:r.rate,icon:"swap",onPress:r.flip}],"getStandardRows"),S1=i(({quote:t,selectProvider:e,exchangeRate:r,currencySymbol:o,fromUsd:n})=>{let s=t.baseProvider.name,c=Rs(t).toString(),p=Wr(Jo(t));return[{label:R.t("swapProviderPricingProvider"),value:s,icon:"chevron-right",onPress:e},{label:R.t("swapProviderPricingPrice"),value:r.rate,icon:"swap",onPress:r.flip},{label:R.t("swapProviderPricingFees"),value:`${o}${n(Number(c),2)} ${R.t("swapProvidersFee")}`},{label:R.t("swapProviderPricingTime"),value:p}]},"getBridgeRows");function b1({currentQuote:t,buyToken:e,sellToken:r,isFlipped:o,setIsFlipped:n}){let{exchangeRate:s,exchangeRateFlipped:c}=Rm(t,e,r);return{rate:o?c:s,flip:i(()=>n(!o),"flip")}}i(b1,"getExchangeRate");function T1(t){return De(Me(t))}i(T1,"getSources");u();l();u();l();var go=N(z());function A1(t){let e=_s(),{t:r}=qe(),[o,n]=(0,go.useState)(0),[s,c]=(0,go.useState)(0),[p,d]=(0,go.useState)(0);return(0,go.useEffect)(()=>{let f={onBridgeStatusChange:i(g=>{n(w=>w+1),(g.type==="completed"||g.type==="failed")&&c(w=>w+1)},"onBridgeStatusChange")};return e.addListener(f),()=>{e.removeListener(f)}},[e]),(0,go.useEffect)(()=>{let f=setInterval(()=>{d(g=>g+1)},j({minutes:1}));return()=>clearInterval(f)},[]),{pendingBridgeTransactions:(0,go.useMemo)(()=>t.length?e.getPendingBridgeTransactions(r,{addresses:t}):[],[e,t,r,o,p,s])}}i(A1,"useBridgePendingActivities");u();l();var yo=N(z());var x1={"BitcoinNative-bip122_p2wpkh":se.BitcoinNativeSegwit,"BitcoinNative-bip122_p2tr":se.BitcoinTaproot,BitcoinNative:se.BitcoinTaproot};function F0(t){return x1[t]??null}i(F0,"normalizeBitcoinFungibleKey");function P0(t,e){let r=F0(t),o=F0(e);return r&&o?r===o:t===e}i(P0,"doBitcoinFungibleKeysMatch");function E1(t,e,r){let o=_s(),{t:n}=qe(),[s,c]=(0,yo.useState)(0),[p,d]=(0,yo.useState)(0);(0,yo.useEffect)(()=>{let w={onBridgeStatusChange:i(y=>{c(S=>S+1),(y.type==="completed"||y.type==="failed")&&d(S=>S+1)},"onBridgeStatusChange")};return o.addListener(w),()=>{o.removeListener(w)}},[o]);let m=(0,yo.useMemo)(()=>t.length?o.getPendingBridgeActivities(n,{addresses:t}):[],[o,t,n,s,p]),f=(0,yo.useMemo)(()=>t.length?o.getPendingBridgeTransactions(n,{addresses:t}):[],[o,t,n,s,p]);return{pendingBridgeTransactions:(0,yo.useMemo)(()=>{if(!f.length||!m.length)return[];let w=new Map(m.map(b=>[b.record.executionId,b.record])),y=C.isBitcoinNetworkID(r),S=e;return f.filter(b=>{let T=w.get(b.id);if(!T)return!1;let A=T.quote.sell,E=T.quote.buy;if(!A&&!E)return!1;if(A){let I=A.data.key;if(y&&P0(S,I))return!0;let P=X(A),U=un(P)?.[0];if(U&&S===U)return!0}if(E){let I=E.data.key;if(y&&P0(S,I))return!0;let P=X(E),U=un(P)?.[0];if(U&&S===U)return!0}return!1})},[f,m,e,r])}}i(E1,"useFungibleBridgePendingActivities");u();l();u();l();function wo(t){return{chain:ce.Solana,type:"fungible",address:t.type===ae.SPL?t.data.mintAddress:void 0,symbol:t.data.symbol??""}}i(wo,"getAnalyticsAsset");var Ds=class{static{i(this,"NextGenAnalytics")}analytics;additionalAnalyticsTags;constructor(e,r){this.analytics=e,this.additionalAnalyticsTags=r}captureEvent(e,r){let o={...r,data:{...r.data,...this.additionalAnalyticsTags}};this.analytics.capture(e,o)}swapperOpen(e,r,o){this.captureEvent("swapperOpen",{data:{uiContext:o??"swapperInterstitial",swapMode:e,comingFrom:r}})}swapperClose(e,r){this.captureEvent("swapperClose",{data:{uiContext:r??"swapperInterstitial",reason:e}})}swapperUpdateAsset(e,r){switch(e.type){case"sell":this.captureEvent("swapperUpdateToAsset",{data:wo(r)});break;case"buy":this.captureEvent("swapperUpdateFromAsset",{data:wo(r)});break}}swapperSwapDefaultQuoteSelected(e){this.captureEvent("swapperSwapDefaultQuoteSelected",{data:{quotePercentageValue:e}})}swapperDetailPanelClicked(){this.captureEvent("swapperDetailPanelClicked",{data:{uiContext:"swapperInterstitial"}})}swapperToggleQuoteCurrency(){this.captureEvent("swapperToggleQuoteCurrency",{data:{uiContext:"swapperInterstitial"}})}swapperQuotesResult(e,r,o){this.captureEvent("swapperQuotesResult",{data:{...Aa(e,o),numQuotes:r.quotes.length,sellToken:L(X(e.sell)),buyToken:L(X(e.buy)),fromNetworkId:e.sell.data.chain.id,toNetworkId:e.buy.data.chain.id,isGasless:r.quotes.some(n=>"gaslessSwapFeeResult"in n&&n.gaslessSwapFeeResult?.success===!0)}})}swapperQuotesError({input:e,quoteError:r}){this.captureEvent("swapperQuotesError",{data:{...Aa(e),error:r.name}})}};function Aa(t,e){let r=e?C1(e):void 0;return{isSellTokenVerified:t.sell.data.spamStatus&&lc({minimum:de.Verified,spamStatus:t.sell.data.spamStatus}),sellTokenCaip19:L(X(t.sell)),sellTokenNetworkId:t.sell.data.chain.id,sellTokenSymbol:t.sell.data.symbol??void 0,sellTokenMarketCap:t.sell.data.marketCap,sellTokenAmount:t.amount,buyTokenCaip19:L(X(t.buy)),buyTokenNetworkId:t.buy.data.chain.id,buyTokenSymbol:t.buy.data.symbol??void 0,isAutoSlippageEnabled:t.autoSlippage,manualSlippagePercent:t.slippageTolerance,isExactOut:t.exactOut,isManualTipInput:t.tipAmount!==void 0,gaslessError:r?.error,gaslessAtaFeeUSD:r?.data?.ataFeeUSD,gaslessNetworkFeeUSD:r?.data?.networkFeeUSD,gaslessTotalAmountUSD:r?.data?.totalAmountUSD}}i(Aa,"createSwapperAnalyticsFields");function Sf(t){if(t.type==="quoteProcessed")return Aa(t.input,t.quote)}i(Sf,"createSwapperAnalyticsFieldsFromQuoteProcessorState");function C1(t){if(Ht(t))return t.gaslessSwapFeeResult}i(C1,"getGaslessSwapFeeResult");u();l();var k1=N(Ve());var xa=N(z());var I1=(0,xa.createContext)(void 0);var v0=i(()=>{let t=(0,xa.useContext)(I1);if(!t)throw new Error("useSwapToken must be used within a SwapTokenProvider");return t},"useSwapToken");u();l();function _0(t,e,r,o){let s=e.find(p=>p.percentage===1)?.amount;if(o==="sell"&&s&&new K(t).gt(s))return["insufficientBalance"];let c=r.type==="buy"?r.options?.minimumOrderSize?.quote:r.options?.minimumOrderSize?.base;return c!=null&&new K(t).lt(c)?["minimumBalance"]:[]}i(_0,"createQuoteInputErrors");u();l();var F1=[.25,.5,1],bf=class{static{i(this,"SellPercentage")}percentage;amount;fiatAmount;constructor(e,r,o){this.percentage=e,this.amount=r,this.fiatAmount=o}getAmountForDenomination(e){return e==="crypto"?this.amount:this.fiatAmount}};function R0({maxSellAmount:t,sellTokenPrice:e,allowedPercentages:r=F1}){return r.map(o=>{let n=t.multipliedBy(o);return new bf(o,n,n.multipliedBy(e?.usd??0))})}i(R0,"getSellPercentages");u();l();var So=st(t=>({preferredProvider:void 0,setPreferredProvider:i(e=>t({preferredProvider:e}),"setPreferredProvider")}));u();l();var M0=N(z());u();l();var nl=i(()=>Rt({key:Pe.PriorityFee,queryKey:me.priorityFee()}),"usePriorityFee"),ooe=i(()=>Dt({key:Pe.PriorityFee,queryKey:me.priorityFee()}),"useSetPriorityFee");u();l();var sl=i(()=>Rt({key:Pe.SlippageTolerance,queryKey:me.slippageTolerance()}),"useSlippageTolerance"),loe=i(()=>Dt({key:Pe.SlippageTolerance,queryKey:me.slippageTolerance()}),"useSetSlippageTolerance");u();l();var il=i(()=>Rt({key:Pe.TipAmount,queryKey:me.tipAmount()}),"useTip"),yoe=i(()=>Dt({key:Pe.TipAmount,queryKey:me.tipAmount()}),"useSetTip");u();l();var D0=N(z());var Bs;(function(t){t.Auto="auto",t.Fixed="fixed"})(Bs||(Bs={}));var P1={type:Bs.Auto},B0=i(()=>{let{priorityFeeSetting:t,isFetched:e,save:r}=v1();return{isFetched:e,selectedSetting:t,setPriorityFeeSetting:r}},"usePriorityFeeSettings"),v1=i(()=>{let{data:t,isFetched:e}=Rt({key:Pe.PriorityFeeSettings,queryKey:me.priorityFeeSettings()}),{mutateAsync:r}=Dt({key:Pe.PriorityFeeSettings,queryKey:me.priorityFeeSettings()}),o=(0,D0.useCallback)(async n=>{await r(n)},[r]);return{isFetched:e,priorityFeeSetting:t??P1,save:o}},"usePriorityFeeSettingsStore");u();l();var N0=N(z());var Ns;(function(t){t.Auto="auto",t.Fixed="fixed"})(Ns||(Ns={}));var _1={type:Ns.Auto},L0=i(()=>{let{tipSetting:t,isFetched:e,save:r}=R1();return{isFetched:e,selectedSetting:t,setTipSetting:r}},"useTipSettings"),R1=i(()=>{let{data:t,isFetched:e}=Rt({key:Pe.TipSettings,queryKey:me.tipSettings()}),{mutateAsync:r}=Dt({key:Pe.TipSettings,queryKey:me.tipSettings()}),o=(0,N0.useCallback)(async n=>{await r(n)},[r]);return{isFetched:e,tipSetting:t??_1,save:o}},"useTipSettingsStore");var U0=i(()=>{let{selectedSetting:t}=$t(),{data:e}=sl(),{data:r}=nl(),{selectedSetting:o}=B0(),{data:n}=il(),{selectedSetting:s}=L0(),c=So(d=>d.preferredProvider),p=_o("kill-swapper-simulation")??!1;return(0,M0.useMemo)(()=>({slippageTolerance:e??void 0,priorityFee:o.type==="fixed"?r??void 0:void 0,tipAmount:s.type==="fixed"?n??void 0:void 0,slippageType:t.type,preferredProvider:c,isSimulationKilled:p}),[e,r,o.type,n,s.type,t,c,p])},"useQuoteConfig");u();l();var O0=N(z());var q0=i(()=>{let{data:t,isFetched:e}=nl(),{data:r,isFetched:o}=il();return(0,O0.useMemo)(()=>{if(!e||!o||!t&&!r)return;let n={};return t&&(n.priorityFee=new x(t)),r&&(n.tip=new x(r)),n},[e,o,t,r])},"useSwapModeSettings");u();l();var Bt=N(z());var D1=i((t,e=[],r)=>{let o=rt(),n=ue(),s;try{s=v0().nextGenAnalytics}catch{}let c=(0,Bt.useMemo)(()=>s||new Ds(n,r),[n,r,s]),[p,d]=(0,Bt.useState)([]),[m,f]=(0,Bt.useState)(o.getTokenState());(0,Bt.useEffect)(()=>{let Q=o.subscribeToken({onStateChange(F,B,W){f(W)}});return()=>Q()},[o,f]);let[g,w]=(0,Bt.useState)(o.getQuoteProcessorState());(0,Bt.useEffect)(()=>{let Q=o.subscribeQuoteProcessor({onStateChange:i((F,B)=>{B.type==="firstQuoteReceived"&&c.swapperQuotesResult(B.input,B.response,B.quote),w(B),Zo.processQuoteProcessorState(B)},"onStateChange")});return()=>{o.stopQuoteProcessor(),Q()}},[o,c]);let y=(0,Bt.useMemo)(()=>N1(m,g),[m,g]),S=U0();(0,Bt.useEffect)(()=>{o.setQuoteConfig(S)},[S,o]);let b=(0,Bt.useMemo)(()=>mt(m)?R0({sellTokenPrice:m.sellTokenPrice,allowedPercentages:e,maxSellAmount:m.maxSellAmount}):[],[m,e]),T=So(Q=>Q.setPreferredProvider);(0,Bt.useEffect)(()=>{let Q=o.subscribeToken({onStateChange(F,B,W){F.type==="initializeStarted"&&T(void 0)}});return()=>Q()},[o,T]);let A=(0,Bt.useCallback)(({amount:Q,denomination:F,perspective:B,tokenStateOverride:W})=>{try{let re=B1(W??m,Q,F,B),ee=_0(re,b,t,B);d(ee),T(void 0),o.setAmount({amount:re,perspective:B},{...S,preferredProvider:void 0})}catch(re){k.captureError(re,v.Swapper)}},[m,b,t,T,o,S]),{connection:E}=qo(),I=lt(),P=Ro(),U=Do(),O=R.language,_=_o("kill-swapper-simulation")??!1,H=(0,Bt.useCallback)(async Q=>{Q.forEach(B=>o.subscribeExecution(B));let F=await n.getDeviceId();await o.swap({signer:P,storage:I,locale:O,deviceId:F,connection:E,authRepository:U,isSimulationKilled:_}),Q.forEach(B=>o.unsubscribeExecution(B))},[o,n,P,I,O,E,U,_]);return{setAmount:A,swap:H,tokenState:m,quoteProcessorState:g,quotedAmounts:y,inputErrors:p,sellPercentages:b}},"useSwapperQuotes");function B1(t,e,r,o){if(!mt(t))throw new Error("Token state is not a pair");let{sellTokenPrice:n,sellToken:s,buyToken:c,buyTokenPrice:p}=t;switch(r){case"fiat":switch(o){case"buy":if(!p?.usd)throw new Error("Token price not found");return new x(e).dividedBy(p.usd).decimalPlaces(c.data.decimals).toString();case"sell":if(!n?.usd)throw new Error("Token price not found");return new x(e).dividedBy(n.usd).decimalPlaces(s.data.decimals).toString()}break;case"crypto":switch(o){case"buy":return new x(e).decimalPlaces(c.data.decimals).toString();case"sell":return new x(e).decimalPlaces(s.data.decimals).toString()}break}}i(B1,"parseAmount");function N1(t,e){if(!mt(t)||e.type!=="firstQuoteReceived"&&e.type!=="quoteProcessed")return;let r=e.quote,{sellToken:o,buyToken:n,sellTokenPrice:s,buyTokenPrice:c}=t;return{buyAmount:new x(r.buyAmount).shiftedBy(-n.data.decimals),buyAmountUsd:c?.usd?new x(r.buyAmount).shiftedBy(-n.data.decimals).multipliedBy(c.usd):void 0,sellAmount:new x(r.sellAmount).shiftedBy(-o.data.decimals),sellAmountUsd:s?.usd?new x(r.sellAmount).shiftedBy(-o.data.decimals).multipliedBy(s.usd):void 0}}i(N1,"parseQuoteAmounts");u();l();function Tf(t){switch(t.type){case ke.SlippageExceeded:return R.t("swapTxConfirmationSwapFailedSlippageLimit");case ke.InsufficientFunds:return R.t("swapTxConfirmationSwapFailedInsufficientBalance");case ke.InsufficientGas:return R.t("swapTxConfirmationSwapFailedInsufficientGas");case ke.AccountFrozen:return R.t("swapTxConfirmationSwapFailedAcountFrozen");case ke.SimulationTimeout:return R.t("swapTxConfirmationSwapFailedSimulationTimeout");case ke.StaleQuote:return R.t("swapTxConfirmationSwapFailedStaleQuote");case ke.UnknownError:return R.t("swapTxConfirmationSwapFailedSimulationUnknownError");default:return R.t("swapTxConfirmationSwapFailedTryAgain")}}i(Tf,"getSimulationErrorMessage");u();l();var AA=N(Ve());var bo=N(z());u();l();var Af=class{static{i(this,"FullBalanceDisplayStrategy")}format(e,r){return`${kr(e)} ${r}`}},xf=class{static{i(this,"CompactBalanceDisplayStrategy")}format(e,r){return`${Zn(e,{compact:!0})} ${r}`}},Ef=class{static{i(this,"CompactNoSymbolBalanceDisplayStrategy")}format(e){return Zn(e,{compact:!0})}};function Cf(t){switch(t){case"full":return new Af;case"compact":return new xf;case"compactNoSymbol":return new Ef}}i(Cf,"createBalanceDisplayStrategy");u();l();var al=class{static{i(this,"DefaultGetSwapQuotesStrategy")}async fetch(e){return await Gc(e)}stopFetching(){}getFetchInterval(e){return e}};u();l();u();l();var Ls=class{static{i(this,"QuoteLoggerExecuteSwapStateListener")}streamedQuoteLogger;constructor(e){this.streamedQuoteLogger=e}onStateChange(e,r,o){o.type===Ce.TransactionSubmitted&&this.streamedQuoteLogger.logState(o.txReceipt.id)}};u();l();u();l();u();l();var cl=i((t,e,r)=>{if(r)return Ae(t,e).times(x(r)).toNumber()},"getAssetVolumeUsd"),z0=i((t,e)=>e&&t?e>t?e:t:e??t,"getTotalUsdVolume");function Q0({buyAssetUsdValue:t,buyToken:e,sellAssetUsdValue:r,sellToken:o,buyAmount:n,sellAmount:s,phantomFeeUiAmount:c,priceImpact:p,provider:d,baseProvider:m,slippageTolerance:f,slippageType:g,sellSwapFilter:w,isRetry:y,analyticsContext:S}){if(e&&o){let b=cl(n,e.data.decimals,t),T=cl(s,o.data.decimals,r),A=z0(b,T);return{networkId:o.data.chain.id,chainId:C.getChainID(o.data.chain.id),toNetworkId:e.data.chain.id,toChainId:C.getChainID(e.data.chain.id),isBridge:o.data.chain.id!==e.data.chain.id,marketName:`${o.data.symbol}/${e.data.symbol}`,tradeDirection:"sell",swapSource:d,baseProvider:m,priceImpact:p,fromAssetSymbol:o.data.symbol??"",fromAssetAddress:o.data.tokenAddress,fromAssetAmount:Ae(s,o.data.decimals),fromAssetUsdPrice:r,fromAssetUsdVolume:T,toAssetSymbol:e.data.symbol??"",toAssetAddress:e.data.tokenAddress,toAssetAmount:Ae(n,e.data.decimals),toAssetUsdPrice:t,toAssetUsdVolume:b,totalUsdVolume:A,feeUsd:c,slippageTolerance:f,slippageType:g,sellSwapFilter:w,isRetry:y,analyticsContext:S}}return null}i(Q0,"legacyAnalyticsPayload");function ul({buyAssetUsdValue:t,buyToken:e,sellAssetUsdValue:r,sellToken:o,quote:n,slippageTolerance:s,slippageType:c,sellSwapFilter:p,isRetry:d,analyticsContext:m,baseProvider:f}){if(e&&o){let{buyAmount:g,sellAmount:w}=n,y="priceImpact"in n?n.priceImpact:0,S="sources"in n?De(n.sources):"",b=("fees"in n?n.fees.find(I=>I.type==="phantom")?.amount.toString():"")??"",T=cl(g,e.data.decimals,t),A=cl(w,o.data.decimals,r),E=z0(T,A);return{chainId:o.data.chain.id??e.data.chain.id,swap:{marketName:`${o.data.symbol}/${e.data.symbol}`,tradeDirection:"sell",swapSource:S,priceImpact:y,fromAssetSymbol:o.data.symbol??"",fromAssetAddress:o.data.tokenAddress??"",fromAssetAmount:Ae(w,o.data.decimals),fromAssetUsdPrice:r??0,fromAssetUsdVolume:A??0,toAssetSymbol:e.data.symbol??"",toAssetAddress:e.data.tokenAddress??"",toAssetAmount:Ae(g,e.data.decimals),toAssetUsdPrice:t,toAssetUsdVolume:T,totalUsdVolume:E??0,feeUsd:Number(b),slippageTolerance:s,slippageType:c,sellSwapFilter:p,isRetry:d,analyticsContext:m,baseProvider:f}}}return null}i(ul,"analyticsPayload");function ll({buyAssetUsdValue:t,buyToken:e,sellAssetUsdValue:r,sellToken:o,buyAmount:n,sellAmount:s,phantomFeeUiAmount:c,priceImpact:p,provider:d,baseProvider:m,slippageTolerance:f,transactionId:g,slippageType:w,sellSwapFilter:y,isRetry:S,analyticsContext:b}){let T=Q0({buyAssetUsdValue:t,buyToken:e,sellAssetUsdValue:r,sellToken:o,buyAmount:n,sellAmount:s,phantomFeeUiAmount:c,priceImpact:p,provider:d,baseProvider:m,slippageTolerance:f,slippageType:w,sellSwapFilter:y,isRetry:S,analyticsContext:b});return T?{data:{...T,id:g}}:{}}i(ll,"getAnalyticsPayload");u();l();var pl=i(({txReceipt:t,networkID:e,amountType:r,swapAnalytics:o,walletAddress:n})=>{let s=No(e);k.addBreadcrumb(v.Swapper,"submittedTransaction",D.Info,{...s,txReceipt:t.id,method:s.chainType===se.Solana?"signAndSendTransaction":s.chainType===se.EVM?"eth_sendRawTransaction":s.chainType===se.Sui?"signAndExecuteTransaction":"UNKNOWN"}),s.chainType===se.Solana?o.submittedTransaction(t.id,{...s,method:"signAndSendTransaction",swapType:r==="sell"?"exactIn":"exactOut",walletAddress:n}):s.chainType===se.EVM?o.submittedTransaction(t.id,{...s,method:"eth_sendRawTransaction",swapType:r==="sell"?"exactIn":"exactOut",walletAddress:n}):s.chainType===se.Sui&&o.submittedTransaction(t.id,{...s,method:"signAndExecuteTransaction",swapType:r==="sell"?"exactIn":"exactOut",walletAddress:n})},"logTransactionSubmitted");u();l();var H0=N(z());var L1={calculate(t){let e=(t?.fees??[]).find(r=>r.type==="phantom");return{amount:new x(e?.amount??0),amountUsd:null,pct:e?.percentage??0}}},M1={calculate(t){let e=t.steps.flatMap(r=>r.feeCosts).find(r=>r.name==="phantom");return{amount:new x(e?.amount??0),amountUsd:null,pct:parseFloat(e?.percentage??"0")}}},G0=i(()=>{let{currentQuote:t}=xe();return{phantomFee:(0,H0.useMemo)(()=>kf(t),[t])}},"usePhantomFee");function kf(t){return zr(t)?L1.calculate(t):le(t)?M1.calculate(t):Xo}i(kf,"calculatePhantomFee");u();l();var dl=i(t=>t?le(t)?void 0:t.priceImpact:0,"getSwapPriceImpact");u();l();var K0=st(t=>({lastFailedSwap:void 0,setLastFailedSwap:i(e=>{t({lastFailedSwap:e})},"setLastFailedSwap")}));function $0(){return K0.getState().lastFailedSwap}i($0,"getLastFailedSwap");function If(t){K0.getState().setLastFailedSwap(t)}i(If,"setLastFailedSwap");var Ms=class{static{i(this,"AnalyticsExecuteSwapStateListener")}swapAnalytics;analytics;uiContext;additionalAnalyticsTags;constructor(e,r,o="swapperClassic",n){this.swapAnalytics=e,this.analytics=r,this.uiContext=o,this.additionalAnalyticsTags=n}captureEvent(e,r){let o={...r,data:{...r?.data,...this.additionalAnalyticsTags}};this.analytics.capture(e,o)}onStateChange(e,r,o,n){switch(e.type){case Z.ExecuteSwapStarted:this.captureEvent("swapperSwap",{data:{...this.createAnalyticsPayload(o.executingQuote).data,uiContext:this.uiContext}});let s=ul({buyAssetUsdValue:o.executingQuote.buy.data.usd,buyToken:o.executingQuote.buy,sellAssetUsdValue:o.executingQuote.sell.data.usd,sellToken:o.executingQuote.sell,quote:o.executingQuote.quote,slippageTolerance:this.parseSlippageTolerance(o.executingQuote.slippageType,o.executingQuote.quote,o.executingQuote.response),slippageType:o.executingQuote.slippageType,sellSwapFilter:$.getState().swapFilter,isRetry:this.isRetry(o.executingQuote),analyticsContext:o.executingQuote.quote.analyticsContext,baseProvider:o.executingQuote.quote.baseProvider?.id??""});s&&(k.addBreadcrumb(v.Swapper,"approved",D.Info,$n(s.swap)),this.swapAnalytics.approved(s));break;case Z.SimulationFailed:e.error.type!==ke.SlippageExceeded&&k.captureError(e.error,v.Swapper),this.captureEvent("swapperSwapFailure",{data:{...this.createAnalyticsPayload(o.executingQuote).data,error:U1(e.error)}});break;case Z.TransactionSubmissionFailed:k.captureError(e.error,v.Swapper),e.error.type==="noSignature"&&this.captureEvent("swapperSwapFailureNoSignature"),this.captureEvent("swapperSwapFailure",{data:{...this.createAnalyticsPayload(o.executingQuote).data,error:e.error.message,uiContext:this.uiContext}});break;case Z.TransactionSubmissionSuccess:pl({txReceipt:e.txReceipt,networkID:e.txReceipt.networkID,amountType:o.executingQuote.amount.perspective==="buy"?"buy":"sell",swapAnalytics:this.swapAnalytics});break;case Z.TransactionConfirmationFailed:let c=Yo(e.error);k.captureError(e.error,v.Swapper),this.captureEvent("swapperSwapFailure",{data:{...this.createAnalyticsPayload(o.executingQuote).data,error:c.message,uiContext:this.uiContext}});let p=No(e.txReceipt.networkID),d={chainId:C.getChainID(e.txReceipt.networkID),networkId:e.txReceipt.networkID},m=e.txReceipt;switch(this.captureEvent("waitForTransactionConfirmationError",{data:{...d,errorMessage:c.message}}),p.chainType){case se.EVM:case se.Solana:case se.Sui:k.addBreadcrumb(v.Swapper,"transactionStatus",D.Error,{...p,txReceipt:m.id}),this.swapAnalytics.transactionStatus(m.id,{...p,status:{type:"error"}});break}break;case Z.TransactionConfirmed:this.captureEvent("swapperSwapSuccess",{data:{...this.createAnalyticsPayload(o.executingQuote,e.txReceipt).data,uiContext:this.uiContext}});let f=No(e.txReceipt.networkID);switch(k.addBreadcrumb(v.Swapper,"transactionStatus",D.Info,{...f,txReceipt:e.txReceipt.id}),f.chainType){case se.EVM:case se.Solana:case se.Sui:this.swapAnalytics.transactionStatus(e.txReceipt.id,{...f,status:{type:"confirmed"}});break}break}this.isFailureEvent(e)?If(o.executingQuote):e.type===Z.TransactionSubmissionSuccess&&If(void 0)}createAnalyticsPayload(e,r){let o=e.quote,n=$.getState(),s=ll({buyToken:e.buy,sellToken:e.sell,buyAmount:o.buyAmount.toString(),sellAmount:o.sellAmount.toString(),phantomFeeUiAmount:kf(o).amountUsd?.toString()??"",priceImpact:dl(o),provider:De(Me(o)),buyAssetUsdValue:n.buyUsdValue,sellAssetUsdValue:n.sellUsdValue,slippageTolerance:this.parseSlippageTolerance(e.slippageType,o,e.response),transactionId:r?.id??"",slippageType:e.slippageType,sellSwapFilter:n.swapFilter,isRetry:this.isRetry(e),analyticsContext:e.quote.analyticsContext,baseProvider:e.quote.baseProvider?.id??""}),c=e.quoteInput;return c?{data:{...s.data,...Aa(c,o)}}:s}parseSlippageTolerance(e,r,o){switch(e){case fe.Fixed:return o.slippageTolerance;case fe.Auto:return zr(r)?r.slippageTolerance:o.slippageTolerance}}isRetry(e){let r=$0();if(!r)return!1;let o=L(X(r.buy)),n=L(X(r.sell)),s=L(X(e.buy)),c=L(X(e.sell));return o===s&&n===c}isFailureEvent(e){switch(e.type){case Z.SimulationFailed:case Z.TransactionSubmissionFailed:case Z.TransactionConfirmationFailed:return!0;default:return!1}}};function U1(t){switch(t.type){case ke.SlippageExceeded:return M.SlippageExceeded;case ke.InsufficientFunds:return M.InsufficientFunds;case ke.InsufficientGas:return M.InsufficientGas;case ke.AccountFrozen:return M.AccountFrozen;case ke.StaleQuote:return M.StaleQuote;case ke.SimulationTimeout:return M.SimulationTimeout;case ke.UnknownError:return M.SimulationUnknownError;case ke.SimulationFailed:return"SIMULATION_FAILED";default:return M.NotValidScanResultsError}}i(U1,"toSimulationErrorMessage");u();l();u();l();function ml(t,e){let r=me.optimisticUpdates(),o=t.getQueryData(r)??[];t.setQueryData(r,[...o.filter(n=>n.id!==e.id),e])}i(ml,"pushOptimisticUpdate");function fl(t){return`${t.type}-${t.data.key}`}i(fl,"getOptimisticUpdateKey");var Us=class{static{i(this,"ConfirmationExecuteSwapStateListener")}queryClient;storage;authRepository;constructor(e,r,o){this.queryClient=e,this.storage=r,this.authRepository=o}onStateChange(e,r,o,n){let{sell:s,quote:c,account:p}=o.executingQuote;if(e.type===Z.TransactionConfirmed){this.storage.set(Pe.PriorityFee,null),this.storage.set(Pe.PriorityFeeSettings,{type:Bs.Auto}),this.queryClient.setQueryData(me.priorityFee(),null),this.queryClient.setQueryData(me.priorityFeeSettings(),{type:Bs.Auto}),this.storage.set(Pe.TipAmount,null),this.storage.set(Pe.TipSettings,{type:Ns.Auto}),this.queryClient.setQueryData(me.tipAmount(),null),this.queryClient.setQueryData(me.tipSettings(),{type:Ns.Auto});let d=new K(s.data.amount),m=new K(c.sellAmount),f=d.minus(m).toString();ml(this.queryClient,{id:fl(s),amount:f}),this.queryClient.invalidateQueries({queryKey:Gy.tokens(p.addresses)}),this.queryClient.invalidateQueries({queryKey:Jy.tokenBalance({wallets:p.addresses,encodedCaip19:L(X(s))})})}}};u();l();u();l();var En=class{static{i(this,"SimulationAnalytics")}#e;constructor(e){this.#e=e}onScannedMessageByUser=i(e=>{this.#e.capture("simulation",{data:{simulation:{...e,type:"message",status:"success"}}})},"onScannedMessageByUser");onFailedScannedMessageByUser=i(e=>{this.#e.capture("simulation",{data:{simulation:{...e,type:"message",status:"error"}}})},"onFailedScannedMessageByUser");onScannedTransactionByUser=i(e=>{this.#e.capture("simulation",{data:{simulation:{...e,type:"transaction",status:"success"}}})},"onScannedTransactionByUser");onFailedScannedTransactionByUser=i(e=>{this.#e.capture("simulation",{data:{simulation:{...e,type:"transaction",status:"error"}}})},"onFailedScannedTransactionByUser");onSkippedTransactionByUser=i(e=>{this.#e.capture("simulation",{data:{simulation:{...e,type:"transaction",status:"skipped"}}})},"onSkippedTransactionByUser")};var j0="swap-validation",Os=class{static{i(this,"SimulationAnalyticsExecuteSwapStateListener")}simulationAnalytics;constructor(e){this.simulationAnalytics=new En(e)}onStateChange(e,r,o){switch(e.type){case Z.SimulationPassed:let n=e.scannedTransactionResult;this.simulationAnalytics.onScannedTransactionByUser({networkId:e.networkId,warnings:n.warnings.map(c=>c.severity),shouldBlock:!!n.block,errorCode:n.error??""});break;case Z.SimulationFailed:let s=e.error.scannedTransactionResult;if(s){this.simulationAnalytics.onScannedTransactionByUser({networkId:e.networkId,warnings:s.warnings.map(c=>c.severity),shouldBlock:!!s.block,errorCode:s.error??""}),s?.error&&k.addBreadcrumb(j0,`Simulation error: ${JSON.stringify({error:s.error})}`,D.Info);return}this.simulationAnalytics.onFailedScannedTransactionByUser({networkId:e.networkId,url:e.url}),k.addBreadcrumb("simulation",`networkID: ${e.networkId}, url: ${e.url}, type: transaction`,D.Info);break;case Z.SimulationSkipped:this.simulationAnalytics.onSkippedTransactionByUser({networkId:e.networkId,skipReason:e.skipReason}),k.addBreadcrumb(j0,`Simulation skipped for networkID: ${e.networkId}, reason: ${e.skipReason}`,D.Info);break}}};u();l();u();l();u();l();var he;(function(t){t.Idle="idle",t.FetchingQuote="fetchingQuote",t.Quote="quote",t.SimulationRequestErrored="simulationRequestErrored",t.SimulationFailed="simulationFailed",t.Simulated="simulated",t.TransactionSubmissionFailed="transactionSubmissionFailed",t.TransactionNotConfirmed="transactionNotConfirmed"})(he||(he={}));var O1=10,q1=st(t=>({transitions:[],addTransition:i((e,r)=>t(o=>{let n=z1(r,e);return n?{transitions:[n,...o.transitions].slice(0,O1)}:o}),"addTransition")}));function gl(t,e){q1.getState().addTransition(t,e)}i(gl,"addSwapperTransition");function z1(t,e){switch(e.type){case he.Idle:return;case he.FetchingQuote:return;case he.Quote:return{sell:Zr(e.response,e.sell,"sell"),buy:Zr(e.response,e.buy,"buy"),sellAmount:e.quote.sellAmount,buyAmount:e.quote.buyAmount,provider:Ea(e.quote),slippage:e.response.slippageTolerance,stateType:e.type,eventType:t.type,timestamp:Date.now()};case he.SimulationRequestErrored:return{sell:Zr(e.response,e.sell,"sell"),buy:Zr(e.response,e.buy,"buy"),sellAmount:e.quote.sellAmount,buyAmount:e.quote.buyAmount,provider:Ea(e.quote),slippage:e.response.slippageTolerance,stateType:e.type,eventType:t.type,error:e.error,quoteTransactionData:hl(e.quote),timestamp:Date.now()};case he.Simulated:return;case he.SimulationFailed:return{sell:Zr(e.response,e.sell,"sell"),buy:Zr(e.response,e.buy,"buy"),sellAmount:e.quote.sellAmount,buyAmount:e.quote.buyAmount,provider:Ea(e.quote),slippage:e.response.slippageTolerance,simulationError:e.simulationError,stateType:e.type,eventType:t.type,simulationWarning:e.scannedTransactionResult?.warnings,quoteTransactionData:hl(e.quote),simulationHumanReadableError:e.scannedTransactionResult?.simulationError?.humanReadableError,simulationRequestId:e.scannedTransactionResult?.advancedDetails?.requestId,timestamp:Date.now()};case he.TransactionSubmissionFailed:return{sell:Zr(e.response,e.sell,"sell"),buy:Zr(e.response,e.buy,"buy"),sellAmount:e.quote.sellAmount,buyAmount:e.quote.buyAmount,provider:Ea(e.quote),slippage:e.response.slippageTolerance,error:e.error,stateType:e.type,eventType:t.type,quoteTransactionData:hl(e.quote),timestamp:Date.now()};case he.TransactionNotConfirmed:return{sell:Zr(e.response,e.sell,"sell"),buy:Zr(e.response,e.buy,"buy"),sellAmount:e.quote.sellAmount,buyAmount:e.quote.buyAmount,provider:Ea(e.quote),slippage:e.response.slippageTolerance,stateType:e.type,eventType:t.type,quoteTransactionData:hl(e.quote),timestamp:Date.now(),error:e.error};default:return}}i(z1,"toSparseTransition");var Ea=i(t=>{let e=Me(t);return De(e)},"parseProvider"),Zr=i((t,e,r)=>{switch(r){case"sell":return{caip19:t.sellToken,symbol:e.data.symbol??void 0};case"buy":return{caip19:t.buyToken,symbol:e.data.symbol??void 0}}},"parseTokens"),hl=i(t=>{if(!le(t))return t.transactionData},"parseQuoteTransactionData");u();l();var Xe;(function(t){t.QuoteRequestStarted="quoteRequestStarted",t.QuoteResponseReceived="quoteResponseReceived",t.QuoteSelected="quoteSelected",t.SimulationResponseReceived="simulationResponseReceived",t.SimulationRequestError="simulationRequestError",t.TransactionSubmissionFailed="transactionSubmissionFailed",t.TransactionConfirmationFailed="transactionConfirmationFailed"})(Xe||(Xe={}));var qs=class{static{i(this,"TransitionsExecuteSwapStateListener")}onStateChange(e,r,o,n){let s=this.toLegacyTransition(e,o);s&&gl(s.nextState,s.event)}toLegacyTransition(e,r){let{buy:o,sell:n,quote:s,response:c}=r.executingQuote;switch(e.type){case Z.SimulationFailed:return{event:{type:Xe.SimulationRequestError,error:e.error},nextState:{type:he.SimulationFailed,buy:o,sell:n,response:c,quote:s,scannedTransactionResult:e.error.scannedTransactionResult,simulationError:e.error.message}};case Z.TransactionSubmissionFailed:return{event:{type:Xe.TransactionSubmissionFailed,error:e.error},nextState:{type:he.TransactionSubmissionFailed,buy:o,sell:n,response:c,quote:s,error:e.error}};case Z.TransactionConfirmationFailed:return{event:{type:Xe.TransactionConfirmationFailed,error:e.error,txReceipt:e.txReceipt},nextState:{type:he.TransactionNotConfirmed,buy:o,sell:n,response:c,quote:s,error:e.error,txReceipt:e.txReceipt}};default:return}}};u();l();u();l();u();l();u();l();u();l();var V0=i(t=>{let e,r=new Set,o=i((f,g)=>{let w=typeof f=="function"?f(e):f;if(!Object.is(w,e)){let y=e;e=g??(typeof w!="object"||w===null)?w:Object.assign({},e,w),r.forEach(S=>S(e,y))}},"setState"),n=i(()=>e,"getState"),d={setState:o,getState:n,getInitialState:i(()=>m,"getInitialState"),subscribe:i(f=>(r.add(f),()=>r.delete(f)),"subscribe"),destroy:i(()=>{(import.meta.env?import.meta.env.MODE:void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()},"destroy")},m=e=t(o,n,d);return d},"createStoreImpl"),W0=i(t=>t?V0(t):V0,"createStore");var aA=N(z(),1),cA=N(nA(),1);var{useDebugValue:sB}=aA.default,{useSyncExternalStoreWithSelector:iB}=cA.default,sA=!1,aB=i(t=>t,"identity");function cB(t,e=aB,r){(import.meta.env?import.meta.env.MODE:void 0)!=="production"&&r&&!sA&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),sA=!0);let o=iB(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,r);return sB(o),o}i(cB,"useStore");var iA=i(t=>{(import.meta.env?import.meta.env.MODE:void 0)!=="production"&&typeof t!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let e=typeof t=="function"?W0(t):t,r=i((o,n)=>cB(e,o,n),"useBoundStore");return Object.assign(r,e),r},"createImpl"),uB=i(t=>t?iA(t):iA,"create"),uA=i(t=>((import.meta.env?import.meta.env.MODE:void 0)!=="production"&&console.warn("[DEPRECATED] Default export is deprecated. Instead use `import { create } from 'zustand'`."),uB(t)),"react");u();l();var en;(function(t){t.Failed="Failed",t.Progress="Progress",t.Success="Success",t.Default="Default"})(en||(en={}));var lB=3e3,it=uA(t=>({toast:void 0,toastId:void 0,visible:!1,currentTimer:null,hideToast(e){t(r=>e&&r.toastId!==e?r:(r.currentTimer&&clearTimeout(r.currentTimer),{visible:!1,currentTimer:null}))},removeToast(){t(e=>(e.currentTimer&&clearTimeout(e.currentTimer),{toast:void 0,toastId:void 0,visible:!1,currentTimer:null}))},success(e){t(r=>{r.currentTimer&&clearTimeout(r.currentTimer);let o=setTimeout(()=>{t({visible:!1,currentTimer:null})},lB);return{toast:{type:en.Success,...e},toastId:e.id??Oe(),visible:!0,currentTimer:o}})},failed(e){t(r=>(r.currentTimer&&clearTimeout(r.currentTimer),{toast:{type:en.Failed,...e},toastId:e.id??Oe(),visible:!0,currentTimer:null}))},progress(e){t(r=>(r.currentTimer&&clearTimeout(r.currentTimer),{toast:{type:en.Progress,...e},toastId:e.id??Oe(),visible:!0,currentTimer:null}))},message(e){t(r=>(r.currentTimer&&clearTimeout(r.currentTimer),{toast:{type:en.Default,...e},toastId:e.id??Oe(),visible:!0,currentTimer:null}))}}));u();l();var Cn=i(t=>{let e=Jo(t);return Wr(e)},"getEstimatedTime");u();l();function lA(t,e,r,o){let n=Le(t),s=n?t:e,c=n?e:t,p=n?r.sellAmount:r.buyAmount,d=Ae(p,s.data.decimals),m=rc(d,!0),f=c.data.symbol,g="";return o?g=n?"swapTokenConfirmationBuyToast":"swapTokenConfirmationSellToast":g=n?"swapSwappingCashBuyToast":"swapSwappingCashSellToast",R.t(g,{amount:m,symbol:f})}i(lA,"cashSwapToastMessage");u();l();u();l();function pA({sell:t,buy:e,onBuyFungiblePress:r}){let o=`${R.t("swapTxConfirmationSwapFailed")} ${t.data.symbol} \u2192 ${e.data.symbol}`,n=C.getChainDefinition(t.data.chain.id).tokenSymbol,s=R.t("buyAssetInterpolated",{tokenSymbol:n});return{title:o,message:R.t("swapTabInsufficientFunds"),onPress:r,buttonText:s}}i(pA,"getInsufficientFundsToastProps");function dA(t,e,r,o,n,s){let{sell:c,buy:p}=e,d=pB(t,c,p,n,o,r,s);return d||{title:`${R.t("swapTxConfirmationSwapFailed")} ${c.data.symbol} \u2192 ${p.data.symbol}`,message:Tf(t),onPress:i(()=>{it.getState().hideToast(),o()},"onPress"),buttonText:R.t("commandRetry")}}i(dA,"createSimulationErrorToast");function pB(t,e,r,o,n,s,c){if(!(t.type&&!c.includes(t.type)))switch(t.type){case ke.InsufficientFunds:return pA({sell:e,buy:r,onBuyFungiblePress:i(()=>{it.getState().hideToast(),s()},"onBuyFungiblePress")});case ke.SlippageExceeded:return o.selectedSetting.type===fe.Auto?void 0:{title:R.t("swapEnableAutoSlippageTitleToast",{sellSymbol:e.data.symbol,buySymbol:r.data.symbol}),buttonText:R.t("swapEnableAutoSlippageButtonToast"),message:"",onPress:i(()=>{o.setSlippageSetting({type:fe.Auto}),n(),it.getState().hideToast()},"onPress")}}}i(pB,"createCustomSimulationErrorToast");u();l();u();l();var dB=["Ledger App not open","Ledger not connected","Unable to connect to Ledger","Unable to connect to Ledger device","Need permission to connect to Ledger"],mB="Ledger user rejected action",fB="Ledger Sign Error";function mA(t){return dB.some(r=>t.message.includes(r))?R.t("swapTxConfirmationSwapFailedLedgerConnectionError"):t.message.includes(mB)?R.t("swapTxConfirmationSwapFailedLedgerReject"):t.message.includes(fB)?R.t("swapTxConfirmationSwapFailedLedgerSignError"):t.message.toLowerCase().includes("ledger")?R.t("swapTxConfirmationSwapFailedLedgerError"):null}i(mA,"parseLedgerError");function fA({sellSymbol:t,buySymbol:e,error:r,onPress:o}){let n=R.t("unknownToken"),s=`${R.t("swapTxConfirmationSwapFailed")} ${t??n} \u2192 ${e??n}`,c=R.t("commandRetry"),p=R.t("swapTxConfirmationSwapFailedUnknownError"),d=mA(r);return d&&(p=d),{title:s,message:p,onPress:o,buttonText:c}}i(fA,"createSwapFailedToast");var Qs=class{static{i(this,"ToastExecuteSwapStateListener")}showFungibleDetails;showBuyFungibleScreen;slippageSettings;supportedCustomSimulationToastErrorTypes;retryAndNavigateToSwapper;toastMessageParser;constructor(e,r,o,n,s,c=gB){this.showFungibleDetails=e,this.showBuyFungibleScreen=r,this.slippageSettings=o,this.supportedCustomSimulationToastErrorTypes=n,this.retryAndNavigateToSwapper=s,this.toastMessageParser=c}onStateChange(e,r,o,n){let{sell:s,buy:c,quote:p}=o.executingQuote;switch(e.type){case Z.ExecuteSwapStarted:let d;if(le(p)){if(C.isBitcoinNetworkID(s.data.chain.id)){hA(R.t("swapBitcoinSellBridgeProgressToast",{estimatedTime:Cn(p)}),()=>{this.showFungibleDetails(c)});return}C.isBitcoinNetworkID(c.data.chain.id)?d=R.t("swapBitcoinBuyingToast"):d=R.t("swapInitiatingBridgeToast",{sellSymbol:s.data.symbol,sellChain:s.data.chain.name,buySymbol:c.data.symbol,buyChain:c.data.chain.name})}else Le(s)||Le(c)?d=lA(s,c,p,!1):d=R.t("swapSwappingToast",{sellSymbol:s.data.symbol,buySymbol:c.data.symbol});hB(d);break;case Z.TransactionConfirmed:hA(this.toastMessageParser.parseTransactionConfirmed(s,c,p),()=>this.showFungibleDetails(c));break;case Z.SimulationFailed:gA(dA(e.error,o.executingQuote,this.showBuyFungibleScreen,()=>this.handleRetryPress(o.executingQuote),this.slippageSettings,this.supportedCustomSimulationToastErrorTypes));break;case Z.TransactionSubmissionFailed:case Z.TransactionConfirmationFailed:gA(fA({sellSymbol:s.data.symbol,buySymbol:c.data.symbol,error:e.error,onPress:i(()=>this.handleRetryPress(o.executingQuote),"onPress")}));break}}handleRetryPress(e){it.getState().hideToast(),this.retryAndNavigateToSwapper(e)}};function hB(t){it.getState().progress({message:t,onPress:i(()=>{it.getState().hideToast()},"onPress")})}i(hB,"progress");function hA(t,e){it.getState().success({id:"swap-success",message:t,onPress:i(()=>{it.getState().hideToast(),e()},"onPress")})}i(hA,"success");function gA(t){it.getState().failed(t)}i(gA,"failed");var gB={parseTransactionConfirmed(t,e,r){return le(r)?C.isBitcoinNetworkID(t.data.chain.id)?R.t("swapBitcoinSellBridgeProgressToast",{estimatedTime:Cn(r)}):C.isBitcoinNetworkID(e.data.chain.id)?R.t("swapBitcoinBuyBridgeProgressToast",{estimatedTime:Cn(r)}):R.t("swapBridgeInitiatedToast",{sellSymbol:t.data.symbol,sellChain:t.data.chain.name,buySymbol:e.data.symbol,buyChain:e.data.chain.name,estimatedTime:Cn(r)}):R.t("swapSwappedToast",{sellSymbol:t.data.symbol,buySymbol:e.data.symbol})}};var wl=class{static{i(this,"ToastsSwapReviewInterceptor")}intercept(e){let{swapper:r,connection:o,storage:n,vaultProxy:s,locale:c,analytics:p,resetSwapper:d,queryClient:m,showFungibleDetails:f,showBuyFungibleScreen:g,swapAnalytics:w,gasEstimation:y,slippageSettings:S,supportedCustomSimulationToastErrorTypes:b,navigateToSwapper:T,storePairs:A,isMobile:E,enableExtSwapCommands:I,authRepository:P,isSimulationKilled:U}=e;if(r.getAccount()?.type===qg.Ledger||!E&&!I)return"continue";let _=r.getState();if(_.type!==Ke.Quote)return"continue";let{quote:H,sell:Q,buy:F}=_;return this.isSupportedQuote(H)&&(async()=>{A(Q,F);let B=await p.getDeviceId(),W=new Qs(f,g,S,b,St=>{T(St)}),re=new Us(m,n,P),ee=new Ms(w,p),Y=new Os(p),at=new qs,Ee=new Ls(Zo);try{r.subscribeExecution(re),r.subscribeExecution(Y),r.subscribeExecution(ee),r.subscribeExecution(W),r.subscribeExecution(at),r.subscribeExecution(Ee),await r.swap({signer:s,storage:n,locale:c,deviceId:B,connection:o,authRepository:P,isSimulationKilled:U,gasEstimation:y}),d()}catch{}finally{r.unsubscribeExecution(re),r.unsubscribeExecution(Y),r.unsubscribeExecution(ee),r.unsubscribeExecution(W),r.unsubscribeExecution(at),r.unsubscribeExecution(Ee)}})(),"continue"}isSupportedQuote(e){return Ht(e)||Ir(e)||io(e)||le(e)}};u();l();var Sl=class{static{i(this,"StreamGetSwapQuotesStrategy")}swapper;queryClient;constructor(e,r){this.swapper=e,this.queryClient=r}queryKey;quoteProcessorListener={onStateChange:i((e,r)=>{if(!this.queryKey){console.error("queryKey is not set");return}r.type==="quoteProcessed"&&this.queryClient.setQueryData(this.queryKey,r.response)},"onStateChange")};async fetch(e,r){return this.queryKey=r,this.swapper.unsubscribeQuoteProcessor(this.quoteProcessorListener),new Promise((o,n)=>{let s=yB(e.amount,e.sell,e.buy),c={onStateChange:i((p,d)=>{switch(d.type){case"firstQuoteReceived":o(d.response),this.swapper.unsubscribeQuoteProcessor(c);break;case"error":n(d.error),this.swapper.unsubscribeQuoteProcessor(c),this.swapper.unsubscribeQuoteProcessor(this.quoteProcessorListener);break}},"onStateChange")};this.swapper.subscribeQuoteProcessor(this.quoteProcessorListener),this.swapper.subscribeQuoteProcessor(c),this.swapper.setPair(yA(e.buy),yA(e.sell),s),this.swapper.setAmount(s,{slippageTolerance:e.slippageTolerance,slippageType:e.enableAutoSlippage?fe.Auto:fe.Fixed,priorityFee:e.priorityFee,tipAmount:e.tipAmount,preferredProvider:e.preferredProvider})})}stopFetching(){this.swapper.getQuoteProcessorState().type!=="idle"&&(this.swapper.stopProcessingQuotes(),this.swapper.unsubscribeQuoteProcessor(this.quoteProcessorListener))}getFetchInterval(e){return!1}};function yB(t,e,r){let o=t.type==="sell"?e:r;return{amount:new x(t.value).shiftedBy(-o.data.decimals).toString(),perspective:t.type}}i(yB,"normalizeAmount");function yA(t){return{...t,data:{...t.data,walletAddress:""}}}i(yA,"removeWalletAddress");u();l();u();l();var bl;(function(t){t.AutoSlippageOptIn="autoSlippageOptIn"})(bl||(bl={}));var Tl=class{static{i(this,"AutoSlippageOptInInterceptor")}intercept({hasViewedAutoSlippageOptIn:e,selectedSetting:r,setHasViewedAutoSlippageOptIn:o,showOverlay:n}){return!e&&r!==fe.Auto?(n(bl.AutoSlippageOptIn),o(!0),"interrupt"):"continue"}};u();l();var Df=N(z());u();l();var SA=N(z());u();l();var wB=a.object({swapper:a.number(),review:a.number().nullish().default(null)}),Al={swapper:ls.Short,review:null},wA=i(()=>{let t=zt.getMultivariateAssignment("swapper-poll-interval-json");if(!t)return Al;try{let e=JSON.parse(t);return wB.parse(e)}catch{return Al}},"getQuotePollIntervalConfig");var kn=i(()=>{let t=Ca(n=>n.intervalMs),e=Ca(n=>n.state),r=Ca(n=>n.setState),o=(0,SA.useCallback)(n=>{r("resumed",n??bA())},[r]);return{state:e,pause:i(()=>r("paused"),"pause"),resume:o,intervalMs:t}},"useQuotePoller"),ka=i(t=>{Ca.getState().setState("resumed",t??bA())},"resumePoller"),Rf=i(()=>{Ca.getState().setState("paused")},"pausePoller"),bA=i(()=>wA().swapper,"getDefaultInterval"),Ca=st(t=>({state:"resumed",intervalMs:Al.swapper,setState(e,r){t(r?{state:e,intervalMs:r}:{state:e})}}));var TA=i(()=>{let t=(0,Df.useCallback)(()=>{ka()},[]),e=(0,Df.useCallback)(()=>{Rf()},[]);return{onSwapTabEnter:t,onSwapTabExit:e}},"useSwapTabSwitchActions");var xA=(0,bo.createContext)(void 0),SB=i(({children:t})=>{let e=[fe.Auto,fe.Fixed],r=[ke.SlippageExceeded],o=(0,bo.useMemo)(()=>[new Tl,new wl],[]),n=!0,s=rt(),c=Be(),p=(0,bo.useMemo)(()=>an?new Sl(s,c):new al,[s,c]),{onSwapTabEnter:d,onSwapTabExit:m}=TA(),f=Wa("trade-hub-variant"),g=bt("enable-replace-classic-ngs"),w=(0,bo.useMemo)(()=>{if(g||f==="remove-buy-sell")return"remove-buy-sell";if(f==="swapper-modal")return"swapper-modal";if(f==="trade-menu")return"trade-menu"},[f,g]),y=(0,bo.useMemo)(()=>Nr?Cf("full"):Cf("compactNoSymbol"),[]);return(0,AA.jsx)(xA.Provider,{value:{slippageSettingTypes:e,reviewInterceptors:o,showStickyCTAButton:n,getSwapQuotesStrategy:p,supportedCustomSimulationToastErrorTypes:r,onSwapTabEnter:d,onSwapTabExit:m,balanceDisplayStrategy:y,tradeHubVariant:w},children:t})},"SwapTabProvider"),Bf=i(()=>{let t=(0,bo.useContext)(xA);if(!t)throw new Error("useSwapTab must be used within a SwapTabProvider");return t},"useSwapTab");u();l();var In=N(z());u();l();u();l();var bB=a.enum(["pumpFun","moonshot"]),TB=a.object({type:bB,programId:a.string(),name:a.string(),iconUrl:a.string()}),AB=a.object({programs:a.array(TB)}),EA=i(t=>{try{return AB.parse(t)}catch{return}},"parseUgcPrograms");var xB={type:"pumpFun",programId:"6EF8rrecthR5Dkzon8Nwu78hRvfCKubJ14M5uBEwF6P",name:"Pump.fun",iconUrl:"https://dhc7eusqrdwa0.cloudfront.net/assets/pumpfun.svg"},Nf=[],To=i(()=>{try{let t=zt.getMultivariateAssignment("enabled-ugc-programs");if(!t)return zt.isFeatureEnabled("enabled-ugc-programs")?[xB]:Nf;let e=JSON.parse(t);return EA(e)?.programs??Nf}catch{return Nf}},"getSupportedUgcPrograms");var EB=a.object({programId:a.string(),complete:a.boolean(),progress:a.string()}),CB=a.object({bondingCurves:a.record(a.string(),EB)}),wr;(function(t){t.Loading="Loading",t.BondingCurve="BondingCurve",t.BondingCurveRefreshing="BondingCurveRefreshing",t.NoBondingCurve="NoBondingCurve",t.Graduated="Graduated",t.Error="Error"})(wr||(wr={}));function kB(t){let e=CA(t),o=Be().getQueryData(e.queryKey),{data:n,isFetching:s,isError:c}=te({...e,initialData:o,staleTime:0}),p=(0,In.useMemo)(()=>To(),[]);return(0,In.useMemo)(()=>{let d=o===n;if(s&&!d)return{type:wr.Loading};if(c)return{type:wr.Error};let m=CB.safeParse(n);if(!m.success)return{type:wr.Error};let f=m.data.bondingCurves[t];if(!f)return{type:wr.NoBondingCurve};let g=p.find(y=>y.programId===f.programId);if(!g)return{type:wr.NoBondingCurve};let w=PB(f.progress);return w?f.complete?{type:wr.Graduated,ugcProgram:g}:{type:d&&s?wr.BondingCurveRefreshing:wr.BondingCurve,progressPercentage:w,ugcProgram:g}:{type:wr.Error}},[o,t,n,c,s,p])}i(kB,"useBondingCurveProgress");var IB=i(t=>{let e=Be(),r=CA(t);return(0,In.useCallback)(async()=>{await e.refetchQueries({queryKey:r.queryKey,type:"active"})},[e,r.queryKey])},"useUgcEnabledAwareBondingCurveRefetch"),CA=i(t=>{let e=(0,In.useMemo)(()=>To(),[]),r=(0,In.useMemo)(()=>e.map(n=>n.programId),[e]);return{queryKey:["bonding-curve",t,r],queryFn:i(async()=>FB(t,r),"queryFn")}},"useQueryOptions"),FB=i(async(t,e)=>{let r=encodeURIComponent(t),o=encodeURIComponent(e.join(","));return(await G.api().get(`/ugc/v1/bonding-curve/${r}/${o}`)).data},"queryFn"),PB=i(t=>{let e=Number(t);if(!isNaN(e))return Math.round(e*100)},"parseProgressPercentage");u();l();var vB="https://help.phantom.com/hc/en-us/articles/33745013398675";u();l();u();l();var FA=N(z());u();l();var _B="swap",RB=i(t=>new yy(t,_B),"createSwapAnalytics"),Hs=Ya(ue,t=>RB(t));u();l();function Gs(t,e,r){if(!r)return;if(e===fe.Fixed)return r.slippageTolerance;let o=r.quotes[t];if(o)return le(o)?r.slippageTolerance:zr(o)?o.slippageTolerance:r.slippageTolerance}i(Gs,"parseSlippage");u();l();var xl=N(z());var IA=i(()=>{let{data:t,isFetching:e}=Rt({key:Pe.LastSubmittedPairs,queryKey:me.lastSubmittedPairs()}),r=(0,xl.useMemo)(()=>t??null,[t]),{mutateAsync:o}=Dt({key:Pe.LastSubmittedPairs,queryKey:me.lastSubmittedPairs()}),n=(0,xl.useCallback)(async(s,c)=>{await o({sellFungible:kA(s),buyFungible:kA(c)})},[o]);return{pairs:r,isLoading:e,storePairs:n}},"useLastSubmittedPairs");function kA(t){return{...t,data:{...t.data,walletAddress:""}}}i(kA,"removeWalletAddress");var DB=i(({goToConfirmation:t})=>{let e=$(b=>b.sellUsdValue),r=$(b=>b.buyUsdValue),{currentQuote:o,quoteResponse:n,selectedProviderIndex:s,selectedBaseProvider:c}=xe(),p=$(b=>b.sellFungible),d=$(b=>b.buyFungible),m=$(b=>b.swapFilter),{selectedSetting:f}=$t(),{storePairs:g}=IA(),w=ue(),y=Hs(),{pause:S}=kn();return(0,FA.useCallback)(()=>{if(!o||!p||!d)return;let b=Gs(s,f.type,n);w.capture("swapperSwap");let T=ul({buyToken:d,sellToken:p,sellAssetUsdValue:e,buyAssetUsdValue:r,quote:o,slippageTolerance:b,slippageType:f.type,sellSwapFilter:m,baseProvider:c});T&&(k.addBreadcrumb(v.Swapper,"approved",D.Info,$n(T.swap)),y.approved(T)),S(),t(),C.compareNetworkID(p.data.chain.id,d.data.chain.id)===0&&g(p,d)},[o,p,d,s,f.type,n,w,e,r,S,t,y,g,m,c])},"useOnSwap");u();l();var vA=N(z());u();l();var Lf=N(z());u();l();var BB=a.object({blocked:a.array(a.nativeEnum(ce))}),PA=i(()=>{let t=Wa("blocked-swapper-chains"),e=BB.safeParse(t);return e.success?e.data.blocked:[]},"useBlockedSwapperChains");u();l();function tn(){return ho.supportedChains.filter(t=>{let e=ho.get(t);return e.requiredFeatureFlag?Va(e.requiredFeatureFlag):!0})}i(tn,"useSwapperChains");var Fn=i(()=>{let{data:t}=ye(),e=tn(),r=PA(),o=(0,Lf.useMemo)(()=>e.filter(n=>!r.includes(n)).map(n=>C.getMainnetNetworkID(n)),[e,r]);return(0,Lf.useMemo)(()=>NB(t,o),[t,o])},"useSupportedNetworkIDs"),NB=i((t,e)=>[...new Set((t?.addresses??[]).map(r=>r.networkID).filter(r=>e.includes(r)))],"getSupportedNetworkIDs");var Mf=i(()=>{let t=Fn(),e=bt("enable-bitcoin-swap");return(0,vA.useCallback)(r=>!e&&r&&C.isBitcoinNetworkID(r)?!1:!!r&&t.includes(r),[t,e])},"useIsSupportedNetworkId");u();l();var kl=N(z());u();l();u();l();var El=class{static{i(this,"SwapperTransitionsStateListener")}onStateChange(e,r,o){gl(o,e)}};u();l();var Cl=class{static{i(this,"SwapperStateMachine")}listeners;constructor(e){this.listeners=e}transition(e,r){try{let o=this.detectNextState(e,r);return this.listeners.forEach(n=>n.onStateChange(r,e,o)),o}catch{return e}}detectNextState(e,r){switch(r.type){case Xe.QuoteRequestStarted:return{type:he.FetchingQuote,buy:r.buy,sell:r.sell,amount:r.amount};case Xe.QuoteResponseReceived:switch(e.type){case he.FetchingQuote:case he.Quote:case he.Simulated:case he.SimulationRequestErrored:case he.TransactionSubmissionFailed:case he.TransactionNotConfirmed:let o=r.response.quotes[r.quoteIndex];if(!o)throw new Error("Quote index out of bounds");return{type:he.Quote,response:r.response,buy:e.buy,sell:e.sell,quote:o};default:throw new Error("Can't transition from this state")}case Xe.QuoteSelected:switch(e.type){case he.Quote:let o=e.response.quotes[r.quoteIndex];if(!o)throw new Error("Quote index out of bounds");return{type:he.Quote,quote:o,buy:e.buy,sell:e.sell,response:e.response};default:throw new Error("Can only transition to QuoteChanged from Quote")}case Xe.SimulationResponseReceived:switch(e.type){case he.Quote:return r.scannedTransactionResult.error?{type:he.SimulationFailed,quote:e.quote,buy:e.buy,sell:e.sell,response:e.response,scannedTransactionResult:r.scannedTransactionResult,simulationError:r.scannedTransactionResult.error}:{type:he.Simulated,quote:e.quote,buy:e.buy,sell:e.sell,response:e.response,scannedTransactionResult:r.scannedTransactionResult};default:throw new Error("Can only transition to Simulated from Simulating")}case Xe.SimulationRequestError:switch(e.type){case he.Quote:return{type:he.SimulationRequestErrored,buy:e.buy,sell:e.sell,quote:e.quote,response:e.response,error:r.error};default:throw new Error("Can only transition to SimulationRequestErrored from Simulating")}case Xe.TransactionSubmissionFailed:switch(e.type){case he.Simulated:case he.SimulationFailed:return{type:he.TransactionSubmissionFailed,quote:e.quote,buy:e.buy,sell:e.sell,response:e.response,scannedTransactionResult:e.scannedTransactionResult,error:r.error};default:throw new Error("Can only transition to SwapSubmitFailed from SubmittingSwap")}case Xe.TransactionConfirmationFailed:switch(e.type){case he.Simulated:return{type:he.TransactionNotConfirmed,quote:e.quote,buy:e.buy,sell:e.sell,txReceipt:r.txReceipt,response:e.response,scannedTransactionResult:e.scannedTransactionResult,error:r.error};default:throw new Error("Can only transition to TransactionNotConfirmed from ConfirmingTransaction")}}}};var LB=new Cl(new Set([new El])),_A=st(t=>({state:{type:he.Idle},transition:i(e=>{t(r=>{let o=r.state;return{state:LB.transition(o,e)}})},"transition")}));var Ks=i(()=>{let t=_A(r=>r.state),e=_A(r=>r.transition);return{state:t,transition:e}},"useSwapperState");u();l();var MB=5*60,RA=i(t=>{if(le(t))return De(ms(t));let{sources:e}=t;return De(e)},"getProviderLabel"),DA=i(({quotes:t,buyTokenNetworkId:e,buyTokenDecimals:r,buyTokenSymbol:o})=>t.map(n=>{let{buyAmount:s}=n,c=Cr.get(e).formDisplayPrecision;return{name:RA(n),amount:`${kr(Ae(s,r),c)} ${o}`}}),"parseSwapProviders"),BA=i(({quotes:t,buyTokenNetworkId:e,buyTokenDecimals:r,buyTokenSymbol:o,networkIDForFees:n,networkFee:s,priceMap:c})=>t.filter(le).map(p=>{let{buyAmount:d,executionDuration:m,steps:f}=p,w=ol(p).plus(s),y=f.find(b=>!!b.tool.logoURI),S=Cr.get(e).formDisplayPrecision;return{name:RA(p),feeUsd:n&&c?Jt(n,w,c):null,amount:`${kr(Ae(d,r),S)} ${o}`,time:{text:Wr(m),isFast:m<=MB},logoURI:y?.tool.logoURI??""}}),"parseBridgeProviders");u();l();var UB={aggregate(t){return t.reduce((e,r)=>({...e,gasLimit:e.gasLimit.plus(r.gasLimit)}),{networkID:C.ethereum.mainnetID,gasLimit:new K(0),maxFeePerGas:t[0].maxFeePerGas,maxPriorityFeePerGas:t[0].maxPriorityFeePerGas})}},OB={aggregate(t){return t.reduce((e,r)=>({...e,value:e.value+r.value}),{networkID:C.solana.mainnetID,value:0})}},qB={aggregate(t){return t.reduce((e,r)=>({...e,gasBudget:e.gasBudget.plus(r.gasBudget)}),{networkID:C.sui.mainnetID,gasBudget:new K(0)})}},Ia=i(t=>{if(!(!t||t.length===0)){if(sc(t[0]))return UB.aggregate(t);if(Ey(t[0]))return OB.aggregate(t);if(Cy(t[0]))return qB.aggregate(t)}},"aggregateGasEstimation");function zB({selectQuote:t}){let{quoteResponse:e,isFetchingQuote:r,quotes:o,selectedProviderIndex:n}=xe(),s=$(I=>I.setSelectedProviderIndex),c=$(I=>I.gasEstimation.estimateWithBuffer),p=$(I=>I.sellFungible),d=$(I=>I.buyFungible),m=p?.data.chain.id,{data:f}=Pi(m,Ia(c)),w=tn().map(I=>lr(I)),{data:y={}}=Oo({query:{data:w}}),S=e?.type==="xchain",b=(0,kl.useMemo)(()=>d?S?BA({quotes:o,buyTokenNetworkId:d.data.chain.id,buyTokenDecimals:d.data.decimals,buyTokenSymbol:d.data.symbol,networkIDForFees:m,networkFee:f?.gasEstimationAmount??new K(0),priceMap:y}):DA({quotes:o,buyTokenNetworkId:d.data.chain.id,buyTokenDecimals:d.data.decimals,buyTokenSymbol:d.data.symbol}):[],[d,S,o,m,f?.gasEstimationAmount,y]),T=ue(),{transition:A}=Ks(),E=(0,kl.useCallback)(I=>{let P=b[I];T.capture("swapperProviderSelected",{data:{provider:P.name}}),s(I),t(o,I),A({type:Xe.QuoteSelected,quoteIndex:I})},[s,b,T,A,o,t]);return{rows:b,selectedProviderIndex:n,isLoadingProviders:r,setSelectedProviderIndex:E}}i(zB,"useSwapProvidersProps");u();l();var Pl=N(z());u();l();var LA=N(z());u();l();var NA=N(z());var Il=i(()=>{let t=Be();return{cancelQuotes:(0,NA.useCallback)(async()=>{await t.cancelQueries({queryKey:me.quotesScope()}),await Vg(1)},[t])}},"useSwapCancelQuotes");u();l();function Pn(t,e){return t.data.key===e.data.key}i(Pn,"areFungiblesEqual");function Uf(){let t=ue(),e=$(n=>n.setBuyFungible),r=$(n=>n.buyFungible),{cancelQuotes:o}=Il();return(0,LA.useCallback)(async n=>{if(r&&Pn(n,r))return;await o();let s=wo(n);t.capture("swapperUpdateToAsset",{data:s}),e(n)},[t,r,o,e])}i(Uf,"useSwapSetBuyAsset");u();l();var QB=i((t,e)=>{Fl.getState().setAsset(t,e)},"setUgcSelectedAsset"),Fl=st(t=>({asset:void 0,onConfirm:void 0,setAsset(e,r){t({asset:e,onConfirm:r})}}));var HB=i(({onClose:t})=>{let e=rt(),r=Uf(),o=Fl(p=>p.asset),n=Fl(p=>p.onConfirm),s=(0,Pl.useMemo)(()=>To().find(d=>d.programId===o?.data?.ugcTokenMeta?.programId),[o]),c=(0,Pl.useCallback)(async()=>{o&&(e.changeToken(o,"buy"),await r(o),n?.(),t())},[r,e,o,n,t]);return{asset:o,program:s,handleConfirmPress:c}},"useUGCTradeWarningProps");u();l();u();l();var Of=i(()=>{let t=Be(),e=$();return{clearQuotes:i(async()=>{e.resetQuote(),await t.invalidateQueries({queryKey:me.quotesScope()})},"clearQuotes")}},"useSwapClearQuotes");u();l();var MA=i(({accountIdentifier:t,networkID:e})=>{let r=lt(),o=Ro();return cn({mutationFn:i(async s=>{let{swapTransactions:c,type:p}=s;if(c.type==="evm"&&p===se.EVM){let{gasEstimation:d,pendingApprovalActivityRows:m,pendingSwapActivityRows:f}=s,{signature:g,error:w}=await k.startSpan("Process EVM Swap Txns",()=>ou({transactions:c.transactions,transactionTypes:c.transactionTypes,networkID:e,gasEstimation:d,pendingSwapActivityRows:f,pendingApprovalActivityRows:m,accountIdentifier:t,accountSigner:o,storage:r}));return{networkID:e,chainType:p,id:g,error:w}}else if(c.type==="solana"&&p===se.Solana){let{callerAddress:d,connection:m,pendingSwapActivityRows:f}=s;if(!m)throw new Error("missing connection");let{signature:g,error:w}=await k.startSpan("Process Solana Swap Txns",()=>su({callerAddress:d,connection:m,networkID:e,transactions:c.transactions,pendingSwapActivityRows:f,accountIdentifier:t,accountSigner:o,storage:r}));return{networkID:e,chainType:p,id:g,error:w}}else if(c.type==="sui"&&p===se.Sui){let{callerAddress:d,pendingSwapActivityRows:m}=s,{signature:f,error:g}=await k.startSpan("Process Sui Swap Txns",()=>uu({callerAddress:d,networkID:e,transactions:c.transactions,pendingSwapActivityRows:m,accountIdentifier:t,accountSigner:o,storage:r}));return{networkID:e,chainType:p,id:f,error:g}}throw new Error("unsupported")},"mutationFn")})},"useSwapFungibles");u();l();u();l();var GB=i(t=>{let e=lt(),r=ue(),{data:o,isPending:n}=te({gcTime:0,queryKey:["originIsBlocklisted",t],queryFn:i(async()=>{let{result:s}=await Pd(e,r,t);return s},"queryFn")});return t===void 0?{isLoading:!1,originIsBlocklisted:!1}:{isLoading:n,originIsBlocklisted:o??!1}},"useOriginIsBlocklisted");u();l();var qf=N(z());function KB(t,e){let{data:r}=ye(),{params:o,networkID:n}=t,[s,c]=(0,qf.useState)(null),p=["scan-message",{url:t.url,message:o.message}],d=r?.addresses.find(S=>S.networkID===n)?.address,m=Yt(R.language)??"en",f=ue(),g=new En(f),w=OA(),y=te({queryKey:p,queryFn:i(async()=>{try{let S=await Rd(m,await f.getDeviceId(),{...t,userAccount:d});return c(null),g.onScannedMessageByUser({networkId:n,warnings:S.warnings.map(b=>b.severity),shouldBlock:!!S.block,errorCode:S.error??""}),S}catch(S){c(S),g.onFailedScannedMessageByUser({networkId:n,url:t.url}),k.addBreadcrumb("simulation",`networkID: ${n}, url: ${t.url}, type: message`,D.Info),k.captureError(y.error,v.Simulation)}},"queryFn"),enabled:!!d&&!!t.url&&!!o.message&&!e?.disabled,refetchInterval:e?.disableRefetch?!1:w,staleTime:1e3*10,...Ad()});return{isFetched:y.isFetched,isFetching:y.isFetching,data:y.data,isLoading:y.isPending&&!e?.disabled,isError:y.isError||!!s,error:y.error||s}}i(KB,"useScannedMessage");function zf(t,e){let{params:r}=t,[o,n]=(0,qf.useState)(null),s=ue(),c=["scan-transaction",t.networkID,t.url,r?r.transactions??r.transaction:""],p=OA(),d=!1;C.isEVMNetworkID(t.networkID)||C.isSolanaNetworkID(t.networkID)?d=!!r&&r.transactions.length>0&&!!t.userAccount:C.isBitcoinNetworkID(t.networkID)?d=!!r&&!!r.transaction&&!!r.userAddresses&&r.userAddresses.length>0:C.isSuiNetworkID(t.networkID)&&(d=!!r&&!!t.userAccount);let m=Yt(R.language)??"en",f=new En(s),g=d&&!e?.disabled,w=te({queryKey:c,queryFn:i(async()=>{try{let y=await pn(m,await s.getDeviceId(),t);return f.onScannedTransactionByUser({networkId:t.networkID,warnings:y.warnings.map(S=>S.severity),shouldBlock:!!y.block,errorCode:y.error??""}),n(null),e?.onSettled?.(y,void 0),y}catch(y){f.onFailedScannedTransactionByUser({networkId:t.networkID,url:t.url}),k.addBreadcrumb("simulation",`networkID: ${t.networkID}, url: ${t.url}, type: transaction`,D.Info),n(y),e?.onSettled?.(void 0,y),k.captureError(y,v.Simulation)}},"queryFn"),enabled:g,refetchInterval:e?.disableRefetch?!1:p,staleTime:1e3*10,...Ad()});return{isFetched:w.isFetched,isFetching:w.isFetching,data:w.data,isLoading:w.isPending&&g,isError:w.isError||!!o,error:w.error||o}}i(zf,"useScannedTransaction");var UA=5e3;function OA(){let t=zt.getMultivariateAssignment("transactions-simulation-interval-ms");if(!t)return UA;let e=parseInt(t,10);return Number.isNaN(e)?UA:e}i(OA,"getSimulationRefetchInterval");u();l();u();l();u();l();u();l();var Fa;(function(t){t.Fungible="fungible"})(Fa||(Fa={}));var $B=a.object({type:a.literal(Fa.Fungible),data:Qy}),qA=a.object({results:a.array(a.any()).transform(t=>t.reduce((e,r)=>{let o=$B.safeParse(r);return o.success&&e.push(o.data),e},[])),prevCursor:a.string().nullish().default(null),nextCursor:a.string().nullish().default(null),hasMore:a.boolean()});async function zA(t){let{query:e,networkIds:r,searchContext:o,supportedNetworkIds:n,pageSize:s=50,cursor:c}=t,p=await G.api().noBearer().headers({"Content-Type":"application/json"}).get("/search/v1",{params:{query:e.trim(),chainIds:r.join(","),platform:Lt,pageSize:s.toString(),searchTypes:Fa.Fungible,searchContext:o,...c&&{cursor:c},...n&&{supportedNetworkIds:n.join(",")}}});if(!J(p))throw new tt({key:"UnknownError"});let d=qA.safeParse(p.data);if(d.success)return d.data;throw new tt({key:"UnknownError"})}i(zA,"getFungibleSearch");u();l();var QA=i(t=>{let e=t.data,r=md(e)??void 0;return{type:e.type,data:{...e.data,tokenAddress:md(e)??void 0,key:r}}},"searchResultToFungible");u();l();var jB="search",HA={searchResults:i((t,e,r,o,n)=>[jB,{query:t,networkIds:e,supportedNetworkIds:o,chainAddresses:r,cursor:n}],"searchResults")};u();l();var vl;(function(t){t[t.Always=1/0]="Always",t[t.Short=j({minutes:5})]="Short",t[t.Medium=j({minutes:30})]="Medium",t[t.Long=j({hours:1})]="Long",t[t.Never=0]="Never"})(vl||(vl={}));var _l;(function(t){t[t.Immediate=0]="Immediate",t[t.Short=j({minutes:5})]="Short",t[t.Medium=j({minutes:30})]="Medium",t[t.Long=j({hours:1})]="Long"})(_l||(_l={}));var VB=i(async t=>(await zA(t)).results.map(r=>QA(r)),"queryFn"),Pa=i(({query:t,networkIds:e,enableQuery:r=!0,keepPreviousData:o=!1,searchContext:n,supportedNetworkIds:s,chainAddresses:c,pageSize:p})=>{let d=HA.searchResults(t,e,c,s);return te({queryKey:d,gcTime:vl.Short,staleTime:_l.Short,enabled:r,placeholderData:o?Rg:void 0,queryFn:i(async()=>VB({query:t,networkIds:e,searchContext:n,supportedNetworkIds:s,pageSize:p}),"queryFn")})},"useFungibleSearch");u();l();var Qf=N(z());function WB({enablePrices:t,enableSorting:e}){let{fungibles:r,isLoadingTokens:o,tokensError:n,refetch:s}=os({enablePrices:t,enableSorting:e}),c=Mf(),p=$(f=>f.sellFungible),d=r.filter(f=>c(f.data.chain.id)&&f.type!==ae.CompressedSPL),m=(0,Qf.useMemo)(()=>{if(p){let f=d.findIndex(w=>Pn(w,p)),g=d[f];g&&g.data.amount!==p.data.amount&&(d[f]=p)}return d.filter(f=>f.data.amount!=="0")},[d,p]);return(0,Qf.useMemo)(()=>({assets:m,isLoading:o,error:n,refetchTokens:s}),[m,o,n,s])}i(WB,"useSwapSellAssetList");u();l();var rr=N(z());u();l();var ZB=50,GA=i(({includeOwnedAssets:t,sellAsset:e,sellCaip19:r,ownedAssets:o,searchAssets:n})=>{if(!t||!e)return n;let s=i(w=>L(X(w)),"getEncodedCaip19"),c=s(e)??r,p=e.data.chain.id??(r&&We(r).chainId),d=o.filter(w=>s(w)!==c&&C.compareNetworkID(p,w.data.chain.id)===0&&w.type!==ae.CompressedSPL).slice(0,ZB-1),m=d.map(w=>[s(w),w]),f=new Map(m),g=n.filter(w=>!f.has(s(w)));return[...d,...g]},"getDisplayedBuyAssets");function YB({enableQuery:t=!0,chainFilter:e,sellCaip19:r}={}){let o=(0,rr.useMemo)(()=>r?We(r):void 0,[r]),{sellFungible:n,searchQuery:s,setSearchQuery:c,setNumSearchResults:p}=$(),d=Za(s,150),{fungibles:m,isLoadingTokens:f,isRefetchingTokens:g,tokensError:w}=os(),y=Fn(),[S,b]=(0,rr.useState)(""),{data:T}=ye(),A=(0,rr.useMemo)(()=>T?.addresses??[],[T]),{data:E,isSuccess:I,isFetching:P,error:U}=Pa({query:d,networkIds:e?[e]:[o?.chainId??n?.data.chain.id??C.solana.mainnetID],enableQuery:t,keepPreviousData:!0,searchContext:"swapper",supportedNetworkIds:y,chainAddresses:A}),O=!I&&P,_=(0,rr.useMemo)(()=>m.filter(re=>re.type!==ae.CompressedSPL).map(re=>[L(X(re)),re]),[m]),H=(0,rr.useMemo)(()=>{let re=Cg(_.map(([Y])=>Y).join("~")),ee=Lg(re);return Eg(ee)},[_]),Q=(0,rr.useMemo)(()=>new Map(_),[H]),F=(0,rr.useMemo)(()=>{if(!E||E.length===0)return[];b(Oe());let re=E.reduce((ee,Y)=>{let at="";if(Xt(Y.type)){if(n&&Xt(n.type)&&Y.data.chain.id===n.data.chain.id||o&&o.chainId===Y.data.chain.id&&o.resourceType===V.nativeToken)return ee;at=L(lr(C.getChainID(Y.data.chain.id)))}else{if(n&&Y.data.tokenAddress===n.data.tokenAddress&&!e||o&&o.chainId===Y.data.chain.id&&o.resourceType===V.address&&o.address===Y.data.tokenAddress)return ee;at=L(X(Y))}let Ee,St=Q.get(at);return St&&St.data.balance?Ee=St:Ee=Y,Ee&&ee.push(Ee),ee},[]);return p(re.length),re},[Q,E,n,p,e,o]),B=ue();(0,rr.useEffect)(()=>{I&&F.length===0&&B.capture("swapperNullSearchResult",{data:{searchQuery:d}})},[I,F,d,B]);let W=(0,rr.useMemo)(()=>GA({includeOwnedAssets:!d,sellAsset:n,sellCaip19:r,ownedAssets:m,searchAssets:F}),[d,m,F,n,r]);return(0,rr.useMemo)(()=>({assets:W,initialFilterKey:e??n?.data.chain.id??o?.chainId,isLoading:f||O,isFetching:f||O||g,error:w??U,searchRef:S,setSearchQuery:c,searchQuery:s}),[W,f,O,g,w,U,n,S,c,o?.chainId,e,s])}i(YB,"useLiveSwapBuyAssetList");u();l();var Rl=N(z());u();l();var KA="https://help.phantom.com/hc/en-us/articles/27085326202515";var XB=[.3,.5,1],JB=XB.map(t=>`${t}%`),eN=[...JB,"custom"],tN=[.5,1,2],rN=tN.map(t=>`${t}%`),Hhe=[...rN,"custom"],Ghe=eN.length-1,Khe=5,$he=2,$A=.1,jA=30,oN=2,jhe=i((t,e)=>{if(!t)return;let r=parseFloat(t);if(isNaN(r))return{message:e("swapSettingsCustomInvalidValue"),severity:"critical"};if(r>jA)return{message:e("swapSlippageSettingsCustomMaxError",{maxSlippage:jA}),severity:"critical"};if(r>oN)return{message:e("swapSlippageSettingsHighSlippageWarning"),severity:"warning"};if(r<$A)return{message:e("swapSlippageSettingsCustomMinError",{minSlippage:$A}),severity:"critical"}},"getCustomSlippageError");u();l();var $s=N(z());var nN={input:{maxLength:10,maxDecimals:6},bounds:{min:1e-6,low:5e-6,high:1,max:5}},ege=i((t,e,r)=>{let o=parseFloat(t);if(isNaN(o))return{message:e("swapSettingsCustomInvalidValue"),severity:"critical"};if(o>r.max)return{message:e("swapPriorityFeeSettingsCustomMaxError",{maxPriorityFee:r.max}),severity:"critical"};if(o<r.min)return{message:e("swapPriorityFeeSettingsCustomMinError",{minPriorityFee:r.min}),severity:"critical"};if(o>r.high)return{message:e("swapPriorityFeeSettingsHighFeeWarning"),severity:"warning"};if(o<r.low)return{message:e("swapPriorityFeeSettingsLowFeeWarning"),severity:"warning"}},"validatePriorityFee"),tge=i(()=>{let[t,e]=(0,$s.useState)(nN.bounds);return(0,$s.useEffect)(()=>{i(async()=>{try{let o=await ic({accounts:[],transactionType:Xn.Swap});e({min:o.min,low:o.low,high:o.high,max:o.max})}catch(o){k.captureError(o instanceof Error?o:new Error("Unable to fetch priority fee bounds."),v.Swapper)}},"fetchBounds")()},[]),t},"usePriorityFeeBounds");u();l();var js=N(z());var sN={input:{maxLength:10,maxDecimals:6},bounds:{min:1e-6,low:5e-6,high:1,max:5}},cge=i((t,e,r)=>{let o=parseFloat(t);if(isNaN(o))return{message:e("swapSettingsCustomInvalidValue"),severity:"critical"};if(o>r.max)return{message:e("swapTipSettingsCustomMaxError",{maxTip:r.max}),severity:"critical"};if(o<r.min)return{message:e("swapTipSettingsCustomMinError",{minTip:r.min}),severity:"critical"};if(o>r.high)return{message:e("swapTipSettingsHighFeeWarning"),severity:"warning"};if(o<r.low)return{message:e("swapTipSettingsLowFeeWarning"),severity:"warning"}},"validateTip"),uge=i(()=>{let[t,e]=(0,js.useState)(sN.bounds);return(0,js.useEffect)(()=>{i(async()=>{try{let o=await ic({accounts:[],transactionType:Xn.Swap});e({min:o.min,low:o.low,high:o.high,max:o.max})}catch(o){k.captureError(o instanceof Error?o:new Error("Unable to fetch tip bounds."),v.Swapper)}},"fetchBounds")()},[]),t},"useTipBounds");u();l();var iN=[pt.lastSubmittedPairs,pt.slippageTolerance],aN=i(t=>{let e=String(t.queryKey[1]);return iN.includes(e)},"swapperShouldDehydrateQueryPredicate");u();l();var WA=N(z());u();l();function VA(){return[new Hf,new Kf,new Gf]}i(VA,"getBuyAmountEditableRules");var Hf=class{static{i(this,"SwapAssetEditableRule")}isEditable({sellAsset:e}){return!!e&&C.isSolanaNetworkID(e.data.chain.id)}},Gf=class{static{i(this,"CryptoCurrencyDenominationEditableRule")}isEditable({currencyDenomination:e}){return e==="crypto"}},Kf=class{static{i(this,"BridgeSwapAssetEditableRule")}isEditable({sellAsset:e,buyAsset:r}){return!Kt(e?.data.chain.id,r?.data.chain.id)}};var ZA=i(({sellAsset:t,buyAsset:e,currencyDenomination:r})=>{let o=bt("enable-swapper-exact-out"),n=(0,WA.useMemo)(()=>VA(),[]);return!e||!o?!1:n.every(s=>s.isEditable({sellAsset:t,buyAsset:e,currencyDenomination:r}))},"useBuyAmountEditableRules");u();l();var $f=class{static{i(this,"NoPriceCurrencyDenominationSwitchSupportRule")}isSupported(e,r,o,n,s){switch(e){case"sell":return!!(o&&s);case"buy":return!1}}},jf=class{static{i(this,"BuyNotSupportedCurrencyDenominationSwitchSupportRule")}isSupported(e){return e!=="buy"}};function YA(){return[new $f,new jf]}i(YA,"getCurrencyDenominationSwitchSupportRules");u();l();var ux=N(z());u();l();var XA=N(z());var cN={"Allbridge's fee":"destinationNetwork","Allbridge Liquidity Fee":"liquidityProvider"},JA=i(()=>{let{currentQuote:t}=xe(),{destinationNetworkFee:e,liquidityFee:r}=(0,XA.useMemo)(()=>{function o(s){return s?{amount:new x(s.amount??0),amountUsd:s.amountUSD?parseFloat(s.amountUSD):null,pct:parseFloat(s.percentage??"0")}:Xo}i(o,"bridgeFeeToFee");let n=new Map([]);return t&&le(t)&&(n=t.steps.flatMap(s=>s.includedFeeCosts).reduce((s,c)=>{if(!c)return s;let p=cN[c.name];return p&&s.set(p,c),s},n)),{destinationNetworkFee:o(n.get("destinationNetwork")),liquidityFee:o(n.get("liquidityProvider"))}},[t]);return{destinationNetworkFee:e,liquidityFee:r}},"useBridgeFees");u();l();var ex=N(z());var uN={calculate({currentQuote:t,gasEstimationPriceData:e}){return{amount:(t&&e?.gasEstimationAmount)??new x(0),amountUsd:(t&&e?.gasEstimationPriceUSDNumber)??null,pct:0}}},lN={calculate({currentQuote:t,gasEstimationPriceData:e,priceMap:r,networkID:o}){let n=(t?.fees??[]).find(p=>p.type==="tips"||p.type==="network"&&p.name!=="Token account deposits"),s=(t&&e?.gasEstimationAmount)??new x(0),c=(t&&e?.gasEstimationPriceUSDNumber)??null;if(n&&n.amount&&(s=s.plus(new x(n.amount)),c)){let p=Jt(o,new x(n.amount),r);p&&(c+=p)}return{amount:s,amountUsd:c,pct:0}}},pN={calculate({currentQuote:t,gasEstimationPriceData:e,maxGasEstimationPriceData:r}){return{amount:(t&&e?.gasEstimationAmount)??new x(0),amountUsd:(t&&e?.gasEstimationPriceUSDNumber)??null,maxAmount:(t&&r?.gasEstimationAmount)??new x(0),maxAmountUsd:(t&&r?.gasEstimationPriceUSDNumber)??null,pct:0}}},tx=i(({priceMap:t})=>{let{currentQuote:e}=xe(),r=$(m=>m.sellFungible),o=$(m=>m.gasEstimation),n=r?.data.chain.id??oe.Solana.Mainnet,{data:s,isLoading:c}=Pi(n,Ia(o.estimate)),{data:p}=Pi(n,Ia(o.estimateWithBuffer));return{networkFee:(0,ex.useMemo)(()=>C.isEVMNetworkID(n)?pN.calculate({currentQuote:e,gasEstimationPriceData:s,maxGasEstimationPriceData:p}):C.isSolanaNetworkID(n)?lN.calculate({currentQuote:e,gasEstimationPriceData:s,networkID:n,priceMap:t}):uN.calculate({currentQuote:e,gasEstimationPriceData:s}),[e,s,p,n,t]),isFetchingGasEstimationPrice:c}},"useNetworkFee");u();l();var rx=N(z());var dN={calculate(){return Xo}},mN={calculate({currentQuote:t,networkID:e,priceMap:r}){let o=ol(t);return{amount:o,amountUsd:Jt(e,o,r),pct:0}}},ox=i(({priceMap:t})=>{let{currentQuote:e}=xe(),o=$(s=>s.sellFungible)?.data.chain.id??oe.Solana.Mainnet;return{nonIncludedFees:(0,rx.useMemo)(()=>e&&le(e)?mN.calculate({currentQuote:e,networkID:o,priceMap:t}):dN.calculate(),[o,e,t])}},"useNonIncludedFees");u();l();var nx=N(z());var fN={calculate({currentQuote:t,networkID:e,priceMap:r}){let o=(t?.fees??[]).find(n=>n.name==="Token account deposits");return{amount:new x(o?.amount??0),amountUsd:o?.amount?Jt(e,new x(o.amount),r):null,pct:o?.percentage??0}}},hN={calculate(){return Xo}},sx=i(({priceMap:t})=>{let{currentQuote:e}=xe(),o=$(s=>s.sellFungible)?.data.chain.id??oe.Solana.Mainnet;return{tokenAccountFee:(0,nx.useMemo)(()=>zr(e)?fN.calculate({currentQuote:e,networkID:o,priceMap:t}):hN.calculate(),[e,o,t])}},"useTokenAccountFee");u();l();var ix=N(z());var ax={calculate:i(({tokenAccountFee:t,networkFee:e,nonIncludedFees:r,networkID:o,priceMap:n})=>{let s=t.amount.plus(e.amount).plus(r.amount);return{amount:s,amountUsd:Jt(o,s,n),pct:0}},"calculate")},gN={calculate:i(({tokenAccountFee:t,networkFee:e,nonIncludedFees:r,networkID:o,priceMap:n})=>{let s=ax.calculate({tokenAccountFee:t,networkFee:e,nonIncludedFees:r,networkID:o,priceMap:n}),c=t.amount.plus(e.maxAmount??0).plus(r.amount);return{...s,maxAmount:c,maxAmountUsd:Jt(o,c,n)}},"calculate")},cx=i(({tokenAccountFee:t,networkFee:e,nonIncludedFees:r,priceMap:o})=>{let s=$(p=>p.sellFungible)?.data.chain.id??oe.Solana.Mainnet;return{totalFees:(0,ix.useMemo)(()=>C.isEVMNetworkID(s)?gN.calculate({tokenAccountFee:t,networkFee:e,nonIncludedFees:r,networkID:s,priceMap:o}):ax.calculate({tokenAccountFee:t,networkFee:e,nonIncludedFees:r,networkID:s,priceMap:o}),[e,s,r,o,t])}},"useTotalFees");var Vf=i(()=>{let t=$(w=>w.gasEstimation.isFetching),e=tn(),{data:r={}}=Oo({query:{data:e.map(w=>lr(w))}}),{networkFee:o,isFetchingGasEstimationPrice:n}=tx({priceMap:r}),s=t||n,{phantomFee:c}=G0(),{tokenAccountFee:p}=sx({priceMap:r}),{nonIncludedFees:d}=ox({priceMap:r}),{totalFees:m}=cx({tokenAccountFee:p,networkFee:o,nonIncludedFees:d,priceMap:r}),{destinationNetworkFee:f,liquidityFee:g}=JA();return(0,ux.useMemo)(()=>({phantomFee:c,networkFee:o,tokenAccountFee:p,totalFees:m,nonIncludedFees:d,destinationNetworkFee:f,liquidityFee:g,isFetchingFees:s}),[c,o,p,m,d,f,g,s])},"useFees");u();l();var lx=N(z());var vn=i(()=>{let{resume:t}=kn(),e=$(r=>r.resetSwapper);return(0,lx.useCallback)(()=>{t(),e()},[e,t])},"useResetSwapper");u();l();var px=N(z());function yN(){let t=ue(),e=$(g=>g.buyFungible),r=$(g=>g.sellFungible),o=$(g=>g.setBuyFungible),n=$(g=>g.setSellFungible),s=$(g=>g.setSellAmount),c=$(g=>g.setUiSellAmountCryptoInput),p=$(g=>g.resetQuote),d=$(g=>g.setSwapFilter),m=r?.data.amount,{cancelQuotes:f}=Il();return(0,px.useCallback)(async g=>{if(r&&Pn(g,r)){g&&g.data.amount!==m&&(n(g),d(void 0));return}await f();let w=wo(g);t.capture("swapperUpdateFromAsset",{data:w}),n(g),d(void 0),e&&r&&Pn(g,e)&&o(r),g&&r?.data.chain.id!==g.data.chain.id&&(p(),o(void 0),s(""),c(""))},[t,e,f,m,p,r,o,s,n,d,c])}i(yN,"useSwapSetSellAsset");u();l();var _n=N(z());u();l();var Ao;(function(t){t.Collapsible="collapsible",t.Static="static"})(Ao||(Ao={}));u();l();var mx=N(Ve()),Vs=N(z());u();l();u();l();var Dl=class{static{i(this,"UgcAwareAssetsSectionAdapter")}sections(e){let r=To().map(s=>s.programId),o=e.reduce((s,c)=>{if(lc({minimum:de.Verified,spamStatus:c.data.spamStatus}))return s.verified.push(c),s;if(c.type!==ae.SPL||!c.data.ugcTokenMeta||c.data.ugcTokenMeta.status===zy.Graduated||!r.includes(c.data.ugcTokenMeta.programId))return s.unverified.push(c),s;let p=c.data.ugcTokenMeta.programId,d=s[p]??[];return d.push(c),s[p]=d,s},{verified:[],unverified:[]}),n=To().map(s=>{let c=o[s.programId]??[];return{id:s.programId,header:{title:R.t("swapSectionTitleTokens",{section:s.name}),iconUrl:s.iconUrl},data:c,behavior:Ao.Collapsible}});return[{id:"verified",data:o.verified,behavior:Ao.Static},{id:"unverified",header:{title:R.t("swapUnverifiedTokens")},data:o.unverified,behavior:Ao.Collapsible},...n]}};function dx(){return new Dl}i(dx,"getBuyAssetsSectionAdapter");var fx=(0,Vs.createContext)(void 0),wN=i(({children:t})=>{let e=(0,Vs.useMemo)(()=>dx(),[]);return(0,mx.jsx)(fx.Provider,{value:{buyAssetSectionAdapter:e},children:t})},"SwapAssetSelectProvider"),Wf=i(()=>{let t=(0,Vs.useContext)(fx);if(!t)throw new Error("useSwapAssetSelect must be used within a SwapAssetSelectProvider");return t},"useSwapAssetSelect");var hx=3;function Zf(t){return{id:t.id,data:t.data,...t.header?{header:t.header}:{}}}i(Zf,"convertToBaseSection");var SN=i(t=>{let[e,r]=(0,_n.useState)({}),o=(0,_n.useCallback)((c,p)=>r(d=>({...d,[c]:p})),[]),{buyAssetSectionAdapter:n}=Wf(),s=(0,_n.useMemo)(()=>n.sections(t),[n,t]);return(0,_n.useMemo)(()=>s.map(c=>{switch(c.behavior){case Ao.Static:return Zf(c);case Ao.Collapsible:{if(c.data.length<=hx)return Zf(c);let p=e[c.id],d=p?c.data:c.data.slice(0,hx),m=i(()=>o(c.id,!p),"onClick"),f=Zf(c);return{...f,header:{...f.header,title:f.header?.title||"",button:{label:p?R.t("commandShowLess"):R.t("commandShowMore"),onClick:m}},data:d}}}}),[s,e,o])},"useSwapAssetCollapsibleSections");u();l();var Bl=i(({networkID:t,txReceipt:e,preferredExplorers:r})=>{let o=e?.id??"";if(!o)return;let n=r?.explorers[t];return fy({networkID:t,endpoint:"transaction",explorerType:n,param:o})},"getExploreUrl");u();l();u();l();var xo=N(z());u();l();function gx(t,e){if(e){let r=bN(t),o=AN(t,e),n=xN(t,e);return{notEnoughSol:e.message===M.NotEnoughSol,txErrorTitle:r,txErrorMessage:o,txErrorHelpButtonLink:n}}return{notEnoughSol:!1,txErrorTitle:"",txErrorMessage:"",txErrorHelpButtonLink:""}}i(gx,"getSwapErrorDetails");var bN=i(t=>t?R.t("swapTxBridgeFailed"):R.t("swapTxConfirmationSwapFailed"),"getErrorTitle"),TN=i(t=>{switch(t.message){case M.LedgerConnectionError:return R.t("swapTxConfirmationSwapFailedLedgerConnectionError");case M.LedgerRejectAction:return R.t("swapTxConfirmationSwapFailedLedgerReject");case M.LedgerUnknownSignError:return R.t("swapTxConfirmationSwapFailedLedgerSignError");case M.LedgerUnknownError:return R.t("swapTxConfirmationSwapFailedLedgerError");default:return null}},"getLedgerErrorMessage"),AN=i((t,e)=>{let r=TN(e);if(r!==null)return r;if(t)switch(e.message){case M.SlippageExceeded:return R.t("swapTxConfirmationSwapFailedSlippageLimit");default:return R.t("swapTxBridgeFailedDescription")}else switch(e.message){case M.InsufficientFunds:return R.t("swapTxConfirmationSwapFailedInsufficientBalance");case M.SlippageExceeded:return R.t("swapTxConfirmationSwapFailedSlippageLimit");case M.EmptyRoute:return R.t("swapTxConfirmationSwapFailedEmptyRoute");case M.AccountFrozen:return R.t("swapTxConfirmationSwapFailedAcountFrozen");case M.SimulationTimeout:return R.t("swapTxConfirmationSwapFailedSimulationTimeout");case M.InsufficientGas:return R.t("swapTxConfirmationSwapFailedInsufficientGas");case M.NotValidScanResultsError:return R.t("swapTxConfirmationSwapFailedUnknownError");case M.StaleQuote:return R.t("swapTxConfirmationSwapFailedStaleQuote");case M.SimulationUnknownError:return R.t("swapTxConfirmationSwapFailedSimulationUnknownError");default:return R.t("swapTxConfirmationSwapFailedTryAgain")}},"getErrorMessage"),xN=i((t,e)=>t?Zu:e.message===M.AccountFrozen?l0:Zu,"getHelpButtonLink");u();l();var yx=i(({sellAmount:t,sellFungible:e,buyAmount:r,buyFungible:o,txStatus:n,txReceipt:s,swapTransactions:c,isReadyToExecute:p,uiEstimatedTime:d,isBridge:m,isLedger:f,notEnoughSol:g,txError:w,txErrorTitle:y,txErrorMessage:S,explorerUrl:b,txErrorHelpButtonLink:T,addressType:A})=>{let E=Ae(t,e?.data.decimals??0).toNumber(),I=Ae(r,o?.data.decimals??0).toNumber(),P=n==="success",U=n==="error",O=!!s,_=c?.transactions.length||0;return{sellAsset:{amount:E,symbol:e?.data.symbol??"",networkID:e?.data.chain.id??oe.Solana.Mainnet},buyAsset:{amount:I,symbol:o?.data.symbol??"",networkID:o?.data.chain.id??oe.Solana.Mainnet},estimatedTime:d,isBridge:m,isSuccess:P,isFailure:U,isLedger:f,isClosable:O,notEnoughSol:g,txError:w,txErrorTitle:y,txErrorMessage:w?.detailMessage?`${S}

${w?.detailMessage}`:S,txLink:b??"",txErrorHelpButtonLink:T,numberOfTransactions:_,isReadyToExecute:p,addressType:A}},"mapToSwapConfirmationViewState");var Yf=i(({sellFungible:t,txReceipt:e,swapTransactions:r,isBridge:o,txError:n,txStatus:s,isReadyToExecute:c,isLedger:p})=>{let d=t?.data.chain.id??oe.Solana.Mainnet,{notEnoughSol:m,txErrorTitle:f,txErrorMessage:g,txErrorHelpButtonLink:w}=(0,xo.useMemo)(()=>gx(o,n),[o,n]),y=(0,xo.useMemo)(()=>C.getAddressType(d),[d]),{currentQuote:S}=xe(),[b]=(0,xo.useState)(S),{buyAmount:T,sellAmount:A}=b??{buyAmount:"0",sellAmount:"0"},E=$(_=>_.buyFungible),{data:I}=gy(),P=(0,xo.useMemo)(()=>Bl({txReceipt:e,networkID:d,preferredExplorers:I}),[e,d,I]),U=(0,xo.useMemo)(()=>Cn(b),[b]);return(0,xo.useCallback)(()=>yx({sellFungible:t,txReceipt:e,addressType:y,swapTransactions:r,isBridge:o,txError:n,sellAmount:A,buyAmount:T,buyFungible:E,txStatus:s,isReadyToExecute:c,uiEstimatedTime:U,isLedger:p,notEnoughSol:m,txErrorTitle:f,txErrorMessage:g,explorerUrl:P,txErrorHelpButtonLink:w}),[t,e,y,r,o,n,A,T,E,s,c,U,p,m,f,g,P,w])()},"useSwapConfirmationViewState");u();l();var or=N(z());u();l();var Ws=N(z());var Rn=i(()=>{let t=ue(),e=Hs(),{currentQuote:r,quoteResponse:o,selectedProviderIndex:n,selectedBaseProvider:s}=xe(),{analyticsContext:c}=r??{analyticsContext:void 0},p=$(_=>_.buyFungible),d=$(_=>_.sellFungible),m=$(_=>_.buyUsdValue),f=$(_=>_.sellUsdValue),g=$(_=>_.swapFilter),{selectedSetting:w}=$t(),y=$.getState().amountType,S=d?.data.chain.id??oe.Solana.Mainnet,b=Vf(),{transition:T}=Ks(),A=(0,Ws.useCallback)(_=>{let H=Gs(n,w.type,o);return ll({buyToken:p,sellToken:d,buyAmount:r?.buyAmount.toString()??"",sellAmount:r?.sellAmount.toString()??"",phantomFeeUiAmount:b.phantomFee.amountUsd?.toString()??"",priceImpact:dl(r),provider:De(Me(r)),baseProvider:s,buyAssetUsdValue:m,sellAssetUsdValue:f,slippageTolerance:H,transactionId:_??"",slippageType:w.type,sellSwapFilter:g,analyticsContext:c})},[p,d,r,b.phantomFee.amountUsd,m,f,o,n,w.type,g,c,s]),E=(0,Ws.useCallback)(_=>{pl({txReceipt:_,networkID:S,amountType:y,swapAnalytics:e,walletAddress:d?.data.walletAddress})},[S,y,e,d?.data.walletAddress]),I=(0,Ws.useCallback)((_,H)=>{T({type:Xe.TransactionSubmissionFailed,error:_}),_.message!==M.NotValidScanResultsError&&_.message!==M.SlippageExceeded&&k.captureError(_,v.Swapper);let Q=A(H);t.capture("swapperSwapFailure",{data:{...Q.data,error:_.message}})},[t,A,T]),P=i(()=>{t.capture("swapperSwapFailureNoSignature")},"logSwapFailureNoSignature"),U=(0,Ws.useCallback)(_=>{let H=A(_.id);t.capture("swapperSwapSuccess",H);let Q=No(_.networkID);k.addBreadcrumb(v.Swapper,"transactionStatus",D.Info,{...Q,txReceipt:_.id}),(Q.chainType===se.EVM||Q.chainType===se.Solana||Q.chainType===se.Sui)&&e.transactionStatus(_.id,{...Q,status:{type:"confirmed"}})},[t,A,e]),O=(0,Ws.useCallback)((_,H)=>{let Q=_?.networkID?No(_.networkID):null;(Q?.chainType===se.EVM||Q?.chainType===se.Solana||Q?.chainType===se.Sui)&&_?.id&&(k.addBreadcrumb(v.Swapper,"transactionStatus",D.Error,{...Q,txReceipt:_.id}),e.transactionStatus(_.id,{...Q,status:{type:"error"}}),T({type:Xe.TransactionConfirmationFailed,error:H,txReceipt:_}))},[e,T]);return{logTransactionSubmitted:E,logTransactionSubmissionError:I,logSwapFailureNoSignature:P,logTransactionConfirmed:U,logTransactionConfirmationFailed:O}},"useSwapConfirmationAnalytics");u();l();var Tx=N(z());u();l();var wx=i(()=>{let{selectedSetting:t}=$t(),{selectedProviderIndex:e,quoteResponse:r}=xe(),o=Gs(e,t.type,r),{data:n}=sl();return{slippageSetting:t,slippageTolerance:o??n??void 0}},"useAutoSlippageAwareSlippageTolerance");u();l();u();l();var Nl=N(z());u();l();var Xf="swap-validation",Sx=i(({scanResult:t,scanResultError:e,quote:r,sellToken:o,buyToken:n})=>{if(e)return"valid";if(!r||!o||!n)return k.addBreadcrumb(Xf,`Missing necessary args: ${JSON.stringify({quote:!!r,scanResult:!!t,sellToken:o,buyToken:n})}`,D.Info),new _e(M.MissingArgument);if(t?.error===qr.SIMULATION_FAILED)return"valid";if(t?.error){if(k.addBreadcrumb(Xf,`Simulation error: ${JSON.stringify({error:t.error})}`,D.Info),t.error===qr.SLIPPAGE_EXCEEDED)return new _e(M.SlippageExceeded);if(t.error===qr.INSUFFICIENT_FUNDS)return new _e(M.InsufficientFunds);if(t.error===qr.INSUFFICIENT_GAS)return new _e(M.InsufficientGas);if(t.error===qr.ACCOUNT_FROZEN)return new _e(M.AccountFrozen);if(t.error===qr.SIMULATION_TIMEOUT)return new _e(M.SimulationTimeout);if(t.error===qr.STALE_QUOTE)return new _e(M.StaleQuote);if(t.error===qr.UNKNOWN_ERROR){let s=EN(t);return new _e(M.SimulationUnknownError,s)}return new _e(M.NotValidScanResultsError)}return t?"valid":(k.addBreadcrumb(Xf,`Missing necessary args: ${JSON.stringify({quote:!!r,scanResult:!1,sellToken:o,buyToken:n})}`,D.Info),new _e(M.MissingArgument))},"validateScanResult");function EN(t){return t.simulationError?t.simulationError.humanReadableError:t.warnings[0]?.message}i(EN,"parseScanErrorDetail");var bx=i(({swapTransactions:t})=>{let e=$(b=>b.sellFungible),r=$(b=>b.buyFungible),o=e?.data.chain.id??oe.Solana.Mainnet,{selectedSetting:n}=$t(),{currentQuote:s,quoteResponse:c}=xe(),p=De(Me(s)),d=Kt(e?.data.chain.id,r?.data.chain.id),m=c?.buyToken?L(c?.buyToken):void 0,f=c?.sellToken?L(c?.sellToken):void 0,g={type:"transaction",userAccount:e?.data.walletAddress??"",params:void 0,url:"https://phantom.com",networkID:o,context:d?"bridge":"swap",provider:p,slippageType:n.type,metadata:{swapper:{quoteOutputAmount:s?.buyAmount,quoteOutputToken:m,quoteInputAmount:s?.sellAmount,quoteInputToken:f}}};t?.type==="evm"&&C.isEVMNetworkID(o)&&(g.params={transactions:t.transactions}),t?.type==="solana"&&C.isSolanaNetworkID(o)&&(g.params={transactions:t.transactions,method:"signAndSendTransaction",simulatorConfig:{decodeAccounts:!1}});let{transition:w}=Ks(),y=(0,Nl.useCallback)((b,T)=>{T&&w({type:Xe.SimulationRequestError,error:T}),b&&w({type:Xe.SimulationResponseReceived,scannedTransactionResult:b})},[w]),S=zf(g,{disableRefetch:!0,onSettled:y,disabled:t?.type==="sui"});return(0,Nl.useMemo)(()=>{if(S.isLoading)return{isLoading:!0,state:"loading"};if(t?.type==="sui")return{isLoading:!1,state:"valid"};let b=Sx({scanResult:S.data,scanResultError:S.isError,quote:s,sellToken:c?.sellToken,buyToken:c?.buyToken,simulationTolerance:c?.simulationTolerance});return{isLoading:S.isLoading,state:b}},[S,s,c,t?.type])},"useSwapScanTransaction");function Ax({isBridge:t,addressType:e,isSwapSimulationDisabled:r,onTransactionReceiptReceived:o,onTransactionSubmissionError:n,resetToInitialState:s,sender:c}){let{logTransactionSubmitted:p,logSwapFailureNoSignature:d}=Rn(),{connection:m}=qo(),{data:f}=ye(),{currentQuote:g,quoteResponse:w}=xe(),{slippageTolerance:y}=wx(),S=$(F=>F.gasEstimation.estimateWithBuffer),b=$(F=>F.sellFungible),T=b?.data.chain.id??oe.Solana.Mainnet,{data:A,isSuccess:E}=ds({callerAddress:c,quote:g,sellFungible:b}),I=bx({swapTransactions:A}),{pendingActivityRows:P}=nb({sender:c}),{mutateAsync:U}=MA({accountIdentifier:f?.identifier??"",networkID:T}),[O,_]=(0,Tx.useState)(!1),H=i(async()=>(_(!0),GT({isBridge:t,addressType:e,isSwapSimulationDisabled:r,sender:c,currentQuote:g,quoteResponse:w,gasEstimation:S,swapTransactions:A,scanResults:I,pendingActivityRows:P,connection:m,slippageTolerance:y,logSwapFailureNoSignature:d,logTransactionSubmitted:p,swapFungibles:U,onTransactionSubmissionError:n,onTransactionReceiptReceived:o,resetToInitialState:s})),"executeSwapAndTrack");return{isReadyToExecute:O||(!I.isLoading||r)&&E,executeSwap:H}}i(Ax,"useExecuteSwap");u();l();var Ll=N(z());var xx=i(({goToSwapTab:t,goToActivityTab:e})=>{let{resume:r}=kn(),{clearQuotes:o}=Of(),n=vn(),s=(0,Ll.useCallback)(()=>{r(),o(),t()},[t,r,o]),c=(0,Ll.useCallback)(()=>{r()},[r]),p=(0,Ll.useCallback)(()=>{n(),e()},[e,n]);return{onClose:s,onRetry:c,onSwapSuccess:p}},"useSwapConfirmationActions");u();l();function Ex(){let{data:[t]}=qt(["kill-swapper-simulation"]);return t}i(Ex,"useSwapSimulationInterceptor");u();l();var Zs=N(z());var Cx=i(({onTransactionConfirmationSuccess:t,onTransactionConfirmationError:e,txReceipt:r})=>{let o=Be(),{data:n}=ye(),s=(0,Zs.useMemo)(()=>n?.addresses??[],[n]),c=nw(s),p=vn(),{logTransactionConfirmed:d,logTransactionConfirmationFailed:m,logTransactionSubmissionError:f}=Rn(),g=$(I=>I.sellFungible),{currentQuote:w}=xe(),{sellAmount:y}=w??{sellAmount:"0"},S=ew({wallets:s,encodedCaip19:g?L(X(g)):""}),b=(0,Zs.useCallback)(async I=>{if(d(I),p(),g){let P=new K(g.data.amount),U=new K(y),O=P.minus(U).toString();ml(o,{id:fl(g),amount:O})}c(),S()},[d,p,y,g,c,S,o]),{isSuccess:T,isError:A,error:E}=Zy(b,r);(0,Zs.useEffect)(()=>{if(T)t();else if(A){let I=Yo(E);e(I),m(r,I),f(I,r?.id)}},[T,A,E,r,m,t,e,f])},"useSwapTransactionConfirmation");function kx({isLedger:t,goToSwapTab:e,goToActivityTab:r}){let{currentQuote:o}=xe(),n=$(Ee=>Ee.buyFungible),s=$(Ee=>Ee.sellFungible),c=vn(),p=Ex(),{logTransactionSubmissionError:d}=Rn(),[m]=(0,or.useState)(Kt(s?.data.chain.id,n?.data.chain.id)),f=s?.data.chain.id??oe.Solana.Mainnet,{data:g}=ye(),w=(0,or.useMemo)(()=>g?.addresses??[],[g]),y=(0,or.useMemo)(()=>w.find(Ee=>Ee.networkID===s?.data.chain.id)?.address??"",[w,s]),S=(0,or.useMemo)(()=>C.getAddressType(f),[f]),{data:b}=ds({callerAddress:y,quote:o,sellFungible:s}),[T,A]=(0,or.useState)(),[E,I]=(0,or.useState)("loading"),[P,U]=(0,or.useState)(),O=i(()=>{I("loading"),U(void 0),A(void 0)},"resetToInitialState"),_=i(Ee=>{A(Ee)},"onTransactionReceiptReceived"),H=(0,or.useCallback)((Ee,St)=>{I("error"),U(Ee),d(Ee,St)},[d]),Q=(0,or.useCallback)(()=>{I("success")},[]),F=(0,or.useCallback)(Ee=>{I("error"),U(Yo(Ee))},[]);Cx({onTransactionConfirmationSuccess:Q,onTransactionConfirmationError:F,txReceipt:E==="error"?void 0:T});let{executeSwap:B,isReadyToExecute:W}=Ax({isBridge:m,addressType:S,isSwapSimulationDisabled:p,onTransactionSubmissionError:H,onTransactionReceiptReceived:_,resetToInitialState:O,sender:y}),{onClose:re,onRetry:ee,onSwapSuccess:Y}=xx({goToSwapTab:e,goToActivityTab:r});return{...Yf({sellFungible:s,txReceipt:T,swapTransactions:b,isBridge:m,txStatus:E,isReadyToExecute:W,isLedger:t,txError:P}),executeSwap:B,resetSwapper:c,onClose:re,onRetry:ee,onSwapSuccess:Y}}i(kx,"useSwapConfirmationProps");u();l();u();l();var Ix=N(z());var CN=i(()=>{let t=rt();return{selectQuote:(0,Ix.useCallback)((r,o)=>{let n=r[o];n&&t.selectQuote(n)},[t])}},"useSelectQuote");u();l();u();l();u();l();var va=j({days:1}),Jf=j({seconds:5}),Fx=j({seconds:30}),XTe=j({seconds:30}),JTe=j({seconds:5}),e0e=j({seconds:5}),t0e=j({seconds:30}),r0e=j({seconds:2}),o0e=j({seconds:10}),n0e=j({seconds:30}),s0e=j({seconds:2}),i0e=j({seconds:10}),Px=i(t=>`/v1/actors-search?query=${encodeURIComponent(t)}`,"actorSearchEndpoint");u();l();var zx=a.object({actors:Er.array()}),Ys;(function(t){t.Buy="Buy",t.Sell="Sell",t.TokenFollow="TokenFollow"})(Ys||(Ys={}));var kN=a.object({type:a.literal("followers")}),IN=a.object({type:a.literal("actor"),id:a.string()}),FN=a.union([kN,IN]),Qx=a.object({actorId:a.string(),id:a.string(),published:a.coerce.string(),storyType:a.nativeEnum(Ys),destinations:a.array(FN)}),Hx=Qx.extend({chainId:xr}),PN=Hx.extend({storyType:a.literal(Ys.Buy),tokenBoughtAmount:a.string().nullish(),tokenBoughtUsdValue:a.string().nullish(),tokenBoughtPrice:a.string().nullish(),tokenBoughtAddress:a.string()}),vN=Hx.extend({storyType:a.literal(Ys.Sell),tokenSoldAmount:a.string().nullish(),tokenSoldUsdValue:a.string().nullish(),tokenSoldPrice:a.string().nullish(),tokenSoldAddress:a.string()}),_N=Qx.extend({storyType:a.literal(Ys.TokenFollow),tokenId:a.string(),otherTokenFollowers:a.array(a.string())}),g0e=a.union([PN,vN,_N]),Ml;(function(t){t.TokenMetadataV2="TokenMetadataV2",t.Actor="Actor"})(Ml||(Ml={}));var RN=Hy.pick({name:!0,symbol:!0,decimals:!0,logoUri:!0,extraMetadata:!0,price:!0}),Gx=a.object({id:a.string(),type:a.string()}),Kx=Gx.extend({type:a.literal(Ml.TokenMetadataV2),attributes:RN}),DN=Gx.extend({type:a.literal(Ml.Actor),attributes:Er});var vx;(function(t){t.SUGGESTED="suggested",t.BY_LIST="by-list"})(vx||(vx={}));var _x;(function(t){t.EXPLORE="explore",t.ONBOARDING="onboarding",t.PROFILE="profile",t.TOKEN="token"})(_x||(_x={}));var Rx;(function(t){t.TOP_PNL_1W="top_pnl_1w",t.TOP_PNL_1M="top_pnl_1m",t.SOCIAL_ONBOARDING="social_onboarding"})(Rx||(Rx={}));var Ul;(function(t){t.PNL="pnl",t.PNL_BY_TOKEN="pnl-by-token",t.FOLLOWS_YOU="follows-you",t.SEND_INTERACTION="send-interaction"})(Ul||(Ul={}));var $x=a.object({actorId:a.string()}),BN=$x.extend({type:a.literal(Ul.PNL),percentChange:a.number().optional()}),NN=$x.extend({type:a.literal(Ul.PNL_BY_TOKEN),caip19:vo,percentChange:a.number().optional()}),LN=a.discriminatedUnion("type",[BN,NN]),y0e=a.object({items:LN.array().default([]),included:DN.array().default([]),next:a.string().nullish()}),w0e=a.object({data:a.string().array().default([]),meta:a.object({model:a.string()}),included:Kx.array().default([])}),S0e=a.object({orderedItems:Er.array().default([]),next:a.string().optional()}),b0e=a.object({orderedItems:Er.array().default([]),next:a.string().optional()}),T0e=a.object({orderedItems:Er.array().default([]),next:a.string().optional()}),Dx;(function(t){t.ABUSE_AND_HARASSMENT="abuse_and_harassment",t.PRIVACY_AND_IMPERSONATION="privacy_and_impersonation",t.SPAM="spam"})(Dx||(Dx={}));var A0e=a.object({orderedItems:Er.array().default([]),next:a.string().optional()}),x0e=a.object({orderedItems:Er.array().default([]),next:a.string().optional()}),MN=a.object({id:a.string(),username:a.string(),icon:a.string().nullish()}),E0e=a.object({followingHolders:MN.array().default([])}),UN=a.object({targetId:a.string(),actorId:a.string(),type:a.string(),content:a.string()}),ON=a.object({targetId:a.string(),content:a.string(),type:a.string(),count:a.number({coerce:!0})});function qN(t,e){return t==="emoji"&&jx.includes(e)}i(qN,"canUseReactionCount");var zN=UN.transform(t=>({...t,content:jx.includes(t.content)?t.content:ie.Eyes})),C0e=a.object({reactions:a.array(zN),counts:a.array(ON).transform(t=>t.filter(e=>qN(e.type,e.content))).optional()}),k0e=a.object({actors:Er.array().default([]),nextCursor:a.string().optional()}),ie;(function(t){t.Bear="\u{1F43B}",t.Bull="\u{1F402}",t.CashFlying="\u{1F4B8}",t.Celebrate="\u{1F389}",t.ChartDown="\u{1F4C9}",t.ChartUp="\u{1F4C8}",t.Coin="\u{1FA99}",t.Cool="\u{1F60E}",t.CreditCard="\u{1F4B3}",t.CryLaughing="\u{1F602}",t.Crying="\u{1F62D}",t.DevilHappy="\u{1F608}",t.DevilMad="\u{1F47F}",t.Diamond="\u{1F48E}",t.Disgusted="\u{1F922}",t.Distressed="\u{1F62B}",t.Eggplant="\u{1F346}",t.Expressionless="\u{1F611}",t.Eyes="\u{1F440}",t.Fire="\u{1F525}",t.Flag="\u{1F3C1}",t.HeartEyes="\u{1F60D}",t.Heart="\u2764\uFE0F",t.Mad="\u{1F620}",t.MiddleFinger="\u{1F595}",t.MoneyBag="\u{1F4B0}",t.Moon="\u{1F319}",t.OkHand="\u{1F44C}",t.OpenMouth="\u{1F62E}",t.Peace="\u270C\uFE0F",t.Peach="\u{1F351}",t.PointUp="\u{1F446}",t.PileOfPoo="\u{1F4A9}",t.Pray="\u{1F64F}",t.Rocket="\u{1F680}",t.Siren="\u{1F6A8}",t.Skull="\u{1F480}",t.SmileWithTear="\u{1F972}",t.Smile="\u{1F600}",t.StopSign="\u{1F6D1}",t.Surprised="\u{1F632}",t.SweatDrops="\u{1F4A6}",t.Ufo="\u{1F6F8}",t.UpsideDownFace="\u{1F643}",t.Whale="\u{1F40B}"})(ie||(ie={}));var jx=[ie.CryLaughing,ie.Disgusted,ie.Mad,ie.Distressed,ie.HeartEyes,ie.OpenMouth,ie.SmileWithTear,ie.UpsideDownFace,ie.Smile,ie.Crying,ie.Surprised,ie.Expressionless,ie.Cool,ie.DevilHappy,ie.DevilMad,ie.Skull,ie.Eyes,ie.Diamond,ie.Fire,ie.Eggplant,ie.Peach,ie.CreditCard,ie.Heart,ie.SweatDrops,ie.Coin,ie.Siren,ie.MoneyBag,ie.PileOfPoo,ie.Celebrate,ie.OkHand,ie.MiddleFinger,ie.PointUp,ie.Peace,ie.Pray,ie.Rocket,ie.Ufo,ie.Moon,ie.ChartUp,ie.ChartDown,ie.Flag,ie.StopSign,ie.Bear,ie.Bull,ie.CashFlying,ie.Whale],I0e=a.object({isFollowing:a.boolean()}),Bx;(function(t){t.Blocking="blocking",t.Chat="chat",t.CompetitionLeaderboard="competitionLeaderboard",t.Deeplink="deeplink",t.Feed="feed",t.Followers="followers",t.FollowRequest="followRequest",t.ManageAccounts="manageAccounts",t.Notifications="notifications",t.Nux="nux",t.Onboarding="onboarding",t.PerpsLeaderboard="perpsLeaderboard",t.ReactionsDetails="reactionsDetails",t.Search="search",t.SuggestedFollows="suggestedFollows",t.SuggestedFollowsByList="suggestedFollowsByList"})(Bx||(Bx={}));var Nx;(function(t){t.VolumeDistribution="volumeDistribution",t.VolumeDistributionAllocations="volumeDistributionAllocations",t.OpenPositions="openPositions",t.ClosedPositions="closedPositions"})(Nx||(Nx={}));var Lx;(function(t){t.Profile="profile",t.ShareStory="shareStory"})(Lx||(Lx={}));var F0e=a.object({channelType:a.string(),channelId:a.string(),enabled:a.boolean()}),QN=a.object({userId:a.string(),username:a.string(),text:a.string(),createdAt:a.coerce.string()}),HN=a.object({id:a.string(),name:a.string(),image:a.string().nullish()}),P0e=a.object({channelId:a.string(),watcherCount:a.number(),watchers:a.array(HN).default([]),lastMessages:a.array(QN)}),v0e=a.object({quantity:a.number(),quantityString:a.string(),decimals:a.number(),price:a.number().nullish()}),_0e=a.object({positions:a.array(a.record(a.string(),a.any()))}),GN=a.object({profileId:a.string(),username:a.string(),quantity:a.number()}),R0e=a.object({channelId:a.string(),leaderboard:a.array(GN)}),Mx;(function(t){t.Buy="buy",t.Sell="sell",t.PredictionMarketBuy="prediction_market_position_buy",t.PredictionMarketSell="prediction_market_position_sell"})(Mx||(Mx={}));var KN=a.object({id:a.string(),tokenId:a.string(),createdAt:a.string(),updatedAt:a.string()}),D0e=a.object({data:a.array(KN),included:Kx.array().default([]),nextCursor:a.string().nullish()}),Vx=a.object({channelId:a.string(),channelType:a.string(),watcherCount:a.number()}),$N=Vx.extend({eventId:a.string()}),jN=Vx.extend({tokenId:a.string()}),B0e=a.union([$N,jN]),Ux;(function(t){t.TokenPage="tokenPage",t.TrendingList="trendingList",t.RecentList="recentList",t.Banner="banner",t.Notification="notification",t.PredictionMarket="predictionMarket",t.Perps="perps"})(Ux||(Ux={}));var Ox;(function(t){t.Chat="chat"})(Ox||(Ox={}));var VN=a.object({profileId:a.string(),userId:a.string(),username:a.string(),icon:Mg}),WN=a.object({accountValueUsd:a.number(),pnlUsd:a.number(),roiPct:a.number(),volumeUsd:a.number()}),qx=a.object({rank:a.number(),isViewer:a.boolean(),actor:VN,performance:WN}),N0e=a.object({leaderboard:a.array(qx),viewer:qx.nullish()}),L0e=a.object({accountValueUsd:a.number(),pnlUsd:a.number(),roiPct:a.number(),volumeUsd:a.number(),error:a.string().optional()}),Wx=a.object({market:a.string(),name:a.string(),image:a.string(),pnlUsd:a.number()}),ZN=Wx.extend({margin:a.number(),roiPct:a.number(),leverage:a.string(),direction:a.string()}),YN=Wx.extend({id:a.string(),valueUsd:a.number(),timestamp:a.number(),type:a.string()}),XN=a.object({market:a.string(),name:a.string(),image:a.string(),color:a.string().optional(),volumePct:a.number()}),M0e=a.object({portfolio:a.object({pnlUsd:a.number(),volumeUsd:a.number()}),openPositions:a.object({positions:a.array(ZN)}),closedPositions:a.object({volumeByMarket:a.array(XN),positions:a.array(YN)})}),U0e=a.object({totalSwapVolumeUsd:a.number(),totalPerpsVolumeUsd:a.number(),totalVolumeUsd:a.number()}),JN=a.object({caip19:a.string(),name:a.string(),symbol:a.string(),logoUri:a.string().nullish().default(null),balancePct:a.number()}),O0e=a.object({tradeCount:a.number(),fungibles:a.array(JN)}),_a;(function(t){t.PredictionMarket="predictionMarket",t.Perps="perps",t.Token="token"})(_a||(_a={}));u();l();var Xs=i(({name:t,response:e,current:r,target:o})=>{let n=`Failed to ${t}: 
`,s=[r!==void 0?`Current: ${r}`:null,o!==void 0?`Target: ${o}`:null].filter(Boolean);return s.length>0&&(n+=`${s.join(" | ")} 
`),n+=`${e.status} ${e.statusText} 
`,n+=`${JSON.stringify(e.data)}`,n},"getFetcherErrorMessage"),Zx=i(({name:t,error:e,current:r,target:o})=>{let n=`Failed to parse ${t}: 
`,s=[r!==void 0?`Current: ${r}`:null,o!==void 0?`Target: ${o}`:null].filter(Boolean);return s.length>0&&(n+=`${s.join(" | ")} 
`),n+=`${JSON.stringify(e)}`,n},"getParserErrorMessage");var Yx=i(async t=>{k.addBreadcrumb(v.Network,"User is searching for actors.",D.Info,{query:t});let e=await G.api().bearer(!0).get(Px(t));if(!J(e)){let o=new Error(Xs({name:"searchForActor",response:e}));throw k.captureError(o,v.UserSearch),o}let r=zx.safeParse(e.data);return r.success?{actors:r.data.actors}:{actors:[]}},"searchForActor");u();l();u();l();function Xx(t){let e=t.match(/\/v1\/actors\/([^/]+)/)?.[1];return e?tc.parse(e):void 0}i(Xx,"userProfileIdFromUrl");u();l();function Jx(t){return Xx(t)??tc.parse(t)}i(Jx,"userProfileIdFromUrlOrProfileId");u();l();var be="social",Te="@phantom/social",Yr={actor(t){return[be,`${Te}:actor`,{profileId:t}]},actorVolume(t){return[be,`${Te}:actor-volume`,{profileId:t}]},actorAndFollowers(t){return[be,`${Te}:actor-and-followers`,{profileId:t}]},actorAndFollowing(t){return[be,`${Te}:actor-and-following`,{profileId:t}]},userProfileByUsernameOrUserProfileId(t){return[be,`${Te}:user-profile-by-username-or-user-profile-id`,{usernameOrUserProfileId:t}]},followUser(t,e){return[be,`${Te}:follow-user`,{currentId:t,targetId:e}]},followingTokens(t){return[be,`${Te}:following-tokens`,{limit:t}]},feedStory(t){return[be,`${Te}:feed-story`,{storyId:t}]},searchForActorBase(){return[be,`${Te}:search`]},searchForActor(t){return[be,`${Te}:search`,{query:t}]},followRequests(t){return[be,`${Te}:follow-requests`,{profileId:t}]},suggestedActors(t,e){return[be,`${Te}:suggested-follows`,{profileId:e,source:t}]},actorList(t,e,r){return[be,`${Te}:actor-list`,{profileId:r,listName:e,source:t}]},blocking(t){return[be,`${Te}:blocking`,{profileId:t}]},pendingFollowRequests(t,e){return[be,`${Te}:pending-follow-requests`,{profileId:t,targetId:e}]},reaction(t){return t?[be,`${Te}:reaction`,{targetId:t}]:[be,`${Te}:reaction`]},reactionDetails(t){return t.targetId?[be,`${Te}:reaction-details`,t]:[be,`${Te}:reaction-details`,{content:t.content}]},followingHolders(t,e){return[be,`${Te}:following-holders`,{profileId:t,caip19:e}]},tokenFollows(t,e){return[be,`${Te}:token-follows`,{profileId:t,caip19:e}]},userProfileFeed(t,e){return[be,`${Te}:user-profile-feed`,{username:t,userEnabledNetworks:e}]},chatEnabled(t){return[be,`${Te}:chat-enabled`,{chatId:t}]},chatStats(t){return[be,`${Te}:chat-stats`,{chatId:t}]},tokenChatBalance(t,e){return[be,`${Te}:token-chat-balance`,{caip19:t,userId:e}]},predictionMarketPosition(t,e){return[be,`${Te}:prediction-market-position`,{eventId:t,profileId:e}]},chatLeaderboard(t){return[be,`${Te}:chat-leaderboard`,{caip19:t}]},similarTokens(t,e,r){return[be,`${Te}:similar-tokens`,{caip19:t,profileId:r,limit:e}]},popularChats(){return[be,`${Te}:popular-chats`]},chatChannel(t,e){return[be,`${Te}:chat-channel`,{channelType:t,channelId:e}]},perpsLeaderboard(t,e){return[be,`${Te}:perps-leaderboard`,{limit:t,windowPeriod:e}]},perpsPortfolio(t,e){return[be,`${Te}:perps-portfolio`,{windowPeriod:t,userId:e}]},perpsProfile(t,e,r){return[be,`${Te}:perps-profile`,{profileId:t,openLimit:e,closedLimit:r}]},fungiblesPortfolio(t,e){return[be,`${Te}:fungibles-portfolio`,{profileId:t,limit:e}]},chatBlockList(t){return[be,`${Te}:chat-block-list`,{userId:t}]}};var eE=i((t,e)=>{let r=Jx(e.id);r&&t.setQueryData(Yr.actor(r),e)},"setActorInQueryCache");var tE=i(async(t,e)=>{let r=e?.startsWith("@")?e.slice(1):e;if(!r)throw new Error("No sanitized username or user profile id");let o=await t.getUserProfileByUsernameOrUserProfileId(r);if(!o)throw new Error("No user profile");return o},"getUserProfileByUsernameOrUserProfileIdQueryFn");function eL({usernameOrUserProfileId:t}){let e=ny(),r=Yr.userProfileByUsernameOrUserProfileId(t);return te({enabled:!!t,queryKey:r,queryFn:i(async()=>tE(e,t),"queryFn"),gcTime:va,staleTime:Jf})}i(eL,"useGetUserProfileByUsernameOrUserProfileId");function tL({query:t}){let e=Be(),r=t?.startsWith("@")?t.slice(1).trim():t.trim(),o=Yr.searchForActor(r),n=i(async()=>{let{actors:s}=await Yx(r);for(let c of s)eE(e,c);return s.sort((c,p)=>c.isFollowing?-1:p.isFollowing?1:0),{actors:s}},"queryFn");return Ja({enabled:r.length>1,queryKey:o,queryFn:n,gcTime:va,staleTime:Jf})}i(tL,"useSearchForActor");u();l();u();l();u();l();var rE;(function(t){t.BID="B",t.ASK="A"})(rE||(rE={}));var oE;(function(t){t.OPEN="open",t.FILLED="filled",t.CANCELED="canceled",t.TRIGGERED="triggered",t.REJECTED="rejected",t.MARGIN_CANCELED="margin_canceled"})(oE||(oE={}));var Ze=a.string().regex(/^\d*\.?\d+([eE][+-]?\d+)?$/,"Invalid numeric string"),ht=a.string().regex(/^-?\d*\.?\d+([eE][+-]?\d+)?$/,"Invalid signed numeric string");var Js=Pg.extend({chainId:Ig,address:a.string()}),sE=a.object({tokenIndex:a.number(),pairIndex:a.number()}),nE=a.object({symbol:a.string(),name:a.string(),token:Js,logoUri:a.string(),szDecimals:a.number(),maxLeverage:a.number(),price:ht,priceChange24h:a.object({amount:ht,percentage:ht}),volume24h:Ze,openInterest:Ze,fundingRate:ht,assetId:a.number(),isAtOpenInterestCap:a.boolean().optional(),description:a.string().optional(),collateralToken:sE.optional()}),iE=a.object({markets:a.array(nE).transform(t=>t.reduce((e,r)=>{let o=nE.safeParse(r);return o.success&&(e[L(o.data.token)]=o.data),e},{}))}),zAe=a.object({id:a.string(),name:a.string(),logoUri:a.string(),currentPrice:a.number(),maxLeverage:a.number(),szDecimals:a.number(),assetId:a.number(),symbol:a.string(),collateralToken:sE.optional()});u();l();var Xr="perps",ei={historicalOrders:i((t,e)=>[Xr,"historical-orders",t,e],"historicalOrders"),market:i(t=>[Xr,"market",t],"market"),markets:i(t=>[Xr,"markets",t.sort()],"markets"),defaultLeverage:i(()=>[Xr,"default-leverage"],"defaultLeverage"),assetLeverage:i(()=>[Xr,"asset-leverage"],"assetLeverage"),permissions:i(()=>[Xr,"config"],"permissions"),fungibleToPerpMap:i(()=>[Xr,"fungible-to-perp-map"],"fungibleToPerpMap"),fundsInTransitBanner:i(t=>[Xr,"funds-in-transit-banner",t],"fundsInTransitBanner"),fundsInTransitBannerDismissed:i(()=>[Xr,"funds-in-transit-banner-dismissed"],"fundsInTransitBannerDismissed"),getStartedCardDismissed:i(()=>[Xr,"get-started-card-dismissed"],"getStartedCardDismissed")};u();l();var rL={perp:6,spot:8};function aE(t,e,r="perp",o=x.ROUND_HALF_UP){let n=new x(t);if(n.isInteger())return n.toString();let s=rL[r],c=Math.max(s-e,0);return n.precision(5,o).toFixed(c,o).replace(/\.?0+$/,"")}i(aE,"formatUiPrice");var cE=j({days:1}),uE=j({minutes:5}),oL=i(async t=>{if(!t)return null;try{return(await lE([t]))[t]??null}catch(e){throw k.addBreadcrumb(v.Perps,"Failed to get perp market",D.Error,{caip19:t,error:e instanceof Error?e.message:"Unknown error"}),e}},"getPerpMarketQueryFn");function nL(t){return{enabled:!!t,queryKey:ei.market(t),gcTime:cE,staleTime:uE,queryFn:i(()=>oL(t),"queryFn")}}i(nL,"getPerpMarketQueryOptions");var sL=i(t=>te(nL(t)),"useGetPerpMarket"),eh=i((t,e=!1)=>te({enabled:t.length>0,queryKey:ei.markets(t),gcTime:cE,staleTime:uE,async queryFn(){try{return await lE(t,e)}catch(r){throw k.addBreadcrumb(v.Perps,"Failed to get perp markets",D.Error,{caip19s:t.join(","),error:r instanceof Error?r.message:"Unknown error"}),r}}}),"useGetPerpMarkets");async function lE(t,e=!1){let r=await G.api().get("/swap/v2/perp/markets",{params:{tokens:t.join(",")}});if(!J(r))throw new Error("Failed to get perp markets: response is not okay");let o=r.data,n=iE.safeParse(o);if(!n.success)throw new Error("Failed to get perp markets: schema validation failed");if(e){let s=n.data.markets,c={};for(let[p,d]of Object.entries(s))c[p]={...d,price:aE(d.price,d.szDecimals),priceChange24h:{...d.priceChange24h,percentage:String(Number(d.priceChange24h.percentage)/100)}};return c}return n.data.markets}i(lE,"getPerpMarkets");u();l();u();l();u();l();async function pE(t){let e=await G.api().bearer(!0).headers({Accept:"application/activity+json"}).get(`/v1/actors/${t}`);if(!J(e)){let o=new Error(Xs({name:"getActor",response:e,target:t}));throw k.captureError(o,v.Profiles),o}let r=Er.safeParse(e.data);if(r.success)return r.data;{let o=new Error(Zx({name:"getActor",error:r.error,target:t}));throw k.captureError(o,v.Profiles),o}}i(pE,"getActor");function th(t,e=!0){let r=i(async()=>{if(!t)throw new Error("No profile ID or access token");return pE(t)},"queryFn");return Ja({queryKey:Yr.actor(t),queryFn:r,enabled:e&&!!t,gcTime:va,staleTime:Fx})}i(th,"useGetActor");u();l();u();l();var iL=a.object({name:a.string(),shortName:a.string()}).passthrough(),aL=a.object({type:a.string(),eventTicker:a.string(),ui:iL}).passthrough(),cL=a.enum(["YES","NO"]).transform(t=>t.toLowerCase()),uL=a.object({outcome:cL,size:a.coerce.number(),platformData:aL,signature:a.string().optional(),time:a.string().optional(),activityType:a.enum(["BUY","SELL","synthesizedResolvedLost"]),escrowMintAmount:a.coerce.number().optional(),escrowMintAddress:a.string().optional(),outputMintAmount:a.number().optional(),outputMintAddress:a.string().optional(),exposure:a.coerce.number().optional()}).passthrough(),dE=a.object({activities:a.array(uL),offset:a.number().optional()}).passthrough();u();l();u();l();var rh=a.object({marketLedger:a.string(),yesMint:a.string(),noMint:a.string(),isInitialized:a.boolean()}),lL=a.object({ticker:a.string(),eventTicker:a.string(),marketType:a.string(),title:a.string(),subtitle:a.string().optional(),yesSubTitle:a.string(),noSubTitle:a.string(),openTime:a.number(),closeTime:a.number(),expirationTime:a.number(),status:a.string(),volume:a.number(),result:a.string().nullish().default(null),openInterest:a.number(),canCloseEarly:a.boolean(),earlyCloseCondition:a.string().optional(),rulesPrimary:a.string(),rulesSecondary:a.string().optional(),accounts:a.record(a.string(),rh)}),Rxe=a.object({markets:a.array(lL),cursor:a.string().nullish().default(null)});u();l();var oh=a.object({backgroundColor:a.string(),textColor:a.string(),translucentBackgroundColor:a.string(),actionButtonColor:a.string().optional(),actionButtonTextColor:a.string().optional(),name:a.string(),shortName:a.string(),subtitle:a.string(),imageUrl:a.string().nullish().default(null).optional().transform(t=>t??void 0),competitionType:a.string().nullish().transform(t=>t??void 0),binaryOutcomeColors:a.object({yes:a.object({backgroundColor:a.string(),textColor:a.string()}),no:a.object({backgroundColor:a.string(),textColor:a.string()})}).optional()}),pL=a.object({label:a.string(),price:a.number().optional(),chance:a.number().optional(),bestBid:a.number().optional(),bestAsk:a.number().optional(),binaryType:a.enum(["yes","no"]).optional()}),dL=a.object({id:a.string(),title:a.string(),subtitle:a.string().optional(),slug:a.string().optional(),image:a.string().optional(),status:a.string(),outcomes:a.array(pL),startTime:a.string().optional(),endDate:a.string(),volume:a.number(),volume24h:a.number().optional(),liquidity:a.number(),openInterest:a.number().optional(),dflowAccounts:a.record(a.any()).optional(),custom_strike:a.record(a.any()).optional(),ui:oh.optional()}),mL=a.object({type:a.string()}).passthrough(),mE=a.object({id:a.string(),title:a.string(),subtitle:a.string().optional(),description:a.string().optional(),category:a.string(),image:a.string().optional(),icon:a.string().optional(),startDate:a.string(),endDate:a.string(),active:a.boolean(),closed:a.boolean(),markets:a.array(dL),volume:a.number(),volume24h:a.number(),liquidity:a.number(),openInterest:a.number().optional(),live:a.boolean().optional(),ended:a.boolean().optional(),score:a.string().optional(),elapsed:a.string().optional(),period:a.string().optional(),platformData:mL,product_metadata:a.object({competition:a.string().optional()}).passthrough().optional()}),Uxe=a.object({events:a.array(mE),nextKalshiCursor:a.string().optional()}),Oxe=mE.extend({subcategory:a.string().optional(),featuredImage:a.string().optional(),resolutionSource:a.string().optional(),creationDate:a.string().optional(),closedTime:a.string().optional(),archived:a.boolean().optional(),new:a.boolean().optional(),featured:a.boolean().optional(),restricted:a.boolean().optional(),volume1wk:a.number().optional(),volume1mo:a.number().optional(),volume1yr:a.number().optional(),liquidityAmm:a.number().optional(),liquidityClob:a.number().optional(),commentsEnabled:a.boolean().optional(),commentCount:a.number().optional(),competitive:a.number().optional(),tags:a.array(a.object({id:a.string(),label:a.string()})).optional(),categories:a.array(a.object({id:a.string(),label:a.string()})).optional(),collections:a.array(a.object({id:a.string(),title:a.string(),slug:a.string()})).optional(),series:a.array(a.object({id:a.string(),title:a.string(),ticker:a.string(),slug:a.string()})).optional(),subEvents:a.array(a.string()).optional(),parentEvent:a.string().optional(),createdBy:a.string().optional(),updatedBy:a.string().optional(),createdAt:a.string().optional(),updatedAt:a.string().optional(),publishedAt:a.string().optional()}).passthrough();var fL=a.discriminatedUnion("type",[a.object({type:a.literal("open")}),a.object({type:a.literal("claimable")}),a.object({type:a.literal("pending")}),a.object({type:a.literal("resolved"),result:a.enum(["won","lost"])})]),hL=a.object({marketId:a.string(),marketTitle:a.string(),eventId:a.string(),outcome:a.enum(["YES","NO"]).transform(t=>t.toLowerCase()),endDate:a.string(),size:a.number(),exposure:a.number().nullish().transform(t=>t??void 0),currentValue:a.number().nullish().transform(t=>t??void 0),platformData:a.object({type:a.literal("kalshi"),mint:a.string(),position:a.enum(["YES","NO"]),marketTicker:a.string(),eventTicker:a.string(),accounts:a.record(a.string(),rh),isLive:a.boolean(),eventStartDate:a.string().optional(),marketTitle:a.string(),marketSubtitle:a.string().optional(),status:fL,marketResult:a.enum(["yes","no"]).optional(),ui:oh.optional()}),lastUpdated:a.string()}),fE=a.object({positions:a.array(hL)});u();l();var hE=a.object({wonResolvedCount:a.number(),totalResolvedCount:a.number(),totalPnl:a.number(),volume:a.number()}).passthrough();u();l();var Dn;(function(t){t.Kalshi="kalshi",t.Polymarket="polymarket"})(Dn||(Dn={}));var gE;(function(t){t.Volume="volume",t.Volume24hr="volume24hr",t.StartTime="startTime",t.EventDate="eventDate"})(gE||(gE={}));var yE;(function(t){t.Sports="Sports",t.Politics="Politics",t.Finance="Finance",t.Crypto="Crypto",t.Earnings="Earnings",t.Tech="Tech",t.World="World",t.Economy="Economy",t.Elections="Elections",t.Mentions="Mentions",t.Culture="Pop-Culture",t.Geopolitics="Geopolitics",t.Entertainment="Entertainment",t.Health="Health",t.ScienceAndTechnology="Science and Technology",t.Social="Social",t.Transportation="Transportation",t.Companies="Companies",t.ClimateAndWeather="Climate and Weather",t.Financials="Financials",t.Economics="Economics"})(yE||(yE={}));var wE;(function(t){t.Soccer="Soccer",t.Basketball="Basketball",t.Football="Football",t.Baseball="Baseball",t.Hockey="Hockey",t.Tennis="Tennis",t.Golf="Golf",t.Boxing="Boxing",t.Mma="MMA",t.Esports="Esports",t.Motorsports="Motorsports",t.Cricket="Cricket",t.Chess="Chess",t.Weekly="Weekly",t.Recurring="Recurring",t.Stocks="Stocks",t.Equities="Equities",t.Daily="Daily",t.UpOrDown="Up or Down",t.Earnings="Earnings",t.Indicies="Indicies",t.Commodities="Commodities",t.Forex="Forex",t.Acquisitions="Acquisitions",t.Ipos="Ipos",t.FedRate="Fed Rate",t.Treasuries="Treasuries",t.Bitcoin="Bitcoin",t.Ethereum="Ethereum",t.Solana="Solana"})(wE||(wE={}));var gL="http://localhost:3017/predictions",yL="/predictions",gt=i(()=>yL,"getBasePath"),yt=i(()=>{let t=G.api(),e=R.language;return e?t.headers({"Accept-Language":e}):t},"getRequestBuilder"),Ol=class{static{i(this,"BackendPredictionsClient")}async getEvents(e){try{let o=(await yt().get(`${gt()}/v2/events`,{params:e})).data;if(o&&(o.error||o.statusCode)&&!o.events)throw console.error("[BackendPredictionsClient] getEvents received error response:",o),new Error(o.message||o.error||"Failed to fetch events");return o}catch(r){throw console.error("[BackendPredictionsClient] getEvents failed:",r),r}}async getEvent(e,r=Dn.Kalshi){try{let n=(await yt().get(`${gt()}/v2/event/${r}/${e}`)).data;if(n&&(n.error||n.statusCode))throw console.error(`[BackendPredictionsClient] getEvent received error response for ${e}:`,n),new Error(n.message||n.error||"Failed to fetch event");return n}catch(o){throw console.error(`[BackendPredictionsClient] getEvent failed for ${e} on ${r}:`,o),o}}async getMarket(e,r){try{return(await yt().get(`${gt()}/v2/market/${e}/${r}`)).data}catch(o){throw console.error(`[BackendPredictionsClient] getMarket failed for ${r}:`,o),o}}async searchEvents(e){try{let o=(await yt().get(`${gt()}/v2/events/search`,{params:e})).data;if(o&&(o.error||o.statusCode)&&!o.events)throw console.error("[BackendPredictionsClient] searchEvents received error response:",o),new Error(o.message||o.error||"Failed to search events");return o}catch(r){throw console.error("[BackendPredictionsClient] searchEvents failed:",r),r}}async getHistoricalPrices(e,r,o){try{return(await yt().get(`${gt()}/v2/historical-prices/${e}/${r}`,{params:o})).data}catch(n){throw console.error(`[BackendPredictionsClient] getHistoricalPrices failed for ${r}:`,n),n}}async getOrderbook(e,r,o){try{return(await yt().get(`${gt()}/v2/orderbook/${e}/${r}`,{params:o})).data}catch(n){throw console.error(`[BackendPredictionsClient] getOrderbook failed for ${r}:`,n),n}}async getPositions({address:e,venue:r,status:o}){try{let n=await yt().get(`${gt()}/v2/positions/${r}`,{params:{user:e,status:o}});return fE.parse(n.data)}catch(n){throw console.error("[BackendPredictionsClient] getPositions failed:",n),n}}async getActivities(e){try{return(await yt().get(`${gt()}/v2/activities`,{params:e})).data}catch(r){throw console.error("[BackendPredictionsClient] getActivities failed:",r),r}}async getUserActivities({address:e,venue:r,limit:o,offset:n}){try{let s={user:e,venue:r,includeLossTokens:"true",...o!==void 0&&{limit:o},...n!==void 0&&{offset:n}},c=await yt().get(`${gt()}/v2/user-activities`,{params:s});return dE.parse(c.data)}catch(s){throw console.error("[BackendPredictionsClient] getUserActivities failed:",s),s}}async getActiveOrders(e){try{return(await yt().get(`${gt()}/v2/active-orders`,{params:e})).data}catch(r){throw console.error("[BackendPredictionsClient] getActiveOrders failed:",r),r}}async getTabs(e){try{let o=e??!1?{test:"true"}:void 0;return(await yt().get(`${gt()}/v2/tabs`,{params:o})).data}catch(r){throw console.error("[BackendPredictionsClient] getTabs failed:",r),r}}async getPortfolio(){try{return(await yt().get(`${gt()}/v2/portfolio`)).data}catch(e){throw console.error("[BackendPredictionsClient] getPortfolio failed:",e),e}}async getUserStats({address:e,venue:r}){try{let o=await yt().get(`${gt()}/v2/user-stats`,{params:{user:e,venue:r}});return hE.parse(o.data)}catch(o){throw console.error("[BackendPredictionsClient] getUserStats failed:",o),o}}async getTrades(e,r,o,n){try{return(await yt().get(`${gt()}/v2/trades/${e}`,{params:{marketTickers:r.join(","),limit:o,after_ts:n}})).data}catch(s){throw console.error(`[BackendPredictionsClient] getTrades failed for ${e}:`,s),s}}async getForecastHistory(e,r,o){try{let n={start_ts:o.start_ts,period_interval:o.period_interval,candlestick_function:o.candlestick_function};return o.end_ts!==null&&(n.end_ts=o.end_ts),(await yt().get(`${gt()}/v2/forecast-history/${e}/${r}`,{params:n})).data}catch(n){throw console.error(`[BackendPredictionsClient] getForecastHistory failed for ${r}:`,n),n}}async getScoreV3(e,r){try{return(await yt().get(`${gt()}/v2/score/${e}/${r}`)).data}catch(o){throw console.error("[BackendPredictionsClient] getScoreV3 failed:",o),o}}async getHomeFeaturedItems(){try{return(await yt().get(`${gt()}/v2/home-featured-items`)).data}catch(e){throw console.error("[BackendPredictionsClient] getHomeFeaturedItems failed:",e),e}}async getFeed(){try{return(await yt().get(`${gt()}/v2/feed`)).data}catch(e){throw console.error("[BackendPredictionsClient] getFeed failed:",e),e}}MARKET_MINT_DECIMALS=6;async postOptimisticPosition(e,r,o){let n=await this.getMarket(Dn.Kalshi,o),s=new x(e.outAmount).shiftedBy(-this.MARKET_MINT_DECIMALS).toNumber(),c=n.platformData;if(c.type!==Dn.Kalshi)throw new Error("Only Kalshi markets are supported");let p=n.dflowAccounts,d=n.outcomes.find(m=>m.binaryType===r)?.price;return{marketId:n.id,marketTitle:n.title,eventId:c.eventTicker,outcome:r,endDate:n.endDate,size:s,exposure:d?s*d:void 0,platformData:{type:Dn.Kalshi,mint:e.outputMint,position:r==="yes"?"YES":"NO",marketTicker:c.ticker,eventTicker:c.eventTicker,accounts:p??{},isLive:!1,eventStartDate:n.startTime,marketTitle:n.title,marketSubtitle:n.ui?.name??n.subtitle,status:{type:"open"},ui:n.ui},lastUpdated:new Date().toISOString()}}};u();l();u();l();u();l();u();l();u();l();var FE=N(IE(),1),PE=FE.default;var xL=PE.bind({concatArrays:!0,ignoreUndefined:!0});function EL(t,e){let r=self.localStorage.getItem(t);if(r){let o=JSON.parse(r),n=JSON.parse(e),s=JSON.stringify(xL(o,n));self.localStorage.setItem(t,s)}else self.localStorage.setItem(t,e)}i(EL,"mergeLocalStorageItem");function oi(t,e){return new Promise((r,o)=>{try{let n=t();e?.(null,n),r(n)}catch(n){e?.(n),o(n)}})}i(oi,"createPromise");function Ql(t,e,r){return Promise.all(t).then(o=>{let n=r?.(o)??null;return e?.(null,n),Promise.resolve(n)},o=>(e?.(o),Promise.reject(o)))}i(Ql,"createPromiseAll");var Ra={getItem:i((t,e)=>oi(()=>self.localStorage.getItem(t),e),"getItem"),setItem:i((t,e,r)=>oi(()=>self.localStorage.setItem(t,e),r),"setItem"),removeItem:i((t,e)=>oi(()=>self.localStorage.removeItem(t),e),"removeItem"),mergeItem:i((t,e,r)=>oi(()=>EL(t,e),r),"mergeItem"),clear:i(t=>oi(()=>self.localStorage.clear(),t),"clear"),getAllKeys:i(t=>oi(()=>{let e=self.localStorage.length,r=[];for(let o=0;o<e;o+=1){let n=self.localStorage.key(o)||"";r.push(n)}return r},t),"getAllKeys"),flushGetRequests:i(()=>{},"flushGetRequests"),multiGet:i((t,e)=>{let r=t.map(n=>Ra.getItem(n));return Ql(r,e,i(n=>n.map((s,c)=>[t[c],s]),"processResult"))},"multiGet"),multiSet:i((t,e)=>{let r=t.map(o=>Ra.setItem(o[0],o[1]));return Ql(r,e)},"multiSet"),multiRemove:i((t,e)=>{let r=t.map(o=>Ra.removeItem(o));return Ql(r,e)},"multiRemove"),multiMerge:i((t,e)=>{let r=t.map(o=>Ra.mergeItem(o[0],o[1]));return Ql(r,e)},"multiMerge")},sh=Ra;u();l();var vE=sh;u();l();var CL=Object.defineProperty,_E=Object.getOwnPropertySymbols,kL=Object.prototype.hasOwnProperty,IL=Object.prototype.propertyIsEnumerable,RE=i((t,e,r)=>e in t?CL(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,"__defNormalProp"),ni=i((t,e)=>{for(var r in e||(e={}))kL.call(e,r)&&RE(t,r,e[r]);if(_E)for(var r of _E(e))IL.call(e,r)&&RE(t,r,e[r]);return t},"__spreadValues"),Hl=i(t=>e=>{try{let r=t(e);return r instanceof Promise?r:{then(o){return Hl(o)(r)},catch(o){return this}}}catch(r){return{then(o){return this},catch(o){return Hl(o)(r)}}}},"toThenable"),DE=i((t,e)=>(r,o,n)=>{let s=ni({getStorage:i(()=>localStorage,"getStorage"),serialize:JSON.stringify,deserialize:JSON.parse,partialize:i(T=>T,"partialize"),version:0,merge:i((T,A)=>ni(ni({},A),T),"merge")},e);(s.blacklist||s.whitelist)&&console.warn(`The ${s.blacklist?"blacklist":"whitelist"} option is deprecated and will be removed in the next version. Please use the 'partialize' option instead.`);let c=!1,p=new Set,d=new Set,m;try{m=s.getStorage()}catch{}if(m)m.removeItem||console.warn(`[zustand persist middleware] The given storage for item '${s.name}' does not contain a 'removeItem' method, which will be required in v4.`);else return t((...T)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),r(...T)},o,n);let f=Hl(s.serialize),g=i(()=>{let T=s.partialize(ni({},o()));s.whitelist&&Object.keys(T).forEach(I=>{var P;!((P=s.whitelist)!=null&&P.includes(I))&&delete T[I]}),s.blacklist&&s.blacklist.forEach(I=>delete T[I]);let A,E=f({state:T,version:s.version}).then(I=>m.setItem(s.name,I)).catch(I=>{A=I});if(A)throw A;return E},"setItem"),w=n.setState;n.setState=(T,A)=>{w(T,A),g()};let y=t((...T)=>{r(...T),g()},o,n),S,b=i(()=>{var T;if(!m)return;c=!1,p.forEach(E=>E(o()));let A=((T=s.onRehydrateStorage)==null?void 0:T.call(s,o()))||void 0;return Hl(m.getItem.bind(m))(s.name).then(E=>{if(E)return s.deserialize(E)}).then(E=>{if(E)if(typeof E.version=="number"&&E.version!==s.version){if(s.migrate)return s.migrate(E.state,E.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return E.state}).then(E=>{var I;return S=s.merge(E,(I=o())!=null?I:y),r(S,!0),g()}).then(()=>{A?.(S,void 0),c=!0,d.forEach(E=>E(S))}).catch(E=>{A?.(void 0,E)})},"hydrate");return n.persist={setOptions:i(T=>{s=ni(ni({},s),T),T.getStorage&&(m=T.getStorage())},"setOptions"),clearStorage:i(()=>{var T;(T=m?.removeItem)==null||T.call(m,s.name)},"clearStorage"),rehydrate:i(()=>b(),"rehydrate"),hasHydrated:i(()=>c,"hasHydrated"),onHydrate:i(T=>(p.add(T),()=>{p.delete(T)}),"onHydrate"),onFinishHydration:i(T=>(d.add(T),()=>{d.delete(T)}),"onFinishHydration")},b(),S||y},"persist");var FL=10,BE={chatJoinTimestamps:new Map,chatHistory:[]},PL=st(DE((t,e)=>({...BE,recordChatJoin:i(r=>{t(o=>{let n=new Map(o.chatJoinTimestamps);return n.set(r,Date.now()),{chatJoinTimestamps:n}})},"recordChatJoin"),recordChatLeave:i(r=>{t(o=>{let n=new Map(o.chatJoinTimestamps);return n.delete(r),{chatJoinTimestamps:n}})},"recordChatLeave"),recordChatMessage:i((r,o)=>{t(n=>({chatHistory:[{chatId:r,chatType:o,lastMessageTimestamp:Date.now()},...n.chatHistory.filter(p=>p.chatId!==r)].slice(0,FL)}))},"recordChatMessage"),clearChatHistory:i(()=>{t(r=>({...r,chatHistory:[]}))},"clearChatHistory"),removeChatFromHistory:i(r=>{t(o=>({...o,chatHistory:o.chatHistory.filter(n=>n.chatId!==r)}))},"removeChatFromHistory"),reset:i(()=>t(BE),"reset")}),{name:"chat-activity",getStorage:i(()=>vE,"getStorage"),partialize:i(t=>({chatHistory:t.chatHistory}),"partialize"),version:2,migrate(t,e){if(e===0){let r=t.chatHistory.map(o=>({chatId:o.chatId,chatType:o.chatId.startsWith("hypercore")?_a.Perps:_a.Token,lastMessageTimestamp:o.lastJoinedTimestamp??0}));return{...t,chatHistory:r}}if(e===1){let r=t.chatHistory.map(o=>({chatId:o.chatId,chatType:o.chatType,lastMessageTimestamp:o.lastJoinedTimestamp??0}));return{...t,chatHistory:r}}return t}})),NE=i(t=>PL.getState().chatJoinTimestamps.get(t),"getChatJoinTimestamp");var ih=i(async({chatTokenId:t,transactionId:e,networkId:r,tokenBoughtCaip19:o,tokenBoughtAmount:n,tokenBoughtUsdValue:s,tokenSoldCaip19:c,tokenSoldAmount:p,tokenSoldUsdValue:d,walletCaip19:m,chatTokenBalance:f,system:g})=>{if(!NE(t))return;let y=await G.api().bearer(!0).post("/social/v1/events/trades",{chatTokenId:t,networkId:r,tokenBoughtCaip19:o,tokenBoughtAmount:n,tokenBoughtUsdValue:s,tokenSoldCaip19:c,tokenSoldAmount:p,tokenSoldUsdValue:d,transactionId:e,walletCaip19:m,chatTokenBalance:f,system:g});if(!J(y)){let S=new Error(Xs({name:"publishSystemChatTradeMessage",response:y}));throw k.captureError(S,v.Chat),S}},"publishSystemChatTradeMessage");u();l();var vL=i(t=>{let{data:e}=th(t);return LE(e)},"useFollowersAndFollowingCount"),LE=i(t=>{let e={followers:t?.followers&&typeof t.followers=="object"&&t?.followers?.totalItems||0,following:t?.following&&typeof t.following=="object"&&t?.following?.totalItems||0};return{...e,formattedFollowers:Zn(e.followers||0,{compact:!0}),formattedFollowing:Zn(e.following||0,{compact:!0})}},"getFollowersAndFollowingCount");u();l();var ME=N(z());var _L=i(async(t,e,r)=>{try{await G.api().post("/swap/v2/presence",{caip19:t,visitorId:e,source:r})}catch(o){throw o instanceof Error&&k.captureError(o,v.Swapper),o}},"postTokenPresence"),RL=i((t,e)=>{let r=ue(),o=bt("enable-swapper-presence"),n=(0,ME.useCallback)(async()=>{if(!t||!o)return null;let s=await r.getDeviceId();return await _L(t,s,e),{success:!0,timestamp:Date.now()}},[t,e,r,o]);return te({queryKey:[...me.presence(t),"post",e],queryFn:n,enabled:!!t&&o,refetchInterval:5e3,gcTime:0,staleTime:0})},"usePostTokenPresence");u();l();u();l();var UE=N(z());u();l();var Gl=class{static{i(this,"CashSwapStateListener")}queryClient;storage;authRepository;cashAccount;constructor(e,r,o,n){this.queryClient=e,this.storage=r,this.authRepository=o,this.cashAccount=n}onStateChange(e,r,o,n){if(e.type===Z.TransactionConfirmed){let{sell:s,buy:c,quote:p}=o.executingQuote,d=new K(p.sellAmount),m=new K(p.buyAmount);xm({queryClient:this.queryClient,storage:this.storage,authRepository:this.authRepository,sellCaip19:X(s),sellAmountBN:d,sellAddress:s.data.walletAddress,buyCaip19:X(c),buyAmountBN:m,buyAddress:c.data.walletAddress,cashAccountAddress:this.cashAccount?.addressDetails.address})}}};u();l();var Kl=class{static{i(this,"FailedCashSwapExecuteSwapStateListener")}authRepository;constructor(e){this.authRepository=e}onStateChange(e,r,o,n){let{executingQuote:s}=o,{sell:c,buy:p}=s;if(!(!Le(c)&&!Le(p)))switch(e.type){case Z.SimulationFailed:k.addBreadcrumb(v.Cash,"Cash swap simulation failure detected, recording...",D.Info,{sellToken:c.data.symbol,buyToken:p.data.symbol}),this.recordFailure(s,"simulation",e.error,e.executionId);break;case Z.TransactionSubmissionFailed:k.addBreadcrumb(v.Cash,"Cash swap submission failure detected, recording...",D.Info,{sellToken:c.data.symbol,buyToken:p.data.symbol}),this.recordFailure(s,"submission",e.error,e.executionId);break}}async recordFailure(e,r,o,n){try{let s=await this.authRepository?.getUser();if(!s){k.addBreadcrumb(v.Cash,"Cannot record failed cash swap: user not found",D.Info);return}let{accessToken:c,userID:p}=s,d=e.sell,m=e.buy,f=e.quote,g=e.quoteInput,w=d.data.walletAddress,y=m.data.walletAddress;if(!w&&g?.taker){let A=We(g.taker);A.resourceType===V.address&&(w=A.address)}if(!y&&g?.takerDestination){let A=We(g.takerDestination);A.resourceType===V.address&&(y=A.address)}let S={type:mn.Swap,input:{owner:w,mint:d.data.tokenAddress??"",amount:f.sellAmount,symbol:d.data.symbol??void 0,name:d.data.name??void 0,decimals:d.data.decimals,logoUri:d.data.logoUri??void 0},output:{owner:y,mint:m.data.tokenAddress??"",amount:f.buyAmount,symbol:m.data.symbol??void 0,name:m.data.name??void 0,decimals:m.data.decimals,logoUri:m.data.logoUri??void 0},quoteId:f.rfqProps?.quoteId,quoteSource:Me(f).map(A=>A.name).join(",")},b=d.data.chain.id,T=o?.message||o?.type||"Unknown error";await km({accessToken:c,userID:p,idempotencyKey:n,swapInfo:S,chainId:b,failureReason:T,skipNotification:!0,occurredAt:new Date().toISOString()}),k.addBreadcrumb(v.Cash,"Recorded failed cash swap",D.Info,{failureType:r,sellToken:d.data.symbol,buyToken:m.data.symbol})}catch(s){k.addBreadcrumb(v.Cash,"Failed to record failed cash swap",D.Error,s instanceof Error?{error:s.message}:{})}}};u();l();var $l=class{static{i(this,"SocialExecuteSwapStateListener")}swapMode;queryClient;constructor(e,r){this.swapMode=e,this.queryClient=r}onStateChange(e,r,o,n){if(e.type===Z.TransactionConfirmed){let{buy:s,sell:c,quote:p,account:d}=o.executingQuote,m=s.data.chain.id,f=d.addresses.find(g=>g.networkID===m);if(f){let g=X(s),w=X(c),y=Ae(p.buyAmount,s.data.decimals).toNumber(),S=Ae(p.sellAmount,c.data.decimals).toNumber(),b=L({chainId:f.networkID,address:f.address,resourceType:V.address}),T=this.swapMode.type==="buy"?L(g):L(w),E=this.queryClient.getQueryData(oy.userProfile())?.id??"",I=this.queryClient.getQueryData(Yr.tokenChatBalance(T,E)),P=0;I&&(P=I.quantity>0?I.quantity/10**I.decimals:0),ih({chatTokenId:T,transactionId:e.txReceipt.id,networkId:e.txReceipt.networkID,tokenBoughtCaip19:L(g),tokenBoughtAmount:y,tokenBoughtUsdValue:s.data.price?y*s.data.price:0,tokenSoldCaip19:L(w),tokenSoldAmount:S,tokenSoldUsdValue:c.data.price?S*c.data.price:0,walletCaip19:b,chatTokenBalance:P,system:{messages:["trades"]}})}}}};var DL=i(()=>{},"noop"),OE=i(t=>{let e=rt(),{connection:r}=qo(),o=lt(),n=Ro(),s=R.language,c=ue(),p=Be(),d=Hs(),m=$t(),f=Do(),g=_o("kill-swapper-simulation")??!1,{data:w}=Qi();return(0,UE.useCallback)(async({showFungibleDetails:y,showBuyFungibleScreen:S=DL,showRetrySwap:b,swapMode:T,executeSwapStateListeners:A,toastMessageParser:E,uiContext:I="swapperInterstitial",preprocessor:P})=>{let U=new Qs(y,S,m,[ke.SlippageExceeded],b,E),O=new Us(p,o,f),_=new Gl(p,o,f,w),H=new Ms(d,c,I,t),Q=new Os(c),F=new qs,B=new Ls(Zo),W=new $l(T,p),re=new Kl(f);try{e.subscribeExecution(O),e.subscribeExecution(_),e.subscribeExecution(Q),e.subscribeExecution(H),e.subscribeExecution(U),e.subscribeExecution(F),e.subscribeExecution(B),e.subscribeExecution(re),Nr&&e.subscribeExecution(W),A.forEach(Y=>e.subscribeExecution(Y));let ee=await c.getDeviceId();await e.swap({signer:n,storage:o,locale:s,deviceId:ee,connection:r,authRepository:f,isSimulationKilled:g,preprocessor:P})}catch{}finally{e.unsubscribeExecution(O),e.unsubscribeExecution(_),e.unsubscribeExecution(Q),e.unsubscribeExecution(H),e.unsubscribeExecution(U),e.unsubscribeExecution(F),e.unsubscribeExecution(B),e.unsubscribeExecution(re),e.unsubscribeExecution(W),A.forEach(ee=>e.unsubscribeExecution(ee))}},[m,p,d,c,e,n,o,s,r,f,g,t,w])},"useExecuteSwapTokenSwap");u();l();var ah=class{static{i(this,"SwapTokenOnSelectResultStrategy")}getNavigationParams({initiatingSwapMode:e,selectedToken:r,initialSwapAmount:o,swapper:n}){let s=n.getTokenState();if(!mt(s))return{swapMode:e,initialSwapAmount:o};if(e.type!=="buy"&&e.type!=="sell")return{swapMode:e,initialSwapAmount:o};let c=Le(r),p=n.checkChainAddress({chain:r.data.chain,walletAddress:void 0}),d=c?L(mc(r)):L({chainId:p.networkID,address:p.address,resourceType:V.address});return{swapMode:{type:e.type,buyCaip19:e.type==="buy"?e.buyCaip19:L(X(r)),sellCaip19:e.type==="sell"?e.sellCaip19:L(X(r)),takerCaip19:e.type==="buy"?d:s.takerCaip19,takerDestinationCaip19:e.type==="sell"?d:s.takerDestinationCaip19,sellFungibleKey:e.type==="buy"?r.data.key:s.sellToken.data.key,buyFungibleKey:e.type==="sell"?r.data.key:s.buyToken.data.key},initialSwapAmount:o}}captureAnalytics(e,r,o){new Ds(e).swapperUpdateAsset(o,r)}},ch=class{static{i(this,"SwapModalSelectStrategy")}selectToken({swapper:e,selectedToken:r,currentTokens:o,perspective:n,cashAddresses:s,dismiss:c}){qE.selectToken({swapper:e,selectedToken:r,currentTokens:o,perspective:n,navigateToSwapper:i(({sellFungible:p})=>{if(!p)return;let d=e.checkChainAddress({chain:r.data.chain,walletAddress:void 0}),m=Le(r)?L(mc(r)):L({chainId:d.networkID,address:d.address,resourceType:V.address}),f={type:"swap",network:p.data.chain.id,sellCaip19:L(X(p)),buyCaip19:void 0,takerCaip19:m,takerDestinationCaip19:void 0};e.initializeSwap({swapMode:f,cashAddresses:s,settings:{}}),c()},"navigateToSwapper"),dismiss:i(()=>c(),"dismiss")})}},uh=class{static{i(this,"ClassicOnSelectResultStrategy")}selectToken({swapper:e,selectedToken:r,currentTokens:o,perspective:n,navigateToSwapper:s,dismiss:c}){let p=n==="sell"?o.buyCaip19:o.sellCaip19;if(this.isSameSelectedToken(p,r))return this.handleTokenSwitch(e,c);if(this.shouldNavigateToNewChain(n,o.sellCaip19,r,e.getTokenState()))return s({sellFungible:r});let d=Le(r),m=e.checkChainAddress({chain:r.data.chain,walletAddress:void 0}),f=d?L(mc(r)):L({chainId:m.networkID,address:m.address,resourceType:V.address});e.changeToken(r,n,f),c()}shouldNavigateToNewChain(e,r,o,n){let c=We(r).chainId!==o.data.chain.id;return c&&BL(n)||c&&Le(o)?!0:c&&e==="sell"}handleTokenSwitch(e,r){e.switchTokens(),r()}isSameSelectedToken(e,r){let o=L(X(r));return e!==o?!1:!Le(r)}},BL=i(t=>mt(t)?Le(t.sellToken)||Le(t.buyToken):!1,"isCashAccountInTokenState"),NL=new ah,qE=new uh,Nke=new ch;u();l();var jl=class{static{i(this,"AssetSelectAnalytics")}analytics;additionalAnalyticsTags;constructor(e,r){this.analytics=e,this.additionalAnalyticsTags=r}captureEvent(e,r){let o={...r,data:{...r.data,...this.additionalAnalyticsTags}};this.analytics.capture(e,o)}assetSelectionClosed(e){this.captureEvent("swapperAssetSelectionClosed",{data:e})}assetInfoPressed(e,r){this.captureEvent("swapperAssetInfoPressed",{data:{...wo(e),type:r}})}assetFilterChanged(e,r){this.captureEvent("swapperAssetFilterChanged",{data:{filterId:e,type:r}})}assetSearchQueryChanged(e,r){this.captureEvent("swapperAssetSearchQueryChanged",{data:{searchQuery:e,type:r}})}},LL=Ya(ue,t=>new jl(t));u();l();var Vl=N(z());var ML=i(()=>{let{data:t}=Rt({key:Pe.LastSelectedTokens,queryKey:me.lastSelectedTokens()}),e=(0,Vl.useMemo)(()=>t?JSON.parse(t):{},[t]),{mutateAsync:r}=Dt({key:Pe.LastSelectedTokens,queryKey:me.lastSelectedTokens()}),o=(0,Vl.useCallback)(async n=>{let s={...e,[n]:!0};await r(JSON.stringify(s))},[e,r]);return{lastSelectedTokens:e,storeSelectedToken:o}},"useLastSelectedTokens");u();l();var BC=N(Ve());var Co=N(z());u();l();u();l();var Et=a.string().regex(/^\d*\.?\d+([eE][+-]?\d+)?$/,"Invalid numeric string"),Wl=a.string().regex(/^-?\d*\.?\d+([eE][+-]?\d+)?$/,"Invalid signed numeric string"),zE=a.object({accountValue:Wl,totalMarginUsed:Et,totalNtlPos:Et,totalRawUsd:Wl}),BIe=a.object({marginSummary:zE,withdrawable:Et,assetPositions:a.array(a.any()).optional(),crossMaintenanceMarginUsed:Et.optional(),crossMarginSummary:zE.optional(),guaranteedUntil:a.number().optional(),isAccountSolvent:a.boolean().optional(),pendingCashAdjusts:a.array(a.any()).optional(),totalCrossCollateral:Et.optional(),totalIsolatedCollateral:Et.optional(),totalMaintenanceMarginUsed:Et.optional()}),QE=a.object({coin:a.string(),side:a.enum(["B","A"]),limitPx:Et,sz:Et,oid:a.number(),timestamp:a.number(),origSz:Et,cloid:a.string().optional()}),NIe=a.array(QE),UL=a.object({position:QE,status:a.string(),statusTimestamp:a.number()}),LIe=a.array(UL),OL=a.object({status:a.literal("ok"),response:a.object({type:a.string()}).optional()}),HE=a.object({error:a.string()}),MIe=a.union([OL,HE]),qL=a.enum(["withdraw","deposit"]),zL=a.object({id:a.string(),type:qL,timestamp:a.string(),delta:a.object({usdAmount:Wl,token:a.object({caip19:a.string(),symbol:a.string(),image:a.string(),amount:Wl})})}),UIe=a.array(zL),QL=a.object({resting:a.object({oid:a.number()})}),HL=a.object({filled:a.object({totalSz:Et,avgPx:Et,oid:a.number()})}),GL=a.object({error:a.string()}),KL=a.union([QL,HL,GL]),$L=a.object({status:a.literal("ok"),response:a.object({type:a.literal("order"),data:a.object({statuses:a.array(KL)})})}),OIe=a.union([$L,HE]),GE=a.array(a.object({t:a.number(),T:a.number(),s:a.string(),i:a.string(),o:Et,h:Et,l:Et,c:Et,v:Et,n:a.number()}));u();l();var jL=a.object({accountValue:Ze,availableBalance:Ze,availableToTrade:Ze}),VL=a.object({tokenIndex:a.number(),pairIndex:a.number().optional(),symbol:a.string(),total:Ze,hold:Ze}),KE=a.object({accountValue:Ze,availableBalance:Ze,availableToTrade:Ze,dexAbstraction:a.boolean().optional(),dexs:a.record(a.string(),jL).optional(),collateralBalances:a.array(VL).optional()});u();l();var WL=a.enum(["withdrawal","deposit","reward"]),ZL=a.object({id:a.string(),type:WL,timestamp:a.number(),usdcAmount:ht}),$E=a.object({depositAndWithdrawals:a.array(a.any()).transform(t=>t.reduce((e,r)=>{let o=ZL.safeParse(r);return o.success&&e.push(o.data),e},[]))});u();l();var rFe=a.enum(["success","failed"]),oFe=a.enum(["close","liquidation","take_profit","stop_loss"]),nFe=a.literal("open"),jE=a.object({id:a.string(),market:a.object({token:Js,logoUri:a.string(),szDecimals:a.number().optional()}),type:a.string(),timestamp:a.number(),price:Ze,size:ht,tradeValue:Ze,fee:ht,closedPnl:a.optional(ht)}),VE=a.object({tradeHistory:a.array(jE).transform(t=>t.reduce((e,r)=>{let o=jE.safeParse(r);return o.success&&e.push(o.data),e},[]))});u();l();var ZE=a.enum(["long","short"]),Zl=a.object({direction:ZE,leverage:Ze,size:ht,margin:Ze,entryPrice:Ze,fundingPayments:ht,market:a.object({token:Js,logoUri:a.string()}),value:Ze,unrealizedPnl:a.object({amount:ht,percentage:ht}),liquidationPrice:ht}),YE=a.object({positions:a.array(Zl).transform(t=>t.reduce((e,r)=>{let o=Zl.safeParse(r);return o.success&&e.push(o.data),e},[]))}),WE=a.object({id:a.string(),market:a.object({token:Js,logoUri:a.string()}),isTrigger:a.boolean(),direction:ZE,type:a.enum(["take_profit_market","stop_market","limit"]),reduceOnly:a.boolean(),triggerPrice:Ze,limitPrice:Ze,timestamp:Ze,size:ht}),XE=a.object({positions:a.array(Zl).transform(t=>t.reduce((e,r)=>{let o=Zl.safeParse(r);return o.success&&e.push(o.data),e},[])),openOrders:a.array(WE).transform(t=>t.reduce((e,r)=>{let o=WE.safeParse(r);return o.success&&e.push(o.data),e},[]))});u();l();function Je(t,e){return t+Math.random()*e}i(Je,"getRetryDelayWithJitter");u();l();var YL=a.object({address:a.string(),registered:a.boolean()}),XL=a.object({code:a.string(),registered:a.boolean()}).optional(),JE=a.object({providerFee:a.string(),phantomFee:a.string(),referral:XL.optional(),builder:YL.optional()});u();l();var eC=a.object({depositAddress:a.object({address:a.string()}),requestId:a.string()}),JL=a.object({destinationAmount:a.string().optional(),sourceTxHash:a.string().optional(),state:a.enum(["done","sourceTxDiscovered","waitForSrcTxFinalization","buildingDstTx","signTx","broadcastTx","waitForDstTxFinalization","readyForWithdrawQueue","queuedForWithdraw","failure","additionalChecks"]),opCreatedAt:a.string().optional(),operationId:a.string().optional(),protocolAddress:a.string().optional(),sourceAddress:a.string().optional(),destinationAddress:a.string().optional(),sourceChain:a.string().optional(),destinationChain:a.string().optional(),sourceAmount:a.string().optional(),destinationFeeAmount:a.string().optional(),sweepFeeAmount:a.string().optional(),stateStartedAt:a.string().optional(),stateUpdatedAt:a.string().optional(),stateNextAttemptAt:a.string().optional(),destinationTxHash:a.string().optional(),asset:a.string().optional()}),tC=a.object({usdcPrice:a.string(),orderAssetId:a.number(),operations:a.array(JL)}),rC=a.discriminatedUnion("status",[a.object({status:a.literal("ok"),response:a.object({type:a.string()})}),a.object({status:a.literal("err"),response:a.string()})]),oC=a.discriminatedUnion("status",[a.object({status:a.literal("ok"),response:a.object({type:a.string()})}),a.object({status:a.literal("err"),response:a.string()})]),nC=a.object({status:a.enum(["ok","err"])}),sC=a.object({name:a.string(),midPx:a.string()}),eM=a.object({unixTime:a.number(),value:a.string(),open:a.string(),high:a.string(),low:a.string(),close:a.string(),volume:a.string()}),EFe=a.object({history:a.array(eM)}),iC=a.object({role:a.enum(["missing","user"])}),aC=a.object({fundingCaip19Address:vo,spotAssetId:a.number(),spotTokenId:a.string(),spotTokenName:a.string(),spotSzDecimals:a.number(),eta:a.string(),fee:a.string(),minimumAmount:a.string()}),cC=a.object({tokens:a.array(Ft)}),Sr;(function(t){t.Hyperunit="hyperunit",t.Relay="relay"})(Sr||(Sr={}));var uC=a.object({providers:a.array(a.object({name:a.nativeEnum(Sr),max:a.number(),initializingCaip19Address:a.optional(vo)}))});var Yl=class{static{i(this,"PerpsClient")}async getSpotBridgeInitialize(e){let r=await G.api().retry(1,Je(1e3,1e3)).get("/swap/v2/spot/bridge-initialize",{params:{...e,bridgeProvider:Wg(e.bridgeProvider.toString())}}),o=eC.safeParse(r.data);if(!o.success)throw new Error(`Failed to parse spot bridge initialize response: ${o.error}`);return o.data}async getOperations(e){let r=await G.api().retry(1,Je(1e3,1e3)).get("/swap/v2/spot/bridge-operations",{params:e}),o=tC.safeParse(r.data);if(!o.success)throw new Error(`Failed to parse operations response: ${o.error}`);return o.data}async getAccountBalance(e){let r=await G.api().retry(1,Je(1e3,1e3)).get("/swap/v2/perp/balance",{params:{user:L(e)}});if(!J(r))throw new Error("Failed to get account balance: response is not okay");let o=r.data,n=KE.safeParse(o);if(!n.success)throw new Error("Failed to get account balance: schema validation failed");return n.data}async getUserFundingHistory(e){let r=await G.api().retry(1,Je(1e3,1e3)).get("/swap/v2/perp/deposits-and-withdrawals",{params:{user:L(e)}});if(!J(r))throw new Error("Failed to get deposits and withdrawals: response is not okay");let o=r.data,n=$E.safeParse(o);if(!n.success)throw new Error("Failed to get deposits and withdrawals: schema validation failed");return n.data.depositAndWithdrawals}async getPositions(e){let r=await G.api().retry(1,Je(1e3,1e3)).get("/swap/v2/perp/positions",{params:{user:L(e)}});if(!J(r))throw new Error("Failed to get positions: response is not okay");let o=r.data,n=YE.safeParse(o);if(!n.success)throw new Error("Failed to get positions: schema validation failed");return n.data.positions}async getPositionsAndOpenOrders(e){let r=await G.api().retry(1,Je(1e3,1e3)).get("/swap/v2/perp/positions-and-open-orders",{params:{user:L(e)}});if(!J(r))throw new Error("Failed to get positions: response is not okay");let o=r.data,n=XE.safeParse(o);if(!n.success)throw new Error("Failed to get positions: schema validation failed");return n.data}async getHistoricalOrders(e,r){let o={user:L(e)};r&&r.length>0&&(o.markets=r.join(","));let n=await G.api().retry(1,Je(1e3,1e3)).get("/swap/v2/perp/trade-history",{params:o});if(!J(n))throw new Error("Failed to get historical orders: response is not okay");let s=n.data,c=VE.safeParse(s);if(!c.success)throw new Error("Failed to get historical orders: schema validation failed");return c.data.tradeHistory}async postSpotSend(e){let r=await G.api().retry(1,Je(1e3,1e3)).post("/swap/v2/spot/send",e);if(!J(r))throw new Error("Failed to post spot send: response is not okay");let o=r.data,n=rC.safeParse(o);if(!n.success)throw new Error("Failed to post spot send: schema validation failed");return n.data}async postPerpsSend(e){let r=await G.api().retry(1,Je(1e3,1e3)).post("/swap/v2/perps/send",e);if(!J(r))throw new Error("Failed to post perps send: response is not okay");let o=r.data,n=oC.safeParse(o);if(!n.success)throw new Error("Failed to post perps send: schema validation failed");return n.data}async postTransferUsdcSpotPerp(e){let r=await G.api().retry(1,Je(1e3,1e3)).post("/swap/v2/transfer-usdc-spot-perp",e);if(!J(r))throw new Error("Failed to post spot send: response is not okay");let o=r.data,n=nC.safeParse(o);if(!n.success)throw new Error("Failed to post spot send: schema validation failed");return n.data}async getTokenDetails(e){let r=await G.api().retry(1,Je(1e3,1e3)).get("/swap/v2/spot/token-details",{params:{tokenId:e.tokenId,type:"tokenDetails"}});if(!J(r))throw new Error("Failed to get token info: response is not okay");let o=r.data,n=sC.safeParse(o);if(!n.success)throw new Error("Failed to get token info: schema validation failed");return n.data}async getUserRole(e){let r=await fetch("https://api.hyperliquid.xyz/info",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({type:"userRole",user:e})});if(!r.ok)throw new Error("Failed to get token info");let o=await r.json(),n=iC.safeParse(o);if(!n.success)throw new Error("Failed to get user role: schema validation failed");return n.data}async postFunding(e){let r=await G.api().retry(1,Je(1e3,1e3)).post("/swap/v2/spot/funding",e);if(!J(r))throw new Error("Failed to get funding");let o=r.data,n=aC.safeParse(o);if(!n.success)throw new Error("Failed to post funding: schema validation failed");return n.data}async getPriceHistory(e){let r={coin:e.coin,interval:e.interval,startTime:e.startTime.toString(),endTime:e.endTime.toString()};e.isTestnet&&(r.isTestnet="true");let o=await G.api().retry(1,Je(1e3,1e3)).get("/swap/v2/candles",{params:r});if(!J(o))throw new Error("Failed to get price history: response is not okay");let n=o.data,s=GE.safeParse(n);if(!s.success)throw new Error("Failed to get price history: schema validation failed");return s.data}async getSpotBalances(e){let r=await G.api().retry(1,Je(1e3,1e3)).get("/swap/v2/spot/balances",{params:e});if(!J(r))throw new Error("Failed to get spot balances: response is not okay");return r.data}async getPositionFees(e){let r=await G.api().retry(1,Je(1e3,1e3)).get("/swap/v2/perp/fees",{params:{user:L(e)}});if(!J(r))throw new Error("Failed to get position fees: response is not okay");let o=r.data,n=JE.safeParse(o);if(!n.success)throw new Error("Failed to get position fees: schema validation failed");return n.data}async getBridgeableTokens(e){if(!e)throw new Error("No addresses provided to get bridgeable tokens");let r=await G.api().retry(1,Je(1e3,1e3)).get("/swap/v2/spot/bridgeable-tokens",{params:{addresses:e.join(",")}});if(!J(r))throw new Error("Failed to get bridgeable tokens: response is not okay");let o=r.data,n=cC.safeParse(o);if(!n.success)throw new Error("Failed to get bridgeable tokens: schema validation failed");return n.data}async getPreferredBridges(){let e=await G.api().retry(1,Je(1e3,1e3)).get("/swap/v2/spot/preferred-bridges");if(!J(e))throw new Error("Failed to get preferred bridge: response is not okay");let r=e.data,o=uC.safeParse(r);if(!o.success)throw new Error("Failed to get preferred bridge: schema validation failed");return o.data}};u();l();u();l();var ot=[{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"}];var Xl=[{name:"hyperliquidChain",type:"string"},{name:"maxFeeRate",type:"string"},{name:"builder",type:"address"},{name:"nonce",type:"uint64"}],nr=[{name:"source",type:"string"},{name:"connectionId",type:"bytes32"}];u();l();var tM=a.object({totalSz:a.string(),avgPx:a.string(),oid:a.number()}),rM=a.object({oid:a.number()}),oM=a.union([a.object({error:a.string()}),a.object({filled:tM}),a.literal("success"),a.object({resting:rM})]),nM=a.object({status:a.literal("ok"),response:a.object({type:a.string(),data:a.object({statuses:a.array(oM)}).optional()})}),sM=a.union([a.object({status:a.literal("err"),response:a.string()}),nM]),WFe=a.object({action:a.any(),nonce:a.number(),signature:a.object({r:a.string(),s:a.string(),v:a.number()}),isTestnet:a.boolean().optional()});var Bn=class{static{i(this,"HyperliquidExchange")}async postExchange(e){return await k.startSpan("hyperliquid.exchange.post",async()=>{let o=(await G.api().post("/swap/v2/exchange",e)).data,n=sM.safeParse(o);if(!n.success)throw new Error(`Invalid exchange response: ${n.error.message}`);return n.data})}};u();l();function lh(t){return t.map(e=>({time:e.t/1e3,open:Number(e.o),high:Number(e.h),low:Number(e.l),close:Number(e.c),volume:Number(e.v)}))}i(lh,"mapRawCandleSnapshotToCandleSnapshot");u();l();var Jl=class{static{i(this,"AccountBalanceStateMachine")}listeners=[];state={type:"indeterminate"};send(e){let r=this.detectNextState(e);this.state=r,this.notifyListeners()}detectNextState(e){switch(e.type){case"fetchingAccountBalanceStart":switch(this.state.type){case"accountBalance":return{type:"refreshing",accountBalance:this.state.accountBalance};case"refreshing":return{type:"refreshing",accountBalance:this.state.accountBalance};case"indeterminate":return{type:"loading",consecutiveErrors:0};case"error":return{type:"loading",consecutiveErrors:this.state.consecutiveErrors};case"loading":return{type:"loading",consecutiveErrors:this.state.consecutiveErrors};default:{let r=this.state;throw new Error(`Invalid state ${r.type} for fetchingAccountBalanceStart`)}}case"fetchingAccountBalanceSuccess":switch(this.state.type){case"loading":case"refreshing":case"accountBalance":return{type:"accountBalance",accountBalance:e.accountBalance};default:throw new Error(`Invalid state ${this.state.type} for fetchingAccountBalanceSuccess`)}case"fetchingAccountBalanceError":return{type:"error",error:e.error,consecutiveErrors:("consecutiveErrors"in this.state?this.state.consecutiveErrors:0)+1}}}getState(){return this.state}reset(){this.state={type:"indeterminate"},this.notifyListeners()}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}notifyListeners(){this.listeners.forEach(e=>{e.onAccountBalanceStateChange(this.state)})}};u();l();var ep=class{static{i(this,"FundingHistoryStateMachine")}listeners=[];state={type:"indeterminate"};send(e){let r=this.detectNextState(e);this.state=r,this.notifyListeners()}detectNextState(e){switch(e.type){case"fetchingFundingHistoryStart":switch(this.state.type){case"history":return{type:"refreshing",history:this.state.history};case"refreshing":return{type:"refreshing",history:this.state.history};case"indeterminate":case"error":return{type:"loading"};default:throw new Error(`Invalid state ${this.state.type} for fetchingFundingHistoryStart`)}case"fetchingFundingHistorySuccess":switch(this.state.type){case"loading":case"refreshing":case"history":return{type:"history",history:e.history};default:throw new Error(`Invalid state ${this.state.type} for fetchingFundingHistorySuccess`)}case"fetchingFundingHistoryError":switch(this.state.type){case"history":case"refreshing":return{type:"history",history:this.state.history};default:return{type:"error",error:e.error}}}}getState(){return this.state}reset(){this.state={type:"indeterminate"},this.notifyListeners()}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}notifyListeners(){this.listeners.forEach(e=>{e.onFundingHistoryStateChange(this.state)})}};u();l();var tp=class{static{i(this,"HistoricalOrdersStateMachine")}listeners=[];state={type:"indeterminate"};send(e){let r=this.detectNextState(e);this.state=r,this.notifyListeners()}detectNextState(e){switch(e.type){case"fetchingHistoricalOrdersStart":switch(this.state.type){case"historicalOrders":return{type:"refreshing",historicalOrders:this.state.historicalOrders};case"refreshing":return{type:"refreshing",historicalOrders:this.state.historicalOrders};case"indeterminate":case"error":return{type:"loading"};default:throw new Error(`Invalid state ${this.state.type} for fetchingHistoricalOrdersStart`)}case"fetchingHistoricalOrdersSuccess":switch(this.state.type){case"loading":case"refreshing":case"historicalOrders":return{type:"historicalOrders",historicalOrders:e.historicalOrders};default:throw new Error(`Invalid state ${this.state.type} for fetchingHistoricalOrdersSuccess`)}case"fetchingHistoricalOrdersError":return{type:"error",error:e.error}}}getState(){return this.state}reset(){this.state={type:"indeterminate"},this.notifyListeners()}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}notifyListeners(){this.listeners.forEach(e=>{e.onHistoricalOrdersStateChange(this.state)})}};u();l();var rp=class{static{i(this,"PositionsStateMachine")}listeners=[];state={type:"indeterminate"};send(e){let r=this.detectNextState(e);this.state=r,this.notifyListeners()}detectNextState(e){switch(e.type){case"fetchingPositionsStart":switch(this.state.type){case"positions":return{type:"refreshing",positions:this.state.positions,openOrders:this.state.openOrders};case"refreshing":return{type:"refreshing",positions:this.state.positions,openOrders:this.state.openOrders};case"indeterminate":return{type:"loading",consecutiveErrors:0};case"error":return{type:"loading",consecutiveErrors:this.state.consecutiveErrors};case"loading":return{type:"loading",consecutiveErrors:this.state.consecutiveErrors};default:{let r=this.state;throw new Error(`Invalid state ${r.type} for fetchingPositionsStart`)}}case"fetchingPositionsSuccess":switch(this.state.type){case"loading":case"refreshing":case"positions":return{type:"positions",positions:e.positions,openOrders:e.openOrders};default:throw new Error(`Invalid state ${this.state.type} for fetchingPositionsSuccess`)}case"fetchingPositionsError":return{type:"error",error:e.error,consecutiveErrors:("consecutiveErrors"in this.state?this.state.consecutiveErrors:0)+1}}}getState(){return this.state}reset(){this.state={type:"indeterminate"},this.notifyListeners()}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}notifyListeners(){this.listeners.forEach(e=>{e.onPositionStateChange(this.state)})}};u();l();u();l();u();l();u();l();u();l();u();l();function lC(t){let e=t.length,r=0,o=0;for(;o<e;){let n=t.charCodeAt(o++);if(n&4294967168)if(!(n&4294965248))r+=2;else{if(n>=55296&&n<=56319&&o<e){let s=t.charCodeAt(o);(s&64512)===56320&&(++o,n=((n&1023)<<10)+(s&1023)+65536)}n&4294901760?r+=4:r+=3}else{r++;continue}}return r}i(lC,"utf8Count");function iM(t,e,r){let o=t.length,n=r,s=0;for(;s<o;){let c=t.charCodeAt(s++);if(c&4294967168)if(!(c&4294965248))e[n++]=c>>6&31|192;else{if(c>=55296&&c<=56319&&s<o){let p=t.charCodeAt(s);(p&64512)===56320&&(++s,c=((c&1023)<<10)+(p&1023)+65536)}c&4294901760?(e[n++]=c>>18&7|240,e[n++]=c>>12&63|128,e[n++]=c>>6&63|128):(e[n++]=c>>12&15|224,e[n++]=c>>6&63|128)}else{e[n++]=c;continue}e[n++]=c&63|128}}i(iM,"utf8EncodeJs");var aM=new TextEncoder,cM=50;function uM(t,e,r){aM.encodeInto(t,e.subarray(r))}i(uM,"utf8EncodeTE");function pC(t,e,r){t.length>cM?uM(t,e,r):iM(t,e,r)}i(pC,"utf8Encode");var bPe=new TextDecoder;u();l();u();l();var Nn=class{static{i(this,"ExtData")}constructor(e,r){this.type=e,this.data=r}};u();l();u();l();var op=class t extends Error{static{i(this,"DecodeError")}constructor(e){super(e);let r=Object.create(t.prototype);Object.setPrototypeOf(this,r),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:t.name})}};u();l();function dC(t,e,r){let o=r/4294967296,n=r;t.setUint32(e,o),t.setUint32(e+4,n)}i(dC,"setUint64");function np(t,e,r){let o=Math.floor(r/4294967296),n=r;t.setUint32(e,o),t.setUint32(e+4,n)}i(np,"setInt64");function mC(t,e){let r=t.getInt32(e),o=t.getUint32(e+4);return r*4294967296+o}i(mC,"getInt64");var lM=-1,pM=4294967296-1,dM=17179869184-1;function mM({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=dM)if(e===0&&t<=pM){let r=new Uint8Array(4);return new DataView(r.buffer).setUint32(0,t),r}else{let r=t/4294967296,o=t&4294967295,n=new Uint8Array(8),s=new DataView(n.buffer);return s.setUint32(0,e<<2|r&3),s.setUint32(4,o),n}else{let r=new Uint8Array(12),o=new DataView(r.buffer);return o.setUint32(0,e),np(o,4,t),r}}i(mM,"encodeTimeSpecToTimestamp");function fM(t){let e=t.getTime(),r=Math.floor(e/1e3),o=(e-r*1e3)*1e6,n=Math.floor(o/1e9);return{sec:r+n,nsec:o-n*1e9}}i(fM,"encodeDateToTimeSpec");function hM(t){if(t instanceof Date){let e=fM(t);return mM(e)}else return null}i(hM,"encodeTimestampExtension");function gM(t){let e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{let r=e.getUint32(0),o=e.getUint32(4),n=(r&3)*4294967296+o,s=r>>>2;return{sec:n,nsec:s}}case 12:{let r=mC(e,4),o=e.getUint32(0);return{sec:r,nsec:o}}default:throw new op(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}i(gM,"decodeTimestampToTimeSpec");function yM(t){let e=gM(t);return new Date(e.sec*1e3+e.nsec/1e6)}i(yM,"decodeTimestampExtension");var fC={type:lM,encode:hM,decode:yM};var si=class{static{i(this,"ExtensionCodec")}constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(fC)}register({type:e,encode:r,decode:o}){if(e>=0)this.encoders[e]=r,this.decoders[e]=o;else{let n=-1-e;this.builtInEncoders[n]=r,this.builtInDecoders[n]=o}}tryToEncode(e,r){for(let o=0;o<this.builtInEncoders.length;o++){let n=this.builtInEncoders[o];if(n!=null){let s=n(e,r);if(s!=null){let c=-1-o;return new Nn(c,s)}}}for(let o=0;o<this.encoders.length;o++){let n=this.encoders[o];if(n!=null){let s=n(e,r);if(s!=null){let c=o;return new Nn(c,s)}}}return e instanceof Nn?e:null}decode(e,r,o){let n=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return n?n(e,r,o):new Nn(r,e)}};si.defaultCodec=new si;u();l();function wM(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}i(wM,"isArrayBufferLike");function hC(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):wM(t)?new Uint8Array(t):Uint8Array.from(t)}i(hC,"ensureUint8Array");var SM=100,bM=2048,sp=class t{static{i(this,"Encoder")}constructor(e){this.entered=!1,this.extensionCodec=e?.extensionCodec??si.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??SM,this.initialBufferSize=e?.initialBufferSize??bM,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new t({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,r){if(r>this.maxDepth)throw new Error(`Too deep objects in depth ${r}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,r)}ensureBufferSizeToWrite(e){let r=this.pos+e;this.view.byteLength<r&&this.resizeBuffer(r*2)}resizeBuffer(e){let r=new ArrayBuffer(e),o=new Uint8Array(r),n=new DataView(r);o.set(this.bytes),this.view=n,this.bytes=o}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){let o=lC(e);this.ensureBufferSizeToWrite(5+o),this.writeStringHeader(o),pC(e,this.bytes,this.pos),this.pos+=o}encodeObject(e,r){let o=this.extensionCodec.tryToEncode(e,this.context);if(o!=null)this.encodeExtension(o);else if(Array.isArray(e))this.encodeArray(e,r);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,r);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){let r=e.byteLength;if(r<256)this.writeU8(196),this.writeU8(r);else if(r<65536)this.writeU8(197),this.writeU16(r);else if(r<4294967296)this.writeU8(198),this.writeU32(r);else throw new Error(`Too large binary: ${r}`);let o=hC(e);this.writeU8a(o)}encodeArray(e,r){let o=e.length;if(o<16)this.writeU8(144+o);else if(o<65536)this.writeU8(220),this.writeU16(o);else if(o<4294967296)this.writeU8(221),this.writeU32(o);else throw new Error(`Too large array: ${o}`);for(let n of e)this.doEncode(n,r+1)}countWithoutUndefined(e,r){let o=0;for(let n of r)e[n]!==void 0&&o++;return o}encodeMap(e,r){let o=Object.keys(e);this.sortKeys&&o.sort();let n=this.ignoreUndefined?this.countWithoutUndefined(e,o):o.length;if(n<16)this.writeU8(128+n);else if(n<65536)this.writeU8(222),this.writeU16(n);else if(n<4294967296)this.writeU8(223),this.writeU32(n);else throw new Error(`Too large map object: ${n}`);for(let s of o){let c=e[s];this.ignoreUndefined&&c===void 0||(this.encodeString(s),this.doEncode(c,r+1))}}encodeExtension(e){if(typeof e.data=="function"){let o=e.data(this.pos+6),n=o.length;if(n>=4294967296)throw new Error(`Too large extension object: ${n}`);this.writeU8(201),this.writeU32(n),this.writeI8(e.type),this.writeU8a(o);return}let r=e.data.length;if(r===1)this.writeU8(212);else if(r===2)this.writeU8(213);else if(r===4)this.writeU8(214);else if(r===8)this.writeU8(215);else if(r===16)this.writeU8(216);else if(r<256)this.writeU8(199),this.writeU8(r);else if(r<65536)this.writeU8(200),this.writeU16(r);else if(r<4294967296)this.writeU8(201),this.writeU32(r);else throw new Error(`Too large extension object: ${r}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){let r=e.length;this.ensureBufferSizeToWrite(r),this.bytes.set(e,this.pos),this.pos+=r}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),dC(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),np(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function Pr(t,e){return new sp(e).encodeSharedRef(t)}i(Pr,"encode");var gC=N(xi());var ip=class{static{i(this,"UpdateIsolatedMarginAction")}type="updateIsolatedMargin";asset;isBuy;ntli;constructor(e){this.asset=e.asset,this.isBuy=e.isBuy,this.ntli=e.ntli}hash(e,r){let o=Pr(this),n=e===null?9:29,s=new Uint8Array(o.length+n);s.set(o);let c=new DataView(s.buffer,s.byteOffset,s.byteLength);return c.setBigUint64(o.length,BigInt(r)),e===null?c.setUint8(o.length+8,0):(c.setUint8(o.length+8,1),s.set(TM(e),o.length+9)),`0x${(0,gC.keccak256)(s)}`}};function TM(t){let e=t.startsWith("0x")?t.substring(2):t;return Uint8Array.from(Buffer.from(e,"hex"))}i(TM,"addressToBytes");u();l();function ph(t){switch(t.type){case"preparingTransaction":case"managingMargin":case"manageMarginSucceeded":return yC(t);case"manageMarginFailed":return{...yC(t),error:t.error instanceof Error?t.error.message:"Unknown error"};case"indeterminate":default:return{state:t.type}}}i(ph,"getManageMarginStateLogsDetails");var yC=i(t=>t.type==="indeterminate"?{state:t.type}:{marketSymbol:t.market.symbol,assetId:t.market.assetId.toString(),positionDirection:t.position.direction,positionSize:t.position.size.toString(),currentMargin:t.position.margin.toString(),marginDelta:t.marginDelta.toString(),marginAction:t.marginDelta.isPositive()?"increase":"decrease",newMargin:new x(t.position.margin).plus(t.marginDelta).toString(),fee:t.fee?.toString()||"N/A"},"getBaseLogsDetails");u();l();var ap=class{static{i(this,"ManageMarginStateMachine")}listeners=[];state={type:"indeterminate"};getState(){return this.state}send(e){try{let r=this.determineNextState(this.state,e);this.state=r,this.notifyListeners(e)}catch(r){console.error("Error processing event in ManageMarginStateMachine:",e,r)}}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}determineNextState(e,r){switch(r.type){case"InitiateManageMargin":{let{position:o,market:n,marginDelta:s,fee:c}=r.payload;return{type:"preparingTransaction",...{position:o,market:n,marginDelta:s,fee:c}}}case"ManageMarginInitiated":{if(e.type==="preparingTransaction")return{type:"managingMargin",position:e.position,market:e.market,marginDelta:e.marginDelta,fee:e.fee};break}case"ManageMarginSuccess":{if(e.type==="managingMargin")return{type:"manageMarginSucceeded",position:e.position,market:e.market,marginDelta:e.marginDelta,fee:e.fee};break}case"ManageMarginFailure":{if(e.type==="managingMargin")return{type:"manageMarginFailed",position:e.position,market:e.market,marginDelta:e.marginDelta,fee:e.fee,error:r.error};break}case"Reset":return{type:"indeterminate"}}return e}notifyListeners(e){this.listeners.forEach(r=>{r.onManageMarginStateChange(e,this.state)})}};var AM=6,cp=class{static{i(this,"ManageMarginOrchestrator")}stateMachine=new ap;perps;constructor(e){this.perps=e,this.stateMachine.addListener(this.stateListener),this.stateMachine.addListener(this.stateLogsListener)}stateListener={onManageMarginStateChange:i((e,r)=>{this.handleStateChange(e,r)},"onManageMarginStateChange")};stateLogsListener={onManageMarginStateChange:i((e,r)=>{switch(r.type){case"manageMarginSucceeded":k.addBreadcrumb(v.Perps,`Manage margin succeeded: ${r.type}`,D.Info,ph(r));break;case"manageMarginFailed":k.addBreadcrumb(v.Perps,`Manage margin failed: ${r.type}`,D.Error,ph(r));break;default:k.addBreadcrumb(v.Perps,`Manage margin state change: ${e.type} -> ${r.type}`,D.Info);break}(r.type==="manageMarginSucceeded"||r.type==="manageMarginFailed")&&this.stateMachine.removeListener(this.stateLogsListener)},"onManageMarginStateChange")};async handleStateChange(e,r){switch(e.type){case"InitiateManageMargin":this.stateMachine.send({type:"ManageMarginInitiated"});break;case"ManageMarginInitiated":r.type==="managingMargin"&&await this.manageMargin(r);break}}async manageMargin(e){try{let{position:r,market:o,marginDelta:n}=e,s=n.multipliedBy(new x(10).pow(AM)).toNumber(),c=new ip({asset:o.assetId,isBuy:r.direction==="long",ntli:s}),p=Date.now(),d={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ot,Agent:nr},message:{source:this.perps.isTestnet?"b":"a",connectionId:c.hash(null,p)}},m=await this.perps.exchangeAction(c,d,p),f=m.response.data?.statuses?.find(w=>typeof w=="object"&&"error"in w);if(f&&typeof f=="object"&&"error"in f)throw new Error(f.error);let g=JSON.stringify(m.response.data?.statuses||"unknown");this.stateMachine.send({type:"ManageMarginSuccess",payload:g})}catch(r){this.stateMachine.send({type:"ManageMarginFailure",error:r})}}getState(){return this.stateMachine.getState()}send(e){this.stateMachine.send(e)}addListener(e){return this.stateMachine.addListener(e),()=>this.stateMachine.removeListener(e)}removeListener(e){this.stateMachine.removeListener(e)}};u();l();u();l();var wC=N(xi());var Eo=class{static{i(this,"OrderAction")}type="order";orders;grouping;builder;constructor(e,r){this.orders=e,this.grouping="na",r&&(this.builder=r)}hash(e,r){let o=Pr(this),n=e===null?9:29,s=new Uint8Array(o.length+n);s.set(o);let c=new DataView(s.buffer,s.byteOffset,s.byteLength);return c.setBigUint64(o.length,BigInt(r)),e===null?c.setUint8(o.length+8,0):(c.setUint8(o.length+8,1),s.set(xM(e),o.length+9)),`0x${(0,wC.keccak256)(s)}`}};function xM(t){let e=t.startsWith("0x")?t.substring(2):t;return Uint8Array.from(Buffer.from(e,"hex"))}i(xM,"addressToBytes");var up=class{static{i(this,"SpotSendAction")}hyperliquidChain;signatureChainId;amount;destination;time;token;type="spotSend";constructor(e){this.hyperliquidChain=e.hyperliquidChain,this.signatureChainId=e.signatureChainId,this.token=e.token,this.amount=e.amount,this.destination=e.destination,this.time=e.time}},lp=class{static{i(this,"PerpsSendAction")}hyperliquidChain;signatureChainId;amount;destination;time;type="usdSend";constructor(e){this.hyperliquidChain=e.hyperliquidChain,this.signatureChainId=e.signatureChainId,this.amount=e.amount,this.destination=e.destination,this.time=e.time}};u();l();var SC=N(xi());var ii=class{static{i(this,"ApproveReferralAction")}type="setReferrer";code;constructor(e){this.code=e.code}hash(e,r){let o=Pr(this),n=e===null?9:29,s=new Uint8Array(o.length+n);s.set(o);let c=new DataView(s.buffer,s.byteOffset,s.byteLength);return c.setBigUint64(o.length,BigInt(r)),e===null?c.setUint8(o.length+8,0):(c.setUint8(o.length+8,1),s.set(EM(e),o.length+9)),`0x${(0,SC.keccak256)(s)}`}};function EM(t){let e=t.startsWith("0x")?t.substring(2):t;return Uint8Array.from(Buffer.from(e,"hex"))}i(EM,"addressToBytes");u();l();var sr=class{static{i(this,"OrderBuilder")}_order={};asset(e){return this._order.a=e,this}isBuy(e){return this._order.b=e,this}buy(){return this.isBuy(!0)}sell(){return this.isBuy(!1)}price(e){return this._order.p=e.toString(),this}size(e){return this._order.s=e.toString(),this}reduceOnly(e){return this._order.r=e,this}clientOrderId(e){return this._order.c=e,this}limitOrder(e="Gtc"){return this._order.t={limit:{tif:e}},this}postOnly(){return this.limitOrder("Alo")}immediateOrCancel(){return this.limitOrder("Ioc")}triggerOrder(e,r=!0,o="sl"){return this._order.t={trigger:{isMarket:r,triggerPx:e.toString(),tpsl:o}},this}stopLoss(e,r=!0){return this.triggerOrder(e,r,"sl")}takeProfit(e,r=!0){return this.triggerOrder(e,r,"tp")}build(){if(this._order.a===void 0)throw new Error("Asset is required");if(this._order.b===void 0)throw new Error("Buy/sell direction is required");if(this._order.p===void 0)throw new Error("Price is required");if(this._order.s===void 0)throw new Error("Size is required");if(this._order.t===void 0)throw new Error("Order type is required");return this._order.r===void 0&&(this._order.r=!1),this._order}};u();l();function ir(t,e,r=!0,o=x.ROUND_HALF_UP){let n=new x(t);if(n.isInteger())return n.toString();let s=CM(e,r);return n.precision(5,o).toFixed(s,o).replace(/\.?0+$/,"")}i(ir,"formatPrice");function CM(t,e=!0){return Math.max((e?6:8)-t,0)}i(CM,"maxAllowedDecimalsInPrice");u();l();function pp(t,e,r=x.ROUND_HALF_UP){return new x(t).toFixed(e,r).replace(/(\.\d*?)0+$/,"$1").replace(/\.$/,"")}i(pp,"formatSize");u();l();var dp=class{static{i(this,"CancelOrderBuilder")}_order={};asset(e){return this._order.a=e,this}orderId(e){return this._order.o=e,this}build(){if(this._order.a===void 0)throw new Error("Asset is required");if(this._order.o===void 0)throw new Error("Order ID is required");return this._order}};u();l();var bC=N(xi());var mp=class{static{i(this,"CancelOrderAction")}type="cancel";cancels;constructor(e){this.cancels=e}hash(e,r){let o=Pr(this),n=e===null?9:29,s=new Uint8Array(o.length+n);s.set(o);let c=new DataView(s.buffer,s.byteOffset,s.byteLength);return c.setBigUint64(o.length,BigInt(r)),e===null?c.setUint8(o.length+8,0):(c.setUint8(o.length+8,1),s.set(kM(e),o.length+9)),`0x${(0,bC.keccak256)(s)}`}};function kM(t){let e=t.startsWith("0x")?t.substring(2):t;return Uint8Array.from(Buffer.from(e,"hex"))}i(kM,"addressToBytes");u();l();function dh(t){switch(t.type){case"preparingTransaction":case"registeringBuilder":case"builderRegistered":case"registeringReferral":case"referralRegistered":case"managingPosition":case"managePositionSucceeded":return TC(t);case"builderRegistrationFailed":case"referralRegistrationFailed":case"managePositionFailed":return{...TC(t),error:t.error instanceof Error?t.error.message:"Unknown error"};case"indeterminate":default:return{state:t.type}}}i(dh,"getManagePositionStateLogsDetails");var TC=i(t=>t.type==="indeterminate"?{state:t.type}:{marketSymbols:t.markets.map(e=>e.symbol).join(", "),assetIds:t.markets.map(e=>e.assetId.toString()).join(", "),positionDirections:t.positions.map(e=>e.direction).join(", "),positionSizes:t.positions.map(e=>e.size.toString()).join(", "),updateType:t.update.type,fees:t.fees.map(e=>e.toString()).join(", "),...t.update.type==="close"&&{closeSize:t.update.size.toString()},...t.update.type==="addAutoClose"&&{tpTriggerPrice:t.update.autoClose.tp?.triggerPrice.toString()||"N/A",slTriggerPrice:t.update.autoClose.sl?.triggerPrice.toString()||"N/A"},...t.update.type==="removeAutoClose"&&{tpOrderId:t.update.autoClose.tp?.orderId?.toString()||"N/A",slOrderId:t.update.autoClose.sl?.orderId?.toString()||"N/A"}},"getBaseLogsDetails");u();l();var fp=class{static{i(this,"ManagePositionStateMachine")}listeners=[];state={type:"indeterminate"};getState(){return this.state}send(e){try{let r=this.determineNextState(this.state,e);this.state=r,this.notifyListeners(e)}catch(r){console.error("Error processing event in ManagePositionStateMachine:",e,r)}}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}determineNextState(e,r){switch(r.type){case"InitiateManagePosition":{let{positions:o,update:n,markets:s,fees:c,autoClose:p}=r.payload;return{type:"preparingTransaction",...{positions:o,update:n,markets:s,fees:c,autoClose:p}}}case"RegisterBuilderCodeInitiated":{if(e.type==="preparingTransaction")return{type:"registeringBuilder",positions:e.positions,update:e.update,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"RegisterBuilderCodeNotRequired":case"RegisterBuilderCodeSuccess":{if(e.type==="registeringBuilder")return{type:"builderRegistered",positions:e.positions,update:e.update,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"RegisterBuilderCodeFailure":{if(e.type==="registeringBuilder")return{type:"builderRegistrationFailed",positions:e.positions,update:e.update,error:r.error,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"RegisterReferralInitiated":{if(e.type==="builderRegistered")return{type:"registeringReferral",positions:e.positions,update:e.update,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"RegisterReferralNotRequired":case"RegisterReferralSuccess":{if(e.type==="registeringReferral")return{type:"referralRegistered",positions:e.positions,update:e.update,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"RegisterReferralFailure":{if(e.type==="registeringReferral")return{type:"referralRegistrationFailed",positions:e.positions,update:e.update,error:r.error,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"ManagePositionInitiated":{if(e.type==="preparingTransaction"||e.type==="referralRegistered")return{type:"managingPosition",positions:e.positions,update:e.update,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"ManagePositionSuccess":{if(e.type==="managingPosition")return{type:"managePositionSucceeded",positions:e.positions,update:e.update,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"ManagePositionFailure":{if(e.type==="managingPosition")return{type:"managePositionFailed",positions:e.positions,update:e.update,error:r.error,markets:e.markets,fees:e.fees,autoClose:e.autoClose};break}case"Reset":return{type:"indeterminate"}}return e}notifyListeners(e){this.listeners.forEach(r=>{r.onManagePositionStateChange(e,this.state)})}};var ai=.1,hp=class{static{i(this,"ManagePositionOrchestrator")}stateMachine=new fp;perps;constructor(e){this.perps=e,this.stateMachine.addListener(this.stateListener),this.stateMachine.addListener(this.stateLogsListener)}stateListener={onManagePositionStateChange:i((e,r)=>{this.handleStateChange(e,r)},"onManagePositionStateChange")};stateLogsListener={onManagePositionStateChange:i((e,r)=>{switch(r.type){case"managePositionSucceeded":k.addBreadcrumb(v.Perps,`Manage position succeeded: ${r.type}`,D.Info,dh(r));break;case"builderRegistrationFailed":case"referralRegistrationFailed":case"managePositionFailed":k.addBreadcrumb(v.Perps,`Manage position failed: ${r.type}`,D.Error,dh(r));break;default:k.addBreadcrumb(v.Perps,`Manage position state change: ${e.type} -> ${r.type}`,D.Info);break}(r.type==="managePositionSucceeded"||r.type==="managePositionFailed")&&this.stateMachine.removeListener(this.stateLogsListener)},"onManagePositionStateChange")};async handleStateChange(e,r){switch(e.type){case"InitiateManagePosition":e.payload.update.type==="close"?this.stateMachine.send({type:"RegisterBuilderCodeInitiated"}):this.stateMachine.send({type:"ManagePositionInitiated"});break;case"RegisterBuilderCodeInitiated":r.type==="registeringBuilder"&&await this.registerBuilder();break;case"RegisterBuilderCodeNotRequired":case"RegisterBuilderCodeSuccess":r.type==="builderRegistered"&&this.stateMachine.send({type:"RegisterReferralInitiated"});break;case"RegisterReferralInitiated":r.type==="registeringReferral"&&await this.registerReferral();break;case"RegisterReferralNotRequired":case"RegisterReferralSuccess":r.type==="referralRegistered"&&this.stateMachine.send({type:"ManagePositionInitiated"});break;case"ManagePositionInitiated":r.type==="managingPosition"&&await this.managePosition(r);break}}getState(){return this.stateMachine.getState()}send(e){this.stateMachine.send(e)}addListener(e){this.stateMachine.addListener(e)}removeListener(e){this.stateMachine.removeListener(e)}async registerBuilder(){try{let e=this.perps.getPositionFeesState();if(e.type!=="positionFees"&&e.type!=="refreshing"||!e.positionFees.builder)throw new Error("position fees not found");if(e.positionFees.builder.registered){this.stateMachine.send({type:"RegisterBuilderCodeNotRequired"});return}let r=e.positionFees.builder.address,o=`${Number(e.positionFees.phantomFee.toString())*100}%`,n=Date.now(),s={type:"approveBuilderFee",hyperliquidChain:this.perps.isTestnet?"Testnet":"Mainnet",signatureChainId:this.perps.isTestnet?"0x66eee":"0xa4b1",maxFeeRate:o,builder:r,nonce:n},c={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.perps.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:ApproveBuilderFee",types:{EIP712Domain:ot,"HyperliquidTransaction:ApproveBuilderFee":Xl},message:s},d=(await this.perps.exchangeAction(s,c,n)).response.data?.statuses?.find(m=>typeof m=="object"&&"error"in m);if(d&&typeof d=="object"&&"error"in d)throw new Error(d.error);this.stateMachine.send({type:"RegisterBuilderCodeSuccess"}),this.perps.syncPositionFees()}catch(e){this.stateMachine.send({type:"RegisterBuilderCodeFailure",error:e})}}async registerReferral(){try{if(this.perps.isTestnet){this.stateMachine.send({type:"RegisterReferralSuccess"});return}let e=this.perps.getPositionFeesState();if(e.type!=="positionFees"&&e.type!=="refreshing")throw new Error("position fees not found");if(!e.positionFees.referral||e.positionFees.referral.registered){this.stateMachine.send({type:"RegisterReferralNotRequired"});return}let r=e.positionFees.referral.code,o=new ii({code:r}),n=Date.now(),s={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ot,Agent:nr},message:{source:this.perps.isTestnet?"b":"a",connectionId:o.hash(null,n)}},p=(await this.perps.exchangeAction(o,s,n)).response.data?.statuses?.find(d=>typeof d=="object"&&"error"in d);if(p&&typeof p=="object"&&"error"in p)throw new Error(p.error);this.stateMachine.send({type:"RegisterReferralSuccess"}),this.perps.syncPositionFees()}catch(e){this.stateMachine.send({type:"RegisterReferralFailure",error:e})}}async managePosition(e){try{let{positions:r,update:o,markets:n}=e,s="",p=r.map(d=>d.direction==="long").map(d=>d);if(o.type==="removeAutoClose"){let d=await this.removeOrders(n[0].assetId,[o.autoClose.tp?.orderId,o.autoClose.sl?.orderId].filter(Boolean));if(!d)throw new Error("Failed to cancel auto close orders");s=d}else if(o.type==="removeLimitOrder"){let d=await this.removeOrders(n[0].assetId,[o.limitOrder.orderId].filter(Boolean));if(!d)throw new Error("Failed to cancel auto close orders");s=d}else if(o.type==="removeAllOrders"){let d=await this.removeOrders(n[0].assetId,[...o.limitOrders.map(m=>m.orderId).filter(Boolean),...[o.autoClose.tp?.orderId,o.autoClose.sl?.orderId].filter(Boolean)]);if(!d)throw new Error("Failed to cancel auto close orders");s=d}else if(o.type==="close"||o.type==="closeAll")s=await this.closePositions(n.map(m=>m.assetId),o.size instanceof x?[o.size.abs().toString()]:o.size.map(m=>m.abs().toString()),p,n.map(m=>m.currentPrice.toString()),n.map(m=>m.szDecimals));else if(o.type==="addAutoClose"){let d={tp:o.autoClose.tp?.orderId,sl:o.autoClose.sl?.orderId},m=await this.createAutoClose(d,n[0].assetId,p[0],n[0].szDecimals,o.autoClose);if(!m)throw new Error("Failed to cancel auto close orders");s=m}this.stateMachine.send({type:"ManagePositionSuccess",payload:s})}catch(r){this.stateMachine.send({type:"ManagePositionFailure",error:r})}}async closePositions(e,r,o,n,s){let c=this.perps.getPositionFeesState();if(c.type!=="positionFees"&&c.type!=="refreshing"||!c.positionFees.builder)throw new Error("position fees not found");let p={b:c.positionFees.builder.address.toLowerCase(),f:Number(c.positionFees.phantomFee)*100*100*10},d=[];for(let b=0;b<e.length;b++){let T=ir(new x(n[b]).multipliedBy(o[b]?1-ai:1+ai),s[b]),A=pp(new x(r[b]),s[b]),E=new sr().asset(e[b]).isBuy(!o[b]).price(T).size(A).reduceOnly(!0).immediateOrCancel().build();d.push(E)}let m=new Eo(d,p),f=Date.now(),g={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ot,Agent:nr},message:{source:this.perps.isTestnet?"b":"a",connectionId:m.hash(null,f)}},w=await this.perps.exchangeAction(m,g,f),y=w.response.data?.statuses.find(b=>b==="error"||b?.error);if(y){let b=typeof y=="string"?"Operation failed":y.error;throw new Error(b)}if(w.response.data?.statuses.find(b=>b==="filled"||b?.filled))return JSON.stringify(w.response.data?.statuses);throw new Error("No filled status found")}async createAutoClose(e,r,o,n,s){let c=[e.tp,e.sl].filter(Boolean).filter(I=>I!==-1);if(c.length>0&&!await this.removeOrders(r,c))throw new Error("Failed to cancel auto close orders");let p=this.perps.getPositionFeesState();if(p.type!=="positionFees"&&p.type!=="refreshing"||!p.positionFees.builder)throw new Error("position fees not found");let d={b:p.positionFees.builder.address.toLowerCase(),f:Number(p.positionFees.phantomFee)*100*100*10},m="0",f;if(s?.tp){let I=ir(new x(s.tp.triggerPrice).multipliedBy(o?1-ai:1+ai),n),P=ir(new x(s.tp.triggerPrice),n).toString();f=new sr().asset(r).isBuy(!o).price(I).size(m).reduceOnly(!0).triggerOrder(P,!0,"tp").build()}let g;if(s?.sl){let I=ir(new x(s.sl.triggerPrice).multipliedBy(o?1-ai:1+ai),n),P=ir(new x(s.sl.triggerPrice),n).toString();g=new sr().asset(r).isBuy(!o).price(I).size(m).reduceOnly(!0).triggerOrder(P,!0,"sl").build()}let w=[f,g].filter(Boolean),y=new Eo(w,d),S=Date.now(),b={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ot,Agent:nr},message:{source:this.perps.isTestnet?"b":"a",connectionId:y.hash(null,S)}},T=await this.perps.exchangeAction(y,b,S),A=T.response.data?.statuses.find(I=>I==="error"||I?.error);if(A){let I=typeof A=="string"?"Operation failed":A.error;throw new Error(I)}let E=T.response.data?.statuses.find(I=>I==="resting"||I?.resting);if(E&&typeof E=="object"&&E.resting&&E.resting.oid)return JSON.stringify(T.response.data?.statuses);throw new Error("No order status found")}async removeOrders(e,r){let o=r.map(m=>new dp().asset(e).orderId(Number(m)).build()),n=new mp(o),s=Date.now(),c={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ot,Agent:nr},message:{source:this.perps.isTestnet?"b":"a",connectionId:n.hash(null,s)}},p=await this.perps.exchangeAction(n,c,s),d=p.response.data?.statuses.find(m=>m==="error"||m?.error);if(d){let m=typeof d=="string"?"Operation failed":d.error;throw new Error(m)}if(p.response.data?.statuses&&p.response.data?.statuses.length>0&&p.response.data?.statuses.every(m=>m==="success"||m?.success))return JSON.stringify({orderIds:o});throw new Error("Cancel operation failed")}};u();l();u();l();var AC=N(xi());var gp=class{static{i(this,"UpdateLeverageAction")}type="updateLeverage";asset;isCross;leverage;constructor(e){this.asset=e.asset,this.isCross=e.isCross,this.leverage=e.leverage}hash(e,r){let o=Pr(this),n=e===null?9:29,s=new Uint8Array(o.length+n);s.set(o);let c=new DataView(s.buffer,s.byteOffset,s.byteLength);return c.setBigUint64(o.length,BigInt(r)),e===null?c.setUint8(o.length+8,0):(c.setUint8(o.length+8,1),s.set(IM(e),o.length+9)),`0x${(0,AC.keccak256)(s)}`}};function IM(t){let e=t.startsWith("0x")?t.substring(2):t;return Uint8Array.from(Buffer.from(e,"hex"))}i(IM,"addressToBytes");u();l();function mh(t){switch(t.type){case"preparingTransaction":case"updatingLeverage":case"leverageUpdated":case"registeringBuilder":case"builderRegistered":case"registeringReferral":case"referralRegistered":case"creatingPosition":case"orderSucceeded":return xC(t);case"leverageUpdateFailed":case"builderRegistrationFailed":case"referralRegistrationFailed":case"orderFailed":return{...xC(t),error:t.error instanceof Error?t.error.message:"Unknown error"};case"indeterminate":default:return{state:t.type}}}i(mh,"getOpenPositionStateLogsDetails");var xC=i(t=>t.type==="indeterminate"?{state:t.type}:{marketSymbol:t.market.symbol,assetId:t.market.assetId.toString(),direction:t.direction,margin:t.margin.toString(),leverage:t.leverage.toString(),size:t.size.toString(),sizeInCoin:t.sizeInCoin.toString(),estimatedLiquidationPrice:t.estimatedLiquidationPrice?.toString()||"N/A",fee:t.fee?.toString()||"N/A",action:t.action},"getBaseLogsDetails");u();l();var yp=class{static{i(this,"OpenPositionStateMachine")}listeners=[];state={type:"indeterminate"};getState(){return this.state}send(e){try{let r=this.determineNextState(this.state,e);this.state=r,this.notifyListeners(e)}catch(r){console.error("Error processing event in OpenPositionStateMachine:",e,r)}}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}determineNextState(e,r){switch(r.type){case"InitiateOpenPosition":{let{market:o,direction:n,margin:s,leverage:c,autoClose:p,estimatedLiquidationPrice:d,fee:m,action:f,limitPrice:g}=r.payload,w=new x(s).multipliedBy(c),y=new x(o.currentPrice),S=y.isGreaterThan(0)?w.dividedBy(y):new x(0);return{type:"preparingTransaction",...{market:o,direction:n,margin:s,leverage:c,autoClose:p,size:w,sizeInCoin:S,estimatedLiquidationPrice:d,fee:m,action:f,limitPrice:g}}}case"PrepareCollateralInitiated":{if(e.type==="preparingTransaction")return{type:"preparingCollateral",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"PrepareCollateralNotRequired":case"PrepareCollateralSuccess":{if(e.type==="preparingCollateral"||e.type==="preparingTransaction")return{type:"collateralPrepared",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"PrepareCollateralFailure":{if(e.type==="preparingCollateral")return{type:"collateralPreparationFailed",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,error:r.error,action:e.action,limitPrice:e.limitPrice};break}case"InitiateUpdateLeverage":{if(e.type==="collateralPrepared")return e;break}case"UpdateLeverageInitiated":{if(e.type==="collateralPrepared")return{type:"updatingLeverage",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"UpdateLeverageSuccess":{if(e.type==="updatingLeverage")return{type:"leverageUpdated",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"UpdateLeverageFailure":{if(e.type==="updatingLeverage")return{type:"leverageUpdateFailed",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,error:r.error,action:e.action,limitPrice:e.limitPrice};break}case"RegisterBuilderCodeInitiated":{if(e.type==="leverageUpdated")return{type:"registeringBuilder",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"RegisterBuilderCodeNotRequired":case"RegisterBuilderCodeSuccess":{if(e.type==="registeringBuilder")return{type:"builderRegistered",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"RegisterBuilderCodeFailure":{if(e.type==="registeringBuilder")return{type:"builderRegistrationFailed",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,error:r.error,action:e.action,limitPrice:e.limitPrice};break}case"RegisterReferralInitiated":{if(e.type==="builderRegistered")return{type:"registeringReferral",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"RegisterReferralNotRequired":case"RegisterReferralSuccess":{if(e.type==="registeringReferral")return{type:"referralRegistered",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"RegisterReferralFailure":{if(e.type==="registeringReferral")return{type:"referralRegistrationFailed",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,error:r.error,action:e.action,limitPrice:e.limitPrice};break}case"PositionCreationInitiated":{if(e.type==="referralRegistered")return{type:"creatingPosition",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"PositionCreationSuccess":{if(e.type==="creatingPosition")return{type:"orderSucceeded",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"PositionCreationFailure":{if(e.type==="creatingPosition")return{type:"orderFailed",market:e.market,direction:e.direction,margin:e.margin,leverage:e.leverage,autoClose:e.autoClose,size:e.size,sizeInCoin:e.sizeInCoin,error:r.error,estimatedLiquidationPrice:e.estimatedLiquidationPrice,fee:e.fee,action:e.action,limitPrice:e.limitPrice};break}case"Reset":return{type:"indeterminate"}}return e}notifyListeners(e){let r=this.state;this.listeners.forEach(o=>{queueMicrotask(()=>{o.onOpenPositionStateChange(e,r)})})}};var ci=.1,wp=class{static{i(this,"OpenPositionOrchestrator")}stateMachine=new yp;perps;warmedLeverage=new Map;constructor(e){this.perps=e,this.stateMachine.addListener(this.stateListener),this.stateMachine.addListener(this.stateLogsListener)}stateListener={onOpenPositionStateChange:i((e,r)=>{this.handleStateChange(e,r)},"onOpenPositionStateChange")};stateLogsListener={onOpenPositionStateChange:i((e,r)=>{switch(r.type){case"orderSucceeded":k.addBreadcrumb(v.Perps,`Open position succeeded: ${r.type}`,D.Info,mh(r));break;case"collateralPreparationFailed":case"leverageUpdateFailed":case"builderRegistrationFailed":case"referralRegistrationFailed":case"orderFailed":k.addBreadcrumb(v.Perps,`Open position failed: ${r.type}`,D.Error,mh(r));break;default:k.addBreadcrumb(v.Perps,`Open position state change: ${e.type} -> ${r.type}`,D.Info);break}(r.type==="orderSucceeded"||r.type==="orderFailed"||r.type==="collateralPreparationFailed")&&this.stateMachine.removeListener(this.stateLogsListener)},"onOpenPositionStateChange")};async handleStateChange(e,r){switch(e.type){case"InitiateOpenPosition":this.stateMachine.send({type:"PrepareCollateralInitiated"});break;case"PrepareCollateralInitiated":r.type==="preparingCollateral"&&await this.prepareCollateral(r);break;case"PrepareCollateralNotRequired":case"PrepareCollateralSuccess":r.type==="collateralPrepared"&&this.stateMachine.send({type:"InitiateUpdateLeverage",payload:{isCross:!1,leverage:r.leverage}});break;case"InitiateUpdateLeverage":this.stateMachine.send({type:"UpdateLeverageInitiated"});break;case"UpdateLeverageInitiated":r.type==="updatingLeverage"&&await this.ensureLeverage(r);break;case"UpdateLeverageSuccess":r.type==="leverageUpdated"&&this.stateMachine.send({type:"RegisterBuilderCodeInitiated"});break;case"InitiateRegisterBuilder":this.stateMachine.send({type:"RegisterBuilderCodeInitiated"});break;case"RegisterBuilderCodeInitiated":r.type==="registeringBuilder"&&await this.registerBuilder();break;case"RegisterBuilderCodeNotRequired":case"RegisterBuilderCodeSuccess":r.type==="builderRegistered"&&this.stateMachine.send({type:"RegisterReferralInitiated"});break;case"InitiateRegisterReferral":this.stateMachine.send({type:"RegisterReferralInitiated"});break;case"RegisterReferralInitiated":r.type==="registeringReferral"&&await this.registerReferral();break;case"RegisterReferralNotRequired":case"RegisterReferralSuccess":r.type==="referralRegistered"&&this.stateMachine.send({type:"PositionCreationInitiated"});break;case"PositionCreationInitiated":r.type==="creatingPosition"&&await this.createPosition(r);break}}getState(){return this.stateMachine.getState()}send(e){this.stateMachine.send(e)}addListener(e){this.stateMachine.addListener(e)}removeListener(e){this.stateMachine.removeListener(e)}warmLeverage(e){let r=this.getLeverageWarmKey(e.assetId,e.leverage);if(!r||this.warmedLeverage.has(r))return;let o=this.updateLeverage(e.assetId,e.leverage).catch(n=>{throw this.warmedLeverage.delete(r),k.addBreadcrumb(v.Perps,"Warm leverage failed",D.Error,{error:n instanceof Error?n.message:"Unknown error"}),n});this.warmedLeverage.set(r,o)}async prepareCollateral(e){try{let{collateralToken:r}=e.market,{action:o}=e;if(!r||o==="reduce"||o==="reverse"){this.stateMachine.send({type:"PrepareCollateralNotRequired"});return}let n=e.margin;await this.perps.transfer({toPerp:!1,amount:n}),k.addBreadcrumb(v.Perps,"Transferred USDC from perp to spot for collateral",D.Info,{amount:n.toString()}),await this.perps.spot.swapUsdcToCollateral(r.pairIndex,n),k.addBreadcrumb(v.Perps,"Swapped USDC to collateral token",D.Info,{pairIndex:r.pairIndex,amount:n.toString()}),this.stateMachine.send({type:"PrepareCollateralSuccess"})}catch(r){k.addBreadcrumb(v.Perps,"Failed to prepare collateral",D.Error,{error:r instanceof Error?r.message:"Unknown error"}),this.stateMachine.send({type:"PrepareCollateralFailure",error:r})}}getLeverageWarmKey(e,r){let o=this.perps.getUser();return o?JSON.stringify({user:o.address.toLowerCase(),assetId:e,leverage:r.toString(),isCross:!1,isTestnet:this.perps.isTestnet}):null}async ensureLeverage(e){try{let r=e.market.assetId,o=e.leverage,n=this.getLeverageWarmKey(r,o);if(!n){await this.updateLeverage(r,o),this.stateMachine.send({type:"UpdateLeverageSuccess"});return}let s=this.warmedLeverage.get(n);s?await s:await this.updateLeverage(r,o),this.stateMachine.send({type:"UpdateLeverageSuccess"})}catch(r){this.stateMachine.send({type:"UpdateLeverageFailure",error:r})}}async updateLeverage(e,r){let o=new gp({asset:e,isCross:!1,leverage:r.toNumber()}),n=Date.now(),s={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ot,Agent:nr},message:{source:this.perps.isTestnet?"b":"a",connectionId:o.hash(null,n)}},p=(await this.perps.exchangeAction(o,s,n)).response.data?.statuses?.find(d=>typeof d=="object"&&"error"in d);if(p&&typeof p=="object"&&"error"in p)throw new Error(p.error)}async registerBuilder(){try{let e=this.perps.getPositionFeesState();if(e.type!=="positionFees"&&e.type!=="refreshing"||!e.positionFees.builder)throw new Error("position fees not found");if(e.positionFees.builder.registered){this.stateMachine.send({type:"RegisterBuilderCodeNotRequired"});return}let r=e.positionFees.builder.address,o=`${Number(e.positionFees.phantomFee.toString())*100}%`,n=Date.now(),s={type:"approveBuilderFee",hyperliquidChain:this.perps.isTestnet?"Testnet":"Mainnet",signatureChainId:this.perps.isTestnet?"0x66eee":"0xa4b1",maxFeeRate:o,builder:r,nonce:n},c={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.perps.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:ApproveBuilderFee",types:{EIP712Domain:ot,"HyperliquidTransaction:ApproveBuilderFee":Xl},message:s},d=(await this.perps.exchangeAction(s,c,n)).response.data?.statuses?.find(m=>typeof m=="object"&&"error"in m);if(d&&typeof d=="object"&&"error"in d)throw new Error(d.error);this.stateMachine.send({type:"RegisterBuilderCodeSuccess"}),this.perps.syncPositionFees()}catch(e){this.stateMachine.send({type:"RegisterBuilderCodeFailure",error:e})}}async registerReferral(){try{if(this.perps.isTestnet){this.stateMachine.send({type:"RegisterReferralSuccess"});return}let e=this.perps.getPositionFeesState();if(e.type!=="positionFees"&&e.type!=="refreshing")throw new Error("position fees not found");if(!e.positionFees.referral||e.positionFees.referral.registered){this.stateMachine.send({type:"RegisterReferralNotRequired"});return}let r=e.positionFees.referral.code,o=new ii({code:r}),n=Date.now(),s={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ot,Agent:nr},message:{source:this.perps.isTestnet?"b":"a",connectionId:o.hash(null,n)}},p=(await this.perps.exchangeAction(o,s,n)).response.data?.statuses?.find(d=>typeof d=="object"&&"error"in d);if(p&&typeof p=="object"&&"error"in p)throw new Error(p.error);this.stateMachine.send({type:"RegisterReferralSuccess"}),this.perps.syncPositionFees()}catch(e){this.stateMachine.send({type:"RegisterReferralFailure",error:e})}}async createPosition(e){try{let r=await this.createOrder(e.market.assetId,e.size.toString(),e.direction==="long",e.limitPrice?e.limitPrice.toString():e.market.currentPrice.toString(),e.market.szDecimals,e.autoClose,e.action==="reduce",e.limitPrice?"limit":"market");this.stateMachine.send({type:"PositionCreationSuccess",payload:r})}catch(r){this.stateMachine.send({type:"PositionCreationFailure",error:r})}}async createOrder(e,r,o,n,s,c,p,d="market"){let m=d==="limit"?ir(new x(n),s):ir(new x(n).multipliedBy(o?1+ci:1-ci),s),f=this.perps.getPositionFeesState();if(f.type!=="positionFees"&&f.type!=="refreshing"||!f.positionFees.builder)throw new Error("position fees not found");let g={b:f.positionFees.builder.address.toLowerCase(),f:Number(f.positionFees.phantomFee)*100*100*10},w=pp(new x(r).dividedBy(new x(n)),s),y;d==="limit"?y=new sr().asset(e).isBuy(o).price(m).size(w).reduceOnly(p??!1).limitOrder().build():y=new sr().asset(e).isBuy(o).price(m).size(w).reduceOnly(p??!1).immediateOrCancel().build();let S;if(c?.tp?.dollar){let H=ir(new x(c.tp.dollar),s).toString(),Q=ir(new x(c.tp.dollar).multipliedBy(o?1+ci:1-ci),s);S=new sr().asset(e).isBuy(!o).price(Q).size(w).reduceOnly(!0).triggerOrder(H,!0,"tp").build()}let b;if(c?.sl?.dollar){let H=ir(new x(c.sl.dollar),s).toString(),Q=ir(new x(c.sl.dollar).multipliedBy(o?1+ci:1-ci),s);b=new sr().asset(e).isBuy(!o).price(Q).size(w).reduceOnly(!0).triggerOrder(H,!0,"sl").build()}let T=[y,S,b].filter(Boolean),A=new Eo(T,g),E=Date.now(),I={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ot,Agent:nr},message:{source:this.perps.isTestnet?"b":"a",connectionId:A.hash(null,E)}},P=await this.perps.exchangeAction(A,I,E),U=P.response.data?.statuses?.find(H=>typeof H=="object"&&"error"in H);if(U&&typeof U=="object"&&"error"in U)throw new Error(U.error);let O=P.response.data?.statuses.find(H=>typeof H=="object"&&"filled"in H),_=P.response.data?.statuses.find(H=>typeof H=="object"&&"resting"in H);if(O&&typeof O=="object"&&"filled"in O||_)return JSON.stringify(P.response.data?.statuses);throw new Error("No filled status found")}};u();l();var Sp=class{static{i(this,"PositionFeesStateMachine")}listeners=[];state={type:"indeterminate"};send(e){let r=this.detectNextState(e);this.state=r,this.notifyListeners()}detectNextState(e){switch(e.type){case"fetchingPositionFeesStart":switch(this.state.type){case"positionFees":return{type:"refreshing",positionFees:this.state.positionFees};case"refreshing":return{type:"refreshing",positionFees:this.state.positionFees};case"indeterminate":case"error":return{type:"loading"};default:throw new Error(`Invalid state ${this.state.type} for fetchingPositionFeesStart`)}case"fetchingPositionFeesSuccess":switch(this.state.type){case"loading":case"refreshing":case"positionFees":return{type:"positionFees",positionFees:e.fees};default:throw new Error(`Invalid state ${this.state.type} for fetchingPositionFeesSuccess`)}case"fetchingPositionFeesError":return{type:"error",error:e.error}}}getState(){return this.state}reset(){this.state={type:"indeterminate"},this.notifyListeners()}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}notifyListeners(){this.listeners.forEach(e=>{e.onPositionFeesStateChange(this.state)})}};u();l();var fh=["1H","1D","1W","1M","YTD","ALL"],bp=class{static{i(this,"PricingStateMachine")}listeners=[];state={type:"indeterminate"};nextRequestId=1;send(e){let r=this.detectNextState(e);this.state=r,this.notifyListeners()}detectNextState(e){switch(e.type){case"initiateSequentialFetch":{let r={"1H":{type:"idle"},"1D":{type:"idle"},"1W":{type:"idle"},"1M":{type:"idle"},YTD:{type:"idle"},ALL:{type:"idle"}};return{type:"multiInterval",activeCoin:e.coin,requestId:this.nextRequestId++,intervals:r,currentlyFetchingInterval:null,sequenceComplete:!1}}case"fetchingIntervalStart":return this.state.type!=="multiInterval"?this.state:e.requestId!==this.state.requestId||e.coin!==this.state.activeCoin?this.state:{...this.state,intervals:{...this.state.intervals,[e.interval]:{type:"loading"}},currentlyFetchingInterval:e.interval};case"fetchingIntervalSuccess":{if(this.state.type!=="multiInterval")return this.state;if(e.requestId!==this.state.requestId||e.coin!==this.state.activeCoin)return this.state;let r={...this.state.intervals,[e.interval]:{type:"loaded",candleSnapshots:e.candleSnapshots}},o=fh.every(n=>{let s=r[n];return s.type==="loaded"||s.type==="error"});return{type:"multiInterval",activeCoin:this.state.activeCoin,requestId:this.state.requestId,intervals:r,currentlyFetchingInterval:null,sequenceComplete:o}}case"fetchingIntervalError":{if(this.state.type!=="multiInterval")return this.state;if(e.requestId!==this.state.requestId||e.coin!==this.state.activeCoin)return this.state;let r={...this.state.intervals,[e.interval]:{type:"error",error:e.error}},o=fh.every(n=>{let s=r[n];return s.type==="loaded"||s.type==="error"});return{type:"multiInterval",activeCoin:this.state.activeCoin,requestId:this.state.requestId,intervals:r,currentlyFetchingInterval:null,sequenceComplete:o}}case"sequentialFetchComplete":return this.state.type!=="multiInterval"?this.state:{...this.state,sequenceComplete:!0};default:return this.state}}getState(){return this.state}getNextIntervalToFetch(){if(this.state.type!=="multiInterval")return null;for(let e of fh)if(this.state.intervals[e].type==="idle")return e;return null}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}notifyListeners(){this.listeners.forEach(e=>{e.onPricingStateChange(this.state)})}};u();l();var Tp=.98,Ap=class{static{i(this,"Spot")}perps;perpsClient;constructor(e,r){this.perps=e,this.perpsClient=r}async getSpotBalances(e){let r=L({address:e,chainId:Ei.Mainnet,resourceType:V.address});return(await this.perpsClient.getSpotBalances({user:r})).balances}async buy(e,r,o){let n=new x(o).dividedBy(Tp).decimalPlaces(2);return this.placeBuySellOrder(e,r,!0,n.toString())}async sell(e,r,o){let n=new x(o).multipliedBy(Tp).decimalPlaces(2);return this.placeBuySellOrder(e,r,!1,n.toString())}async placeBuySellOrder(e,r,o,n){if(!this.perps.user?.address)throw new Error("User not found");let c=new sr().asset(e).isBuy(o).price(n).size(r).reduceOnly(!1).immediateOrCancel().build(),p=new Eo([c]),d=Date.now(),m={domain:{name:"Exchange",version:"1",chainId:1337,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"Agent",types:{EIP712Domain:ot,Agent:nr},message:{source:this.perps.isTestnet?"b":"a",connectionId:p.hash(null,d)}},f=await this.perps.exchangeAction(p,m,d),g=f.response.data?.statuses.find(y=>typeof y=="object"&&"error"in y);if(g&&typeof g=="object"&&"error"in g)throw new Error(g.error);let w=f.response.data?.statuses.find(y=>typeof y=="object"&&"filled"in y);if(w&&typeof w=="object"&&"filled"in w)return{totalSz:w.filled.totalSz,avgPx:w.filled.avgPx};throw new Error("No filled status found")}async send(e,r,o,n){let s=`${e}:${r}`,c=Date.now(),p=new up({hyperliquidChain:this.perps.isTestnet?"Testnet":"Mainnet",signatureChainId:this.perps.isTestnet?"0x66eee":"0xa4b1",token:s,amount:o.toString(),destination:n.toLowerCase(),time:c}),d={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.perps.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:SpotSend",types:{EIP712Domain:ot,"HyperliquidTransaction:SpotSend":[{name:"hyperliquidChain",type:"string"},{name:"destination",type:"string"},{name:"token",type:"string"},{name:"amount",type:"string"},{name:"time",type:"uint64"}]},message:p},{splitSignature:m}=await this.perps.sign(d),f=await this.perpsClient.postSpotSend({action:p,nonce:c,signature:m});if(f.status==="err")throw new Error(f.response);return f.response}async getTokenMidPrice(e){let r=await this.perpsClient.getTokenDetails({tokenId:e});return new x(r.midPx)}async swapCollateralToUsdc(e,r,o){let n=new x(1),s=await this.sell(e,o.decimalPlaces(2,x.ROUND_DOWN).toString(),n);return{symbol:r,amount:o.toString(),usdcReceived:new x(s.totalSz).multipliedBy(s.avgPx).toString()}}async swapUsdcToCollateral(e,r){let o=new x(1);return this.buy(e,r.decimalPlaces(2,x.ROUND_DOWN).toString(),o)}async pollForUsdcBalance(e,r=10,o=1e3){for(let n=0;n<r;n++){let c=(await this.getSpotBalances(e)).find(p=>p.token.address==="USDC");if(c&&new x(c.amount).gte(.01))return new x(c.amount);n<r-1&&await new Promise(p=>setTimeout(p,o))}return null}};var xp=class{static{i(this,"Perps")}client;accountBalanceStateMachine=new Jl;positionsStateMachine=new rp;pricingStateMachine=new bp;positionFeesStateMachine=new Sp;signer=void 0;fundingHistoryStateMachine=new ep;historicalOrdersStateMachine=new tp;openPositionOrchestrator;managePositionOrchestrator;manageMarginOrchestrator;accountChangeListeners=[];account;user;isTestnet;spot;fundingPool;relayFundingTaskFactory;hyperunitFundingTaskFactory;sequentialPricingCoin=null;pricingRequestId=null;authRepository;constructor({client:e,isTestnet:r,fundingPool:o,relayFundingTaskFactory:n,hyperunitFundingTaskFactory:s,authRepository:c}){this.client=e,this.isTestnet=r,this.spot=new Ap(this,this.client),this.fundingPool=o,this.fundingPool.addListener(this.fundingPoolListener),this.relayFundingTaskFactory=n,this.hyperunitFundingTaskFactory=s,this.openPositionOrchestrator=new wp(this),this.managePositionOrchestrator=new hp(this),this.manageMarginOrchestrator=new cp(this),this.authRepository=c,this.pricingStateMachine.addListener({onPricingStateChange:this.handlePricingStateChange.bind(this)}),this.accountBalanceStateMachine.addListener({onAccountBalanceStateChange:i(p=>{this.enableDexAbstraction(p),this.autoConsolidateCollateral(p)},"onAccountBalanceStateChange")})}setSigner(e){this.signer=e}createRelayFundingTask(e,r,o,n){return this.relayFundingTaskFactory.createTask(this,e,this.authRepository,r,o,rn(this.signer),rn(this.user),n)}createHyperunitFundingTask(e,r,o,n){return this.hyperunitFundingTaskFactory.createTask(this,e,this.authRepository,r,o,rn(this.signer),rn(this.user),n)}executeFundingTask(e,r,o,n,s){this.fundingPool.submit(e,r,o,n,s)}fundingPoolListener={onFundingPoolStateChange:i((e,r)=>{(e.type==="fundingCompleted"||e.type==="fundingStarted")&&(this.syncAccountBalance(),this.syncFundingHistory())},"onFundingPoolStateChange")};setAccount(e){this.resetAllState(),this.account=e;let{address:r}=e.addresses?.find(o=>C.isEVMNetworkID(o.networkID))??{addressType:se.EVM,networkID:oe.Ethereum.Mainnet};r&&(this.user={resourceType:V.address,chainId:this.isTestnet?"hypercore:testnet":C.hypercore.mainnetID,address:r},this.fundingPool.setAccountId(r)),this.accountChangeListeners.forEach(o=>o.onAccountChange(e))}resetAllState(){this.accountBalanceStateMachine.reset(),this.positionsStateMachine.reset(),this.fundingHistoryStateMachine.reset(),this.historicalOrdersStateMachine.reset(),this.positionFeesStateMachine.reset()}getAccount(){return this.account}getUser(){return this.user}subscribeAccountChange(e){return this.accountChangeListeners.push(e),()=>this.unsubscribeAccountChange(e)}unsubscribeAccountChange(e){this.accountChangeListeners=this.accountChangeListeners.filter(r=>r!==e)}getAccountBalanceState(){return this.accountBalanceStateMachine.getState()}syncAccountBalance(){if(!this.user)return;let e=this.accountBalanceStateMachine.getState();e.type==="loading"||e.type==="refreshing"||(this.accountBalanceStateMachine.send({type:"fetchingAccountBalanceStart"}),this.client.getAccountBalance(this.user).then(r=>{this.accountBalanceStateMachine.send({type:"fetchingAccountBalanceSuccess",accountBalance:r})}).catch(r=>{this.accountBalanceStateMachine.send({type:"fetchingAccountBalanceError",error:r}),k.addBreadcrumb(v.Perps,"Error fetching account balance",D.Error,{error:r instanceof Error?r.message:"Unknown error"})}))}subscribeAccountBalanceState(e){return this.accountBalanceStateMachine.addListener(e),()=>{this.unsubscribeAccountBalanceState(e)}}unsubscribeAccountBalanceState(e){this.accountBalanceStateMachine.removeListener(e)}getPositionFeesState(){return this.positionFeesStateMachine.getState()}syncPositionFees(){if(!this.user)return;let e=this.positionFeesStateMachine.getState();e.type==="loading"||e.type==="refreshing"||(this.positionFeesStateMachine.send({type:"fetchingPositionFeesStart"}),this.client.getPositionFees(this.user).then(r=>{this.positionFeesStateMachine.send({type:"fetchingPositionFeesSuccess",fees:r})}).catch(r=>{this.positionFeesStateMachine.send({type:"fetchingPositionFeesError",error:r}),k.addBreadcrumb(v.Perps,"Error fetching position fees",D.Error,{error:r instanceof Error?r.message:"Unknown error"})}))}subscribePositionFees(e){return this.positionFeesStateMachine.addListener(e),()=>{this.unsubscribePositionFees(e)}}unsubscribePositionFees(e){this.positionFeesStateMachine.removeListener(e)}getPositionsState(){return this.positionsStateMachine.getState()}syncPositions(){if(!this.user)return;let e=this.positionsStateMachine.getState();e.type==="loading"||e.type==="refreshing"||(this.positionsStateMachine.send({type:"fetchingPositionsStart"}),this.client.getPositionsAndOpenOrders(this.user).then(r=>{this.positionsStateMachine.send({type:"fetchingPositionsSuccess",positions:r.positions,openOrders:r.openOrders})}).catch(r=>{this.positionsStateMachine.send({type:"fetchingPositionsError",error:r}),k.addBreadcrumb(v.Perps,"Error fetching positions",D.Error,{error:r instanceof Error?r.message:"Unknown error"})}))}subscribePositions(e){return this.positionsStateMachine.addListener(e),()=>{this.unsubscribePositions(e)}}unsubscribePositions(e){this.positionsStateMachine.removeListener(e)}getFundingHistoryState(){return this.fundingHistoryStateMachine.getState()}syncFundingHistory(){if(!this.user)return;let e=this.fundingHistoryStateMachine.getState();e.type==="loading"||e.type==="refreshing"||(this.fundingHistoryStateMachine.send({type:"fetchingFundingHistoryStart"}),this.client.getUserFundingHistory(this.user).then(r=>{this.fundingHistoryStateMachine.send({type:"fetchingFundingHistorySuccess",history:r})}).catch(r=>{this.fundingHistoryStateMachine.send({type:"fetchingFundingHistoryError",error:r}),k.addBreadcrumb(v.Perps,"Error fetching funding history",D.Error,{error:r instanceof Error?r.message:"Unknown error"})}))}subscribeFundingHistory(e){return this.fundingHistoryStateMachine.addListener(e),()=>{this.unsubscribeFundingHistory(e)}}unsubscribeFundingHistory(e){this.fundingHistoryStateMachine.removeListener(e)}getHistoricalOrdersState(){return this.historicalOrdersStateMachine.getState()}syncHistoricalOrders(e){if(!this.user)return;let r=this.historicalOrdersStateMachine.getState();r.type==="loading"||r.type==="refreshing"||(this.historicalOrdersStateMachine.send({type:"fetchingHistoricalOrdersStart"}),this.client.getHistoricalOrders(this.user,e).then(o=>{this.historicalOrdersStateMachine.send({type:"fetchingHistoricalOrdersSuccess",historicalOrders:o})}).catch(o=>{this.historicalOrdersStateMachine.send({type:"fetchingHistoricalOrdersError",error:o}),k.addBreadcrumb(v.Perps,"Error fetching historical orders",D.Error,{error:o instanceof Error?o.message:"Unknown error",markets:e?.join(",")??"No markets"})}))}subscribeHistoricalOrders(e){return this.historicalOrdersStateMachine.addListener(e),()=>{this.unsubscribeHistoricalOrders(e)}}unsubscribeHistoricalOrders(e){this.historicalOrdersStateMachine.removeListener(e)}getPricingState(){return this.pricingStateMachine.getState()}syncPricing(e,r,o,n){if(!this.user)return;let s;switch(r){case"1m":s="1H";break;case"15m":s="1D";break;case"1h":s="1W";break;case"4h":s="1M";break;case"1d":s="ALL";break;default:s="1D"}let c=this.pricingStateMachine.getState();(c.type!=="multiInterval"||c.activeCoin!==e)&&this.pricingStateMachine.send({type:"initiateSequentialFetch",coin:e});let p=this.pricingStateMachine.getState(),d=p.type==="multiInterval"?p.requestId:null;d!=null&&(this.pricingStateMachine.send({type:"fetchingIntervalStart",interval:s,coin:e,requestId:d,apiInterval:r,startTime:o,endTime:n}),this.client.getPriceHistory({coin:e,interval:s,startTime:o,endTime:n,isTestnet:this.isTestnet}).then(m=>{let f=lh(m);this.pricingStateMachine.send({type:"fetchingIntervalSuccess",interval:s,coin:e,requestId:d,candleSnapshots:f})}).catch(m=>{this.pricingStateMachine.send({type:"fetchingIntervalError",interval:s,coin:e,requestId:d,error:m}),k.addBreadcrumb(v.Perps,"Error fetching pricing",D.Error,{error:m instanceof Error?m.message:"Unknown error",coin:e,interval:r,startTime:o,endTime:n})}))}getTimeFrameDetails(e,r){let o=r,n,s;switch(e){case"1H":n=r-1e3*60*60*1,s="1m";break;case"1D":n=r-1e3*60*60*24,s="30m";break;case"1W":n=r-1e3*60*60*24*7,s="4h";break;case"1M":n=r-1e3*60*60*24*30,s="12h";break;case"YTD":n=new Date(new Date().getFullYear(),0,1).getTime(),s="1d";break;case"ALL":n=r-1e3*60*60*24*365*10,s="1d";break}return{startTime:n,endTime:o,apiInterval:s}}startSequentialPricingSync(e){this.sequentialPricingCoin=e,this.pricingStateMachine.send({type:"initiateSequentialFetch",coin:e});let r=this.pricingStateMachine.getState();this.pricingRequestId=r.type==="multiInterval"?r.requestId:null,this.fetchNextInterval()}fetchNextInterval(){let e=this.pricingStateMachine.getNextIntervalToFetch();if(!e||!this.sequentialPricingCoin)return;let r=this.pricingRequestId;if(r==null)return;let o=new Date().getTime(),{startTime:n,endTime:s,apiInterval:c}=this.getTimeFrameDetails(e,o);this.pricingStateMachine.send({type:"fetchingIntervalStart",interval:e,coin:this.sequentialPricingCoin,requestId:r,apiInterval:c,startTime:n,endTime:s}),this.client.getPriceHistory({coin:this.sequentialPricingCoin,interval:c,startTime:n,endTime:s,isTestnet:this.isTestnet}).then(p=>{let d=lh(p);this.pricingStateMachine.send({type:"fetchingIntervalSuccess",interval:e,coin:this.sequentialPricingCoin,requestId:r,candleSnapshots:d})}).catch(p=>{this.pricingStateMachine.send({type:"fetchingIntervalError",interval:e,coin:this.sequentialPricingCoin,requestId:r,error:p}),k.addBreadcrumb(v.Perps,"Error fetching next pricing interval",D.Error,{error:p instanceof Error?p.message:"Unknown error",coin:this.sequentialPricingCoin,interval:e,apiInterval:c,startTime:n,endTime:new Date(s).toISOString()})})}handlePricingStateChange(e){e.type==="multiInterval"&&!e.currentlyFetchingInterval&&!e.sequenceComplete&&setTimeout(()=>{this.fetchNextInterval()},100)}isEnablingDexAbstraction=!1;dexAbstractionRetryCount=0;isConsolidatingCollateral=!1;async enableDexAbstraction(e){if(e.type==="accountBalance"){if(e.accountBalance.dexAbstraction){this.dexAbstractionRetryCount=0;return}if(new x(e.accountBalance.accountValue).gt(0)&&!(this.dexAbstractionRetryCount>=5)&&this.user&&!this.isEnablingDexAbstraction){this.isEnablingDexAbstraction=!0,this.dexAbstractionRetryCount++;try{await this.setUserDexAbstraction({enabled:!0}),k.addBreadcrumb(v.Perps,"DEX abstraction enabled",D.Info),this.dexAbstractionRetryCount=0}catch(r){k.addBreadcrumb(v.Perps,"Failed to enable DEX abstraction",D.Error,{error:r instanceof Error?r.message:"Unknown error",retryAttempt:this.dexAbstractionRetryCount})}finally{this.isEnablingDexAbstraction=!1}}}}async autoConsolidateCollateral(e){if(!(e.type!=="accountBalance"||!(e.accountBalance.collateralBalances??[]).some(n=>n.pairIndex!==void 0&&new x(n.total).minus(n.hold).gt(.01)))&&!(!this.user||this.isConsolidatingCollateral))try{let n=await this.consolidateCollateralBalances();(n.swapped.length>0||n.transferred!=="0")&&k.addBreadcrumb(v.Perps,"Auto-consolidated collateral balances",D.Info,{swappedCount:n.swapped.length,transferred:n.transferred,errorsCount:n.errors.length})}catch(n){k.addBreadcrumb(v.Perps,"Failed to auto-consolidate collateral",D.Error,{error:n instanceof Error?n.message:"Unknown error"})}}subscribePricing(e){return this.pricingStateMachine.addListener(e),()=>{this.unsubscribePricing(e)}}unsubscribePricing(e){this.pricingStateMachine.removeListener(e)}async sign(e){let r=rn(this.signer),o=rn(this.account),{signature:n}=await r.sign(o.identifier,{chainType:se.EVM,signingType:"typedData",version:4,data:e});return{splitSignature:EC(n)}}async exchangeAction(e,r,o){let n=new Bn,s=rn(this.signer),c=rn(this.account),{signature:p}=await s.sign(c.identifier,{chainType:se.EVM,signingType:"typedData",version:4,data:r}),d=EC(p),m=await n.postExchange({action:e,nonce:o,signature:{r:d.r,s:d.s,v:d.v},isTestnet:this.isTestnet});if(m.status==="err")throw new Error(m.response);if(m.status==="ok")return m;throw new Error("Unknown response status")}async transfer(e){let{toPerp:r,amount:o}=e,n=Date.now(),s={type:"usdClassTransfer",hyperliquidChain:this.isTestnet?"Testnet":"Mainnet",signatureChainId:this.isTestnet?"0x66eee":"0xa4b1",amount:o.toString(),toPerp:r,nonce:n},c={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:UsdClassTransfer",types:{EIP712Domain:ot,"HyperliquidTransaction:UsdClassTransfer":[{name:"hyperliquidChain",type:"string"},{name:"amount",type:"string"},{name:"toPerp",type:"bool"},{name:"nonce",type:"uint64"}]},message:s},{splitSignature:p}=await this.sign(c),m=await new Bn().postExchange({action:s,nonce:n,signature:p,isTestnet:this.isTestnet});if(m.status==="err")throw new Error(m.response);return m}async sendAsset(e){let{destination:r,sourceDex:o,destinationDex:n,token:s,amount:c,vaultAddress:p}=e,d=Date.now(),m={type:"sendAsset",hyperliquidChain:this.isTestnet?"Testnet":"Mainnet",signatureChainId:this.isTestnet?"0x66eee":"0xa4b1",destination:r.toLowerCase(),sourceDex:o,destinationDex:n,token:s,amount:c.toString(),fromSubAccount:p?p.toLowerCase():"",nonce:d},f={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:SendAsset",types:{EIP712Domain:ot,"HyperliquidTransaction:SendAsset":[{name:"hyperliquidChain",type:"string"},{name:"destination",type:"string"},{name:"sourceDex",type:"string"},{name:"destinationDex",type:"string"},{name:"token",type:"string"},{name:"amount",type:"string"},{name:"fromSubAccount",type:"string"},{name:"nonce",type:"uint64"}]},message:m},{splitSignature:g}=await this.sign(f),y=await new Bn().postExchange({action:m,nonce:d,signature:g,isTestnet:this.isTestnet});if(y.status==="err")throw new Error(y.response);return y}async setUserDexAbstraction(e){let{enabled:r}=e;if(!this.user)throw new Error("User not set");let o=Date.now(),n={type:"userDexAbstraction",hyperliquidChain:this.isTestnet?"Testnet":"Mainnet",signatureChainId:this.isTestnet?"0x66eee":"0xa4b1",user:this.user.address,enabled:r,nonce:o},s={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:UserDexAbstraction",types:{EIP712Domain:ot,"HyperliquidTransaction:UserDexAbstraction":[{name:"hyperliquidChain",type:"string"},{name:"user",type:"address"},{name:"enabled",type:"bool"},{name:"nonce",type:"uint64"}]},message:n},{splitSignature:c}=await this.sign(s),d=await new Bn().postExchange({action:n,nonce:o,signature:c});if(d.status==="err")throw new Error(d.response);return d}async consolidateCollateralBalances(){if(!this.user)throw new Error("User not set");if(this.isConsolidatingCollateral)throw new Error("Collateral consolidation already in progress");this.isConsolidatingCollateral=!0;try{let e=await this.client.getAccountBalance(this.user),{swapped:r,errors:o}=await this.swapCollateralBalancesToUsdc(e.collateralBalances??[]),n=await this.transferSpotUsdcToPerp(r.length>0);return this.syncAccountBalance(),{swapped:r,transferred:n,errors:o}}finally{this.isConsolidatingCollateral=!1}}async swapCollateralBalancesToUsdc(e){let r=[],o=[];for(let n of e){if(n.pairIndex===void 0)continue;let s=new x(n.total).minus(n.hold);if(!s.lte(.01))try{let c=await this.spot.swapCollateralToUsdc(n.pairIndex,n.symbol,s);r.push(c),k.addBreadcrumb(v.Perps,"Swapped collateral to USDC",D.Info,{symbol:n.symbol,amount:s.toString(),usdcReceived:c.usdcReceived})}catch(c){let p=c instanceof Error?c.message:"Unknown error";o.push({symbol:n.symbol,error:p}),k.addBreadcrumb(v.Perps,"Failed to swap collateral to USDC",D.Error,{symbol:n.symbol,error:p})}}return{swapped:r,errors:o}}async transferSpotUsdcToPerp(e){if(!this.user)return"0";let r=e?10:1,o=await this.spot.pollForUsdcBalance(this.user.address,r);if(!o||o.lte(.01))return"0";let n=o.decimalPlaces(2,x.ROUND_DOWN);return await this.transfer({toPerp:!0,amount:n}),k.addBreadcrumb(v.Perps,"Transferred USDC from spot to perp",D.Info,{amount:n.toString()}),n.toString()}async usdSendPerps(e){let{destination:r,amount:o}=e,n=Date.now(),s=new lp({hyperliquidChain:this.isTestnet?"Testnet":"Mainnet",signatureChainId:this.isTestnet?"0x66eee":"0xa4b1",amount:o.toString(),destination:r.toLowerCase(),time:n}),c={domain:{name:"HyperliquidSignTransaction",version:"1",chainId:this.isTestnet?421614:42161,verifyingContract:"0x0000000000000000000000000000000000000000"},primaryType:"HyperliquidTransaction:UsdSend",types:{EIP712Domain:ot,"HyperliquidTransaction:UsdSend":[{name:"hyperliquidChain",type:"string"},{name:"destination",type:"string"},{name:"amount",type:"string"},{name:"time",type:"uint64"}]},message:s},{splitSignature:p}=await this.sign(c),d=await this.client.postPerpsSend({action:s,nonce:n,signature:p});if(d.status==="err")throw new Error(d.response);return d.response}openPosition(e){this.openPositionOrchestrator.send({type:"InitiateOpenPosition",payload:e})}resetOpenPosition(){this.openPositionOrchestrator.send({type:"Reset"})}getOpenPositionState(){return this.openPositionOrchestrator.getState()}subscribeOpenPosition(e){return this.openPositionOrchestrator.addListener(e),()=>{this.unsubscribeOpenPosition(e)}}unsubscribeOpenPosition(e){this.openPositionOrchestrator.removeListener(e)}warmOpenPositionLeverage(e){this.openPositionOrchestrator.warmLeverage(e)}managePosition(e){this.managePositionOrchestrator.send({type:"InitiateManagePosition",payload:e})}resetManagePosition(){this.managePositionOrchestrator.send({type:"Reset"})}getManagePositionState(){return this.managePositionOrchestrator.getState()}subscribeManagePosition(e){return this.managePositionOrchestrator.addListener(e),()=>{this.unsubscribeManagePosition(e)}}unsubscribeManagePosition(e){this.managePositionOrchestrator.removeListener(e)}manageMargin(e){this.manageMarginOrchestrator.send({type:"InitiateManageMargin",payload:e})}resetManageMargin(){this.manageMarginOrchestrator.send({type:"Reset"})}getManageMarginState(){return this.manageMarginOrchestrator.getState()}subscribeManageMargin(e){return this.manageMarginOrchestrator.addListener(e)}};function rn(t,e){if(t==null)throw new Error(e||"Required value is undefined or null");return t}i(rn,"check");function EC(t){let e=`0x${t.slice(2,66)}`,r=`0x${t.slice(66,130)}`,o=parseInt(t.slice(130,132),16);return{r:e,s:r,v:o}}i(EC,"splitSignature");u();l();var Ln=N(z());var Ne;(function(t){t.FUNDING_INITIALIZED="perpsDepositInitialized",t.FUNDING_INITIATED="perpsDepositInitiated",t.FUNDING_COMPLETED="perpsDepositCompleted",t.FUNDING_FAILED="perpsDepositFailed",t.FUNDING_PAUSED="perpsDepositPaused",t.FUNDING_RESUMED="perpsDepositResumed",t.DEPOSIT_TRANSFER_STARTED="perpsHyperunitDepositTransferStarted",t.DEPOSIT_TRANSFER_COMPLETED="perpsHyperunitDepositTransferCompleted",t.DEPOSIT_STREAM_OPERATIONS_STARTED="perpsHyperunitDepositStreamOperationsStarted",t.DEPOSIT_STREAM_OPERATIONS_COMPLETED="perpsHyperunitDepositStreamOperationsCompleted",t.DEPOSIT_SELL_SPOT_STARTED="perpsHyperunitDepositSellSpotStarted",t.DEPOSIT_SELL_SPOT_COMPLETED="perpsHyperunitDepositSellSpotCompleted",t.DEPOSIT_TRANSFER_TO_PERP_STARTED="perpsHyperunitDepositTransferToPerpStarted",t.DEPOSIT_TRANSFER_TO_PERP_COMPLETED="perpsHyperunitDepositTransferToPerpCompleted"})(Ne||(Ne={}));var Ue;(function(t){t.FUNDING_INITIALIZED="perpsWithdrawInitialized",t.FUNDING_COMPLETED="perpsWithdrawCompleted",t.FUNDING_FAILED="perpsWithdrawFailed",t.FUNDING_PAUSED="perpsWithdrawPaused",t.FUNDING_RESUMED="perpsWithdrawResumed",t.PERPS_TO_SPOT_STARTED="perpsHyperunitWithdrawPerpsToSpotStarted",t.PERPS_TO_SPOT_COMPLETED="perpsHyperunitWithdrawPerpsToSpotCompleted",t.BUY_ASSET_STARTED="perpsHyperunitWithdrawBuyAssetStarted",t.BUY_ASSET_COMPLETED="perpsHyperunitWithdrawBuyAssetCompleted",t.SEND_TO_WITHDRAW_ADDRESS_STARTED="perpsHyperunitWithdrawSendToWithdrawAddressStarted",t.SEND_TO_WITHDRAW_ADDRESS_COMPLETED="perpsHyperunitWithdrawSendToWithdrawAddressCompleted",t.WITHDRAW_STREAM_OPERATIONS_STARTED="perpsHyperunitWithdrawStreamOperationsStarted",t.WITHDRAW_STREAM_OPERATIONS_COMPLETED="perpsHyperunitWithdrawStreamOperationsCompleted"})(Ue||(Ue={}));var CC;(function(t){t.INITIALIZED="perpsFundingInitialized",t.INITIALIZATION_ERROR="perpsFundingInitializationError",t.BELOW_MINIMUM_INPUT_AMOUNT="perpsFundingBelowMinimumInputAmount",t.INSUFFICIENT_BALANCE="perpsFundingInsufficientBalance",t.EXCEEDS_MAXIMUM_LIMIT="perpsFundingExceedsMaximumLimit",t.FUNDABLE="perpsFundingFundable"})(CC||(CC={}));var kC=i(()=>{let t=ue(),e=(0,Ln.useCallback)((s,c)=>{t.capture(s,{data:{...c}}),s===Ne.FUNDING_FAILED&&k.captureError(new Error(`depositFailed: ${c.error}`),v.Perps),s===Ue.FUNDING_FAILED&&k.captureError(new Error(`withdrawalFailed: ${c.error}`),v.Perps)},[t]),r=(0,Ln.useCallback)((s,c)=>{e(s,c)},[e]),o=(0,Ln.useCallback)((s,c)=>{e(s,c)},[e]),n=(0,Ln.useCallback)((s,c)=>{e(s,c)},[e]);return(0,Ln.useMemo)(()=>({reportDeposit:r,reportWithdraw:o,reportFundingUIState:n}),[r,o,n])},"useFundingAnalytics");u();l();var Ep=class{static{i(this,"FundingStateLogsListener")}onFundingPoolStateChange(e,r,o){switch(e.type){case"fundingFailed":k.addBreadcrumb(v.Perps,`FundingPool: ${r.type} funding failed`,D.Error,{error:e.error.message,fundingTaskState:r.getState().type});break;case"fundingStarted":case"fundingBridgingStarted":case"fundingCompleted":k.addBreadcrumb(v.Perps,`FundingPool: ${r.type} ${e.type}`,D.Info);break}}};u();l();var Cp=class{static{i(this,"FundingToastListener")}onFundingPoolStateChange(e,r,o){switch(r.type){case"deposit":this.onDepositEvent(e,r);break;case"withdraw":this.onWithdrawEvent(e,r);break}}onDepositEvent(e,r){if(!r.silentToasts)switch(e.type){case"fundingStarted":this.progress(R.t("perpsToastInitiatingFunding"));break;case"fundingBridgingStarted":break;case"fundingCompleted":this.success(R.t("perpsToastFundsAdded"));break;case"fundingFailed":this.failed(R.t("perpsToastFundingFailed"),R.t("perpsFundingFailedDescription"),R.t("commandOK"),()=>{it.getState().hideToast()});break}}onWithdrawEvent(e,r){switch(e.type){case"fundingStarted":this.progress(R.t("perpsToastInitiatingWithdrawal"));break;case"fundingBridgingStarted":break;case"fundingCompleted":this.success(R.t("perpsToastWithdrawalComplete"));break;case"fundingFailed":this.failed(R.t("perpsToastWithdrawalFailed"),e.error.message,R.t("commandOK"),()=>{it.getState().hideToast()});break}}success(e){setTimeout(()=>{it.getState().success({message:e,onPress:i(()=>{it.getState().hideToast()},"onPress")})},100)}failed(e,r,o,n){setTimeout(()=>{it.getState().failed({title:e,message:r,buttonText:o,onPress:n})},100)}progress(e){setTimeout(()=>{it.getState().progress({message:e,onPress:i(()=>{it.getState().hideToast()},"onPress")})},100)}};u();l();u();l();u();l();u();l();u();l();u();l();u();l();var Da=class{static{i(this,"RelayBridge")}account;authRepository;cashAccount;signer;solanaConnection;storage;constructor(e){this.account=e.account,this.authRepository=e.authRepository,this.cashAccount=e.cashAccount,this.signer=e.signer,this.solanaConnection=e.solanaConnection,this.storage=e.storage}getSolanaAddress(){let e=this.account.addresses.find(r=>r.addressType===se.Solana);if(!e)throw new Error("No Solana address found for account");return e.address}isCash(e){return e?.resourceType!==V.address||!this.cashAccount?!1:this.cashAccount.addressDetails.address===e.address}getTakerAddress(e){return e?.resourceType===V.address&&this.isCash(e)?e.address:this.getSolanaAddress()}getEvmAddress(){let e=this.account.addresses.find(r=>r.addressType===se.EVM);if(!e)throw new Error("No EVM address found for account");return e.address}async fetchQuotes(e){let r=this.getTakerAddress(e.fromTokenOwner),o=Mr("kill-cash-perps-quote-chain-addresses"),n=this.getEvmAddress(),s=this.isCash(e.fromTokenOwner),c=this.account.addresses.reduce((d,m)=>({...d,[m.networkID]:m.address}),{}),p={sellToken:e.fromToken,buyToken:e.toToken,taker:{chainId:e.fromChain,address:r,resourceType:V.address},takerDestination:{chainId:e.toChain,address:n.toLowerCase(),resourceType:V.address},sellAmount:e.amount.toString(),slippageTolerance:(e.slippageBps??100)/100,phantomCashAccount:s,chainAddresses:o?void 0:c};k.addBreadcrumb(v.Perps,"Fetching Relay quotes",D.Info,{sellAmount:p.sellAmount,sellToken:L(p.sellToken),buyToken:L(p.buyToken),fromChain:p.sellToken.chainId,toChain:p.buyToken.chainId});try{let d=await G.api().retry(1,Je(1e3,1e3)).post("/swap/v2/quotes",p);if(d.status!==200)throw new Error(`Failed to fetch quotes: ${d.status}`);let m=d.data;return k.addBreadcrumb(v.Perps,"Relay quotes fetched",D.Info,{quotesCount:m.quotes.length,firstQuoteBuyAmount:m.quotes[0]?.buyAmount}),m.quotes}catch(d){throw k.addBreadcrumb(v.Perps,"Failed to fetch Relay quotes",D.Error,{error:d instanceof Error?d.message:"Unknown error"}),d}}async executeSwap(e,r,o=Ot.Mainnet){let n=this.getTakerAddress(r),s=this.isCash(r),c=await FM(n,e,this.solanaConnection);try{k.addBreadcrumb(v.Perps,"Executing Relay swap",D.Info,{buyAmount:e.buyAmount,sellAmount:e.sellAmount});let p=Oe(),d=await this.authRepository?.getUser();if(!d)throw new Error("User not found for swap");let{accessToken:m,userID:f}=d,g;return s?g=await Yi({unsignedTransaction:wg(c),vaultProxy:this.signer,accountIdentifier:this.account.identifier,signerAddress:n,idempotencyKey:p,isCash:!0,accessToken:m,userID:f,skipActivityRecording:!1,swapInfo:void 0,perpsInfo:{type:"funding"},waitForActivityState:Qe.Completed}):(g=await ts({accountIdentifier:this.account.identifier,accountSigner:this.signer,transaction:c,feePayer:new pe.PublicKey(n),connection:this.solanaConnection,storage:this.storage,pendingTransactionInput:{ownerAddress:n,networkID:o,data:{signature:""},type:dt.DappInteraction,display:{summary:{topLeft:{text:"Deposit"}}}}}),await Uo({connection:this.solanaConnection,signature:g})),k.addBreadcrumb(v.Perps,"Relay swap transaction sent",D.Info,{signature:g}),g}catch(p){throw k.addBreadcrumb(v.Perps,"Failed to send Relay swap transaction",D.Error,{error:p instanceof Error?p.message:"Unknown error"}),p}}};async function FM(t,e,r){let o=It(e.steps[0]?.transactionData,"bs58");o=await es(o,{connection:r});let n=new pe.PublicKey(t);return await ja(o,r),bg(o,n),o}i(FM,"transactionFromQuote");u();l();var PM=a.object({status:a.enum(["waiting","success","failure","refund","delayed","pending"]),requestId:a.string().optional()}),Mn=class{static{i(this,"RelayBridgeStatusPoller")}pollInterval=null;listeners=new Set;POLL_INTERVAL_MS=1e3;MAX_POLL_ATTEMPTS=45;pollAttempts=0;subscribe(e){this.listeners.add(e)}unsubscribe(e){this.listeners.delete(e)}startPolling(e){this.pollAttempts=0,this.poll(e)}stopPolling(){this.pollInterval&&(clearTimeout(this.pollInterval),this.pollInterval=null)}async poll(e){this.pollAttempts++;try{let r=await this.fetchBridgeStatus(e);if(this.listeners.forEach(o=>o.onStatusUpdate(r)),r.status==="success"){k.addBreadcrumb(v.Perps,`Relay bridge completed for request: ${e}`,D.Info,{requestId:e}),this.listeners.forEach(o=>o.onCompleted(r)),this.stopPolling();return}if(r.status==="failure"||r.status==="refund"){let o=new Error(`Relay bridge failed with status: ${r.status} for request: ${e}`);k.addBreadcrumb(v.Perps,"Relay bridge failed",D.Error,{requestId:e,status:r.status}),this.listeners.forEach(n=>n.onError(o)),this.stopPolling();return}if(r.status!=="waiting"&&r.status!=="pending"&&r.status!=="delayed"){let o=new Error(`Unexpected Relay bridge status: ${r.status} for request: ${e}`);k.addBreadcrumb(v.Perps,"Relay bridge unexpected status",D.Error,{requestId:e,status:r.status}),this.listeners.forEach(n=>n.onError(o)),this.stopPolling();return}if(this.pollAttempts>=this.MAX_POLL_ATTEMPTS){let o=new Error(`Relay bridge status polling timed out with status: ${r.status} for request: ${e}`);k.addBreadcrumb(v.Perps,"Relay bridge polling timeout",D.Error,{requestId:e,finalStatus:r.status,attempts:this.pollAttempts}),this.listeners.forEach(n=>n.onError(o)),this.stopPolling();return}this.pollInterval=setTimeout(()=>{this.poll(e)},this.POLL_INTERVAL_MS)}catch(r){k.addBreadcrumb(v.Perps,`Error polling Relay bridge status for request: ${e}`,D.Error,{error:r instanceof Error?r.message:"Unknown error",requestId:e,attempts:this.pollAttempts}),this.listeners.forEach(o=>o.onError(r)),this.stopPolling()}}async fetchBridgeStatus(e){let r=await G.api().retry(1,Je(1e3,1e3)).get("/swap/v2/spot/get-intents-status",{params:{requestId:e}});if(!J(r))throw new Error("Failed to get bridge status: response is not okay");let o=r.data,n=PM.safeParse(o);if(!n.success)throw new Error("Failed to get bridge status: schema validation failed");return n.data}};u();l();var br=class{static{i(this,"FundingTask")}startedAt;type;minimumUiAmount;amount;amountUsd;estimatedTime;fee;withdrawAddress;withdrawAddressRole;state={type:"indeterminate"};listeners=new Set;constructor(e,r,o,n,s,c){this.startedAt=Date.now(),this.type=e,this.minimumUiAmount=r,this.estimatedTime=o,this.fee=n,this.withdrawAddress=s,this.withdrawAddressRole=c}getState(){return this.state}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}notify(e,r){this.listeners.forEach(o=>o.onFundingTaskStateChange(this,e,r))}getWithdrawAddressAndRole(){return{withdrawAddress:this.withdrawAddress,withdrawAddressRole:this.withdrawAddressRole}}};var IC=250,vM=.05,Ba=class t extends br{static{i(this,"RelayBridgeTask")}perps;account;authRepository;cashAccount;signer;storage;fromToken;fromTokenOwner;fromTokenDecimals;toToken;toTokenDecimals;fromChain;toChain;relayBridge;connection;bridgeListeners=new Set;quote;isFetchingQuote=!1;statusPoller;analytics;depositId;constructor(e,r,o,n,s,c,p,d,m,f,g,w,y,S,b,T,A){super("deposit",e,"",r),this.perps=o,this.account=n,this.authRepository=s,this.cashAccount=c,this.signer=p,this.storage=d,this.fromToken=m,this.fromTokenOwner=f,this.fromTokenDecimals=g,this.toToken=w,this.toTokenDecimals=y,this.fromChain=S,this.toChain=b,this.analytics=T,this.depositId=A||Oe(),this.connection=Mo(Ot.Mainnet),this.relayBridge=new Da({account:n,authRepository:s,cashAccount:c,signer:p,solanaConnection:this.connection,storage:d}),this.statusPoller=new Mn,this.reportAnalytics(Ne.FUNDING_INITIALIZED,{})}reportAnalytics(e,r){let o={fundingType:"deposit",fundingRoute:Sr.Relay,amount:this.amount,amountUsd:this.amountUsd,fee:this.fee.toString(),estimatedTime:this.estimatedTime,fromToken:L(this.fromToken),toToken:L(this.toToken),fromChain:this.fromChain,toChain:this.toChain,depositId:this.depositId};this.analytics.reportDeposit(e,{...o,...r})}addBridgeListener(e){this.bridgeListeners.add(e)}removeBridgeListener(e){this.bridgeListeners.delete(e)}notifyBridgeListeners(e,...r){this.bridgeListeners.forEach(o=>{let n=o[e];typeof n=="function"&&n.call(o,...r)})}async fetchQuote(e,r){this.isFetchingQuote=!0;try{let o=e.shiftedBy(this.fromTokenDecimals),n=await this.relayBridge.fetchQuotes({amount:o.toNumber(),fromToken:this.fromToken,fromTokenOwner:this.fromTokenOwner,toToken:this.toToken,fromChain:this.fromChain,toChain:this.toChain,slippageBps:IC});return n.length===0?(this.isFetchingQuote=!1,null):(this.quote=n[0],this.fee=new x(this.quote.steps[0]?.feeCosts?.[0]?.value??vM),k.addBreadcrumb(v.Perps,"Relay quote fetched",D.Info,{inputAmount:e.toString(),tokenPrice:r.toString(),inputUsd:e.toString(),outputUsd:e.toString(),feeUsd:this.fee.toString(),buyAmount:this.quote.buyAmount,sellAmount:this.quote.sellAmount,fromTokenDecimals:this.fromTokenDecimals,toTokenDecimals:this.toTokenDecimals}),this.notifyBridgeListeners("onQuoteFetched",this.quote),this.quote)}catch(o){return k.addBreadcrumb(v.Perps,"Failed to fetch Relay quote",D.Info,{error:o instanceof Error?o.message:"Unknown error"}),this.isFetchingQuote=!1,null}finally{this.isFetchingQuote=!1}}async execute(e,r,o){this.startedAt=Date.now(),this.amount=o,this.amountUsd=r,this.state={type:"executing",task:this},this.notify({type:"fundingStarted"},this.state),this.reportAnalytics(Ne.FUNDING_INITIATED,{});try{k.addBreadcrumb(v.Perps,"Fetching Relay bridge quotes",D.Info,{amount:o,fromChain:this.fromChain,toChain:this.toChain});let n=new x(o).shiftedBy(this.fromTokenDecimals),s=await this.relayBridge.fetchQuotes({amount:n.toNumber(),fromToken:this.fromToken,fromTokenOwner:this.fromTokenOwner,toToken:this.toToken,fromChain:this.fromChain,toChain:this.toChain,slippageBps:IC});if(s.length===0)throw k.addBreadcrumb(v.Perps,"No quotes available for Relay bridge",D.Error),new Error("No quotes available for bridge");this.quote=s[0],this.notifyBridgeListeners("onQuoteFetched",this.quote),this.notify({type:"fundingBridgingStarted"},this.state),this.notifyBridgeListeners("onBridgeStarted"),k.addBreadcrumb(v.Perps,"Executing Relay bridge swap",D.Info,{buyAmount:this.quote.buyAmount,sellAmount:this.quote.sellAmount});let c=await this.relayBridge.executeSwap(this.quote,this.fromTokenOwner);k.addBreadcrumb(v.Perps,"Relay bridge transaction submitted",D.Info,{txHash:c}),this.notifyBridgeListeners("onBridgeCompleted",c);let p=this.quote.steps[0].id;if(!p)throw k.addBreadcrumb(v.Perps,"No request ID found in Relay quote",D.Error),new Error("No request ID found in Relay quote");this.startPollingForCompletion(p)}catch(n){let s=n;this.state={type:"failed",error:s},this.notify({type:"fundingFailed",error:s},this.state),this.notifyBridgeListeners("onBridgeFailed",s),k.addBreadcrumb(v.Perps,`Relay bridge failed: ${s.message}`,D.Error),this.reportAnalytics(Ne.FUNDING_FAILED,{error:JSON.stringify(s)})}}pause(){this.statusPoller.stopPolling(),k.addBreadcrumb(v.Perps,"Relay bridge pause requested - stopped polling",D.Info),this.reportAnalytics(Ne.FUNDING_PAUSED,{})}resume(){k.addBreadcrumb(v.Perps,"Relay bridge resume requested (no-op)",D.Info),this.reportAnalytics(Ne.FUNDING_RESUMED,{})}getFee(){return this.fee}startPollingForCompletion(e){let r={onStatusUpdate:i(o=>{k.addBreadcrumb(v.Perps,"Relay bridge status update",D.Info,{requestId:e,status:o.status})},"onStatusUpdate"),onCompleted:i(o=>{this.state={type:"completed"},this.notify({type:"fundingCompleted"},this.state),k.addBreadcrumb(v.Perps,"Relay bridge funds received",D.Info,{requestId:e}),this.reportAnalytics(Ne.FUNDING_COMPLETED,{}),this.perps.syncAccountBalance(),this.perps.syncFundingHistory(),this.statusPoller.unsubscribe(r)},"onCompleted"),onError:i(o=>{k.addBreadcrumb(v.Perps,"Relay bridge polling error",D.Error,{error:o.message,requestId:e}),this.statusPoller.unsubscribe(r),this.reportAnalytics(Ne.FUNDING_FAILED,{error:JSON.stringify(o)})},"onError")};this.statusPoller.subscribe(r),this.statusPoller.startPolling(e)}static create({minimumUiAmount:e,fee:r,perps:o,account:n,authRepository:s,cashAccount:c,signer:p,storage:d,fromToken:m,fromTokenOwner:f,fromTokenDecimals:g,toToken:w,toTokenDecimals:y,fromChain:S,toChain:b,analytics:T,depositId:A}){return new t(e,r,o,n,s,c,p,d,m,f,g,w,y,S,b,T,A)}};u();l();var Na=class extends br{static{i(this,"RelayWithdrawTask")}withdrawNetworkId;toTokenDecimals;perps;analytics;statusPoller;requestId;toTokenCaip19;constructor(e,r,o,n,s,c,p,d,m){super("withdraw",n,s,c,d,"user"),this.withdrawNetworkId=e,this.toTokenDecimals=r,this.perps=o,this.analytics=p,this.toTokenCaip19=m,this.statusPoller=new Mn,this.reportAnalytics(Ue.FUNDING_INITIALIZED,{provider:Sr.Relay})}reportAnalytics(e,r){let o={fundingType:"withdraw",fundingRoute:Sr.Relay,amount:this.amount,amountUsd:this.amountUsd,withdrawAddress:this.withdrawAddress??"",withdrawNetworkId:this.withdrawNetworkId,minimumUiAmount:this.minimumUiAmount.toString(),estimatedTime:this.estimatedTime,fee:this.fee.toString()};this.analytics.reportWithdraw(e,{...o,...r})}pause(){this.statusPoller.stopPolling(),k.addBreadcrumb(v.Perps,"Relay withdrawal pause requested - stopped polling",D.Info),this.reportAnalytics(Ue.FUNDING_PAUSED,{})}resume(){k.addBreadcrumb(v.Perps,"Relay withdrawal resume requested (no-op)",D.Info),this.reportAnalytics(Ue.FUNDING_RESUMED,{})}async execute(e,r,o,n){this.amount=o,this.amountUsd=r,this.state={type:"executing",task:this},this.notify({type:"fundingStarted"},this.state);try{if(k.addBreadcrumb(v.Perps,"Starting relay withdrawal",D.Info,{amount:o,amountUsd:r,withdrawAddress:this.withdrawAddress??""}),this.reportAnalytics(Ue.FUNDING_INITIALIZED,{}),!this.perps.user)throw new Error("No perps user available");let s=L(this.toTokenCaip19),c=e.shiftedBy(this.toTokenDecimals??8).toFixed(0),p=L({chainId:this.withdrawNetworkId,resourceType:V.address,address:this.withdrawAddress??""});k.addBreadcrumb(v.Perps,"Initializing relay bridge for withdrawal",D.Info,{sellAmount:c,buyToken:s,takerDestination:p});let d=await this.perps.client.getSpotBridgeInitialize({buyToken:s,sellAmount:c,takerDestination:p,bridgeProvider:Sr.Relay});this.requestId=d.requestId;let m=d.depositAddress.address;k.addBreadcrumb(v.Perps,"Relay bridge initialized",D.Info,{requestId:this.requestId,depositAddress:m}),this.notify({type:"fundingBridgingStarted",estimateTime:this.estimatedTime},this.state),k.addBreadcrumb(v.Perps,"Sending USDC from perps to relay deposit address",D.Info,{depositAddress:m,amount:e.toString()}),this.reportAnalytics(Ue.SEND_TO_WITHDRAW_ADDRESS_STARTED,{depositAddress:m,requestId:this.requestId}),await this.perps.usdSendPerps({destination:m,amount:e}),this.perps.syncAccountBalance(),this.perps.syncFundingHistory(),k.addBreadcrumb(v.Perps,"Sent USDC from perps to relay deposit address",D.Info,{depositAddress:m,amount:e.toString()}),this.reportAnalytics(Ue.SEND_TO_WITHDRAW_ADDRESS_COMPLETED,{depositAddress:m}),this.startPollingForCompletion(this.requestId)}catch(s){let c=s instanceof Error?s:new Error("Unknown error");k.addBreadcrumb(v.Perps,"Relay withdrawal failed",D.Error,{error:c.message}),this.state={type:"failed",error:c},this.notify({type:"fundingFailed",error:c},this.state),this.reportAnalytics(Ue.FUNDING_FAILED,{error:c.message})}}startPollingForCompletion(e){let r={onStatusUpdate:i(o=>{k.addBreadcrumb(v.Perps,"Relay withdrawal status update",D.Info,{requestId:e,status:o.status})},"onStatusUpdate"),onCompleted:i(o=>{this.state={type:"completed"},this.notify({type:"fundingCompleted"},this.state),k.addBreadcrumb(v.Perps,"Relay withdrawal completed",D.Info,{requestId:e}),this.reportAnalytics(Ue.FUNDING_COMPLETED,{requestId:e}),this.perps.syncAccountBalance(),this.perps.syncFundingHistory(),this.statusPoller.unsubscribe(r)},"onCompleted"),onError:i(o=>{k.addBreadcrumb(v.Perps,"Relay withdrawal polling error",D.Error,{error:o.message,requestId:e}),this.statusPoller.unsubscribe(r),this.reportAnalytics(Ue.FUNDING_FAILED,{error:JSON.stringify(o)})},"onError")};this.statusPoller.subscribe(r),this.statusPoller.startPolling(e)}};u();l();var FC=5,_M={chainId:Ei.Mainnet,address:"0x00000000000000000000000000000000",resourceType:V.address},RM=8,kp=class{static{i(this,"RelayBridgeFundingTaskFactory")}analytics;constructor(e){this.analytics=e}async createWithdrawTask(e,r,o){let n=r.addresses.find(d=>d.networkID===o);if(!n)throw new Error("Couldn't find destination account address for network: "+o);let s=n.address,c={chainId:o,resourceType:V.nativeToken,slip44:C.getSlip44(o)},p=new x(FC);return new Na(o,RM,e,p,"5 seconds",new x(0),this.analytics,s,c)}async fetchTokenInfo(e,r,o,n,s){let c=e.addresses.find(w=>w.networkID===o);if(!c)throw new Error("Couldn't find result address for network: "+o);let p=new fo,d={type:"swap",network:o,sellCaip19:L(n),buyCaip19:"solana:101/nativeToken:501",takerCaip19:s?L(s):void 0,takerDestinationCaip19:void 0},m=Hi(r),f=await p.initialize(d,[c],m);if(!f.sellTokenPrice?.usd)throw new Error("No price available for token");let g=f.sellToken;return{priceUsd:new x(f.sellTokenPrice.usd),decimals:g.data.decimals}}async createTask(e,r,o,n,s,c,p,d){if(d.type==="withdraw")return this.createWithdrawTask(e,r,d.withdrawNetworkId);let{depositTokenCaip19:m,depositTokenWalletCaip19:f}=d,{priceUsd:g,decimals:w}=await this.fetchTokenInfo(r,n,m.chainId,m,f),y=new x(FC).dividedBy(g);return Ba.create({minimumUiAmount:y,estimatedTime:"5 seconds",fee:new x(0),perps:e,account:r,authRepository:o,cashAccount:n,signer:c,storage:s,fromToken:m,fromTokenOwner:f,fromTokenDecimals:w,toToken:_M,toTokenDecimals:18,fromChain:Ot.Mainnet,toChain:Ei.Mainnet,analytics:this.analytics,depositId:d.depositId})}};u();l();var H1e=new x(5);var DM=10,yh=class{static{i(this,"WarmFundingCache")}entries=new Map;refreshes=new Map;get(e,r){return this.entries.get(gh(e,r))}set(e,r,o){let n=gh(e,r);if(this.entries.set(n,o),this.entries.size>DM){let s=Array.from(this.entries.keys())[0];this.entries.delete(s)}}delete(e,r){this.entries.delete(gh(e,r))}keys(){return Array.from(this.entries.keys())}getByKey(e){return this.entries.get(e)}setRefresh(e,r){this.refreshes.set(e,r),r.finally(()=>this.refreshes.delete(e))}hasRefresh(e){return this.refreshes.has(e)}},hh=new yh;function gh(t,e){let o={account:[...e.account.addresses].map(n=>`${n.networkID}:${n.address}`.toLowerCase()).sort().join("|")};return t.type==="deposit"?JSON.stringify({...o,type:"deposit",depositTokenCaip19:t.depositTokenCaip19,depositTokenWalletCaip19:t.depositTokenWalletCaip19,depositId:t.depositId}):JSON.stringify({...o,type:"withdraw",withdrawNetworkId:t.withdrawNetworkId})}i(gh,"getFundingCacheKey");function PC(t){let e=BM(t.account);for(let r of hh.keys())if(r.includes(`"account":"${e}"`)){let o=hh.getByKey(r);if(o){let n={...t};hh.delete(o.params,n)}}}i(PC,"invalidateAllForAccount");function BM(t){return[...t.addresses].map(e=>`${e.networkID}:${e.address}`.toLowerCase()).sort().join("|")}i(BM,"accountFingerprint");var Ip=class{static{i(this,"FundingWarmCacheListener")}getContext;constructor(e){this.getContext=e}onFundingPoolStateChange(e,r,o){if(e.type!=="fundingCompleted")return;let n=this.getContext();n&&PC(n)}};u();l();var vC="failedFundingEvents";var Fp=class{static{i(this,"FailedFundingEventsCache")}storage;listeners=[];storageKey;accountId;constructor(e,r){this.storage=e,this.accountId=r,this.storageKey=this.generateStorageKey()}async setAccountId(e){if(this.accountId===e)return;this.accountId=e,this.storageKey=this.generateStorageKey();let r=await this.getEvents();this.notifyListeners(r)}generateStorageKey(){return this.accountId?`${vC}_${this.accountId}`:vC}async addEvent(e){let r=await this.getEvents(),o={id:`${e.type}_${e.startedAt}_${e.amountUsd}`,type:e.type,amountUsd:e.amountUsd||"0",timestamp:Date.now(),startedAt:e.startedAt,errorMessage:e.getState().type==="failed"?e.getState().error?.message:void 0};r.some(s=>s.id===o.id)||(r.unshift(o),r.length>25&&r.splice(25),await this.storage.set(this.storageKey,r),this.notifyListeners(r))}async getEvents(){let e=await this.storage.get(this.storageKey);return Array.isArray(e)?e:[]}async clear(){await this.storage.remove(this.storageKey),this.notifyListeners([])}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}notifyListeners(e){for(let r of this.listeners)r.onFailedEventsChange(e)}};u();l();var Pp=class{static{i(this,"FundingPool")}activeTasks=new Set;listeners=new Set;failedEventsCache;constructor(e){this.failedEventsCache=e}setFailedEventsCache(e){this.failedEventsCache=e}async setAccountId(e){await this.failedEventsCache?.setAccountId(e)}submit(e,r,o,n,s){e.addListener(this.taskListener),this.activeTasks.add(e),e.execute(r,o,n,s)}getActiveTasks(){return Array.from(this.activeTasks)}getFailedEventsCache(){return this.failedEventsCache}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}pauseTasks(){this.activeTasks.forEach(e=>e.pause())}resumeTasks(){this.activeTasks.forEach(e=>e.resume())}taskListener={onFundingTaskStateChange:i((e,r,o)=>{switch(r.type){case"fundingStarted":break;case"fundingCompleted":this.activeTasks.delete(e),e.removeListener(this.taskListener);break;case"fundingFailed":e.removeListener(this.taskListener),this.failedEventsCache?.addEvent(e);break}this.listeners.forEach(n=>n.onFundingPoolStateChange(r,e,this.getActiveTasks()))},"onFundingTaskStateChange")}};u();l();u();l();u();l();u();l();var NM="perps_deposit_step";var vp=class{static{i(this,"DepositStepCache")}storage;listeners=[];userAddress=null;constructor(e){this.storage=e}setUserAddress(e){this.userAddress=e}getKey(){if(!this.userAddress)throw new Error("User address not set");return`${NM}_${this.userAddress}`}set(e,r){(async()=>{let o={step:e,startedAt:r||Date.now()};await this.storage.set(this.getKey(),o),this.notifyListeners(o)})()}clear(){(async()=>(await this.storage.remove(this.getKey()),this.notifyListeners(null)))()}async get(){if(!this.userAddress)return null;let e=await this.storage.get(this.getKey());if(!e)return null;let r=e;return Date.now()-r.startedAt>12e5?(this.clear(),null):r}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}notifyListeners(e){for(let r of this.listeners)r.onDepositStepChange(e)}};u();l();function _C(t){return t.type==="idle"?"idle":t.type==="streamOperations"?`${t.sourceTxHash}:${t.depositAddress}`:`${t.type}:${t.depositAddress}`}i(_C,"getDepositId");var wh=null;function LM(t){return wh||(wh=new vp(t)),wh}i(LM,"getDepositStepCache");var _p=class{static{i(this,"DepositRecoverer")}perps;cache;analytics;constructor(e,r,o){this.perps=e,this.cache=LM(r),this.perps.user&&this.cache.setUserAddress(L(this.perps.user)),this.analytics=o}async getStuckDeposit(){this.perps.user&&this.cache.setUserAddress(L(this.perps.user));let e=await this.cache.get();return e?.step.type==="transfer"?(this.cache.clear(),null):e}async retry(e){if(e.type!=="streamOperations"){this.cache.clear();return}let r=_C(e);try{let o=await this.pollForOperationCompletion(e);if(!o.destinationAmount)throw this.cache.clear(),new Error("Operation has no destination amount");let{destinationAmount:n}=o,s=await this.perps.spot.getTokenMidPrice(e.spotTokenId),{totalSz:c,avgPx:p}=await this.sellSpotAsset(new x(n),e.assetId,s,e.tokenDecimals,r);await this.transferToPerps(c,p,r),this.perps.syncAccountBalance(),this.perps.syncFundingHistory(),this.cache.clear()}catch{this.cache.clear();return}}async pollForOperationCompletion(e){let n=!1;for(let s=0;s<15;s++){let c=await this.perps.client.getOperations({taker:L(this.perps.user)}),p=`${e.sourceTxHash}:${e.depositAddress}`,d=c.operations.find(m=>m.sourceTxHash===p);if(d){if(n=!0,d.state==="failure")throw new Error("Operation failed");if(d.state==="done")return d}s<14&&await new Promise(m=>setTimeout(m,5e3))}throw n?new Error("Operation not done after maximum attempts"):new Error("Operation not found")}async sellSpotAsset(e,r,o,n,s){let c=e.shiftedBy(-n).decimalPlaces(3,x.ROUND_DOWN),p=await this.perps.spot.sell(r,c.toString(),o);return this.analytics.reportDeposit(Ne.DEPOSIT_SELL_SPOT_COMPLETED,{depositId:s,assetId:r,assetLimitPriceUsd:o,tokenDecimals:n,adjustedDepositedAmount:c}),{totalSz:new x(p.totalSz),avgPx:new x(p.avgPx)}}async transferToPerps(e,r,o){let n=e.multipliedBy(r).decimalPlaces(2,x.ROUND_DOWN).multipliedBy(.999);return await this.perps.transfer({toPerp:!0,amount:n}),this.analytics.reportDeposit(Ne.DEPOSIT_TRANSFER_TO_PERP_COMPLETED,{depositId:o,totalSz:e,avgPx:r,transferUsdcAmount:n}),n}};u();l();var Rp=class{static{i(this,"HyperunitDepositStateMachine")}step={type:"idle"};listeners=[];setStep(e){this.step=e}completeStep(e){let r=this.step,o=this.detectNextStep(e);if(!o){this.listeners.forEach(n=>n.onStepCompleted(this.step,void 0)),this.listeners.forEach(n=>n.onDepositCompleted());return}this.step=o,this.listeners.forEach(n=>n.onStepCompleted(r,o))}detectNextStep(e){switch(e.stepType){case"idle":return{type:"transfer",depositAddress:e.depositAddress,depositAmount:e.amount};case"transfer":if(this.step.type!=="transfer")throw new Error("Invalid step: expected transfer, got "+this.step.type);return{...this.step,type:"streamOperations",senderAddress:e.senderAddress,networkId:e.networkId,tokenDecimals:e.tokenDecimals,sourceTxHash:e.txHash,assetId:e.assetId,spotTokenId:e.spotTokenId,assetLimitPriceUsd:e.assetLimitPriceUsd};case"streamOperations":if(this.step.type!=="streamOperations")throw new Error("Invalid step: expected streamOperations, got "+this.step.type);return{...this.step,type:"sellSpotAsset",destinationAmount:e.destinationAmount};case"sellSpotAsset":if(this.step.type!=="sellSpotAsset")throw new Error("Invalid step: expected sellSpotAsset, got "+this.step.type);return{...this.step,type:"transferToPerps",totalSz:e.totalSz,avgPx:e.avgPx};case"transferToPerps":if(this.step.type!=="transferToPerps")throw new Error("Invalid step: expected transferToPerps, got "+this.step.type);return}}failStep(e){this.listeners.forEach(r=>r.onDepositFailed(this.step,e))}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}getStep(){return this.step}};u();l();var Sh=class{static{i(this,"SolanaDepositTransfer")}sourceAddress;networkId;account;constructor(e,r,o){this.sourceAddress=e,this.networkId=r,this.account=o}async execute(e,r,o,n){let s=Mo(this.networkId),c=new pe.Transaction().add(pe.SystemProgram.transfer({fromPubkey:new pe.PublicKey(this.sourceAddress),toPubkey:new pe.PublicKey(r),lamports:e.toNumber()}));c=await es(c,{connection:s}),c.feePayer=new pe.PublicKey(this.sourceAddress),await Sg(c,s);let p=await ts({accountIdentifier:this.account.identifier,feePayer:new pe.PublicKey(this.sourceAddress),connection:s,accountSigner:n,transaction:c,pendingTransactionInput:{ownerAddress:this.sourceAddress,networkID:this.networkId,data:{signature:""},type:dt.DappInteraction,display:{summary:{topLeft:{text:"Deposit"}}}},storage:o});return await Uo({connection:s,signature:p}),{senderAddress:this.sourceAddress,networkId:this.networkId,tokenDecimals:9,txHash:p}}},Dp=class{static{i(this,"DepositTransferFactory")}create(e,r){let o=e.chainId,n=r.addresses.find(s=>s.networkID===o)?.address;if(!n)throw new Error(`No source address found for networkID: ${o}`);if(C.isSolanaNetworkID(o))return new Sh(n,o,r);throw new Error(`Unsupported chain for deposit transfer: ${o}`)}};u();l();function bh(t){switch(t.type){case"transfer":return{depositAddress:t.depositAddress,amount:t.depositAmount.toString()};case"streamOperations":return{depositAddress:t.depositAddress,amount:t.depositAmount.toString(),networkId:t.networkId,sourceTxHash:t.sourceTxHash};case"sellSpotAsset":return{depositAddress:t.depositAddress,amount:t.depositAmount.toString(),networkId:t.networkId,sourceTxHash:t.sourceTxHash,destinationAmount:t.destinationAmount.toString()};case"transferToPerps":return{depositAddress:t.depositAddress,amount:t.depositAmount.toString(),networkId:t.networkId,sourceTxHash:t.sourceTxHash,destinationAmount:t.destinationAmount.toString(),totalSz:t.totalSz.toString(),avgPx:t.avgPx.toString()};default:return{step:t.type}}}i(bh,"getDepositStepLogsDetails");var Th=i(t=>{switch(t.type){case"perpsToSpot":case"buyAsset":return{assetId:t.assetId.toString(),withdrawAddress:t.withdrawAddress,withdrawAmountUsd:t.withdrawAmountUsd.toString()};case"sendToWithdrawAddress":return{assetId:t.assetId.toString(),withdrawAddress:t.withdrawAddress,withdrawAmountUsd:t.withdrawAmountUsd.toString(),assetMidPrice:t.assetMidPrice.toString(),filledAmount:t.filledAmount.toString()};case"streamOperations":return{assetId:t.assetId.toString(),withdrawAddress:t.withdrawAddress,withdrawAmountUsd:t.withdrawAmountUsd.toString(),sendToWithdrawAmount:t.sendToWithdrawAmount.toString(),operationStartTime:t.operationStartTime.toISOString()};default:return{step:t.type}}},"getWithdrawStepLogsDetails");u();l();var ui=class{static{i(this,"OperationsStreamer")}perpsClient;streamOpen=!1;listeners=[];interval=2e3;constructor(e){this.perpsClient=e}startStream(e,r,o){this.streamOpen=!0,this.stream(L(e),r,o)}startWithdrawStream(e,r,o){this.streamOpen=!0,this.streamWithdraw(L(e),r,o)}stream(e,r,o){this.streamOpen&&(async()=>{try{let n=await this.perpsClient.getOperations({taker:e}),s=`${r}:${o}`,c=n.operations.find(p=>p.sourceTxHash===s);this.listeners.forEach(p=>{p.onOperation(n,c)}),this.streamOpen&&setTimeout(()=>this.stream(e,r,o),this.interval)}catch(n){this.listeners.forEach(s=>{s.onError(n)}),this.stopStream()}})()}streamWithdraw(e,r,o){this.streamOpen&&(async()=>{try{let n=await this.perpsClient.getOperations({taker:e}),s=this.findMatchingWithdrawOperation(n.operations,r,o);this.listeners.forEach(c=>{c.onOperation(n,s)}),this.streamOpen&&setTimeout(()=>this.streamWithdraw(e,r,o),this.interval)}catch(n){this.listeners.forEach(s=>{s.onError(n)}),this.stopStream()}})()}findMatchingWithdrawOperation(e,r,o){let n=e.filter(s=>{if(s.sourceChain!=="hyperliquid"||s.destinationChain!=="solana"||!s.opCreatedAt)return!1;let c=new Date(s.opCreatedAt).getTime(),p=Math.abs(c-r.getTime()),d=4*60*1e3;if(p>d)return!1;if(s.sourceAmount){let m=new x(s.sourceAmount).dividedBy(10**xn.data.decimals),f=o,g=m.minus(f).abs(),w=f.multipliedBy(.1);if(g.isGreaterThan(w))return!1}return!0});if(n.length!==0)return n.sort((s,c)=>new Date(c.opCreatedAt).getTime()-new Date(s.opCreatedAt).getTime())[0]}stopStream(){this.streamOpen=!1}subscribe(e){return this.listeners.push(e),()=>this.unsubscribe(e)}unsubscribe(e){this.listeners=this.listeners.filter(r=>r!==e)}};var Bp=class t extends br{static{i(this,"HyperunitDepositTask")}perps;assetId;spotTokenId;depositTokenCaip19;account;depositAddress;storage;signer;stateMachine=new Rp;depositTransferFactory=new Dp;operationsStreamer;depositRecoverer;fundingState="active";analytics;depositId;constructor(e,r,o,n,s,c,p,d,m,f,g,w,y){super("deposit",e,r,o),this.perps=n,this.assetId=s,this.spotTokenId=c,this.depositTokenCaip19=p,this.account=d,this.depositAddress=m,this.storage=f,this.signer=g,this.analytics=w,this.stateMachine.addListener(this.stateMachineListener),this.stateMachine.addListener(this.stateLogsListener),this.operationsStreamer=new ui(this.perps.client),this.depositRecoverer=new _p(this.perps,this.storage,this.analytics),this.perps.user&&this.depositRecoverer.cache.setUserAddress(L(this.perps.user)),this.depositId=y||Oe(),this.reportAnalytics(Ne.FUNDING_INITIALIZED,{})}reportAnalytics(e,r){let o={fundingType:"deposit",fundingRoute:Sr.Hyperunit,amount:this.amount,amountUsd:this.amountUsd,fee:this.fee.toString(),estimatedTime:this.estimatedTime,assetId:this.assetId,spotTokenId:this.spotTokenId,depositTokenCaip19:L(this.depositTokenCaip19),depositAddress:this.depositAddress,depositId:this.depositId};this.analytics.reportDeposit(e,{...o,...r})}stateMachineListener={onStepCompleted:i((e,r)=>{this.fundingState!=="paused"&&(e.type==="transfer"&&this.notify({type:"fundingBridgingStarted",estimateTime:this.estimatedTime},this.state),r&&(this.depositRecoverer.cache.set(r,this.startedAt),this.executeStep(r)))},"onStepCompleted"),onDepositCompleted:i(()=>{this.depositRecoverer.cache.clear(),this.stateMachine.removeListener(this.stateMachineListener),this.state={type:"completed"},this.notify({type:"fundingCompleted"},this.state),this.reportAnalytics(Ne.FUNDING_COMPLETED,{})},"onDepositCompleted"),onDepositFailed:i((e,r)=>{console.error(`Deposit failed at step: ${e.type}`,r),this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.removeListener(this.stateMachineListener),this.state={type:"failed",error:r},this.notify({type:"fundingFailed",error:r},this.state),this.reportAnalytics(Ne.FUNDING_FAILED,{error:JSON.stringify(r)})},"onDepositFailed")};stateLogsListener={onStepCompleted:i((e,r)=>{k.addBreadcrumb(v.Perps,`Deposit step completed: ${e.type}`,D.Info,{...bh(e),amountUsd:this.amountUsd??""})},"onStepCompleted"),onDepositCompleted:i(()=>{this.stateMachine.removeListener(this.stateLogsListener)},"onDepositCompleted"),onDepositFailed:i((e,r)=>{k.addBreadcrumb(v.Perps,`Deposit failed at step: ${e.type}`,D.Error,{error:r instanceof Error?r.message:"Unknown error",...bh(e),amountUsd:this.amountUsd??""}),this.stateMachine.removeListener(this.stateLogsListener)},"onDepositFailed")};execute(e,r,o,n){if(this.amount=o,this.amountUsd=r,this.state={type:"executing",task:this},this.notify({type:"fundingStarted"},this.state),n){this.stateMachine.setStep(n.state),this.stateMachine.completeStep(n.completedStep);return}this.stateMachine.completeStep({stepType:"idle",depositAddress:this.depositAddress,amount:e})}pause(){this.fundingState="paused",this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.reportAnalytics(Ne.FUNDING_PAUSED,{})}resume(){this.fundingState="active";let e=this.stateMachine.getStep();e.type==="streamOperations"&&((async()=>{try{if(!this.perps.user)return;let r=await this.perps.client.getOperations({taker:L(this.perps.user)}),o=`${e.sourceTxHash}:${e.depositAddress}`,n=r.operations.find(s=>s.sourceTxHash===o);n&&n.state==="done"?this.processOperation(n):this.executeStep(e)}catch{this.executeStep(e)}})(),this.reportAnalytics(Ne.FUNDING_RESUMED,{}))}executeStep(e){(async()=>{try{switch(e.type){case"transfer":this.reportAnalytics(Ne.DEPOSIT_TRANSFER_STARTED,{...e});let{senderAddress:r,networkId:o,tokenDecimals:n,txHash:s}=await this.transfer(e.depositAmount),c=await this.perps.spot.getTokenMidPrice(this.spotTokenId);this.stateMachine.completeStep({stepType:"transfer",senderAddress:r,networkId:o,tokenDecimals:n,txHash:s,assetId:this.assetId,spotTokenId:this.spotTokenId,assetLimitPriceUsd:c}),this.reportAnalytics(Ne.DEPOSIT_TRANSFER_COMPLETED,{...e,senderAddress:r,networkId:o,tokenDecimals:n,txHash:s,assetLimitPriceUsd:c});break;case"streamOperations":this.reportAnalytics(Ne.DEPOSIT_STREAM_OPERATIONS_STARTED,{...e}),this.startOperationsStream(e.sourceTxHash,e.depositAddress),this.reportAnalytics(Ne.DEPOSIT_STREAM_OPERATIONS_COMPLETED,{...e});break;case"sellSpotAsset":this.reportAnalytics(Ne.DEPOSIT_SELL_SPOT_STARTED,{...e});let p=await this.sellSpotAsset(e.depositAmount,e.tokenDecimals);this.stateMachine.completeStep({stepType:"sellSpotAsset",...p}),this.reportAnalytics(Ne.DEPOSIT_SELL_SPOT_COMPLETED,{...e,...p});break;case"transferToPerps":this.reportAnalytics(Ne.DEPOSIT_TRANSFER_TO_PERP_STARTED,{...e});let d=await this.transferToPerps(e.totalSz,e.avgPx);this.stateMachine.completeStep({stepType:"transferToPerps",transferUsdcAmount:d}),this.reportAnalytics(Ne.DEPOSIT_TRANSFER_TO_PERP_COMPLETED,{...e,transferUsdcAmount:d});break}}catch(r){this.stateMachine.failStep(r)}})()}async transfer(e){return await this.depositTransferFactory.create(this.depositTokenCaip19,this.account).execute(e,this.depositAddress,this.storage,this.signer)}startOperationsStream(e,r){if(this.operationsStreamer.subscribe(this.operationsStreamListener),!this.perps.user)throw new Error("No perps user");this.operationsStreamer.startStream(this.perps.user,e,r)}operationsStreamListener={onOperation:i((e,r)=>{r&&this.processOperation(r)},"onOperation"),onError:i(e=>{this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.failStep(e)},"onError")};processOperation(e){if(e.state==="failure"){this.stateMachine.failStep(new Error("Operation failed"));return}if(e.state==="done"){if(this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.operationsStreamer.stopStream(),!e.destinationAmount)throw new Error("Destination amount is required");this.stateMachine.completeStep({stepType:"streamOperations",destinationAmount:new x(e.destinationAmount)})}}async sellSpotAsset(e,r){let o=e.shiftedBy(-r).decimalPlaces(3,x.ROUND_DOWN),n=await this.perps.spot.getTokenMidPrice(this.spotTokenId),s=await this.perps.spot.sell(this.assetId,o.toString(),n);return{totalSz:new x(s.totalSz),avgPx:new x(s.avgPx)}}async transferToPerps(e,r){let o=e.multipliedBy(r).decimalPlaces(2,x.ROUND_DOWN).multipliedBy(.999);return await this.perps.transfer({toPerp:!0,amount:o}),o}static create({minimumUiAmount:e,estimatedTime:r,fee:o,perps:n,assetId:s,spotTokenId:c,depositTokenCaip19:p,account:d,depositAddress:m,storage:f,signer:g,analytics:w,depositId:y}){return new t(e,r,o,n,s,c,p,d,m,f,g,w,y)}};u();l();u();l();var RC={1:7e-4,2:6e-4,3:5e-4,4:4e-4,5:35e-5,6:3e-4,7:.0025,8:.002};u();l();var Np=class{static{i(this,"HyperunitWithdrawStateMachine")}step;constructor(e){e?this.step=e:this.step={type:"idle"}}setStep(e){this.step=e}listeners=[];completeStep(e){let r=this.step,o=this.detectNextStep(e);if(!o){this.listeners.forEach(n=>n.onStepCompleted(this.step,void 0)),this.listeners.forEach(n=>n.onWithdrawCompleted());return}this.step=o,this.listeners.forEach(n=>n.onStepCompleted(r,o))}failStep(e){this.listeners.forEach(r=>r.onWithdrawFailed(this.step,e))}detectNextStep(e){switch(e.stepType){case"idle":return{type:"perpsToSpot",withdrawAddress:e.withdrawAddress,assetId:e.assetId,estimatedTime:e.estimatedTime,withdrawAmountUsd:e.withdrawAmountUsd};case"perpsToSpot":if(this.step.type!=="perpsToSpot")throw new Error("Invalid step: expected perpsToSpot, got "+this.step.type);return{...this.step,type:"buyAsset"};case"buyAsset":if(this.step.type!=="buyAsset")throw new Error("Invalid step: expected buyAsset, got "+this.step.type);return{...this.step,type:"sendToWithdrawAddress",assetMidPrice:e.assetMidPrice,filledAmount:e.filledAmount};case"sendToWithdrawAddress":if(this.step.type!=="sendToWithdrawAddress")throw new Error("Invalid step: expected sendToWithdrawAddress, got "+this.step.type);return{...this.step,type:"streamOperations",sendToWithdrawAmount:e.sendToWithdrawAmount,operationStartTime:new Date};case"streamOperations":if(this.step.type!=="streamOperations")throw new Error("Invalid step: expected streamOperations, got "+this.step.type);return}}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(r=>r!==e)}getStep(){return this.step}};var Lp=class extends br{static{i(this,"HyperunitWithdrawTask")}withdrawAddress;withdrawAddressRole;assetId;spotTokenName;spotTokenId;perps;stateMachine=new Np;analytics;operationsStreamer;fundingState="active";constructor(e,r,o,n,s,c,p,d,m,f){super("withdraw",p,d,m),this.withdrawAddress=e,this.withdrawAddressRole=r,this.assetId=o,this.spotTokenName=n,this.spotTokenId=s,this.perps=c,this.analytics=f,this.stateMachine.addListener(this.withdrawStateMachineListener),this.stateMachine.addListener(this.stateLogsListener),this.operationsStreamer=new ui(this.perps.client),this.reportAnalytics(Ue.FUNDING_INITIALIZED,{})}reportAnalytics(e,r){let o={fundingType:"withdraw",amount:this.amount,amountUsd:this.amountUsd,withdrawAddress:this.withdrawAddress,withdrawAddressRole:this.withdrawAddressRole,assetId:this.assetId,spotTokenName:this.spotTokenName,spotTokenId:this.spotTokenId,minimumUiAmount:this.minimumUiAmount.toString(),estimatedTime:this.estimatedTime,fee:this.fee.toString()};this.analytics.reportWithdraw(e,{...o,...r})}withdrawStateMachineListener={onStepCompleted:i((e,r)=>{this.fundingState!=="paused"&&(e.type==="sendToWithdrawAddress"&&this.notify({type:"fundingBridgingStarted",estimateTime:"4"},this.state),r&&this.executeStep(r))},"onStepCompleted"),onWithdrawCompleted:i(()=>{this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.removeListener(this.withdrawStateMachineListener),this.state={type:"completed"},this.notify({type:"fundingCompleted"},this.state),this.reportAnalytics(Ue.FUNDING_COMPLETED,{})},"onWithdrawCompleted"),onWithdrawFailed:i((e,r)=>{console.error(`Withdraw failed at step: ${e.type}`,r),this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.removeListener(this.withdrawStateMachineListener),this.state={type:"failed",error:r},this.notify({type:"fundingFailed",error:r},this.state),this.reportAnalytics(Ue.FUNDING_FAILED,{error:JSON.stringify(r)})},"onWithdrawFailed")};stateLogsListener={onStepCompleted:i((e,r)=>{k.addBreadcrumb(v.Perps,`Withdraw step completed: ${e.type}`,D.Info,{...Th(e),amountUsd:this.amountUsd??""})},"onStepCompleted"),onWithdrawCompleted:i(()=>{this.stateMachine.removeListener(this.stateLogsListener)},"onWithdrawCompleted"),onWithdrawFailed:i((e,r)=>{k.addBreadcrumb(v.Perps,`Withdraw failed at step: ${e.type}`,D.Error,{error:r instanceof Error?r.message:"Unknown error",...Th(e),amountUsd:this.amountUsd??""}),this.stateMachine.removeListener(this.stateLogsListener)},"onWithdrawFailed")};pause(){this.fundingState="paused",this.operationsStreamer.stopStream(),this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.reportAnalytics(Ue.FUNDING_PAUSED,{})}resume(){this.fundingState="active";let e=this.stateMachine.getStep();e.type==="streamOperations"&&(this.perps.user&&this.executeStep(e),this.reportAnalytics(Ue.FUNDING_RESUMED,{}))}execute(e,r,o,n){if(this.amount=o,this.amountUsd=r,this.state={type:"executing",task:this},this.notify({type:"fundingStarted"},this.state),n){this.stateMachine.setStep(n.state),this.stateMachine.completeStep(n.completedStep);return}this.stateMachine.completeStep({stepType:"idle",withdrawAddress:this.withdrawAddress,assetId:this.assetId,estimatedTime:this.estimatedTime??"",withdrawAmountUsd:e})}executeStep(e){(async()=>{try{switch(e.type){case"perpsToSpot":this.reportAnalytics(Ue.PERPS_TO_SPOT_STARTED,e),await this.transferToSpot(e.withdrawAmountUsd),this.reportAnalytics(Ue.PERPS_TO_SPOT_COMPLETED,e);break;case"buyAsset":this.reportAnalytics(Ue.BUY_ASSET_STARTED,e),await this.buyAsset(e.assetId,e.withdrawAmountUsd),this.reportAnalytics(Ue.BUY_ASSET_COMPLETED,e);break;case"sendToWithdrawAddress":this.reportAnalytics(Ue.SEND_TO_WITHDRAW_ADDRESS_STARTED,e),await this.sendToWithdrawAddress(this.spotTokenName,this.spotTokenId,e.filledAmount),this.reportAnalytics(Ue.SEND_TO_WITHDRAW_ADDRESS_COMPLETED,e);break;case"streamOperations":this.reportAnalytics(Ue.WITHDRAW_STREAM_OPERATIONS_STARTED,e),this.startOperationsStream(e),this.reportAnalytics(Ue.WITHDRAW_STREAM_OPERATIONS_COMPLETED,e);break}}catch(r){this.stateMachine.failStep(r)}})()}async transferToSpot(e){let r=this.withdrawAddressRole==="missing"?new x(1):new x(0);await this.perps.transfer({toPerp:!1,amount:e.minus(r)}),this.perps.syncAccountBalance(),this.perps.syncFundingHistory(),this.stateMachine.completeStep({stepType:"perpsToSpot"})}async buyAsset(e,r){let o=await this.perps.spot.getTokenMidPrice(this.spotTokenId),n=r.dividedBy(o.multipliedBy(Tp)).decimalPlaces(3),s=await this.perps.spot.buy(e,n.toString(),o),c=RC[1];this.stateMachine.completeStep({stepType:"buyAsset",assetMidPrice:o,filledAmount:new x(s.totalSz).multipliedBy(1-c)})}async sendToWithdrawAddress(e,r,o){let n=this.fee.dividedBy(10**xn.data.decimals),s=o.minus(n).decimalPlaces(3,x.ROUND_DOWN);await this.perps.spot.send(e,r,s,this.withdrawAddress),this.stateMachine.completeStep({stepType:"sendToWithdrawAddress",sendToWithdrawAmount:s})}startOperationsStream(e){if(e.type!=="streamOperations")throw new Error("Invalid step type for operations stream");if(this.operationsStreamer.subscribe(this.operationsStreamListener),!this.perps.user)throw new Error("No perps user");this.operationsStreamer.startWithdrawStream(this.perps.user,e.operationStartTime,e.sendToWithdrawAmount)}operationsStreamListener={onOperation:i((e,r)=>{r&&this.processOperation(r)},"onOperation"),onError:i(e=>{this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.stateMachine.failStep(e)},"onError")};processOperation(e){if(e.state==="failure"){this.stateMachine.failStep(new Error("Withdrawal operation failed"));return}e.state==="done"&&(this.operationsStreamer.unsubscribe(this.operationsStreamListener),this.operationsStreamer.stopStream(),this.stateMachine.completeStep({stepType:"streamOperations"}))}getWithdrawAddressAndRole(){return{withdrawAddress:this.withdrawAddress,withdrawAddressRole:this.withdrawAddressRole}}};var Mp=class{static{i(this,"HyperunitFundingTaskFactory")}analytics;constructor(e){this.analytics=e}async createTask(e,r,o,n,s,c,p,d){switch(d.type){case"deposit":return this.createDepositTask(e,r,d.depositTokenCaip19,p,s,c,d.depositId);case"withdraw":return this.createWithdrawTask(e,d.withdrawNetworkId,r)}}async createDepositTask(e,r,o,n,s,c,p){let{fundingCaip19Address:d,spotAssetId:m,eta:f,minimumAmount:g,spotTokenId:w,fee:y}=await e.client.postFunding({type:"deposit",taker:L(n),originChain:o.chainId}),S=this.checkCaip19Address(d);return Bp.create({minimumUiAmount:new x(g),estimatedTime:f,fee:new x(y),perps:e,assetId:m,spotTokenId:w,depositTokenCaip19:o,account:r,depositAddress:S,storage:s,signer:c,analytics:this.analytics,depositId:p})}async createWithdrawTask(e,r,o){let n=o.addresses.find(S=>S.networkID===r);if(!n)throw new Error("Couldn't find destination account address for network: "+r);let{fundingCaip19Address:s,spotAssetId:c,eta:p,minimumAmount:d,spotTokenName:m,spotTokenId:f,fee:g}=await e.client.postFunding({type:"withdraw",taker:L({resourceType:V.address,chainId:n.networkID,address:n.address}),originChain:r}),w=this.checkCaip19Address(s),y=await e.client.getUserRole(w);return new Lp(w,y.role,c,m,f,e,new x(d),p,new x(g),this.analytics)}checkCaip19Address(e){let r=We(e);if(r.resourceType!==V.address)throw new Error("Funding CAIP19 is not an address");return r.address}};u();l();var Ah=class extends br{static{i(this,"MockFundingTask")}shouldFail;constructor(e,r=!1){super(e,new x(.01),"1m",new x(8471530)),this.shouldFail=r}execute(e,r,o){this.amount=o,this.amountUsd=r,this.state={type:"executing",task:this},this.notify({type:"fundingStarted"},this.state),setTimeout(()=>{if(this.notify({type:"fundingBridgingStarted",estimateTime:this.estimatedTime},this.state),this.shouldFail){setTimeout(()=>{this.state={type:"failed",error:new Error("Mock funding task failed")},this.notify({type:"fundingFailed",error:new Error("Mock funding task failed")},this.state)},3e3);return}setTimeout(()=>{this.state={type:"completed"},this.notify({type:"fundingCompleted"},this.state)},3e3)},3e3)}pause(){}resume(){}},La=class{static{i(this,"MockFundingTaskFactory")}createTask(e,r,o,n,s,c,p,d){return Promise.resolve(new Ah(d.type,!1))}};var NC=(0,Co.createContext)(null),DC=!1;function lLe({fundingPoolFactory:t,children:e}){let r=kC(),o=lt(),n=cy(),s=Do(),c=(0,Co.useMemo)(()=>{let m;if(t)m=t.create();else{let w=new Fp(o);m=new Pp(w)}m.addListener(new Cp),m.addListener(new Ep),m.addListener(new Ip(()=>{let w=c.account,y=c.user;if(!(!w||!y))return{account:w,user:y,cashAccount:void 0,storage:o,perps:c,determineProvider:i(()=>{},"determineProvider"),getAvailableProviders:i(()=>[],"getAvailableProviders")}}));let f=DC?new La:new kp(r),g=DC?new La:new Mp(r);return new xp({client:new Yl,isTestnet:n,fundingPool:m,relayFundingTaskFactory:f,hyperunitFundingTaskFactory:g,authRepository:s})},[t,r,o,n,s]),{data:p}=ye();(0,Co.useEffect)(()=>{p&&c.setAccount(p)},[p,c]);let d=Ro();return(0,Co.useEffect)(()=>{c.setSigner(d)},[d,c]),(0,BC.jsx)(NC.Provider,{value:c,children:e})}i(lLe,"PerpsProvider");function Up(){let t=(0,Co.useContext)(NC);if(!t)throw new Error("usePerps must be used within a PerpsProvider");return t}i(Up,"usePerpsContext");u();l();var LC=N(z());var MM=j({days:1}),MC=j({minutes:15}),UM=a.record(vo,vo),UC=i(()=>te({queryKey:ei.fungibleToPerpMap(),queryFn:i(()=>{try{return OC()}catch(t){throw k.addBreadcrumb(v.Perps,"Failed to get fungible to perp map",D.Error,{error:t instanceof Error?t.message:"Unknown error"}),t}},"queryFn"),gcTime:MM,staleTime:MC}),"useFungibleToPerpMap"),OM=i(t=>t.prefetchQuery({queryKey:ei.fungibleToPerpMap(),queryFn:OC,staleTime:MC}),"prefetchFungibleToPerpMap"),qM=i(()=>{let t=Be();(0,LC.useEffect)(()=>{Va("enable-terminal-cta")&&OM(t)},[t])},"usePrefetchFungibleToPerpMap"),OC=i(async()=>{let t=await G.api().get("/swap/v2/perp/fungible-to-perp-map");if(!J(t))throw new Error("Failed to get fungible to perp map: response is not okay");let e=t.data,r=UM.safeParse(e);if(!r.success)throw new Error("Failed to get fungible to perp map: schema validation failed");return r.data},"getFungibleToPerpMap");u();l();var qC=N(z());var zM=i(t=>{let{data:e}=UC();return(0,qC.useMemo)(()=>{if(!(!e||!t))return e[t]??void 0},[t,e])},"useFungibleToPerp");u();l();u();l();var qp=N(z());u();l();var zC=N(z());var Un=i(()=>{let{data:[t]}=qt(["enable-perps"]),{data:e}=ye(),r=(0,zC.useMemo)(()=>e?.addresses.some(o=>C.isEVMNetworkID(o.networkID))??!1,[e]);return t&&r},"useIsPerpsSupported");u();l();var $e=N(z());var Op=i(()=>{let t=Up(),e=(0,$e.useCallback)(()=>{t.syncAccountBalance()},[t]),[r,o]=(0,$e.useState)(t.getAccountBalanceState());(0,$e.useEffect)(()=>t.subscribeAccountBalanceState({onAccountBalanceStateChange:i(O=>{o(O)},"onAccountBalanceStateChange")}),[t]);let n=(0,$e.useCallback)(()=>{t.syncPositions()},[t]),[s,c]=(0,$e.useState)(t.getPositionsState());(0,$e.useEffect)(()=>t.subscribePositions({onPositionStateChange:i(O=>{c(O)},"onPositionStateChange")}),[t]);let p=(0,$e.useCallback)(()=>{t.syncPositionFees()},[t]),[d,m]=(0,$e.useState)(t.getPositionFeesState());(0,$e.useEffect)(()=>t.subscribePositionFees({onPositionFeesStateChange:i(O=>{m(O)},"onPositionFeesStateChange")}),[t]);let f=(0,$e.useCallback)(()=>{t.syncFundingHistory()},[t]),[g,w]=(0,$e.useState)(t.getFundingHistoryState());(0,$e.useEffect)(()=>t.subscribeFundingHistory({onFundingHistoryStateChange:i(O=>{w(O)},"onFundingHistoryStateChange")}),[t]);let y=(0,$e.useCallback)(O=>{t.syncHistoricalOrders(O)},[t]),[S,b]=(0,$e.useState)(t.getHistoricalOrdersState());(0,$e.useEffect)(()=>t.subscribeHistoricalOrders({onHistoricalOrdersStateChange:i(O=>{b(O)},"onHistoricalOrdersStateChange")}),[t]);let T=(0,$e.useCallback)((O,_,H,Q)=>{t.syncPricing(O,_,H,Q)},[t]),A=(0,$e.useCallback)(O=>{t.startSequentialPricingSync(O)},[t]),[E,I]=(0,$e.useState)(t.getPricingState());(0,$e.useEffect)(()=>t.subscribePricing({onPricingStateChange:i(O=>{I(O)},"onPricingStateChange")}),[t]);let P=(0,$e.useCallback)(()=>t.getAccountBalanceState(),[t]),U=(0,$e.useCallback)(O=>{t.warmOpenPositionLeverage(O)},[t]);return{isReady:t.getUser()!==void 0,accountBalanceState:r,syncAccountBalance:e,getAccountBalanceState:P,positionsState:s,syncPositions:n,positionFeesState:d,syncPositionFees:p,warmOpenPositionLeverage:U,fundingHistoryState:g,syncFundingHistory:f,historicalOrdersState:S,syncHistoricalOrders:y,pricingState:E,syncPricing:T,startSequentialPricingSync:A}},"usePerps");var jLe=i(()=>{let t=Un(),e=Up(),{syncAccountBalance:r,syncPositions:o,syncHistoricalOrders:n,syncPositionFees:s,accountBalanceState:c,positionsState:p,historicalOrdersState:d,positionFeesState:m,syncFundingHistory:f,fundingHistoryState:g}=Op(),w=(0,qp.useCallback)(()=>{t&&(r(),o(),n(),s(),f())},[r,o,n,t,s,f]);return(0,qp.useEffect)(()=>e.subscribeAccountChange({onAccountChange:i(()=>{w()},"onAccountChange")}),[e,w]),{isLoading:QM(c,p,d,m,g),isRefreshing:HM(c,p,d,m,g),isIndeterminate:GM(c,p,d,m,g),refetch:w}},"useSyncPerpsPortfolio");function QM(t,e,r,o,n){return t.type==="loading"||e.type==="loading"||r.type==="loading"||o.type==="loading"||n.type==="loading"}i(QM,"isLoading");function HM(t,e,r,o,n){return t.type==="refreshing"||e.type==="refreshing"||r.type==="refreshing"||o.type==="refreshing"||n.type==="refreshing"}i(HM,"isRefreshing");function GM(t,e,r,o,n){return t.type==="indeterminate"||e.type==="indeterminate"||r.type==="indeterminate"||o.type==="indeterminate"||n.type==="indeterminate"}i(GM,"isIndeterminate");u();l();var QC=N(z());var KM=i(()=>{let{data:[t]}=qt(["enable-extension-perps"]),{data:e}=ye(),r=(0,QC.useMemo)(()=>e?.addresses.some(o=>C.isEVMNetworkID(o.networkID))??!1,[e]);return t&&r},"useIsExtensionPerpsSupported");u();l();var Tr=N(z());u();l();var HC=3,iMe=fd(t=>{let e=t(xh);return{isPerpsBalanceError:e.accountBalanceErrors>=HC,isPerpsPositionsError:e.positionsErrors>=HC}}),xh=fd({accountBalanceErrors:0,positionsErrors:0});var GC=0,fMe=i(({interval:t=5e3,enabled:e=!0,maxConsecutiveErrors:r=3,onSyncPaused:o}={})=>{let n=Un(),{syncAccountBalance:s,syncPositions:c,accountBalanceState:p,positionsState:d}=Op(),m=(0,Tr.useRef)(null),f=(0,Tr.useRef)(e),g=(0,Tr.useRef)(!1),w=$y(xh);f.current=e,(0,Tr.useEffect)(()=>{let T="consecutiveErrors"in p?p.consecutiveErrors:0,A="consecutiveErrors"in d?d.consecutiveErrors:0,I=Math.min(T,A)>=r;I&&!g.current?(g.current=!0,o&&o()):!I&&g.current&&(g.current=!1),w({accountBalanceErrors:T,positionsErrors:A})},[p,d,r,o,w]);let y=(0,Tr.useCallback)(()=>{if(n&&f.current&&!g.current){let T=Date.now();T-GC>=t&&(s(),c(),GC=T)}},[s,c,n,t]),S=(0,Tr.useCallback)(()=>{if(!n||!f.current)return;m.current&&clearTimeout(m.current);let T=i(()=>{f.current&&(y(),m.current=setTimeout(T,t))},"poll");m.current=setTimeout(T,t)},[y,t,n]),b=(0,Tr.useCallback)(()=>{m.current&&(clearTimeout(m.current),m.current=null)},[]);return(0,Tr.useEffect)(()=>(e&&n?S():b(),b),[e,n,S,b]),(0,Tr.useEffect)(()=>()=>{b()},[b]),{startPolling:S,stopPolling:b,syncPerpsData:y,isSyncPaused:g.current}},"usePerpsPolling");u();l();var Hp=N(z());u();l();var XC=N(ZI()),JC=N(VI());var $M=a.object({domain:a.string(),url:a.string(),name:a.string(),category:a.string(),imageUrl:a.string(),slug:a.string()}),ek=a.object({uuid:a.string(),data:a.array($M)}),jM=a.object({type:a.literal("site"),url:a.string(),name:a.string(),category:a.string(),imageUrl:a.string(),description:a.string().optional()}),VM=a.object({type:a.literal("tokenCategory"),id:a.string(),name:a.string(),subtitle:a.string().optional(),imageUrl:a.string(),description:a.string().optional()}),tk=a.discriminatedUnion("type",[jM,VM]),_Me=i(t=>t.type==="site","isFeaturedSite");var WM=a.object({chainId:xr,address:a.string(),name:a.string(),symbol:a.string(),logoUrl:a.string(),marketCap:a.number(),price:a.number(),priceChange:a.number(),volume:a.number(),volumeChange:a.number(),spamStatus:Fi.optional().default(de.NotVerified)}),ZM=a.object({chainId:xr,address:a.string(),name:a.string(),symbol:a.string(),logoUrl:a.string(),marketCap:a.number(),price:a.number(),priceChange:a.number(),volume:a.number(),volumeChange:a.number(),spamStatus:Fi.optional().default(de.NotVerified)}),RMe=a.object({id:a.string(),name:a.string(),imageUri:a.string()}),rk=a.object({items:a.array(WM)}),DMe=a.object({items:a.array(ZM)}),YM=a.object({paymentTokenId:a.string(),name:a.string(),symbol:a.string(),decimals:a.number()}),XM=a.object({verified:a.boolean(),collectionUrl:a.string(),marketplaceId:a.string(),marketplaceName:a.string(),marketplaceCollectionId:a.string()}),JM=a.object({marketplaceId:a.string(),paymentToken:YM,value:a.string()}),eU=a.object({id:a.string(),name:a.string(),volume:a.string().optional(),volumePercentChange:a.number(),marketplacePages:a.array(XM),floorPrices:a.array(JM),imageUrl:a.string()}),ok=a.object({uuid:a.string(),data:a.array(eU)}),tU=["tokens","perps","sites","collections","learn","suggested-users-to-follow","suggested-users-to-follow-by-pnl","token-categories","trending-perps"],vr=a.enum(["shortcuts","carousel",...tU]),rU=a.object({type:a.literal(vr.enum.shortcuts)}),oU=a.object({type:a.literal(vr.enum.carousel)}),nU=a.object({type:a.literal(vr.enum["suggested-users-to-follow"]),limit:a.number()}),sU=["7d","30d"],KC=a.enum(sU),iU=a.object({type:a.literal(vr.enum["suggested-users-to-follow-by-pnl"]),limit:a.number(),timeFrame:a.array(KC).refine(t=>new Set(t).size===t.length),timeFrameDefault:KC}),Ma="all_networks",li=a.union([xr,a.literal(Ma)]),aU=["asc","desc"],Eh=a.enum(aU),cU=["rank","volume","price","price-change","market-cap"],$C=a.enum(cU),uU=["1h","24h","7d","30d"],jC=a.enum(uU),lU=a.object({type:a.literal(vr.enum.tokens),sortBy:a.array($C).refine(t=>new Set(t).size===t.length),sortByDefault:$C,sortDirectionDefault:Eh,network:a.array(li).refine(t=>new Set(t).size===t.length),networkDefault:li,timeFrame:a.array(jC).refine(t=>new Set(t).size===t.length),timeFrameDefault:jC,rankAlgo:a.string(),limit:a.number(),listLimit:a.number()}),pU=a.object({type:a.literal(vr.enum["token-categories"])}),dU=["volume","price-change","open-interest","trending"],zp=a.enum(dU),mU=["1h","24h","7d","30d"],Qp=a.enum(mU),fU=a.object({type:a.literal(vr.enum.perps),sortBy:a.array(zp).refine(t=>new Set(t).size===t.length),sortByDefault:zp,sortDirectionDefault:Eh,timeFrame:a.array(Qp).refine(t=>new Set(t).size===t.length),timeFrameDefault:Qp,limit:a.number(),listLimit:a.number()}),hU=a.object({type:a.literal(vr.enum["trending-perps"]),sortBy:a.array(zp).refine(t=>new Set(t).size===t.length),sortByDefault:zp,sortDirectionDefault:Eh,timeFrame:a.array(Qp).refine(t=>new Set(t).size===t.length),timeFrameDefault:Qp,limit:a.number(),listLimit:a.number()}),gU=["top","rank"],VC=a.enum(gU),yU=["24h","7d","30d"],WC=a.enum(yU),wU=a.object({type:a.literal(vr.enum.sites),sortBy:a.array(VC).refine(t=>new Set(t).size===t.length),sortByDefault:VC,network:a.array(li).refine(t=>new Set(t).size===t.length),networkDefault:li,timeFrame:a.array(WC).refine(t=>new Set(t).size===t.length),timeFrameDefault:WC,rankAlgo:a.string(),limit:a.number(),listLimit:a.number()}),SU=["top","rank"],ZC=a.enum(SU),bU=["24h","7d","30d"],YC=a.enum(bU),TU=a.object({type:a.literal(vr.enum.collections),sortBy:a.array(ZC).refine(t=>new Set(t).size===t.length),sortByDefault:ZC,network:a.array(li).refine(t=>new Set(t).size===t.length),networkDefault:li,timeFrame:a.array(YC).refine(t=>new Set(t).size===t.length),timeFrameDefault:YC,rankAlgo:a.string(),limit:a.number(),listLimit:a.number()}),AU=a.object({type:a.literal(vr.enum.learn),limit:a.number()}),Ch=a.discriminatedUnion("type",[rU,oU,nU,iU,lU,fU,hU,wU,TU,AU,pU]),nk=a.object({sections:a.array(Ch).refine(t=>(0,XC.default)(t,(0,JC.default)(t,"type")))}),BMe=a.object({uuid:a.string(),data:a.array(gg)}),NMe=a.object({tokenAddress:a.string(),bondingCurve:a.string(),migratedPool:a.string().optional(),name:a.string(),image:a.string(),symbol:a.string(),marketCap:a.coerce.number(),liquidity:a.coerce.number(),bondingCurvePercentage:a.coerce.number(),tokenCreatedAt:a.coerce.date(),twitter:a.string(),website:a.string(),telegram:a.string(),discord:a.string(),migratedAt:a.coerce.date().optional(),type:a.enum(["NEW","ABOUT_TO_MIGRATE","MIGRATED"]).optional(),slot:a.coerce.number().optional(),devHolding:a.coerce.number(),snipersHolding:a.coerce.number(),bundlersHolding:a.coerce.number(),top10Holding:a.coerce.number(),volume:a.coerce.number(),buysCount:a.coerce.number(),sellsCount:a.coerce.number(),uniqueHolders:a.coerce.number(),telegramCallCount:a.coerce.number(),bondingCurvePlatform:a.string()});var sk=nk.parse({sections:[{type:"shortcuts"},{type:"carousel"},{type:"tokens",sortBy:["rank","volume","price","price-change","market-cap"],sortByDefault:"rank",sortDirectionDefault:"asc",network:["solana:101","eip155:1","eip155:137","eip155:8453","sui:mainnet","bip122:000000000019d6689c085ae165831e93","all_networks"],networkDefault:"solana:101",timeFrame:["1h","24h","7d","30d"],timeFrameDefault:"24h",rankAlgo:"default",limit:3,listLimit:100},{type:"perps",sortBy:["volume","price-change","open-interest"],sortByDefault:"volume",sortDirectionDefault:"desc",timeFrame:["24h"],timeFrameDefault:"24h",limit:3,listLimit:100},{type:"trending-perps",sortBy:["trending"],sortByDefault:"trending",sortDirectionDefault:"desc",timeFrame:["24h"],timeFrameDefault:"24h",limit:3,listLimit:100},{type:"token-categories"},{type:"suggested-users-to-follow-by-pnl",limit:3,timeFrame:["7d","30d"],timeFrameDefault:"7d"},{type:"sites",sortBy:["rank","top"],sortByDefault:"rank",network:["solana:101","eip155:1","eip155:137","eip155:8453","sui:mainnet","bip122:000000000019d6689c085ae165831e93","all_networks"],networkDefault:"solana:101",timeFrame:["24h","7d","30d"],timeFrameDefault:"24h",rankAlgo:"default",limit:3,listLimit:50},{type:"learn",limit:3}]}),xU=i(t=>{try{let e=JSON.parse(t??"");return e?.sections?{sections:e.sections.filter(o=>Ch.safeParse(o).success)}:sk}catch{return sk}},"parseFeatureFlagConfig"),kh=i(()=>{let t=zt.getMultivariateAssignment("explore-config"),{data:[e]}=qt(["enable-fungible-categories"]),r=Un();return(0,Hp.useMemo)(()=>{let o=xU(t);return Nr||(o={...o,sections:o.sections.filter(n=>n.type!=="suggested-users-to-follow")}),e||(o={...o,sections:o.sections.filter(n=>n.type!=="token-categories")}),r||(o={...o,sections:o.sections.filter(n=>n.type!=="perps")}),o},[t,e,r])},"useExploreConfig"),Ih=i(()=>{let t=kh();return(0,Hp.useMemo)(()=>{let e=[];for(let r of t.sections)(r.type==="collections"||r.type==="tokens"||r.type==="perps"||r.type==="sites"||r.type==="learn"||r.type==="suggested-users-to-follow"||r.type==="suggested-users-to-follow-by-pnl"||r.type==="token-categories")&&e.push(r);return e},[t.sections])},"useExploreConfigNavigatableSections"),Fh=i(t=>{let e=kh();return(0,Hp.useMemo)(()=>e.sections.find(o=>o.type===t)??null,[e.sections,t])},"useExploreConfigSection");u();l();u();l();u();l();u();l();var ik="@phantom/fungible-categories",Gp={fungibleCategories:i(t=>[ik,"fungible-categories",t],"fungibleCategories"),fungibleCategoryById:i(t=>[ik,"fungible-category",t],"fungibleCategoryById")};u();l();var ak=a.object({items:a.array(tw)}),ck=a.object({id:a.string(),name:a.string(),imageUri:a.string().nullish().transform(t=>t??""),items:rw.array()});var Ph=i(({limit:t,searchQuery:e}={})=>{let{data:[r]}=qt(["enable-fungible-categories"]);return te({enabled:r,queryKey:Gp.fungibleCategories({enabled:r,searchQuery:e}),queryFn:i(async()=>{let o=await G.api().get("/fungibles/v1/categories",{params:{limit:"100",...e?{query:e}:{}}});return ak.parse(o.data)},"queryFn"),select:i(o=>t?o.items.slice(0,t):o.items,"select")})},"useFungibleCategories");u();l();var EU=i(({id:t})=>{let{data:[e]}=qt(["enable-fungible-categories"]);return te({enabled:e,queryKey:Gp.fungibleCategoryById({id:t,enabled:e}),queryFn:i(async()=>{let r=await G.api().get(`/fungibles/v1/categories/${t}`,{params:{includePrices:"true"}});return ck.parse(r.data)},"queryFn")})},"useFungibleCategoryById");u();l();var Jr=N(z());var CU=2,kU=10,IU=300;function uk(t,e={}){let{debounceMs:r=IU,onSearchExecuted:o}=e,[n,s]=(0,Jr.useState)([]),[c,p]=(0,Jr.useState)(!1),d=(0,Jr.useRef)(null),m=(0,Jr.useMemo)(()=>new Ol,[]),f=(0,Jr.useRef)(o);return f.current=o,(0,Jr.useEffect)(()=>{if(d.current&&clearTimeout(d.current),t.length<CU){s([]),p(!1);return}return p(!0),d.current=setTimeout(async()=>{try{f.current?.(t);let g=await m.searchEvents({query:t,limit:kU});s(g.events||[])}catch(g){console.error("[usePredictionSearch] Search failed:",g),s([])}finally{p(!1)}},r),()=>{d.current&&clearTimeout(d.current)}},[t,m,r]),{results:n,isSearching:c}}i(uk,"usePredictionSearch");var He=N(z());u();l();u();l();u();l();var lk={tokenSearchEnabled:i(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:i(()=>!1,"trendingTokensEnabled")};u();l();var pk={tokenSearchEnabled:i(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:i(()=>!0,"trendingTokensEnabled")};u();l();var dk={tokenSearchEnabled:i(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:i(()=>!1,"trendingTokensEnabled")};u();l();var mk={tokenSearchEnabled:i(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:i(()=>!0,"trendingTokensEnabled")};u();l();var fk={tokenSearchEnabled:i(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:i(()=>!1,"trendingTokensEnabled")};u();l();var hk={tokenSearchEnabled:i(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:i(()=>!1,"trendingTokensEnabled")};u();l();var gk={tokenSearchEnabled:i(()=>!1,"tokenSearchEnabled"),trendingTokensEnabled:i(()=>!1,"trendingTokensEnabled")};u();l();var yk={tokenSearchEnabled:i(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:i(()=>!0,"trendingTokensEnabled")};u();l();var wk={tokenSearchEnabled:i(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:i(()=>!0,"trendingTokensEnabled")};u();l();var Sk={tokenSearchEnabled:i(()=>!0,"tokenSearchEnabled"),trendingTokensEnabled:i(()=>!1,"trendingTokensEnabled")};var FU=new Vn({[ce.Solana]:wk,[ce.Ethereum]:mk,[ce.Polygon]:yk,[ce.Base]:pk,[ce.Arbitrum]:lk,[ce.Bitcoin]:dk,[ce.Monad]:gk,[ce.Sui]:Sk,[ce.Hypercore]:fk,[ce.Hyperevm]:hk}),vh=jn(FU);u();l();u();l();var LOe=i(t=>t.address==="native"?L({chainId:t.chainId,resourceType:V.nativeToken,slip44:C.getSlip44(t.chainId)}):L({chainId:t.chainId,address:t.address,resourceType:V.address}),"exploreTokenToCaip19");var bk=i(t=>["explore-dapp",t],"createExploreDappQueryKey");var Tk=i(t=>t.addresses.map(e=>C.getMainnetNetworkID(e.networkID))??[],"getAccountMainnetNetworkIds");function Ak(t){try{return Cr.get(t).nonNativeFungibleTokenType}catch{return ae.SolanaNative}}i(Ak,"getExploreTokenTypeFromChain");u();l();u();l();var _r="@phantom/explore",Ct={RecentlyViewedSearchItems:[_r,"RecentlyViewedSearchItems"],sitesV2({sortBy:t,timeFrame:e,networkIDs:r,limit:o,locale:n,rankAlgo:s}){return[_r,"sitesV2",Re,n,{sortBy:t,timeFrame:e,networkIDs:r,rankAlgo:s,limit:o}]},recommendedSites(t,e){return[_r,"sites","recommended",Re,e,t]},featuredItems(t,e){return[_r,"items","featured",Re,e,t]},tokensV2({sortBy:t,sortDirection:e,timeFrame:r,networkIDs:o,limit:n,rankAlgo:s}){return[_r,"tokensV2",{sortBy:t,sortDirection:e,timeFrame:r,networkIDs:o,rankAlgo:s,limit:n}]},curated({networkIDs:t,limit:e}){return[_r,"curated",{networkIDs:t,limit:e}]},collectionsV2({sortBy:t,timeFrame:e,networkIDs:r,limit:o,locale:n,rankAlgo:s}){return[_r,"collectionsV2",Re,n,{sortBy:t,timeFrame:e,networkIDs:r,rankAlgo:s,limit:o}]},featuredTransactions(t,e){return[_r,"transactions","featured",Re,e,t]},learn(t,e){return[_r,"learn",Re,e,t]},perpMarkets(t,e,r,o,n,s){return[_r,"perp-markets",{chainId:t,sortBy:e,sortDirection:r,timeFrame:o,limit:n,search:s}]}};var PU=10,Ek=ge.RecentlyViewedSearchItems;async function vU(t){return await t.get(Ek)??[]}i(vU,"getRecentlyViewedSearchItem");async function Ck(t,e){await t.set(Ek,e)}i(Ck,"setRecentlyViewedSearchItem");function _h(t){return te({queryKey:Ct.RecentlyViewedSearchItems,queryFn:i(async()=>vU(t),"queryFn"),staleTime:0,enabled:!0})}i(_h,"useGetRecentlyViewedSearchItems");function _U(t){let e=Be();return cn({mutationFn:i(async o=>{let n=xk(o),c=(e.getQueryData(Ct.RecentlyViewedSearchItems)??[]).filter(p=>xk(p)!==n);c.unshift(o),c=c.slice(0,PU),await Ck(t,c),e.setQueryData(Ct.RecentlyViewedSearchItems,c),await e.refetchQueries({queryKey:Ct.RecentlyViewedSearchItems})},"mutationFn")})}i(_U,"useAddRecentlyViewedSearchItem");function RU(t){let e=Be();return cn({mutationFn:i(async()=>{await Ck(t,[]),e.setQueryData(Ct.RecentlyViewedSearchItems,[]),await e.refetchQueries({queryKey:Ct.RecentlyViewedSearchItems})},"mutationFn")})}i(RU,"useClearRecentlyViewedSearchItem");function xk(t){return t.type==="token"||t.type==="perp"?L(X(t.data)):t.data.id}i(xk,"keyFromSearchItem");u();l();var Rh=N(Dk()),Kp=N(z());u();l();var Bk={fields:["domain","name","category","tags"],storeFields:["domain","name","category","tags","imageUrl"],searchOptions:{boost:{name:2},prefix:!0,fuzzy:i(t=>t.length>3?.2:!1,"fuzzy")}};var Nk=i(t=>{try{let{hostname:e,pathname:r}=new URL(t);return e+r}catch{return t}},"getHostnameAndPath"),GU=i((t=[],e=[])=>{let r=[...t,...e],o=(0,Rh.default)(e,s=>Nk(s.domain)),n=new Map;return r.forEach(s=>{let c=Nk(s.domain);if(!n.has(c)){let p=o[c]||s;n.set(c,p)}}),Array.from(n.values())},"combineAndDeduplicateDapps"),KU=i(t=>{let e={isRecommended:"true"};return t.networkIds&&(e.chainIds=t.networkIds.join(",")),`/dapps/v1?${new URLSearchParams(e).toString()}`},"getRecommendedDappsEndpoint"),$U=i(async t=>{let e=await G.api().get(KU(t));if(!J(e))throw new Error("Error fetching recommended dapps from registry");if(!e?.data?.data)throw new Error("No data returned from registry");let r=e.data,o=(0,Rh.default)(r.data??[],s=>s.id);return Object.values(o)},"fetchRecommendedDapps"),jU=i(t=>{let e=Be();return te({queryKey:["dapps","recommended",t],queryFn:i(async()=>{try{let r=await $U(t);return Bg.batch(()=>{for(let o of r){let n=bk(o.domain),s=e.getQueryState(n);e.setQueryData(n,()=>o??s?.data??null)}}),r}catch(r){throw k.captureError(r,v.DappRegistry),r}},"queryFn"),gcTime:j({days:1}),staleTime:j({days:1})})},"useRecommendedSearchDapps"),Lk=i((t,e)=>{let{searchQuery:r,networkIds:o}=t,{data:n=[],...s}=jU({networkIds:o}),c=(0,Kp.useMemo)(()=>n.sort((g,w)=>w.recommendationScore-g.recommendationScore),[n]),p=(0,Kp.useMemo)(()=>GU(e,c),[e,c]),d=Zg(r),m=Hg(p,d,Bk);return{data:(0,Kp.useMemo)(()=>{let g=new Map(p.map(w=>[w.id,w]));return m.map(w=>g.get(w.id)).filter(w=>w!==void 0)},[m,p]),...s}},"useRecommendedSearchDappsWithQuery");u();l();u();l();var Mk=i(async({sortBy:t,sortDirection:e,timeFrame:r,networkIDs:o,limit:n,rankAlgo:s,anonymousId:c})=>{let p=new URLSearchParams({timeFrame:r,sortBy:t,sortDirection:e,limit:n.toString(),rankAlgo:s,...c?{anonymousId:c}:{}});o.forEach(f=>{p.append("chainIds[]",f)});let d=await G.api().noBearer().get("/explore/v2/trending-tokens",{params:p});if(!J(d))throw new Error("Failed to fetch tokens");let m=rk.safeParse(d.data);if(!m.success)throw new Error("Failed to parse tokens");return m.data},"getTokensV2");u();l();var pi=i((t,e)=>{let r=ec(),n=Ih().find(c=>c.type===e),s=[];return n&&"network"in n?n.network.forEach(c=>{c!==Ma&&r.includes(c)&&s.push(c)}):s=r,t!==Ma&&!s.includes(t)?[]:t===Ma?s:[t]},"useExploreNetwork");var VU=j({minutes:1}),WU=j({minutes:1}),ZU=100,Dh=i(({sortBy:t,sortDirection:e,timeFrame:r,network:o,limit:n,rankAlgo:s,enableQuery:c=!0})=>{let p=ue(),d=pi(o,"tokens"),m=ZU;return te({queryKey:Ct.tokensV2({sortBy:t,sortDirection:e,timeFrame:r,networkIDs:d,limit:m,rankAlgo:s}),enabled:c,async queryFn(){let f=await p.getDeviceId();return Mk({sortBy:t,sortDirection:e,timeFrame:r,networkIDs:d,limit:m,rankAlgo:s,anonymousId:f})},gcTime:WU,staleTime:VU,retry:3,select:i(f=>n>=m?f:{...f,items:f.items.slice(0,n)},"select")})},"useTokensV2");var on=3,YU=15,Ua=50,Uk={[de.Trusted]:1,[de.Verified]:2,[de.NotVerified]:3,[de.PossibleSpam]:4,[de.Spam]:5},XU=i((t,e=100)=>{let[r,o]=(0,He.useState)(!1);return(0,He.useEffect)(()=>{let n;return t?n=setTimeout(()=>{o(!0)},e):o(!1),()=>{clearTimeout(n)}},[t,e]),r},"useDelayedLoading"),JU=i(t=>{let e=Ak(t.chainId),r=C.getChainDefinition(t.chainId),o={name:t.name,symbol:t.symbol,logoUri:t.logoUrl,spamStatus:t.spamStatus,chain:{id:t.chainId,symbol:r.tokenSymbol,name:r.name,imageUrl:r.iconUrl}};switch(e){case ae.SPL:return{type:e,data:{...o,mintAddress:t.address}};case ae.ERC20:return{type:e,data:{...o,contractAddress:t.address}};case ae.BRC20:return{type:e,data:{...o,firstCreatedInscriptionId:t.address}};default:return null}},"mapExploreTokenToTokenMetadata"),eO=i(t=>t.reduce((e,r)=>{let o=JU(r);return o&&e.push(o),e},[]),"reduceExploreTokensToTokenMetadata"),tO=i(({searchQuery:t,networkIds:e,excludePlaceholderTokens:r=!1,extraDapps:o=[],actorSearchHook:n,enablePredictions:s=!1})=>{let[c,p]=(0,He.useState)(!1),[d,m]=(0,He.useState)(!1),[f,g]=(0,He.useState)(!1),[w,y]=(0,He.useState)(!1),[S,b]=(0,He.useState)(!1),[T,A]=(0,He.useState)(!1),E=bt("enable-monad-mainnet"),I=bt("enable-prediction-markets"),P=(0,He.useMemo)(()=>e.filter(kt=>C.isMonadNetworkID(kt)&&C.isMainnetNetworkID(kt)?E:vh.get(kt).tokenSearchEnabled()),[e,E]);(0,He.useEffect)(()=>{p(!1),m(!1),g(!1),y(!1),b(!1),A(!1)},[t]);let{data:U=[],isLoading:O}=Pa({query:t,networkIds:P,searchContext:"explore",enableQuery:!!t}),{data:_,isLoading:H}=Ph({limit:t?void 0:10,searchQuery:t}),Q=Fh("tokens"),{data:F}=Dh({sortBy:Q?.sortByDefault??"rank",sortDirection:Q?.sortDirectionDefault??"asc",timeFrame:Q?.timeFrameDefault??"24h",network:Q?.networkDefault??Ot.Mainnet,limit:10,rankAlgo:Q?.rankAlgo??"default",enableQuery:!t&&!r}),{tokens:B,perps:W}=(0,He.useMemo)(()=>U.sort((Br,Ai)=>Uk[Br.data.spamStatus??de.NotVerified]-Uk[Ai.data.spamStatus??de.NotVerified]).reduce((Br,Ai)=>(Ai.type===ae.HypercoreAsset?Br.perps.push(Ai):Br.tokens.push(Ai),Br),{tokens:[],perps:[]}),[U]),re=(0,He.useMemo)(()=>F?.items?eO(F.items):[],[F?.items]),ee=t.length===0?YU:on,Y=(0,He.useMemo)(()=>B.slice(0,d?Ua:ee),[d,B,ee]),at=(0,He.useMemo)(()=>W.slice(0,f?Ua:ee),[f,W,ee]),Ee=(0,He.useMemo)(()=>[...Y.map(kt=>L(X(kt))),...re.map(kt=>L(X(kt)))],[Y,re]),{data:St={},isLoading:Po}=Oo({query:{data:Ee},enabled:Ee.length>0}),ad=(0,He.useMemo)(()=>at.map(kt=>L(X(kt))),[at]),{data:Fe,isPending:ct}=eh(ad,!0),{data:je=[],isLoading:cr}=Lk({networkIds:P,searchQuery:t},o),ur=je.slice(0,c?Ua:on),bi=n??(()=>({data:void 0,isLoading:!1})),{data:cd,isLoading:Ga}=bi({query:t}),{results:sg=[],isSearching:ne}=uk(s&&I?t:"",{debounceMs:0}),eo=!!t,Ka=cr||O||H||Ga||ne,ig=eo&&!Ka,OI=lt(),{data:ag}=_h(OI),{actorsAll:cg,actors:ug}=(0,He.useMemo)(()=>{let kt=cd?.actors??[],Br=kt.slice(0,w?Ua:on);return{actorsAll:kt,actors:Br}},[w,cd?.actors]),lg=(0,He.useMemo)(()=>{if(_)return S?_:_.slice(0,ee)},[_,S,ee]),{predictionsAll:pg,predictions:dg}=(0,He.useMemo)(()=>{let kt=I?sg:[],Br=kt.slice(0,T?Ua:on);return{predictionsAll:kt,predictions:Br}},[sg,T,I]),Ti=(0,He.useMemo)(()=>({actors:ug,dapps:je,searchedDapps:ur,renderShowMoreDappsButton:eo&&je.length>on,isLoading:Ka,tokens:Y,perps:at,trendingTokens:re,renderShowMoreTokensButton:eo&&B.length>ee,renderShowMorePerpsButton:eo&&W.length>ee,renderShowMoreUsersButton:eo&&cg.length>on,priceMap:St,isPriceMapLoading:Po,showSearchResults:ig,showMoreTokens:d,setShowMoreTokens:m,showMorePerps:f,setShowMorePerps:g,showMoreDapps:c,setShowMoreDapps:p,showMoreUsers:w,setShowMoreUsers:y,recentlyViewedSearchItems:ag,categories:lg,showMoreCategories:S,setShowMoreCategories:b,renderShowMoreCategoriesButton:eo&&_&&_?.length>on,perpMarketMap:Fe,isPerpMarketMapLoading:ct,predictions:dg,showMorePredictions:T,setShowMorePredictions:A,renderShowMorePredictionsButton:eo&&pg.length>on}),[ug,je,ur,eo,Ka,Y,at,re,B.length,W.length,ee,cg.length,St,Po,ig,d,f,c,w,ag,lg,S,_,Fe,ct,dg,pg.length,T]),[mg,qI]=(0,He.useState)(null),zI=XU(Ka);return(0,He.useEffect)(()=>{Ti.isLoading||qI(t?Ti:null)},[Ti.isLoading,t]),{...Ti.isLoading&&mg?mg:Ti,showSpinner:zI&&eo}},"useExploreSearchList");u();l();u();l();var qk=N(z());u();l();var Ok=i(async(t,e)=>{let r=new URLSearchParams({appVersion:Re,limit:"6",locale:e,platform:Lt});t.forEach(c=>{r.append("chainIds[]",c)});let o=await G.api().noBearer().get("/explore/v1/featured-items",{params:r});if(!J(o))throw new Error("Failed to fetch featured items");let n=await o.data;if(!n.data||!Array.isArray(n.data))return[];let s=[];for(let c of n.data)try{let p=tk.parse(c);s.push(p)}catch{}return s},"getFeaturedItems");var rO=j({minutes:10}),oO=j({minutes:10}),nO=i(()=>{let{data:t}=ye(),e=(0,qk.useMemo)(()=>t?Tk(t):[],[t]),r=Yt(R.language)??"en",o=i(async()=>{if(!t)throw new Error("No account found");return Ok(e,r)},"queryFn");return te({queryKey:Ct.featuredItems(e,r),enabled:!!t,queryFn:o,gcTime:rO,staleTime:oO})},"useExploreFeaturedItems");u();l();u();l();var sO={rank:"trending",top:"top"},zk=i(async({sortBy:t,timeFrame:e,networkIDs:r,limit:o,locale:n,rankAlgo:s})=>{let c=new URLSearchParams({appVersion:Re,limit:o.toString(),locale:n,platform:Lt,rankAlgo:s,rankBy:sO[t],timeframe:e});r.forEach(m=>{c.append("chainIds[]",m)});let p=await G.api().noBearer().get("/explore/v1/trending-dapps",{params:c});if(!J(p))throw new Error("Failed to fetch sites");let d=ek.safeParse(p.data);if(!d.success)throw new Error("Failed to parse sites");return d.data},"getSitesV2");var iO=j({minutes:10}),aO=j({minutes:10}),cO=i(({sortBy:t,timeFrame:e,network:r,limit:o,rankAlgo:n})=>{let{data:s}=ye(),c=pi(r,"sites"),p=Yt(R.language)??"en";return te({queryKey:Ct.sitesV2({sortBy:t,timeFrame:e,networkIDs:c,locale:p,limit:o,rankAlgo:n}),enabled:!!s,async queryFn(){if(!s)throw new Error("No account found");return zk({sortBy:t,timeFrame:e,networkIDs:c,locale:p,limit:o,rankAlgo:n})},gcTime:aO,staleTime:iO,retry:3})},"useSitesV2");u();l();u();l();var uO={rank:"trending",top:"volume"},lO=i(t=>t.floorPrices.length>0&&t.marketplacePages.length>0,"collectionWithValueAndMarketPlace"),Qk=i(async({sortBy:t,timeFrame:e,networkIDs:r,limit:o,locale:n,rankAlgo:s})=>{let c=new URLSearchParams({appVersion:Re,limit:o.toString(),locale:n,platform:Lt,rankAlgo:s,rankBy:uO[t],timeframe:e});r.forEach(m=>{c.append("chainIds[]",m.toString())});let p=await G.api().noBearer().get("/explore/v1/trending-collections",{params:c});if(!J(p))throw new Error("Failed to fetch collections");let d=ok.safeParse(p.data);if(!d.success)throw new Error("Failed to parse collections");return{...d.data,data:d.data.data.filter(lO)}},"getCollectionsV2");var pO=j({minutes:10}),dO=j({minutes:10}),mO=i(({sortBy:t,timeFrame:e,network:r,limit:o,rankAlgo:n})=>{let{data:s}=ye(),c=pi(r,"collections"),p=Yt(R.language)??"en";return te({queryKey:Ct.collectionsV2({sortBy:t,timeFrame:e,networkIDs:c,locale:p,limit:o,rankAlgo:n}),enabled:!!s,async queryFn(){if(!s)throw new Error("No account found");return Qk({sortBy:t,timeFrame:e,networkIDs:c,locale:p,limit:o,rankAlgo:n})},gcTime:dO,staleTime:pO,retry:3})},"useCollectionsV2");u();l();u();l();var Hk=i(async(t,e)=>{let r=new URLSearchParams({appVersion:Re,locale:e,platform:Lt});t.forEach(n=>{r.append("chainIds[]",n)});let o=await G.api().noBearer().get("/explore/v1/learn-grid",{params:r});if(!J(o))throw new Error("Failed to fetch learn grid");return o.data},"getLearnItems");var fO=j({minutes:10}),hO=j({minutes:10}),gO=i(()=>{let t=ec(),e=Yt(R.language)??"en";return te({queryKey:Ct.learn(t,e),enabled:t.length>0,async queryFn(){return Hk(t,e)},gcTime:hO,staleTime:fO})},"useLearnV2");u();l();var Qn=N(Ve(),1);u();l();var hi=N(z(),1);u();l();var Bh={location:0,distance:50,threshold:.2,shouldSort:!0,keys:[{name:"token.name",weight:.4},{name:"token.symbol",weight:.4},{name:"token.caip19.chainId",weight:.2}]};var Nh=30,yO=6,Lh=3e4,Mh=5,Uh=["100","500","1000"];u();l();u();l();var di="@phantom/fiat-ramp",Oh=`${di}:fungibles`,wO=`${di}:payment-methods`,SO=`${di}:providers`,bO=`${di}:recommended-quote`,TO=`${di}:status`,AO=`${di}:completed`,nn={fiatRampTokens(t,e,r){return[Oh,t,e,r]},fiatRampPaymentMethods(t,e,r){return[wO,t,e,r]},fiatRampProviders(t,e,r){return[SO,t,e,r]},fiatRampRecommendedQuote(t,e,r){return[bO,t,e,r]},fiatRampStatus(t,e,r){return[TO,t,e,r]},fiatRampCompleted(t,e,r){return[AO,t,e,r]}};u();l();u();l();u();l();var xO=a.object({name:a.string().nullish().default(null),symbol:a.string().nullish().default(null),decimals:a.number(),caip19:Ft,logoURI:a.string().nullish().default(null)}),EO=a.object({token:xO,addressType:kg.optional()}),zh=a.object({id:a.string(),name:a.string(),tag:a.string(),logo:a.string(),quote:a.object({displaySourceAmount:a.string(),displayDestinationAmount:a.string(),displayFee:a.string()}).optional()}),On;(function(t){t.CARD="CARD",t.MOBILE_WALLET="MOBILE_WALLET",t.BANK_TRANSFER="BANK_TRANSFER",t.EXCHANGE="EXCHANGE",t.LOCAL="LOCAL"})(On||(On={}));var Qh=a.object({id:a.string(),type:a.nativeEnum(On),name:a.string(),estimatedArrival:a.string(),assets:a.object({icon:a.string(),roundIcon:a.string()}),description:a.string().optional()}),fze=a.object({groups:a.array(a.object({groupName:a.string(),tokens:a.array(EO)}))}),hze=a.object({paymentMethods:a.array(Qh),provider:zh.optional()}),gze=a.object({providers:a.array(zh),paymentMethod:Qh,token:Ft}),yze=a.object({provider:zh,paymentMethod:Qh,location:a.object({countryCode:a.string(),subdivision:a.string().optional()}).optional(),token:Ft.optional(),tokenAmount:a.string().optional(),fiatAmount:a.string().optional(),fiatCurrencyCode:a.string().optional(),minPurchaseAmount:a.string().optional(),maxPurchaseAmount:a.string().optional(),quickSelectDenominations:a.array(a.string()).optional()}),wze=a.object({url:a.string(),sessionId:a.string()}),qh;(function(t){t.PENDING="PENDING",t.COMPLETED="COMPLETED",t.FAILED="FAILED"})(qh||(qh={}));var Sze=a.object({status:a.nativeEnum(qh),tokenAmount:a.number().optional(),fiatCurrencyCode:a.string().optional(),usdFiatAmount:a.number().optional(),usdFiatFeeAmount:a.number().optional(),fiatFeeAmount:a.number().optional(),cryptoTransactionId:a.string().optional(),createdAt:a.date().optional(),updatedAt:a.date().optional()}),Vt=class extends Error{static{i(this,"FiatRampError")}constructor(e){super(e),this.name="FiatRampError"}};var Gk=new Vt("Failed to get FiatRampPaymentMethods"),Kk=i(async(t,e,r)=>{try{let o=await G.api().headers(t).bearer(r).post("/fiat_ramp/v2/onramp/payment_methods",e);if(!J(o))throw Gk;return o.data}catch{throw Gk}},"getPaymentMethods");var CO=j({days:7}),kO=j({hours:1}),Oa=i((t,e,r,o)=>{let n={"x-client-platform":t,"x-client-app-version":e,"x-client-locale":r},{data:s}=pr(),c=s?.userID,p=s?.accessToken;return te({queryKey:nn.fiatRampPaymentMethods(n,o,c),queryFn:i(()=>Kk(n,o,p),"queryFn"),gcTime:CO,staleTime:kO})},"useFiatRampPaymentMethods");u();l();u();l();var $k=new Vt("Failed to get FiatRampProviders"),jk=i(async(t,e,r)=>{try{let o=await G.api().headers(t).bearer(r).post("/fiat_ramp/v2/onramp/providers",e);if(!J(o))throw $k;return o.data}catch{throw $k}},"getProviders");var IO=j({seconds:Nh}),FO=j({hours:1}),Hh=i((t,e,r,o)=>{let n={"x-client-platform":t,"x-client-app-version":e,"x-client-locale":r},{data:s}=pr(),c=s?.userID,p=s?.accessToken;return te({queryKey:nn.fiatRampProviders(n,o,c),queryFn:i(()=>jk(n,o,p),"queryFn"),gcTime:FO,staleTime:IO,enabled:!!o.destinationAddress})},"useFiatRampProviders");u();l();u();l();var Vk=new Vt("Failed to get FiatRampRecommendedQuote"),Wk=i(async(t,e,r)=>{try{let o=await G.api().headers(t).bearer(r).post("/fiat_ramp/v2/onramp/recommended_quote",e);if(!J(o))throw Vk;return o.data}catch{throw Vk}},"getRecommendedQuote");var PO=j({days:7}),vO=j({hours:1}),$p=i((t,e,r,o,n=!0)=>{let s={"x-client-platform":t,"x-client-app-version":e,"x-client-locale":r},{data:c}=pr(),p=c?.userID,d=c?.accessToken;return te({queryKey:nn.fiatRampRecommendedQuote(s,o,p),queryFn:i(()=>Wk(s,o,d),"queryFn"),gcTime:PO,staleTime:vO,enabled:n})},"useFiatRampRecommendedQuote");u();l();u();l();var Zk=new Vt("Failed to get FiatRampTokens"),Yk=i(async(t,e,r)=>{try{let o=await G.api().headers(t).bearer(r).post("/fiat_ramp/v2/onramp/tokens",e);if(!J(o))throw Zk;return o.data}catch{throw Zk}},"getSupportedFiatRampTokens");u();l();var jp=i(t=>t.sort((e,r)=>C.compareNetworkID(e.token.caip19.chainId,r.token.caip19.chainId)),"sortFiatTokens");var _O=j({days:7}),RO=j({hours:1}),mi=i((t,e,r,o=!0,n)=>{let{data:s}=ye(),c=Array.from(new Set(s?.addresses?.map(y=>y.networkID))),p=Array.from(new Set(s?.addresses?.map(y=>y.addressType))),d={chainIDs:c},m={"x-client-platform":t,"x-client-app-version":e,"x-client-locale":r},{data:f}=pr(),g=f?.userID,w=f?.accessToken;return te({queryKey:nn.fiatRampTokens(m,d,g),queryFn:i(()=>Yk(m,d,w),"queryFn"),gcTime:_O,staleTime:RO,enabled:o&&c.length>0,select:i(y=>{let S={...y,groups:y.groups.map(b=>({...b,tokens:jp(b.tokens.filter(T=>T.addressType?p.includes(T.addressType):!0))}))};return n?n(S):S},"select")})},"useFiatRampGroupedTokens");u();l();u();l();var Xk=i(t=>{let e=t?.groups.flatMap(r=>r.tokens)??[];return jp(e)},"flattenAndSortTokens");var fi=i((t,e,r,o=!0)=>mi(t,e,r,o,Xk),"useAllFiatRampTokens");u();l();var ko={onClose:i(()=>{},"onClose"),context:"modal",fungible:void 0,purchaseAmount:"0",purchaseType:"currency",isPurchaseAmountValid:!1,error:void 0,redirectErrorMessage:void 0,ownerPublicKey:"",price:0,minPurchaseAmountUsd:Mh,maxPurchaseAmountUsd:Lh,quickSelectDenominations:Uh,paymentMethod:void 0,provider:void 0,checkoutQuoteType:"recommended",redirectURL:void 0,stripePaymentMethod:void 0},Wt=st(t=>({...ko,setState:i(e=>t(r=>({...r,...e})),"setState"),reset:i(()=>{t(ko)},"reset")}));var Jk=i(({platform:t,version:e,onClosePress:r,onNextPress:o})=>{let n=ue(),{i18n:s}=qe(),c=s.language,{setState:p}=Wt(),{data:d}=ye(),m=Array.from(new Set(d?.addresses?.map(_=>_.addressType))),{data:f=[]}=fi(t,e,c),{data:g,isPending:w,isFetching:y,isError:S}=mi(t,e,c),b=g?.groups??[],T=w||y||S,[A,E]=(0,hi.useState)(""),I=Za(A)??"",P=A.length>0,U=Qg(f,I,Bh),O=(0,hi.useCallback)(({tokenWithMetadata:_,ownerPublicKey:H})=>{let{token:Q}=_,{name:F,symbol:B,caip19:W}=Q,{chainId:re}=W;n.capture("fiatOnrampFungibleSelected",{data:{networkId:re,chainId:C.getChainID(re),asset:{name:F,symbol:B,type:"fungible"}}}),p({...ko,onClose:r,ownerPublicKey:H,fungible:_.token,paymentMethod:void 0,provider:void 0}),o()},[n,r,o,p]);return(0,hi.useEffect)(()=>{n.capture("fiatOnrampInitiated")},[n]),{enabledAddressTypes:m,groupedTokens:b,isLoading:T,isSearching:P,searchedTokens:U,searchTerm:A,selectedAccount:d,onClosePress:r,onTokenPress:O,setSearchTerm:E}},"useFiatRampSelectFungible");u();l();var Zt=N(Ve(),1);u();l();var zn=N(Ve(),1),nI=N(z(),1);u();l();var Gh=N(Ve(),1);var Kh=i(({marginBottom:t=0})=>{let{t:e}=qe(),{data:[r]}=qt(["enable-buy-flow-warning"]);return r?(0,Gh.jsx)(we,{marginBottom:t,children:(0,Gh.jsx)(dy,{level:"4-error",children:e("buyFlowHealthWarning")})}):null},"BuyFlowWarning");u();l();var sn=N(Ve(),1);u();l();var Io=N(Ve(),1);var gi=N(z(),1);u();l();var Rr=N(Ve(),1);var tI=N(z(),1);var Vp=48,$h=tI.default.memo(({networkId:t,logoURI:e,type:r})=>{let o=DO({disableBadge:!1,tokenType:r,chain:C.getChainID(t)});return(0,Rr.jsxs)(we,{size:Vp,position:"relative",children:[e?(0,Rr.jsx)(ro,{src:e,height:Vp,width:Vp,borderRadius:"circle",fallback:(0,Rr.jsx)(eI,{})}):(0,Rr.jsx)(eI,{}),o?(0,Rr.jsx)(BO,{networkId:t}):null]})}),eI=i(()=>(0,Rr.jsx)(we,{alignItems:"center",justifyContent:"center",size:Vp,backgroundColor:"areaBase",borderRadius:"circle",children:(0,Rr.jsx)(Bo.Coin,{size:"50%",color:"borderBase"})}),"TokenImageFallback"),DO=i(({disableBadge:t,tokenType:e,chain:r})=>t?!1:Cr.get(r).alwaysShowNetworkBadge?!0:!Xt(e),"showNetworkBadge"),BO=i(({networkId:t})=>(0,Rr.jsx)(we,{right:"-2",bottom:"-2",position:"absolute",borderColor:"elementBase",borderStyle:"solid",borderWidth:2,style:{borderRadius:9},children:(0,Rr.jsx)(sw,{networkID:t,size:18})}),"ChainBadge");u();l();var qn=N(Ve(),1);var rI=i(({image:t,name:e,symbol:r,onPress:o})=>(0,qn.jsx)(we,{backgroundColor:"elementBase",borderRadius:"base",padding:16,onPress:o,children:(0,qn.jsxs)(we,{gap:12,children:[t,(0,qn.jsxs)(we,{gap:4,alignItems:"flex-start",children:[(0,qn.jsx)(Pt,{children:e}),(0,qn.jsx)(Pt,{color:"textDiminished",children:r})]})]})}),"TokenCard");var qa=gi.default.memo(({enabledAddressTypes:t,selectedAccount:e,tokenWithMetadata:r,type:o,onPress:n})=>{let{token:s,addressType:c}=r,{caip19:p,logoURI:d,name:m,symbol:f}=s,{chainId:g}=p,w=qy(p),{t:y}=qe(),S=m??y("assetDetailUnknownToken"),b=(0,gi.useMemo)(()=>{let A=e?.addresses.find(E=>c?E.addressType===c&&E.networkID===g:E.networkID===g)?.address??"";return C.isEVMNetworkID(g)?A.toLowerCase():A},[e,c,g]),T=(0,gi.useCallback)(()=>{n({tokenWithMetadata:r,ownerPublicKey:b})},[n,r,b]);return c&&!t.includes(c)?(0,Io.jsx)(Io.Fragment,{}):o==="card"?(0,Io.jsx)(rI,{onPress:T,image:(0,Io.jsx)($h,{logoURI:d,networkId:p.chainId,type:w}),name:S,symbol:f}):(0,Io.jsx)(oc,{onPress:T,start:(0,Io.jsx)($h,{logoURI:d,networkId:p.chainId,type:w}),topLeft:{text:S,after:(0,Io.jsx)(iw,{networkID:p.chainId,address:b})},bottomLeft:f})});var oI=i(({enabledAddressTypes:t,group:e,groupIndex:r,selectedAccount:o,onTokenPress:n})=>{let s=r===0;return(0,sn.jsxs)(we,{marginTop:s?8:24,children:[(0,sn.jsx)(Pt,{font:an?"bodyMedium":"title3Semibold",color:"textDiminished",marginBottom:8,children:e.groupName}),(0,sn.jsx)(we,{flexWrap:"wrap",direction:"row",gap:s?0:"list",children:e.tokens.map((c,p)=>{let{token:d,addressType:m}=c,f=`${d.symbol}-${d.caip19.chainId}-${p}`;return m&&!t.includes(m)?null:s?(0,sn.jsx)(we,{flexBasis:"50%",paddingLeft:p%2===0?0:4,paddingRight:p%2===0?4:0,paddingBottom:p>=e.tokens.length-2?0:8,children:(0,sn.jsx)(qa,{enabledAddressTypes:t,selectedAccount:o,tokenWithMetadata:e.tokens[p],type:"card",onPress:n})},f):(0,sn.jsx)(qa,{tokenWithMetadata:e.tokens[p],enabledAddressTypes:t,selectedAccount:o,type:"row",onPress:n},f)})})]},e.groupName)},"FiatRampTokenGroup");var sI=nI.default.memo(({groupedTokens:t,enabledAddressTypes:e,selectedAccount:r,onTokenPress:o})=>(0,zn.jsxs)(zn.Fragment,{children:[(0,zn.jsx)(Kh,{marginBottom:16}),t.map((n,s)=>(0,zn.jsx)(oI,{enabledAddressTypes:e,group:n,groupIndex:s,onTokenPress:o,selectedAccount:r},n.groupName))]}));u();l();var yi=N(Ve(),1);var iI=N(z(),1);var aI=iI.default.memo(({enabledAddressTypes:t,searchedTokens:e,selectedAccount:r,onTokenPress:o})=>(0,yi.jsx)(yi.Fragment,{children:e.map((n,s)=>(0,yi.jsx)(we,{marginBottom:8,children:(0,yi.jsx)(qa,{enabledAddressTypes:t,selectedAccount:r,tokenWithMetadata:n,type:"row",onPress:o})},`${n.token.symbol}-${n.token.caip19.chainId}-${s}`))}));var cI=i(t=>{let{isLoading:e,isSearching:r,searchedTokens:o,selectedAccount:n,enabledAddressTypes:s,onTokenPress:c,groupedTokens:p}=t;return(0,Zt.jsx)(Zt.Fragment,{children:e?(0,Zt.jsx)(NO,{}):r?(0,Zt.jsx)(Zt.Fragment,{children:o.length>0?(0,Zt.jsx)(aI,{searchedTokens:o,selectedAccount:n,enabledAddressTypes:s,onTokenPress:c}):(0,Zt.jsx)(LO,{})}):(0,Zt.jsx)(sI,{enabledAddressTypes:s,groupedTokens:p,selectedAccount:n,onTokenPress:c})})},"FiatRampFungiblesCore"),NO=i(()=>(0,Zt.jsx)(we,{gap:"list",paddingTop:"screen",children:[...Array(3)].map((t,e)=>(0,Zt.jsx)(Yn,{topRight:!1,bottomRight:!1},e))}),"FiatRampTokensLoading"),LO=i(()=>{let{t}=qe();return(0,Zt.jsx)(we,{flex:1,alignItems:"center",justifyContent:"center",children:(0,Zt.jsx)(Pt,{font:"body",color:"textDiminished",align:"center",children:t("noBuyOptionsAvailableInCountry")})})},"FiatRampTokensEmpty");var uI={container:pd({display:"flex",flexDirection:"column",height:"100%"}),listContainer:pd({overflow:"auto",minHeight:0,paddingTop:16,paddingBottom:80})},lI=i(({platform:t,navigateToForm:e,onBackPress:r})=>{let{t:o}=qe(),n=Jk({platform:t,version:Re,onClosePress:r,onNextPress:e});return(0,Qn.jsxs)(we,{flex:1,className:uI.container,children:[(0,Qn.jsx)(py,{id:"search",label:"Search",showLabel:!1,placeholder:o("assetListSearch"),setValue:n.setSearchTerm,value:n.searchTerm||"",children:(0,Qn.jsx)(Bo.Search,{size:16,color:"textDiminished"})}),(0,Qn.jsx)(we,{flex:1,className:uI.listContainer,children:(0,Qn.jsx)(cI,{...n})})]})},"FiatRampFungibles");u();l();u();l();var fI=N(Ve(),1);u();l();var wt=N(Ve(),1);var Wp=N(z(),1);u();l();var wi=N(Ve());var pI=i(({platform:t,navigateToAllProviders:e})=>{let{t:r}=qe(),o=Wt(),{provider:n,fungible:s}=o,{currencyCode:c}=vt(),{data:p}=Oa(t,Re,R.language,{token:s?.caip19,fiatCurrencyCode:c,providerId:n?.id}),d=p?.provider||n;return(0,wi.jsxs)(we,{onPress:e,direction:"row",alignItems:"center",justifyContent:"flex-start",gap:4,children:[d?.logo&&(0,wi.jsx)(ro,{borderRadius:6,width:20,height:20,src:d?.logo}),(0,wi.jsx)(Pt,{font:"captionSemibold",color:"textBase",children:d?.name||r("fiatRampChangeProviderTitle")}),(0,wi.jsx)(Bo.ChevronDown,{size:16})]})},"FiatRampSelectedProvider");u();l();var Fo=N(Ve(),1);var dI=N(z(),1);var jh=i(({assets:t,type:e,name:r,onClick:o,estimatedArrival:n})=>{let s=(0,dI.useMemo)(()=>{let c=(0,Fo.jsx)(we,{borderRadius:"circle",size:48,alignItems:"center",justifyContent:"center",backgroundColor:"black",children:(0,Fo.jsx)(ro,{width:28,height:28,src:t.icon})});switch(e){case On.CARD:return(0,Fo.jsx)(Ii,{icon:"CreditCard",size:48,backgroundColor:"black",color:"white"});case On.BANK_TRANSFER:return(0,Fo.jsx)(Ii,{icon:"Bank",size:48,backgroundColor:"black",color:"white"});case On.MOBILE_WALLET:return r.toLowerCase().includes("apple")?(0,Fo.jsx)(Ii,{icon:"LogoApplePay",size:48,backgroundColor:"black",color:"white"}):r.toLowerCase().includes("google")?(0,Fo.jsx)(Ii,{icon:"LogoGooglePay",size:48,backgroundColor:"black",color:"white"}):c;default:return c}},[t.icon,r,e]);return(0,Fo.jsx)(my,{rows:[{type:"base",start:s,topLeft:{text:r,font:"title3Semibold"},bottomLeft:{before:(0,Fo.jsx)(Bo.Clock,{color:"textDiminished",size:14}),text:n},onPress:o}]})},"FiatRampPaymentMethodRow");var MO=["ios","android"],mI=i(({platform:t,navigateToAllProviders:e,navigateToForm:r})=>{let{t:o}=qe(),n=ue(),s=Wt(),c=Wt(E=>E.setState),{provider:p,fungible:d}=s,{currencyCode:m}=vt(),{data:f,isFetching:g,isPending:w}=Oa(t,Re,R.language,{token:d?.caip19,fiatCurrencyCode:m,providerId:p?.id}),{provider:y,paymentMethods:S}=f??{},b=y||p,T=(0,Wp.useCallback)(E=>{c({paymentMethod:E,provider:b,checkoutQuoteType:"selected"}),n.capture("fiatOnrampPaymentMethodSelected",{data:{paymentMethodId:E.id}}),r()},[n,r,b,c]),A=(0,Wp.useMemo)(()=>g||w?(0,wt.jsx)(wt.Fragment,{children:[...Array(3)].map((E,I)=>(0,wt.jsx)(Yn,{topRight:!1,bottomRight:!1},I))}):S?.length===0?(0,wt.jsx)(UO,{}):(0,wt.jsx)(wt.Fragment,{children:S?.map(E=>(0,wt.jsx)(jh,{onClick:i(()=>T(E),"onClick"),...E},E.id))}),[g,w,T,S]);return(0,wt.jsxs)(we,{gap:12,children:[!MO.includes(t)&&(0,wt.jsxs)(we,{direction:"row",alignItems:"center",gap:16,justifyContent:"space-between",children:[(0,wt.jsx)(Pt,{font:"title1Semibold",color:"textBase",children:o("fiatRampPaymentMethodsTitle")}),(0,wt.jsx)(pI,{platform:t,navigateToAllProviders:e})]}),(0,wt.jsx)(Pt,{font:"label",color:"textDiminished",children:o("buyThirdPartyScreenPaymentMethodDescription")}),(0,wt.jsx)(we,{gap:8,children:A})]})},"FiatRampPaymentMethodsCore"),UO=i(()=>{let{t}=qe();return(0,wt.jsx)(we,{flex:1,alignItems:"center",justifyContent:"center",children:(0,wt.jsx)(Pt,{font:"body",color:"textDiminished",align:"center",children:t("buyThirdPartyScreenPaymentMethodEmptyState")})})},"FiatRampPaymentMethodsEmpty");var hI=i(({platform:t,navigateToAllProviders:e,navigateToForm:r})=>(0,fI.jsx)(mI,{platform:t,navigateToAllProviders:e,navigateToForm:r}),"FiatRampPaymentMethods");u();l();var wI=N(Ve(),1);u();l();var gI=N(z(),1),Ar=N(Ve(),1);var Zp=N(z(),1);var yI=i(({platform:t,navigateToPaymentMethods:e})=>{let{t:r}=qe(),o=ue(),n=bt("enable-fiat-ramp-provider-quotes"),s=Wt(),c=Wt(I=>I.setState),{paymentMethod:p,purchaseType:d,purchaseAmount:m,fungible:f,ownerPublicKey:g}=s,{currencyCode:w}=vt(),{data:y,isFetching:S,isPending:b}=Hh(t,Re,R.language,{...d==="currency"?{fiatAmount:m}:{tokenAmount:m},token:f?.caip19,fiatCurrencyCode:w,destinationAddress:g&&f?{address:g,chainId:f?.caip19.chainId,resourceType:V.address}:void 0}),T=y?.paymentMethod||p,A=(0,Zp.useCallback)(I=>{o.capture("fiatOnrampProviderSelected",{data:{chainId:y?.token?.chainId,providerId:I.id,paymentMethodId:T?.id,destinationAmount:I.quote?.displayDestinationAmount,sourceAmount:I.quote?.displaySourceAmount,asset:y?.token,tag:I.tag}}),c({provider:I,paymentMethod:T,checkoutQuoteType:"selected"}),e?.()},[o,y?.token,c,T,e]),E=(0,Zp.useMemo)(()=>y?.providers.map((I,P)=>{let U=I.id===s.provider?.id;return n?{type:"base",start:(0,Ar.jsx)(ro,{width:48,height:48,borderRadius:6,src:I.logo}),topLeft:I.name,topRight:{text:I.quote?.displayDestinationAmount,color:"textBase"},bottomRight:I.quote?.displaySourceAmount?{text:`~${I.quote.displaySourceAmount}`}:void 0,bottomLeft:I.tag&&{text:I.tag,color:P===0?"spotPositive":"textDiminished"},onPress:i(()=>A(I),"onPress")}:{type:"radio",active:U,start:(0,Ar.jsx)(ro,{width:24,height:24,borderRadius:6,src:I.logo}),topLeft:I.name,topRight:I.tag,onPress:i(()=>A(I),"onPress")}})??[],[s.provider?.id,n,A,y?.providers]);return(0,Ar.jsxs)(we,{gap:16,children:[(0,Ar.jsx)(Pt,{font:"label",color:"textDiminished",children:r("buyThirdPartyScreenProvidersDescription")}),(0,Ar.jsx)(we,{gap:8,children:S||b?(0,Ar.jsx)(qO,{}):y?.providers.length===0?(0,Ar.jsx)(OO,{}):E.map(I=>(0,gI.createElement)(oc,{...I,key:I.topLeft}))})]})},"FiatRampProvidersCore"),OO=i(()=>{let{t}=qe();return(0,Ar.jsx)(we,{flex:1,alignItems:"center",justifyContent:"center",children:(0,Ar.jsx)(Pt,{font:"body",color:"textDiminished",align:"center",children:t("buyThirdPartyScreenProvidersEmptyState")})})},"FiatRampProvidersEmpty"),qO=i(()=>[...Array(3)].map((t,e)=>(0,Ar.jsx)(Yn,{topRight:!1,bottomRight:!1},e)),"LoadingTable");var SI=i(({platform:t,navigateToPaymentMethods:e})=>(0,wI.jsx)(yI,{platform:t,navigateToPaymentMethods:e}),"FiatRampProviders");u();l();u();l();u();l();var Hn=N(z(),1);u();l();var Yp=N(z(),1);var Vh=i(({clientPlatform:t,appVersion:e,locale:r,caip19:o,addressType:n,enabled:s=!0,destinationAddress:c})=>{let{data:p,isLoading:d,isError:m,isFetched:f}=ye(),{data:g=[],isLoading:w,isError:y,isFetched:S}=fi(t,e,r,s),b=(0,Yp.useMemo)(()=>{if(o)return g.find(A=>n&&C.getChainName(We(o).chainId)===C.bitcoin.name?L(A.token.caip19)===o&&"addressType"in A&&A.addressType===n:L(A.token.caip19)===o)},[n,o,g]),T=(0,Yp.useMemo)(()=>{if(!b)return"";if(c)return c;let A=p?.addresses.find(E=>b?.addressType?E.addressType===b.addressType&&E.networkID===b?.token.caip19.chainId:E.networkID===b?.token.caip19.chainId)?.address??"";return b?.token.caip19.chainId&&C.isEVMNetworkID(b.token.caip19.chainId)&&(A=A.toLowerCase()),A},[c,p?.addresses,b]);return(0,Yp.useMemo)(()=>({tokenToBuy:b,destinationAddress:T,isLoading:d||w,isError:m||y,isFetched:f&&S}),[T,y,m,S,f,w,d,b])},"useFiatRampTokenMetadataFromCaip19");var bI=i(({caip19:t,amount:e,clientPlatform:r,redirectURL:o,addressType:n,destinationAddress:s,provider:c,paymentMethod:p,navigateToFiatRampForm:d,onClose:m,captureAnalyticsEvent:f})=>{let{setState:g}=Wt(),{tokenToBuy:w,destinationAddress:y,isLoading:S,isError:b,isFetched:T}=Vh({clientPlatform:r,appVersion:Re,locale:R.language,caip19:t,addressType:n,destinationAddress:s}),A=(0,Hn.useMemo)(()=>{if(w)return{token:w?.token.caip19,providerId:c,paymentMethodId:p,destinationAddress:{address:y,chainId:w?.token.caip19?.chainId,resourceType:V.address}}},[w,c,p,y]),{data:E,isLoading:I}=$p(r,Re,R.language,A??{},!!A&&!!c&&!!p),P=(0,Hn.useMemo)(()=>t?I?!1:!!w&&!!y:!0,[t,I,y,w]),U=(0,Hn.useCallback)(()=>{!t||!w||!y||g({...ko,onClose:m??(()=>{}),ownerPublicKey:y,fungible:w?.token,purchaseAmount:e??ko.purchaseAmount,redirectURL:o,provider:E?.provider,paymentMethod:E?.paymentMethod})},[t,w,y,g,m,e,o,E?.provider,E?.paymentMethod]),O=(0,Hn.useCallback)(()=>{if(!t){f?.(),d?.();return}!w||!y||(U(),f?.(),d?.())},[t,f,y,d,U,w]);return(0,Hn.useMemo)(()=>({canBuy:P,openBuy:O,saturateState:U,resolvedDestinationAddress:y,token:w,isLoading:S,isError:b,isFetched:T}),[P,y,b,T,S,O,U,w])},"useBuyFlowForToken");u();l();var zO=new Vt("Failed to get FiatRampProviderUrl"),QO=i(async(t,e,r,o,n)=>{try{let s={"x-client-platform":t,"x-client-app-version":e,"x-client-locale":r},c=await G.api().headers(s).bearer(n).post("/fiat_ramp/v2/onramp/provider_url",o);if(!J(c))throw new Vt(c.data.message);return c.data}catch(s){throw s instanceof Vt?s:zO}},"getProviderUrl");u();l();var Xp=N(z());var HO=["enable","reject"],GO=i(({continueSwap:t,dismiss:e})=>{let r=ue(),{setSlippageSetting:o}=$t(),n=(0,Xp.useCallback)(c=>{switch(e(),c){case"enable":r.capture("autoSlippageOptIn",{data:{step:"enabledAutoSlippage"}}),o({type:fe.Auto}),ka();break;case"reject":r.capture("autoSlippageOptIn",{data:{step:"rejectedAutoSlippage"}}),o({type:fe.Fixed}),t();break}},[t,e,o,r]),s=(0,Xp.useMemo)(()=>HO.map(c=>({label:R.t(c==="enable"?"swapSlippageOptInEnableOption":"swapSlippageOptInRejectOption"),variant:c==="enable"?"primary":"secondary",onPress:i(()=>n(c),"onPress")})),[n]);return{title:R.t("swapSlippageOptInTitle"),description:R.t("swapSlippageOptInSubtitle"),learnMoreText:R.t("commandLearnMore"),learnMoreUrl:KA,options:s}},"useAutoSlippageOptInProps");u();l();var AI=N(z());u();l();var Si=N(z());var KO=K(1);function TI(t,e,r){let o=ue(),[n,s]=(0,Si.useState)(!1),c=(0,Si.useCallback)(async()=>{await o.capture("swapperToggleBestPriceRatio",{data:{unitCurrency:n?"buy token":"sell token"}}),s(!n)},[o,n]),p=$(m=>m.sellFungible),d=$(m=>m.buyFungible);return(0,Si.useMemo)(()=>{let m=!1,f="";if(e&&r){let g=d?.data,w=p?.data;if(g&&w){let{buyAmount:y,sellAmount:S}=r,b=Ae(y,g.decimals),T=Ae(S,w.decimals),A=b.dividedBy(T),E=`1 ${w.symbol} \u2248 ${Ss(A)} ${g.symbol}`,I=`1 ${g.symbol} \u2248 ${Ss(KO.dividedBy(A))} ${w.symbol}`;m=new K(r.buyAmount).isEqualTo(t),f=n?I:E}}return{isBestRate:m,rate:f,flip:c}},[t,r,n,e,p,d,c])}i(TI,"useExchangeRate");var $O=i(({selectProvider:t})=>{let{currentQuote:e,quoteResponse:r}=xe(),{currencySymbol:o,fromUsd:n}=vt(),s=e?.buyAmount??"",c=TI(s,r,e),p=Zc(Me(e)),d=e?.baseProvider.name??"";return{details:(0,AI.useMemo)(()=>e?le(e)?VO({quote:e,selectProvider:t,exchangeRate:c,currencySymbol:o,fromUsd:n}):jO({provider:d,sources:p,exchangeRate:c,selectProvider:t}):[],[e,d,p,c,t,o,n]),footnote:R.t("swapProviderPricingFootnote")}},"useSwapPricing"),jO=i(({provider:t,sources:e,exchangeRate:r,selectProvider:o})=>[{label:R.t("swapProviderPricingProvider"),value:t,icon:"chevron-right",onPress:o},{label:R.t("swapProviderPricingMarket"),value:e},{label:R.t("swapProviderPricingPrice"),value:r.rate,icon:"swap",onPress:r.flip}],"getStandardRows"),VO=i(({quote:t,selectProvider:e,exchangeRate:r,currencySymbol:o,fromUsd:n})=>{let s=t.baseProvider.name,c=Rs(t).toString(),p=Wr(Jo(t));return[{label:R.t("swapProviderPricingProvider"),value:s,icon:"chevron-right",onPress:e},{label:R.t("swapProviderPricingPrice"),value:r.rate,icon:"swap",onPress:r.flip},{label:R.t("swapProviderPricingFees"),value:`${o}${n(Number(c),2)} ${R.t("swapProvidersFee")}`},{label:R.t("swapProviderPricingTime"),value:p}]},"getBridgeRows");u();l();u();l();var Wh=N(z());var WO=.05,ZO=i(({sellNetworkId:t,buyNetworkId:e,destinationMinRequiredBalance:r,priceMap:o})=>{if(!t||!e||!o)return new x(0);let n=L(lr(C.getChainID(t))),s=L(lr(C.getChainID(e))),c=o[n]?.usd,p=o[s]?.usd;if(!c||!p)return new x(0);let d=Ae(r.toNumber(),C.getTokenDecimals(e)),m=Yy(d.toNumber(),p),f=Xy(m,c,C.getTokenDecimals(t));return new x(f).times(1+WO)},"getSourceBridgeFeeForMinRequiredBalance"),xI=i(({sellFungible:t,buyFungible:e})=>{let r=t?.data.chain.id,o=e?.data.chain.id,n=o??r,s=Kt(r,o),{fungible:c}=yc({key:e?.data.key}),{data:p}=ye(),d=(0,Wh.useMemo)(()=>p?.addresses.find(y=>y.networkID===n),[p,n]),f=tn().map(y=>lr(y)),{data:g}=Oo({query:{data:f},queryOptions:{refetchInterval:!1}}),{data:w=0}=dc(d);return(0,Wh.useMemo)(()=>{if(c)return new x(0);let y=new x(w);return s?ZO({sellNetworkId:r,buyNetworkId:o,destinationMinRequiredBalance:y,priceMap:g}):y},[c,w,s,r,o,g])},"useDestinationMinRequiredBalance");u();l();var Zh=N(z());var EI=i(t=>{let e=t?.data.chain.id,{data:r}=ye(),o=(0,Zh.useMemo)(()=>r?.addresses.find(s=>s.networkID===e),[r,e]),{data:n=0}=dc(o);return(0,Zh.useMemo)(()=>new x(n),[n])},"useSourceMinRequiredBalance");u();l();function CI({sellFungible:t,totalFees:e,minRequiredBalance:r,currentQuote:o}){let n=t?.type?Xt(t?.type):!1,{source:s,destination:c}=r;if(n){let p=new x(o?.sellAmount??0);return e.plus(p)}else{let p=s.plus(c);return e.plus(p)}}i(CI,"getTotalNativeRequirement");u();l();function kI({sellFungible:t,sellNativeFungible:e,totalNativeRequirement:r}){let o=t?.data.chain.id,n=e?Tt(e.data.amount,e.data.decimals):"-",s=e?Tt(r,e.data.decimals):"-";return{networkId:o,balance:n,required:s}}i(kI,"getInsufficientBalanceArgs");u();l();var II=N(z());var YO=i(({goToAssetSelect:t})=>{let{setSearchQuery:e}=$();return(0,II.useCallback)(r=>{r==="buy"&&e(""),t(r)},[t,e])},"useOnSwapAssetSelect");u();l();var ar=N(z());u();l();u();l();var Jp=class{static{i(this,"StandardProviderRowStrategy")}getRow({quote:e,buyToken:r}){let o=`${kr(Ae(e.buyAmount,r.decimals),Cr.get(r.networkId).formDisplayPrecision)} ${r.symbol}`;return{type:"standard",key:e.baseProvider.id,logoUri:e.baseProvider.logoUri,topLeft:{text:e.baseProvider.name},topRight:{text:o,color:"textDiminished"}}}getAutoRow(){return{type:"standard",key:dr,topLeft:{text:R.t("selectSwapProviderAutoLabel")},topRight:{text:R.t("selectSwapProviderAutoDescription"),color:"textDiminished"}}}},Yh=class extends Jp{static{i(this,"BridgeProviderRowStrategy")}getRow(e){let{quote:r,currencySymbol:o,fromUsd:n}=e;if(!le(r))throw new Error("Quote is not a bridge quote");let s=super.getRow(e),c=Wr(Jo(r)),p=Rs(r).toString();return{...s,type:"bridge",bottomLeft:{text:c},bottomRight:{text:`${o}${n(Number(p),2)} ${R.t("swapProvidersFee")}`}}}getAutoRow(){return{type:"bridge",key:dr,topLeft:{text:R.t("selectSwapProviderAutoLabel")},topRight:{text:R.t("selectSwapProviderAutoDescription"),color:"textDiminished"},bottomLeft:{text:R.t("selectSwapProviderAutoTBD")},bottomRight:{text:R.t("selectSwapProviderAutoTBD")}}}},Xh=new Jp,Jh=new Yh;var ed=i(({quoteResponse:t,buyToken:e,currencySymbol:r,setSelectedProvider:o,fromUsd:n})=>{let s=t.type==="xchain",c=s?Jh.getAutoRow():Xh.getAutoRow(),p={...c,onPress:i(()=>o(c.key),"onPress")},d=t.quotes.reduce((m,f)=>{let w=(s?Jh:Xh).getRow({quote:f,buyToken:e,currencySymbol:r,fromUsd:n});return[...m,{...w,onPress:i(()=>o(f.baseProvider.id),"onPress")}]},[]);return[p,...d]},"getSwapProviderRows");var FI=i(t=>t==="firstQuoteReceived"||t==="quoteProcessed","isQuoteStateValid"),XO=i(({dismiss:t})=>{let{fromUsd:e,currencySymbol:r}=vt(),o=ue(),n=rt(),s=So(b=>b.setPreferredProvider),c=So(b=>b.preferredProvider),[p,d]=(0,ar.useState)(c??dr),[m,f]=(0,ar.useState)(n.getQuoteProcessorState());(0,ar.useEffect)(()=>{let b=n.subscribeQuoteProcessor({onStateChange(T,A){f(A)}});return()=>b()},[n]);let g=(0,ar.useRef)(FI(m.type));(0,ar.useEffect)(()=>{FI(m.type)?g.current=!0:g.current&&t()},[m.type,t]);let w=(0,ar.useMemo)(()=>{if(m.type!=="firstQuoteReceived"&&m.type!=="quoteProcessed")return[];let{response:b,input:T}=m,{buy:A}=T;return ed({quoteResponse:b,buyToken:{networkId:A.data.chain.id,decimals:A.data.decimals,symbol:A.data.symbol??""},currencySymbol:r,setSelectedProvider:d,fromUsd:e})},[m,r,e]),y=(0,ar.useCallback)(()=>{let b=p===dr?void 0:p;s(b),o.capture("swapperProviderSelected",{data:{provider:b}}),t()},[p,s,t,o]),S=(0,ar.useMemo)(()=>[{theme:"secondary",disabled:!1,label:R.t("commandCancel"),onPress:t},{theme:"primary",disabled:p===(c??dr),label:R.t("commandApply"),onPress:y}],[y,t,p,c]);return{selectedProvider:p,rows:w,buttons:S}},"useSelectPreferredProvider");u();l();var Gn=N(z());var JO=i(({dismiss:t})=>{let{fromUsd:e,currencySymbol:r}=vt(),o=ue(),n=$(S=>S.quoteResponse),s=$(S=>S.buyFungible),c=$(S=>S.selectedBaseProvider),p=$(S=>S.setSelectedBaseProvider),d=So(S=>S.setPreferredProvider),[m,f]=(0,Gn.useState)(c),g=(0,Gn.useMemo)(()=>!n||!s?[]:ed({quoteResponse:n,buyToken:{networkId:s.data.chain.id,decimals:s.data.decimals,symbol:s.data.symbol??""},currencySymbol:r,setSelectedProvider:f,fromUsd:e}),[n,s,r,e,f]),w=(0,Gn.useCallback)(()=>{p(m),d(m),o.capture("swapperProviderSelected",{data:{provider:m}}),t()},[m,p,d,t,o]),y=(0,Gn.useMemo)(()=>[{background:"element",disabled:!1,label:R.t("commandCancel"),onPress:t},{background:"spot",disabled:m===c,label:R.t("commandApply"),onPress:w}],[w,t,m,c]);return{selectedProvider:m,rows:g,buttons:y}},"useSelectSwapProvider");u();l();var Qa=N(z());var za=st(t=>({isInitializeComplete:!0,swapMode:void 0,setSwapMode:i(e=>t({swapMode:e,isInitializeComplete:!1}),"setSwapMode"),setIsInitializeComplete:i(e=>t({isInitializeComplete:e}),"setIsInitializeComplete")})),e2=za.getState().setSwapMode,t2=i(()=>za(t=>t.isInitializeComplete===!1),"useInitializingClassicSwapMode"),r2=i(()=>{let t=rt(),e=ry(),r=Fn(),o=(0,Qa.useMemo)(()=>e.find(p=>r.includes(p))??Ot.Mainnet,[e,r]),n=za(p=>p.swapMode),s=za(p=>p.setSwapMode),c=za(p=>p.setIsInitializeComplete);return(0,Qa.useEffect)(()=>t.subscribeToken({onStateChange:i(p=>{p.type==="initializeCompleted"&&c(!0)},"onStateChange")}),[t,c]),(0,Qa.useMemo)(()=>{if(n)return n;let p={type:"swap",network:o,takerCaip19:void 0,takerDestinationCaip19:void 0};return s(p),p},[o,n,s])},"useClassicSwapMode");u();l();var Ye=N(z());u();l();function td(t,e,r,o){if(r==="sell")return o.includes("insufficientBalance");let n=t?.sellAmount,s=e.find(c=>c.percentage===1)?.amount.toString();return!!n&&!!s&&new x(n).gt(s)}i(td,"hasInsufficientSellBalance");var o2=i(t=>{let{tokenState:e,quotedAmounts:r,quoteProcessorState:o,sellPercentages:n,inputErrors:s,setAmount:c}=t,[p,d]=(0,Ye.useState)(void 0),[m,f]=(0,Ye.useState)(""),[g,w]=(0,Ye.useState)("crypto"),[y,S]=(0,Ye.useState)("sell"),b=(0,Ye.useRef)(!1),{currencySymbol:T,toUsd:A,fromUsd:E,formatLocalizedPrice:I}=vt(),P=hy(),{balanceDisplayStrategy:U}=Bf(),O=Hc(),_=q0(),H=rt(),Q=(0,Ye.useCallback)((Fe,ct,je,cr)=>{if(d(void 0),Fe===""){f(Fe),c({amount:"0",denomination:cr??g,perspective:ct,tokenStateOverride:je});return}let ur=jg(Fe);m2(ur)&&(f(ur),c({amount:g==="fiat"?String(A(ur)):ur,denomination:cr??g,perspective:ct,tokenStateOverride:je}))},[g,f,c,A]),F=(0,Ye.useCallback)((Fe,ct)=>{y==="buy"&&S("sell"),d(Fe);let je=Fe.getAmountForDenomination(g),cr=g==="fiat"?E(je.toString()):je.toString();f(f2(new K(cr),g,ct)),c({amount:je.toString(),denomination:g,perspective:"sell"})},[d,y,g,c,E]),B=(0,Ye.useCallback)(()=>{H.switchTokens()},[H]),W=(0,Ye.useCallback)(Fe=>{let ct=l2({perspective:y,currencyDenomination:g,quotedAmounts:r,fromUsd:E});ct&&Q(ct.toString(),y,Fe)},[g,y,Q,r,E]);(0,Ye.useEffect)(()=>H.subscribeToken({onStateChange:i((Fe,ct,je)=>{Fe.type==="switchTokens"&&(W(je),b.current=!0,H.refreshPair({swapMode:Fe.mode,cashAddresses:O,settings:_})),Fe.type==="changeToken"&&(b.current=!0,H.refreshPair({swapMode:Fe.mode,cashAddresses:O,settings:_}))},"onStateChange")}),[H,W,O,_]),(0,Ye.useEffect)(()=>{b.current&&(b.current=!1,Q(m,y))},[n]);let re=(0,Ye.useCallback)(()=>{let Fe=g==="crypto"?"fiat":"crypto";if(w(Fe),!!r)switch(Fe){case"crypto":let ct=tg(y,r);f(ct.toString());break;case"fiat":let je=eg(y,r)?.toFixed(2)??"0",cr=E(je);f(String(cr));break}},[g,y,r,E]),ee=(0,Ye.useMemo)(()=>YA(),[]),{sellAsset:Y,buyAsset:at}=PI(e),Ee=ZA({sellAsset:Y,buyAsset:at,currencyDenomination:g}),St=(0,Ye.useMemo)(()=>u2(["sell","buy"],Fe=>n2({perspective:Fe,tokenState:e,quoteProcessorState:o,currencyDenomination:g,currentPerspective:y,inputAmount:m,inputErrors:s,isBalanceHidden:P,balanceDisplayStrategy:U,sellPercentages:n,currencyDenominationSupportRules:ee,isBuyAmountEditable:Ee,quotedAmounts:r,currencySymbol:T,fromUsd:E,formatLocalizedPrice:I})),[g,m,s,P,U,n,y,o,r,e,ee,Ee,T,E,I]),Po=(0,Ye.useCallback)(()=>{Q("",y)},[Q,y]);(0,Ye.useEffect)(()=>{let Fe=H.subscribeToken({onStateChange(ct,je,cr){!mt(je)||!mt(cr)||ct.type==="changeToken"&&je.sellToken.data.tokenAddress!==cr.sellToken.data.tokenAddress&&Po()}});return()=>Fe()},[H,Po]),(0,Ye.useEffect)(()=>H.subscribeAccountChange({onAccountChange:i(Fe=>{Po(),H.stopQuoteProcessor();let ct=H.getTokenState(),je=Fe.addresses[0];mt(ct)&&je&&H.initializeSwap({swapMode:{type:"swap",network:je.networkID,takerCaip19:void 0,takerDestinationCaip19:void 0},cashAddresses:O,settings:_})},"onAccountChange")}),[H,Po,O,_]);let ad=(0,Ye.useCallback)(Fe=>{if(S(Fe),!r||!mt(e))return;let{sellAsset:ct,buyAsset:je}=PI(e);if(!(Fe==="sell"?ct:je))return;let ur,bi;switch(g){case"crypto":ur=tg(Fe,r).toString(),bi=ur;break;case"fiat":let Ga=eg(Fe,r)?.toFixed(2)??"0";ur=String(E(Ga)),bi=Ga;break}f(ur),c({amount:bi,denomination:g,perspective:Fe})},[g,r,e,E,f,c]);return{inputAmount:m,tokens:St,currencyDenomination:g,inputPerspective:y,tokenState:e,quotedAmounts:r,quoteProcessorState:o,inputErrors:s,currentSellPercentage:p,sellPercentages:n,switchTokens:B,setInputAmount:Q,switchCurrencyDenomination:re,setSellPercentage:F,clearInput:Po,setInputPerspective:ad,setCurrencyDenomination:w}},"useClassicSwapperAssets");function n2({perspective:t,tokenState:e,quoteProcessorState:r,currencyDenomination:o,currentPerspective:n,inputAmount:s,inputErrors:c,isBalanceHidden:p,balanceDisplayStrategy:d,sellPercentages:m,currencyDenominationSupportRules:f,isBuyAmountEditable:g,quotedAmounts:w,currencySymbol:y,fromUsd:S,formatLocalizedPrice:b}){if(!mt(e))return;let T=a2(t,w),A=c2(t,n,e,s,w),E=o==="crypto"?T:new K(S(A)).toFixed(2),I=d2(s);t===n?E=s:I.gt(0)||(E="");let P=f.every(B=>B.isSupported(t,e.sellToken,e.sellTokenPrice?.usd,e.buyToken,e.buyTokenPrice?.usd)),U=t==="sell"?e.sellToken:e.buyToken,O=o==="crypto"?b(new K(S(A)).toNumber()):i2(T,U),_=m.find(B=>B.percentage===1)?.amount.toString(),H=t==="sell"?_:void 0,Q=s2(w,m,n,c);return{perspective:t,fungible:U,balance:p2(U,d,p,H),amount:E,secondaryAmount:I.gt(0)?O:"",isAmountLoading:r.type==="starting"&&t!==n,isSecondaryAmountLoading:r.type==="starting",hasAmountWarning:Q,isAmountEditable:t==="sell"?!0:g,supportsCurrencyDenominationSwitching:P,amountPrefix:o==="fiat"?y:void 0,percentages:t==="sell"?m:[],warnings:t==="buy"?e.warnings:[]}}i(n2,"createSwapperAsset");function s2(t,e,r,o){return td(t,e,r,o)?!0:o.length>0}i(s2,"hasInputAmountWarning");function i2(t,e){let r=Cr.get(e.data.chain.id).formDisplayPrecision;return`${kr(new K(t),r)} ${e.data.symbol??""}`}i(i2,"formatSecondaryAmount");function a2(t,e){return e?tg(t,e).toString():"0"}i(a2,"parseCyrptoAmount");function c2(t,e,r,o,n){if(n)return eg(t,n)?.toString()??"0";{if(t!==e||!mt(r))return"0";let s=t==="sell"?r.sellTokenPrice:r.buyTokenPrice;return s?.usd?new K(o).times(s.usd).toString():"0"}}i(c2,"parseFiatAmount");function eg(t,e){switch(t){case"sell":return e?.sellAmountUsd;case"buy":return e?.buyAmountUsd}}i(eg,"getQuotedUsdAmount");function tg(t,e){switch(t){case"sell":return e.sellAmount;case"buy":return e.buyAmount}}i(tg,"getQuotedCryptoAmount");function u2(t,e){return t.reduce((r,o,n)=>{let s=e(o,n,t);return s!=null&&r.push(s),r},[])}i(u2,"compactMap");function l2({perspective:t,currencyDenomination:e,quotedAmounts:r,fromUsd:o}){if(r)switch(t){case"sell":return e==="crypto"?r.buyAmount:r.buyAmountUsd?new K(o(r.buyAmountUsd.toString(),2)):void 0;case"buy":return e==="crypto"?r.sellAmount:r.sellAmountUsd?new K(o(r.sellAmountUsd.toString(),2)):void 0}}i(l2,"getOppositeQuotedAmount");function p2(t,e,r,o){let n=o?K(o):t.data?.balance;if(!(!n||r))return Le(t)?rc(n):e.format(n,t.data?.symbol??"")}i(p2,"parseBalance");function d2(t){return t==null?new K(0):t===""?new K(0):new K(t)}i(d2,"normalizeInputAmount");function m2(t){try{let e=new K(t);return e.isFinite()?!e.isNegative():!1}catch{return!1}}i(m2,"isValidAmount");function PI(t){return mt(t)?{sellAsset:t.sellToken,buyAsset:t.buyToken}:{sellAsset:void 0,buyAsset:void 0}}i(PI,"getTokens");var f2=i((t,e,r)=>e==="fiat"?t.gte(.01)?t.decimalPlaces(2).toString():t.decimalPlaces(5,K.ROUND_UP).toString():t.decimalPlaces(r.data.decimals).toString(),"truncateDisplayAmount");u();l();var NI=N(z());u();l();var id=N(z());u();l();var h2=2e3;async function g2(t,e,r){let o,n=new Promise((s,c)=>{o=setTimeout(()=>c(new Error(r)),e)});try{return await Promise.race([t,n])}finally{o&&clearTimeout(o)}}i(g2,"withTimeout");async function y2(t,e){try{let r=Mo(e),o=new pe.PublicKey(t);return{success:!0,balance:(await r.getBalance(o,"confirmed")).toString()}}catch(r){return{success:!1,balance:void 0,error:r instanceof Error?r.message:String(r)}}}i(y2,"fetchSolanaBalanceViaRpc");async function w2(t,e){try{let r=L({chainId:e,address:t,resourceType:V.address}),o=C.getChainID(e),n=lr(o),s=L(n),c=await ow({walletCaip19s:[r],fungibleCaip19s:[s]});return!c.tokens||c.tokens.length===0?{success:!1,balance:void 0,error:"No balance data in response"}:{success:!0,balance:c.tokens[0]?.totalQuantityString??"0"}}catch(r){return{success:!1,balance:void 0,error:r instanceof Error?r.message:String(r)}}}i(w2,"fetchBalanceViaPortfolioApi");async function S2({walletAddress:t,chainId:e}){let r=w2(t,e);if(C.isSolanaNetworkID(e)){let o=await y2(t,e);if(o.success)return o}return await r}i(S2,"fetchNativeTokenBalanceInternal");async function vI({walletAddress:t,chainId:e}){try{return await g2(S2({walletAddress:t,chainId:e}),h2,"Balance request timed out")}catch(r){return{success:!1,balance:void 0,error:r instanceof Error?r.message:String(r)}}}i(vI,"fetchNativeTokenBalance");u();l();var nd=N(z());u();l();u();l();var rd=class{static{i(this,"GaslessSwapInterceptor")}gaslessSwapFeeResult;insufficientFundsInterceptor;constructor(e,r){this.gaslessSwapFeeResult=e,this.insufficientFundsInterceptor=r}intercept(e){return this.gaslessSwapFeeResult.success?"continue":this.insufficientFundsInterceptor.intercept(e)}};u();l();var od=class{static{i(this,"InsufficientFundsInterceptor")}intercept({hasInsufficientFunds:e,showInsufficientFunds:r}){return e?(r(),"interrupt"):"continue"}};var _I=i(t=>{let e=new od,r=b2(t);return r?[new rd(r,e)]:[e]},"getExecuteSwapInterceptors"),b2=i(t=>{if(t.type!=="firstQuoteReceived"&&t.type!=="quoteProcessed")return;let e=t.quote;if(Ht(e))return e.gaslessSwapFeeResult},"getGaslessSwapFeeResult");var RI=i(t=>{let e=(0,nd.useMemo)(()=>_I(t.quoteProcessorState),[t.quoteProcessorState]);return{executeSwapInterceptors:(0,nd.useCallback)(o=>{let n=o??t;for(let s of e){let c=s.intercept(n);if(c==="interrupt")return c}return"continue"},[e,t])}},"useExecuteSwapInterceptors");u();l();var sd=N(z());var DI=i((t,e)=>{let{sellFungible:r,buyFungible:o}=T2(t),n=x2(e),s=EI(r),c=xI({sellFungible:r,buyFungible:o}),p=(0,sd.useMemo)(()=>A2(e),[e]),d=(0,sd.useMemo)(()=>{if(r&&Xt(r.type)&&C.isBitcoinNetworkID(r.data.chain.id))return r.data.key;let f=r?.data.chain.id;return f?Ky(f,void 0):void 0},[r]),{fungible:m}=yc({key:d,enableSorting:!1,enablePrices:!1});return(0,sd.useMemo)(()=>{if(!r||!m||!o||!n)return{hasInsufficientFunds:!1,insufficientFundsArgs:void 0,analyticsFields:void 0,totalNativeRequirement:void 0,sellNativeFungible:void 0};if(Le(r)||Le(o))return{hasInsufficientFunds:!1,insufficientFundsArgs:void 0,analyticsFields:Sf(e),totalNativeRequirement:void 0,sellNativeFungible:void 0};let f=CI({sellFungible:r,totalFees:p,minRequiredBalance:{source:s,destination:c},currentQuote:n}),g=Sf(e);return{hasInsufficientFunds:new x(m?.data.amount??0).lt(f),insufficientFundsArgs:kI({sellFungible:r,sellNativeFungible:m,totalNativeRequirement:f}),analyticsFields:g,totalNativeRequirement:f,sellNativeFungible:m}},[r,o,n,p,s,c,m,e])},"useHasInsufficientFunds");function T2(t){return t.type!=="pair"?{sellFungible:void 0,buyFungible:void 0}:{sellFungible:t.sellToken,buyFungible:t.buyToken}}i(T2,"getTokens");function A2(t){return t.type!=="quoteProcessed"?new x(0):t.nextProcessedQuote.fees.fees.reduce((e,r)=>e.plus(r.amount),new x(0))}i(A2,"getTotalFees");function x2(t){if(t.type==="quoteProcessed")return t.quote}i(x2,"getQuote");async function E2(t,e,r){let o=await vI({walletAddress:t,chainId:e});return!o.success||o.balance===void 0?void 0:{hasSufficientFunds:new x(o.balance).gte(r),freshBalance:o.balance}}i(E2,"checkFreshBalance");var BI=i(({performSwap:t,goToInsufficientFunds:e,tokenState:r,quoteProcessorState:o})=>{let n=bt("enable-swapper-fresh-balance-check"),{hasInsufficientFunds:s,insufficientFundsArgs:c,analyticsFields:p,totalNativeRequirement:d,sellNativeFungible:m}=DI(r,o),f=(0,id.useCallback)(()=>c&&e(c,p),[e,c,p]),{executeSwapInterceptors:g}=RI({hasInsufficientFunds:s,showInsufficientFunds:f,quoteProcessorState:o}),w=(0,id.useCallback)(async()=>{let S={hasInsufficientFunds:s,showInsufficientFunds:f,quoteProcessorState:o},b;if(n&&d&&m){let A=await E2(m.data.walletAddress,m.data.chain.id,d);if(A)if(A.hasSufficientFunds)b={...S,hasInsufficientFunds:!1};else{let E={networkId:m.data.chain.id,balance:Tt(A.freshBalance,m.data.decimals),required:Tt(d,m.data.decimals)};b={...S,hasInsufficientFunds:!0,showInsufficientFunds:i(()=>e(E,p),"showInsufficientFunds")}}}g(b)==="continue"&&t()},[n,g,t,s,f,o,e,p,d,m]);return{swap:(0,id.useCallback)(()=>{w().catch(S=>{k.captureError(S instanceof Error?S:new Error(String(S)),v.Swapper)})},[w])}},"useExecuteSwapAction");var rg=class{static{i(this,"ClassicExecuteSwapStateListener")}resetSwapper;constructor(e){this.resetSwapper=e}onStateChange(e,r,o,n){e.type===Z.ExecuteSwapStarted&&this.resetSwapper()}},og=class{static{i(this,"UpdateBalancesExecuteSwapStateListener")}swapper;constructor(e){this.swapper=e}onStateChange(e,r,o,n){let{sell:s,quote:c}=o.executingQuote;if(e.type===Z.TransactionConfirmed){let p=s.data.balance?new x(s.data.balance):void 0;if(!p)return;let d=new x(c.sellAmount).shiftedBy(-s.data.decimals),m=p.minus(d);this.swapper.updateBalances({sellTokenBalance:m,sellTokenCaip19:L(X(s))})}}},C2=i(({swapMode:t,quotedAmounts:e,tokenState:r,inputErrors:o,quoteProcessorState:n,currentPerspective:s,sellPercentages:c,showFungibleDetails:p,showBuyFungibleScreen:d,retryAndNavigateToSwapper:m,resetSwapper:f,goToInsufficientFunds:g,preprocessor:w})=>{let y=rt(),S=OE(),b=(0,NI.useCallback)(()=>{S({showFungibleDetails:p,showBuyFungibleScreen:d,showRetrySwap:m,swapMode:t,executeSwapStateListeners:[new rg(f),new og(y)],quotedAmounts:e,uiContext:"swapperClassic",preprocessor:w})},[S,p,d,m,t,f,e,y,w]),{swap:T}=BI({performSwap:b,goToInsufficientFunds:g,tokenState:r,quoteProcessorState:n});return{buttonState:k2(r,o,e,n,s,c),swap:T}},"useClassicSwapperButton"),k2=i((t,e,r,o,n,s)=>t.type!=="pair"?{type:"untradable",label:""}:td(r,s,n,e)?{type:"insufficientBalance",label:R.t("swapReviewInsufficientBalance")}:o.type==="error"?{type:"untradable",label:R.t("swapNoQuotesFound")}:o.type!=="quoteProcessed"?{type:"loading",label:R.t("swapReviewFlowActionButtonPrimary")}:r?{type:"tradable",label:R.t("swapReviewFlowActionButtonPrimary")}:{type:"untradable",label:R.t("swapReviewFlowActionButtonPrimary")},"parseTradeButtonState");u();l();var ng=(ne=>(ne.Ping="ping",ne.HasOnboarded="hasOnboarded",ne.ResetHasOnboarded="resetHasOnboarded",ne.LockExtension="lockExtension",ne.UnlockExtension="unlockExtension",ne.IsExtensionUnlocked="IsExtensionUnlocked",ne.SetPassword="setPassword",ne.VerifyPassword="verifyPassword",ne.UpdatePassword="updatePassword",ne.ImportPrivateKeyAccount="importPrivateKeyAccount",ne.ImportReadOnlyAccount="importReadOnlyAccount",ne.ImportSeedAccount="importSeedAccount",ne.ImportSeedlessAccount="importSocialSeedAccount",ne.IsExistingSeed="isExistingSeed",ne.AddAccountForSeed="addAccountForSeed",ne.AddAccountForSeedless="addAccountForSeedless",ne.AddLedgerAccounts="addLedgerAccounts",ne.DeriveAddresses="deriveAddresses",ne.ExportPrivateKey="exportPrivateKey",ne.ExportEntropy="exportEntropy",ne.SetAccountIcon="setAccountIcon",ne.RemoveAccount="removeAccount",ne.ReorderAccount="reorderAccount",ne.GetAllAccounts="getAllAccounts",ne.GetAllSeeds="getAllSeeds",ne.GetAllSeedless="getAllSeedlessSeeds",ne.GetAuthenticationPublicKey="getAuthenticationPublicKey",ne.Sign="sign",ne.CheckVaultIntegrity="checkVaultIntegrity",ne.DO_NOT_USE_DiagnoseSeedCacheDigests="doNotUseDiagnoseSeedCacheDigests",ne.GetPhantomOrganization="getPhantomOrganization",ne.GetOrCreatePhantomOrganization="getOrCreatePhantomOrganization",ne.RetrieveKMSWallet="RetrieveKMSWallet",ne.GetKMSWalletStatus="GetKMSWalletStatus",ne.AddUserToCurrentUserOrganization="addUserToCurrentUserOrganization",ne.DeleteUserFromOrganization="deleteUserFromOrganization",ne.UpdateUserInOrganization="updateUserInOrganization",ne.GetAccounts="getAccounts",ne.BatchRpcCall="batchRpcCall",ne.GetKmsAccounts="getKmsAccounts",ne.GetWalletWithTag="getWalletWithTag",ne.LogMessage="logMessage",ne.DownloadLogs="downloadLogs",ne.ProviderInjectionOptions="providerInjectionOptions",ne.ServiceWorkerMutexAcquire="serviceWorkerMutexAcquire",ne.ServiceWorkerMutexRelease="serviceWorkerMutexRelease",ne))(ng||{});u();l();var Ha=N(fg(),1),nt=N(xg(),1);u();l();function Ie(t,e,r=Oe()){return{jsonrpc:"2.0",id:r,method:t,params:e}}i(Ie,"createRpcRequest");u();l();var Dr=N(xg(),1);var F2=i(async()=>{let t=Ie("getPhantomOrganization",[]),e=await ut(Dr.default.runtime,t);if("error"in e)throw new Error(e.error.message);return e.result},"getPhantomOrganization"),P2=i(async()=>{let t=Ie("getOrCreatePhantomOrganization",[]),e=await ut(Dr.default.runtime,t);if("error"in e)throw new Error(e.error.message);return e.result},"getOrCreatePhantomOrganization"),v2=i(async()=>{let t=Ie("RetrieveKMSWallet",[]),e=await ut(Dr.default.runtime,t);if("error"in e)throw new Error(e.error.message);return e.result},"retrieveKMSWallet"),Mje=i(async()=>{let t=Ie("GetKMSWalletStatus",[]),e=await ut(Dr.default.runtime,t);if("error"in e)throw new Error(e.error.message);return e.result},"getKMSWalletStatus"),Uje=i(async(t,e,r,o,n)=>{let s=Ie("addUserToCurrentUserOrganization",[t,e,r,o,n]),c=await ut(Dr.default.runtime,s);if("error"in c)throw new Error(c.error.message);return c.result},"addUserToCurrentUserOrganization"),_2=i(async(t,e)=>{let r=Ie("deleteUserFromOrganization",[t,e]),o=await ut(Dr.default.runtime,r);if("error"in o)throw new Error(o.error.message);return o.result},"deleteUserFromOrganization"),LI=i(()=>({getPhantomOrganization:i(async()=>await F2(),"getPhantomOrganization"),getOrCreatePhantomOrganization:i(async()=>await P2(),"getOrCreatePhantomOrganization"),retrieveKMSWallet:i(async()=>await v2(),"retrieveKMSWallet"),deleteUserFromOrganization:i(async({organizationId:t,username:e})=>await _2(t,e),"deleteUserFromOrganization"),getKmsAccounts:i(async()=>{let t=Ie("getKmsAccounts",[]),e=await ut(Dr.default.runtime,t);if("error"in e)throw new Error(e.error.message);return e.result},"getKmsAccounts"),getWalletWithTag:i(async({organizationId:t,tag:e})=>{let r=Ie("getWalletWithTag",[t,e]),o=await ut(Dr.default.runtime,r);if("error"in o)throw new Error(o.error.message);return o.result},"getWalletWithTag"),updateUserInOrganization:i(async({organizationId:t,username:e,newPolicy:r,addTraits:o,removeTraits:n})=>{let s=Ie("updateUserInOrganization",[t,e,n,o,r]),c=await ut(Dr.default.runtime,s);if("error"in c)throw new Error(c.error.message);return c.result},"updateUserInOrganization"),getAccounts:i(async({organizationId:t,walletId:e,accounts:r})=>{let o=Ie("getAccounts",[t,e,r]),n=await ut(Dr.default.runtime,o);if("error"in n)throw new Error(n.error.message);return n.result},"getAccounts")}),"createKMSProxy");var UI=N(Ve(),1),R2=LI(),D2=i(async(t,e,r)=>{let o=e.fold(c=>Buffer.from(c.buffer).toString("base64")),n=Ie("importPrivateKeyAccount",[t,o,r]),s=await k.startSpan("importPrivateKeyAccount",()=>ut(nt.default.runtime,n));if("error"in s)throw new Error(s.error.message);if(typeof s.result=="string")return JSON.parse(s.result);throw new Error("importPrivateKeyAccount: Invalid response from background script")},"importPrivateKeyAccount"),Yje=i(async(t,e,r)=>{let o=t.getEntropy(),n=Ie("importSeedAccount",[Ha.default.encode(o),e,r]);o.fill(0);let s=await k.startSpan("importSeedAccount",()=>ut(nt.default.runtime,n));if("error"in s)throw new Error(s.error.message);if(typeof s.result=="string")return JSON.parse(s.result);throw new Error("importS*edAccount: Invalid response from background script")},"importSeedAccount"),Xje=i(async(t,e,r)=>{let o=t.getEntropy(),n=Ie("importSocialSeedAccount",[Ha.default.encode(o),e,r]);o.fill(0);let s=await k.startSpan("importSeedlessAccount",()=>ut(nt.default.runtime,n));if("error"in s)throw new Error(s.error.message);if(typeof s.result=="string")return JSON.parse(s.result);throw new Error("importS*edlessAccount: Invalid response from background script")},"importSeedlessAccount"),Jje=i(async t=>{let e=t.getEntropy(),r=Ie("isExistingSeed",Ha.default.encode(e));e.fill(0);let o=await k.startSpan("isExistingSeed",()=>ut(nt.default.runtime,r));if("error"in o)throw new Error(o.error.message);if(typeof o.result=="boolean"||o.result===null)return o.result;throw new Error("isExistingS*ed: Invalid response from background script")},"isExistingSeed"),B2=i(async t=>{let e=Ie("addAccountForSeed",[t]),r=await k.startSpan("addAccountForSeed",async()=>Nt(await nt.default.runtime.sendMessage(Ut(e))));if("error"in r)throw new Error(r.error.message);if(typeof r.result=="string")return JSON.parse(r.result);throw new Error("addAccountForS*ed: Invalid response from background script")},"addAccountForSeed"),N2=i(async t=>{let e=Ie("addAccountForSeedless",[t]),r=await k.startSpan("addAccountForSeedless",async()=>Nt(await nt.default.runtime.sendMessage(Ut(e))));if("error"in r)throw new Error(r.error.message);if(typeof r.result=="string")return JSON.parse(r.result);throw new Error("addAccountForS*ed: Invalid response from background script")},"addAccountForSeedless"),L2=i(async(t,e)=>{let r=Ie("addLedgerAccounts",[t,e]),o=await k.startSpan("connectLedgerAccounts",async()=>Nt(await nt.default.runtime.sendMessage(Ut(r))));if("error"in o)throw new Error(o.error.message);if(typeof o.result=="string")return JSON.parse(o.result);throw new Error("connectLedgerAccounts: Invalid response from background script")},"connectLedgerAccounts"),M2=i(async t=>{let e=Ie("importReadOnlyAccount",t),r=await k.startSpan("addReadonlyAccount",async()=>Nt(await nt.default.runtime.sendMessage(Ut(e))));if("error"in r)throw new Error(r.error.message);if(typeof r.result=="string")return JSON.parse(r.result);throw new Error("addReadonlyAccount: Invalid response from background script")},"addReadonlyAccount"),e4e=i(async(t,e,r)=>{let o=Ie("exportPrivateKey",[t,e,r]),n=await k.startSpan("exportPrivateKey",async()=>Nt(await nt.default.runtime.sendMessage(Ut(o))));if("error"in n)throw new Error(n.error.message);if(typeof n.result=="string")return ud.from(Buffer.from(n.result,"hex"));throw new Error("exportPrivateKey: Invalid response from background script")},"exportPrivateKey"),t4e=i(async(t,e)=>{let r=Ie("exportEntropy",[t,e]),o=await k.startSpan("exportEntropy",async()=>Nt(await nt.default.runtime.sendMessage(Ut(r))));if("error"in o)throw new Error(o.error.message);if(typeof o.result=="string")return ud.from(Buffer.from(o.result,"hex"));throw new Error("exportEntropy: Invalid response from background script")},"exportEntropy"),U2=i(async()=>{let t=Ie("deriveAddresses",void 0),e=await ut(nt.default.runtime,t);if("error"in e)throw new Error(e.error.message);return e.result},"deriveAddresses"),O2=i(async t=>{let e=Ie("removeAccount",t),r=await ut(nt.default.runtime,e);if("error"in r)throw new Error(r.error.message);return r.result},"removeAccount"),q2=i(async(t,e)=>{let r=Ie("reorderAccount",{identifier:t,toIndex:e}),o=await ut(nt.default.runtime,r);if("error"in o)throw new Error(o.error.message);return o.result},"reorderAccount"),z2=i(async()=>{let t=Ie("getAllAccounts",void 0),e=Nt(await nt.default.runtime.sendMessage(Ut(t)));if("error"in e)throw new Error(e.error.message);if(typeof e.result=="string"){let r=JSON.parse(e.result);return zg({accounts:r}).accounts}throw new Error("fetchAllAccounts: Invalid response from background script")},"fetchAllAccounts"),Q2=i(async()=>{let t=Ie("getAllSeeds",void 0),e=Nt(await nt.default.runtime.sendMessage(Ut(t)));if("error"in e)throw new Error(e.error.message);if(typeof e.result=="string")return JSON.parse(e.result);throw new Error("fetchAllSe*dMetas: Invalid response from background script")},"fetchAllSeedMetas"),H2=i(async()=>{let t=Ie("getAllSeedlessSeeds",void 0),e=Nt(await nt.default.runtime.sendMessage(Ut(t)));if("error"in e)throw new Error(e.error.message);if(typeof e.result=="string")return JSON.parse(e.result);throw new Error("fetchAllSe*dlessMetas: Invalid response from background script")},"fetchAllSeedlessMetas"),G2=i(async t=>{let e=Ie("getAuthenticationPublicKey",{secretIdentifier:t}),r=Nt(await nt.default.runtime.sendMessage(Ut(e)));if("error"in r)throw new Error(r.error.message);if(typeof r.result=="string")return JSON.parse(r.result);throw new Error("getAuthenticationPublicK*y: Invalid response from background script")},"getAuthenticationPublicKey"),K2=i(async()=>{let t=Ie("checkVaultIntegrity",void 0),e=Nt(await nt.default.runtime.sendMessage(Ut(t)));if("error"in e)throw new Error(e.error.message);return e.result},"checkVaultIntegrity"),$2=i(async()=>{let t=Ie("doNotUseDiagnoseSeedCacheDigests",void 0),e=Nt(await nt.default.runtime.sendMessage(Ut(t)));if("error"in e)throw new Error(e.error.message);return typeof e.result=="string"?JSON.parse(e.result):null},"diagnoseSeedCacheDigestsRpc"),j2=i(async(t,e)=>{let r=ey.parse(e);"chainType"in r&&r.chainType===se.Solana&&r.signingType==="transaction"&&typeof r.message!="string"&&(r.message=Ha.default.encode(r.message));let o=Ie("sign",{accountIdentifier:t,params:r}),n=Nt(await nt.default.runtime.sendMessage(Ut(o)));if("error"in n)throw new Error(n.error.message);if(typeof n.result=="string")return Nt(n.result);throw new Error("sign: Invalid response from background script")},"sign"),MI={addAccountForSeed:B2,addReadonlyAccount:M2,importPrivateKeyAccount:D2,connectLedgerAccounts:L2,fetchAllAccounts:z2,fetchAllSeedMetas:Q2,fetchAllSeedlessMetas:H2,connectSolanaSeedVaultAccounts:i(()=>{throw new Error("Solana Seed Vault is not supported on browser extension.")},"connectSolanaSeedVaultAccounts"),deriveAddresses:U2,removeAccount:i(async t=>{if(!await O2(t))throw new Error("Error while removing account")},"removeAccount"),reorderAccount:i(async(t,e)=>{if(!await q2(t,e))throw new Error("Error while reordering account")},"reorderAccount"),sign:j2,getAuthenticationPublicKey:G2,addAccountForSeedless:N2,checkVaultIntegrity:K2,getAgentAddress:i(async()=>{throw new Error("getAgentAddress: Not implemented on browser extension")},"getAgentAddress"),getCashKMSAccount:i(async()=>{throw new Error("getCashKMSAccount: Not implemented on browser extension")},"getCashKMSAccount"),updateCashAccountMapping:i(async()=>{throw new Error("updateCashAccountMapping: Not implemented on browser extension")},"updateCashAccountMapping"),getKMSInstance:i(()=>R2,"getKMSInstance"),addKMSVaultAccount:i(()=>{throw new Error("addKMSVaultAccount: Only callable from background script, not UI")},"addKMSVaultAccount"),canDeriveKMSAuthenticator:i(()=>{throw new Error("canDeriveKMSAuthenticator: Not implemented on browser extension")},"canDeriveKMSAuthenticator"),DO_NOT_USE_diagnoseSeedCacheDigests:i(async()=>{let t=await $2();if(!t)throw new Error("DO_NOT_USE_diagnoseSeedCacheDigests: Vault locked");return t},"DO_NOT_USE_diagnoseSeedCacheDigests")},r4e=i(()=>MI,"getVaultProxy");function o4e({children:t}){return(0,UI.jsx)(Og,{vault:MI,children:t})}i(o4e,"VaultProxyProvider");export{fF as a,aF as b,qr as c,zo as d,cF as e,bc as f,Pd as g,ln as h,_d as i,hF as j,gF as k,Rd as l,pn as m,_t as n,sm as o,im as p,dn as q,Xd as r,TF as s,AF as t,xF as u,oS as v,DF as w,kF as x,fS as y,LOe as z,_r as A,_Me as B,Ma as C,nO as D,Ph as E,EU as F,Un as G,KE as H,Zl as I,WE as J,en as K,it as L,dr as M,$ as N,cm as O,um as P,JF as Q,le as R,fe as S,$t as T,Bs as U,B0 as V,Ce as W,Z as X,Ns as Y,L0 as Z,ff as _,mt as $,h1 as aa,rt as ba,A1 as ca,E1 as da,g1 as ea,nl as fa,ooe as ga,sl as ha,loe as ia,il as ja,yoe as ka,y1 as la,D1 as ma,Tf as na,SB as oa,wr as pa,kB as qa,IB as ra,vB as sa,wN as ta,GB as ua,KB as va,zf as wa,DB as xa,Fn as ya,Mf as za,WB as Aa,YB as Ba,tN as Ca,Khe as Da,$he as Ea,jhe as Fa,nN as Ga,ege as Ha,tge as Ia,sN as Ja,cge as Ka,uge as La,zB as Ma,aN as Na,Uf as Oa,yN as Pa,QB as Qa,HB as Ra,SN as Sa,Bl as Ta,kx as Ua,CN as Va,th as Wa,eL as Xa,tL as Ya,sL as Za,vL as _a,qE as $a,LL as ab,RL as bb,ML as cb,lLe as db,Op as eb,jLe as fb,KM as gb,iMe as hb,fMe as ib,qM as jb,zM as kb,kh as lb,Ih as mb,Fh as nb,_U as ob,RU as pb,Dh as qb,tO as rb,cO as sb,mO as tb,gO as ub,yO as vb,Lh as wb,Mh as xb,Uh as yb,Wt as zb,Oh as Ab,$p as Bb,bI as Cb,lI as Db,hI as Eb,SI as Fb,QO as Gb,GO as Hb,YO as Ib,XO as Jb,JO as Kb,$O as Lb,t2 as Mb,r2 as Nb,o2 as Ob,C2 as Pb,ng as Qb,Ie as Rb,v2 as Sb,Mje as Tb,Uje as Ub,LI as Vb,Yje as Wb,Xje as Xb,Jje as Yb,e4e as Zb,t4e as _b,H2 as $b,r4e as ac,o4e as bc};
/*! Bundled license information:

use-sync-external-store/cjs/use-sync-external-store-shim.production.js:
  (**
   * @license React
   * use-sync-external-store-shim.production.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

use-sync-external-store/cjs/use-sync-external-store-shim.development.js:
  (**
   * @license React
   * use-sync-external-store-shim.development.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

use-sync-external-store/cjs/use-sync-external-store-shim/with-selector.production.js:
  (**
   * @license React
   * use-sync-external-store-shim/with-selector.production.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

use-sync-external-store/cjs/use-sync-external-store-shim/with-selector.development.js:
  (**
   * @license React
   * use-sync-external-store-shim/with-selector.development.js
   *
   * Copyright (c) Meta Platforms, Inc. and affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

pako/dist/pako.esm.mjs:
  (*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) *)
*/
//# sourceMappingURL=chunk-44HH5QGP.js.map
