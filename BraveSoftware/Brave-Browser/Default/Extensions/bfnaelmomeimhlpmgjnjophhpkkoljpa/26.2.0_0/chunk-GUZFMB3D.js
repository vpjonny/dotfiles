import{a as E6,f as n6,g as a6}from"./chunk-CTKHELYY.js";import{Ka as YA,Kb as k6,Sb as s6,X as B6,cb as e6,ea as UA,ia as JA,o as VA}from"./chunk-W7IWPUIQ.js";import{$ as Zj,Ad as A6,B as Z,E as AA,G as Fj,H as g,I as u,L as p,Lb as z,Yd as j6,_ as CA,ba as XA,ee as r6,je as lj,qd as jA,sd as rA,vd as KA,wd as aA}from"./chunk-DJGGVTSJ.js";import{b as eA}from"./chunk-2RWUL32J.js";import{Z as t6,a as gA,b as d7,j as w,m as $j,q as ij,s as qj}from"./chunk-LQZGQEJ6.js";import{a as B,e as G7,g as GA,i as n,m as Buffer,n as a}from"./chunk-WKJYWAXG.js";n();a();n();a();n();a();function xA(A){if(!Number.isSafeInteger(A)||A<0)throw new Error(`positive integer expected, not ${A}`)}B(xA,"number");function cj(A){if(typeof A!="boolean")throw new Error(`boolean expected, not ${A}`)}B(cj,"bool");function Gj(A){return A instanceof Uint8Array||A!=null&&typeof A=="object"&&A.constructor.name==="Uint8Array"}B(Gj,"isBytes");function U(A,...j){if(!Gj(A))throw new Error("Uint8Array expected");if(j.length>0&&!j.includes(A.length))throw new Error(`Uint8Array expected of length ${j}, not of length=${A.length}`)}B(U,"bytes");function dj(A,j=!0){if(A.destroyed)throw new Error("Hash instance has been destroyed");if(j&&A.finished)throw new Error("Hash#digest() has already been called")}B(dj,"exists");function o6(A,j){U(A);let r=j.outputLen;if(A.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}B(o6,"output");var oA=B(A=>new Uint32Array(A.buffer,A.byteOffset,Math.floor(A.byteLength/4)),"u32"),$6=B(A=>new DataView(A.buffer,A.byteOffset,A.byteLength),"createView"),I7=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!I7)throw new Error("Non little-endian hardware is not supported");function Ij(A){if(typeof A!="string")throw new Error(`string expected, got ${typeof A}`);return new Uint8Array(new TextEncoder().encode(A))}B(Ij,"utf8ToBytes");function zA(A){if(typeof A=="string")A=Ij(A);else if(Gj(A))A=A.slice();else throw new Error(`Uint8Array expected, got ${typeof A}`);return A}B(zA,"toBytes");function i6(...A){let j=0;for(let t=0;t<A.length;t++){let e=A[t];U(e),j+=e.length}let r=new Uint8Array(j);for(let t=0,e=0;t<A.length;t++){let s=A[t];r.set(s,e),e+=s.length}return r}B(i6,"concatBytes");function q6(A,j){if(j==null||typeof j!="object")throw new Error("options must be defined");return Object.assign(A,j)}B(q6,"checkOpts");function F6(A,j){if(A.length!==j.length)return!1;let r=0;for(let t=0;t<A.length;t++)r|=A[t]^j[t];return r===0}B(F6,"equalBytes");var uj=B((A,j)=>(Object.assign(j,A),j),"wrapCipher");function pj(A,j,r,t){if(typeof A.setBigUint64=="function")return A.setBigUint64(j,r,t);let e=BigInt(32),s=BigInt(4294967295),k=Number(r>>e&s),E=Number(r&s),o=t?4:0,i=t?0:4;A.setUint32(j+o,k,t),A.setUint32(j+i,E,t)}B(pj,"setBigUint64");n();a();var l6;(function(A){A.Initial="initial",A.Create="create",A.ImportSeed="importSeed",A.ImportPrivateKey="importPrivateKey",A.ConnectHardware="connectHardware",A.SeedlessRecover="seedlessRecover",A.SeedlessBackup="seedlessBackup",A.SeedVault="seedVault",A.Append="append"})(l6||(l6={}));var u7=w.object({balance:w.boolean(),history:w.boolean()}),zr=w.record(w.string(),u7),HA=class extends Error{static{B(this,"SetTermsAcknowledgementError")}constructor(j){super(j),this.name="SetTermsAcknowledgementError"}};var DA;(function(A){A.FirstTimeOnboarding="firstTimeOnboarding",A.IsResettingApp="isResettingApp",A.OnBoardedAt="onboardedAt"})(DA||(DA={}));var tt=B(async(A,j)=>{try{return await A.set(YA.TermsHaveBeenAcknowledgedLastSeenVersion,j)}catch{throw new HA("Error Setting Terms Acknowledgement")}},"setTermsAcknowledgement"),Bt=B(async A=>await A.get(YA.TermsHaveBeenAcknowledgedLastSeenVersion)??0,"getTermsAcknowledgementLastSeenVersion"),et=B(async A=>{try{return await A.remove(YA.TermsHaveBeenAcknowledgedLastSeenVersion)}catch{throw new HA("Error Clearing Terms Acknowledgement")}},"clearTermsAcknowledgement");n();a();var c6=GA(d7()),WA=GA(gA());var G6=(0,WA.createContext)(null);function p7({children:A,seedlessRepository:j}){return(0,c6.jsx)(G6.Provider,{value:{seedlessRepository:j},children:A})}B(p7,"SeedlessProvider");function v7(){let A=(0,WA.useContext)(G6);if(!A)throw new Error("useSeedlessContext must be used within a SeedlessProvider");return A}B(v7,"useSeedlessContext");function R(){return v7().seedlessRepository}B(R,"useSeedlessRepository");n();a();n();a();var O7=w.record(w.string(),w.number()),f7=w.object({type:w.union([w.literal("Buffer"),w.literal("Object")]),data:w.array(w.number())}),m7=w.union([O7,f7]),d6=w.object({seeds:w.array(w.tuple([w.string(),m7]))}),I6=B(A=>h7(A)?new Uint8Array(Buffer.from(A.data)):new Uint8Array(Object.values(A)),"bundleBytesLikeToUint8Array"),h7=B(A=>!!A&&typeof A=="object"&&lj("type",A)&&typeof A.type=="string"&&lj("data",A)&&Array.isArray(A.data)&&A.data.every(j=>!Number.isNaN(parseInt(j))),"isSerializedBuffer"),u6=w.object({deviceId:w.string(),encryptionKey:w.string().length(44).base64()}),dA;(function(A){A.RotationResult="seedlessRotationResult",A.RecoverResult="seedlessRecoverResult",A.BackupResult="seedlessBackupResult"})(dA||(dA={}));n();a();n();a();var kA="/seedless",M7="https://phantom-wallet.zendesk.com/hc/en-us/articles/32775281256851";var p6="/seedless";n();a();var bA=class extends Error{static{B(this,"JuiceboxBackupError")}reasonString;reasonCode;constructor(j){super("Failed to backup share from Juicebox"),this.reasonCode=j,this.reasonString=QA[j]}},_A=class extends Error{static{B(this,"JuiceboxRecoverError")}guessesRemaining;reasonString;reasonCode;constructor(j,r){super("Failed to recover share from Juicebox"),this.guessesRemaining=r,this.reasonCode=j,this.reasonString=tA[j]}},TA=class extends Error{static{B(this,"JuiceboxDeleteError")}reasonString;reasonCode;constructor(j){super("Failed to delete share from Juicebox"),this.reasonCode=j,this.reasonString=vj[j]}},QA;(function(A){A[A.InvalidAuth=0]="InvalidAuth",A[A.UpgradeRequired=1]="UpgradeRequired",A[A.Assertion=2]="Assertion",A[A.Transient=3]="Transient"})(QA||(QA={}));var tA;(function(A){A[A.InvalidPin=0]="InvalidPin",A[A.NotRegistered=1]="NotRegistered",A[A.InvalidAuth=2]="InvalidAuth",A[A.UpgradeRequired=3]="UpgradeRequired",A[A.Assertion=4]="Assertion",A[A.Transient=5]="Transient",A[A.CooldownTimer=6]="CooldownTimer"})(tA||(tA={}));var vj;(function(A){A[A.InvalidAuth=0]="InvalidAuth",A[A.UpgradeRequired=1]="UpgradeRequired",A[A.RateLimitExceeded=2]="RateLimitExceeded",A[A.Assertion=3]="Assertion",A[A.Transient=4]="Transient"})(vj||(vj={}));var g7=B(A=>ZA(A)||v6(A)||O6(A),"isJuiceboxError"),ZA=B(A=>A instanceof _A,"isJuiceboxRecoverError"),v6=B(A=>A instanceof bA,"isJuiceboxBackupError"),O6=B(A=>A instanceof TA,"isJuiceboxDeleteError");globalThis.JuiceboxGetAuthToken=async A=>{let j=Buffer.from(A).toString("hex");return globalThis.JuiceboxTokens[j]};var Oj=class{static{B(this,"JuiceboxClient")}encoder;provider;constructor(j){this.encoder=new TextEncoder,this.provider=j}async getJwts(j){let r=await Z.api().bearer(j).post(`${p6}/v1/juiceboxtoken`);(AA(r)||r.status===304)&&this.provider.setJuiceboxTokens(r.data)}async sendJuiceboxShare(j,r,t,e){await this.getJwts(e);try{await this.provider.backupShare(j,r,this.encoder.encode(t),this.encoder.encode("phantom"),7),p.addBreadcrumb(u.Seedless,"Successful backup share to Juicebox",g.Debug)}catch(s){p.addBreadcrumb(u.Seedless,"Failed to backup share to Juicebox",g.Error);let k=new bA(s);throw p.captureError(k,u.Seedless),k}return!0}async getJuiceboxShare(j,r,t){await this.getJwts(t);try{let e=await this.provider.recoverShare(j,this.encoder.encode(r),this.encoder.encode("phantom"));return p.addBreadcrumb(u.Seedless,"Successfully recovered share from Juicebox",g.Debug),e}catch(e){let s=e.reason,k=e.guessesRemaining!==void 0?e.guessesRemaining:e.guesses_remaining;p.addBreadcrumb(u.Seedless,"Failed to recover share from Juicebox",g.Error);let E=new _A(s,k);throw p.captureError(E,u.Seedless),E}}async deleteShare(j,r){await this.getJwts(r);try{await this.provider.deleteShare(j),p.addBreadcrumb(u.Seedless,"Successfully deleted share from Juicebox",g.Debug)}catch(t){p.addBreadcrumb(u.Seedless,"Failed to delete share from Juicebox",g.Error);let e=new TA(t);throw p.captureError(e,u.Seedless),e}}};n();a();n();a();var fj="@phantom/seedless",IA={hasSeedlessBundle:["seedless",`${fj}:has_seedless_bundle`],needsBundleUpdate:["seedless",`${fj}:needs_bundle_update`],timeLeftCooldown:["seedless",`${fj}:time_left_cooldown`]};function K7({enabled:A=!0}={}){let j=IA.hasSeedlessBundle,r=R(),t=JA();return KA({enabled:t&&A,queryKey:j,queryFn:B(async()=>await r.hasSeedlessBundle(),"queryFn")})}B(K7,"useHasSeedlessBundle");n();a();n();a();var qA=B(async A=>{await A.invalidateQueries({queryKey:IA.hasSeedlessBundle})},"invalidateHasSeedlessBundle"),sA=B(async A=>{await A.invalidateQueries({queryKey:IA.needsBundleUpdate})},"invalidateNeedsBundleUpdate");function x7(){let A=R(),j=jA(),r=eA();return rA({mutationFn:B(async({entropy:t,pin:e})=>await A.backup(t,e),"mutationFn"),onSuccess:B(async()=>{r.capture("seedlessBackupSuccess"),await qA(j),await sA(j)},"onSuccess"),onError:B(()=>{r.capture("seedlessBackupError")},"onError")})}B(x7,"useBackup");n();a();function mj(){let A=R(),j=jA(),r=eA();return rA({mutationFn:B(async e=>await A.recover(e),"mutationFn"),onSuccess:B(async()=>{r.capture("seedlessRecoverSuccess"),await sA(j)},"onSuccess"),onError:B(()=>{r.capture("seedlessRecoverError")},"onError")})}B(mj,"useRecover");n();a();function b7(){let A=R(),j=eA();return rA({mutationFn:B(async t=>{await A.verifyPin(t)},"mutationFn"),onSuccess:B(()=>{p.addBreadcrumb(u.Seedless,"Successfully verified PIN",g.Info),j.capture("seedlessVerifyPinSuccess")},"onSuccess"),onError:B(()=>{p.addBreadcrumb(u.Seedless,"Failed to verify PIN",g.Error),j.capture("seedlessVerifyPinError")},"onError")})}B(b7,"useVerifyPin");n();a();function _7(){let A=R(),j=jA();return rA({mutationFn:B(async()=>await A.deleteBundle(),"mutationFn"),onSuccess:B(async()=>{await qA(j),await sA(j)},"onSuccess")})}B(_7,"useDeleteBundle");n();a();function y7(){let A=R(),j=eA();return rA({mutationFn:B(async t=>await A.resetBundleFromDevice(t.pin,t.seedlessEntropies),"mutationFn"),onSuccess:B(()=>{p.addBreadcrumb(u.Seedless,"Successfully reset bundle from device",g.Info),j.capture("seedlessResetPinSuccess")},"onSuccess"),onError:B(()=>{p.addBreadcrumb(u.Seedless,"Failed to reset bundle from device",g.Error),j.capture("seedlessResetPinError")},"onError")})}B(y7,"useResetBundleFromDevice");n();a();var w7=1e3,P7=500;function hj(){let A=IA.timeLeftCooldown,j=R(),r=JA();return KA({enabled:r,queryKey:A,queryFn:B(async()=>await j.timeLeftCooldown(),"queryFn"),refetchInterval:w7,refetchOnMount:"always",staleTime:P7})}B(hj,"useTimeLeftCooldown");n();a();var Aj=GA(gA());var f6=1e3,m6=B(()=>{let[A,j]=(0,Aj.useState)(0);return(0,Aj.useEffect)(()=>{if(!A)return;let r=setInterval(async()=>{j(A-f6)},f6);return()=>clearInterval(r)},[A]),{cooldownTimer:A,setCooldownTimer:j}},"useCheckCooldownTimer");n();a();var h6=GA(gA());var H7=B(()=>{let A=jA(),j=R(),r=UA(),t=s6(),e=e6();return(0,h6.useCallback)(async()=>{await r.deleteAllAuthFactors(),await t.patchUserProfile({privacyState:k6.INVISIBLE,addresses:e.reduce((s,k)=>(s[k]="",s),{})}),await j.deleteAllBundles(),await j.deleteJuiceboxShare(),await qA(A),await sA(A)},[j,r,t,A,e])},"useDeleteSeedlessProfile");n();a();var M6=GA(gA());var D7="seedless-pin-verification-timer-in-ms",T7=w.coerce.number().positive().lte(2147483647).transform(A=>Math.max(A,1e3)).catch(2147483647).default(2147483647),L7=B(()=>{let A=R(),j=(0,M6.useMemo)(()=>{let t=r6.getMultivariateAssignment(D7,{dependent_flag:"enable-seedless-pin-verification-interstitial",variation_served:"true"});return T7.parse(t)},[]),r=B(async()=>{let{expired:t,timestampInMs:e}=await A.getPinVerificationTimer({pinVerificationExpiryInMs:j});return{expired:t,timestampInMs:e}},"queryFn");return KA({queryKey:[aA.SeedlessPinVerificationLockTimerInMs],queryFn:r,refetchInterval:j??2147483647,staleTime:j??2147483647})},"useSeedlessPinVerificationTimer");n();a();var Mj=B(()=>{let A=jA(),j=R();return rA({mutationFn:B(async()=>{p.addBreadcrumb(u.Seedless,"Resetting PIN verification timer",g.Info),await j.setPinVerificationTimer(Date.now())},"mutationFn"),onSuccess:B(async()=>{p.addBreadcrumb(u.Seedless,"Successfully reset PIN verification timer",g.Info),await A.invalidateQueries({queryKey:[aA.SeedlessPinVerificationLockTimerInMs]})},"onSuccess"),onError:B(()=>{p.addBreadcrumb(u.Seedless,"Failed to reset PIN verification timer",g.Error)},"onError")})},"useResetSeedlessPinVerificationTimer");n();a();var FA=B(A=>{let j=gj(A),r=JSON.stringify(j),t=typeof r=="string"?r:String(r),e=typeof TextEncoder<"u"?new TextEncoder().encode(t):Buffer.from(t,"utf8");return CA(A6(e instanceof Uint8Array?e:Uint8Array.from(e)))},"hashJSON");function jj(A){return/^\d+$/.test(A)}B(jj,"isNumeric");var iA=B(A=>A.length!==4?!1:jj(A),"isValidPin"),gj=B(A=>{if(Array.isArray(A))return A.map(j=>typeof j=="object"?gj(j):j).sort();if(typeof A=="object"&&A!==null){let j={},r=Object.keys(A).sort();for(let t of r)j[t]=gj(A[t]);return j}else return A},"sortKeys"),Kj=B(A=>{let j=Math.max(0,Math.floor(A/1e3)),r=Math.floor(j/60).toString(),t=j%60>9?`${j%60}`:`0${j%60}`;return{minutes:r,seconds:t}},"extractMinutesAndSeconds");n();a();var lA=GA(gA());n();a();var yA=class extends Error{static{B(this,"SeedlessRecoverError")}result;constructor(j){super(`Unable to recover seedless bundle: ${j.type}`),this.result=j}},rj=class extends Error{static{B(this,"SeedlessBackupError")}result;constructor(j){super(`Unable to backup seedless bundle: ${j.type}`),this.result=j}},wA=B(A=>A instanceof yA,"isSeedlessRecoverError"),N7=B(A=>wA(A)&&A.result.type==="unauthorized","isSeedlessUnauthorizedError"),xj=B(A=>wA(A)&&A.result.type==="error-juicebox-recover"&&A.result.reason===tA.InvalidPin,"isSeedlessInvalidPinError"),bj=B(A=>wA(A)&&A.result.type==="cooldown","isSeedlessCooldownError"),_j=B(A=>wA(A)&&A.result.type==="upgrade-required","isSeedlessUpgradeRequiredError"),yj=B(A=>wA(A)&&A.result.type==="error-juicebox-recover"&&A.result.reason===tA.NotRegistered,"isSeedlessJuiceboxNotRegisteredError");var S7=B(({hasEnrolledAuthentication:A,onOnboardingDone:j,onOnboardingProtect:r,onImportAndSyncAccounts:t,onForgot:e,onNotRegisteredError:s})=>{let{t:k}=t6(),E=eA(),{refetch:o}=hj(),{mutateAsync:i}=Mj(),{mutateAsync:$}=mj(),F=j6("enable-cleanup-on-not-registered-error"),[m,O]=(0,lA.useState)(!1),[l,I]=(0,lA.useState)({isInvalidPin:!1,triesLeft:void 0,pin:""}),[G,M]=(0,lA.useState)(!1),{cooldownTimer:f,setCooldownTimer:K}=m6(),{minutes:x,seconds:Q}=Kj(f),[P,V]=(0,lA.useState)(null);return(0,lA.useEffect)(()=>{!l.triesLeft||l.triesLeft>0||e()},[l.triesLeft,e]),(0,lA.useEffect)(()=>{B(async()=>{let{data:h=0}=await o();return h},"refetchTimer")().then(h=>K(h))},[o,K]),{isLoading:G,isError:m,handleInput:B(v=>{I(h=>({...h,isInvalidPin:v!==""&&!jj(v),pin:v}))},"handleInput"),onSubmit:B(async()=>{if(!G){if(!iA(l.pin)){I(v=>({...v,isInvalidPin:!0,triesLeft:void 0,pin:""}));return}try{M(!0),O(!1),I(h=>({...h,isInvalidPin:!1,triesLeft:void 0}));let{entropy:v}=await $(l.pin);await t(v),await i(),E.capture("seedlessEnterPinContinue"),!A&&j?j():r?.()}catch(v){if(xj(v)||bj(v)){let h;if("guessesRemaining"in v.result&&(h=v.result.guessesRemaining),h===0){I(b=>({...b,isInvalidPin:!0,triesLeft:h,pin:""})),e();return}let _=!1;"reason"in v.result&&v.result.reason===tA.InvalidPin&&(_=!0);let{data:y=0}=await o();K(y),E.capture("seedlessPinError",{data:{triesLeft:h,cooldownTimer:y}}),I(b=>({...b,isInvalidPin:_,triesLeft:h,pin:""}))}else if(_j(v))O(!0),V({title:k("seedlessRecoverErrorUpgradeRequiredTitle"),description:k("seedlessRecoverErrorUpgradeRequiredDescription")});else if(yj(v)&&s&&F){p.captureError(v,u.Seedless);try{await s(l.pin)}catch(h){p.captureError(h,u.Seedless),O(!0),V({title:k("seedlessEnterPinUnknownErrorPrimaryText"),description:k("seedlessEnterPinUnknownErrorSecondaryText"),buttonText:k("seedlessTryAgain")})}}else p.captureError(v,u.Seedless),O(!0),V({title:k("seedlessEnterPinUnknownErrorPrimaryText"),description:k("seedlessEnterPinUnknownErrorSecondaryText"),buttonText:k("seedlessTryAgain")})}finally{M(!1)}}},"onSubmit"),onForgot:e,pinAttemptsLeft:l.triesLeft,isPinError:l.isInvalidPin,hasCooldownTimer:f>0,disabled:f>0||l.isInvalidPin||!l.pin||l.pin.length<4,pin:l.pin,continueButtonText:k("seedlessContinueText"),forgotButtonText:k("seedlessVerifyPinForgotButtonText"),attemptsLeftText:k("seedlessEnterPinNumTriesLeft",{numTries:l.triesLeft}),cooldownTimerText:k("seedlessEnterPinCooldown",{minutesLeft:x,secondsLeft:Q}),invalidPinText:k("seedlessEnterPinInvalidPinError"),title:k("seedlessEnterPinPrimaryText"),loadingTitle:k("seedlessLoadingWalletPrimaryText"),loadingDescription:k("seedlessLoadingWalletSecondaryText"),errorTitle:P?P.title:k("seedlessLoadingWalletErrorPrimaryText"),errorDescription:P?P.description:k("seedlessErrorSecondaryText"),tryAgainButtonText:P?P.buttonText:k("seedlessTryAgain")}},"useSeedlessEnterPinProps");n();a();var g6=GA(gA());var R7=B(()=>{let A=R(),j=UA(),r=jA();return(0,g6.useCallback)(async()=>{await A.deleteAllBundles(),await j.deleteAllAuthFactors(),await qA(r),await sA(r)},[A,j,r])},"useDeleteSeedlessBundles");n();a();n();a();var rk=new Error("timeout while waiting for mutex to become available"),tk=new Error("mutex already locked"),C7=new Error("request for lock canceled"),X7=function(A,j,r,t){function e(s){return s instanceof r?s:new r(function(k){k(s)})}return B(e,"adopt"),new(r||(r=Promise))(function(s,k){function E($){try{i(t.next($))}catch(F){k(F)}}B(E,"fulfilled");function o($){try{i(t.throw($))}catch(F){k(F)}}B(o,"rejected");function i($){$.done?s($.value):e($.value).then(E,o)}B(i,"step"),i((t=t.apply(A,j||[])).next())})},wj=class{static{B(this,"Semaphore")}constructor(j,r=C7){this._value=j,this._cancelError=r,this._weightedQueues=[],this._weightedWaiters=[]}acquire(j=1){if(j<=0)throw new Error(`invalid weight ${j}: must be positive`);return new Promise((r,t)=>{this._weightedQueues[j-1]||(this._weightedQueues[j-1]=[]),this._weightedQueues[j-1].push({resolve:r,reject:t}),this._dispatch()})}runExclusive(j,r=1){return X7(this,void 0,void 0,function*(){let[t,e]=yield this.acquire(r);try{return yield j(t)}finally{e()}})}waitForUnlock(j=1){if(j<=0)throw new Error(`invalid weight ${j}: must be positive`);return new Promise(r=>{this._weightedWaiters[j-1]||(this._weightedWaiters[j-1]=[]),this._weightedWaiters[j-1].push(r),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(j){this._value=j,this._dispatch()}release(j=1){if(j<=0)throw new Error(`invalid weight ${j}: must be positive`);this._value+=j,this._dispatch()}cancel(){this._weightedQueues.forEach(j=>j.forEach(r=>r.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var j;for(let r=this._value;r>0;r--){let t=(j=this._weightedQueues[r-1])===null||j===void 0?void 0:j.shift();if(!t)continue;let e=this._value,s=r;this._value-=r,r=this._value+1,t.resolve([e,this._newReleaser(s)])}this._drainUnlockWaiters()}_newReleaser(j){let r=!1;return()=>{r||(r=!0,this.release(j))}}_drainUnlockWaiters(){for(let j=this._value;j>0;j--)this._weightedWaiters[j-1]&&(this._weightedWaiters[j-1].forEach(r=>r()),this._weightedWaiters[j-1]=[])}},V7=function(A,j,r,t){function e(s){return s instanceof r?s:new r(function(k){k(s)})}return B(e,"adopt"),new(r||(r=Promise))(function(s,k){function E($){try{i(t.next($))}catch(F){k(F)}}B(E,"fulfilled");function o($){try{i(t.throw($))}catch(F){k(F)}}B(o,"rejected");function i($){$.done?s($.value):e($.value).then(E,o)}B(i,"step"),i((t=t.apply(A,j||[])).next())})},NA=class{static{B(this,"Mutex")}constructor(j){this._semaphore=new wj(1,j)}acquire(){return V7(this,void 0,void 0,function*(){let[,j]=yield this._semaphore.acquire();return j})}runExclusive(j){return this._semaphore.runExclusive(()=>j())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};n();a();async function K6(A,j,r){let t=await A.decryptionKeySharePhantom.foldAsync(async i=>Buffer.from(new Uint8Array(i)).toString("base64")),e=Buffer.from(A.encryptedAccounts,"hex").toString("base64"),s=Buffer.from(A.encryptionKey,"hex").toString("base64"),k={ciphertext:e,encryptionKey:s,share:t,externalId:j,mode:"JUICEBOX"},E=await Z.api().bearer(r).headers({"Content-Type":"application/json"}).post(`${kA}/v1/bundles`,k),o=AA(E);return o||p.addBreadcrumb(u.Seedless,"Failed to backup bundle to backend",g.Error,{status:E.status,statusText:E.statusText}),o}B(K6,"sendSeedlessBundleToBackend");async function PA(A,j){let r=await Z.api().bearer(j).get(`${kA}/v1/bundles/${A}?mode=JUICEBOX`);if(r.status===404)throw new Error("bundle not found");if(!AA(r)){p.addBreadcrumb(u.Seedless,"Failed to recover bundle from backend",g.Error,{status:r.status,statusText:r.statusText});let t=new Error("Got invalid response from seedless backend: "+r.statusText);throw p.captureError(t,u.Seedless),t}if(!("share"in r.data)){p.addBreadcrumb(u.Seedless,"No share found in bundle",g.Error);let t=new Error("Did not receive share from seedless backend");throw p.captureError(t,u.Seedless),t}try{let t=z.from(new Uint8Array(Buffer.from(r.data.share,"base64"))),e=Buffer.from(r.data.ciphertext,"base64").toString("hex"),s=Buffer.from(r.data.encryptionKey,"base64").toString("hex");return{id:r.data.externalId,encryptedAccounts:e,encryptionKey:s,decryptionKeyShare1:t}}catch{throw new Error("Unable to parse bundle. Incorrect format.")}}B(PA,"recoverSeedlessBundle");async function x6(A){let j=await Z.api().bearer(A).get(`${kA}/v1/bundles?mode=JUICEBOX`);if(!AA(j))throw p.addBreadcrumb(u.Seedless,"Failed to recover all seedless bundles",g.Error,{status:j.status,statusText:j.statusText}),new Error("Failed to recover all seedless bundles.");try{if(!Array.isArray(j.data))throw new Error("Seedless bundles are not an array.");return j.data.map(r=>{if(typeof r!="object"||r===null||!("externalId"in r))throw new Error("No externalId found in bundle.");let t=r.externalId;if(typeof t!="string")throw new Error("External ID is not a string.");return{id:t}})}catch{throw new Error("Unable to parse seedless bundles. Incorrect format.")}}B(x6,"fetchAllSeedlessBundleIDs");async function tj(A,j){let r=await Z.api().bearer(j).get(`${kA}/v1/bundles/${A}?mode=JUICEBOX&populate=none`);if(p.addBreadcrumb(u.Seedless,"Checking if user has a se*dless bundle",g.Info),AA(r))return p.addBreadcrumb(u.Seedless,"A se*dless bundle has been found for this user",g.Info,{status:r.status,statusText:r.statusText}),!0;if(r.status===404)return p.addBreadcrumb(u.Seedless,"No se*dless bundle found for user",g.Info,{status:r.status,statusText:r.statusText}),!1;let t=new Error("Failed to check for se*dless bundle.");throw p.captureError(t,u.Seedless),t}B(tj,"hasSeedlessBundle");async function Bj(A,j){let r=await Z.api().bearer(j).headers({"Content-Type":"application/json"}).retry(3,500).delete(`${kA}/v1/bundles/${A}`,{mode:"JUICEBOX"});if(p.addBreadcrumb(u.Seedless,`Deleting se*dless bundle: ${A}`,g.Info),AA(r))return p.addBreadcrumb(u.Seedless,"A se*dless bundle has been deleted for this user",g.Info,{status:r.status,statusText:r.statusText}),!0;if(r.status===404)return p.addBreadcrumb(u.Seedless,"No se*dless bundle found for user",g.Info,{status:r.status,statusText:r.statusText}),!1;let t=new Error("Failed to delete se*dless bundle.");throw p.captureError(t,u.Seedless),t}B(Bj,"deleteSeedlessBundle");async function b6(A){let j=await Z.api().bearer(A).headers({"Content-Type":"application/json"}).retry(3,500).delete(`${kA}/v1/bundles`,{mode:"JUICEBOX"});if(p.addBreadcrumb(u.Seedless,"Deleting se*dless bundle",g.Info),AA(j))return p.addBreadcrumb(u.Seedless,"All se*dless bundles, if they exist, have been deleted for this user",g.Info,{status:j.status,statusText:j.statusText,data:j.data}),!0;let r=new Error("Failed to delete all se*dless bundles.");throw p.captureError(r,u.Seedless),r}B(b6,"deleteAllSeedlessBundles");async function Pj(A,j){let r=await Z.api().bearer(A).get(`${kA}/v1/device-encryption-keys/${j}`);if(r.status===404)return p.addBreadcrumb(u.Seedless,"No device encryption key found for user",g.Info),null;if(!AA(r))throw new Error("Unable to get device encryption key.");try{let{encryptionKey:t}=u6.parse(r.data);return z.from(new Uint8Array(Buffer.from(t,"base64")))}catch{throw new Error("Unable to parse device encryption key from response.")}}B(Pj,"getDeviceEncryptionKey");async function _6(A,j,r){let t=await Z.api().bearer(A).post(`${kA}/v1/device-encryption-keys`,{deviceId:j,encryptionKey:r.fold(e=>Buffer.from(e).toString("base64"))});if(!AA(t))throw new Error("Unable to set device encryption key.")}B(_6,"setDeviceEncryptionKey");async function y6(A,j){let r=await Z.api().bearer(A).delete(`${kA}/v1/device-encryption-keys/${j}`);if(!AA(r))throw new Error("Unable to delete device encryption key.")}B(y6,"deleteDeviceEncryptionKey");n();a();n();a();n();a();n();a();var Y=B((A,j)=>A[j++]&255|(A[j++]&255)<<8,"u8to16"),Hj=class{static{B(this,"Poly1305")}constructor(j){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,j=zA(j),U(j,32);let r=Y(j,0),t=Y(j,2),e=Y(j,4),s=Y(j,6),k=Y(j,8),E=Y(j,10),o=Y(j,12),i=Y(j,14);this.r[0]=r&8191,this.r[1]=(r>>>13|t<<3)&8191,this.r[2]=(t>>>10|e<<6)&7939,this.r[3]=(e>>>7|s<<9)&8191,this.r[4]=(s>>>4|k<<12)&255,this.r[5]=k>>>1&8190,this.r[6]=(k>>>14|E<<2)&8191,this.r[7]=(E>>>11|o<<5)&8065,this.r[8]=(o>>>8|i<<8)&8191,this.r[9]=i>>>5&127;for(let $=0;$<8;$++)this.pad[$]=Y(j,16+2*$)}process(j,r,t=!1){let e=t?0:2048,{h:s,r:k}=this,E=k[0],o=k[1],i=k[2],$=k[3],F=k[4],m=k[5],O=k[6],l=k[7],I=k[8],G=k[9],M=Y(j,r+0),f=Y(j,r+2),K=Y(j,r+4),x=Y(j,r+6),Q=Y(j,r+8),P=Y(j,r+10),V=Y(j,r+12),J=Y(j,r+14),H=s[0]+(M&8191),v=s[1]+((M>>>13|f<<3)&8191),h=s[2]+((f>>>10|K<<6)&8191),_=s[3]+((K>>>7|x<<9)&8191),y=s[4]+((x>>>4|Q<<12)&8191),b=s[5]+(Q>>>1&8191),D=s[6]+((Q>>>14|P<<2)&8191),T=s[7]+((P>>>11|V<<5)&8191),L=s[8]+((V>>>8|J<<8)&8191),N=s[9]+(J>>>5|e),c=0,C=c+H*E+v*(5*G)+h*(5*I)+_*(5*l)+y*(5*O);c=C>>>13,C&=8191,C+=b*(5*m)+D*(5*F)+T*(5*$)+L*(5*i)+N*(5*o),c+=C>>>13,C&=8191;let X=c+H*o+v*E+h*(5*G)+_*(5*I)+y*(5*l);c=X>>>13,X&=8191,X+=b*(5*O)+D*(5*m)+T*(5*F)+L*(5*$)+N*(5*i),c+=X>>>13,X&=8191;let S=c+H*i+v*o+h*E+_*(5*G)+y*(5*I);c=S>>>13,S&=8191,S+=b*(5*l)+D*(5*O)+T*(5*m)+L*(5*F)+N*(5*$),c+=S>>>13,S&=8191;let nA=c+H*$+v*i+h*o+_*E+y*(5*G);c=nA>>>13,nA&=8191,nA+=b*(5*I)+D*(5*l)+T*(5*O)+L*(5*m)+N*(5*F),c+=nA>>>13,nA&=8191;let vA=c+H*F+v*$+h*i+_*o+y*E;c=vA>>>13,vA&=8191,vA+=b*(5*G)+D*(5*I)+T*(5*l)+L*(5*O)+N*(5*m),c+=vA>>>13,vA&=8191;let OA=c+H*m+v*F+h*$+_*i+y*o;c=OA>>>13,OA&=8191,OA+=b*E+D*(5*G)+T*(5*I)+L*(5*l)+N*(5*O),c+=OA>>>13,OA&=8191;let fA=c+H*O+v*m+h*F+_*$+y*i;c=fA>>>13,fA&=8191,fA+=b*o+D*E+T*(5*G)+L*(5*I)+N*(5*l),c+=fA>>>13,fA&=8191;let mA=c+H*l+v*O+h*m+_*F+y*$;c=mA>>>13,mA&=8191,mA+=b*i+D*o+T*E+L*(5*G)+N*(5*I),c+=mA>>>13,mA&=8191;let hA=c+H*I+v*l+h*O+_*m+y*F;c=hA>>>13,hA&=8191,hA+=b*$+D*i+T*o+L*E+N*(5*G),c+=hA>>>13,hA&=8191;let MA=c+H*G+v*I+h*l+_*O+y*m;c=MA>>>13,MA&=8191,MA+=b*F+D*$+T*i+L*o+N*E,c+=MA>>>13,MA&=8191,c=(c<<2)+c|0,c=c+C|0,C=c&8191,c=c>>>13,X+=c,s[0]=C,s[1]=X,s[2]=S,s[3]=nA,s[4]=vA,s[5]=OA,s[6]=fA,s[7]=mA,s[8]=hA,s[9]=MA}finalize(){let{h:j,pad:r}=this,t=new Uint16Array(10),e=j[1]>>>13;j[1]&=8191;for(let E=2;E<10;E++)j[E]+=e,e=j[E]>>>13,j[E]&=8191;j[0]+=e*5,e=j[0]>>>13,j[0]&=8191,j[1]+=e,e=j[1]>>>13,j[1]&=8191,j[2]+=e,t[0]=j[0]+5,e=t[0]>>>13,t[0]&=8191;for(let E=1;E<10;E++)t[E]=j[E]+e,e=t[E]>>>13,t[E]&=8191;t[9]-=8192;let s=(e^1)-1;for(let E=0;E<10;E++)t[E]&=s;s=~s;for(let E=0;E<10;E++)j[E]=j[E]&s|t[E];j[0]=(j[0]|j[1]<<13)&65535,j[1]=(j[1]>>>3|j[2]<<10)&65535,j[2]=(j[2]>>>6|j[3]<<7)&65535,j[3]=(j[3]>>>9|j[4]<<4)&65535,j[4]=(j[4]>>>12|j[5]<<1|j[6]<<14)&65535,j[5]=(j[6]>>>2|j[7]<<11)&65535,j[6]=(j[7]>>>5|j[8]<<8)&65535,j[7]=(j[8]>>>8|j[9]<<5)&65535;let k=j[0]+r[0];j[0]=k&65535;for(let E=1;E<8;E++)k=(j[E]+r[E]|0)+(k>>>16)|0,j[E]=k&65535}update(j){dj(this);let{buffer:r,blockLen:t}=this;j=zA(j);let e=j.length;for(let s=0;s<e;){let k=Math.min(t-this.pos,e-s);if(k===t){for(;t<=e-s;s+=t)this.process(j,s);continue}r.set(j.subarray(s,s+k),this.pos),this.pos+=k,s+=k,this.pos===t&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(j){dj(this),o6(j,this),this.finished=!0;let{buffer:r,h:t}=this,{pos:e}=this;if(e){for(r[e++]=1;e<16;e++)r[e]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let k=0;k<8;k++)j[s++]=t[k]>>>0,j[s++]=t[k]>>>8;return j}digest(){let{buffer:j,outputLen:r}=this;this.digestInto(j);let t=j.slice(0,r);return this.destroy(),t}};function U7(A){let j=B((t,e)=>A(e).update(zA(t)).digest(),"hashC"),r=A(new Uint8Array(32));return j.outputLen=r.outputLen,j.blockLen=r.blockLen,j.create=t=>A(t),j}B(U7,"wrapConstructorWithKey");var w6=U7(A=>new Hj(A));n();a();var H6=B(A=>Uint8Array.from(A.split("").map(j=>j.charCodeAt(0))),"_utf8ToBytes"),J7=H6("expand 16-byte k"),Y7=H6("expand 32-byte k"),z7=oA(J7),D6=oA(Y7),fk=D6.slice();function q(A,j){return A<<j|A>>>32-j}B(q,"rotl");function Dj(A){return A.byteOffset%4===0}B(Dj,"isAligned32");var ej=64,W7=16,T6=2**32-1,P6=new Uint32Array;function Q7(A,j,r,t,e,s,k,E){let o=e.length,i=new Uint8Array(ej),$=oA(i),F=Dj(e)&&Dj(s),m=F?oA(e):P6,O=F?oA(s):P6;for(let l=0;l<o;k++){if(A(j,r,t,$,k,E),k>=T6)throw new Error("arx: counter overflow");let I=Math.min(ej,o-l);if(F&&I===ej){let G=l/4;if(l%4!==0)throw new Error("arx: invalid block position");for(let M=0,f;M<W7;M++)f=G+M,O[f]=m[f]^$[M];l+=ej;continue}for(let G=0,M;G<I;G++)M=l+G,s[M]=e[M]^i[G];l+=I}}B(Q7,"runCipher");function Tj(A,j){let{allowShortKeys:r,extendNonceFn:t,counterLength:e,counterRight:s,rounds:k}=q6({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},j);if(typeof A!="function")throw new Error("core must be a function");return xA(e),xA(k),cj(s),cj(r),(E,o,i,$,F=0)=>{U(E),U(o),U(i);let m=i.length;if($||($=new Uint8Array(m)),U($),xA(F),F<0||F>=T6)throw new Error("arx: counter overflow");if($.length<m)throw new Error(`arx: output (${$.length}) is shorter than data (${m})`);let O=[],l=E.length,I,G;if(l===32)I=E.slice(),O.push(I),G=D6;else if(l===16&&r)I=new Uint8Array(32),I.set(E),I.set(E,16),G=z7,O.push(I);else throw new Error(`arx: invalid 32-byte key, got length=${l}`);Dj(o)||(o=o.slice(),O.push(o));let M=oA(I);if(t){if(o.length!==24)throw new Error("arx: extended nonce must be 24 bytes");t(G,M,oA(o.subarray(0,16)),M),o=o.subarray(16)}let f=16-e;if(f!==o.length)throw new Error(`arx: nonce must be ${f} or 16 bytes`);if(f!==12){let x=new Uint8Array(12);x.set(o,s?0:12-o.length),o=x,O.push(o)}let K=oA(o);for(Q7(A,G,M,K,i,$,F,k);O.length>0;)O.pop().fill(0);return $}}B(Tj,"createCipher");function S6(A,j,r,t,e,s=20){let k=A[0],E=A[1],o=A[2],i=A[3],$=j[0],F=j[1],m=j[2],O=j[3],l=j[4],I=j[5],G=j[6],M=j[7],f=e,K=r[0],x=r[1],Q=r[2],P=k,V=E,J=o,H=i,v=$,h=F,_=m,y=O,b=l,D=I,T=G,L=M,N=f,c=K,C=x,X=Q;for(let nA=0;nA<s;nA+=2)P=P+v|0,N=q(N^P,16),b=b+N|0,v=q(v^b,12),P=P+v|0,N=q(N^P,8),b=b+N|0,v=q(v^b,7),V=V+h|0,c=q(c^V,16),D=D+c|0,h=q(h^D,12),V=V+h|0,c=q(c^V,8),D=D+c|0,h=q(h^D,7),J=J+_|0,C=q(C^J,16),T=T+C|0,_=q(_^T,12),J=J+_|0,C=q(C^J,8),T=T+C|0,_=q(_^T,7),H=H+y|0,X=q(X^H,16),L=L+X|0,y=q(y^L,12),H=H+y|0,X=q(X^H,8),L=L+X|0,y=q(y^L,7),P=P+h|0,X=q(X^P,16),T=T+X|0,h=q(h^T,12),P=P+h|0,X=q(X^P,8),T=T+X|0,h=q(h^T,7),V=V+_|0,N=q(N^V,16),L=L+N|0,_=q(_^L,12),V=V+_|0,N=q(N^V,8),L=L+N|0,_=q(_^L,7),J=J+y|0,c=q(c^J,16),b=b+c|0,y=q(y^b,12),J=J+y|0,c=q(c^J,8),b=b+c|0,y=q(y^b,7),H=H+v|0,C=q(C^H,16),D=D+C|0,v=q(v^D,12),H=H+v|0,C=q(C^H,8),D=D+C|0,v=q(v^D,7);let S=0;t[S++]=k+P|0,t[S++]=E+V|0,t[S++]=o+J|0,t[S++]=i+H|0,t[S++]=$+v|0,t[S++]=F+h|0,t[S++]=m+_|0,t[S++]=O+y|0,t[S++]=l+b|0,t[S++]=I+D|0,t[S++]=G+T|0,t[S++]=M+L|0,t[S++]=f+N|0,t[S++]=K+c|0,t[S++]=x+C|0,t[S++]=Q+X|0}B(S6,"chachaCore");function Z7(A,j,r,t){let e=A[0],s=A[1],k=A[2],E=A[3],o=j[0],i=j[1],$=j[2],F=j[3],m=j[4],O=j[5],l=j[6],I=j[7],G=r[0],M=r[1],f=r[2],K=r[3];for(let Q=0;Q<20;Q+=2)e=e+o|0,G=q(G^e,16),m=m+G|0,o=q(o^m,12),e=e+o|0,G=q(G^e,8),m=m+G|0,o=q(o^m,7),s=s+i|0,M=q(M^s,16),O=O+M|0,i=q(i^O,12),s=s+i|0,M=q(M^s,8),O=O+M|0,i=q(i^O,7),k=k+$|0,f=q(f^k,16),l=l+f|0,$=q($^l,12),k=k+$|0,f=q(f^k,8),l=l+f|0,$=q($^l,7),E=E+F|0,K=q(K^E,16),I=I+K|0,F=q(F^I,12),E=E+F|0,K=q(K^E,8),I=I+K|0,F=q(F^I,7),e=e+i|0,K=q(K^e,16),l=l+K|0,i=q(i^l,12),e=e+i|0,K=q(K^e,8),l=l+K|0,i=q(i^l,7),s=s+$|0,G=q(G^s,16),I=I+G|0,$=q($^I,12),s=s+$|0,G=q(G^s,8),I=I+G|0,$=q($^I,7),k=k+F|0,M=q(M^k,16),m=m+M|0,F=q(F^m,12),k=k+F|0,M=q(M^k,8),m=m+M|0,F=q(F^m,7),E=E+o|0,f=q(f^E,16),O=O+f|0,o=q(o^O,12),E=E+o|0,f=q(f^E,8),O=O+f|0,o=q(o^O,7);let x=0;t[x++]=e,t[x++]=s,t[x++]=k,t[x++]=E,t[x++]=G,t[x++]=M,t[x++]=f,t[x++]=K}B(Z7,"hchacha");var Ar=Tj(S6,{counterRight:!1,counterLength:4,allowShortKeys:!1}),jr=Tj(S6,{counterRight:!1,counterLength:8,extendNonceFn:Z7,allowShortKeys:!1});var rr=new Uint8Array(16),L6=B((A,j)=>{A.update(j);let r=j.length%16;r&&A.update(rr.subarray(r))},"updatePadded"),tr=new Uint8Array(32);function N6(A,j,r,t,e){let s=A(j,r,tr),k=w6.create(s);e&&L6(k,e),L6(k,t);let E=new Uint8Array(16),o=$6(E);pj(o,0,BigInt(e?e.length:0),!0),pj(o,8,BigInt(t.length),!0),k.update(E);let i=k.digest();return s.fill(0),i}B(N6,"computeTag");var R6=B(A=>(j,r,t)=>(U(j,32),U(r),{encrypt:B((s,k)=>{let E=s.length,o=E+16;k?U(k,o):k=new Uint8Array(o),A(j,r,s,k,1);let i=N6(A,j,r,k.subarray(0,-16),t);return k.set(i,E),k},"encrypt"),decrypt:B((s,k)=>{let E=s.length,o=E-16;if(E<16)throw new Error("encrypted data must be at least 16 bytes");k?U(k,o):k=new Uint8Array(o);let i=s.subarray(0,-16),$=s.subarray(-16),F=N6(A,j,r,i,t);if(!F6($,F))throw new Error("invalid tag");return A(j,r,i,k,1),k},"decrypt")}),"_poly1305_aead"),yk=uj({blockSize:64,nonceLength:12,tagLength:16},R6(Ar)),Lj=uj({blockSize:64,nonceLength:24,tagLength:16},R6(jr));n();a();n();a();var uA=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function C6(A=32){if(uA&&typeof uA.getRandomValues=="function")return uA.getRandomValues(new Uint8Array(A));throw new Error("crypto.getRandomValues must be defined")}B(C6,"randomBytes");function Nj(){if(uA&&typeof uA.subtle=="object"&&uA.subtle!=null)return uA.subtle;throw new Error("crypto.subtle must be defined")}B(Nj,"getWebcryptoSubtle");function Sj(A){return xA(A.nonceLength),(j,...r)=>({encrypt:B((t,...e)=>{let{nonceLength:s}=A,k=C6(s),E=A(j,k,...r).encrypt(t,...e),o=i6(k,E);return E.fill(0),o},"encrypt"),decrypt:B((t,...e)=>{let{nonceLength:s}=A,k=t.subarray(0,s),E=t.subarray(s);return A(j,k,...r).decrypt(E,...e)},"decrypt")})}B(Sj,"managedNonce");var X6={async encrypt(A,j,r,t){let e=Nj(),s=await e.importKey("raw",A,j,!0,["encrypt"]),k=await e.encrypt(r,s,t);return new Uint8Array(k)},async decrypt(A,j,r,t){let e=Nj(),s=await e.importKey("raw",A,j,!0,["decrypt"]),k=await e.decrypt(r,s,t);return new Uint8Array(k)}},EA={CBC:"AES-CBC",CTR:"AES-CTR",GCM:"AES-GCM"};function Br(A,j,r){if(A===EA.CBC)return{name:EA.CBC,iv:j};if(A===EA.CTR)return{name:EA.CTR,counter:j,length:64};if(A===EA.GCM)return r?{name:EA.GCM,iv:j,additionalData:r}:{name:EA.GCM,iv:j};throw new Error("unknown aes block mode")}B(Br,"getCryptParams");function Rj(A){return(j,r,t)=>{U(j),U(r);let e={name:A,length:j.length*8},s=Br(A,r,t);return{encrypt(k){return U(k),X6.encrypt(j,e,s,k)},decrypt(k){return U(k),X6.decrypt(j,e,s,k)}}}}B(Rj,"generate");var Vk=Rj(EA.CBC),Uk=Rj(EA.CTR),Jk=Rj(EA.GCM);n();a();n();a();function Cj(A){return self.crypto.getRandomValues(new Uint8Array(A))}B(Cj,"getRandomBytes");var sj=new Uint8Array([0,255,200,8,145,16,208,54,90,62,216,67,153,119,254,24,35,32,7,112,161,108,12,127,98,139,64,70,199,75,224,14,235,22,232,173,207,205,57,83,106,39,53,147,212,78,72,195,43,121,84,40,9,120,15,33,144,135,20,42,169,156,214,116,180,124,222,237,177,134,118,164,152,226,150,143,2,50,28,193,51,238,239,129,253,48,92,19,157,41,23,196,17,68,140,128,243,115,66,30,29,181,240,18,209,91,65,162,215,44,233,213,89,203,80,168,220,252,242,86,114,166,101,47,159,155,61,186,125,194,69,130,167,87,182,163,122,117,79,174,63,55,109,71,97,190,171,211,95,176,88,175,202,94,250,133,228,77,138,5,251,96,183,123,184,38,74,103,198,26,248,105,37,179,219,189,102,221,241,210,223,3,141,52,217,146,13,99,85,170,73,236,188,149,60,132,11,245,230,231,229,172,126,110,185,249,218,142,154,201,36,225,10,21,107,58,160,81,244,234,178,151,158,93,34,136,148,206,25,1,113,76,165,227,197,49,187,204,31,45,59,82,111,246,46,137,247,192,104,27,100,4,6,191,131,56]),V6=new Uint8Array([1,229,76,181,251,159,252,18,3,52,212,196,22,186,31,54,5,92,103,87,58,213,33,90,15,228,169,249,78,100,99,238,17,55,224,16,210,172,165,41,51,89,59,48,109,239,244,123,85,235,77,80,183,42,7,141,255,38,215,240,194,126,9,140,26,106,98,11,93,130,27,143,46,190,166,29,231,157,45,138,114,217,241,39,50,188,119,133,150,112,8,105,86,223,153,148,161,144,24,187,250,122,176,167,248,171,40,214,21,142,203,242,19,230,120,97,63,137,70,13,53,49,136,163,65,128,202,23,95,83,131,254,195,155,69,57,225,245,158,25,94,182,207,75,56,4,185,43,226,193,74,221,72,12,208,125,61,88,222,124,216,20,107,135,71,232,121,132,115,60,189,146,201,35,139,151,149,68,220,173,64,101,134,162,164,204,127,236,192,175,145,253,247,79,129,47,91,234,168,28,2,209,152,113,237,37,227,36,6,104,179,147,44,111,62,108,10,184,206,174,116,177,66,180,30,211,73,233,156,200,198,199,34,110,219,32,191,67,81,82,102,178,118,96,218,197,243,246,170,205,154,160,117,84,14,1]);function kj(A,j){if(!Number.isInteger(A)||A<0||A>255)throw new RangeError("Number is out of Uint8 range");if(!Number.isInteger(j)||j<0||j>255)throw new RangeError("Number is out of Uint8 range");return A^j}B(kj,"add");function er(A,j){if(!Number.isInteger(A)||A<0||A>255)throw new RangeError("Number is out of Uint8 range");if(!Number.isInteger(j)||j<0||j>255)throw new RangeError("Number is out of Uint8 range");if(j===0)throw new Error("cannot divide by zero");let r=sj[A],t=sj[j],e=(r-t+255)%255,s=V6[e];return A===0?0:s}B(er,"div");function Xj(A,j){if(!Number.isInteger(A)||A<0||A>255)throw new RangeError("Number is out of Uint8 range");if(!Number.isInteger(j)||j<0||j>255)throw new RangeError("Number is out of Uint8 range");let r=sj[A],t=sj[j],e=(r+t)%255,s=V6[e];return A===0||j===0?0:s}B(Xj,"mult");function kr(A,j,r){if(A.length!==j.length)throw new Error("sample length mistmatch");let t=A.length,e=0,s=0;for(let k=0;k<t;k++){e=1;for(let E=0;E<t;++E){if(k===E)continue;let o=kj(r,A[E]),i=kj(A[k],A[E]),$=er(o,i);e=Xj(e,$)}s=kj(s,Xj(j[k],e))}return s}B(kr,"interpolatePolynomial");function sr(A,j,r){if(j===0)throw new Error("cannot evaluate secret polynomial at zero");let t=A[r];for(let e=r-1;e>=0;e--){let s=A[e];t=kj(Xj(t,j),s)}return t}B(sr,"evaluate");function U6(){return Cj(1)[0]}B(U6,"getRandomByte");function Er(){for(;;){let A=U6();if(A>0)return A}}B(Er,"getNonZeroRandomByte");function nr(A,j){let r=new Uint8Array(j+1);r[0]=A;for(let t=1;t<=j;t++){let e=t===j;r[t]=e?Er():U6()}return r}B(nr,"newCoefficients");function ar(){let A=new Uint8Array(255);for(let r=0;r<255;r++)A[r]=r+1;let j=Cj(255);for(let r=0;r<255;r++){let t=j[r]%255,e=A[r];A[r]=A[t],A[t]=e}return A}B(ar,"newCoordinates");var W={instanceOf(A,j,r){if(A.constructor!==j)throw new TypeError(r)},inRange(A,j,r,t){if(!(j<r&&A>=j&&A<r))throw new RangeError(t)},greaterThanOrEqualTo(A,j,r){if(A<j)throw new Error(r)},equalTo(A,j,r){if(A!==j)throw new Error(r)}};async function J6(A,j,r){W.instanceOf(A,Uint8Array,"secret must be a Uint8Array"),W.greaterThanOrEqualTo(A.byteLength,1,"secret cannot be empty"),W.instanceOf(j,Number,"shares must be a number"),W.inRange(j,2,256,"shares must be at least 2 and at most 255"),W.instanceOf(r,Number,"threshold must be a number"),W.inRange(r,2,256,"threshold must be at least 2 and at most 255"),W.greaterThanOrEqualTo(j,r,"shares cannot be less than threshold");let t=[],e=A.byteLength,s=ar();for(let E=0;E<j;E++){let o=new Uint8Array(e+1);o[e]=s[E],t.push(o)}let k=r-1;for(let E=0;E<e;E++){let o=A[E],i=nr(o,k);for(let $=0;$<j;++$){let F=s[$],m=sr(i,F,k);t[$][E]=m}}return t}B(J6,"split");async function Y6(A){W.instanceOf(A,Array,"shares must be an Array"),W.inRange(A.length,2,256,"shares must have at least 2 and at most 255 elements");let j=A[0];W.instanceOf(j,Uint8Array,"each share must be a Uint8Array");for(let i of A)W.instanceOf(i,Uint8Array,"each share must be a Uint8Array"),W.greaterThanOrEqualTo(i.byteLength,2,"each share must be at least 2 bytes"),W.equalTo(i.byteLength,j.byteLength,"all shares must have the same byte length");let r=A.length,t=j.byteLength,e=t-1,s=new Uint8Array(e),k=new Uint8Array(r),E=new Uint8Array(r),o=new Set;for(let i=0;i<r;i++){let F=A[i][t-1];if(o.has(F))throw new Error("shares must contain unique values but a duplicate was found");o.add(F),k[i]=F}for(let i=0;i<e;i++){for(let $=0;$<r;++$)E[$]=A[$][i];s[i]=kr(k,E,0)}return s}B(Y6,"combine");var z6=B(async(A,j)=>{if(A.length!==32)throw new Error("encryption key must be 32 bytes");$r(A);let r={seeds:[]};for(let i of j){let $="unused",F=i.fold(m=>new Uint8Array(m));r.seeds.push([$,F])}let t=Sj(Lj)(A),e=Ij(JSON.stringify(r)),s=t.encrypt(e),[k,E]=await J6(A,2,2);return{encryptedAccounts:CA(s),decryptionKeySharePhantom:z.from(k),decryptionKeyShareExternal:z.from(E),encryptionKey:"unused"}},"encryptAccounts"),cA=class extends Error{static{B(this,"SeedlessDecryptionError")}reason;constructor(j){super(`Unable to decrypt seedless bundle: ${j}`),this.reason=j}},Ej=B(async A=>{let j;try{j=await or(A.decryptionKeySharePhantom,A.decryptionKeyShareExternal)}catch{throw new cA("incompatible-shares")}let r;try{r=Sj(Lj)(j).decrypt(Zj(A.encryptedAccounts))}catch{throw new cA("incorrect-decryption-key")}let t;try{t=JSON.parse(Buffer.from(r).toString())}catch{throw new cA("invalid-json")}let e=d6.safeParse(t);if(!e.success)throw new cA("invalid-format");return e.data.seeds.map(k=>{let E=k[1],o=I6(E);return z.from(o)})},"decryptAccounts"),or=B(async(A,j)=>{let r=A.fold(e=>new Uint8Array(e)),t=j.fold(e=>new Uint8Array(e));return await Y6([r,t])},"getDecryptionKeyFromShares"),$r=B(A=>{if(A.every(j=>j===0))throw new Error("encryption key must not be all zeros")},"validateNotZero");n();a();var W6={realms:[{id:"a4caa86247c60f61b2454d8cbdb1ba2a",address:"https://production-juicebox.phantom.dev"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var Q6={realms:[{id:"a4caa86247c60f61b2454d8cbdb1ba2a",address:"https://production-juicebox.phantom.app"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var Z6={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.dev"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var A7={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.dev/"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var j7={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.dev"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],uuid_nonce:"f76005fd-80e5-483e-9d84-c09ef7c60ba3",register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var r7={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.app"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],uuid_nonce:"153ebe7b-400c-4d27-be76-139248bb3acd",register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var t7={realms:[{id:"497efc0c17f850465b9387a549affb2b",address:"https://development-juicebox.phantom.app"},{id:"7dd7ac88b0584725a2db014818631f8c",address:"https://juicebox.rpcpool.com"}],uuid_nonce:"f577175c-3f1e-4f4a-91d1-cb30aaa0d5d4",register_threshold:2,recover_threshold:2,pin_hashing_mode:"Standard2019"};var nj=[W6,Q6],B7=nj.reduce((A,j)=>(A[FA(j)]=j,A),{}),e7=[Z6,A7,j7,r7,t7],Ir=e7.reduce((A,j)=>(A[FA(j)]=j,A),{});function aj(){return ij()||qj()===$j.Production?B7:Ir}B(aj,"getSupportedConfigs");function pA(){if(ij())return nj[nj.length-1];let A=qj()===$j.Production?nj:e7;return A[A.length-1]}B(pA,"getLatestConfig");var BA={success:{type:"success",didBackup:!0},unauthorized:{type:"unauthorized",didBackup:!1},bundleAlreadyExists:{type:"bundle-already-exists",didBackup:!1},errorBackendCheck:{type:"error-backend-check",didBackup:!1},invalidPin:{type:"invalid-pin-format",didBackup:!1},errorEncryptionFailed:{type:"error-encryption-failed",didBackup:!1},errorBackendUpload:{type:"error-backend-upload",didBackup:!1},errorJuiceboxUpload:{type:"error-juicebox-upload",didBackup:!1},recoveredFromJuiceboxError:{type:"recovered-juicebox-error",didBackup:!1},errorBackendDelete:{type:"error-backend-delete",didBackup:!1}},SA=B(async(A,{pin:j,entropy:r})=>{if(!iA(j))return BA.invalidPin;let t;try{if(t=await A.authRepository.getUser(),!t)return BA.unauthorized}catch{return BA.unauthorized}let e=pA(),s=FA(e);try{if(await tj(s,t.accessToken))return BA.bundleAlreadyExists}catch{return BA.errorBackendCheck}let k;try{let $=XA(32);k=await z6($,[r])}catch{return BA.errorEncryptionFailed}try{if(!await K6(k,s,t.accessToken))return BA.errorBackendUpload}catch{return BA.errorBackendUpload}let E=k.decryptionKeyShareExternal.fold($=>new Uint8Array($)),o=await A.juiceboxClient(),i=!0;try{i=await o.sendJuiceboxShare(pA(),E,j,t.accessToken)}catch{i=!1}if(!i)try{return await Bj(s,t.accessToken),BA.recoveredFromJuiceboxError}catch{return BA.errorBackendDelete}return BA.success},"backupBundle");n();a();var k7="seedlessJuiceboxPinCooldownTimer",Vj=".phantom.seedless.juiceboxPinCooldownTimer",RA=B(async A=>{let j=await A.get(k7),r=await A.get(Vj),t=r?.timeRemaining||j,e=r?.guessesRemaining;return!t||t<0?{timeRemaining:0,guessesRemaining:e}:{timeRemaining:t-Date.now(),guessesRemaining:e}},"cooldownTimeLeft"),s7=B(async(A,j)=>{let r=pr(A);if(!r)return;let t=Date.now()+r*1e3;j.set(Vj,{version:2,timeRemaining:t,guessesRemaining:A})},"updateCooldownTimer"),E7=B(async A=>{await A.remove(k7),await A.remove(Vj)},"resetCooldownTimer"),pr=B(A=>vr[A],"getCooldownTimeInSeconds"),vr={[7]:0,[6]:0,[5]:30,[4]:60,[3]:120,[2]:300,[1]:300};n();a();n();a();var n7=B(async(A,j,r)=>{let t=[];try{t=await x6(A)}catch{return{status:"error-fetch-all-seedless-bundles"}}let e=t.filter(s=>s.id!==r).map(s=>s.id);if(e.length===0)return{status:"no-other-bundles-found"};for(let s of e)try{let k=await PA(s,A),E=await Ej({encryptedAccounts:k.encryptedAccounts,encryptionKey:k.encryptionKey,decryptionKeySharePhantom:k.decryptionKeyShare1,decryptionKeyShareExternal:z.from(j)});if(E.length===0)continue;return{status:"found-valid-bundle",entropies:E}}catch{continue}return{status:"error-no-decryptable-accounts"}},"recoverFirstValidBundle");var fr=B(A=>{let j="unknown";return A instanceof Error&&(A.message.includes("bundle not found")?j="bundle-not-found":A.message.includes("Got invalid response from seedless backend")?j="non-ok-response":A.message.includes("Did not receive share from seedless backend")?j="no-share-in-bundle":A.message.includes("Unable to parse bundle. Incorrect format.")&&(j="incorrect-format")),{type:"error-backend-recover",reason:j}},"handleBackendRecoverError"),a7=B(async(A,j,{pin:r,ignoreCooldown:t=!1})=>{let{authRepository:e,juiceboxClient:s,storage:k}=A,{timeRemaining:E,guessesRemaining:o}=await RA(k);if(E>0&&!t)return{type:"cooldown",timeRemaining:E,guessesRemaining:o};if(!iA(r))return{type:"invalid-pin-format"};let i=await e.getUser();if(!i)return{type:"unauthorized"};let{accessToken:$}=i,F;try{F=await PA("latest",$)}catch(f){return fr(f)}let m=aj()[F.id];if(!m)return{type:"upgrade-required"};let O=await s(),l;try{l=new Uint8Array(await O.getJuiceboxShare(m,r,$)),await E7(k)}catch(f){let K=f?.reasonCode,x=f?.guessesRemaining;if(ZA(f))if(!t&&x&&x<=5){await s7(x,k);let{timeRemaining:P}=await RA(k);return{type:"cooldown",timeRemaining:P,guessesRemaining:x}}else return{type:"error-juicebox-recover",reason:K,guessesRemaining:x};else return{type:"error-juicebox-recover",reason:K||"unknown"}}if(l.every(f=>f===0))return{type:"error-juicebox-share-zero"};let G;try{G=await Ej({encryptedAccounts:F.encryptedAccounts,encryptionKey:F.encryptionKey,decryptionKeySharePhantom:F.decryptionKeyShare1,decryptionKeyShareExternal:z.from(l)})}catch(f){let K;f instanceof cA?K=f.reason:K="unknown";let x=await n7($,l,F.id);if(x.status==="found-valid-bundle")p.addBreadcrumb(u.Seedless,"Recovered from older bundle",g.Info),G=x.entropies;else return x.status==="no-other-bundles-found"?{type:"error-decrypt-accounts",reason:K}:{type:"error-decrypt-accounts",reason:x.status}}if(G.length===0)return{type:"error-no-entropies"};let M=await SA(A,{entropy:G[0],pin:r});return j.emitRotationResult(M),{type:"success",entropy:G[0]}},"recoverBundle");n();a();var oj=class extends B6{static{B(this,"SeedlessEventEmitter")}emitRotationResult(j){this.emitEvent(dA.RotationResult,{type:j.type,didRotate:j.didBackup})}emitRecoverResult(j){let r=j.type,t;"reason"in j&&(typeof j.reason=="string"?t=j.reason:t=tA[j.reason]),this.emitEvent(dA.RecoverResult,{type:r,reason:t})}emitBackupResult(j){this.emitEvent(dA.BackupResult,{type:j.type,didBackup:j.didBackup})}};var mr=B(A=>{let j=new oj,r=new NA,t={backup:B((k,E)=>r.runExclusive(async()=>await Mr(A,k,E,j)),"backup"),recover:B(k=>r.runExclusive(async()=>await o7(A,k,!1,j)),"recover"),verifyPin:B(k=>r.runExclusive(async()=>await gr(A,k,!0,j)),"verifyPin"),resetBundleFromDevice:B((k,E)=>r.runExclusive(async()=>await hr(A,k,E)),"resetBundleFromDevice")},e=new NA;return{...t,hasSeedlessBundle:B(k=>xr(A,k),"hasSeedlessBundle"),deleteBundle:B(()=>Jj(A,"latest"),"deleteBundle"),deleteAllBundles:B(()=>Jj(A,"all"),"deleteAllBundles"),deleteJuiceboxShare:B(()=>br(A),"deleteJuiceboxShare"),needsBundleUpdate:B(()=>Kr(A),"needsBundleUpdate"),timeLeftCooldown:B(()=>_r(A),"timeLeftCooldown"),getPinVerificationTimer:B(({pinVerificationExpiryInMs:k})=>yr({...A,pinVerificationExpiryInMs:k}),"getPinVerificationTimer"),setPinVerificationTimer:B(k=>wr(A,k),"setPinVerificationTimer"),...{getDeviceEncryptionKey:B(()=>e.runExclusive(async()=>await Pr(A)),"getDeviceEncryptionKey")},generateDeviceEncryptionKey:i7,setDeviceEncryptionKey:B(k=>F7(A,k),"setDeviceEncryptionKey"),deleteDeviceEncryptionKey:B(()=>Hr(A),"deleteDeviceEncryptionKey"),getOrCreateSeedlessDeviceID:B(()=>q7(A),"getOrCreateSeedlessDeviceID"),subscribe:B((k,E)=>j.subscribe(k,E),"subscribe")}},"createSeedlessRepository"),Uj={},hr=B(async(A,j,r)=>{if(!iA(j))throw new Error("Invalid PIN provided. Only numbers are accepted.");await Jj(A);let t=await SA(A,{pin:j,entropy:r[0]});if(t.type!=="success"&&t.type!=="bundle-already-exists")throw new Error(`Failed to backup bundle: ${t.type}`);return{entropy:r[0]}},"resetBundleFromDevice"),Mr=B(async(A,j,r,t)=>{let e=await SA(A,{pin:r,entropy:j});if(t.emitBackupResult(e),e.type!=="success")throw new rj(e)},"backup"),o7=B(async(A,j,r=!1,t)=>{let e=await a7(A,t,{pin:j,ignoreCooldown:r});if(t.emitRecoverResult(e),e.type!=="success")throw new yA(e);return{entropy:e.entropy}},"recover"),gr=B(async(A,j,r=!0,t)=>{await o7(A,j,r,t)},"verifyPin"),Kr=B(async({authRepository:A})=>{let j=await A.getUser();if(!j)throw new Error("User is not logged in, cannot check for seedless bundle update");let{accessToken:r}=j,t,e=FA(pA());try{t=await PA("latest",r)}catch(k){if(k instanceof Error&&k.message==="bundle not found")return!1;throw k}return!!aj()[t.id]&&t.id!==e},"needsBundleUpdate"),xr=B(async(A,j="latest")=>{let r=await A.authRepository.getUser();if(!r)throw new Error("User is not logged in, cannot check for se*dless bundle");let{accessToken:t}=r;return await tj(j,t)},"hasSeedlessBundle"),Jj=B(async(A,j="latest")=>{let r=await A.authRepository.getUser();if(!r)throw new Error("User is not logged in, cannot delete se*dless bundle");let{accessToken:t}=r;if(j==="all")return await b6(t);let e=FA(pA());return await Bj(e,t)},"deleteSeedlessBundle"),br=B(async A=>{let j=await A.authRepository.getUser();if(!j)throw new Error("User is not logged in, cannot delete juicebox share");let{accessToken:r}=j;await(await A.juiceboxClient()).deleteShare(pA(),r)},"deleteJuiceboxShare"),_r=B(async({storage:A})=>{let{timeRemaining:j}=await RA(A);return j},"timeLeftCooldown"),yr=B(async({storage:A,pinVerificationExpiryInMs:j})=>{let r=Date.now(),t=await A.get(aA.SeedlessPinVerificationLockTimerInMs)??Date.now();return{expired:r>=t+(j??2147483647),timestampInMs:t}},"getPinVerificationTimer"),wr=B(async({storage:A},j)=>{await A.set(aA.SeedlessPinVerificationLockTimerInMs,j)},"setPinVerificationTimer"),Yj=B(async A=>(await A.get(aA.SeedlessDeviceID))?.deviceID??null,"fetchSeedlessDeviceID"),$7=B(async(A,j)=>{await A.set(aA.SeedlessDeviceID,{version:1,deviceID:j})},"storeSeedlessDeviceID"),i7=B(()=>{let A=XA(32);try{return Promise.resolve(z.from(A))}finally{A.fill(0)}},"generateDeviceEncryptionKey"),q7=B(async({storage:A})=>{let j=await Yj(A);return j||(j=Fj(),await $7(A,j)),j},"getOrCreateSeedlessDeviceID"),Pr=B(async A=>{let{authRepository:j}=A,r=await j.getUser();if(!r)throw new Error("User not logged in, cannot retrieve device encryption key.");let t=await q7(A),e=Uj[t];if(e)return e;let s=await Pj(r.accessToken,t);return s||(s=await i7(),await F7(A,s)),Uj[t]=s,s},"getDeviceEncryptionKey"),F7=B(async({authRepository:A,storage:j},r)=>{let t=await A.getUser();if(!t)throw new Error("User not logged in, cannot set device encryption key.");let e=await Yj(j);return e||(e=Fj(),await $7(j,e)),await _6(t.accessToken,e,r),Uj[e]=r,r},"setDeviceEncryptionKey"),Hr=B(async({authRepository:A,storage:j})=>{let r=await A.getUser();if(!r)throw new Error("User not logged in, cannot delete device encryption key.");let t=await Yj(j);if(!t)return null;let e=await Pj(r.accessToken,t);return e?(await y6(r.accessToken,t),e):null},"deleteDeviceEncryptionKey");n();a();n();a();var zj={};G7(zj,{default:()=>Wj});var Wj="./juicebox-sdk_bg-LUYFYBUJ.wasm";E6(zj);var l7=!1,Tr=B(async()=>{if(l7)return;let A=await import("./juicebox-sdk_bg-IUF2TCSW.js"),j=await WebAssembly.instantiateStreaming(fetch(Wj),{"./juicebox-sdk_bg.js":A});A.__wbg_set_wasm(j.instance.exports),l7=!0},"initWasm");function c7(A){globalThis.JuiceboxTokens=A}B(c7,"setGlobalJuiceboxTokens");c7({});var Qj=class{static{B(this,"JuiceboxProvider")}setJuiceboxTokens(j){c7(j)}async backupShare(j,r,t,e,s){await(await this.client(j)).register(t,r,e,s)}async recoverShare(j,r,t){return await(await this.client(j)).recover(r,t)}async deleteShare(j){await(await this.client(j)).delete()}async client(j){return await Tr(),new n6(new a6(j),[])}};n();a();var bn=[DA.FirstTimeOnboarding,DA.IsResettingApp],_n=[VA.Seed,VA.Seedless,VA.PrivateKey],yn="https://phantom-wallet.zendesk.com/hc/en-us/articles/33478025712531";export{l6 as a,DA as b,tt as c,Bt as d,et as e,bn as f,_n as g,yn as h,dA as i,M7 as j,tA as k,g7 as l,v6 as m,Oj as n,p7 as o,K7 as p,x7 as q,mj as r,b7 as s,_7 as t,y7 as u,hj as v,H7 as w,L7 as x,Mj as y,iA as z,Kj as A,wA as B,N7 as C,xj as D,bj as E,_j as F,S7 as G,R7 as H,mr as I,Qj as J};
/*! Bundled license information:

@noble/ciphers/esm/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)
*/
//# sourceMappingURL=chunk-GUZFMB3D.js.map
