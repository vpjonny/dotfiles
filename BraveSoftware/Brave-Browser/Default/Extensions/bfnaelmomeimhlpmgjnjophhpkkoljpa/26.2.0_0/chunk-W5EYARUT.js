import{a as $,b as N}from"./chunk-NMTPXQAP.js";import{b as A}from"./chunk-N6SSDFMX.js";import{a as k}from"./chunk-YJCG6GWC.js";import{I as b,L as F,M as m,N as w,O as v,P as E,Q as D,qe as R}from"./chunk-DJGGVTSJ.js";import{U as f,V as x,W as y,X as O,za as B}from"./chunk-LQZGQEJ6.js";import{a as r,g as T,i as c,n as d}from"./chunk-WKJYWAXG.js";c();d();c();d();var Q=T(B(),1),L=T(k(),1);var P=new $,I=".phantom-labs.log",_="state-log",S=class a{static{r(this,"ExtensionFileLogger")}maxSize=1024*1024;maxDepth=5;autoTrim=!1;disableDebounce=!1;includeSessionMetadata=!1;quoteStrings=!1;useLocalStorage=!1;useTimestamps=!1;indent="  ";logFilename=_;storageKey=I;startTime;logs="";logQueue;logQueueSize=256;debounceSaveAndFlushQueuedLogs=(0,Q.default)(this.saveAndFlushQueuedLogs,4e3);constructor(e){if(e)for(let t in e)e[t]!==void 0&&(this[t]=e[t])}static async init(e){let t=new a(e);if(t.useLocalStorage){let o=await t.getDataFromStorage();if(o){t.logs=o.log,t.startTime=new Date(o.startTime);let n=new Date(o.lastLog);t.addSessionMetadataToLog(`Last session end: ${o.lastLog}`),t.addSessionMetadataToLog(`Last ${t.formatSessionDuration(t.startTime,n)}`)}}return t.addSessionStartToLog(),t.logQueue=new R(t.disableDebounce?1:t.logQueueSize),t}async downloadLog(e,t){try{let o=E(e,t);await this.saveAndFlushQueuedLogs();let n=this.useLocalStorage?await this.getLogsFromStorage():this.logs,i=D(`${o}${n}`),s=new Blob([i],{type:"text/plain;charset=utf-8"}),g=URL.createObjectURL(s),h=new Date().toISOString().replace(/:|\./g,"-").slice(0,-5),p=`${this.logFilename}-${h}.txt`;if(L.default.downloads&&typeof L.default.downloads.download=="function")await L.default.downloads.download({url:g,filename:p,saveAs:!0}),URL.revokeObjectURL(g);else{let l=document.createElement("a");l.href=self.URL.createObjectURL(s),l.target="_blank",l.rel="noopener noreferrer",l.download=p,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(l.href)}}catch(o){let n=`Error downloading log file: ${o}`;F.captureError(new Error(n),b.FileLogger),console.error(n)}}getRecentLogs(e){let t=new TextEncoder,o=this.logs.split(`
`),n=0,i=o.length;for(let s=o.length-1;s>=0;s--){let g=t.encode(o[s]).length+1;if(n+g>e)break;n+=g,i=s}return o.slice(i).join(`
`)+`
`}write(...e){this.queueAndBatchWriteLogs(...e)}async queueAndBatchWriteLogs(...e){let t=this.formatNewLogData(...e);this.logQueue.add(t),this.debounceSaveAndFlushQueuedLogs.cancel(),this.logQueue.isFull()?await this.saveAndFlushQueuedLogs():await this.debounceSaveAndFlushQueuedLogs()}async saveAndFlushQueuedLogs(){this.logQueue.isEmpty()||(this.addItemToLogs(this.logQueue.toArray()),this.useLocalStorage&&await this.saveDataToStorage(this.logs),this.logQueue.clear())}formatNewLogData(...e){let t="";return this.useTimestamps&&(t+=this.formatDate()+" "),t+=e.map(o=>v({obj:o,depth:0,maxDepth:this.maxDepth,indent:this.indent,quoteStrings:this.quoteStrings})).join(" "),t+=`
`,t}addItemToLogs(e){Array.isArray(e)?e.forEach(t=>this.logs+=t):this.logs+=e,this.autoTrim&&(this.logs=this.trimLogByPercentage(.5,this.maxSize))}async saveDataToStorage(e){let t={startTime:this.startTime,log:e,lastLog:new Date};await P.set(this.storageKey,JSON.stringify(t))}async getLogsFromStorage(){let e=new Date,t=await this.getDataFromStorage();return t&&(this.startTime=new Date(t.startTime),this.logs=t.log),this.includeSessionMetadata?this.logs+`---- ${this.formatSessionDuration(this.startTime,e)} ----
`:this.logs}async getDataFromStorage(){let e=await P.get(this.storageKey);return e&&typeof e=="string"?JSON.parse(e):null}trimLogByPercentage(e,t){if(e<0||e>1)throw new Error("Percentage must be between 0 and 1");if(new TextEncoder().encode(this.logs).length<=t)return this.logs;let i=this.logs.split(`
`);i.pop();let s=Math.floor(i.length*e);return i.splice(0,s),i.join(`
`)+`
`}formatSessionDuration(e,t){let o=t.getTime()-e.getTime(),n=Math.floor(o/1e3/60/60),i=("0"+n).slice(-2);o-=n*1e3*60*60;let s=Math.floor(o/1e3/60),g=("0"+s).slice(-2);o-=s*1e3*60;let h=Math.floor(o/1e3),p=("0"+h).slice(-2);return o-=h*1e3,"Session duration: "+i+":"+g+":"+p}formatDate(e=new Date){return`[${e.toISOString()}]`}addSessionMetadataToLog(e){this.includeSessionMetadata&&(this.logs+=`---- ${e} ----
`)}addSessionStartToLog(){this.startTime=new Date,this.addSessionMetadataToLog(`Session started: ${this.formatDate(this.startTime)}`)}async clear(){this.logs="",this.logQueue.clear(),this.addSessionMetadataToLog(`Session started: ${this.formatDate(this.startTime)}`),this.addSessionMetadataToLog("Log cleared "+this.formatDate()),this.useLocalStorage&&await this.saveDataToStorage(this.logs)}search(e){let t=new RegExp(e,"ig"),o=this.logs.split(`
`),n=[];for(let s=0;s<o.length;s++){let g=`[${s}] `;o[s].match(t)&&n.push(g+o[s].trim())}let i=n.join(`
`);return i.length||(i=`Nothing found for "${e}".`),i}slice(...e){return this.logs.split(`
`).slice(...e).join(`
`)}};var j=1024*10,z={autoTrim:!0,useLocalStorage:!0,useTimestamps:!0},u=null,X={init:r(async()=>{try{u=await S.init(z)}catch{console.error(m)}},"init"),downloadLog:r(async a=>{if(!u){console.error(m);return}await u.saveAndFlushQueuedLogs()},"downloadLog"),getRecentLogs:r(async()=>u?u.getRecentLogs(j):(console.error(m),""),"getRecentLogs"),write:r((a,e,t,o)=>{if(!u){console.error(m);return}let n=o?` :: ${JSON.stringify(o)}`:"",s=`${(t??"info").toUpperCase()}: ${e}: ${a}${n}`;u.write(s)},"write"),getLogFilePaths:r(()=>{throw new Error(w)},"getLogFilePaths"),sendLogFilesByEmail:r(async a=>{throw new Error(w)},"sendLogFilesByEmail")};c();d();var U=new y(null,{loadPath:r(a=>{let e=a[0];return e.substring(0,3)==="fil"?`/locales/${e.substring(0,3)}/translation.json`:e.substring(0,2)==="zh"?e==="zh-CN"||e==="zh-TW"?`/locales/${e}/translation.json`:"/locales/zh-CN/translation.json":`/locales/${e.substring(0,2)}/translation.json`},"loadPath"),parse:r(a=>JSON.parse(a),"parse")});f.use(y).use(x).use(O).use(U).init({supportedLngs:A(),fallbackLng:"en",nonExplicitSupportedLngs:!0,debug:!1,returnNull:!1,detection:{order:["querystring","localStorage","cookie","sessionStorage","navigator","htmlTag","path","subdomain"],caches:["localStorage"]},react:{useSuspense:!1},interpolation:{escapeValue:!1}});f.on("initialized",()=>{N.setDisplayLanguage(f.language)});export{u as a,X as b};
//# sourceMappingURL=chunk-W5EYARUT.js.map
