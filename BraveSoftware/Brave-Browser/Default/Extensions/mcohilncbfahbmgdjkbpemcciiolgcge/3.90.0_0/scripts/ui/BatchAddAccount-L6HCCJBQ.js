import{a as Et,b as Ft}from"./chunk-RVEZ3WTX.js";import"./chunk-ZBCYRIHC.js";import{a as st,b as Tt}from"./chunk-VWSGO4JL.js";import{a as Bt}from"./chunk-XWF6GOGL.js";import"./chunk-OU7P2VBZ.js";import{a as V}from"./chunk-KUU4GGDO.js";import"./chunk-OB65JCC3.js";import{b as G}from"./chunk-RK4OLGCC.js";import{a as yt,b as gt,c as At,d as xt}from"./chunk-75HHDYID.js";import"./chunk-KNLCXBGN.js";import{ia as _t}from"./chunk-VHMBEOFX.js";import{b as W}from"./chunk-YVLQLIW6.js";import"./chunk-7DW2ZPOD.js";import{a as rt}from"./chunk-ARDRUD4P.js";import"./chunk-ZDJRNLYZ.js";import"./chunk-RV5WZKGQ.js";import{d as St}from"./chunk-KC2XLVFC.js";import{qa as It,ra as bt}from"./chunk-MJDO2VHF.js";import{h as pt}from"./chunk-TBQGFYU3.js";import"./chunk-L5AZICLM.js";import{c as ft}from"./chunk-WLEQHCLB.js";import{Za as O,_a as H}from"./chunk-QF42JCDG.js";import"./chunk-DRCTWZQB.js";import"./chunk-KGMP5AO5.js";import{c as v}from"./chunk-EAE2NUFS.js";import{a as ct}from"./chunk-RFTC6RNT.js";import"./chunk-ZIR6OOXX.js";import"./chunk-KYVX6VSI.js";import{c as l}from"./chunk-3FMJDUGT.js";import"./chunk-2O5TMJZM.js";import"./chunk-UI4IZNSB.js";import"./chunk-FCGPU67F.js";import"./chunk-FXRKHQFW.js";import"./chunk-YTHL7242.js";import"./chunk-XOHZCMW2.js";import{Mb as lt,v as dt,w as mt}from"./chunk-EQ34WRCJ.js";import"./chunk-UIZGYUZK.js";import{k as E,p as _}from"./chunk-DSNMNSMD.js";import"./chunk-U2IAA473.js";import{a as wt}from"./chunk-DOSBJ3L3.js";import"./chunk-3O2IEAHF.js";import{D as F,q as Ct,w as Nt}from"./chunk-URGJ6D4O.js";import"./chunk-WC6GCIBJ.js";import"./chunk-JRC3ZUKA.js";import"./chunk-4U5VOZ7H.js";import"./chunk-FVHZWNUE.js";import"./chunk-IQUFNLVG.js";import{C as g,t as ht,w as kt}from"./chunk-XYWWXNVK.js";import"./chunk-VYWNZTTM.js";import"./chunk-5CHTOVVG.js";import{a as nt}from"./chunk-FB3ILH2L.js";import{b as x}from"./chunk-FLSAETOH.js";import"./chunk-TGW66MRK.js";import"./chunk-LRIABBHT.js";import"./chunk-4C5HF6J2.js";import"./chunk-U6W3TK77.js";import"./chunk-WJI4CIAQ.js";import"./chunk-GTDBOF5Q.js";import"./chunk-EI7BJC6V.js";import"./chunk-B3EOGJ3Y.js";import"./chunk-YL2RBVBZ.js";import"./chunk-4HAPQ4J7.js";import"./chunk-F5YUOHHL.js";import"./chunk-26XSB24L.js";import"./chunk-IFKSF5TW.js";import"./chunk-PDIVTGDM.js";import"./chunk-UL6IEE2K.js";import"./chunk-4ARIYUS3.js";import{f as y,o as e,q as o}from"./chunk-UWURTNRY.js";e();o();var $=y(x()),M=y(wt());e();o();var L=y(x());e();o();var z=y(x());e();o();e();o();var Dt=y(x());e();o();var D=rt(gt,xt),Y=rt(yt,At);e();o();var Lt=y(wt());function oe(){let t=(0,Lt.useHistory)(),n=s=>(p=!0)=>{p?t.replace(s):t.push(s)},r=s=>t.location.pathname===s,i=n(H),m=n(O),c=r(O),a=r(H);return{isHomePage:c,isAddPage:a,gotoAddPage:i,gotoHomePage:m}}var j=oe;function ne(){let[t]=D(),{gotoHomePage:n,isHomePage:r}=j();(0,Dt.useLayoutEffect)(()=>{!r&&!t&&n()},[n,r,t])}var Pt=ne;function re(){return Pt(),null}var vt=re;e();o();var it={root:"_root_dowdc_1",header:"_header_dowdc_30"};function se({children:t,hidden:n=!1}){return z.default.createElement(l.Box,{className:it.root},z.default.createElement(Et,{className:it.header}),n?null:t,z.default.createElement(vt,null))}var Z=se;e();o();var ie={NONE:"NONE",ADDING:"ADDING",FINISHED:"FINISHED",FAILED:"FAILED"},u=ie;e();o();var S=y(x()),q=y(nt());e();o();var k={root:"_root_1gfwy_1",actions:"_actions_1gfwy_21",adding:"_adding_1gfwy_38",finish:"_finish_1gfwy_52",tip:"_tip_1gfwy_88",hiddenTip:"_hiddenTip_1gfwy_154",mobileFinishActions:"_mobileFinishActions_1gfwy_162"};function ae(t){let{isSm:n}=G(),{status:r,cancel:i,download:m,finish:c}=t,a=r===u.ADDING,s=ct(),p=n?W:l.Box,b=n&&!a?{offsetBottom:0,className:(0,q.default)(k.actions,k.mobileFinishActions)}:{};return S.default.createElement(l.Box,{className:k.root},S.default.createElement(p,{className:(0,q.default)(k.actions,a?k.adding:k.finish),...b},a?S.default.createElement(S.default.Fragment,null,S.default.createElement(g,{category:g.CATEGORY.outline,type:g.TYPE.primary,onClick:i,size:g.SIZE.xl,block:!0},_("wallet_extension_addaccount_adding_btn_cancel"))):S.default.createElement(S.default.Fragment,null,s!==dt&&s!==mt&&S.default.createElement(g,{category:g.CATEGORY.outline,type:g.TYPE.primary,size:g.SIZE.xl,onClick:Tt(_t)(m),block:n},_("wallet_extension_addaccount_adding_btn_download_address")),S.default.createElement(g,{category:g.CATEGORY.fill,type:g.TYPE.highlight,size:g.SIZE.xl,onClick:c,block:n},_("wallet_extension_addaccount_adding_btn_confirm")))),S.default.createElement(l.Box,{className:(0,q.default)(k.tip,!a&&k.hiddenTip)},a?_("wallet_extension_addaccount_adding_text_not_close"):""))}var Ot=ae;e();o();var J=y(x()),Ht=y(nt());e();o();var U={icon:"_icon_1y49k_1",failed:"_failed_1y49k_5",finished:"_finished_1y49k_8",loading:"_loading_1y49k_11"};var Ut=(t,n)=>()=>J.default.createElement(ht,{className:(0,Ht.default)(t,U.icon,n)}),ue=Ut("okx-wallet-plugin-completed",U.finished),de=Ut("okx-wallet-plugin-warning-circle",U.failed),me=()=>J.default.createElement(kt,{loaderClassName:U.loading}),ce=()=>null,le={[u.NONE]:ce,[u.ADDING]:me,[u.FINISHED]:ue,[u.FAILED]:de},_e=({status:t})=>{let n=le[t];return J.default.createElement(n,null)},Kt=_e;e();o();var R=y(x());e();o();var Q={root:"_root_1n2pz_1",item:"_item_1n2pz_75",retry:"_retry_1n2pz_98"};e();o();var fe=({status:t,success:n=0,total:r=0,failed:i=0})=>{let c=u.FINISHED===t?r-n:i,a={success:{key:"wallet_extension_addaccount_adding_text_create_success",params:{num:E.thousandFormat(n)}},failed:{key:"wallet_extension_addaccount_adding_text_create_failed",params:{num:E.thousandFormat(c)},withRetry:c>0},adding:{key:"wallet_extension_addaccount_remainder_created_account",params:{successnum:E.thousandFormat(n),totalnum:E.thousandFormat(r)}}};return{items:{[u.NONE]:[],[u.ADDING]:[a.adding],[u.FINISHED]:c>0?[a.success,a.failed]:[a.success],[u.FAILED]:[a.failed]}[t]}},Mt=fe;function pe(t){let{items:n=[]}=Mt({status:t.status,success:t.success,total:t.total,failed:t.failed}),{retry:r}=t;return R.default.createElement(l.Box,{className:Q.root},n.map((i,m)=>{let{key:c,params:a,withRetry:s}=i;return R.default.createElement(l.Box,{key:m,className:Q.item},_(c,a),s&&R.default.createElement(l.Box,{onClick:r,className:Q.retry},_("wallet_extension_addaccount_adding_textbtn_retry")))}))}var Wt=pe;e();o();var Vt=y(x()),Yt=y(nt());e();o();var Gt={root:"_root_x2b1d_1"};var ye=({status:t,className:n,walletName:r})=>{let m={[u.NONE]:null,[u.ADDING]:{key:"wallet_extension_addaccount_remainder_account_creating",params:{acctName:r}},[u.FINISHED]:{key:"wallet_extension_addaccount_remainder_account_created"},[u.FAILED]:{key:"wallet_extension_addaccount_adding_maintitle_create_failed"}}[t],c=m?_(m.key,m.params):"";return Vt.default.createElement(l.Box,{className:(0,Yt.default)(Gt.root,n)},c)},jt=ye;e();o();var zt={root:"_root_1uqqr_1"};e();o();var I=y(x());e();o();var ge=()=>{let t=It();return async(r,i=1)=>{try{return await v().addNewWallets(r,i)}catch(m){throw t(ft(m?.message)),m}finally{await pt(t)}}},Zt=ge;var Ae=t=>{let{newAccountsSuccessCount:n,newAccountsFailedCount:r}=t.metamask;return{newAccountsSuccessCount:n,newAccountsFailedCount:r}},xe=t=>t>0,Se=(t,n,r)=>r!==void 0?!1:t>0||!xe(n),Ie=t=>t||"",be=t=>{let[n,r]=(0,I.useState)(u.NONE),{newAccountsSuccessCount:i,newAccountsFailedCount:m}=bt(Ae),c=st(),a=(0,I.useRef)({}),[s]=Y(),[p,b]=(0,I.useState)(0),[A,h]=(0,I.useState)(0),w=Zt(),N=s-p;(0,I.useEffect)(()=>{s<=0||(p===s&&r(u.FINISHED),A===s&&r(u.FAILED))},[A,p,s]);let B=async ut=>{if(Se(p,s,ut))return;let et=ut||s;r(u.ADDING);try{let ot=await w(Ie(t),et);b(ee=>ee+ot),h(et-ot)}catch{h(et)}finally{r(u.FINISHED)}};return{start:B,cancel:()=>{r(u.FINISHED),a.current?.cancel?.(),v().stopBatchAddNewWallets()},retry:()=>{N>0&&(h(0),B(N))},failed:c?A+m:A,success:c?p+i:p,total:s,remain:N,status:n}},we=t=>{let{keyringIdentities:n,remainAccountAmount:r}=V(),i=n.find(c=>c.keyringId===t),m=i?.walletIdentities?.[0]?.walletId;return{keyring:i,walletId:m,remainAccountAmount:r}};function he(){let[t]=D(),n=st(),r=St(n),{walletId:i,keyring:m,remainAccountAmount:c}=we(t),a=(0,I.useRef)(!1),{start:s,cancel:p,retry:b,success:A,failed:h,total:w,status:N}=be(i),B=Ft();return(0,I.useEffect)(()=>{!a.current&&i&&c>0&&(s(),a.current=!0)},[i,c,s]),(0,I.useEffect)(()=>{let T=async()=>{r.current===!0&&v().stopBatchAddNewWallets()};return window.addEventListener("beforeunload",T),()=>{window.removeEventListener("beforeunload",T)}},[]),{start:s,cancel:p,retry:b,success:A,failed:h,total:w,keyring:m,status:N,onFinish:B}}var qt=he;var ke=()=>{let{cancel:t,retry:n,success:r,failed:i,total:m,keyring:c,status:a,onFinish:s}=qt(),{downloadAddress:p}=Bt();return L.default.createElement(Z,{hidden:a===u.NONE},L.default.createElement(l.Box,{className:zt.root},L.default.createElement(Kt,{status:a}),L.default.createElement(jt,{status:a,walletName:c?.keyringName}),L.default.createElement(Wt,{status:a,retry:n,total:m,failed:i,success:r}),L.default.createElement(Ot,{status:a,cancel:t,download:p,finish:s})))},Jt=ke;e();o();var K=y(x());e();o();var f=y(x());e();o();var C={root:"_root_1umy7_2",confirm:"_confirm_1umy7_41",max:"_max_1umy7_55",label:"_label_1umy7_67",name:"_name_1umy7_73",nums:"_nums_1umy7_80",option:"_option_1umy7_86",icon:"_icon_1umy7_105"};e();o();var Qt=y(x());var Ce=t=>t.filter(n=>[lt.MNEMONIC].includes(n.keyringIdentityType)).filter(n=>n.walletIdentities.every(r=>r.needBackup!==1)),at=1;function Ne(){let t=F.useForm(),{gotoAddPage:n}=j(),{keyringIdentities:r,remainAccountAmount:i}=V(),[,m]=Y(),[,c]=D(),a=w=>{if(Object.keys(t.getErrors()).length>0)return;let{keyringId:B,amount:T}=w;if(T==="0")return;let tt=Number(T||at);!B||tt>i||(m(tt),c(B),n())},s=(0,Qt.useMemo)(()=>Ce(r).map(w=>({value:w.keyringId,label:w.keyringName,len:w.walletIdentities.length})),[r]),p={keyringId:s[0]?.value,amount:""},b=(w,N=at)=>{if(Number(N||at)<=i&&i>0)return Promise.resolve();let T=_("wallet_extension_addaccount_remainder_added_upper_limits",{num:E.thousandFormat(i)});return Promise.reject(T)},A=()=>{t.setFieldsValue({amount:i})},h=i<=0||s.length<=0;return{initialValues:p,onSubmit:a,form:t,options:s,amountValidator:b,onSetMaxAmount:A,disableAdd:h}}var Rt=Ne;function Be(){let{initialValues:t,onSubmit:n,form:r,options:i,amountValidator:m,onSetMaxAmount:c,disableAdd:a}=Rt(),{isSm:s}=G(),p=s?W.FooterActions:f.default.Fragment,b=A=>f.default.createElement(f.default.Fragment,null,f.default.createElement("div",{className:C.name},A.label),f.default.createElement("div",{className:C.nums},_("wallet_extension_batch_modify_account_num",{num:A.len})));return f.default.createElement(l.Box,{className:C.root},f.default.createElement(F,{requiredMark:!0,initialValues:t,onSubmit:n,form:r},f.default.createElement(F.Item,{label:_("wallet_extension_addaccount_title_select_wallet"),name:"keyringId"},f.default.createElement(Nt,{title:_("wallet_extension_addaccount_title_select_wallet"),options:i,searchable:!1,showSelectedIcon:!0,label:A=>f.default.createElement("div",{className:C.label},b(A)),renderOption:({option:A,activeIcon:h})=>f.default.createElement("div",{className:C.option},A&&f.default.createElement("div",null,b(A)),f.default.createElement("div",{className:C.icon},h))})),f.default.createElement(F.Item,{label:_("wallet_extension_addaccount_text_added_amount"),name:"amount",rules:[{validator:m}]},f.default.createElement(Ct.Number,{placeholder:"1",precision:0,min:1,suffix:f.default.createElement(l.Box,{className:C.max,onClick:c},_("wallet_extension_addaccount_textbtn_max"))})),f.default.createElement(p,null,f.default.createElement(F.Item,{noStyle:!0,className:s?void 0:C.confirm},f.default.createElement(g,{category:g.CATEGORY.fill,type:g.TYPE.highlight,size:g.SIZE.xl,disabled:a,htmlType:"submit",block:!0},_("wallet_extension_addaccount_btn_add"))))))}var Xt=Be;e();o();var X=y(x());e();o();var P={root:"_root_5jwcg_1",titleBox:"_titleBox_5jwcg_17",title:"_title_5jwcg_17",subtitle:"_subtitle_5jwcg_112",add:"_add_5jwcg_131"};var Te=()=>{let t=_("wallet_extension_addaccount_title_add_account"),n=_("wallet_extension_addaccount_subtitle_select_account");return X.default.createElement(l.Box,{className:P.titleBox},X.default.createElement(l.Box,{className:P.title},t),X.default.createElement(l.Box,{className:P.subtitle},n))},$t=Te;var Ee=()=>K.default.createElement(Z,null,K.default.createElement(l.Box,{className:P.root},K.default.createElement($t,null),K.default.createElement(Xt,null))),te=Ee;var Fe=()=>$.default.createElement(M.Switch,null,$.default.createElement(M.Route,{path:O,component:te,exact:!0}),$.default.createElement(M.Route,{path:H,component:Jt,exact:!0})),ms=Fe;export{ms as default};
//# sourceMappingURL=BatchAddAccount-L6HCCJBQ.js.map
