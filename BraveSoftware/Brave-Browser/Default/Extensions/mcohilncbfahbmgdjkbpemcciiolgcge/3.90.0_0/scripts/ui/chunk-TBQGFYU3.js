import{a as A}from"./chunk-L5AZICLM.js";import{c as d}from"./chunk-WLEQHCLB.js";import{J as P,S as x,a as y,f as h}from"./chunk-DRCTWZQB.js";import{c as S,o as b,u as I}from"./chunk-KGMP5AO5.js";import{c as u}from"./chunk-EAE2NUFS.js";import{c as M}from"./chunk-2O5TMJZM.js";import{L as T,P as _}from"./chunk-UI4IZNSB.js";import{a as w}from"./chunk-FXRKHQFW.js";import{d as k,e as c,sb as E}from"./chunk-EQ34WRCJ.js";import{f as p,n as process,o as g,q as f}from"./chunk-UWURTNRY.js";g();f();var W=p(A());g();f();var O=b({name:"keyring",initialState:{keyringIdentities:[],selectedWallet:""},reducers:{setKeyringIdentities:(e,t)=>{e.selectedWallet=t.payload.selectedWallet,e.keyringIdentities=t.payload.keyringIdentities}}}),{actions:V,reducer:$}=O,{setKeyringIdentities:v}=V,G=$;var L=p(w());g();f();var m=p(A());var a=p(w());var D=(e={})=>{let t={};return Object.entries(e).forEach(([n,r])=>{t[n]={message:r}}),t};function B(e,t){return t===a.LOCALE_TYPE.default?e:`${t}_${e}`}async function i(e,t,n){i.cache||(i.cache={});let r=B(e,t);if(n&&i.cache[r])return i.cache[r];try{let{data:s}=await S(()=>T(M.i18nConfigUrl(e,t)),2,0),o=t===a.LOCALE_TYPE.default?D(s):s;return k.set({[r]:o}),i.cache[r]=o,o}catch(s){m.default.error(s)}return{}}async function U(e,t){let n=B(e,t);return new Promise((r,s)=>{k.get(n).then(o=>{r(o[n])}).catch(o=>{s(o)})})}async function Y(e,t=a.LOCALE_TYPE.default,n=void 0){try{let r={};if(process.env.ASSETS_BUILD_TYPE===c.PREPUB||process.env.ASSETS_BUILD_TYPE===c.PUBLISH){if(n?.remote)try{return r=await i(e,t,!1),n.storageWallet.set(n.project,n.version),r}catch(s){m.default.error(`failed to fetch ${e} locale because of`,s)}try{r=await U(e,t)}catch{return i(e,t,!0)}if(r&&Object.keys(r).length>0)return(!n||n.remote)&&i(e,t,!0),r}return await i(e,t,!0)}catch(r){return m.default.error(`failed to fetch ${e} locale because of`,r),{}}}async function K(e,t=a.LOCALE_TYPE.default,n=void 0){if(process.env.PLATFORM_WEB)return Y(e,t,n);try{let r={};return(process.env.ASSETS_BUILD_TYPE===c.PREPUB||process.env.ASSETS_BUILD_TYPE===c.PUBLISH)&&(r=await U(e,t)),{...await(await fetch(`/${t}/${e}/messages.json`)).json(),...r}}catch(r){return m.default.error(`failed to fetch ${e} locale because of`,r),{}}}async function l(e,t=a.LOCALE_TYPE.default,n=!0){if(process.env.ASSETS_BUILD_TYPE===c.PREPUB||process.env.ASSETS_BUILD_TYPE===c.PUBLISH){let r=await i(e,t,n);if(r)return r}return K(e,t)}async function oe(e){i(e,a.LOCALE_TYPE.default,!1),i(e,a.LOCALE_TYPE.dex,!1),i(e,a.LOCALE_TYPE.okd,!1),i(e,a.LOCALE_TYPE.defi,!1)}function N(e,t,n,r,s){return{type:P,value:{locale:e,messages:t,okdMessages:n,dexMessages:r,defiMessages:s}}}async function ke(){await u().getChainsFromServerAndSyncToControllers()}function J(e){return async t=>{try{let n=await l(e),r=await l(e,L.LOCALE_TYPE.okd),s=await l(e,L.LOCALE_TYPE.dex),o=await l(e,L.LOCALE_TYPE.defi);await u().setCurrentLocale(e),t(N(e,n,r,s,o)),_(e)}catch(n){t(d(n.message))}}}function C(e,t,n=!0){Array.isArray(e.accountIdentities)&&Array.isArray(e.keyringIdentities)&&(t(v(I({accountIdentities:e.accountIdentities,keyringIdentities:e.keyringIdentities,multiAddressBaseChainsMap:e.multiAddressBaseChainsMap,selectedWallet:e.selectedWallet}))),n&&(delete e.accountIdentities,delete e.keyringIdentities,delete e.multiAddressBaseChainsMap,delete e.selectedWallet))}function j(e){return(t,n)=>{let{metamask:r}=n(),{currentLocale:s}=r,{currentLocale:o}=e;s&&o&&s!==o&&t(J(o)),C(e,t),t({type:y,value:e})}}async function ye(e){let t;try{t=await u().getStateByDomain()}catch(n){throw e(d(n.message)),n}return e(j(t)),t}var F=async e=>{let t;try{t=await u().getState()}catch(n){throw e(d(n.message)),n}return e(j(t)),t};function he(e){return t=>{e.chainList&&E(e.chainList),C(e,t),t({type:y,value:e})}}var H=async()=>{await u().setLocked()};function Ae(){return W.default.debug("background.setLocked"),async e=>{try{await H(),await F(e),e({type:h})}catch{e({type:h})}}}function Se(){return async e=>{try{await u().setLastActiveTime()}catch(t){e(d(t.message))}}}function q(e){return{type:x,value:e}}function we(){return async e=>{let t=await globalThis.platform.currentTab();e(q(t))}}export{G as a,K as b,oe as c,ke as d,J as e,C as f,j as g,ye as h,F as i,he as j,Ae as k,Se as l,we as m};
//# sourceMappingURL=chunk-TBQGFYU3.js.map
