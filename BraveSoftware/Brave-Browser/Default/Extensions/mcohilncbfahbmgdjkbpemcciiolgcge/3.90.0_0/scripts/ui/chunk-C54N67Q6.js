import{a as ce}from"./chunk-VRCAHYHW.js";import{a as We}from"./chunk-BDLFPOJT.js";import{a as Be}from"./chunk-N6NP4323.js";import{a as ze}from"./chunk-ARYCEY4U.js";import{a as Ue}from"./chunk-7SVXGEVR.js";import{a as He}from"./chunk-GVO5XBXE.js";import{a as ae}from"./chunk-XI5NMQGM.js";import{a as De}from"./chunk-3MLYZLAT.js";import{a as Ge}from"./chunk-IY6TM6RL.js";import{a as Me,b as ve}from"./chunk-VUWWQCMX.js";import{a as se}from"./chunk-OHHYJNZI.js";import{a as ie}from"./chunk-5EFGCLI4.js";import{j as Le,k as re}from"./chunk-EUAAIPZO.js";import{a as Re}from"./chunk-ZFAUEPQW.js";import{a as Se}from"./chunk-C4TBDTQO.js";import{u as Ee,v as Oe}from"./chunk-BIUKJDG5.js";import{d as G}from"./chunk-YLT6ZRGE.js";import{b as Y}from"./chunk-QMHGGMPE.js";import{c as Fe}from"./chunk-GVYIP5Q5.js";import{j as Pe,k as ge,l as be,m as Ne,n as xe}from"./chunk-W3VW6MYS.js";import{m as te}from"./chunk-CKHT4PIF.js";import{j as K}from"./chunk-WYX7GFOD.js";import{a as ne}from"./chunk-MJSLAJV6.js";import{a as ke}from"./chunk-KC2XLVFC.js";import{qa as oe}from"./chunk-MJDO2VHF.js";import{e as Ae}from"./chunk-OLICTWCW.js";import{E as k}from"./chunk-3F7OC7N7.js";import{a as Te,c as $,h as fe}from"./chunk-EPDR6VAQ.js";import{F as v,G as he,Ga as _e,da as ee}from"./chunk-EQ34WRCJ.js";import{k as we,p as j}from"./chunk-DSNMNSMD.js";import{b as J}from"./chunk-FLSAETOH.js";import{Aa as ye,Q as de,g as Ie}from"./chunk-4C5HF6J2.js";import{f as q,o as u,q as p}from"./chunk-UWURTNRY.js";u();p();var Ce=q(J());u();p();var U=q(J());u();p();function tn({walletId:e,method:t,message:n,onConfirm:r}){let I=oe();return async()=>{let S=await I(ce({walletId:e,localType:ee,method:t,params:{message:n}})),{publicKey:d,signature:y}=S||{},T=xe(Ne(d),y);return r(T)}}var Ve=tn;var qe=e=>{let{walletId:t,method:n,params:r,source:I,onConfirm:i,onCancel:S,providerType:d}=e,y=I==="dapp",[T,s]=(0,U.useState)({}),a=typeof r?.message=="string"?r?.message:new TextDecoder().decode(r?.message),f=Ve({walletId:t,method:n,message:a,onConfirm:i}),g,_,b;y||(g=f,_=!0,b=S);let A=ie(e),o=G(_e)||{},N=te(o?.localType,t),c=Y(d||v),w=(0,U.useMemo)(()=>({method:n,dappData:JSON.stringify({message:a}),dappInfo:y?A:{},from:N,message:a,chainIndex:o.chainId}),[N]),l=K(t)||{},D=Be({unapproved:e,onConfirm:g,onConfirmReplace:_,onCancel:b,preExecInfo:T}),E=se({initialType:l?.initialType}),x=(0,U.useMemo)(()=>[E()].filter(Boolean),[E]);return U.default.createElement(re,{needPreExecFn:()=>!1,preExecParams:w,buttonGroup:D,txType:Le.signMessage,handleCancel:b,walletAccount:l,onUpdatePreExecInfo:s,chainHeaderTips:x,localType:o?.localType,networkFeeProps:{coinId:c?.coinId},slot:{bottom:!!r?.isSilentSign&&U.default.createElement(ae,{walletAccount:l})}})};u();p();var le=q(J());u();p();var P=q(J());ye();u();p();var Ke=q(J());ye();u();p();var h=q(J());function rn({coinId:e,transactions:t,address:n,replace:r,disabled:I,unitLimits:i,signInfo:S,method:d}){let[y,T]=(0,h.useState)(0),[s,a]=(0,h.useState)(null),[f,g]=(0,h.useState)([]),[_,b]=(0,h.useState)("0"),[A,o]=(0,h.useState)([]),[N,c]=(0,h.useState)(!1),w=s?.fee||"0",[l,D]=(0,h.useState)(t||[]),E=He(),x=G(e),{disabledSignInfo:R=!1,disabledPreExecute:W=!1}=I||{},[H,,V]=De({coinId:e,address:n,chainId:x?.chainId},{ready:!!e&&!!n&&!R,onSuccess:a}),L=F=>{T(F?m=>m+1:m=>m-1)};return(0,h.useEffect)(()=>{i&&g(i)},[i]),(0,h.useEffect)(()=>{S&&a(S)},[S]),(0,h.useEffect)(()=>{V&&c(!0)},[V]),(0,h.useEffect)(()=>{(async function(){if(!(W||!e)&&!(!r||!x?.chainId)){L(!0);try{let m=await E({from:n,chainId:x.chainId,transactions:(t||[]).map(({serializedMessage:O})=>O),method:d});g(m.unitLimits),c(!1)}catch{c(!0)}finally{L(!1)}}})()},[t,r,n,x?.chainId,W,e,d]),(0,h.useEffect)(()=>{(async function(){if(!(r&&(!s||!f?.length))){L(!0);try{let m=t||[];r&&s&&(m=await Promise.all(m.map(async(M,Q)=>{let{serializedMessage:X,whetherModified:Z,...me}=M,ue=await Oe(X,s.computeUnitPrice,f[Q],Z);return{...me,serializedMessage:ue,whetherModified:Z}})));let{totalPriorityFee:O,priorityFees:C}=await Ee(m.map(({serializedMessage:M})=>M));b(O),D(m),o(C),c(!1)}catch{c(!0)}finally{L(!1)}}})()},[t,r,s,f]),{loading:y>0||H,baseFee:w,totalPriorityFee:_,priorityFees:A,totalFee:$(Te(w,(t||[]).length),_),signInfo:s,estimateFailed:N,replacedTransactions:l}}var Je=rn;var sn=({from:e,coinId:t,preExecInfo:n,walletId:r,transactions:I,addPriorityFee:i,method:S})=>{let d=n?.loading,y=(0,Ke.useMemo)(()=>n?.unitGasLimitList||[],[n]),{loading:T,totalFee:s,baseFee:a,priorityFees:f,estimateFailed:g,signInfo:_,replacedTransactions:b}=Je({coinId:t,transactions:I||[],address:e,replace:i,unitLimits:y,disabled:{disabledPreExecute:!0},method:S}),A=_?.solRent||"0",o=g||!d&&n.preExeStatus===!1,N=Re(t,r)||{},{coinAmountInt:c}=N,w=de(c)||fe(c,s)||d,l=de(c)||fe(c,$(s,A))||d;return{loading:T,networkFeeProps:{loading:T,networkFee:s,estimateFailed:o,coinId:t},isSufficientGas:w,baseFee:a,priorityFees:f,networkFee:s,estimateFailed:o,estimateFailedMsg:o?j("wallet_extension_alert_estimate_unavailable"):null,isSufficientBalance:l,selfRent:A,replacedTransactions:b,coinWithBalance:N}},Ye=sn;function an({txId:e,coinId:t,walletId:n,transactions:r=[],dappInfo:I={},showDappInfo:i=!0,addPriorityFee:S=!0,showSwitchNetwork:d=!0,onConfirm:y,onCancel:T,onAddressCopy:s=Ie,onNetworkChange:a,method:f,providerType:g=v,slot:_={}}){let b=Y(g),A=t||b?.coinId,o=G(A)||{},N=o.localType,c=K(n),w=te(N,n),[l,D]=(0,P.useState)({}),E=(0,P.useMemo)(()=>r.map(z=>{try{if(z.serializedMessage)return z;let pe=be(z);return{instanceType:pe,serializedMessage:Pe(z,pe),needToReplaceRecentBlockhash:!z.recentBlockhash}}catch{return null}}).filter(Boolean),[r.length]),{networkFee:x,isSufficientGas:R,networkFeeProps:W,estimateFailed:H,estimateFailedMsg:V,loading:L,isSufficientBalance:F,selfRent:m,replacedTransactions:O,coinWithBalance:C}=Ye({from:w,coinId:A,walletId:n,transactions:E,addPriorityFee:S,preExecInfo:l,method:f}),M=(0,P.useCallback)(()=>!F&&R?{renderMessage:()=>j("wallet_extension_loading_text_reserve_rent_exempt",{num:ne(we.div(m,10**o?.decimals),{precision:o?.displayPrecision,isStableCoin:o?.stableCoin,roundingMode:"CEIL"}).value,token:o?.symbol,balance:ne(C?.coinAmount,{useLargeNumberPrecision:!0,precision:C?.displayPrecision,isStableCoin:C?.stableCoin}).value}),level:761,type:Se.FEE_BALANCE_INSUFFICIENT,txId:e,coinId:o?.coinId,address:w,walletId:n}:null,[F,R,e,o?.coinId,o?.decimals,o?.symbol,w,n,m,C?.coinAmount]),Q=se({initialType:c?.initialType}),X=(0,P.useCallback)(()=>l?.needFillUp?{renderMessage:()=>j("wallet_extension_trade_text_insufficient_funds",{token:o?.symbol,balance:ne(C?.coinAmount,{useLargeNumberPrecision:!0,precision:C?.displayPrecision,isStableCoin:C?.stableCoin}).value}),level:825,type:Se.FEE_BALANCE_INSUFFICIENT,txId:e,coinId:o?.coinId,address:w,walletId:n}:null,[o?.coinId,o?.symbol,w,l?.needFillUp,C?.coinAmount,e,n]),Z=(0,P.useMemo)(()=>[M(),Q(),X()].filter(Boolean),[M,Q,X]),me=(0,P.useMemo)(()=>({dappData:JSON.stringify(E.map(z=>({transaction:z.serializedMessage,sigVerify:!1,replaceRecentBlockhash:!0}))),from:w,dappInfo:i?I:{},chainIndex:o?.chainId,method:f,forceLoading:!0}),[o?.chainId]),ue=ke(async()=>{await y({serviceCharge:x,replacedTransactions:O,serializedTransactions:E})}),{handleCancel:$e,buttonGroup:en}=Ge({feeLoading:L,estimateFailed:H,isSufficientGas:R,isSufficientBalance:F,onCancel:T,onConfirm:ue,chainConfirmDisabled:Ae(c?.initialType),coinWithBalance:C,preExecInfo:l}),nn={txId:e,baseCoin:o,estimateFailed:H,isSufficientBalance:F,isSufficientGas:R,estimateFailedMsg:V,coinWithBalance:C},on=(0,P.useMemo)(()=>({showSwitchNetwork:d,providerType:g,onNetworkChange:a}),[d,g,a]);return P.default.createElement(re,{slot:{..._},networkProps:on,chainHeaderTips:Z,networkFeeProps:W,preExecParams:me,onAddressCopy:s,walletAccount:c,handleCancel:$e,buttonGroup:en,localType:o?.localType,txState:nn,onUpdatePreExecInfo:D})}var je=an;u();p();function cn(e){let{coinId:t,showSwitchNetwork:n=!0}=e?.params?.extParams||{},{providerType:r=v}=e?.params||{},i=Y(r)?.coinId;return{coinId:t||i,showSwitchNetwork:r===he?!1:n}}var Qe=cn;u();p();function ln({coinId:e,walletId:t,method:n,okxArgs:r,onConfirm:I}){let i=oe();return async({replacedTransactions:S,serviceCharge:d,serializedTransactions:y})=>{let a=await i(ce({walletId:t,localType:ee,method:n,params:{message:y,okxArgs:r},extraParams:{coinId:e,replacedTransactions:S,serviceCharge:d}})),f;if(n===k.SIGN_ALL_TRANSACTIONS)f=(a.signedTransactionResults||[]).map(({serializedTransaction:g,type:_})=>ge(g,_));else if(n===k.SIGN_TRANSACTION){let{instanceType:g}=y[0]||{};f=ge(a.serializedTransaction,g)}else n===k.SIGN_AND_SEND_TRANSACTION&&(f=a);return I(f)}}var Xe=ln;var Ze=e=>{let{id:t,coinId:n,method:r,params:I,walletId:i,origin:S,source:d,dappInfo:y,showDappInfo:T=!0,addPriorityFee:s=!0,showSwitchNetwork:a,onConfirm:f,onCancel:g,onAddressCopy:_,okxArgs:b}=e,{providerType:A=v,isSilentSign:o}=I,{coinId:N,showSwitchNetwork:c}=Qe(e),w=ie(e),l=n||N,D=Fe({coinId:l}),x=(G(l)||{}).localType,R=I?.message||[],W=K(i),H=ve({id:t,extraParams:{coinId:l}}),V=Me({walletId:i,localType:x,id:t,origin:S}),L=We({walletId:i}),F=Xe({coinId:l,walletId:i,method:r,okxArgs:b,onConfirm:f}),m,O,C;d==="dapp"?(m=H,O=V,C=L):(m=F,O=g,C=_);let{loading:M}=ze({unapproved:{origin:S,id:t},network:D?.chainName,providerType:A});return M?le.default.createElement(Ue,null):le.default.createElement(je,{method:r,coinId:l,showSwitchNetwork:typeof a=="boolean"?a:c,slot:{bottom:o&&le.default.createElement(ae,{walletAccount:W})},txId:t,walletId:i,transactions:R,dappInfo:y||w,showDappInfo:T,addPriorityFee:s,onConfirm:m,onCancel:O,onAddressCopy:C,providerType:A})};function mn(e){switch(e.method){case k.SIGN_TRANSACTION:case k.RPC_SIGN_TRANSACTION:case k.SIGN_AND_SEND_TRANSACTION:case k.RPC_SIGN_AND_SEND_TRANSACTION:case k.SIGN_ALL_TRANSACTIONS:case k.RPC_SIGN_ALL_TRANSACTIONS:return Ce.default.createElement(Ze,{...e});case k.SIGN_MESSAGE:case k.RPC_SIGN_MESSAGE:return Ce.default.createElement(qe,{...e});default:return""}}var Ko=mn;export{Ko as a};
//# sourceMappingURL=chunk-C54N67Q6.js.map
