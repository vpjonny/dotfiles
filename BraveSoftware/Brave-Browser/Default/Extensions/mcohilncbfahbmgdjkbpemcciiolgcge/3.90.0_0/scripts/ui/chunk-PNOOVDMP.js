import{a as b,b as l}from"./chunk-DU4RS7AX.js";import{b as C}from"./chunk-FLSAETOH.js";import{f as m,o as d,q as f}from"./chunk-UWURTNRY.js";d();f();var a=m(C());d();f();var n=m(C());var S=(0,n.createContext)(null);function M({children:u}){let c=(0,n.useRef)(new Map),s=(0,n.useRef)(new Map),g=(0,n.useRef)(null);(0,n.useEffect)(()=>{let e=new BroadcastChannel("okx-chrome-storage");g.current=e;let r=async o=>{let t=o?.data?.key;if(!t)return;let i=c.current.get(t);if(!i||i.size===0)return;let x=await l(t);s.current.set(t,x),i.forEach(v=>v(x))};return e.addEventListener("message",r),()=>{e.removeEventListener("message",r),g.current=null,c.current.clear(),s.current.clear()}},[]);let p=(0,n.useMemo)(()=>({subscribe:(e,r)=>{if(!e)return()=>{};let o=c.current.get(e);return o||(o=new Set,c.current.set(e,o)),o.add(r),(async()=>{let t=s.current.get(e);if(t!==void 0){r(t);return}let i=await l(e);s.current.set(e,i),r(i)})(),()=>{let t=c.current.get(e);!t||(t.delete(r),t.size===0&&(c.current.delete(e),s.current.delete(e)))}},get:async e=>{let r=s.current.get(e);if(r!==void 0)return r;let o=await l(e);return s.current.set(e,o),o}}),[]);return n.default.createElement(S.Provider,{value:p},u)}var V=(u,c)=>{let[s,g]=(0,a.useState)(c),[p,e]=(0,a.useState)(!0),r=(0,a.useContext)(S);(0,a.useEffect)(()=>{if(!u)return()=>{};if(!r)return()=>{};let t=r.subscribe(u,i=>{g(i),e(!1)});return()=>{t()}},[u,r]);let o=(0,a.useCallback)(t=>u?(g(t),b(u,t)):!1,[u]);return{data:s,set:o,loading:p}};export{M as a,V as b};
//# sourceMappingURL=chunk-PNOOVDMP.js.map
