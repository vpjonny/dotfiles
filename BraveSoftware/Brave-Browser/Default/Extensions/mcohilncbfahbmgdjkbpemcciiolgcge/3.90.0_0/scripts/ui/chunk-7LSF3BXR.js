import{a as x,i as M,l as N,w as L}from"./chunk-KC2XLVFC.js";import{c as d}from"./chunk-EAE2NUFS.js";import{D as h,b as c}from"./chunk-EQ34WRCJ.js";import{a as l}from"./chunk-DSNMNSMD.js";import{b as S}from"./chunk-FLSAETOH.js";import{Aa as z,Q as T}from"./chunk-4C5HF6J2.js";import{f as m,o as n,q as t}from"./chunk-UWURTNRY.js";n();t();var p=m(S());n();t();var U=m(S());n();t();var I=m(c());var b={EXTENSION_INSTALLED:"EXTENSION_INSTALLED",EXTENSION_UNINSTALLED:"EXTENSION_UNINSTALLED"},Q=e=>!!e?.type&&!!e?.data&&e.type===b.EXTENSION_INSTALLED,V=e=>!!e?.type&&!!e?.data&&e.type===b.EXTENSION_UNINSTALLED,P=e=>{let o=s=>{if(Q(s)){let i=s?.data||[];e(i)}};return I.default.runtime.onMessage.addListener(o),d().addOnInstallExtensionListener(),()=>{I.default.runtime.onMessage.removeListener(o),d().removeOnInstallExtensionListener()}},O=e=>{let o=s=>{if(V(s)){let i=s?.data||[];e(i)}};return I.default.runtime.onMessage.addListener(o),d().addOnUnInstallExtensionListener(),()=>{I.default.runtime.onMessage.removeListener(o),d().removeOnUnInstallExtensionListener()}};var H=(e,o,s)=>{(0,U.useEffect)(()=>{if(!e)return()=>{};let i=o.listenInstall?P(s):void 0,a=o.listenUninstall?O(s):void 0;return()=>{e&&(i?.(),a?.())}},[e,o,s])},v=H;function Se(e,o={}){let[s,i]=(0,p.useState)([]),[a,u]=(0,p.useState)(!0),[g,f]=(0,p.useState)(null),E=x(async()=>{u(!0),f(null);try{let k=await d().getInstalledExtensions();i(k)}catch(k){f(k)}finally{u(!1)}});(0,p.useEffect)(()=>{!e||E()},[E,e]),v(e,o,E);let _=(0,p.useMemo)(()=>new Set((s??[]).map(k=>k.id)),[s]);return{extensions:s,loading:a,error:g,refresh:E,extensionIds:_}}n();t();var q=m(c());var Y=()=>l.isEdge?"edge://extensions/":l.isFirefox?"about:addons":l.isOpera?"opera://extensions/":l.isBrave?"brave://extensions/":"chrome://extensions/";function j(){let e=Y();q.default.tabs.create({url:e})}var G=j;n();t();n();t();var w=m(c());var J=()=>!(!w.default.permissions||!w.default.management||l.isOKXDesktop||l.isSafari||l.isFirefox),A=J;var C=A;n();t();n();t();var ne=m(c());n();t();var W=m(c());n();t();var Z=m(c());n();t();var se=m(c());n();t();var te=m(c());n();t();var re=m(c());n();t();var ie=m(c());n();t();var y=m(S());function Nn(){let[e,o]=L("managementPermission",{defaultValue:!1}),[s,i]=(0,y.useState)(!0),a=(0,y.useMemo)(()=>C(),[]),u=x(async()=>{i(!0);let f=await d().checkManagementPermission();o(f),i(!1)}),g=x(async()=>{if(!a)return!1;let f=await d().requestManagementPermission();return o(f),f});return M(()=>{a&&u()}),{hasPermission:!!e,loading:s,requestPermission:g,refresh:u,supportManagement:a}}n();t();var $=m(S());z();n();t();n();t();async function ae(e,o){await e.reduce(async(s,i,a,u)=>(await s,o(i,a,u)),Promise.resolve())}var B=ae;async function me(e,o){let s=`${e.id}-${e.version}`,i=await h.risk_extension,a=await i.get(s),u=Date.now();await i.set({riskExtensionKey:s,id:e.id,version:e.version,riskInfo:e.riskInfo,createTime:a?.createTime??o??u,updateTime:o??u})}async function X(e,o){await B(e,async s=>{await me(s,o)})}async function R(e){return await(await h.risk_extension).query(e)??[]}async function F(e){return await R({updateTime:e})}n();t();var ue="lastRiskExtensionRequestTime";function K(){let[e,o]=L(ue,{defaultValue:0});return[e??0,o]}function Jn(e){let[o,s]=K(),[i,a]=(0,$.useState)([]),u=x(async()=>{try{return await R()}catch{return[]}});N(async()=>{if(!T(o))try{let f=await F(o);a(f)}catch{}},[e]);let g=x(async f=>{try{let E=Date.now();await X(f.map(_=>({id:_.id,version:_.version,riskInfo:_.riskInfo,name:_.name})),E),s(E)}catch{}});return{lastScannedRiskList:i,setLastScannedRiskList:a,getAllRiskExtensions:u,setRiskExtensionList:g,lastRequestTime:o}}export{Se as a,G as b,C as c,Nn as d,Jn as e};
//# sourceMappingURL=chunk-7LSF3BXR.js.map
