import{a as ne}from"./chunk-OB65JCC3.js";import{a as Pe,b as Te,d as Ae,g as j}from"./chunk-2IJ4E4D3.js";import{d as $,e as ee}from"./chunk-XJ2EVWVX.js";import{a as se,c as Ce,e as de,f as ye,g as X}from"./chunk-JMM35KIH.js";import{K as fe,O as pe,P as I,Q as J}from"./chunk-NS5EW6UN.js";import{a as Z,b as N,c as be}from"./chunk-FLXVXXZH.js";import{h as K,j as ge}from"./chunk-WYX7GFOD.js";import{f as Y}from"./chunk-MJSLAJV6.js";import{a as R,c as g,d as E,k as M,l as he}from"./chunk-KC2XLVFC.js";import{M as F,N as v,ga as me,l as ue,qa as L,ra as T}from"./chunk-MJDO2VHF.js";import{a as W,b as G}from"./chunk-EPDR6VAQ.js";import{Hb as le,_a as ce,eb as ae}from"./chunk-EQ34WRCJ.js";import{k as x,u as H}from"./chunk-DSNMNSMD.js";import{b as Q}from"./chunk-FLSAETOH.js";import{Aa as ie,B as V,M as z,Q as B,g as te}from"./chunk-4C5HF6J2.js";import{f as q,o as b,q as P}from"./chunk-UWURTNRY.js";b();P();var S=q(Q());ie();b();P();var Be=q(Q());function Se(){let e=N(),n=L();return(0,Be.useCallback)(async o=>{let r=await n(Pe(o)),i={};return r&&Object.entries(r).forEach(([t,s])=>{let a=[];s.forEach(c=>{let C;"childrenCoin"in c&&c.childrenCoin?.length&&(C=c.childrenCoin?.map(l=>({...l,currencyAmount:W(l.currencyAmountUSD,e.usdToThisRate)}))),a.push({...c,childrenCoin:C,currencyAmount:W(c.currencyAmountUSD,e.usdToThisRate)})}),i[t]=a}),i},[e.usdToThisRate,n])}b();P();var we=q(Q());var re=()=>{let e=T(F),{coinTickersMap:n,loading:o}=j();return g(()=>{let r={},{symbol:i}=e;return Object.keys(n).forEach(t=>{r[t]={currencySymbol:i,usdPrice:n?.[t]?.coinToUSDRate,currencyPrice:W(n?.[t]?.coinToUSDRate,e?.usdToThisRate),priceChangePercent24h:n?.[t]?.coinPriceChangePercent24h}}),{coinPriceMap:r,loading:o}},[n,e,o])},We=e=>{let{coinPriceMap:n,loading:o}=re(),r=N(),{data:i,run:t}=M(I,{manual:!0,ready:!0,retryCount:3,staleTime:36e5,cacheTime:864e5}),s=n[e];return(0,we.useEffect)(()=>{o!==!0&&(s||!fe(e)||i?.coinId!==+e&&t(+e))},[e,o,s,t,i]),g(()=>{if(s)return s;if(i&&r&&i.coinId===+e){let{currencyAmount:a,priceChangePercent24h:c}=i;return{currencySymbol:r.symbol,usdPrice:a,currencyPrice:W(a,r.usdToThisRate),priceChangePercent24h:c}}return null},[s,e,r,i])};b();P();function oe(){return T(ue)}function Re({updateResult:e,dispatch:n,accountId:o}){e===null?n(X({walletIds:[o]})):e&&n(Ce(e))}function Fe(e,{key:n,coinId:o,addressType:r,localType:i}){return V(e,t=>{let s;if(n?s=t.key===n:s=t.coinId===o,r){let a=le[ae(i)]?.[r];s=s&&a===t?.addressType}return s})}function Me({coinId:e,key:n,addressType:o,withBalanceStatus:r,coin:i,balanceData:t,selectedWalletId:s,requestedBalance:a,balanceLoaded:c}){let C=g(()=>B(e)&&B(n)?null:r?a.balance:Fe(t?.coins||[],{key:n,coinId:e,addressType:o,localType:i?.localType}),[t?.coins,s,e,o,n,i?.localType,r,a.balance]),{coinAmountInt:l,currencyAmount:h}=C||{};return g(()=>{if(B(e)&&B(n)||!i)return null;let u={...i,coinAmountInt:l,currencyAmount:h};return r&&(u.requestBalance=a.request,u.isBalanceLoading=!c,u.isBalanceLoadError=!!a.error),B(l)?c?(u.coinAmountInt="0",u.coinAmount="0",u.currencyAmount="0",u.currencyAmountUSD="0",u):(u.coinAmount=void 0,u):(u.coinAmount=G(l,10**i.decimals),u)},[i,l,c,t,r,e])}var Ne=e=>!!e&&!Number.isNaN(e),D=(e={})=>{let n=ne(),o=Z(),r=oe(),{coinPriceMap:i}=re(),{coinTickersMap:t}=j(),s=E(n),a=E(i),c=E(t),{withPrice:C=!1,withPriceChangePercent24h:l=!1}=e||{},[h,u]=(0,S.useState)(void 0),{runAsync:A}=M(J,{manual:!0,cacheKey:h,retryCount:3,staleTime:36e5,cacheTime:864e5});return(0,S.useCallback)(async(p,y)=>{if(p===0||!r||Number.isNaN(p))return null;let f;if(typeof p<"u")f=s?.current?.[p];else if(y){let m=Object.values(n);if(y.aggregation&&y.symbol)return o[y.symbol]?{...o[y.symbol][0],childrenCoin:o[y.symbol]}:null;if(ee(y)){let U=H(m,y);U.length>0&&(f=U[0])}}if(!f&&p!==0){let m;typeof p<"u"&&!Number.isNaN(p)?m={coinId:p}:y&&(m=!z(y)&&pe(y)?y:null),m&&(u($(m)),f=await A(m))}if(!f)return null;let d;if((C||l)&&!s?.current?.[p]&&(d=await I(f.coinId)),C){let{currencySymbol:m,usdPrice:w,currencyPrice:U}=a?.current?.[p]??d??{};f={...f,currencySymbol:m,usdPrice:w,currencyPrice:U}}if(l){let m=c?.current?.[p]?.coinPriceChangePercent24h??d?.priceChangePercent24h;f={...f,priceChangePercent24h:m}}return f},[C,l,n,o,A,r])},Oe=(e,n,o)=>g(()=>{let r;if(!(o||e===0)&&(typeof e<"u"&&!Number.isNaN(e)?r={coinId:e}:r=z(n)?null:n,r))return $(r)},[e,n,o]),O=(e,n={},o)=>{let r=Z(),i=ne(),t=oe(),{withPrice:s,withPriceChangePercent24h:a}=n,c=be(o),C=[e,i,r,c,t],l=[],h=g(()=>{let m;if(e===0||!t||Number.isNaN(e))return null;if(typeof e<"u")m=i?.[e];else if(c){let w=Object.values(i);if(c.aggregation&&c.symbol)return r[c.symbol]?{...r[c.symbol][0],childrenCoin:r[c.symbol]}:null;if(ee(c)){let k=H(w,c);k.length>0&&(m=k[0])}}return m||null},C),u=!!h,A=Oe(e,c,u),{data:p,run:y}=M(J,{manual:!0,ready:!0,cacheKey:A,retryCount:3,staleTime:36e5,cacheTime:864e5});(0,S.useEffect)(()=>{if(!u&&t&&!!A){let m=Ne(e)?{coinId:e}:c;y(m)}},[u,t,A,e,c]);let f=h||p,d=We(s||a?f?.coinId:null);return l.push(f,d),g(()=>{if(!f)return null;let m=f;if(s&&d){let{currencySymbol:w,usdPrice:U,currencyPrice:k}=d;m={...m,currencySymbol:w,usdPrice:U,currencyPrice:k}}if(a){let{priceChangePercent24h:w}=d;m={...m,priceChangePercent24h:w}}return m},l)},_e=e=>{let n=D(e),o=K(),r=Ae(),i=Se();return R(async(t,s)=>{let a=await n(t);if(!a)return null;let c;s&&s!==o?c=(await i({walletIds:[s],coinId:t,chainId:a.chainId,flatten:!0}))[s]??[]:c=r;let{coinAmountInt:C="0",currencyAmount:l="0",currencyAmountUSD:h="0"}=V(c,u=>u?.coinId===t)||{};return{...a,coinAmountInt:C,currencyAmount:l,currencyAmountUSD:h,coinAmount:G(C,10**a?.decimals)}},[r,o,n])};function De(e,n,o){let r=e?.coinId,t=ge(n)?.account?.[e?.localType],{data:s,error:a,loading:c,runAsync:C}=M(ye,{manual:!0}),l=N(),h=T(me),u=K(),A=L(),p=R(async()=>{if(r&&n&&t){let f={userUniqueId:h,currentAccountId:u,coinId:r,accountIds:[n]};o&&(f.addressType=o);let d=await C(f);if(u!==n||!u||!d)return;if(de(u))A(X({walletIds:[u],pushData:{channel:"wallet-asset",data:d}}));else{let m=!1;try{m=await se({accountId:u,coinId:r,balanceData:{coinAmount:d.coinAmountOriginalDec,coinAmountInt:d.coinAmount,currencyAmountUSD:d.currencyAmount},symbol:d.symbol,addressType:d.addressType,subBalanceType:d.subBalanceType})}catch{te()}Re({updateResult:m,dispatch:A,accountId:u})}}});(0,S.useEffect)(()=>{p()},[r,n,u,h,p,t]),(0,S.useEffect)(()=>{},[r,n]);let y=g(()=>{if(s)return{coinAmount:s.coinAmountOriginalDec,coinAmountInt:s.coinAmount,currencyAmount:W(s.currencyAmount,l?.usdToThisRate??"1")}},[s,l]);return{loading:c,error:a,balance:y,request:p}}var ke=(e,n,o)=>{let{addressType:r,key:i,withBalanceStatus:t}=o||{},s=O(e,o,i?{key:i}:void 0),a=K(),c=n||a,C=Te(c),l=De(t?s:{},c,r),h=g(()=>t?typeof l.balance<"u"||!!l.error:!!C,[t,l.balance,l.error,C]);return Me({coin:s,coinId:e,key:i,addressType:r,withBalanceStatus:t,balanceLoaded:h,balanceData:C,selectedWalletId:c,requestedBalance:l})},ve=(e,n)=>{let o=O(e,n),r=O(o?.baseCoinId,n);return[o,r||o]},Ue=e=>{let n=D(e);return R(async o=>{let r=await n(o),i=await n(r?.baseCoinId);return[r,i||r]},[n])};var Ie=(e={})=>{let n=Ue(e);return R(async o=>{let[,r]=await n(o),i=r?.coinId;return ce.indexOf(i)!==-1},[n])},In=(e,n={})=>{let o=Ie(n),[r,i]=(0,S.useState)(!1);return he(async()=>{let t=await o(e);i(t)},[o]),r};b();P();b();P();ie();var Ee=(e={})=>{let{currencyId:n,formatted:o=!0,useApproximate:r}=e||{},{symbol:i,usdToThisRate:t}=T(a=>typeof n!="number"?F(a):v(a,n)),s=D({withPrice:!0});return R(async(a,c)=>{let C=await s(a),l=x.div(c,10**C?.decimals),h=x.mul(C?.usdPrice,t),u=x.mul(l,h);return o?Y(u,{useApproximate:r,currencySign:i}).value:u})},xe=(e,n,o={})=>{let{currencyId:r,useMinPrecision:i=!0}=o||{},t=O(e,{withPrice:!0}),{usdToThisRate:s}=T(a=>typeof r!="number"?F(a):v(a,r));return g(()=>{if(B(t?.usdPrice))return null;let a=i?x.div(n,10**t?.decimals):n,c=x.mul(t?.usdPrice,s);return x.mul(a,c)},[s,n,t?.usdPrice,t?.decimals,i])},Le=(e,n,o={})=>{let{currencyId:r,useApproximate:i}=o||{},t=xe(e,n,o),{symbol:s}=T(a=>typeof r!="number"?F(a):v(a,r));return g(()=>B(t)?"":Y(t,{currencySign:s,useApproximate:i}).value,[s,t,i])};export{Se as a,oe as b,D as c,O as d,_e as e,ke as f,ve as g,In as h,Ee as i,xe as j,Le as k};
//# sourceMappingURL=chunk-YLT6ZRGE.js.map
