import{a as C,b as A,g as b}from"./chunk-I6UBKGB5.js";import"./chunk-ZIR6OOXX.js";import"./chunk-KYVX6VSI.js";import"./chunk-WN3TRBGI.js";import"./chunk-3FMJDUGT.js";import{c as k}from"./chunk-2O5TMJZM.js";import{O as D,g as M}from"./chunk-UI4IZNSB.js";import"./chunk-FCGPU67F.js";import"./chunk-FXRKHQFW.js";import"./chunk-YTHL7242.js";import"./chunk-XOHZCMW2.js";import{fa as _}from"./chunk-EQ34WRCJ.js";import"./chunk-DSNMNSMD.js";import"./chunk-U2IAA473.js";import"./chunk-3O2IEAHF.js";import"./chunk-URGJ6D4O.js";import"./chunk-WC6GCIBJ.js";import"./chunk-JRC3ZUKA.js";import"./chunk-4U5VOZ7H.js";import"./chunk-FVHZWNUE.js";import"./chunk-IQUFNLVG.js";import"./chunk-XYWWXNVK.js";import"./chunk-VYWNZTTM.js";import"./chunk-5CHTOVVG.js";import"./chunk-FB3ILH2L.js";import"./chunk-FLSAETOH.js";import"./chunk-TGW66MRK.js";import{f as P}from"./chunk-LRIABBHT.js";import{Aa as G,B as R}from"./chunk-4C5HF6J2.js";import"./chunk-U6W3TK77.js";import"./chunk-GTDBOF5Q.js";import"./chunk-EI7BJC6V.js";import"./chunk-B3EOGJ3Y.js";import"./chunk-YL2RBVBZ.js";import"./chunk-4HAPQ4J7.js";import"./chunk-F5YUOHHL.js";import"./chunk-LWG66QL2.js";import"./chunk-26XSB24L.js";import"./chunk-IFKSF5TW.js";import"./chunk-PDIVTGDM.js";import"./chunk-UL6IEE2K.js";import"./chunk-4ARIYUS3.js";import{o as g,p as c,q as v}from"./chunk-UWURTNRY.js";g();v();g();v();g();v();function x(i){var r=[],a=i.split("/");return a.forEach(function(t){var n=parseInt(t,10);isNaN(n)||(t.length>1&&t[t.length-1]==="'"&&(n+=2147483648),r.push(n))}),r}function H(i,r){function a(t,n,o){return t>=n.length?o:r(n[t],t).then(function(e){return o.push(e),a(t+1,n,o)})}return Promise.resolve().then(function(){return a(0,i,[])})}function I(i,r){for(var a=0,t=0,n=r;t<64;){var o=i[n];if(a|=(o&127)<<t,n+=1,!(o&128))return a&=4294967295,{value:a,pos:n};t+=7}throw new Error("Too many bytes when decoding varint.")}var z=function(i){return i&&i.statusCode,i},N=4,L=1,m=224,W=2,X=4,K=5,V=8,Z=10,j=6,y=250,O=function(){function i(r,a){a===void 0&&(a="TRX"),this.transport=r,r.decorateAppAPIMethods(this,["getAddress","getECDHPairKey","signTransaction","signTransactionHash","signPersonalMessage","getAppConfiguration"],a)}return i.prototype.getAddress=function(r,a){var t=x(r),n=c.Buffer.alloc(L+t.length*N);return n[0]=t.length,t.forEach(function(o,e){n.writeUInt32BE(o,1+4*e)}),this.transport.send(m,W,a?1:0,0,n).then(function(o){var e=o[0],s=o[1+e];return{publicKey:o.slice(1,1+e).toString("hex"),address:o.slice(1+e+1,1+e+1+s).toString("ascii")}})},i.prototype.getNextLength=function(r){var a=I(r,0),t=I(r,a.pos);return(a.value&7)===0?t.pos:t.value+t.pos},i.prototype.signTransaction=function(r,a,t){var n=this,o=x(r),e=c.Buffer.from(a,"hex"),s=[],h=c.Buffer.alloc(L+o.length*N);for(h[0]=o.length,o.forEach(function(l,E){h.writeUInt32BE(l,1+4*E)});e.length>0;){var d=this.getNextLength(e);if(d>y)throw new Error("Too many bytes to encode.");if(h.length+d>y){s.push(h),h=c.Buffer.alloc(0);continue}h=c.Buffer.concat([h,e.slice(0,d)]),e=e.slice(d,e.length)}s.push(h);var u=[],T,w=s.length;if(t!==void 0)for(var f=0;f<t.length;f+=1){var p=c.Buffer.from(t[f],"hex");s.push(p)}if(s.length===1)u.push(16);else{u.push(0);for(var f=1;f<s.length-1;f+=1)f>=w?u.push(160|f-w):u.push(128);t!==void 0&&t.length?u.push(168|t.length-1):u.push(144)}return H(s,function(l,E){return n.transport.send(m,X,u[E],0,l).then(function(S){T=S})}).then(function(){return T.slice(0,65).toString("hex")},function(l){throw z(l)})},i.prototype.signTransactionHash=function(r,a){var t=x(r),n=c.Buffer.alloc(L+t.length*N);return n[0]=t.length,t.forEach(function(o,e){n.writeUInt32BE(o,1+4*e)}),n=c.Buffer.concat([n,c.Buffer.from(a,"hex")]),this.transport.send(m,K,0,0,n).then(function(o){return o.slice(0,65).toString("hex")})},i.prototype.getAppConfiguration=function(){return this.transport.send(m,j,0,0).then(function(r){var a=(r[0]&8)>0,t=(r[0]&1<<2)>0,n=(r[0]&1<<1)>0,o=(r[0]&1<<0)>0;r[1]===0&&r[2]===1&&r[3]<2&&(o=!0,n=!1),r[1]===0&&r[2]===1&&r[3]<5&&(t=!1);var e={version:"".concat(r[1],".").concat(r[2],".").concat(r[3]),versionN:r[1]*1e4+r[2]*100+r[3],allowData:o,allowContract:n,truncateAddress:t,signByHash:a};return e})},i.prototype.signPersonalMessage=function(r,a){for(var t=this,n=x(r),o=c.Buffer.from(a,"hex"),e=0,s=[],h=o.length.toString(16),d="00000000".substr(h.length)+h,u=c.Buffer.concat([c.Buffer.from(d,"hex"),o]),T=function(){var f=e===0?y-1-n.length*4:y,p=e+f>u.length?u.length-e:f,l=c.Buffer.alloc(e===0?1+n.length*4+p:p);e===0?(l[0]=n.length,n.forEach(function(E,S){l.writeUInt32BE(E,1+4*S)}),u.copy(l,1+4*n.length,e,e+p)):u.copy(l,0,e,e+p),s.push(l),e+=p};e<u.length;)T();var w;return H(s,function(f,p){return t.transport.send(m,V,p===0?0:128,0,f).then(function(l){w=l})}).then(function(){return w.slice(0,65).toString("hex")})},i.prototype.getECDHPairKey=function(r,a){var t=x(r),n=c.Buffer.from(a,"hex"),o=c.Buffer.alloc(1+t.length*4+n.length);return o[0]=t.length,t.forEach(function(e,s){o.writeUInt32BE(e,1+4*s)}),n.copy(o,1+4*t.length,0,n.length),this.transport.send(m,Z,0,1,o).then(function(e){return e.slice(0,65).toString("hex")})},i}(),U=O;G();var B=class extends b{async makeApp(){await this.initLedgerTransPorter(),this.app||(this.app=new U(this.ledgerTransPorter))}async getAddressPromise(r){await this.makeApp();let a=[];for(let t=r*5;t<(r+1)*5;t++){let n=`44'/195'/0'/0/${t}`,{address:o}=await this.app.getAddress(n,!1,!0);a.push({address:o,index:t,path:n})}return a}async getAddress(r=0){return await Promise.race([this.getAddressPromise(r),this.throwTimeoutError()])}async getTokens(r,a){let t=r.map(({address:n})=>n);try{let n=await D(k.getChainToken,{addressList:t,coinId:a});if(n?.code===0){let{data:o}=n;o.forEach(({address:e,coinAmount:s})=>{let h=R(r,{address:e});h.coinAmount=s})}}catch{}return r}async signTransaction(r,a){try{A.openModal(C.confirm);let t=r.hdPathMap[_];await this.checkLedgerConnection();let{getHardWareRawTransaction:n,getHardWareSignedTransaction:o}=await M(),{raw:e}=await n(P.TRX,{data:a}),s=await this.app.signTransaction(t,e);if(s==="01000103019000")throw new Error(C.wrongApp);let h=await o(P.TRX,{raw:e,sig:s});return A.closeModal(),h}catch(t){return this.handleErrors(t,_)}}},ut=new B;export{ut as default};
//# sourceMappingURL=trxAdapter-W7XGXROW.js.map
