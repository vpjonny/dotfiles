import{v as Ce}from"./chunk-NVBOE3PE.js";import{a as L,b as Ie}from"./chunk-NQGIYDUG.js";import{a as be}from"./chunk-6GJ4TEPK.js";import{c as De,h as Me}from"./chunk-2IJ4E4D3.js";import{a as he,k as Te,m as Re}from"./chunk-XJ2EVWVX.js";import{a as oe,c as se}from"./chunk-5E7YC7OF.js";import{b as Se}from"./chunk-PNOOVDMP.js";import{a as de}from"./chunk-5C7AUJM4.js";import{f as pe}from"./chunk-6C7RJCTT.js";import{b as E}from"./chunk-MT4YWUUK.js";import{a as Ae}from"./chunk-IPVHRCDK.js";import{C as H,a as k,c as ue,e as me,s as ge}from"./chunk-KC2XLVFC.js";import{B as j,M as le,a as ne,b as re,d as we,f as ce,qa as fe}from"./chunk-MJDO2VHF.js";import{a as te,c as z}from"./chunk-EPDR6VAQ.js";import{c as ae}from"./chunk-2O5TMJZM.js";import{O as ie}from"./chunk-UI4IZNSB.js";import{a as xe}from"./chunk-DOSBJ3L3.js";import{b as J}from"./chunk-FLSAETOH.js";import{Aa as ee,N as Y,g as Q,p as y,va as Z}from"./chunk-4C5HF6J2.js";import{f as P,o as f,q as h}from"./chunk-UWURTNRY.js";f();h();f();h();var ve="content_script_message",ze={goToDexSwapMemeMode:"goToDexSwapMemeMode",notifyRedirect:"notifyRedirect",storeIframeAuthToken:"storeIframeAuthToken",getWebWidgetStatus:"getWebWidgetStatus",minimizeIframe:"minimizeIframe",resizeIframe:"resizeIframe",caScrapingResult:"caScrapingResult"},G="redirect_param_",_e="redirect_pathname",ke="redirect_search_params";var $e=n=>Object.entries(n).map(([t,e])=>{let s=Array.isArray(e)?encodeURIComponent(e.join(",")):encodeURIComponent(e);return`${t}=${s}`}).join("&"),qe=n=>{let t=new URLSearchParams(n),e=t.get(_e),s=t.get(ke),a={};return s&&s.split("&").filter(l=>l.includes(G)).forEach(l=>{let[u,m]=l.split("="),g=u.replace(G,""),d=decodeURIComponent(m);d.includes(",")?a[g]=d.split(",").map(p=>p.trim()):a[g]=d}),{redirectPathname:e,redirectSearchParams:a}};f();h();var Ue=P(J()),x=P(xe());var Be=()=>{let n=(0,x.useHistory)(),t=(0,x.useLocation)();return(0,Ue.useCallback)((s,a={})=>{let{overrideCurrentPath:l=!1,clearSearchParams:u=!1,preserveState:m=!0,replaceInsteadOfPush:g=!1,removeExistingSearchKeys:d=[],newSearchParams:p=""}=a,{search:C}=t,A=new URLSearchParams(C);d&&d.forEach(I=>{A.delete(I)}),n.replace({pathname:l||t.pathname,search:u?"":A.toString(),state:m?t.state:null}),n[g?"replace":"push"]({pathname:s,search:p||""})},[n,t])},Je=Be;f();h();ee();var M=P(we());var We=(0,M.createSelectorCreator)(M.defaultMemoize,Y),Fe=We(n=>{let{createdMap:t={},needSyncMap:e={}}=n.metamask;return{createdMap:t,needSyncMap:e}},j,({createdMap:n,needSyncMap:t},e)=>{let s=Boolean(n[e]),a=Boolean(t[e]);return!(!s||a)}),B="--",U=(n,t)=>n??t,Ne=(n,t,e)=>{let{tokenTotalAssetsUSD:s,defiTotalAssetsUSD:a,nftTotalAssetsUSD:l,platformTotalAssetsUSD:u}=n,m=l??"0",g=a??"0",d=s??"0",p=u??"0",C=s,A=t?z(C,m):C,R=z(A,a);return{walletAsset:te(R,e?.usdToThisRate??"1"),walletAssetUSD:R,platformAssetUSD:p,nftBalanceUSD:m,defiBalanceUSD:g,tokenBalanceUSD:d}},Oe=(0,M.createSelector)(Fe,Re,j,n=>pe(n)?.currentNetworkUniqueId||"",le,Ce,Te,ne,re,ce,oe,(n,t,e,s,a,l,u,m,g,d,p)=>{let C=d?.length&&t?.[e]&&!t?.[e]?.loading,{open:A,amount:R}=p,I=C?se({isReady:!!t[e]?.coins&&n,defaultBaseCoinsCoinIds:u.size>0?Array.from(u):[],addedCoins:U(m[e],[]),reducedCoins:U(g[e],[]),balanceCoins:U(t[e]?.coins,[]),defi:U(t[e]?.defi,null),nft:U(t[e]?.nft,null),networks:d.map(o=>({chainId:o})),walletId:e,coinsMap:null,hiddenSmallAssets:A,smallAssetsAmount:R,customFilter:({chainId:o})=>s===""||o===Number(s)}):null;if(!I)return{walletAsset:B,walletAssetUSD:B,platformAssetUSD:B,nftBalanceUSD:B};let{walletAsset:W,walletAssetUSD:F,platformAssetUSD:N,nftBalanceUSD:O,defiBalanceUSD:i,tokenBalanceUSD:S}=Ne(I,l,a);return{walletAsset:W,walletAssetUSD:F,platformAssetUSD:N,nftBalanceUSD:O,defiBalanceUSD:i,tokenBalanceUSD:S,smallTotalAssetsUSD:I.smallTotalAssetsUSD,walletId:e}}),mt=Oe;f();h();var _=P(J());ee();var $=300,wt=()=>{let n=Ae(),t=fe(),e=De(n),s=be(),a=(0,_.useRef)({}),l=(0,_.useRef)({}),u=(0,_.useRef)({}),{data:m,set:g}=Se(de.coinTickers),d=Me();(0,_.useEffect)(()=>{t(he(d))},[t,d]);let p=i=>{g({...m,...i})},C=k(async i=>{let S=y(i,$),o=[];try{(await Promise.all(S.map(c=>{let q=c.filter(b=>u.current[b]),T={coinIds:c,aggregationCoinIdList:q},D={headers:{currency:"usd"}};return ie(ae.postMarketUrl,T,D)})))?.forEach(c=>{Array.isArray(c?.data)&&(o=o.concat(c.data))})}catch{Q()}o.forEach(r=>{r?.coinId&&(l.current[r.coinId]={coinToUSDRate:r?.currencyAmount,coinPriceChangePercent24h:r?.priceChangePercent24h,priceCoinId:r?.priceCoinId,anchorStatus:r?.anchorStatus??null})}),p(l.current)}),{needFetchCoinIds:A,needFetchData:R}=ue(()=>{if(e.length||s.length){let i=e.concat(s).filter(r=>Boolean(r?.coinId));return Z(i,"coinId").reduce((r,c)=>(r.needFetchCoinIds.push(c.coinId),r.needFetchData.push({coinId:c.coinId,baseCoinId:c?.baseCoinId,chainIndex:c?.chainId,tokenAddress:c?.address,aggregation:c?.aggregation}),r),{needFetchCoinIds:[],needFetchData:[]})}return{needFetchCoinIds:[],needFetchData:[]}},[e,s]),I=k(i=>{if(!i?.length)return;let{coinIdToInstIdMap:S,coinIdAggregationMap:o}=i.reduce((T,D)=>{let{coinIdToInstIdMap:b,coinIdAggregationMap:K}=T,{coinId:V,baseCoinId:Pe,chainIndex:X,tokenAddress:ye,aggregation:Ee}=D,v="";return Pe===0?v=`${X}`:v=`${X}-${ye}`,b[V]=v,K[V]=Ee,{coinIdToInstIdMap:b,coinIdAggregationMap:K}},{coinIdToInstIdMap:{},coinIdAggregationMap:{}});u.current=o;let r=[],c=Object.entries(S).reduce((T,[D,b])=>(a.current[D]||(a.current[D]=b,r.push(D),T.push({channel:E,instId:b})),T),[]);y(c,$).forEach(T=>{L.sendChannel({op:"subscribe",args:T})}),r.length&&C(r)}),{run:W}=H(I),{run:F}=H(()=>{p(l.current)}),N=k(()=>{C(Object.keys(a.current))}),O=k(i=>{if(!i||!Array.isArray(i?.data))return;let{data:S}=i,o=S[0];if(o?.coinId){let r=o.coinId,c=l.current[r];l.current[r]={...c,coinToUSDRate:o.price,coinPriceChangePercent24h:o.priceChangePercent24h},F()}});Ie(E,{onError:N,onSuccess:O,pollingInterval:30*1e3}),ge(()=>{W(R)},[A]),me(()=>{let i=Object.values(a.current).map(o=>({channel:E,instId:o}));y(i,$).forEach(o=>{L.sendChannel({op:"unsubscribe",args:o})}),a.current={}})};export{ve as a,ze as b,$e as c,qe as d,Je as e,wt as f,Fe as g,B as h,mt as i};
//# sourceMappingURL=chunk-K5KNPOMB.js.map
