import{a as D}from"./chunk-JMNZU6WB.js";import{a as b,b as M}from"./chunk-JQHLKZPQ.js";import{b as x,c as W}from"./chunk-FLXVXXZH.js";import{b as F}from"./chunk-XBUPORYF.js";import{f as Te}from"./chunk-6C7RJCTT.js";import{c as q,e as L,j as _,l as $,p as re}from"./chunk-WYX7GFOD.js";import{a as S}from"./chunk-KC2XLVFC.js";import{M as ge,qa as I,ra as T}from"./chunk-MJDO2VHF.js";import{a as we}from"./chunk-QF42JCDG.js";import{m as Ae,o as Y}from"./chunk-KGMP5AO5.js";import{c as Q}from"./chunk-EAE2NUFS.js";import{a as v,b as pe,c as g,t as de}from"./chunk-EPDR6VAQ.js";import{n as B}from"./chunk-UI4IZNSB.js";import{$ as he,D as fe,Lb as G,Mb as Ce,Z as E,eb as ke,gb as J}from"./chunk-EQ34WRCJ.js";import{p as me}from"./chunk-DSNMNSMD.js";import{a as Ue}from"./chunk-DOSBJ3L3.js";import{a as Fe}from"./chunk-DNGRHKLV.js";import{I as ye}from"./chunk-URGJ6D4O.js";import{b as y}from"./chunk-FLSAETOH.js";import{Aa as ne,F as V,N as te,t as le}from"./chunk-4C5HF6J2.js";import{f as C,o as l,q as m}from"./chunk-UWURTNRY.js";l();m();var H=C(y());var z=(e=E,r,t)=>{let n=_(r);return(0,H.useMemo)(()=>q(n,e,t),[n,e,t])},oe=(e,r=E,t)=>{let n=$(e);return(0,H.useMemo)(()=>n.map(o=>q(o,r,t)),[n,r,t])},Oe=(e=E,r,t)=>{let n=_(r),o=z(e,r,t);return{...n,address:o}},Ke=(e,r,t)=>{let n=$(e);return(0,H.useMemo)(()=>n.map(o=>({...o,address:q(o,r,t)})),[n,r,t])},Ve=(e,r,t=he)=>{let n=ke(t);return(_(r)?.addressType?.[n]||[]).find(i=>i.address===e)?.addressType};l();m();var Ee=C(y()),Se=C(Ue());l();m();l();m();var Ye=Y({name:"assetsSlice",initialState:{assets:[]},reducers:{setAssets:(e,r)=>{e.assets=r.payload}}}),{actions:Je,reducer:Ge}=Ye,Qe=[],_e=Ae(e=>e.assetsSlice.assets??Qe,e=>e.reduce((r,t)=>r.set(t.walletId,t),new Map)),yt=()=>async e=>{(await fe.assets).liveQuery().subscribe((t,n)=>{n||e(Je.setAssets(t))})},_t=Ge;function R(){return T(_e)}l();m();var P=({walletAccounts:e,rpcData:r,assetsMap:t,showNftAmount:n,selectedCurrency:o})=>{let s=e.map(c=>{if(!c)return{walletAsset:"0",platformAsset:"0"};let{walletId:a}=c;if(!!r){let{chainTokensAccountMap:k}=r,w=c?.account?.[E];if(!w||[G.HD_KEYRING,G.SIMPLE_KEYRING,G.MPC_KEYRING].indexOf(c?.initialType)<0)return{unsupported:!0,walletAsset:"0",platformAsset:"0",...c};let{balance:j="0"}=k[w]?.filter(({address:ee})=>!ee)[0]||{};return{walletAsset:j,platformAsset:"0",...c}}let d=t.get(a),f=(d?[d.tokenTotalAssetsUSD,d.defiTotalAssetsUSD,n?d.nftTotalAssetsUSD:"0"]:[]).reduce((k,w)=>g(k,w),"0");return{walletAsset:d?v(f,o.usdToThisRate):"--",platformAsset:d?d.platformTotalAssetsUSD:"--",...c}}),{walletAsset:i,platformAsset:u}=s.reduce((c,a)=>({walletAsset:g(c.walletAsset,a.walletAsset==="--"?"0":a.walletAsset),platformAsset:g(c.platformAsset,a.platformAsset==="--"?"0":a.platformAsset)}),{walletAsset:"0",platformAsset:"0"});return{walletAccountsWidthBalance:s,walletAsset:i,platformAsset:u}};var qe=e=>{let r=(0,Se.useHistory)(),t=re(e),[n]=M(b.showNftAmount),o=x(),s=W(o),i=R();return t||(ye.error(me("wallet_extension_top_error_parameters")),r.push(we)),(0,Ee.useMemo)(()=>{let{walletIdentities:u}=t,{walletAccountsWidthBalance:c,walletAsset:a,platformAsset:p}=P({walletAccounts:u,showNftAmount:n,rpcData:null,selectedCurrency:s,assetsMap:i});return{...t,walletAsset:a,platformAsset:p,walletIdentities:c}},[t,n,s,i])},$e=qe;l();m();l();m();var xe=C(y());var He=e=>{let[r]=M(b.showNftAmount),t=_(e),n=R(),o=x(),s=W(o);return(0,xe.useMemo)(()=>{let{walletAccountsWidthBalance:i}=P({walletAccounts:[t],showNftAmount:r,rpcData:null,selectedCurrency:s,assetsMap:n});return i[0]},[t,r,s,n])},ze=He;l();m();var ue=C(y());ne();l();m();var K=C(y());var ie=C(Fe());ne();l();m();var be=C(y());l();m();var Z={};async function Ze(e){try{return await Promise.all([e.getBlockNumber(),e.getNetwork()]),!0}catch{return!1}}var Xe=async e=>{let{ethers:r}=await B(),t=new r.JsonRpcProvider(e),n=s=>{s?.event==="initial-network-discovery"&&(t.destroy(),delete Z[e],t.removeAllListeners("error"))};return t.on("error",n),await Ze(t)||(t.destroy(),t=new r.JsonRpcProvider(e,null,{batchMaxCount:1}),t.on("error",n)),Z[e]=t,t},We=async e=>Z[e]?Z[e]:await Xe(e);var U=(e="",r=null)=>{let t=D(),n=r||t;return(0,be.useCallback)(async()=>{let o=e||n?.rpcUrl;return o?await We(o):{}},[e,n?.rpcUrl])};l();m();var Me=C(y());function X(e,r,t){let n=Me.default.useRef({});return(!("value"in n.current)||t(n.current.condition,r))&&(n.current.value=e(),n.current.condition=r),n.current.value}l();m();var je=6,et=(e,r=je)=>{if(!Number(e))return"0";let t=e?.toString();return(e.split(".")[1]||"")?.length>r?de(t,r&&Number(r)):t},Re=(e,r)=>{let{rpcUrl:t,chainId:n,account:o,existAccounts:s,isDeleted:i}=r;return Array.isArray(e)?e.filter(u=>{let c=u,a=!0;return n&&(a=a&&c.chainId===n),o&&(a=a&&c.account===o),Array.isArray(s)&&!!s?.length&&(a=a&&s?.includes(c.account)),i!==void 0&&(a=a&&(c.isDeleted||!1)===i),c.address||(a=a&&c.rpcUrl===t),a}):[]},Pe=(e,r={})=>{let{symbol:t,usdToThisRate:n,chainTokenPrice:o,chainTokenBalance:s}=r;return Array.isArray(e)?e.map(i=>{let u=i,c,a,{chainId:p,decimals:d}=u,h=t;u.address?(c=o?.[p]?.[u.address]||0,a=s?.[u.account]?.[p]?.[u.address]||0):(c=o?.[p]?.price||0,a=s?.[u.account]?.[p]?.balance||0);let f=a&&pe(a,10**d),k=et(v(f,v(c,n)));return{price:c,balance:f,balanceInt:a,...u,moneySymbol:h,marketValue:k}}):[]};l();m();l();m();ne();l();m();var Ne="rpc",O={MANAGE_NET:"manageNet",EVM:"evm"},ve={[O.MANAGE_NET]:"ManageNet",[O.EVM]:"Evm"};var Be=le((e,r)=>{let t=ve[e];if(!t)throw new Error("rpc type must in maps");if(!(typeof r=="string"&&/^[0-9a-zA-Z]+$/g.test(r)))throw new Error("scope name is invalid");return`${Ne}${t}${r}`}),Mn=Be(O.MANAGE_NET),Ie=Be(O.EVM),Rn={"MNEMONIC WALLET":"seed_phrase","PRIVATE KEY WALLET":"private_key","MPC WALLET":"mpc","HARDWARE WALLET":"hardware"};var tt="Token",nt=Ie(tt),rt={chainTokens:[],chainTokenPrice:{},chainTokenBalance:{}},se=e=>e.metamask.rpcEvmChainTokens||[],De=e=>e.metamask.rpcEvmChainTokenBalance||{},ot=Y({name:nt,initialState:rt,reducers:{}}),{reducer:st}=ot,Le=e=>async()=>{await Q().addChainToken(e)},ae=e=>async()=>{await Q().updateChainToken(e)},ce=e=>async()=>{await Q().updateChainTokenBalance(e)},Ln=st;var N=(e,r,t=!0,n=null)=>{let o=D(),s=n||o,{chainId:i,rpcUrl:u}=s,c=T(se),a=T(De),{symbol:p,usdToThisRate:d}=T(ge),h=z(),f=oe(void 0,J),k=(0,K.useMemo)(()=>Re(c,{chainId:i,rpcUrl:u,existAccounts:f,account:t?h:void 0,isDeleted:r?void 0:!1}),[i,h,f,c]);return(0,K.useMemo)(()=>e?k:Pe(k,{symbol:p,usdToThisRate:d,chainTokenBalance:a}),[p,k,d,a,e])},cr=(e,r,t)=>{let n=N(r,void 0,void 0,t);return(0,K.useMemo)(()=>n.find(o=>o.address===(e||void 0))||{},[e,n])};var at=(e,r)=>{let t=U(e,r);return S(async n=>{let o=await t(),{ethers:s}=await B(),i=new s.Contract(n,ie.default,o),u=await i.symbol(),c=(await i.decimals()).toString();return{name:await i.name(),symbol:u,decimals:c}},[t])},ct=e=>{let r=U(void 0,e),t=F();return S(async(n,o,s)=>{let i,u=s||await r(),c=o||t;if(!n)i=await u.getBalance(c,"latest"),i=i.toString();else{let{ethers:a}=await B();i=await new a.Contract(n,ie.default,u).balanceOf(c),i=i.toString()}return i},[r,t])};var ir=()=>{let e=U(),r=I();return S(async({chainId:t,injectProvider:n,wallets:o=[]})=>{let s=n||await e(),i=o.map(async u=>{let c=await s.getBalance(u,"latest");c=c.toString(),r(ce({chainId:t,balance:c,account:u}))});await Promise.all(i)})},it=()=>{let e=I(),r=F(),t=ct();return S(async({chainId:n,address:o,injectAccount:s,injectProvider:i})=>{let u=await t(o,s,i);return e(ce({chainId:n,balance:u,address:o,account:s||r})),!0},[t,r])},ur=e=>{let r=F(),t=D(),n=e||t,{chainId:o}=n,s=N(!0,!1,!1,e);return X(()=>({chainId:o,chainTokens:s}),{chainId:o,account:r,needPollChainTokens:s},(i,u)=>!te(i,u))},ut=18,lt=()=>{let e=I(),r=T(se),t=F();return S((n,o,s)=>{if(!n&&!t&&!s?.account)return!1;let{rpcUrl:i}=s,u=r.find(a=>{let p=a.chainId===n&&a.address===o&&a.account===(s?.account||t);return o||(p=p&&a.rpcUrl===i),p});if(u){if(u.isDeleted===!0){let a={...u,...s,chainId:n,address:o,isDeleted:!1};return e(ae(a)),!0}return!1}let c={chainId:n,address:o,isDeleted:!1,account:t,decimals:ut};return s&&typeof s=="object"&&Object.assign(c,s),e(Le(c)),!0},[r,t])},lr=e=>{let r=U(e),t=lt(),n=at(e),o=it();return async(s,i)=>{let u=await n(i);if(t(s,i,u)){let a=await r();await o(s,i,a)}}},mt=(e={})=>{let r=L(e);return X(()=>r.reduce((t,n)=>{if(n.keyringIdentityType===Ce.MNEMONIC)t.push(n);else{let o=n.walletIdentities.filter(s=>Boolean(s.account[J]));o.length&&t.push({...n,walletIdentities:o})}return t},[]),r,(t,n)=>!te(t,n))},mr=(e={})=>{let r=mt(e),t=N(!1,!1,!1);return(0,K.useMemo)(()=>{let n=V(t||[],"account");return r?.map(o=>{let s="",i=o.walletIdentities?.map(c=>{let a=c?.account?.[J],{balance:p,symbol:d}=n[a]?.filter(({address:h})=>!h)[0]||{};return s=d,{...c,balance:p,symbol:d}}),u=i.reduce((c,a)=>g(c,a.balance),0);return{...o,marketValue:u,marketValueSymbol:s,walletIdentities:i}})||[]},[t,r])},pr=()=>{let e=I(),r=N(!0,!1,!1);return t=>{r?.filter(({chainId:n,rpcUrl:o,address:s})=>!s&&n===t.chainId&&o===t.rpcUrl)?.forEach(({chainId:n,account:o})=>{e(ae({chainId:n,account:o,...t}))})}};var pt=(e,r=!0)=>{let t=L(e),[n]=M(b.showNftAmount),o=x(),s=W(o),{isRpcMode:i}=T(Te),u=N(!1,!1,!1),c=V(u||[],"account"),a=R(),p=(0,ue.useMemo)(()=>t.map(h=>{let{walletIdentities:f}=h,k=i?{chainTokensAccountMap:c}:null,{walletAccountsWidthBalance:w,walletAsset:j,platformAsset:ee}=P({walletAccounts:f,showNftAmount:n,rpcData:r?k:null,selectedCurrency:s,assetsMap:a});return{...h,walletAsset:j,platformAsset:ee,walletIdentities:w}}),[t,n,c,i,s,a]);return[(0,ue.useMemo)(()=>p?.reduce((h,f)=>({walletAsset:g(h.walletAsset,f.walletAsset==="--"?"0":f.walletAsset),platformAsset:g(h.platformAsset,f.platformAsset==="--"?"0":f.platformAsset),rpcModeCoinSymbol:h.rpcModeCoinSymbol||f?.rpcModeCoinSymbol}),{walletAsset:"0",platformAsset:"0",rpcModeCoinSymbol:""}),[p]),p]},dt=pt;export{yt as a,_t as b,Xe as c,We as d,Mn as e,Ie as f,Rn as g,nt as h,se as i,ae as j,ce as k,Ln as l,z as m,Oe as n,Ke as o,Ve as p,ze as q,$e as r,U as s,X as t,N as u,cr as v,at as w,ct as x,ir as y,it as z,ur as A,lt as B,lr as C,mt as D,mr as E,pr as F,dt as G};
//# sourceMappingURL=chunk-CKHT4PIF.js.map
