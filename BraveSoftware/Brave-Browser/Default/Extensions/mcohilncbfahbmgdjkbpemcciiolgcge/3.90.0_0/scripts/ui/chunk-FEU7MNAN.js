import{a as O}from"./chunk-RER2JAFZ.js";import{a as v}from"./chunk-NNPT43SF.js";import{h as M}from"./chunk-CTJAEFLV.js";import{a as y}from"./chunk-AP4E6GDF.js";import{Ra as R,nb as w,yc as H}from"./chunk-RPH2MNBW.js";import{a as W}from"./chunk-I2AEM4CA.js";import{u as N,w as b}from"./chunk-TR37MFB4.js";import{f as z,h as o,o as T,p as u,q as m}from"./chunk-UWURTNRY.js";T();m();var C=z(W());T();m();var E=z(W());T();m();T();m();var P=class{constructor({orderData:a,extParams:t},e){o(this,"walletNoNeedExtParams",!1);o(this,"differentiatedEnvironment",a=>w()&&a.length>1&&!this.walletNoNeedExtParams&&!a[0].params?[{...a[0],extParams:a[1]}]:a);this.orderData=a,this.calldataType=a.calldataType,this.extParams=t||{},this.swapStore=e}get isTransferType(){return this.calldataType===R.TRANSFER}};var k=["nonce","gas","gasPrice","maxFeePerGas","maxPriorityFeePerGas","priorityFee","value"],I=n=>k.reduce((a,t)=>((n[t]||n[t]===0)&&(a[t]=v(n[t],"0x")),a),n),h=class extends P{constructor(){super(...arguments);o(this,"valueToHex",(t,e="")=>`${e}${y.BigNumber(t).toString(16)}`);o(this,"formatContractPayload",({needGasPrice:t,isSilentSign:e=!1}={})=>{let{orderData:r}=this,{priorityFee:c,maxFeePerGas:i,maxPriorityFeePerGas:l,gasPrice:s,gas:x,hasReferralCommission:g,...p}=r?.callData||{},d=p;return t&&(d={...r?.callData,gasLimit:x}),r?.approveTxInfo&&(d=I({...r?.callData})),e&&(d=I(d)),d});o(this,"formatTransferPayload",()=>{let{orderData:t}=this;return t.callData});o(this,"getSendTransactionParams",async({needGasPrice:t=!1,isSilentSign:e=!1}={})=>{let{payload:r}=await this.preExecution({needGasPrice:t,isSilentSign:e});return O&&r.value&&(r.value=v(r.value)),this.differentiatedEnvironment([r])});o(this,"preExecution",async({needGasPrice:t,isSilentSign:e=!1}={})=>{let{orderData:r}=this,{mevConfig:c}=r,i;this.isTransferType?i=this.formatTransferPayload():i=this.formatContractPayload({needGasPrice:t,isSilentSign:e});let{extendEvmParams:l,extendsGas:s}=this.swapStore;return i.extParams=this.extParams,s&&(i=s(i)),i=l(i,c?.enableMev??!1),{payload:i}})}};o(h,"chainId",H.ETHEREUM_MAINNET);var et=h;var V=n=>{if(!n)return"0";let{BigNumber:a}=y,t=new a("365.25").div(2).multipliedBy(2);return new a("19.055441478439427").multipliedBy(n).multipliedBy(t).div(10**9).toFixed(9)},F=async(n,a={})=>{let{data:t,accountLength:e,bizType:r,bizId:c,from:i,to:l}=n,s=V(e);if(a.encoding==="base64")return{payload:{bizType:r,bizId:c,transaction:{transaction:t,encoding:"base64"}},inputData:t,from:i,to:l,rent:s};let{transaction:x,version:g}=await L(t);return{payload:{bizType:r,bizId:c,transaction:x,version:g},inputData:t,from:i,to:l,rent:s}},Tt=async(n,a={})=>{try{let t=JSON.parse(n);return t.array?await Promise.all(t.array.map(e=>F(e,a))):await Promise.all([t].map(e=>F(e,a)))}catch(t){return Promise.reject(t)}};function Y(n){return"txHash"in n&&"signedTx"in n&&typeof n.txHash=="string"&&typeof n.signedTx=="string"}async function mt(n,a){let{isMemeMode:t=!1,isWidgetEnv:e=!1,isWallet:r=!1,isWalletInstantTrade:c=!1}=a||{},i=n.map(s=>{if(Y(s))return{txHash:s.txHash,signature:s.signedTx};if(t&&r||e||c){let S=s;return{txHash:S.signature,signature:S.serializedTransaction}}let g=s,p=g.signature||g.signatures?.[0],d=E.default.encode(p),A=E.default.encode(g.serialize());return{txHash:d,signature:A}}),l=n[0]?.encoding??"base58";return{signedInfoList:i,encoding:l}}var ft=n=>{let a="0";return n.forEach(t=>{a=y.add(a,t.rent,{returnString:!0})}),a},xt=({approveTxInfo:n,params:a})=>{let{isCrossChain:t,teeSilentSignEnabled:e,isOnlySign:r,...c}=a,{id:i,data:l,from:s,to:x,unsignedTx:g,gas:p,gasLimit:d,gasPrice:A,maxFeePerGas:S,maxPriorityFeePerGas:G,type:U,nonce:B}=n||{},f={data:l,from:s,to:x};(e||r)&&(f={...f,gas:p,gasLimit:d||p,gasPrice:A,maxFeePerGas:S,maxPriorityFeePerGas:G,type:U,nonce:B},f=I(f));let D={txSource:3};return M(a.chainId)&&(f=JSON.parse(g),_.set(D,"orderId",i)),t&&_.set(f,"extParams",D),{transactionPayload:f,id:i,defiPlatformId:c.defiPlatformId}};var L=async n=>{let a,t;try{a=b.deserialize(C.default.decode(n)),t="versionedTransaction"}catch(e){console.log(e),a=N.from(C.default.decode(n)),t="transaction"}return{transaction:a,version:t}},ht=async n=>{let a=u.Buffer.from(n,"base64");return b.deserialize(a)},It=async n=>{let a=n.serialize();return u.Buffer.from(a).toString("base64")};export{P as a,k as b,I as c,et as d,ht as e,It as f,F as g,Tt as h,mt as i,ft as j,xt as k};
//# sourceMappingURL=chunk-FEU7MNAN.js.map
