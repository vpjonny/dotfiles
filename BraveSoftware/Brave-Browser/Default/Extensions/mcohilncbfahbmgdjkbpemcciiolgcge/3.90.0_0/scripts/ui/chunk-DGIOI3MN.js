import{a as U}from"./chunk-T475WHHH.js";import{c as D}from"./chunk-NCGPJXQK.js";import{h as w}from"./chunk-JMM35KIH.js";import{a as T}from"./chunk-VUBIYSGX.js";import{e as P,h as W,i as K}from"./chunk-WYX7GFOD.js";import{a as L}from"./chunk-N2N44VBE.js";import{b as B}from"./chunk-KC2XLVFC.js";import{ka as x,qa as b,ra as g}from"./chunk-MJDO2VHF.js";import{a as Q}from"./chunk-L5AZICLM.js";import{c as i}from"./chunk-EAE2NUFS.js";import{c as I}from"./chunk-2O5TMJZM.js";import{O as V}from"./chunk-UI4IZNSB.js";import{Mb as k,a as N}from"./chunk-EQ34WRCJ.js";import{b as S}from"./chunk-FLSAETOH.js";import{f,o as c,q as l}from"./chunk-UWURTNRY.js";c();l();var G=f(S());var X=()=>{let e=W(),{runAsync:r}=D(I.isSAVerify,{params:{accountId:e},method:"GET",catchMode:"noToast"},{ready:Boolean(e),manual:!0});return{verifySa:(0,G.useCallback)(async()=>{try{let o=await r({accountId:e}),t=await i().getServerWalletTypeByWalletId(e);return o?.data?.needVerify&&await i().verifyWalletPublicKeyStatus({walletId:e,walletType:t,fromVerify:!0}),!0}catch{return!1}},[e])}},H=X;c();l();var q=(t=>(t.CREATE_FAIL_FROM_NETWORK_ERROR="CREATE_FAIL_FROM_NETWORK_ERROR",t.CREATE_FAIL_FROM_SERVER_ERROR="CREATE_FAIL_FROM_SERVER_ERROR",t.CREATE_FAIL_FROM_SERVER_LIMIT="CREATE_FAIL_FROM_SERVER_LIMIT",t.PENDING="PENDING",t))(q||{}),m={...q,...T};c();l();var a=f(S());c();l();function v(e){let r=e?.type||e?.message;return r==="ERR_SERVER_TINE_LIMIT"?{type:"ERR_SERVER_TINE_LIMIT"}:r==="ERR_SERVER_LIMIT"?{type:"ERR_SERVER_LIMIT"}:r==="ERR_NETWORK"?{type:"ERR_NETWORK"}:r==="ERR_SERVER_COMMON"?{type:"ERR_SERVER_COMMON",msg:e?.message}:{type:"ERR_DEFAULT"}}c();l();var $=f(S());var j=()=>(0,$.useCallback)(e=>{try{let r=e===m.CREATE_FAIL_FROM_SERVER_ERROR?"Server":"Local";N.captureException(`CreateWalletToServerInHomePage-${r}`)}catch(r){console.log(r)}},[]);c();l();var C=f(S());var z=f(Q());var J=()=>{let e=P({keyringType:k.MPC}),r=g(x),n=(0,C.useCallback)(async()=>{Promise.all(e.map(o=>{let t=o?.mpcId||"",s=o?.walletIdentities?.length-1;return V(I.syncMpcwallet,{mpcId:t,deriveIndex:s})})).then(o=>{i().setIsNeedSyncMpcIndex(!1)}).catch(o=>{z.default.debug("syncMpcWallet error:")})},[e?.length]);(0,C.useEffect)(()=>{e?.length&&r&&n()},[e?.length,n,r])};var Y=e=>{let{needSyncMap:r={},createdMap:n={}}=g(({metamask:_})=>_),o=Boolean(n[e]),t=Boolean(r[e]),s=U(),u=!o||t||s,[R,E]=(0,a.useState)(u?m.PENDING:""),[p,y]=(0,a.useState)("");return B(()=>{E(m.PENDING)},[e]),(0,a.useEffect)(()=>{!s&&o&&!t&&E("")},[s,o,t]),{errorMsg:p,errorType:R,isWalletCreated:o,isWalletNeedSync:t,setErrorMsg:y,setErrorType:E}},Z=e=>{let{walletId:r,setErrorMsg:n,setErrorType:o}=e,t=j();return(0,a.useCallback)(async()=>{let u=await i().getServerWalletTypeByWalletId(r);o(m.PENDING);try{await i().createWalletToServer({walletId:r,walletType:u,noticeBackend:!0}),L()}catch(R){switch(R?.message){case"ERR_NETWORK":o(m.CREATE_FAIL_FROM_NETWORK_ERROR),t();break;case"ERR_SERVER_LIMIT":o(m.CREATE_FAIL_FROM_SERVER_LIMIT),t(m.CREATE_FAIL_FROM_SERVER_LIMIT);break;default:o(m.CREATE_FAIL_FROM_SERVER_ERROR),n(R?.message);break}}},[t,r])},ee=e=>(0,a.useCallback)(async()=>{try{await i().syncWalletToServer(e)}catch{}},[e]),re=({walletId:e,setErrorType:r,isWalletCreated:n,isWalletNeedSync:o,setErrorMsg:t})=>{let s=b(),u=(0,a.useCallback)(async()=>{try{await s(w(void 0,e))}catch(R){let{type:E,msg:p}=v(R);r(E),p!==void 0&&t(p)}},[t,r,s,e]);(0,a.useEffect)(()=>{(async()=>n&&!o&&(await u(),await i().getAccountKeys()))()},[u,n,o,e])};function qe(...e){let[r]=e,n=(0,a.useRef)(Boolean(r));J();let o=W(),t=K(),s=n.current?r?.accountId:o,u=n.current?r?.teeId:t,{errorMsg:R,errorType:E,isWalletCreated:p,isWalletNeedSync:y,setErrorMsg:_,setErrorType:A}=Y(s),M=Z({walletId:s,setErrorMsg:_,setErrorType:A}),F=ee(s);re({teeId:u,walletId:s,setErrorType:A,setErrorMsg:_,isWalletCreated:p,isWalletNeedSync:y});let{verifySa:O}=H(),h=(0,a.useCallback)(async()=>{p?y&&await O()&&await F():await M()},[M,p,y,F,O]);return(0,a.useEffect)(()=>{h()},[h]),[{errorType:E,errorMsg:R},{createWalletToServer:M}]}export{H as a,v as b,m as c,qe as d};
//# sourceMappingURL=chunk-DGIOI3MN.js.map
