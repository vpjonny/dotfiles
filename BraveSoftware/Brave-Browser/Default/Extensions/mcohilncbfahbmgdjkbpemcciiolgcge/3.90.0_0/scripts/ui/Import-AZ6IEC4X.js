import{b as Ut}from"./chunk-7SMKZHJ4.js";import"./chunk-ZFZWOU6F.js";import"./chunk-OFZ5ADZF.js";import"./chunk-KHLJBXWP.js";import"./chunk-ZTAEYDNS.js";import{a as bt}from"./chunk-PWVBSLOL.js";import{a as Ot,b as wt,c as Pt}from"./chunk-YRQLRR65.js";import{a as w,b as Nt,d as kt}from"./chunk-E4CKCWHV.js";import"./chunk-YPTISS47.js";import{a as $}from"./chunk-UX2JFEX5.js";import"./chunk-XUGHAFHG.js";import"./chunk-B5L26Z2J.js";import{d as ht}from"./chunk-AVG63QW4.js";import{a as Z}from"./chunk-ZYRXDVPT.js";import{c as At}from"./chunk-5RWZJZ73.js";import"./chunk-2QLWTTFC.js";import"./chunk-4C6TSQMS.js";import{c as Tt}from"./chunk-GHRGCPR7.js";import"./chunk-OYIB3B2O.js";import{l as Y}from"./chunk-JYCBCMDP.js";import"./chunk-W3VW6MYS.js";import"./chunk-BYDDPVAA.js";import"./chunk-CKHT4PIF.js";import"./chunk-JMNZU6WB.js";import"./chunk-WXD7TULU.js";import"./chunk-JQHLKZPQ.js";import"./chunk-ZZBUS7GI.js";import"./chunk-PMG6IXOR.js";import"./chunk-BD5XO4WL.js";import"./chunk-7U7FORYL.js";import"./chunk-NS5EW6UN.js";import"./chunk-DU4RS7AX.js";import"./chunk-5C7AUJM4.js";import"./chunk-FLXVXXZH.js";import"./chunk-XBUPORYF.js";import{b as H}from"./chunk-YVLQLIW6.js";import"./chunk-HBXZ3GPM.js";import"./chunk-6C7RJCTT.js";import{o as p}from"./chunk-N6PI3XTA.js";import"./chunk-7DW2ZPOD.js";import"./chunk-SI5WJURV.js";import"./chunk-ARDRUD4P.js";import{j as yt}from"./chunk-WYX7GFOD.js";import"./chunk-G6PA2JD3.js";import{a as gt}from"./chunk-N2N44VBE.js";import"./chunk-ZDJRNLYZ.js";import"./chunk-RV5WZKGQ.js";import"./chunk-MJSLAJV6.js";import"./chunk-KC2XLVFC.js";import{B as q,ca as St,da as Q,qa as V,ra as E}from"./chunk-MJDO2VHF.js";import"./chunk-TFTCL6XD.js";import"./chunk-TBQGFYU3.js";import"./chunk-L5AZICLM.js";import"./chunk-WLEQHCLB.js";import{b as F,pb as It}from"./chunk-QF42JCDG.js";import"./chunk-DRCTWZQB.js";import"./chunk-KGMP5AO5.js";import{c as g}from"./chunk-EAE2NUFS.js";import"./chunk-OLICTWCW.js";import"./chunk-6M37VPK2.js";import"./chunk-WOJGOC63.js";import"./chunk-3F7OC7N7.js";import"./chunk-OKGWI7CU.js";import"./chunk-EPDR6VAQ.js";import"./chunk-RFTC6RNT.js";import"./chunk-I6UBKGB5.js";import{h as Et}from"./chunk-ZIR6OOXX.js";import"./chunk-KYVX6VSI.js";import"./chunk-WN3TRBGI.js";import{c as O}from"./chunk-3FMJDUGT.js";import"./chunk-2O5TMJZM.js";import{g as rt}from"./chunk-UI4IZNSB.js";import"./chunk-FCGPU67F.js";import"./chunk-FXRKHQFW.js";import{a as G}from"./chunk-YTHL7242.js";import"./chunk-XOHZCMW2.js";import{Mb as dt}from"./chunk-EQ34WRCJ.js";import{p as r}from"./chunk-DSNMNSMD.js";import"./chunk-U2IAA473.js";import{a as Ct}from"./chunk-DOSBJ3L3.js";import"./chunk-DNGRHKLV.js";import"./chunk-3O2IEAHF.js";import{J as it,W as z,o as st}from"./chunk-URGJ6D4O.js";import"./chunk-WC6GCIBJ.js";import"./chunk-I2AEM4CA.js";import"./chunk-JRC3ZUKA.js";import"./chunk-4U5VOZ7H.js";import"./chunk-FVHZWNUE.js";import{a as xt}from"./chunk-IQUFNLVG.js";import{C as S,w as W}from"./chunk-XYWWXNVK.js";import"./chunk-VYWNZTTM.js";import"./chunk-5CHTOVVG.js";import"./chunk-FB3ILH2L.js";import{b as x}from"./chunk-FLSAETOH.js";import"./chunk-TGW66MRK.js";import"./chunk-LRIABBHT.js";import"./chunk-NEASQB35.js";import"./chunk-5BYM6SMZ.js";import"./chunk-TR37MFB4.js";import"./chunk-PNECIDQW.js";import"./chunk-BVDMVGLD.js";import"./chunk-4C5HF6J2.js";import"./chunk-4HSSECLD.js";import"./chunk-BY6XCDJZ.js";import"./chunk-U6W3TK77.js";import"./chunk-6GYKGMWB.js";import"./chunk-WJI4CIAQ.js";import"./chunk-GTDBOF5Q.js";import"./chunk-EI7BJC6V.js";import"./chunk-B3EOGJ3Y.js";import"./chunk-YL2RBVBZ.js";import"./chunk-4HAPQ4J7.js";import"./chunk-WZALYVUQ.js";import"./chunk-F5YUOHHL.js";import"./chunk-LWG66QL2.js";import"./chunk-26XSB24L.js";import"./chunk-IFKSF5TW.js";import"./chunk-PDIVTGDM.js";import"./chunk-UL6IEE2K.js";import"./chunk-4ARIYUS3.js";import{f as I,o,q as n}from"./chunk-UWURTNRY.js";o();n();var l=I(x());var Wt=I(Ct());o();n();var U=I(x());o();n();var j={img:"_img_18f4s_1",title:"_title_18f4s_6",text:"_text_18f4s_13"};var X=({text:t,title:i,footer:a})=>{let m=Et({dark:"/cdn/assets/imgs/246/3CD5B03CE6E2FC68.png",light:"/cdn/assets/imgs/246/F1105B2119166F9E.png"});return U.default.createElement(U.default.Fragment,null,U.default.createElement("img",{className:j.img,src:m,alt:""}),U.default.createElement(p.Text,{className:j.title,align:p.ALIGN.center},i),U.default.createElement(p.Text,{size:p.SIZE.sm,align:p.ALIGN.center,className:j.text},t),a)};o();n();var R=I(x());o();n();var at={"retina-border-basic":"_retina-border-basic_2bcuq_1",retinaBorderBasic:"_retina-border-basic_2bcuq_1",main:"_main_2bcuq_29",title:"_title_2bcuq_63"};var Rt=()=>{let t=G(),i=Z(),a=$(),m=()=>{globalThis.open(a.download||`https://${i}/download`)};return R.default.createElement(H,{offsetBottom:0},R.default.createElement(O.FlexBox,{className:at.main,align:O.ALIGN.center},R.default.createElement(xt,{width:32,height:32,alt:"",src:`${t}/cdn/assets/imgs/237/A229988567261685.png`}),R.default.createElement(p.Text,{size:p.SIZE.md,className:at.title},r("extension_wallet_qr_title_app_download")),R.default.createElement(S,{type:S.TYPE.highlight,size:S.SIZE.xs,onClick:m},r("extension_wallet_qr_btn_download"))))};o();n();var s=I(x());var Dt=I(Ct());o();n();var tt=I(x());o();n();var J=I(x());var v=()=>{let[t,i]=(0,J.useState)(null);return(0,J.useEffect)(()=>{(async()=>{let a=await g().getMpcToken();i(a)})()},[]),t};var _={IMPORTED:"IMPORTED",NOT_CREATE:"NOT_CREATE",NOT_IMPORTED:"NOT_IMPORTED",TOKEN_EXPIRED:"TOKEN_EXPIRED",ACCOUNT_MISMATCH:"ACCOUNT_MISMATCH",VERIFY_PASS:"VERIFY_PASS",RECOVER:"RECOVER"},vt=()=>{let t=v(),i=E(St),a=E(Q),[m,e]=(0,tt.useState)(null);return(0,tt.useEffect)(()=>{!t||(async()=>{try{let d=await wt({},{headers:{Authorization:t}}),{data:c}=d,{mpcId:u}=c;switch(i){case w.VERIFY:{let f=await g().getMpcIdByWalletId(a);e({...c,accountStatus:f!==u?_.ACCOUNT_MISMATCH:_.VERIFY_PASS});break}case w.RECOVER:{if(u)try{await g().checkMpcIdIsImported(u),e({...c,accountStatus:_.RECOVER})}catch{e({...c,accountStatus:_.IMPORTED})}else e({...c,accountStatus:_.NOT_CREATE});break}case w.IMPORT:case w.NO_ACTION:{if(u)try{await g().checkMpcIdIsImported(u),e({...c,accountStatus:_.NOT_IMPORTED})}catch{e({...c,accountStatus:_.IMPORTED})}else e({...c,accountStatus:_.NOT_CREATE});break}default:break}}catch{e({accountStatus:_.TOKEN_EXPIRED})}})()},[t]),{accountInfo:m}};o();n();var y=I(x());var Yt=3e3,A={SCAN_NOT:-1,SCAN_SUCCESS:0,SCAN_FAIL:1,SHARE2_UPLOADED:2,SHARE2_UPLOAD_FAIL:3,NET_WORK_ERROR:"NET_WORK_ERROR"},Mt=(t,i)=>{let[a,m]=(0,y.useState)({status:A.SCAN_NOT}),e=v(),d=(0,y.useRef)(null),c=()=>{d.current&&clearInterval(d.current),m({status:A.SCAN_NOT})},u=(0,y.useCallback)(async()=>{try{let f=await Ot({pubKey:t},{headers:{Authorization:e}}),{status:h,cipherText:N,mpcId:b}=f.data;m({status:h,cipherText:N,mpcId:b})}catch{m({status:A.NET_WORK_ERROR})}},[t,e]);return(0,y.useEffect)(()=>!t||!i?.mpcId?()=>{c()}:(u(),d.current=setInterval(async()=>{await u()},Yt),()=>{c()}),[t,e,i?.mpcId]),{scanInfo:a,clear:c}};o();n();var C=I(x());o();n();var et={scanImg:"_scanImg_r7slg_1",scanStatusTip:"_scanStatusTip_r7slg_5",loadingTip:"_loadingTip_r7slg_9"};var M=({onClick:t=()=>{},imgSrc:i,text:a,loading:m=!1})=>{let e=G();return C.default.createElement(O.FlexBox,{onClick:t,direction:O.DIRECTION.vertical,align:O.ALIGN.center},m?C.default.createElement(C.default.Fragment,null,C.default.createElement(W.Circle,{size:W.SIZE.lg}),C.default.createElement(p.Text,{className:et.loadingTip,size:p.SIZE.sm},a)):C.default.createElement(C.default.Fragment,null,C.default.createElement("img",{className:et.scanImg,src:`${e}${i}`,alt:""}),C.default.createElement(p.Text,{className:et.scanStatusTip,size:p.SIZE.sm},a)))};o();n();var P={container:"_container_7ejxx_1",main:"_main_7ejxx_7",title:"_title_7ejxx_10",subTitle:"_subTitle_7ejxx_17",qrCode:"_qrCode_7ejxx_23",scanImg:"_scanImg_7ejxx_28",scanTip:"_scanTip_7ejxx_32",scanStatusTip:"_scanStatusTip_7ejxx_36"};var zt="okx_mpc:",Gt=({accountInfo:t,userInfo:i})=>{let a=(0,Dt.useHistory)(),m=V(),[e,d]=(0,s.useState)(!1),[c,u]=(0,s.useState)({}),[f,h]=(0,s.useState)(!1),N=E(q),b=E(Q),ct=yt(b),{scanInfo:D,clear:lt}=Mt(c.publicKey,t),Ht=i?.email||"",mt=async()=>{d(!0),h(!1);let L=bt();try{let k=await L.exec("genRsaPair");u(k)}catch{h(!0)}finally{d(!1)}};(0,s.useEffect)(()=>{mt()},[]);let[Bt,_t]=(0,s.useState)("");(0,s.useEffect)(()=>{(async()=>{let{AesEncodeQRCodeInfo:L}=await rt();if(c.publicKey&&i.uuid){let k={publicKey:c.publicKey,time:Date.now(),uId:i.uuid},K=L(JSON.stringify(k),i.uuid);_t(`${zt}${K}`);return}_t("")})()},[c,i.uuid]);let B=async()=>{lt(),mt()},Kt=(0,s.useCallback)(()=>{if(f)return s.default.createElement(M,{onClick:B,imgSrc:"/cdn/assets/imgs/237/C31554E48A2A20D8.png",text:r("extension_wallet_qr_text_refresh_qr_code")});if(e)return s.default.createElement(M,{loading:!0,onClick:B,text:r("extension_wallet_qr_text_loading")});switch(D.status){case A.SCAN_SUCCESS:return s.default.createElement(M,{imgSrc:"/cdn/assets/imgs/237/0929F8643613BD4F.png",text:r("extension_wallet_qr_text_confirm_mobile")});case A.SCAN_FAIL:case A.SHARE2_UPLOAD_FAIL:return s.default.createElement(M,{onClick:B,imgSrc:"/cdn/assets/imgs/237/C31554E48A2A20D8.png",text:r("extension_wallet_qr_text_sync_failed")});case A.NET_WORK_ERROR:return s.default.createElement(M,{onClick:B,imgSrc:"/cdn/assets/imgs/237/C31554E48A2A20D8.png",text:r("extension_wallet_qr_text_network_failed")});case A.SHARE2_UPLOADED:default:return null}},[D,f,e]);return(0,s.useEffect)(()=>{(async()=>{let{status:L,cipherText:k,mpcId:K}=D;if(L===A.SHARE2_UPLOADED){let{phone:qt="",approvedPetname:ut=""}=i,pt={approvedPetname:ut,phone:qt,email:Ht,walletName:ut};if(m(Y.setKeepOpen({show:!0})),N){let{RSADecodeQRCodeInfo:Qt}=await rt(),Vt=await Qt(k,c.privateKey);if(await g().importMpcWallet({share2:Vt,mpcId:K,userInfo:pt}),gt(),t.accountStatus===_.RECOVER&&ct?.status?.mpcStatus===kt.RECOVER&&ct?.keyringIdentityType===dt.MPC){let ft=await g().getWalletIdentityByWalletId(b);ft?.groupId&&await m(Tt(ft.groupId))}a.push(F)}else await m(At({cipherText:k,privateKey:c.privateKey,mpcId:K,userInfo:pt})),a.push(`${It}?from=${Ut.MPC}`);lt()}})()},[D,c]),s.default.createElement(s.default.Fragment,null,s.default.createElement(z,{className:P.qrCode,level:z.LEVEL.Q,text:Bt,type:z.TYPE.svg,size:232,cornersDotOptions:{type:"dot"},cornersSquareOptions:{type:"dot"},dotsOptions:{type:"dots"},mask:D.status!==A.SCAN_NOT||f||e,renderMaskCon:Kt}))},Zt=({accountInfo:t,userInfo:i={},accountName:a})=>s.default.createElement("div",{className:P.container},s.default.createElement("div",{className:P.main},s.default.createElement("div",{className:P.title},r("extension_wallet_qr_title_sync_wallet")),s.default.createElement("div",{className:P.subTitle},r("extension_wallet_qr_subtitle_scan_confirm",{acctname:a})),s.default.createElement(Gt,{accountInfo:t,userInfo:i}),s.default.createElement(p.Text,{className:P.scanTip,size:p.SIZE.sm,align:p.ALIGN.center},r("extension_wallet_qr_text_operational_tips")))),Lt=Zt;o();n();var ot=I(x());var Ft=()=>{let t=v(),[i,a]=(0,ot.useState)({userInfo:null});return(0,ot.useEffect)(()=>{!t||(async()=>{try{let m=await Pt({},{headers:{Authorization:t}}),{data:e,code:d}=m;a({userInfo:e,code:d})}catch{a({userInfo:{}})}})()},[t]),i};o();n();var nt={container:"_container_1on3b_1",main:"_main_1on3b_7",title:"_title_1on3b_10",subTitle:"_subTitle_1on3b_17",qrCode:"_qrCode_1on3b_23",scanImg:"_scanImg_1on3b_27",scanTip:"_scanTip_1on3b_31",notHaveWalletImg:"_notHaveWalletImg_1on3b_35",notHaveWalletTitle:"_notHaveWalletTitle_1on3b_40",notHaveWalletSubTitle:"_notHaveWalletSubTitle_1on3b_47",scanStatusTip:"_scanStatusTip_1on3b_50",loadingContainer:"_loadingContainer_1on3b_54"};var $t=()=>{let t=(0,Wt.useHistory)(),i=Z(),a=$(),m=V(),{userInfo:e,code:d}=Ft(),c=E(q),{accountInfo:u}=vt(),f=(0,l.useMemo)(()=>e?.phone||e?.email||"",[e]);(0,l.useEffect)(()=>{u&&e&&(u?.accountStatus===_.VERIFY_PASS?(it.success({title:r("extension_wallet_error_toast_verification_successful")}),m(Y.setKeepOpen({show:!0})),g().setMpcAction("",""),t.push(F)):d===0&&it.success({title:r("extension_wallet_qr_toast_login_successful",{acctname:f})}))},[u,e,f,d]);let h=async()=>{g().setMpcAction("","")};if((0,l.useEffect)(()=>(window.addEventListener("beforeunload",h),()=>{window.removeEventListener("beforeunload",h)}),[]),!u||!e)return l.default.createElement("div",{className:nt.loadingContainer},l.default.createElement(W.Circle,null));let N=()=>{g().setMpcAction("",""),t.push(F)},b=()=>{switch(u.accountStatus){case _.IMPORTED:return l.default.createElement(X,{title:r("extension_wallet_verification_title_account_duplicate",{acctname:f}),text:r("extension_wallet_verification_text_account_duplicate1"),footer:l.default.createElement(H.FooterActions,{placeholder:!1},l.default.createElement(S,{type:S.TYPE.highlight,size:S.SIZE.lg,block:!0,onClick:N},r("extension_wallet_verification_btn_return")))});case _.NOT_CREATE:return l.default.createElement(X,{title:r("extension_wallet_login_title_not_created",{acctname:f}),text:r("extension_wallet_login_text_not_created1"),footer:l.default.createElement(Rt,null)});case _.ACCOUNT_MISMATCH:return l.default.createElement(X,{title:r("extension_wallet_verification_title_account_mismatch"),text:r("extension_wallet_verification_text_account_mismatch1"),footer:l.default.createElement(H.FooterActions,{placeholder:!1},l.default.createElement(S,{type:S.TYPE.highlight,size:S.SIZE.lg,block:!0,onClick:N},r("extension_wallet_verification_btn_return")))});case _.NOT_IMPORTED:case _.RECOVER:return l.default.createElement(Lt,{accountInfo:u,userInfo:e,accountName:f});default:return null}};return l.default.createElement("div",{className:nt.container},l.default.createElement(ht,{onBack:N,closeable:!1,bordered:!1}),l.default.createElement("div",{className:nt.main},b()),l.default.createElement(st,{visible:u.accountStatus===_.TOKEN_EXPIRED||d!==0,title:r("extension_wallet_error_toast_title_verify_again"),text:r("extension_wallet_error_toast_text_verify_again1"),infoType:st.Prompt.INFO_TYPE.warn,hideCloseBtn:!0,alignBottom:!1,footer:l.default.createElement(S,{category:S.CATEGORY.fill,type:S.TYPE.highlight,size:S.SIZE.md,block:!0,onClick:async()=>{await g().setMpcAction(w.VERIFY,c),globalThis.open(a?.mpcLogin||`https://${i}${Nt}`),window.close()}},r("extension_wallet_error_toast_btn_verification"))}))},un=$t;export{un as default};
//# sourceMappingURL=Import-AZ6IEC4X.js.map
