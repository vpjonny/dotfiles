import{a as he}from"./chunk-O6ODITJY.js";import{c as de,d as I}from"./chunk-2XOPB27K.js";import{a as Fe}from"./chunk-OBLKTTHP.js";import{d as N}from"./chunk-CKHT4PIF.js";import{a as A}from"./chunk-JMNZU6WB.js";import{d as Ge}from"./chunk-7U7FORYL.js";import{p as Le}from"./chunk-MT3ANHCR.js";import{a as Pe}from"./chunk-MJSLAJV6.js";import{a as w,l as z,p as ge}from"./chunk-KC2XLVFC.js";import{c as ye}from"./chunk-U5DGHXS4.js";import{a as pe,b as $}from"./chunk-6M37VPK2.js";import{Z as v}from"./chunk-3F7OC7N7.js";import{C as Y,c as x,d as C,e as oe,f as _,h as O,m as ce,o as me,p as ue,t as U}from"./chunk-EPDR6VAQ.js";import{c as le}from"./chunk-2O5TMJZM.js";import{K as fe}from"./chunk-UI4IZNSB.js";import{k as R,p as ae}from"./chunk-DSNMNSMD.js";import{b as D}from"./chunk-FLSAETOH.js";import{Aa as ne,M as ie,Q as se,g as te}from"./chunk-4C5HF6J2.js";import{f as M,o as d,q as h}from"./chunk-UWURTNRY.js";d();h();var G=M(D());ne();d();h();var B=M(D());d();h();var Ee=M(D());d();h();var ke=async(e={})=>!(e?.baseFeePerGas===void 0||e?.baseFeePerGas===null),J=e=>parseInt(e,16);function We({baseFeePerGas:e,number:t}){return{number:t,baseFeePerGas:e,gasUsedRatio:null,priorityFeesByPercentile:null}}function qe({baseFeePerGas:e,number:t,blockIndex:s,gasUsedRatios:i,priorityFeePercentileGroups:r,percentiles:a}){let o=i[s],n=r[s],u=a.reduce((c,m,l)=>{let f=n[l];return{...c,[m]:J(f)}},{});return{number:t,baseFeePerGas:e,gasUsedRatio:o,priorityFeesByPercentile:u}}async function be({provider:e,numberOfBlocks:t,endBlockNumber:s,percentiles:i,includeNextBlock:r}){let a=Y($(t)),o=Y($(s)),n=await e.send("eth_feeHistory",[a,o,i]),u=J(n.oldestBlock);if(n.baseFeePerGas!==void 0&&n.baseFeePerGas.length>0&&n.gasUsedRatio.length>0&&(n.reward===void 0||n.reward.length>0)){let c=r?n.baseFeePerGas:n.baseFeePerGas.slice(0,t),m=n.gasUsedRatio,l=n.reward??[],f=m.length;return c.map((F,g)=>{let p=J(F),E=x(u,g);return g>=f?We({baseFeePerGas:p,number:E}):qe({baseFeePerGas:p,number:E,blockIndex:g,gasUsedRatios:m,priorityFeePercentileGroups:l,percentiles:i})})}return[]}var X=1024;function Ve(e,t){let s=t;_(e,s)&&(s=e);let i=[];for(let r=C(e,s);_(r,e);r=x(r,X)){let a=C(e,r),o=a<X?a:X,n=x(r,o);i.push({numberOfBlocks:o,endBlockNumber:n})}return i}var ve=async({provider:e,numberOfBlocks:t,endBlock:s="latest",percentiles:i=[],includeNextBlock:r=!1})=>{let a=i.length>0?Array.from(new Set(i)).sort((c,m)=>c-m):[],n=Ve(s,t);return(await Promise.all(n.map(({numberOfBlocks:c,endBlockNumber:m},l)=>l===n.length-1?be({provider:e,numberOfBlocks:c,endBlockNumber:m,percentiles:a,includeNextBlock:r}):be({provider:e,numberOfBlocks:c,endBlockNumber:m,percentiles:a,includeNextBlock:!1})))).reduce((c,m)=>[...c,...m],[])};var Ye=e=>e?N(e):{},ze=["0x144","0x2105"],$e=e=>(0,Ee.useCallback)(async()=>e?(await Ye(e)).getBlock("latest"):{},[e]),Re=e=>w(async({to:t,from:s,value:i,data:r=""},a)=>{let o=!a,n="";r?I(r)?n=Le(r):n=de(r):o||(n=Fe(t,i||0));let u=await N(e),c={from:s,to:o?t:a};return o?c.value=i:c.value="0x0",n?c.data=n:c.data="0x",(await u.estimateGas(c)).toString()}),Q=["low","medium","high"],xe={low:{percentile:10,base:1.1,priority:.94,minSuggestedMaxPriorityFeePerGas:1e9,estimatedWaitTimes:{minWaitTimeEstimate:15e3,maxWaitTimeEstimate:3e4}},medium:{percentile:20,base:1.2,priority:.97,minSuggestedMaxPriorityFeePerGas:15e8,estimatedWaitTimes:{minWaitTimeEstimate:15e3,maxWaitTimeEstimate:45e3}},high:{percentile:30,base:1.25,priority:.98,minSuggestedMaxPriorityFeePerGas:2e9,estimatedWaitTimes:{minWaitTimeEstimate:15e3,maxWaitTimeEstimate:6e4}}};function Xe(e){let t=e.slice().sort((r,a)=>_(C(r,a),0)?-1:1),s=t.length,i=Math.floor((s-1)/2);return t[i]}var Je=(e,t,s)=>{let i=s[e],r=t[t.length-1].baseFeePerGas,a=t.map(u=>"priorityFeesByPercentile"in u?u?.priorityFeesByPercentile?.[i.percentile]:null).filter(Boolean),o=Xe(a),n=x(r,o);return{baseFeePerGas:U(r,0),maxFeePerGas:U(n,0),maxPriorityFeePerGas:U(o,0)}},Qe=(e,t)=>Q.reduce((s,i)=>{let r=Je(i,e,t),{maxFeePerGas:a}=r;return[...s,{level:i,isSupportEip1559:!0,gasPrice:a,...r}]},[]),Ze=(e,t)=>w(async s=>{let i=await N(e),r=await ve({provider:i,endBlock:s.number,numberOfBlocks:21,percentiles:[10,20,30]});return Qe(r,t)}),Ke={low:{coefficient:1.1,level:"low"},medium:{coefficient:1.35,level:"medium"},high:{coefficient:1.7,level:"high"}},je=(e,t)=>w(async()=>{let r=(await(await N(e)).getFeeData()).gasPrice.toString();return Q.reduce((a,o)=>{let{level:n}=t[o];return[...a,{level:n,gasPrice:r}]},[])});function er(e){let{rpcNetworks:t}=Ge(),s=t.find(i=>i?.rpcUrl===e);return Q.reduce((i,r)=>{let a=s?.gasNormal?.[r]||Ke[r]?.coefficient,o=s?.gas1559?.[r]||xe?.[r];return{evmNormalGasPrice:{...i.evmNormalGasPrice,[r]:{level:r,coefficient:a}},evm1559GasPrice:{...i.evm1559GasPrice,[r]:{...xe[r],...o}}}},{})}var Ce=(e,t={})=>{let s=er(e),i=$e(e),r=je(e,s?.evmNormalGasPrice),a=Ze(e,s?.evm1559GasPrice),o=t?.method;return w(async n=>{if(e){let u=await i(),c=!ye({chainId:n,method:o})&&!ze.includes(n)&&await ke(u),m,l=c?a:r;try{m=await l(u)}catch{m=await r()}return m}return[]})};var rr=({txParams:e={}},t)=>{let{to:s,from:i,value:r,data:a,tokenAddress:o}=e,[n,u]=(0,B.useState)(""),[c,m]=(0,B.useState)(""),[l,f]=(0,B.useState)(!0),[F,g]=(0,B.useState)(!1),p=A(),y=Re((t||p)?.rpcUrl),{run:b}=ge(async()=>{try{f(!0);let k=await y({to:s,from:i,value:r,data:a},o);u(k),g(!1)}catch(k){m(k?.message||""),g(!0)}finally{f(!1)}},{wait:500});return(0,B.useEffect)(()=>{b()},[s,i,r,a,o,b]),{chainGasLimit:n,chainGasLimitError:c,chainGasLimitLoading:l,chainGasLimitLoadFailed:F}},we=rr;d();h();var L=M(D());ne();var tr=({txParams:e={}},t)=>{let[s,i]=(0,L.useState)([]),[r,a]=(0,L.useState)(""),[o,n]=(0,L.useState)(!0),[u,c]=(0,L.useState)(!1),{rpcUrl:m,chainId:l}=t,f=Ce(m,e),F=7e3,g=(0,L.useRef)(null),p=(0,L.useRef)(!0),E=()=>{p.current=null,g.current&&clearTimeout(g.current)},y=async(b=!1)=>{try{b&&n(!0);let k=await f(l);(b||p.current)&&(i(k),c(!1))}catch(k){b&&(a(k?.message||""),c(!0))}finally{n(!1),p.current&&(g.current=setTimeout(()=>{y()},F))}};return(0,L.useEffect)(()=>t?.rpcUrl?(y(!0),()=>{E()}):te,[t?.rpcUrl]),{isSupportEip1559:s[0]?.isSupportEip1559,chainGasPrices:s,chainGasPriceError:r,chainGasPriceLoading:o,chainGasPriceLoadFailed:u}},Be=tr;var Te=e=>I(e)?pe(e):e,_e={gas1559:{low:{base:"1.1",priority:"1.1"},medium:{base:"1.2",priority:"1.2"},high:{base:"1.3",priority:"1.3"},minPriority:"0"},gasNormal:{low:"1.1",medium:"1.2",high:"1.3"},gasLimit:"1.5"},ir={low:v.SLOW,medium:v.STANDARD,high:v.FAST},sr={},nr=({chainGasLevels:e})=>e.find(({typeKey:t})=>t===v.STANDARD)||sr,ar=()=>w(async e=>{try{let{data:t}=await fe(le.getTestNetGasRate,{chainId:Te(e)});return t}catch{return _e}}),or=e=>{let t=ar(),[s,i]=(0,G.useState)(!0),[r,a]=(0,G.useState)(_e);return z(async()=>{if(e){let o=await t(e);a(o),i(!1)}},[e]),{loading:s,chainGasRate:r}},Se=(e,t)=>{let{maxFeePerGas:s,gasPrice:i,gasLimit:r}=e,a=s||i;return{...e,unitPrice:`${R.ceilShort(me(a),2)} ${ae("extension_wallet_transaction_input_gwei")}`,totalPrice:Pe(ue(R.ceilMul(a,r,0)),{symbol:t?.symbol}).value}},cr=({chainGasLevels:e=[],chainGasRate:t={}})=>e.map(i=>{let r=t?.gas1559?.[i.level]||{},{baseFeePerGas:a,maxFeePerGas:o,maxPriorityFeePerGas:n,gasPrice:u,...c}=i,m=R.ceilMul(a,r?.base,0),l=oe([R.ceilMul(n,r?.priority,0),t?.gas1559?.minPriority?ce(t?.gas1559?.minPriority):0]),f=x(m,l),F=t?.gasNormal?.[i.level]||1;return{gasPrice:R.ceilMul(u,F,0),baseFeePerGas:m,maxPriorityFeePerGas:l,maxFeePerGas:f,...c}}),Z=({key:e,validDappGas:t,standardLevel:s,dappInjectedGasInfo:i})=>t&&i[e]||s[e],mr=({gasPrice:e,maxFeePerGas:t,maxPriorityFeePerGas:s,isSupportEip1559:i})=>{let r=!1;return se(i)||(i?r=O(s,0)&&O(t,s):r=O(e,0)),r},ur=(e={},t={},s=void 0)=>{let i=A(),r=s||i,a=he(r.chainId),{chainGasPrices:o,isSupportEip1559:n,chainGasPriceError:u,chainGasPriceLoading:c,chainGasPriceLoadFailed:m}=Be({dappInjectedGasInfo:t,txParams:e},r),{chainGasLimit:l,chainGasLimitLoading:f,chainGasLimitError:F,chainGasLimitLoadFailed:g}=we({txParams:e,dappInjectedGasInfo:t},r),{chainGasRate:p,loading:E}=or(r.chainId),[y,b]=(0,G.useState)(null),[k,q]=(0,G.useState)(v.STANDARD),{gasPrice:Ne,maxFeePerGas:He,maxPriorityFeePerGas:Me}=t,S=mr({gasPrice:Ne,maxFeePerGas:He,maxPriorityFeePerGas:Me,isSupportEip1559:n});(0,G.useEffect)(()=>{S&&q(v.CUSTOM)},[S]),z(async()=>{if(r?.rpcUrl){let P=await a(r.chainId);ie(P)||(q(v.CUSTOM),b(P))}},[r?.rpcUrl]);let De=c||f||E,Oe=m||g,Ue=u||F,Ae=p.gasLimit,H=R.ceilMul(l,Ae,0),V=(0,G.useMemo)(()=>cr({chainGasRate:p,chainGasLevels:o}).map(re=>Se({...re,gasLimit:H,typeKey:ir[re.level]},r)),[n,p,o,H,r]),T=nr({chainGasLevels:V}),K=(0,G.useMemo)(()=>{let P={...T,gasPrice:Z({key:"gasPrice",standardLevel:T,validDappGas:S,dappInjectedGasInfo:t}),maxFeePerGas:Z({key:"maxFeePerGas",standardLevel:T,validDappGas:S,dappInjectedGasInfo:t}),maxPriorityFeePerGas:Z({key:"maxPriorityFeePerGas",standardLevel:T,validDappGas:S,dappInjectedGasInfo:t})};return P.baseFeePerGas=C(P.maxFeePerGas,P.maxPriorityFeePerGas),P},[T,t,S]),j=(0,G.useMemo)(()=>{let P=H;return y?.gasLimit?P=y.gasLimit:t.gasLimit&&(P=Te(t.gasLimit)),{...y||K,gasLimit:P,typeKey:v.CUSTOM}},[H,y,K,t.gasLimit]),ee=(0,G.useMemo)(()=>[...V,Se(j,r)],[V,j,r]),Ie=ee.find(({typeKey:P})=>P===k)||{};return{setGasType:q,chainGasLevels:ee,currentGasInfo:Ie,setCustomGasOption:b,chainGasLoading:De,chainGasError:Ue,chainGasLoadFailed:Oe,chainGasPriceLoading:c,chainGasLimitLoading:f,chainGasPriceLoadFailed:m,chainGasLimitLoadFailed:g}},et=ur;export{Re as a,Ce as b,_e as c,ar as d,cr as e,et as f};
//# sourceMappingURL=chunk-6HJJJE2I.js.map
