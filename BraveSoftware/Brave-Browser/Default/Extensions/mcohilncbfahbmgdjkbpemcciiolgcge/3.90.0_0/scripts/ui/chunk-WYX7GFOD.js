import{a as Ce}from"./chunk-G6PA2JD3.js";import{a as ye}from"./chunk-N2N44VBE.js";import{g as L}from"./chunk-MJSLAJV6.js";import{B as pe,Y as me,c as te,d as tr,qa as b,ra as S}from"./chunk-MJDO2VHF.js";import{h as F}from"./chunk-TBQGFYU3.js";import{q as Te,r as Ee,s as k}from"./chunk-QF42JCDG.js";import{p as ue,q as fe}from"./chunk-KGMP5AO5.js";import{c as C}from"./chunk-EAE2NUFS.js";import{a as ge,b as he,c as Ae,d as We,e as Ie}from"./chunk-OLICTWCW.js";import{a as _e,b as we,g as xe}from"./chunk-I6UBKGB5.js";import{c as O,e as T}from"./chunk-WN3TRBGI.js";import{c as ee}from"./chunk-2O5TMJZM.js";import{O as re}from"./chunk-UI4IZNSB.js";import{$ as ne,Eb as W,Gb as le,Lb as de,Mb as I,Z as B,aa as ae,ba as se,ca as oe,eb as ie,ga as ce,hb as h}from"./chunk-EQ34WRCJ.js";import{p as x}from"./chunk-DSNMNSMD.js";import{a as nr}from"./chunk-DOSBJ3L3.js";import{I as M}from"./chunk-URGJ6D4O.js";import{b as Z}from"./chunk-FLSAETOH.js";import{a as ve,b as er,c as rr}from"./chunk-NEASQB35.js";import{Aa as Ze,B as v}from"./chunk-4C5HF6J2.js";import{c as J,f as w,o as u,q as f}from"./chunk-UWURTNRY.js";var Me=J((xr,ke)=>{u();f();var Se="%[a-f0-9]{2}",Fe=new RegExp(Se,"gi"),be=new RegExp("("+Se+")+","gi");function D(e,r){try{return decodeURIComponent(e.join(""))}catch{}if(e.length===1)return e;r=r||1;var t=e.slice(0,r),n=e.slice(r);return Array.prototype.concat.call([],D(t),D(n))}function ar(e){try{return decodeURIComponent(e)}catch{for(var r=e.match(Fe),t=1;t<r.length;t++)e=D(r,t).join(""),r=e.match(Fe);return e}}function sr(e){for(var r={"%FE%FF":"\uFFFD\uFFFD","%FF%FE":"\uFFFD\uFFFD"},t=be.exec(e);t;){try{r[t[0]]=decodeURIComponent(t[0])}catch{var n=ar(t[0]);n!==t[0]&&(r[t[0]]=n)}t=be.exec(e)}r["%C2"]="\uFFFD";for(var a=Object.keys(r),o=0;o<a.length;o++){var s=a[o];e=e.replace(new RegExp(s,"g"),r[s])}return e}ke.exports=function(e){if(typeof e!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch{return sr(e)}}});var Pe=J(p=>{u();f();var or=ve(),cr=Me(),Ne=er(),ir=rr(),lr=e=>e==null,U=Symbol("encodeFragmentIdentifier");function dr(e){switch(e.arrayFormat){case"index":return r=>(t,n)=>{let a=t.length;return n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,[i(r,e),"[",a,"]"].join("")]:[...t,[i(r,e),"[",i(a,e),"]=",i(n,e)].join("")]};case"bracket":return r=>(t,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,[i(r,e),"[]"].join("")]:[...t,[i(r,e),"[]=",i(n,e)].join("")];case"colon-list-separator":return r=>(t,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,[i(r,e),":list="].join("")]:[...t,[i(r,e),":list=",i(n,e)].join("")];case"comma":case"separator":case"bracket-separator":{let r=e.arrayFormat==="bracket-separator"?"[]=":"=";return t=>(n,a)=>a===void 0||e.skipNull&&a===null||e.skipEmptyString&&a===""?n:(a=a===null?"":a,n.length===0?[[i(t,e),r,i(a,e)].join("")]:[[n,i(a,e)].join(e.arrayFormatSeparator)])}default:return r=>(t,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,i(r,e)]:[...t,[i(r,e),"=",i(n,e)].join("")]}}function ur(e){let r;switch(e.arrayFormat){case"index":return(t,n,a)=>{if(r=/\[(\d*)\]$/.exec(t),t=t.replace(/\[\d*\]$/,""),!r){a[t]=n;return}a[t]===void 0&&(a[t]={}),a[t][r[1]]=n};case"bracket":return(t,n,a)=>{if(r=/(\[\])$/.exec(t),t=t.replace(/\[\]$/,""),!r){a[t]=n;return}if(a[t]===void 0){a[t]=[n];return}a[t]=[].concat(a[t],n)};case"colon-list-separator":return(t,n,a)=>{if(r=/(:list)$/.exec(t),t=t.replace(/:list$/,""),!r){a[t]=n;return}if(a[t]===void 0){a[t]=[n];return}a[t]=[].concat(a[t],n)};case"comma":case"separator":return(t,n,a)=>{let o=typeof n=="string"&&n.includes(e.arrayFormatSeparator),s=typeof n=="string"&&!o&&y(n,e).includes(e.arrayFormatSeparator);n=s?y(n,e):n;let c=o||s?n.split(e.arrayFormatSeparator).map(d=>y(d,e)):n===null?n:y(n,e);a[t]=c};case"bracket-separator":return(t,n,a)=>{let o=/(\[\])$/.test(t);if(t=t.replace(/\[\]$/,""),!o){a[t]=n&&y(n,e);return}let s=n===null?[]:n.split(e.arrayFormatSeparator).map(c=>y(c,e));if(a[t]===void 0){a[t]=s;return}a[t]=[].concat(a[t],s)};default:return(t,n,a)=>{if(a[t]===void 0){a[t]=n;return}a[t]=[].concat(a[t],n)}}}function Be(e){if(typeof e!="string"||e.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function i(e,r){return r.encode?r.strict?or(e):encodeURIComponent(e):e}function y(e,r){return r.decode?cr(e):e}function Re(e){return Array.isArray(e)?e.sort():typeof e=="object"?Re(Object.keys(e)).sort((r,t)=>Number(r)-Number(t)).map(r=>e[r]):e}function je(e){let r=e.indexOf("#");return r!==-1&&(e=e.slice(0,r)),e}function fr(e){let r="",t=e.indexOf("#");return t!==-1&&(r=e.slice(t)),r}function Ke(e){e=je(e);let r=e.indexOf("?");return r===-1?"":e.slice(r+1)}function Oe(e,r){return r.parseNumbers&&!Number.isNaN(Number(e))&&typeof e=="string"&&e.trim()!==""?e=Number(e):r.parseBooleans&&e!==null&&(e.toLowerCase()==="true"||e.toLowerCase()==="false")&&(e=e.toLowerCase()==="true"),e}function $e(e,r){r=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},r),Be(r.arrayFormatSeparator);let t=ur(r),n=Object.create(null);if(typeof e!="string"||(e=e.trim().replace(/^[?#&]/,""),!e))return n;for(let a of e.split("&")){if(a==="")continue;let[o,s]=Ne(r.decode?a.replace(/\+/g," "):a,"=");s=s===void 0?null:["comma","separator","bracket-separator"].includes(r.arrayFormat)?s:y(s,r),t(y(o,r),s,n)}for(let a of Object.keys(n)){let o=n[a];if(typeof o=="object"&&o!==null)for(let s of Object.keys(o))o[s]=Oe(o[s],r);else n[a]=Oe(o,r)}return r.sort===!1?n:(r.sort===!0?Object.keys(n).sort():Object.keys(n).sort(r.sort)).reduce((a,o)=>{let s=n[o];return Boolean(s)&&typeof s=="object"&&!Array.isArray(s)?a[o]=Re(s):a[o]=s,a},Object.create(null))}p.extract=Ke;p.parse=$e;p.stringify=(e,r)=>{if(!e)return"";r=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},r),Be(r.arrayFormatSeparator);let t=s=>r.skipNull&&lr(e[s])||r.skipEmptyString&&e[s]==="",n=dr(r),a={};for(let s of Object.keys(e))t(s)||(a[s]=e[s]);let o=Object.keys(a);return r.sort!==!1&&o.sort(r.sort),o.map(s=>{let c=e[s];return c===void 0?"":c===null?i(s,r):Array.isArray(c)?c.length===0&&r.arrayFormat==="bracket-separator"?i(s,r)+"[]":c.reduce(n(s),[]).join("&"):i(s,r)+"="+i(c,r)}).filter(s=>s.length>0).join("&")};p.parseUrl=(e,r)=>{r=Object.assign({decode:!0},r);let[t,n]=Ne(e,"#");return Object.assign({url:t.split("?")[0]||"",query:$e(Ke(e),r)},r&&r.parseFragmentIdentifier&&n?{fragmentIdentifier:y(n,r)}:{})};p.stringifyUrl=(e,r)=>{r=Object.assign({encode:!0,strict:!0,[U]:!0},r);let t=je(e.url).split("?")[0]||"",n=p.extract(e.url),a=p.parse(n,{sort:!1}),o=Object.assign(a,e.query),s=p.stringify(o,r);s&&(s=`?${s}`);let c=fr(e.url);return e.fragmentIdentifier&&(c=`#${r[U]?i(e.fragmentIdentifier,r):e.fragmentIdentifier}`),`${t}${s}${c}`};p.pick=(e,r,t)=>{t=Object.assign({parseFragmentIdentifier:!0,[U]:!1},t);let{url:n,query:a,fragmentIdentifier:o}=p.parseUrl(e,t);return p.stringifyUrl({url:n,query:ir(a,r),fragmentIdentifier:o},t)};p.exclude=(e,r,t)=>{let n=Array.isArray(r)?a=>!r.includes(a):(a,o)=>!r(a,o);return p.pick(e,n,t)}});u();f();var l=w(Z());var V=w(nr());var _=w(Pe()),ze=w(tr());u();f();var Le=w(Z());var pr=(e,r)=>(e===W.SEGWIT_NESTED_49||e===W.SEGWIT_NESTED)&&e!==r,mr=(e,r)=>{let t=e;return Array.isArray(r?.exclude)&&(t=t?.filter(({coinId:n})=>!r?.exclude?.includes(n))),t},yr=e=>{let{privateKeyMap:r}=e??{};return r},gr=e=>e?.account||{},De=e=>function(){return(0,Le.useCallback)(async(t,n={})=>{let[a,o]=await Promise.all([e().getPrivateKeyMapByWalletId({__secretData__:{walletId:t}}),e().getWalletBaseCoins(t)]),s=yr(a),c=await e().getWalletIdentityByWalletId(t),d=gr(c),m=[],N=c.initialType===de.SIMPLE_KEYRING;return o.forEach(({localType:K,coinId:$,chainName:G,image:Q,isHotNetwork:Y,hotNetworkRank:z})=>{if(Ce({coinId:$})){let P=c?.accountsMap[h],Xe=c?.segwitAddressType?.[h],X=le[h].reduce((g,A)=>(pr(A,Xe)||(N?g[A]=s[h]:s[`${h}_${A}`]&&(g[A]=s[`${h}_${A}`])),g),{});Object.keys(X).forEach(g=>{let A=X[g],Je=g;m.push({walletId:t,privateKey:A,address:P[g].address,shortenedAddress:L(d[h]),coinId:$,chainName:G,image:Q,btcAddressType:Je,isHotNetwork:Y,hotNetworkRank:z})})}else{let P=s[K];m.push({walletId:t,privateKey:P,address:d[K],shortenedAddress:L(d[K]),coinId:$,chainName:G,image:Q,isHotNetwork:Y,hotNetworkRank:z})}}),mr(m,n)},[e])};u();f();var Ue=()=>!!(window.navigator&&window.navigator.hid);u();f();var He=()=>({syncMpcWallet:async r=>{let t=r?.walletIdentities?.length||0,n=r?.mpcId||"",{data:a}=await re(ee.syncMpcwallet,{mpcId:n,deriveIndex:t});return a}});u();f();Ze();var Ve=(e,r)=>{if(!e||!Array.isArray(e))return[];let{hasBackup:t,keyringType:n}=r||{};return e.filter(a=>{let{hasBackup:o,keyringIdentityType:s}=a,c=typeof t=="boolean"?t===o:!0,d=!0;return n&&(d=(Array.isArray(n)?n:[n]).includes(s)),c&&d})},qe=e=>e?.reduce((r,{walletIdentities:t,...n})=>[...r,...t.map((a={})=>({...n,...a}))],[]),Ge=e=>e.map(r=>{let{walletIdentities:t}=r;return{...r,hasBackup:t?.[0]?.needBackup!==1}}),hr=(e={},r)=>{let t=[W.SEGWIT_NESTED,W.SEGWIT_NESTED_49],n={};return Object.keys(e).forEach(o=>{let s=r[o],c=t.find(m=>m!==s),d=Object.entries(e[o]).map(([m,N])=>({addressType:m,...N}));n[o]=d.filter(({addressType:m})=>m!==c)}),n},Qe=(e=[])=>e.map(r=>{let{walletIdentities:t}=r;return{...r,walletIdentities:t.map(n=>{let{walletId:a,accountsMap:o,addressType:s,segwitAddressType:c,...d}=n;return{walletId:a,selectedAddressType:s,addressType:hr(n?.accountsMap,c),segwitAddressType:c,...d}})}});var Ar=[ne,ce,ae,se,oe],nt=(e,r=B,t)=>{if(Ar.includes(r)&&t){let a=ie(r),o=e?.addressType?.[a]||[];return v(o,s=>s.addressType===t)?.address}return e?.account?.[r]};var Wr="syncMpcWalletErrorCode";var Ir=(0,ze.createSelector)(({keyring:e})=>e.keyringIdentities,e=>Qe(te(e))),q=e=>{let r=S(Ir);return(0,l.useMemo)(()=>{let n=Ge(r);return e?Ve(n,e):n},[e,r])},St=e=>{let r=S(({keyring:t})=>t.keyringIdentities);return(0,l.useMemo)(()=>e?r.find(t=>t.keyringId===e):null,[r,e])},R=e=>{let r=q(e);return(0,l.useMemo)(()=>qe(r||[]),[r])},Cr=()=>S(pe),kt=()=>S(me),j=(e,r=!0)=>{let t=Cr(),n=e||t,a=R();return(0,l.useMemo)(()=>r===!1&&!e?null:a.find(o=>o?.walletId===n),[a,n,r,e])},Mt=(e,r)=>j(e,!1)?.account?.[r],Ot=(e,r)=>{let t=R(r);return(0,l.useMemo)(()=>Array.isArray(e)?t.filter(({walletId:n})=>e.includes(n)):t,[e,t])},Nt=()=>{let e=R();return(0,l.useCallback)(r=>e?.find(t=>t.walletId===r),[e])},Bt=e=>j(e)?.keyringIdentityType===I.MPC,Rt=e=>{let r=j(e);return Ie(r?.initialType)},jt=e=>{let r=q(),{keyringId:t}=j()||{},n=e||t;return(0,l.useMemo)(()=>r?.find(a=>a.keyringId===n),[r,n])},Tr=()=>{let e=q();return(0,l.useCallback)(r=>e?.find(t=>t.keyringId===r),[e])};var Ye=()=>{let e=b();return(0,l.useCallback)(async(r,t={})=>{try{let{walletId:n}=await C().addNewWallet(r);return ye(),await F(e),t.hideToast||M.success({title:x("wallet_addacount_toast_account_created")}),n}catch(n){return n.message===ue&&M.error(x("wallet_home_toast_network_error")),n.message===fe&&M.error(x("extension_wallet_addwallet_toast_wallets_added",{amount:1e3})),""}},[])},Er=()=>{let e=(0,V.useHistory)();return(0,l.useCallback)(async r=>{let t=r?.walletIdentities?.[0]?.walletId;if(!Ue()){e.push(`${k}/${O.ledger}?${_.default.stringify({baseChain:B,type:T.addAccount,walletId:t})}`);return}let n=`${Ee}?${_.default.stringify({type:T.addAccount,walletId:t})}`;await xe.hasConnectedLedger()?e.push(n):we.openModal(_e.hardWareNotConnected,{walletName:r.keyringName,onButtonClick:()=>{globalThis.platform.openExtensionInBrowser(Te)},onExtButtonClick:()=>{globalThis.platform.openExtensionInBrowser(`${n}&hideBack=1`)}})},[])},_r=()=>{let e=(0,V.useHistory)(),r=Er(),t=R()?.length;return(0,l.useCallback)(async n=>{if(t===1e3){M.error(x("extension_wallet_addwallet_toast_wallets_added",{amount:1e3}));return}let{initialType:a}=n,o=n?.walletIdentities?.[0]?.walletId;switch(!0){case ge(a):{r(n);break}case he(a):{globalThis.platform.openExtensionInBrowser(`${k}/${O.trezor}?${_.default.stringify({type:T.addAccount,walletId:o,hideBack:1})}`);break}case Ae(a):{e.push(`${k}/${O.keystone}?${_.default.stringify({walletId:o,type:T.addAccount})}`);break}case We(a):{let{onekeyInfo:s}=n,{firstEvmAddress:c,connectId:d}=s;e.push(`${k}/${O.onekey}?${_.default.stringify({firstEvmAddress:c,connectId:d,type:T.addAccount})}`);break}default:break}},[])},Kt=()=>{let e=Tr(),r=Ye(),t=_r(),n=Ye(),{syncMpcWallet:a}=He();return(0,l.useCallback)(async(o,s)=>{if(o&&typeof o=="string"){let c=e(o),d=c?.walletIdentities?.[0]?.walletId;if(c?.keyringIdentityType===I.MNEMONIC)return await r(d,s);if(c?.keyringIdentityType===I.HARDWARE)return t(c);if(c?.keyringIdentityType===I.MPC){try{await a(c)}catch{return Promise.reject(new Error(Wr))}return await n(d)}return Promise.reject()}return Promise.reject()},[e,r,t,n,a])},$t=De(C);var Pt=()=>{let e=b();return(0,l.useCallback)(async(r,t)=>{await C().updateKeyringIdentityName(r,t),await F(e)},[])},Lt=()=>{let e=b();return(0,l.useCallback)(async(r,t)=>{await C().updateWalletIdentityName(r,t),await F(e)},[])},Dt=()=>{let e=b();return(0,l.useCallback)(async(r,t)=>{await C().updateKeyringIdentitiesOrder(r,t),await F(e)},[e])};export{Pe as a,Ue as b,nt as c,Wr as d,q as e,St as f,R as g,Cr as h,kt as i,j,Mt as k,Ot as l,Nt as m,Bt as n,Rt as o,jt as p,Tr as q,Kt as r,$t as s,Pt as t,Lt as u,Dt as v};
//# sourceMappingURL=chunk-WYX7GFOD.js.map
