import{e as Ne}from"./chunk-JCVVB72F.js";import{a as Re}from"./chunk-XI5NMQGM.js";import{a as Pe,b as Ee,c as De}from"./chunk-DZPLORMY.js";import{e as Le}from"./chunk-AOZHPYH5.js";import{a as Se}from"./chunk-B4MQLH4C.js";import{a as Ot,b as he,c as ve,k as Ge}from"./chunk-EUAAIPZO.js";import{a as we}from"./chunk-ZFAUEPQW.js";import{e as be,f as Ae}from"./chunk-ZUO5BDO3.js";import{a as Ht}from"./chunk-QEPQGEPL.js";import{a as Fe,d as Ut}from"./chunk-FWL474H4.js";import{B as _e,a as ye,l as Bt}from"./chunk-V7YATDMZ.js";import{l as Ce,m as It,t as Ie}from"./chunk-BIUKJDG5.js";import{d as ke}from"./chunk-AVG63QW4.js";import{d as Ct}from"./chunk-YLT6ZRGE.js";import{a as Tt,d as de}from"./chunk-2XOPB27K.js";import{a as fe}from"./chunk-JYCBCMDP.js";import{Ra as me}from"./chunk-VHMBEOFX.js";import{a as kt,f as yt,g as ge}from"./chunk-W3VW6MYS.js";import{n as xe}from"./chunk-CKHT4PIF.js";import{c as Mt}from"./chunk-PMG6IXOR.js";import{o as Te}from"./chunk-N6PI3XTA.js";import{A as pe,a as ot,n as le}from"./chunk-KC2XLVFC.js";import{a as y}from"./chunk-6M37VPK2.js";import{D as nt,X as xt,Z as _,c as ft,e as ue}from"./chunk-3F7OC7N7.js";import{E as re,c as te,d as ee,h as et,i as ne,p as oe}from"./chunk-EPDR6VAQ.js";import{c as Rt}from"./chunk-3FMJDUGT.js";import{c as ae}from"./chunk-2O5TMJZM.js";import{O as ie}from"./chunk-UI4IZNSB.js";import{Nb as ce,Z as se}from"./chunk-EQ34WRCJ.js";import{k as j,p as R}from"./chunk-DSNMNSMD.js";import{q as Nt}from"./chunk-URGJ6D4O.js";import{a as xn}from"./chunk-FB3ILH2L.js";import{b as V}from"./chunk-FLSAETOH.js";import{Aa as fn,Q as St}from"./chunk-4C5HF6J2.js";import{f as Y,o as c,q as u}from"./chunk-UWURTNRY.js";c();u();var m=Y(V());fn();c();u();var h=Y(V()),zt=Y(xn());c();u();var _t={root:"_root_1xmfs_1",title:"_title_1xmfs_4",header:"_header_1xmfs_8",icon:"_icon_1xmfs_12",textarea:"_textarea_1xmfs_16",errorTip:"_errorTip_1xmfs_19",errorBordered:"_errorBordered_1xmfs_26",label:"_label_1xmfs_31"};function Tn({className:t,value:e,onChange:o,error:l,titleClass:r,errorTipClass:f,headerClassName:p,contentClassName:d,...i}){let[n,s]=(0,h.useState)(!0);return h.default.createElement("div",null,h.default.createElement(be,{label:h.default.createElement(Rt.FlexBox,{className:_t.label,align:Rt.ALIGN.center,onClick:a=>{a.stopPropagation(),s(!n)}},R("wallet_extension_inscription_text_hex_data_optional"),h.default.createElement(Mt,{icon:"okx-wallet-plugin-arrow-small-down",size:Mt.SIZE.sm,className:(0,zt.default)({"okui-accordion-header-icon-expanded":n})})),vertical:!0,value:n&&h.default.createElement("div",null,h.default.createElement(Nt.TextArea,{...i,inputClassName:_t.textarea,errorType:Nt.TIP_TYPE.always,error:!!l,value:e,onChange:a=>{a.stopPropagation();let g=a.target.value||"";o?.(g.trim())}}),!!l&&h.default.createElement(Te.Text,{className:(0,zt.default)(_t.errorTip,f)},l))}))}var Me=Tn;c();u();function Be(t){return!!t&&(t.toLowerCase()==="0x"||!de(t)||t.length%2!==0)?R("wallet_extension_inscription_text_input_formatting_error"):null}c();u();var Pt=Y(V());var kn=({coinId:t,txParams:e,networkFee:o,modifiedData:l,mevInfo:r,isMev:f,gasReturnActivity:p})=>({coinId:t,toAddr:e?.to,fromAddr:e?.from,txSource:ce.DAPP,coinAmount:(Tt(e?.value)?y(e?.value):e?.value)||0,serviceCharge:o,inputData:l,mevSuppliers:f?r?.mevSuppliers:[],activityId:p?.activityId}),yn=({mergedParams:t,gasType:e})=>JSON.stringify({to:t?.to,gasType:e,from:t?.from,value:Tt(t?.value)?y(t?.value):t?.value,nonce:Tt(t?.nonce)?y(t?.nonce):t?.nonce,data:t?.data,gas:t?.gasLimit,oldTxHash:"",gasPrice:t?.supportEip1559?t?.maxFeePerGas:t?.gasPrice,repeatTxType:ue.CONFIRMING,priorityFee:t?.supportEip1559?t.maxPriorityFeePerGas:0,authorizationList:t?.authorizationList}),Cn=({coinId:t,txType:e,txParams:o,isMev:l,mevInfo:r,localType:f,modifiedData:p,walletAccount:d,customGasInfo:i,gasReturnActivity:n,modifiedDataError:s,isSufficientGas:a,isSufficientBalance:g,reportGasReturnActivityDataInConfirm:x,confirmBtnText:G,cancelBtnText:v,canConfirm:E,silentLoading:L,onBeforeSign:P,onBeforePublish:D,onCancel:b,onConfirm:W,onConfirmReplace:ht,isBalanceLoadError:at,preExecInfo:Z,isOutputLoading:Q,txToastCheckParams:vt})=>{let{walletId:it}=d||{},Et=De(),{networkFee:st,gasType:bt,gasPrice:At}=i||{},Ft=Le({coinId:t,walletId:it,localType:f,fromAddr:o?.from}),ct=_e(kn({coinId:t,txParams:o,networkFee:st,modifiedData:p,mevInfo:r,isMev:l,gasReturnActivity:n})),M=(0,Pt.useMemo)(()=>i?.isNetworkFeeLoading||It(i,e)||at||s||L||E===!1||!a||!g,[L,i,e,s,E,a,g,at]),S=ot(async()=>{if(ht&&typeof W=="function")return W({preExecInfo:Z,isMev:l,coinId:t,mevInfo:r,txParams:o,customGasInfo:i,modifiedData:p,gasReturnActivity:n,reportGasReturnActivityDataInConfirm:x});let $,q;try{let k=await Et({to:o?.to,from:o?.from,authorizationList:o?.authorizationList,coinId:t,gasPrice:At,userGasInfo:i,amount:y(o?.value)||0,baseCoinAmountUse:y(o?.value||0),...vt||{}});$=k.nonce,q=k.updateGasInfo}catch(k){if(k?.message===Ie)return null;throw k}x();let A={...o,...i,...q||{},nonce:$,data:p,withSignParams:!0};P&&(A=P(A,{txParams:o,customGasInfo:i,updateGasInfo:q}));try{let{signedTx:k,signParams:C}=await Ft(A),F=await ye(se,k),I={};D&&(I=(await D({signedTx:k,txHash:F,signParams:C,preExecInfo:Z}))?.publishParams||{});let Gt=await ct(k,{txHash:F,extJson:yn({mergedParams:{...A,authorizationList:C?.authorizationList},gasType:bt}),...I});return W?.({txHash:F,txId:Gt})}catch(k){return W?.({error:k})}}),{loading:B,onClick:O}=Ht(S),X=(0,Pt.useMemo)(()=>({disabled:M,loading:B||Q,actionType:Bt.ACTION_TYPE.CONFIRM,onClick:O,btnText:G}),[M,O,B,Q,G]),{loading:K,onClick:ut}=Ht(b);return[(0,Pt.useMemo)(()=>({loading:K,onClick:ut,actionType:Bt.ACTION_TYPE.CANCEL,btnText:v}),[K,ut,v]),X]},Oe=Cn;c();u();var wt=Y(V());var In=t=>{let[e,o]=(0,wt.useState)({isNetworkFeeLoading:!0,isGasLimitLoading:!0,gasLimit:"0",gasPrice:"0",maxFeePerGas:"0",maxPriorityFeePerGas:"0",supportEip1559:!1,gasType:_.STANDARD}),{gasLimitInfo:l={},gasLimit:r,gasPrice:f,maxFeePerGas:p,gasType:d,supportEip1559:i,customConfirmed:n,isGasLimitLoading:s,isNetworkFeeLoading:a,networkFee:g,maxPriorityFeePerGas:x,gasPriceInfo:G,extFee:v,useDefaultGas:E}=e,{minGasFee:L}=Ce({gasLimit:r,gasPrice:f,maxPriorityFeePerGas:x,maxFeePerGas:p,supportEip1559:i,extFee:v,gasPriceInfo:G,gasLimitInfo:l,gasType:d}),P=(0,wt.useMemo)(()=>d===_.CUSTOM&&!n&&!E?R("extension_send_mid_text_dapps_suggested_fee"):d||_.STANDARD,[n,d,E]),D=It(e,t),b=a&&s&&!l?.gasLimit;return{level:P,estimateFailed:D,customGasInfo:e,loading:a,networkFee:b?void 0:L,maxNetworkFee:b?void 0:g,onCustomGasInfoChange:o}},Ue=In;c();u();var J=Y(V());var _n=({txType:t,walletId:e,coinId:o,txParams:l,customGasInfo:r,preExecuteLoading:f})=>{let[p,d]=(0,J.useState)(""),i=Ct(o),{from:n,to:s}=l||{},[a,g]=(0,J.useState)("");(0,J.useEffect)(()=>{f||(Ot(t)||he(t)?(d(Ut.approval),g(Ot(t)?"approve":"revoke_approve")):(d(Ut.dapp),g("Contract interaction")))},[f,t]);let x=Fe({walletId:e,coinId:o,fromAddress:n,toAddress:s,txType:p,fee:oe(r?.networkFee),disabled:!s,unavailable:r.gasType===_.CUSTOM&&r.customConfirmed}),{status:G,activity:v,activityId:E,tip:L,clear:P}=x,D=()=>{re({activityId:E,activity:v,status:G,tip:L,walletId:e,address:n})},b=v?.errorCode;return(0,J.useEffect)(()=>{!a||b===0&&me({wallet_address:n,interactive_address:s,chain_id:i?.chainId,transaction_type:a})},[b,a,n,s,i?.chainId]),{gasReturnActivity:x,clearGasReturnInfo:P,reportGasReturnActivityDataInConfirm:D}},He=_n;c();u();var rt=Y(V());c();u();async function ze(t){return(await ie(ae.generate5792Data,t)).data.callData}function Pn({chainIndex:t,setModifiedData:e,create5792DataParams:o}){let[l,r]=(0,rt.useState)(!1),f=(0,rt.useRef)(0),[p,d]=(0,rt.useState)(!1),i=async(n,s)=>{try{let a=n.map(x=>x?.data?.eip5792Call).filter(Boolean),g=await ze({type:1,chainIndex:t,calls:a,...o||{}});s===f.current&&(r(!1),e(g),d(!1))}catch{d(!0),r(!1)}};return{loading:l,error:p,onDataChange:n=>{let s=(n.moduleList||[]).filter(g=>g?.data?.moduleType==="tx"),{strategyType:a}=n.txTypeInfo||{};a===yt.EIP_5792?(r(!0),f.current+=1,i(s,f.current)):(r(!1),d(!1),e(s[0]?.data?.modifiedData))}}}var Ye=Pn;c();u();var wn=t=>{let{txParams:e={}}=t,{gasPrice:o,maxFeePerGas:l,maxPriorityFeePerGas:r}=e,f=e.gas||e.gasLimit,p=_.STANDARD,d,i,n,s=y(f),a=y(o),g=y(l),x=y(r);return et(a,0)&&(p=_.CUSTOM,d=a),et(g,0)&&et(x,0)&&ne(g,x)&&(p=_.CUSTOM,i=g,n=x),et(s,0)&&(p=_.CUSTOM),!e.to&&e.data&&(p=_.CUSTOM),{initialGasType:p,initialCustomMaxPriorityFee:n,initialCustomGasLimit:s,initialCustomGasPrice:d,initialCustomMaxBaseFee:ee(i,n)}},We=wn;c();u();var Yt={"data-input":"_data-input_1k4cq_1",dataInput:"_data-input_1k4cq_1","data-input-error-tip":"_data-input-error-tip_1k4cq_5",dataInputErrorTip:"_data-input-error-tip_1k4cq_5"};var hn={},vn=t=>Number(t)===ft.INCREASE_ALLOWANCE?Pe:[],En=t=>{let{txId:e,chainId:o,walletId:l,txParams:r,gasLimitParams:f={},create5792DataParams:p={},txToastCheckParams:d,preExecParams:i,interactAddress:n,dappInfo:s={},needMev:a=!1,openMev:g,coinId:x,isShowBlockSwapMevTooltip:G,onMevChange:v,onConfirm:E,onConfirmReplace:L,onCancel:P,onBeforeSign:D,onBeforePublish:b,backable:W=!1,onBack:ht,asPage:at,confirmBtnText:Z,cancelBtnText:Q,showApproveAddressAtPopup:vt,onDataChange:it,reserveValue:Et="0",method:st=nt.SIGN_TRANSACTION}=t||{},[bt,At]=pe({mevInfo:{},isMev:g}),[Ft,{toggle:ct}]=le(!1),{from:M,to:S,value:B="0x0",data:O,typeInt:X,authorizationList:K,extParams:ut}=r||{},{isSilentSign:Wt}=ut||{},$=n!==!1&&(n||S),q=(0,m.useMemo)(()=>[xt.FeeDelegatedValueTransfer,xt.FeeDelegatedValueTransferMemo,xt.FeeDelegatedSmartContractExecution].includes(X),[X]),[A,k]=(0,m.useState)(""),C=Ct(x,void 0,{chainId:o}),F=C?.coinId,[I,Gt]=(0,m.useState)({}),Xt=I.loading,mt=(0,m.useMemo)(()=>{if(!S&&O)return kt.DEPLOY_CONTRACT;let{strategyType:T}=I?.txTypeInfo||{};return T===yt.EIP_5792?kt.EIP_5792:(I?.moduleList||[]).find(({data:tt})=>tt?.moduleType===ge.TX)?.data?.approveInfoList?.[0]?.spender?.approvalType||""},[S,O,I]),U=xe(C?.localType,l),Lt=te(y(B),Et),Xe=We({txParams:r}),qe=Se(U.walletId),Ve=(0,m.useMemo)(()=>Be(A),[A]),{isMev:lt,mevInfo:Dt}=bt,pt=A||O||"",je=(0,m.useMemo)(()=>({dappData:JSON.stringify({to:S,from:M,value:B,data:pt,typeInt:X}),from:M,authorizationList:K,dappInfo:s,chainIndex:C?.chainId,method:st===nt.ONLY_SIGN_TRANSACTION?nt.ONLY_SIGN_TRANSACTION:nt.SIGN_TRANSACTION,...i||{}}),[C?.chainId,M,pt,S,B,K,i]),Je=ot((T,z)=>{At({isMev:T,mevInfo:z}),v?.(T,z)}),{level:Ze,networkFee:Qe,maxNetworkFee:Ke,customGasInfo:qt,estimateFailed:Vt,loading:$e,onCustomGasInfoChange:tn}=Ue(mt),{gasReturnActivity:jt,reportGasReturnActivityDataInConfirm:en}=He({txType:mt,coinId:F,txParams:r,customGasInfo:qt,preExecuteLoading:Xt,walletId:U.walletId}),Jt=we(F,l),{coinAmountInt:N,isBalanceLoadError:nn,isBalanceLoading:on}=Jt,H=q?"0":Ke,Zt=(0,m.useMemo)(()=>St(N)||j.gte(N,H),[N,H]),Qt=(0,m.useMemo)(()=>!j.eq(Lt,0)&&!St(N)?j.lte(Lt,j.sub(N,H)):!0,[N,H,Lt]),{loading:rn,error:an,onDataChange:sn}=Ye({create5792DataParams:p,chainIndex:C?.chainId,setModifiedData:T=>{k(T),it&&it(T)}}),Kt=an||Ve,cn=Oe({coinId:F,txType:mt,txParams:r,isMev:lt,mevInfo:Dt,isBalanceLoadError:nn,isOutputLoading:on||rn,canConfirm:I?.canConfirm,silentLoading:I?.silentLoading,isSufficientGas:Zt,isSufficientBalance:Qt,walletAccount:U,customGasInfo:qt,gasReturnActivity:jt,modifiedDataError:Kt,localType:C?.localType,modifiedData:pt,walletId:U?.walletId,reportGasReturnActivityDataInConfirm:en,onBeforeSign:D,onBeforePublish:b,onCancel:P,preExecInfo:I,onConfirm:E,onConfirmReplace:L,confirmBtnText:Z,cancelBtnText:Q,txToastCheckParams:d}),un=ot((T,z,tt)=>{let dt=vn(T),gt=fe(z,dt);return gt?ve(r?.data,{approveAmount:tt},gt):null}),mn=(0,m.useMemo)(()=>{if(j.lt(N,H))return H},[N,H]);return m.default.createElement(m.default.Fragment,null,m.default.createElement(ke,{title:"",noContent:!0,onBack:ht,asPage:at,closeable:!1,backable:W}),m.default.createElement(Ge,{handleCancel:P,preExecParams:je,walletAccount:U,confirmBtnText:Z,cancelBtnText:Q,buttonGroup:cn,onUpdatePreExecInfo:Gt,txState:{txId:e,baseCoin:C,estimateFailed:Vt,isSufficientBalance:Qt,isSufficientGas:Zt,coinWithBalance:Jt},localType:C?.localType,mevProps:{isMev:lt,needMev:a,onMevChange:Je,isShowBlockSwapMevTooltip:G},networkFeeProps:{isFree:q,level:Ze,coinId:F,networkFee:Qe,loading:$e,estimateFailed:Vt,onClick:()=>{ct(),qe({trade:"contract_interaction",all_confirmation:"network_fee"})},maxNetworkFee:mn},onDataChange:sn,slot:{interactWith:!!$&&m.default.createElement(Ae,{address:$,title:R("wallet_extension_popup_text_interact_with")}),advancedEntry:!O&&m.default.createElement(Me,{value:A,error:Kt,onChange:k,className:Yt["data-input"],errorTipClass:Yt["data-input-error-tip"]}),bottom:!!Wt&&m.default.createElement(Re,{walletAccount:U})},renderEditApproveAmount:(T,z)=>{let tt=T?.authQuantity?.canEdit,dt=T?.spender?.approvalType,gt=T?.eip5792Call,ln=T?.txTitle?.data;return[ft.INCREASE_ALLOWANCE,ft.AUTHORIZATION].includes(dt)&&tt?m.default.createElement(Ee,{showApproveAddressAtPopup:vt,txTypeInfo:{baseInfo:ln},walletAccount:U,approve:T,baseCoin:C,onReject:P,updateApproveInfo:(pn,$t)=>{let dn=mt===kt.EIP_5792?gt?.data:r.data,gn=un(dt,dn,$t.amount);z(pn,$t,gn)}}):null}}),m.default.createElement(Ne,{gasLimitInfo:{loading:I.loading,data:I.gasFee||hn},method:st,dappInfo:s,typeInt:X,visible:Ft,coinId:F,address:M,inputData:pt,tokenAddress:S,value:y(B),onBack:ct,onClose:null,initialGasData:Xe,onGasChange:tn,minimumGasLimit:lt?Dt.gas:0,isMev:lt,mevInfo:Dt,gasReturn:jt,gasLimitParams:f,gasLimitOptions:{disabled:!0}}))},br=En;export{Me as a,Be as b,ze as c,br as d};
//# sourceMappingURL=chunk-Z3CN3PP7.js.map
