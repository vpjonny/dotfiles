import{a as vs,b as Fo,c as Hs,d as xo,e as Bo,f as Uo,g as Go,h as Xs}from"./chunk-ZWKYYPCG.js";import{a as ei,b as ae,c as oi,d as ui,f as mi}from"./chunk-X2R527OY.js";import{a as _s,d as Qs,e as Mo,f as Us,g as xt,h as br,i as Bt,j as qt,k as Ws,l as qo,m as js}from"./chunk-YLPOVMK6.js";import{e as Qo}from"./chunk-GIKT3XNH.js";import{a as zs}from"./chunk-5ZIYIFRJ.js";import{a as si}from"./chunk-5ALT5IWS.js";import{a as z}from"./chunk-3ZJEOPG5.js";import{a as ai}from"./chunk-HRY333JY.js";import{b as ci}from"./chunk-5BLXX52M.js";import{a as ie,b as Js,c as Zs,f as ti,k as ri,n as Ho,o as ii}from"./chunk-RTZBHH6D.js";import"./chunk-F43OFDEC.js";import"./chunk-OILTVSLX.js";import"./chunk-KLS3SJXA.js";import{a as Wo,b as Yo}from"./chunk-RQ4NNINW.js";import{a as Gs,c as Vs}from"./chunk-5DQKP6TK.js";import"./chunk-OWPVBYY3.js";import{K as Vo,L as bt,M as $s,u as Bs,v as No}from"./chunk-ZNFTIF43.js";import{a as Rs,b as be,d as yr}from"./chunk-D52EE5TC.js";import{e as ws,j as Ps,k as Ls}from"./chunk-FEU7MNAN.js";import"./chunk-CWNI35TN.js";import{a as ye,c as Os,d as Ns,e as se}from"./chunk-E6SXR3B6.js";import{h as q}from"./chunk-GTBNRR37.js";import"./chunk-UUOZSCBD.js";import{d as Lo,e as Is}from"./chunk-A7FGCMOW.js";import"./chunk-V2CZ7DY4.js";import"./chunk-3PLVXUNW.js";import"./chunk-HIUQCAJS.js";import"./chunk-S6FHNOIH.js";import"./chunk-RKCZ2ONP.js";import{a as bs}from"./chunk-RER2JAFZ.js";import{a as As,d as Er}from"./chunk-CJAFGYQK.js";import{f as Ys,g as V,m as Ks,n as mt}from"./chunk-QED56456.js";import{a as j}from"./chunk-HSSW2VTC.js";import{a as ni}from"./chunk-PPNQSDGF.js";import{a as Oo}from"./chunk-PYCB247J.js";import{a as Et,b as qs,c as Do,f as Rt,g as we}from"./chunk-2LQJ3JX6.js";import"./chunk-KF7FMIRD.js";import"./chunk-N4IYN7DD.js";import{a as Ds,b as Ms,c as Fs,f as xs}from"./chunk-UY2DPNBT.js";import"./chunk-SZZZVLQW.js";import{a as Dt,b as Mt,c as Ft,d as ks,e as Ee,f as Re,j as Rr,x as Es}from"./chunk-V5J3A5L5.js";import{c as vo}from"./chunk-CERSDYPT.js";import{a as y,b as ys,c as F}from"./chunk-RZETZIQO.js";import{$a as gs,B as Po,Ba as kt,Da as St,Ea as E,F as hs,M as fs,P as ne,a as yo,bb as Ts,d as ds,fb as Cs,ja as Ss,la as kr,n as re,o as ps,pa as v,v as ke,va as k}from"./chunk-P5GHREX3.js";import"./chunk-HUG2KBCE.js";import"./chunk-6XMXPOUW.js";import"./chunk-3WKBEXBH.js";import{a as wo}from"./chunk-RK4OLGCC.js";import"./chunk-NNPT43SF.js";import{a as b,b as Ae,c as ls}from"./chunk-VL2JCPJS.js";import{e as Ro,l as bo}from"./chunk-CTJAEFLV.js";import{A as _e,C as Ar,a as I,e as _r,j as Nt,l as _t,m as is,o as At,p as as,r as cs,w as us,x as ms,z as M}from"./chunk-AP4E6GDF.js";import{$ as hn,$a as _o,$b as ft,$d as zn,Aa as gn,Ac as T,Ad as Un,B as mn,Ba as N,Bd as Gn,Ca as So,Cd as Vn,Da as Tn,Db as Ce,Ea as Cn,Eb as ko,Ed as Wn,F as _,Ha as go,Ja as ut,Jc as X,Ka as To,Kc as B,Ke as h,Ma as pr,Oa as Te,Pa as hr,Pb as Sr,Rb as kn,Sa as Co,Sc as Eo,Tc as A,Td as Hn,U as so,Ua as G,Ub as gr,Ud as Yn,V as dn,Va as Z,Vb as Tr,Vd as Kn,W as Jt,Wa as ht,Wb as Cr,Wc as oe,Wd as jn,X as io,Xd as $n,Y as ao,Ya as In,Z as ln,Za as Ct,Zb as Ir,Zc as wn,_ as pn,_a as Io,_b as En,_d as Xn,ae as Jn,b as oo,be as Zn,cb as fr,ce as ts,d as un,db as it,dc as Rn,de as es,eb as tt,ee as os,f as nt,fa as co,fc as bn,g as gt,ga as Zt,gc as yn,h as Tt,ha as L,he as rs,ia as uo,j as st,ja as mo,k as ro,ka as fe,kd as Pn,l as P,la as lo,ld as Ln,le as ns,m as ct,ma as po,mb as _n,md as vn,n as no,na as Se,nb as It,nd as On,oa as lr,ob as Ao,od as Nn,pa as ho,pb as $,pd as Dn,qa as te,qb as et,qd as Mn,ra as fn,rb as An,rd as Fn,re as ss,sa as ge,sd as xn,ta as Sn,td as Bn,ud as qn,wa as Y,wd as Qn,xa as fo,xc as ee,ya as K,yc as Ie}from"./chunk-RPH2MNBW.js";import"./chunk-SKUQ6ZA4.js";import"./chunk-P3FTJE4X.js";import"./chunk-ACIP3YF7.js";import"./chunk-W6ZDZJCJ.js";import"./chunk-PGGBOJAH.js";import"./chunk-JDCCMYBK.js";import"./chunk-554VFFSY.js";import"./chunk-4ADHM5NM.js";import"./chunk-JBOOQ7HO.js";import"./chunk-RKPJE2LG.js";import"./chunk-UIZGYUZK.js";import"./chunk-DSNMNSMD.js";import{a as zt}from"./chunk-DOSBJ3L3.js";import"./chunk-DNGRHKLV.js";import"./chunk-3O2IEAHF.js";import{I as H,J as mr,K as dr,k as cn}from"./chunk-URGJ6D4O.js";import"./chunk-WC6GCIBJ.js";import"./chunk-I2AEM4CA.js";import"./chunk-JRC3ZUKA.js";import"./chunk-4U5VOZ7H.js";import"./chunk-FVHZWNUE.js";import"./chunk-IQUFNLVG.js";import{C as eo}from"./chunk-XYWWXNVK.js";import"./chunk-VYWNZTTM.js";import{f as an}from"./chunk-5CHTOVVG.js";import{a as Aa}from"./chunk-FB3ILH2L.js";import{b as Q}from"./chunk-FLSAETOH.js";import"./chunk-TGW66MRK.js";import"./chunk-TR37MFB4.js";import"./chunk-PNECIDQW.js";import"./chunk-BVDMVGLD.js";import{$ as rn,Aa as w,B as Ze,H as en,M as J,O as on,U as Xt,ca as nn,d as U,fa as to,g as rt,j as Ot,k as ar,l as g,m as _a,pa as cr,ra as ur,u as Je,ua as sn,ya as he,z as tn}from"./chunk-4C5HF6J2.js";import"./chunk-BY6XCDJZ.js";import"./chunk-WQGQVXPA.js";import"./chunk-EI7BJC6V.js";import"./chunk-WZALYVUQ.js";import"./chunk-26KHACOU.js";import"./chunk-PDIVTGDM.js";import"./chunk-UL6IEE2K.js";import"./chunk-4ARIYUS3.js";import{f as O,h as n,o as d,q as l}from"./chunk-UWURTNRY.js";d();l();var ir=O(Q()),Ia=O(zt());d();l();var li=O(Q());d();l();var Ko=O(Q());var di=({children:c,rootStore:t})=>{let e=ys(t),o=(0,Ko.useMemo)(()=>(t.commonStore.rootStore=t,t.accountStore.rootStore=t,t),[t]);return Ko.default.createElement(e.Provider,{value:o},c)};var pi=ct(({swapRootStore:c,bridgeRootStore:t,children:e,initTab:o})=>{let{commonStore:{currentTab:r}}=c.getInstance(),s=o||r,i=c.getInstance();return s===A.BRIDGE&&(i=t.getInstance()),li.default.createElement(di,{rootStore:i},e)});d();l();var ve=O(Q());d();l();d();l();var Le=O(Q()),hi=O(zt());d();l();w();var ka=()=>({from:{chainId:null,tokenContractAddress:null},to:{chainId:null,tokenContractAddress:null}}),wr={BRIDGE:"bridge",SWAP:"swap"},wt=class{constructor(t,e={},o={}){n(this,"setTab",t=>{this.tab=t});n(this,"hasFromToToken",t=>this.tab===A.LIMIT_ORDER?!J(t?.data?.fromToken)&&!J(t?.data?.toToken):!J(t?.data?.fromTokenInfo)&&!J(t?.data?.toTokenInfo));n(this,"getWidgetVersionParams",()=>!this.config.widgetVersion||this.tab===A.LIMIT_ORDER?{}:this.tab===A.BRIDGE?{widgetVersion:this.config.widgetVersion}:{widgetVersion:this.config.widgetVersion,widgetChainIds:this.config.widgetChainIds});n(this,"fetchSingleChainTokens",async({fromTokenAddress:t,toTokenAddress:e,chainId:o})=>{let[r,s]=await _(E.get(zn,{params:{fromTokenAddress:t,toTokenAddress:e,chainId:o,...this.getWidgetVersionParams()}}));return[r,s]});n(this,"generateSingleChainTokenPair",async({walletChainId:t,...e})=>{let r={chainId:M(e.fromChainId)?e.fromChainId:e.toChainId,fromTokenAddress:e.fromTokenAddress,toTokenAddress:e.toTokenAddress};if(M(r.chainId)){let[a,u]=await this.fetchSingleChainTokens(r);if(!a&&this.hasFromToToken(u))return[a,u]}if(M(t)){let[a,u]=await this.fetchSingleChainTokens({chainId:t});if(!a&&this.hasFromToToken(u))return[a,u]}let[s,i]=await this.fetchSingleChainTokens({chainId:ee});return[s,i]});n(this,"fetchCrossChainTokens",async({fromChainId:t,toChainId:e,fromTokenAddress:o,toTokenAddress:r})=>{let[s,i]=await _(E.get(Wn,{params:{chainId:t,toChainId:e,fromTokenAddress:o,toTokenAddress:r,...this.getWidgetVersionParams()}}));return[s,i]});n(this,"generateCrossChainTokenPair",async({walletChainId:t,...e})=>{if(M(e.fromChainId)||M(e.toChainId)){let s={...e},{hasFrom:i,hasTo:a}=wt.checkTokenParams({chainId:e.fromChainId,tokenContractAddress:e.fromTokenAddress},{chainId:e.toChainId,tokenContractAddress:e.toTokenAddress});Ro(e.fromChainId,e.toChainId)&&(i?s={fromChainId:e.fromChainId,fromTokenAddress:e.fromTokenAddress}:a&&(s={toChainId:e.toChainId,toTokenAddress:e.toTokenAddress}));let[u,m]=await this.fetchCrossChainTokens(s);if(!u&&this.hasFromToToken(m))return[u,m]}if(M(t)){let[s,i]=await this.fetchCrossChainTokens({fromChainId:t});if(!s&&this.hasFromToToken(i))return[s,i]}let[o,r]=await this.fetchCrossChainTokens({fromChainId:ee});return[o,r]});n(this,"fetchLimitOrderRecommendTokens",async({fromChainId:t,toChainId:e,fromTokenAddress:o,toTokenAddress:r})=>{let[s,i]=await _(E.get(Zn,{params:{fromChainId:t,toChainId:e,fromTokenAddress:o,toTokenAddress:r}}));return[s,i]});n(this,"generateLimitOrderTokenPair",async({walletChainId:t,...e})=>{let o=M(e.fromChainId),s=M(e.toChainId)?e.fromChainId===e.toChainId:!0;if(o&&s){let[u,m]=await this.fetchLimitOrderRecommendTokens(e);if(!u&&this.hasFromToToken(m))return[u,m]}if(M(t)){let[u,m]=await this.fetchLimitOrderRecommendTokens({fromChainId:t});if(!u&&this.hasFromToToken(m))return[u,m]}let[i,a]=await this.fetchLimitOrderRecommendTokens({fromChainId:ee,fromTokenAddress:""});return[i,a]});n(this,"getTokenPairByResponseData",t=>this.tab===A.LIMIT_ORDER?{from:t?.fromToken,to:t?.toToken}:{from:t?.fromTokenInfo,to:t?.toTokenInfo});n(this,"generateTokenAndTabConfig",({error:t,data:e})=>{if(t)return{error:t,from:null,to:null,tab:this.tab};let{from:o,to:r}=this.getTokenPairByResponseData(e);return{error:null,from:o,to:r,tab:this.tab}});n(this,"checkInputAmount",t=>{let e=I.BigNumber(t);return!e.isNaN()&&e.isFinite()&&e.gt(0)?e.toString():""});n(this,"generateInitConfigByParams",async({from:t,to:e,inputAmount:o,walletChainId:r})=>{let s=this.checkInputAmount(o),i={fromChainId:t.chainId,toChainId:e.chainId,fromTokenAddress:t.tokenContractAddress,toTokenAddress:e.tokenContractAddress,walletChainId:r};if(this.tab===A.BRIDGE){let[a,u]=await this.generateCrossChainTokenPair(i);return{...this.generateTokenAndTabConfig({error:a,data:u.data}),inputAmount:s}}if(this.tab===A.SWAP){let[a,u]=await this.generateSingleChainTokenPair(i);return{...this.generateTokenAndTabConfig({error:a,data:u.data}),inputAmount:s}}if(this.tab===A.LIMIT_ORDER){let[a,u]=await this.generateLimitOrderTokenPair(i);return{...this.generateTokenAndTabConfig({error:a,data:u.data}),inputAmount:s}}return{error:new Error("tab is not valid"),from:null,to:null,tab:this.tab,inputAmount:s}});this.setTab(t),this.dexParams=e,this.config=o}async makeDexParams(){let{dexParams:t}=this,e=t;zs(t)&&(e=this.readInfoFromLocalStorage());let o=M(e?.from?.chainId),r=M(e?.to?.chainId);return!o&&!r&&(e.walletChainId=await this.config.getChainId?.()),e}async initTokenPair(){let t=await this.makeDexParams(),{from:e,to:o,tab:r,inputAmount:s,error:i}=await this.generateInitConfigByParams(t);return{from:e,to:o,tab:r,inputAmount:s,error:i}}async switchTabAndInitToken(t){let{walletChainId:e,...o}=await this.makeDexParams(),{from:r,to:s,tab:i,inputAmount:a,error:u}=await this.generateInitConfigByParams({...o,tab:t});return{from:r,to:s,tab:i,inputAmount:a,error:u}}readInfoFromLocalStorage(){let t=ka(),e;switch(this.tab){case A.SWAP:e=b.get(gr);break;case A.BRIDGE:e=b.get(Tr);break;case A.LIMIT_ORDER:e=b.get(Cr)||b.get(wn)?.LIMIT_ORDER;break;default:break}let o={from:{...t.from,...e?.from},to:{...t.to,...e?.to}};return e?.from?.tokenContractAddress?o:t}writeTabInfoToLocalStorage(t){wt.writeTabInfoToLocalStorage(this.tab,t)}static writeTabInfoToLocalStorage(t,e){switch(t){case A.SWAP:b.set(gr,e);break;case A.BRIDGE:b.set(Tr,e);break;case A.LIMIT_ORDER:b.set(Cr,e);break;default:break}}},yt=wt;n(yt,"checkTokenParams",(t,e)=>{let o=Hs({fromChainId:t?.chainId,toChainId:e?.chainId,fromTokenAddress:t?.tokenContractAddress,toTokenAddress:e?.tokenContractAddress}),r=M(t?.chainId)&&!!t?.tokenContractAddress,s=M(e?.chainId)&&!!e?.tokenContractAddress;return{isValid:o,hasFrom:r,hasTo:s}}),n(yt,"judgeTabTypeByChainId",async t=>{let[e,o]=await _(E.get(ts));if(e)return A.SWAP;let{swap:r=[],bridge:s=[]}=o.data;return r.includes(U(t))?A.SWAP:s.includes(U(t))?A.BRIDGE:A.SWAP}),n(yt,"judgeTabTypeByParams",async(t,e)=>{let{isValid:o,hasFrom:r,hasTo:s}=wt.checkTokenParams(t,e);if(!o)return A.SWAP;let i=t?.chainId,a=e?.chainId;if(r&&s)return i===a?A.SWAP:A.BRIDGE;let u;return r&&!s&&(u=i),!r&&s&&(u=a),await wt.judgeTabTypeByChainId(u)}),n(yt,"formatDialogParams",t=>({from:{chainId:t?.fromChainId,tokenContractAddress:t?.fromTokenAddress},to:{chainId:t?.toChainId,tokenContractAddress:t?.toTokenAddress}})),n(yt,"getDialogInitTab",async t=>{let{from:e,to:o}=wt.formatDialogParams(t);return await wt.judgeTabTypeByParams(e,o)});var Pt=yt;var Ea=()=>{let c=b.get(Ir);if(c){if(b.remove(Ir),c.startsWith(ln))return ft.MEME_BUY;if(c.startsWith(et))return ft.BRIDGE;if(c.startsWith($))return ft.SWAP}return b.get(En)||ft.SWAP},Ra=c=>({[ft.SWAP]:$,[ft.BRIDGE]:et,[ft.MEME_BUY]:pn,[ft.MEME_SELL]:hn})[c]||$,ba=c=>{switch(c){case Ao:case $:return A.SWAP;case et:return A.BRIDGE;default:return""}},fi=()=>{let{pathname:c}=(0,hi.useLocation)(),{params:t,replace:e}=ie(),{autoSwitch:o,from:r}=t,[s,i]=(0,Le.useState)(""),[a,u]=(0,Le.useState)(!0);return(0,Le.useEffect)(()=>{let m=Ea(),p=Ra(m);if(o===wr.BRIDGE&&!r.tokenContractAddress&&p!==c){e({pathname:p,params:{...t,autoSwitch:void 0}});return}let S=ba(c);S&&(async()=>{if(S===A.SWAP&&o===wr.BRIDGE){let R=await Pt.judgeTabTypeByParams(t?.from,t?.to);R===A.BRIDGE&&e({pathname:et,params:{...t,autoSwitch:void 0}}),i(R),u(!1)}else i(S),u(!1)})().catch(()=>{})},[c,o,r]),{tabType:s,autoSwitching:a}};d();l();var Pr=O(Q());var Si=(c,t)=>{let{accountStore:e}=F(),{params:o}=ie(),{addressType:r}=o;(0,Pr.useEffect)(()=>{e.setAddressType(r)},[]);let s=Js();(0,Pr.useEffect)(()=>{async function i(){let a=new Pt(c,o),{from:u,to:m,tab:p,inputAmount:S,error:C}=await a.initTokenPair(t);C||s(u,m,S,p)}c&&i().catch(()=>{})},[c])};d();l();var gi=O(Q()),Ti=O(zt());var Ci=c=>{let{fromToStore:t}=F(),{from:e,to:o}=t,{params:r,replace:s}=ie(),{pathname:i}=(0,Ti.useLocation)(),a=Zs();(0,gi.useEffect)(()=>{let u=a(e,o);u&&c&&[$,et].includes(i)&&(new Pt(c).writeTabInfoToLocalStorage(u),s({params:{...u,feeConfig:r.feeConfig}}))},[e?.chainId,e?.tokenContractAddress,o?.chainId,o?.tokenContractAddress,c,i])};var ya=c=>{let{tabType:t}=fi();Si(t,c),Ci(t)},Ii=ya;d();l();var _i=O(Q());function Ai(){let{accountStore:c,receiveAddressStore:t}=F(),{address:e,setUserForbiddenBridge:o}=c,{receiveAddrObj:r,computedSwapHighLight:s}=t,{specifiedAddress:i}=r||{};(0,_i.useEffect)(()=>{let a=()=>{};if(e&&s){let{promise:u,cancel:m}=$s(Xn,{params:{userWalletAddress:e,receiveWalletAddress:i}});a=m,u.then(p=>{o(p?.data.blackListTypes||Co)}).catch(()=>{o(Co)})}else o(Co);return a},[e,o,i,s])}d();l();var ki=O(Q());function Lr(){let{accountStore:{address:c}}=F();(0,ki.useEffect)(()=>{k.setTags({address:c})},[c])}d();l();var vr=O(Q());w();var wa=()=>{let{quoteStore:c,accountStore:t,fromToStore:e,approveStore:o,recentTransactionStore:r,tokenModalStore:s}=F(),{computedAccountWalletAddresses:i}=t;(0,vr.useEffect)(()=>{let a=()=>{};return i&&(a=Is(i)),()=>{a?.()}},[i]),(0,vr.useEffect)(()=>{let a=Lo({isPri:!0,needLogin:!0,subscribeParams:[{channel:be.DEX_PUSH_ENGINE},{channel:be.WALLET_ASSET}],onListenError:()=>{let u=g(c,"quote.bestRoute"),m={token:e.from,defiPlatformId:z.getCurrentRouteDefiPlatformId(e.computedIsCrossChain,u),isCrossChain:e.computedIsCrossChain,refetchQuote:()=>{c.fetchQuote()}};o.onSocketError(m),r.onSocketError(),e.setNeedBalanceLoading(!1),e.getSwapTokenBalance(),s.reloadTokenList()},onListenData:(u,m)=>{if(!!u){if(m?.channel===be.DEX_PUSH_ENGINE){r.onSocket(u);let p=g(c,"quote.bestRoute"),S={token:e.from,defiPlatformId:z.getCurrentRouteDefiPlatformId(e.computedIsCrossChain,p),isCrossChain:e.computedIsCrossChain,refetchQuote:()=>{c.fetchQuote()}};o.onSocket({data:u,...S});return}m.channel===be.WALLET_ASSET&&(s.updateAllTokenList(u),e.updateFromBalancePush(u))}}});return()=>{a?.()}},[r.onSocket,s.updateAllTokenList,e.updateFromBalancePush,t,c,r,s,e])},Ei=wa;d();l();var Or=O(Q());w();var Ri=({token:c,onListenData:t=rt,globalPrice:e})=>{(0,Or.useEffect)(()=>{!_e(c)||Er(c,e)&&t(e)},[e,c?.chainId,c?.tokenContractAddress]),(0,Or.useEffect)(()=>{if(!_e(c))return rt;if(Er(c,e))return rt;let o=Lo({subscribeParams:{channel:Rs.DEX_MARKET_TX_CHANNEL,chainId:String(c.chainId),tokenAddress:c.tokenContractAddress},onListenData:r=>{t(r?.[0]||{})},onListenError:rt});return()=>{o()}},[c?.chainId,c?.tokenContractAddress])},Pa=()=>{let{fromToStore:c={},commonMarketStore:t={}}=F(),{from:e,updateFromUsdPriceFromWs:o,to:r,updateToUsdPriceFromWs:s}=c,{globalPrice:i}=t;Ri({token:e,onListenData:o,globalPrice:i}),Ri({token:r,onListenData:s,globalPrice:i})},bi=Pa;d();l();var ce=O(Q()),yi=O(zt());ds.setDataProxy(E);var La=({currency:c,currentWallet:t,walletInfo:e,keyringIdentityTypeEnum:o,t:r,dispatch:s,currentTab:i,onBack:a})=>{let{commonStore:u,accountStore:m,recentTransactionStore:p,reset:S}=F();_s();let C=(0,yi.useHistory)();(0,ce.useEffect)(()=>{L.setRuntimeContext({history:C,toLocale:r,dispatch:s,walletInfo:e,onBack:a})},[r,C,s,e,a]),(0,ce.useEffect)(()=>(t&&(L.updateGlobal({currentWallet:t}),m.setWalletConfig(t)),()=>{m.cleanWalletConfig()}),[t]),(0,ce.useEffect)(()=>(u.getUserUnit(c),u.fetchChainList({businessLine:1,currentTab:i}).catch(()=>{u.setChainListLoadError(!0)}),()=>{S()}),[]),(0,ce.useEffect)(()=>{m.setKeyringIdentityTypeEnum(o)},[o]),(0,ce.useEffect)(()=>{t.walletId?p.updatePendingOrders(t.walletId,i):p.setPendingOrders([])},[t.walletId,i]),ti()},wi=La;d();l();var W=O(Q()),Lt=O(zt());d();l();var ue=O(Q()),jo=O(zt()),Ni=O(Aa());d();l();var Pi=O(Q());var va=()=>{let{fromToStore:c}=F(),{visibleAddFunds:t,addFundsParams:e,closeAddFunds:o}=c;return Pi.default.createElement(ei,{visible:t,params:e,onBack:()=>{o()}})},Li=ct(va);d();l();var vi=O(Q());var Oi=()=>{let{fromToStore:c}=F(),{closeAddFunds:t}=c;(0,vi.useEffect)(()=>{t()},[])};var Oa=[$,et],Na=({children:c,onBack:t})=>{let{showNavigator:e,title:o}=oi(),r=(0,jo.useLocation)(),s=(0,jo.useHistory)(),{isTelegramMiniApp:i}=L.global,{Navigator:a}=L.components,u=r.pathname.includes(Jt),m=r.pathname===$;Oi();let p=()=>{u&&ne({...V(),button_name:"back"}),t?t(s.goBack,Oa.includes(r.pathname)):s.goBack()},S=()=>i?ae.telegramContainer:e?m?ae.extensionFullContainer:ae.extensionContainer:ae.extensionContainerNoHeader,{recentTransactionStore:C}=F(),{dialogVisible:R,dialogOrderId:D,closeDialog:x}=C;return ue.default.createElement("div",{className:(0,Ni.default)("universe-swap background-base-primary",ae.wrapper)},e?ue.default.createElement(a,{asPage:!0,title:o,onBack:p,closeable:!1}):null,ue.default.createElement("div",{className:S()},c),ue.default.createElement(Li,null),ue.default.createElement(Xs,{orderId:D,visible:R,onClose:x}))},Di=ct(Na);var Da=(0,W.lazy)(()=>import("./Swap-2FQSD2QU.js")),Ma=(0,W.lazy)(()=>import("./Bridge-LSVBQKPS.js")),Fa=(0,W.lazy)(()=>import("./OrderDetail-7NGIAIYI.js")),xa=(0,W.lazy)(()=>import("./Contract-2VDWMTTJ.js")),Ba=(0,W.lazy)(()=>import("./Approve-3ZQKF6W7.js")),qa=(0,W.lazy)(()=>import("./ApproveAndSwap-6PCSACGK.js")),Qa=(0,W.lazy)(()=>import("./Solana-N73ACCBS.js")),Ua=(0,W.lazy)(()=>import("./Claim-PICIH2IO.js")),Ga=({onBack:c})=>{let t=(0,Lt.useLocation)();return W.default.createElement(Di,{onBack:c},W.default.createElement(W.Suspense,null,W.default.createElement(Lt.Switch,null,[{path:$,component:Da,exact:!0},{path:et,component:Ma,exact:!0},{path:dn,component:Fa,exact:!0},{path:Jt,component:xa,exact:!0},{path:ao,component:qa,exact:!0},{path:io,component:Ba,exact:!0},{path:co,component:Qa,exact:!0},{path:Zt,component:Ua,exact:!0}].map((o,r)=>W.default.createElement(Lt.Route,{key:r,path:o.path,component:o.component,exact:o.exact})),W.default.createElement(Lt.Redirect,{from:Ao,to:{pathname:$,search:t.search},strict:!0,exact:!0}))))},Mi=Ga;var Va=({...c})=>{let{initialized:t}=js();return t?ve.default.createElement(Wa,{...c}):null};function Wa({...c}){let{currency:t,currentWallet:e,keyringIdentityTypeEnum:o,walletInfo:r,onBack:s,t:i,dispatch:a,currentTab:u=A.SWAP}=c;return Ii(r.chainId),wi({currency:t,currentWallet:e,walletInfo:r,keyringIdentityTypeEnum:o,t:i,dispatch:a,currentTab:u,onBack:s}),Ai(),Ei(),Lr(),bi(),ve.default.createElement(Mi,{onBack:s})}var Fi=(0,ve.memo)(ct(Va));d();l();w();d();l();d();l();var Oe=class{constructor(){this.isSwapLoading=!1;this.setSwapLoading=t=>{this.isSwapLoading=t};this.checkCancelLimitOrder=async()=>{};P(this)}};d();l();w();var Ne=class{constructor(t){n(this,"checkTokenValid",async t=>{if(!_e(t))return!1;let[e,o]=await _(E.get(rs,{params:to(t,["chainId","tokenContractAddress"])}));return e?!1:o.data.supportMarket});this.rootStore=t,this.accountStore=t.accountStore,P(this,{},{autoBind:!0})}};var Qt=class{constructor(){Qt.instance?(this.commonStore=Qt.instance.commonStore,this.accountStore=Qt.instance.accountStore,this.checkTokenStore=Qt.instance.checkTokenStore,this.limitOrderConfirmStore=new Oe(this)):(this.commonStore=new Ws(this),this.accountStore=new Us(this),this.checkTokenStore=new Ne(this),this.limitOrderConfirmStore=new Oe(this),Qt.instance=this)}},Ut=Qt;n(Ut,"instance",null);d();l();w();var Gt=class extends vs{constructor(e){super(e);n(this,"approveInfo",{});n(this,"setApproveInfo",e=>{this.approveInfo=e});n(this,"setApprove",async(e=To.APPROVE)=>{let{fromToStore:o,quoteStore:r,accountStore:s}=this.rootStore,i=g(r,"quote.bestRoute"),a=z.getCurrentRouteDefiPlatformId(o.computedIsCrossChain,i),u=o.from,{chainId:m,tokenContractAddress:p}=u,S=s.getAddressByChainId(m);this.updateApproveTokenConfig(u,a,{status:this.isCancelApprove(e)?ut.CancelApproving:ut.Approving});try{let{id:C,transactionPayload:R}=await this.fetchApproveData({approveDataUrl:this.getApproveUrl(o.computedIsCrossChain).approveDataUrl,params:{userWalletAddress:S,tokenContractAddress:p,chainId:m,defiPlatformId:a,cancelApproveTag:e}});this.setApproveInfo({chainId:m,id:C,transactionPayload:R,token:u,defiPlatformId:a,cancelApproveTag:e}),L.history?.push({pathname:io})}catch{this.fetchApproveDataErrorTips(u,a,e)}});n(this,"approveCancel",()=>{let e=this.approveInfo.cancelApproveTag;this.setApproveInfo({}),L.history?.goBack?.();let{fromToStore:o,quoteStore:r}=this.rootStore,s=g(r,"quote.bestRoute"),i=z.getCurrentRouteDefiPlatformId(o.computedIsCrossChain,s),a=o.from;this.updateApproveTokenConfig(a,i,{status:this.isCancelApprove(e)?ut.CancelApprove:ut.UnApproved})});n(this,"approveConfirm",async({txHash:e,error:o})=>{if(o){this.approveErrorTips({error:o,...this.approveInfo}),this.approveCancel();return}let{fromToStore:r,accountStore:s,quoteStore:i}=this.rootStore,{id:a,chainId:u,cancelApproveTag:m,defiPlatformId:p}=this.approveInfo;await this.saveApprove({id:a,chainId:u,transactionHash:e,userWalletAddress:s.getAddressByChainId(u),cancelApproveTag:m,defiPlatformId:p,isCrossChain:r.computedIsCrossChain,refetchQuote:()=>{i.fetchQuote()}}),L.history?.goBack?.(),this.setApproveInfo({})});j(this),this.rootStore=e}};d();l();w();d();l();var De=()=>{let{fromToStore:c,gasDropStore:t,receiveAddressStore:e,outerStore:o,quoteStore:r,accountStore:s}=y(),{from:i,to:a}=c,{receiveAddrObj:u}=e,{computedForbiddenBridge:m,address:p}=s,S=c.computedTypedValue&&c.computedTypedValue.endsWith(".")?c.computedTypedValue.slice(0,-1):c.computedTypedValue,R={...{chainId:i.chainId,toChainId:a.chainId,toTokenAddress:a.tokenContractAddress,fromTokenAddress:i.tokenContractAddress,amount:S,userWalletAddress:p},...r.computedSlippage,pmm:"1",gasDropType:t?.computedGasDropSelected?1:0,forbiddenBridgeTypes:Ar(m),dexIds:Ar(Oo?.computedDexIds),receiveWalletAddress:u?.specifiedAddress};return re()?R:o.extendFeeConfig(R)},Me=async()=>{let{fromToStore:c,accountStore:t}=y(),{from:e}=c,{computedSignWalletAddress:o}=t,r=await gs(o,e.chainId);return{...De(),refCode:ni.refCode,...r}},xi=()=>{let{quoteStore:c}=y();return{...De(),sort:c.bridgeSortType}},Bi=()=>{let{quoteStore:c}=y(),{quote:t}=c,e=t?.bestRoute?.bridge?.bridgeId,{slippage:o,toChainId:r,receiveWalletAddress:s,userWalletAddress:i,chainId:a,fromTokenAddress:u,toTokenAddress:m,amount:p}=De();return{slippage:o,toChainId:r,receiveWalletAddress:s,userWalletAddress:i,chainId:a,fromTokenAddress:u,toTokenAddress:m,amount:p,bridgeId:e}};d();l();function Ha({selector:c}){let t=document.querySelector(c);t&&t.scrollTo({top:0,behavior:"smooth"})}var $o=Ha;var qi=20,at={CONFIRM:"confirm",UPDATE:"update",FILL_UP:"fill_up",SNAP_UPDATE:"snap_update",CANCEL:"cancel",DEFAULT:"default"},Nr=class{constructor(t){n(this,"quoteData",null);n(this,"preDataForSendBtc",null);n(this,"setPreDataForSendBtc",t=>{this.preDataForSendBtc=t});n(this,"setQuoteData",t=>{this.quoteData=t});n(this,"quoteParams",async()=>{let{accountStore:t,fromToStore:e,receiveAddressStore:o}=this.rootStore,s={...await Me(),userWalletAddress:t.address};return e.computedDiffCrossChain&&(s.receiveWalletAddress=o.receiveAddrObj?.specifiedAddress),s});n(this,"updating",!1);n(this,"updateV6QuoteData",async({quoteParams:t,getCalldataParams:e})=>{let[o,r]=await _(se(t));if(o){H.error({title:o?.data?.msg||h("swaptrade_top_notif_data_failed")});return}let s=r?.data||{};this.rootStore.quoteStore.handleUpdateQuote({data:s});let i=await e(!0,this.rootStore.quoteStore.quote?.bestRoute),[a,u]=await _(ye(i));if(a){H.error({title:a?.data?.msg||h("swaptrade_top_notif_data_failed")});return}let m=u?.data;if(m){let p=await this.getPreExecutionPayload({orderData:m,requestParams:i});nt(()=>{this.transactionPayload=p,this.orderId=m?.orderId||""})}this.initCountDown(),this.startCountdown()});n(this,"updateQuoteData",async()=>{let{quoteStore:{quote:t},swapStore:e}=this.rootStore,o=this.rootStore?.quoteStore?.quote?.bestRoute?.defiPlatformId;this.updating=!0;let s={...await Me(),bridgeId:t?.bestRoute?.bridge?.bridgeId,...o&&{defiPlatformId:o}},i=await e.extendSignParams(s),[a,u]=await _(E.post(`${Kn}`,i));if(this.updating=!1,$o({selector:"#wallet_scroll"}),a){H.error({title:a?.data?.msg||h("swaptrade_top_notif_data_failed")});return}let{callDataResult:m,quoteResult:p}=u?.data||{};if(this.rootStore.quoteStore.handleUpdateQuote({data:p}),m){let S=await this.getPreExecutionPayload({orderData:m,requestParams:i});nt(()=>{this.transactionPayload=S,this.params=i,this.orderId=m?.orderId||""})}this.initCountDown(),this.startCountdown()});n(this,"updateBridgeGetIntentQuoteCallData",async()=>{let t=Bi();this.updating=!0;let[e,o]=await _(E.get(es,{params:{...t}}));if(this.updating=!1,$o({selector:"#wallet_scroll"}),e){H.error({title:e?.data?.msg||h("swaptrade_trading_mode_error_no_update")});return}let{quoteResult:r}=o?.data||{};r&&this.rootStore.quoteStore.handleUpdateQuote({data:r}),this.initCountDown(),this.startCountdown()});n(this,"updateSnapQuoteData",async t=>{this.updating=!0;let[e,o]=await _(se(t));if(this.updating=!1,$o({selector:"#wallet_scroll"}),e){H.error({title:e?.data?.msg||h("swaptrade_trading_mode_error_no_update")});return}let{quoteResult:r}=o?.data||{};r&&this.rootStore.quoteStore.handleUpdateQuote({data:r}),this.initCountDown(),this.startCountdown()});n(this,"timer",null);n(this,"countdown",qi);n(this,"initCountDown",()=>{this.countdown=qi});n(this,"startCountdown",()=>{this.timer=setTimeout(()=>{let t=this.countdown;if(t===0){this.clearTimer();return}this.countdown=t-1,this.startCountdown()},1e3)});n(this,"clearTimer",()=>{this.timer&&clearTimeout(this.timer)});n(this,"initGasInfo",()=>({gasType:"normal",gasLimit:"0",gasPrice:"0",maxFeePerGas:"0",maxPriorityFeePerGas:"0",supportEip1559:!1,isNetworkFeeLoading:!0,isGasLimitLoading:!0}));n(this,"gasInfo",this.initGasInfo());n(this,"setGasInfo",t=>{this.gasInfo=t});n(this,"gasFee",0);n(this,"setGasFee",t=>{this.gasFee=t});n(this,"cacheCallData",null);n(this,"cacheParams",null);n(this,"setCacheCallData",t=>{this.cacheCallData=t});n(this,"orderInfo",{});n(this,"transactionPayload",null);n(this,"approvePayload",null);n(this,"orderId","");n(this,"solonaRent","");n(this,"getPreExecutionPayload",async({orderData:t,isSwapSolana:e,requestParams:o})=>{let{swapStore:r,quoteStore:s,fromToStore:i}=this.rootStore;r?.checkCallData?.({chainId:o?.chainId,responseData:t,isSingleChain:!0,requestParams:o}).catch(()=>{});let a=s?.quote?.bestRoute||{},{fromToken:u}=a,{computedIsSingleChain:m}=i,p=No(u,{orderData:t},r);if(e){let D=await p.jitoTransaction();return this.solonaRent=Ps(D),D}let S=m&&mt.supportCustomGasFee,{payload:C,rent:R}=await p.preExecution({needGasPrice:S});return u.chainId===Ie.SOLANA_MAINNET&&R&&(this.solonaRent=R),C});n(this,"getApprovePayload",async({orderData:t,chainId:e})=>{let{approveTxInfo:o}=t;if(o){let{transactionPayload:r}=Ls({approveTxInfo:o,params:{chainId:e,isOnlySign:!0}});return r}return null});n(this,"setTransactionPayload",t=>{this.transactionPayload=t});n(this,"solanaSwapTransactionData",null);n(this,"setSolanaSwapTransactionData",t=>{this.solanaSwapTransactionData=t});n(this,"handleSolanaOfflineData",async t=>{let{offlineType:e,calldata:o,defiPlatformId:r}=t,{unsignedTx:s,quote:i}=o||{},a=await ws(s);this.solanaSwapTransactionData={transaction:a,offlineType:e,defiPlatformId:r,quote:i}});n(this,"fetchCallData",async t=>{let{swapStore:e}=this.rootStore||{};e.setCalldataSign(null);let o=null;if(t)o=t;else{let p=await e.saveOrderParams();o=await e.extendSignParams(p)}if(!o)return!1;let r=e.isSwapSolana(o.chainId),s,i,a=null;if(r){let p=e.extendSolanaCalldata(o);a=p,[s,i]=await e.getSolanaCalldata(p)}else t?[s,i]=await _(ye(o)):[s,i]=await _(E.post(Yn,o));if(s){let p=s?.error_message;return H.error({title:p||h("swaptrade_top_notif_data_failed")}),!0}this.setCacheCallData(i?.data||{}),this.cacheParams=o;let u=await this.getPreExecutionPayload({orderData:i?.data||{},isSwapSolana:r,requestParams:a});this.transactionPayload=u;let m=await this.getApprovePayload({orderData:i?.data||{},chainId:o.chainId});return this.approvePayload=m,this.orderId=i?.data?.orderId||"",!1});n(this,"preExecutionResult",{});n(this,"setPreExecutionResult",t=>{this.preExecutionResult=t});n(this,"nativeCoin",null);n(this,"setNativeCoin",t=>{this.nativeCoin={...t}});n(this,"calcNativeCoinAmount",()=>{let{coinAmountInt:t,decimals:e}=this.nativeCoin,{from:o,computedIsFromBtcCoin:r}=this.rootStore.fromToStore;return I.BigNumber(r?o.availableBalance:as(t,e))});n(this,"calcNativeCoinAmountChange",()=>{let{fromToStore:t}=this.rootStore,e=t.from,o=I.BigNumber(this.gasFee).isNaN()?"0":this.gasFee;return e.isNativeToken?I.BigNumber(e.amount).plus(o):I.BigNumber(o)});n(this,"gasFeeLoading",!0);n(this,"setGasFeeLoading",t=>{this.gasFeeLoading=t});n(this,"gasLimitError",null);n(this,"setGasLimitError",t=>{this.gasLimitError=t});n(this,"maxGasFeeInt","");n(this,"setMaxGasFeeInt",t=>{this.maxGasFeeInt=t});n(this,"activityId",null);n(this,"setActivityId",t=>{this.activityId=t});n(this,"type",Ct.SWAP);n(this,"setSwapType",t=>{this.type=t});n(this,"reset",()=>{this.gasInfo=this.initGasInfo(),this.setGasFeeLoading(!1),this.nativeCoin=null,this.transactionPayload=null,this.approvePayload=null,this.cacheParams=null,this.orderId="",this.gasFee=0,this.setGasLimitError(null),this.setStarknetRegisterStatus(""),this.setVisibleStarknetRegister(!1),this.setActivityId(null),this.setSwapType(Ct.SWAP),this.clearTimer(),this.solonaRent=""});n(this,"starknetRegisterStatus","");n(this,"setStarknetRegisterStatus",t=>{this.starknetRegisterStatus=t});n(this,"visibleStarknetRegister",!1);n(this,"setVisibleStarknetRegister",t=>{this.visibleStarknetRegister=t});n(this,"onSwap",t=>{ne({...V(),button_name:"confirm"}),this.rootStore.swapStore.onSwap(t)});n(this,"onIntentSwap",()=>{this.rootStore.intentSwapStore.onIntentSwap()});n(this,"confirmSwapMap",{[Ct.SWAP]:this.onSwap,[Ct.INTENT_SWAP]:this.onIntentSwap});n(this,"onConfirm",t=>{this.confirmSwapMap[t]?.()});n(this,"getBtnProps",t=>{let{fromToStore:e}=this.rootStore,{symbol:o,coinId:r,chainId:s}=this.nativeCoin||{};return{[at.CONFIRM]:{disabled:this.computedConfirmBtnDisabled,onClick:a=>{this.onConfirm(a)},btnText:h("swaptrade_card_swap_btn_confirm_swap"),loading:this.computedIsConfirming},[at.UPDATE]:{onClick:()=>{ne({...V(),button_name:"update"}),this.updateQuoteData().catch(rt)},btnText:h("swaptrade_confirmswap_btn_update_price")},[at.SNAP_UPDATE]:{onClick:()=>{ne({...V(),button_name:"update"}),e.computedIsCrossChain?this.updateBridgeGetIntentQuoteCallData().catch(rt):this.updateSnapQuoteData().catch(rt)},btnText:h("swaptrade_confirmswap_btn_update_price")},[at.FILL_UP]:{onClick:()=>{kr({wallet_address:this.rootStore.accountStore.address,button_name:"fill_up"}),e.baseAddFunds({coinId:r,chainId:s,receiveOnly:!1})},btnText:h("swaptrade_dialog_btn_supplement",{token:o})},[at.CANCEL]:{onClick:()=>{kr({wallet_address:this.rootStore.accountStore.address,button_name:"cancel"});let{history:a}=L;a?.goBack()},btnText:h("swaptrade_top_btn_cancel")},default:{}}[t]});P(this),this.rootStore=t}get computedFormatTime(){return ms(this.countdown)}get computedPriceUpdate(){return this.countdown===0}get computedIsSufficientGas(){if(!this.nativeCoin)return!0;let t=this.calcNativeCoinAmount(),e=this.calcNativeCoinAmountChange();return t.gte(e)}get computedSolonaNativeTokenSufficientRent(){let{quoteStore:t}=this.rootStore,e=t?.quote?.bestRoute||{},{fromToken:o}=e||{};if(o?.chainId!==Ie.SOLANA_MAINNET||!this.nativeCoin||!this.solonaRent)return!0;let r=this.calcNativeCoinAmount(),s=this.calcNativeCoinAmountChange();return r.gte(s.plus(this.solonaRent))}get walletSendParams(){let{toLocale:t,dispatch:e}=L;return!t||!e?null:{t,dispatch:e}}get computedIsIntentSwap(){return this.rootStore?.quoteStore?.computedIsOfflineType}get compuletedGetNativeCoinLoading(){return this.nativeCoin?this.nativeCoin?.isBalanceLoading:!0}get compuletedGetNativeCoinError(){return this.nativeCoin?this.nativeCoin.isBalanceLoadError:!0}get computedConfirmBtnDisabled(){let{RegisterLocalStatusEnum:t}=L.global,{computedIsStarknetChain:e,computedIsFromBtcCoin:o,computedIsEvmChain:r}=this.rootStore.fromToStore;if(this.computedIsIntentSwap)return this.computedPriceUpdate;if(e&&this.starknetRegisterStatus!==t?.COMPLETED)return!0;let s=this.computedPriceUpdate||!this.computedIsSufficientGas||!this.computedSolonaNativeTokenSufficientRent||this.gasFeeLoading||this.gasLimitError||this.compuletedGetNativeCoinError||this.compuletedGetNativeCoinLoading||this.updating;return o||!r?s:s||this.gasInfo?.isGasLimitLoading||this.gasInfo?.gasLimitInfo?.queryGasLimitErrorUseDefault}get computedIsConfirming(){let{swapStore:t,intentSwapStore:e}=this.rootStore;return this.computedIsIntentSwap?!!e.isConfirmLoading:t.isConfirmLoading}get computedConfirmBtnProps(){return this.getBtnProps(at.CONFIRM)}get computedCancelBtnProps(){return this.getBtnProps(at.CANCEL)}get computedTipsBtnProps(){let t=at.DEFAULT;return(!this.computedIsSufficientGas||!this.computedSolonaNativeTokenSufficientRent)&&!this.compuletedGetNativeCoinError&&!this.compuletedGetNativeCoinLoading?t=at.FILL_UP:this.computedPriceUpdate&&(t=this.computedIsIntentSwap?at.SNAP_UPDATE:at.UPDATE),this.getBtnProps(t)}get computedMonitorGasType(){return this.gasInfo?.gasType?{network_fee_details:{gas_level:this.gasInfo?.gasType}}:{}}},Xo=Nr;d();l();w();d();l();var Dr=class{constructor(t){n(this,"signIntentSwap",async()=>[]);n(this,"createIntentOrder",async t=>{let e={intentCode:t.offlineType,signature:t.signature,quote:t?.quote,userWalletAddress:this.rootStore?.accountStore?.address,defiPlatformId:t.defiPlatformId,tradeMode:xs.SWAP},[o,r]=await _(E.post(Jn,{...e}));return o&&(k.error(v.INTENT_ORDER_CREATE_ERROR,{error:o}),H.error({title:o?.error_message||h("swaptrade_trading_mode_alert_order_fail")})),ke({...V(),order_id:r?.data?.orderId,wallet_type:this.rootStore?.accountStore.walletConfig?.walletType}),[o,r]});n(this,"bridgeSumbitIntentOrder",async t=>{let{slippageStore:e,quoteStore:o,receiveAddressStore:r,fromToStore:s,accountStore:i}=this.rootStore,{quote:a,computedQuoteAmount:u}=o,{from:m,to:p}=s,{computedRealSlippageValue:S}=e,C=r?.receiveAddrObj?.specifiedAddress,R=S,D=a?.bestRoute?.bridge?.bridgeId,x=i?.address,dt={signature:t.signature,quote:t?.quote,defiPlatformId:t.defiPlatformId,receiveWalletAddress:C,fromChainId:m?.chainId,fromTokenAddress:m?.tokenContractAddress,fromAmount:u,toChainId:p.chainId,toTokenAddress:p.tokenContractAddress,toAmount:p.reverseReceiveAmount,walletAddress:x,bridgeId:D,minimumReceived:a?.bestRoute?.minimumReceived,slippage:R},[ot,lt]=await _(E.post(os,{...dt}));return ot&&(k.error(v.INTENT_ORDER_CREATE_ERROR,{error:ot}),H.error({title:ot?.error_message||h("swaptrade_trading_mode_alert_order_fail")})),ke({...V(),order_id:lt?.data?.orderId,wallet_type:this.rootStore?.accountStore.walletConfig?.walletType}),[ot,lt]});this.rootStore=t}},Qi=Dr;d();l();var Ui=Mo(["isConfirmLoading"],[]);var Mr=class extends Qi{constructor(e){super(e);n(this,"isConfirmLoading",!1);n(this,"setIsConfirmLoading",e=>{this.isConfirmLoading=e});n(this,"signIntentSwap",async(e,o)=>{let{signTransaction:r}=this.rootStore.sendTransactionStore,[s,i]=await r(o,e);return s&&(k.error(v.INTENT_SWAP_SIGN_ERROR,{error:s,msg:{chainId:e,unsignedTx:o}}),H.error({title:h("swaptrade_trading_mode_alert_order_fail")})),[s,i]});n(this,"onIntentSwap",async()=>{let{fromToStore:e}=this.rootStore;if(e?.computedIsCrossChain){await this.onIntentBridgeOrder();return}await this.onIntentSwapOrder()});n(this,"onIntentSwapOrder",async()=>{this.setIsConfirmLoading(!0),k.keepLive();let{swapStore:e,quoteStore:o}=this.rootStore,r=g(o,"quote.bestRoute.fromToken.chainId");try{let{offlineType:s,calldata:i,defiPlatformId:a}=o?.quote?.bestRoute||{},{quote:u,unsignedTx:m}=i||{};if(!u||!m)return;let[p,S]=await this.signIntentSwap(r,m);if(p)return;let[C,R]=await this.createIntentOrder({quote:u,offlineType:s,signature:S,defiPlatformId:a});if(C)return;e.afterTransaction(R.data?.orderId)}catch(s){k.error(v.INTENT_SWAP_PROCESS_ERROR,{error:s})}finally{this.setIsConfirmLoading(!1),k.removeKeep()}});n(this,"onIntentBridgeOrder",async()=>{this.setIsConfirmLoading(!0),k.keepLive();let{swapStore:e,quoteStore:o}=this.rootStore,r=g(o,"quote.bestRoute.fromToken.chainId");try{let{bridge:s}=o?.quote?.bestRoute||{},{calldata:i,defiPlatformId:a}=s||{},{quote:u,unsignedTx:m}=i||{};if(!u||!m)return;let[p,S]=await this.signIntentSwap(r,m);if(p)return;let[C,R]=await this.bridgeSumbitIntentOrder({quote:u,signature:S,defiPlatformId:a});if(C)return;e.afterTransaction(R.data?.orderId)}catch(s){k.error(v.INTENT_SWAP_PROCESS_ERROR,{error:s})}finally{this.setIsConfirmLoading(!1),k.removeKeep()}});ro(this,Ui)}},zo=Mr;d();l();w();d();l();w();d();l();w();w();var Fr=class{constructor(t){n(this,"rootStore");this.rootStore=t}checkBridgeZeroValue(){let t=null,o=this.rootStore.quoteStore.quote?.bestRoute,{fromTokenPrice:r,toTokenPrice:s,fromToken:i,toToken:a}=o||{};return!Number(r)&&!Number(s)?t=i.tokenSymbol===a.tokenSymbol?N.ALIKE_TOKEN_SYMBOL_PRICE_UNKNOWN:N.ALL_TOKEN_PRICE_UNKNOWN:Number(r)?Number(s)||(t=N.TO_TOKEN_PRICE_UNKNOWN):t=N.FROM_TOKEN_PRICE_UNKNOWN,{errorType:t,continueToNextInterceptor:!1}}checkZeroValue(){let t=null,o=this.rootStore.quoteStore.quote?.bestRoute,{fromTokenValue:r,toTokenValue:s,fromToken:i,toToken:a}=o||{};return!Number(r)&&!Number(s)?t=i.tokenSymbol===a.tokenSymbol?N.ALIKE_TOKEN_SYMBOL_PRICE_UNKNOWN:N.ALL_TOKEN_PRICE_UNKNOWN:Number(r)?Number(s)||(t=N.TO_TOKEN_PRICE_UNKNOWN):t=N.FROM_TOKEN_PRICE_UNKNOWN,{errorType:t,continueToNextInterceptor:!1}}checkValueDifference(){let t=null,{fromToStore:e}=this.rootStore,{computedValueDifference:o,computedIsCrossChain:r}=e;return o.showValueDiffDialog&&(t=r?N.VALUE_DIFFERENCE_TOO_MUCH_CROSS:N.VALUE_DIFFERENCE_TOO_MUCH),{errorType:t,continueToNextInterceptor:!1}}checkMinReceive(){let t=null,e=this.rootStore.quoteStore,o=this.rootStore.slippageStore;return e?null:(o?.computedMinimumReceivedIsOrange&&(t=N.MIN_RECEIVED_TOO_SMALL),{errorType:t,continueToNextInterceptor:!1})}checkRepeatOrderWithEnoughBalance(){let t=null,{swapCheckStore:e}=this.rootStore,{repeatOrder:o}=e;return o?.enoughFlag===hr.ENOUGH&&(t=N.REPEAT_ORDER),{errorType:t,continueToNextInterceptor:!1}}async checkBlockedRepeatOrder(){let t=null,{swapCheckStore:e}=this.rootStore;await e.checkRepeatOrder();let{repeatOrder:o}=e;return o&&(o.repeatFlag===Te.BTC_REPEAT?t=N.REPEAT_ORDER_BTC:o.enoughFlag!==hr.ENOUGH&&(t=N.REPEAT_ORDER_NOT_ENOUGH)),{errorType:t,continueToNextInterceptor:!1}}checkCrossChain(){let t=null;return this.rootStore.fromToStore.computedNeedCrossChainDoubleConfirm&&!b.get(Cn)&&(t=N.CROSS_CHAIN_DOUBLE_CONFIRM),{errorType:t,continueToNextInterceptor:!1}}checkGasMoreThanReceive(){let t=null,{fromToStore:e,quoteStore:o}=this.rootStore,{computedIsCrossChain:r}=e,s=o.quote?.bestRoute,{toTokenPrice:i,quoteNetWorkFeeOfMoney:a,fromSwapFeeUsd:u}=s||{},{BigNumber:m}=I;return(r?new m(u):new m(a)).gte(new m(i))&&(t=N.GAS_MORE_THAN_RECEIVE_VALUE),{errorType:t,continueToNextInterceptor:!1}}checkToSwapThanGasFee(){let t=null,{fromToStore:e,quoteStore:o}=this.rootStore,{computedHasToSwap:r}=e,s=Number(e.to.chainId)===1;if(r&&s){let i=g(o,"quote.bestRoute.toSwapFeeUsd"),a=g(o,"quote.bestRoute.bridge.bridgeAmountOutUsd"),u=g(o,"quote.bestRoute.bridge.toRiskLimit");I.BigNumber(i).dividedBy(a).gte(u)&&(t=N.TO_SWAP_THAN_GAS_FEE)}return{errorType:t,continueToNextInterceptor:!1}}checkVolatilitySlippage(){let t=null,o=this.rootStore.slippageStore.computedVolatilityTips?.swapInterceptorType;return o&&(t=o),{errorType:t,continueToNextInterceptor:!0}}async checkBtcBalance(){let{fromToStore:t,safeMoonStore:e}=this.rootStore,{computedIsFromBtcCoin:o,from:r,updateBtcFromBalance:s}=t;if(o){if(!await s())throw Error("btc balance update failed");let a=e.computedInputVal,u=r.availableBalance;if(I.BigNumber(a).gt(u))return{errorType:N.BTC_AVAILABLE_BALANCE_NOT_ENOUGH,continueToNextInterceptor:!1}}return null}async checkCrossChainSwap(){let{swapCheckStore:t}=this.rootStore;await t.checkCrossChainSwap();let e=t.checkSwapMoreInfo?.errorCode;return on(e)&&e!==0?e===4&&b.get(`${So}_${t.checkSwapMoreInfo?.contentTip?.extra?.bridgeName}_${e}`)||b.get(`${So}_${e}`)?null:{errorType:N.CHECK_CROSS_MORE,continueToNextInterceptor:!1}:null}async checkThirdPartyProvider(){let{quoteStore:t}=this.rootStore,{computedIsOkxProvider:e}=t,o=b.get(`${So}_${Tn}`);return!e&&!o?{errorType:N.THIRD_PARTY_PROVIDER,continueToNextInterceptor:!0}:null}async checkBridgeThirdPartyProvider(){let{quoteStore:t}=this.rootStore,{computedBridgeIsOkxProvider:e,computedIsOfflineType:o}=t;return!e&&o?{errorType:N.THIRD_PARTY_PROVIDER,continueToNextInterceptor:!0}:null}async checkDisclaimerVisible(){return Vs()?{errorType:N.DISCLAIMER_VISIBLE,continueToNextInterceptor:!0}:null}makeCheckers(){let{fromToStore:{computedIsCrossChain:t}}=this.rootStore;return t?[this.checkDisclaimerVisible,this.checkBridgeThirdPartyProvider,this.checkVolatilitySlippage,this.checkCrossChainSwap,this.checkBtcBalance,this.checkBridgeZeroValue,this.checkToSwapThanGasFee,this.checkValueDifference,this.checkMinReceive,this.checkGasMoreThanReceive]:[this.checkDisclaimerVisible]}async check(){let t=[],e=this.makeCheckers();for(let o=0;o<e.length;o++){let r=e[o],{errorType:s,continueToNextInterceptor:i}=await r.call(this)||{};if(s&&(t.push(s),!i))return t}return t}},Gi=Fr;d();l();w();var Ya=()=>{let{quoteStore:c}=y(),t=c.enableQuoteAggregates?g(c,"quote.bestRoute"):null;return g(t,"defiPlatformId")===it?h("swaptrade_trade_placeholder_okxdex"):g(t,"name")},xr=({disabled:c,isUnApproved:t})=>{let{fromToStore:e,quoteStore:o}=y();if(t)return h("swaptrade_common_btn_approve_and_swap");let i=(o.enableQuoteAggregates?g(o,"quote.bestRoute"):null)?fn:c?Y:te;if(e.computedIsSingleChain){let a=Ya();return h(i,{provider:a})}return h(Sn)},Vi=()=>{let{commonStore:c,swapBtnStore:t,swapStore:e}=y();return c.portal===_n.MARKET?e.isConfirmLoading:t.swapBtnLoading};d();l();w();var Wi=()=>{let{accountStore:c}=y(),t=g(c,"walletConfig.isWCApp"),e=g(c,"walletConfig.isOkxConnect"),o=h("swaptrade_card_swap_modal_btn_confirming_in_your_wallet"),r=h("swaptrade_modal_confirm_swap_btn_confirming_in_app");return t||e?r:o};var Fe=class{constructor(t){n(this,"swapBtnErrorTipsDialog",null);n(this,"swapInterceptor");n(this,"isInterceptionProcessing",!1);n(this,"defaultTipsDialogInfo",()=>({type:"",visible:!1,confirmCallBack:()=>{}}));n(this,"notShowAgainCrossChainConfirm",!1);n(this,"setNotShowAgainCrossChainConfirm",t=>{this.notShowAgainCrossChainConfirm=t});n(this,"tipsDialogInfo",this.defaultTipsDialogInfo());n(this,"swapBtnLoading",!1);n(this,"showErrorTips",(t,e)=>{this.tipsDialogInfo={type:t,visible:!0,confirmCallBack:e},this.setNotShowAgainCrossChainConfirm(!1)});n(this,"closeErrorTipsDialog",()=>{this.swapBtnLoading=!1,this.tipsDialogInfo.visible=!1});n(this,"openConfirmSwapDialog",(t,e)=>{let{swapStore:o}=this,{receiveAddressStore:r}=this.rootStore;r.saveWalletAddressToStorage(e),o.setConfirmSwapVisible(!0)});n(this,"connectWallet",()=>{});n(this,"approve",()=>{});n(this,"cancelApprove",()=>{});n(this,"swap",()=>{});n(this,"clickSwapOnDapp",()=>{let{from:t,to:e,computedIsSingleChain:o}=this.fromToStore,{computedNotThirdBiz:r}=this.commonStore;Po({business_type:o?"swap":"bridge",trade_dialog:r?"no":"yes",from_token_address:t.tokenContractAddress,to_token_address:e.tokenContractAddress,swap_type:o?"discover_swap":"discover_cross_chain_swap",from_chain:t.chainName,to_chain:e.chainName}),this.rootStore.swapDappStore?.showDappPanel()});n(this,"checkDappTrade",()=>{let t=this.rootStore.swapDappStore?.checkShouldJumpToDapp;return typeof t=="function"&&t()?ge:null});n(this,"checkBlackAddress",()=>{let{quoteStore:t}=this.rootStore,{quoteError:e}=t.quote;return e?.error_code===Rn?Y:null});n(this,"checkShowLimitRegion",()=>this.checkDappTrade()?null:Wo.computedIsLimitRegion?Y:null);n(this,"isQuoting",()=>{let{fromToStore:t,quoteStore:e,slippageStore:o}=this.rootStore,{isFetchQuoting:r,bestRoute:s,quoteError:i,quoteNull:a}=e.quote,{from:u,to:m,computedTypedValue:p}=t,{tokenContractAddress:S}=u,{computedRealSlippageValue:C}=o;return a||!s&&i&&!r||!p||!m.tokenContractAddress||!S||C>50||C<0?Y:null});n(this,"isHoneypot",()=>this.rootStore?.safeMoonStore?.computedHoneypot?Y:null);n(this,"noAmountOrOverLimit",()=>{let{fromToStore:t}=this,{overLimit:e}=this.rootStore?.safeMoonStore?.computedSlippageTips||{},{computedTypedValue:o}=t;return Number(o)===0||e?Y:null});n(this,"hasFeeConfigErrorTips",()=>this.outerStore.computedFeeConfigErrorTips?Y:null);n(this,"uninitializedWalletInfo",()=>{let{accountStore:{hasInitWalletInfo:t}}=this;return t?null:Y});n(this,"unConnectedWallet",()=>{let{accountStore:{isConnectedWallet:t,hasInitWalletInfo:e}}=this;return!t&&e?fe:null});n(this,"nonsupportChain",()=>{let{accountStore:{computedNonsupportChain:t}}=this;return t?Y:null});n(this,"checkReceiveAddressStatus",()=>{let{fromToStore:{computedDiffCrossChain:t}}=this,{receiveAddressStore:{checkReceiveAddressLoading:e,computedSwapHighLight:o}}=this.rootStore;return t&&!o||e?Y:null});n(this,"interceptionProcessing",()=>{let{fromToStore:t}=this;return!this.isInterceptionProcessing&&t.isBalanceLoading||t.fromBalanceState===fo.BALANCE_REQUEST_FAILED?Y:null});n(this,"balanceLessThenInputAmount",()=>this.computedTooBalance?lo:null);n(this,"approveStatus",()=>{let{fromToStore:t,quoteStore:e,approveStore:{getApprovalStatus:o}}=this,{from:r,computedIsCrossChain:s}=t,i=g(e,"quote.bestRoute"),a=z.getCurrentRouteDefiPlatformId(s,i),u=o(r,a);return pr[u]||null});n(this,"isValidAmount",()=>{let{fromToStore:t}=this,{from:e,to:o}=t;return o.amount&&e.amount?te:null});n(this,"getBtnStatus",()=>{let t=[this.checkBlackAddress,this.checkShowLimitRegion,this.hasFeeConfigErrorTips,this.unConnectedWallet,this.nonsupportChain,this.checkDappTrade,this.checkReceiveAddressStatus,this.noAmountOrOverLimit,this.interceptionProcessing,this.balanceLessThenInputAmount,this.isQuoting,this.approveStatus,this.isValidAmount],e;for(let o of t){let r=o();if(r){e=r;break}}return e||(e=Y),e});n(this,"checkIsCurrentQuote",()=>(this.computedIsCurrentQuote||H.warn({title:h("swaptrade_mid_toast_tryagain_with_newquote")}),this.computedIsCurrentQuote));let{accountStore:e,fromToStore:o,swapStore:r,commonStore:s,quoteStore:i,approveStore:a}=t;this.rootStore=t,this.accountStore=e,this.fromToStore=o,this.swapStore=r,this.commonStore=s,this.quoteStore=i,this.approveStore=a,this.swapInterceptor=new Gi(t),Object.assign(this,t)}async runSwapInterceptor(t){this.isInterceptionProcessing=!0;let[e,o]=await _(this.swapInterceptor.check());if(this.isInterceptionProcessing=!1,e){k.error(v.UPDATE_BTC_BALANCE_ERROR_BEFORE_SWAP,{error:e});return}if(o.length===0){t();return}let r=-1,s=()=>{r++;let i=r===o.length-1;this.showErrorTips(o[r],i?t:s)};s()}getBtnAllStatus({from:t,toUsdPrice:e}){return{[fe]:{statusType:fe,disabled:!1,toLocaleText:()=>h(fe),onClick:this.connectWallet},[lo]:{statusType:lo,disabled:!this.fromToStore.computedShowAddFund||re(),toLocaleText:()=>h(ai["FILL_UP"],{token:q(t.tokenSymbol)}),onClick:()=>{this.fromToStore.onClickAddFunds()},symbol:t.tokenSymbol},[po]:{statusType:po,disabled:!1,toLocaleText:()=>h(po,{tokenSymbol:q(t.tokenSymbol)}),onClick:()=>{this.quoteStore.setAggregateSelectStatus(1),this.approve()},icon:"okx-defi-dex-authorization",iconType:eo.ICON_POSITION.leading},[Se]:{statusType:Se,loading:!0,disabled:!0,toLocaleText:()=>h(Se)},[lr]:{statusType:Se,disabled:!1,toLocaleText:()=>h(lr,{ccy:t.tokenSymbol}),onClick:this.cancelApprove,icon:"okx-defi-dex-authorization",iconType:eo.ICON_POSITION.leading},[ho]:{statusType:ho,loading:!0,disabled:!0,toLocaleText:()=>h(ho)},[Y]:{statusType:Y,disabled:!0,toLocaleText:()=>xr({disabled:!0,toUsdPrice:e})},[te]:{statusType:te,disabled:!1,loading:Vi(),toLocaleText:()=>{let r=this.approveStatus()===pr[ut.UnApproved];return xr({disabled:!1,isUnApproved:r})},toLoadingLocaleText:()=>Wi(),onClick:o=>{this.quoteStore.setAggregateSelectStatus(1),o?this.swap(o):this.swap()}},[ge]:{statusType:ge,disabled:!1,loading:this.rootStore.swapDappStore?.swapOnDappBtnLoading,toLocaleText:()=>h(ge),icon:"okds-open-link",iconType:eo.ICON_POSITION.leading,onClick:this.clickSwapOnDapp}}}get needToCrossChainDoubleCheck(){return!0}get computedTooBalance(){let{rootStore:t,fromToStore:e,accountStore:o}=this,{isConnectedWallet:r}=o,s=e.from.balance,i=t.safeMoonStore.computedInputVal;return r?I.BigNumber(s||0).isLessThan(i):!1}get computedBtnStatus(){let{fromToStore:t}=this,{from:e,to:o}=t,r=this.getBtnStatus();return this.getBtnAllStatus({from:e,swapLoading:this.swapBtnLoading,toUsdPrice:g(o,"usdPrice")})[r]}get computedIsCurrentQuote(){let{fromToStore:t,quoteStore:e}=this,{computedIsExactIn:o,computedTypedValue:r}=t,{quote:s,getGasTokenFeeLoading:i,quotePending:a}=e,{fromTokenAmount:u="",inputToTokenAmount:m=""}=s?.bestRoute||{},p=!!r,S=p&&o&&I.BigNumber(r).isEqualTo(u),C=p&&!o&&I.BigNumber(r).isEqualTo(m);return!i&&(S||C)&&!a}};d();l();var Yi=Mo(["tipsDialogInfo","notShowAgainCrossChainConfirm","isInterceptionProcessing","swapBtnLoading"],["computedTooBalance","computedBtnStatus","computedIsCurrentQuote"]);d();l();var Br=()=>{let{accountStore:c}=y();Ss({wallet_address:c.address,...Ys()})};var Vt=class extends Fe{constructor(e){super(e);n(this,"handleSwap",async e=>{let{quote:o,computedIsOfflineType:r}=this.quoteStore,{receiveAddressStore:s,swapStore:i}=this.rootStore,{from:a,cacheTokenInfo:u}=this.fromToStore;this.swapBtnLoading=!0,this.walletContractStore.setQuoteData(o.bestRoute),k.info(v.CLICK_WALLET_SWAP_BUTTON,{chainId:a.chainId,tokenContractAddress:vo(a.tokenContractAddress),amountNum:a.balance}),I.eq(a.balance,u.amountNum)||k.info(v.BALANCE_IS_ERROR,{chainId:a.chainId,tokenContractAddress:vo(a.tokenContractAddress),amountNum:a.balance,cacheTokenInfo:{...u,tokenContractAddress:vo(u.tokenContractAddress)}});let{fromToken:m}=he.get(o,"bestRoute",{});if(r){if(Bs(o?.bestRoute?.structureType)&&i.isSwapSolana(m.chainId)&&await this.walletContractStore.handleSolanaOfflineData(o?.bestRoute))return}else{let S=await this.walletContractStore.fetchCallData(e);if(this.swapBtnLoading=!1,S)return}this.swapBtnLoading=!1;let p=r?Ct.INTENT_SWAP:Ct.SWAP;if(s.saveWalletAddressToStorage(this.fromToStore?.to),i.isSwapSolana(m.chainId)){L.history?.push({pathname:co});return}if(this.walletContractStore.approvePayload){L.history?.push({pathname:ao});return}L.history?.push({pathname:Jt,search:`needUpdate=${In.on}&type=${p}`})});n(this,"swap",async e=>{console.log("swap===>",e);let o=this.checkIsCurrentQuote(),{fromToStore:r,quoteStore:s}=this,{from:i,to:a}=r;Po({wallet_address:this.accountStore.address,button_name:"confirm",...V()});let u=he.get(s,"quote.bestRoute.serviceFeeInfo.serviceFeeUsd","0");fs({fee_shown:u,from_token_symbol:i?.tokenSymbol,to_token_symbol:a?.tokenSymbol,from_to_pair_symbol:`${i?.tokenSymbol}:${a?.tokenSymbol}`,input_amount_usd:i?.usdPrice,source:ps()?.source,terminal:Es.Plugin,selected_chain_id:i?.chainId,auto_confirm_enter:"off",chain_name:i?.chainName}),o&&(this.swapBtnLoading=!0,this.runSwapInterceptor(()=>{this.handleSwap(e)}))});n(this,"approve",async()=>{let{fromToStore:e,quoteStore:o}=this.rootStore,r=he.get(o,"quote.bestRoute"),s=z.getCurrentRouteDefiPlatformId(e.computedIsCrossChain,r),i=e.from;this.approveStore.updateApproveTokenConfig(i,s,{status:ut.Approving}),Br(),this.approveStore.setApprove()});n(this,"cancelApprove",async()=>{let{fromToStore:e,quoteStore:o}=this.rootStore,r=he.get(o,"quote.bestRoute"),s=z.getCurrentRouteDefiPlatformId(e.computedIsCrossChain,r),i=e.from;this.approveStore.updateApproveTokenConfig(i,s,{status:ut.CancelApproving}),Br(),this.approveStore.setApprove(To.CANCEL_APPROVE)});this.walletContractStore=e.walletContractStore,ro(this,Yi)}};d();l();w();w();d();l();w();w();d();l();d();l();var Ki=function(){return new Promise(function(t){setTimeout(t,1)})};d();l();var me=O(Q());d();l();var Ka={["SWAP"]:"swap_used_chain_cache",["LIMIT_ORDER"]:"limit_used_chain_cache",["BRIDGE"]:"bridge_used_chain_cache"},ji="USED_CHAIN_CACHE",Jo=4,ja=c=>{let t=Ka[c],e=b.get(t)||[],o=b.get(ji)||[];return e.length!==0&&b.remove(t),o.filter(Boolean)},$a=({selectedChainIdList:c,chainList:t,cacheChainIdList:e})=>{t.sort((m,p)=>Number(p.popularWeight)-Number(m.popularWeight));let o=t.find(m=>m?.needTop)?.chainId,r=t.map(m=>m.chainId);if(e.length===0){let m=r.slice(0,Jo);if(o){let p=m.indexOf(o);p>-1&&m.splice(p,1),m.unshift(o)}return{sortedChainList:m.slice(0,Jo),cacheChainIds:r}}let s=new Set(r),i=e.filter(m=>s.has(m)),a=[...e],u=[...i.slice(0,Jo)];if(c.forEach(m=>{if(u.includes(m)||!m)return;let p=a.indexOf(m);p>-1&&a.splice(p,1),u.unshift(m),a.unshift(m)}),o){let m=u.indexOf(o);m>-1&&u.splice(m,1),u.unshift(o);let p=a.indexOf(o);p>-1&&a.splice(p,1),a.unshift(o)}return{sortedChainList:u.slice(0,Jo),cacheChainIds:a}},$i=(c,t,e)=>{k.info(v.GET_CHAINLIST_BY_STORAGE,{data:{fromAndToChainIdList:c,isChainListEmpty:t.length===0,hasUndefinedChain:t.some(i=>!i?.chainId),currentTab:e}});let o=ja(e),{sortedChainList:r,cacheChainIds:s}=$a({selectedChainIdList:c,chainList:t,cacheChainIdList:o});return b.set(ji,s.filter(Boolean)),r.filter(Boolean)};d();l();var xe=class{constructor(t){n(this,"id",1);n(this,"tokenSymbol","--");n(this,"tokenName","--");n(this,"decimals",6);n(this,"tokenContractAddress","");n(this,"tokenLogoUrl","");n(this,"type","");n(this,"amountNum",0);n(this,"currencyAmount",0);P(this),Object.assign(this,t),this.tokenModalStore=y().tokenModalStore}get computedPrice(){let{nowCurrencyUnit:t}=this.tokenModalStore.commonStore,{symbol:e,usdToThisRate:o}=t,r=I.BigNumber(this.currencyAmount);return r.isNaN()||r.isZero()?`${e||""}0.00`:e&&o&&!r.isNaN()&&!r.isZero()?Nt(r.multipliedBy(o).toJSON(),e):"0"}get computedIsSelect(){let{equalsToken:t}=this.tokenModalStore.commonStore,{from:e,to:o}=this.tokenModalStore.fromToStore;return this.tokenModalStore.tokenModalFromState===T.FROM?t(this,o):t(this,e)}get computedIsSelectOrigin(){let{from:t,to:e}=this.tokenModalStore.fromToStore,{equalsToken:o}=this.tokenModalStore.commonStore;return this.tokenModalStore.tokenModalFromState===T.FROM?o(this,t):o(this,e)}get computedAmountNum(){return this.amountNumBigDecimal!==""?this.amountNum:0}toJSON(){return st(this)}get computedTokenVolume(){let{currencyConversion:t,computedNowCurrencySymbol:e}=this.tokenModalStore.commonStore;return this.volume?_r(t(this.volume).toString(),{currencySign:e}).value:"--"}get computedTokenLiquidity(){let{currencyConversion:t,computedNowCurrencySymbol:e}=this.tokenModalStore.commonStore;return this.liquidity?_r(t(this.liquidity).toString(),{currencySign:e}).value:"--"}};d();l();var Be=(c={})=>({...B,logoUrl:B.logoUrl(),chainName:h(B.localKey),...c}),Zo=(c={})=>{let t=cn();return{...X,get logoUrl(){return t===an.dark?X.darkLogoUrl():X.logoUrl()},chainName:h(X.localKey),...c}};var Xi="hide_collect_cancel_dialog",zi="hideTokenGuide",Wt=class{constructor(t){n(this,"searchValue","");n(this,"setSearchValue",t=>{this.searchValue=t});n(this,"fromTokenList",new Map);n(this,"toTokenList",new Map);n(this,"searchTokenList",{});n(this,"currentCollectionGroupId");n(this,"setCurrentCollectionGroupId",t=>{this.currentCollectionGroupId=t});n(this,"setCurrentCollectionGroupIdAndGetList",t=>{t&&t===this.currentCollectionGroupId||(this.setCurrentCollectionGroupId(t),this[`${this.tokenModalFromState}TokenList`].set(B.chainId),this.getTokenListByChainId().then(rt).catch(rt))});n(this,"error",!1);n(this,"tokenModalVisible",!1);n(this,"tokenModalFromState",T.FROM);n(this,"setTokenModalFromState",t=>{this.tokenModalFromState=t});n(this,"loading",{[T.FROM]:{},[T.TO]:{}});n(this,"initLoading",()=>{this.loading={[T.FROM]:{},[T.TO]:{}}});n(this,"importTokenInfo",{});n(this,"setImportTokenInfo",t=>{this.importTokenInfo={...t}});n(this,"toSelectedChainId","");n(this,"fromSelectedChainId","");n(this,"setToSelectedChainId",t=>{this.toSelectedChainId=t});n(this,"setFromSelectedChainId",t=>{this.fromSelectedChainId=t});n(this,"fromSelectedChainAtSearch","");n(this,"toSelectedChainAtSearch","");n(this,"setFromSelectedChainAtSearch",t=>{this.fromSelectedChainAtSearch=t});n(this,"setToSelectedChainAtSearch",t=>{this.toSelectedChainAtSearch=t});n(this,"updateSelectedChainAtSearch",t=>{this.tokenModalFromState===T.FROM?this.setFromSelectedChainAtSearch(t):this.setToSelectedChainAtSearch(t)});n(this,"updateFromToSelectedChainIdAfterSearch",()=>{if(this.tokenModalFromState===T.FROM&&this.fromSelectedChainAtSearch!==this.fromSelectedChainId){this.setFromSelectedChainId(this.fromSelectedChainAtSearch);return}this.tokenModalFromState===T.TO&&this.toSelectedChainAtSearch!==this.toSelectedChainId&&this.setToSelectedChainId(this.toSelectedChainAtSearch)});n(this,"extendTokens",(t,e)=>t.filter(o=>this.commonStore.getChainByID(U(o.chainId))).map(o=>{let r=new xe(o,this);return{...o,balance:r.computedAmountNum,selected:r.computedIsSelect,selectedOrigin:e?r.computedIsSelectOrigin:!1,price:r.computedPrice,formattedVolume:r.computedTokenVolume,formattedLiquidity:r.computedTokenLiquidity}}));n(this,"extendTokenList",(t=[],e=!0)=>J(t)?t:this.extendTokens(t,e));n(this,"importUserToken",Tt(function*(e,o=!0){let r=e.map(a=>{let{chainId:u,tokenContractAddress:m,tokenSymbol:p,decimals:S}=a;return{chainId:u,contractAddress:m,tokenSymbol:p,precision:S}}),s={userUniqueId:this.commonStore.userUniqueId,tokenDetailList:r},i=[];try{i=(yield E.post(Pn,s)).data}catch(a){throw H.error(h("swaptrade_pricechart_no_connection_desc")),a}return o&&(this.searchValue="",this.changeTokenModalVisible(!1)),i}));n(this,"sortTokens",t=>nn(t,[e=>Number(e.topPlacement),e=>Number(e.currencyAmount),e=>Number(e.amountNum),e=>Number(e.isCollectToken),e=>Number(e.collectTime)],["desc","desc","desc","desc","desc"]));n(this,"orderTokenList",t=>this.computedIsCollectChain?t:this.commonStore.currentTab===A.BRIDGE?t.map(e=>({...e,tokenList:this.sortTokens(e.tokenList)})):this.sortTokens(t));n(this,"formatTokenList",(t,e,o=!1)=>{let r=t;t.length>100&&e!==B.chainId&&(r=t.slice(0,100)),o&&(r=Yo.filterHiddenTokenList(r));let s=this.extendTokenList(r,!0);return this.orderTokenList(s)});n(this,"changeTokenModalVisible",t=>{this.tokenModalVisible=t});n(this,"clearCacheTokenList",()=>{});n(this,"getTokenListByChainId",async()=>{let t=this.tokenModalFromState===T.FROM,e={};if(this.clearCacheTokenList(),this.tokenModalFromState===T.FROM?e={fromChainId:this.fromSelectedChainId}:this.tokenModalFromState===T.TO&&(e={fromChainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainId}),this.tokenModalFromState===T.FROM&&Number(this.fromSelectedChainId)===X.chainId){this.getFromAllNetworksTokens();return}if(this.tokenModalFromState===T.TO&&Number(this.toSelectedChainId)===X.chainId){this.getToAllNetworksTokens(e.fromChainId);return}if(this.tokenModalFromState===T.FROM&&Number(this.fromSelectedChainId)===B.chainId){this.getFromCollectedTokens();return}if(this.tokenModalFromState===T.TO&&Number(this.toSelectedChainId)===B.chainId){this.getToCollectedTokens(e.fromChainId);return}t?this.getTokenList(T.FROM,e.fromChainId):this.getTokenList(T.TO,e.toChainId,e.fromChainId)});n(this,"setTokenList",(t,e,o,r=!1)=>{let s=this.formatTokenList(e,t,r);this[`${o}TokenList`].set(t,s)});n(this,"cancelGetTokenListRef",null);n(this,"handleTokenList",Tt(function*(e){let{field:o,chainId:r,url:s,params:i,enableSmallAssetFilter:a,enableHiddenTokenFilter:u}=e;this.setError(!1),this.cancelGetTokenListRef&&this.cancelGetTokenListRef.abort(),this[`${o}TokenList`].get(r)||this.setLoading(o,r,!0),this.cancelGetTokenListRef=kt();let m={...i};if(a){yield Yo.initializePromise;let p=Yo.getMinAmountThresholdParam();p!==void 0&&(m.minAmountThreshold=p)}try{let{data:p}=yield E.get(s,{params:m,signal:this.cancelGetTokenListRef?.signal,isolate:!0}),S=this.toLowerCaseContractAddress(p);return this.setTokenList(r,S,o,u),this.setLoading(o,r,!1),{data:S}}catch(p){return this.isCancel(p)?null:(this.setTokenList(r,[],o,!1),this.setLoading(o,r,!1),this.setError(!0),p)}}).bind(this));n(this,"getCrossChainParams",(t,e,o)=>{switch(t){case A.BRIDGE:return{fromChainId:e.fromChainId??e?.chainId,userUniqueId:e.userUniqueId,accountId:e.accountId,targetChainId:e.targetChainId,targetWalletAddress:e.targetWalletAddress,walletAddress:e.walletAddress,...o,toChainId:o.toChainId===-1?"":o?.toChainId};case A.SWAP:default:return e}});n(this,"getTokenList",Tt(function*(e,o,r){let s={fromChainId:r,chainId:o,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,walletAddress:this.accountStore.computedSignWalletAddress,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(s={...s,businessLine:oe.LIMIT_ORDER});let i=this.getCrossChainParams(this.commonStore.currentTab,s,{selectChainType:this.getCrossChainSelectChainType(),toChainId:this.computedCurrentToChainId,fromTokenAddress:this.fromToStore.from.tokenContractAddress||""}),a=U(o);if(this.computedIsNotSupportToChain)return this.setTokenList(a,[],e,!1),{data:[]};let u=qt(Bt.ALL_TOKENS,this.commonStore.currentTab);return yield this.handleTokenList({field:e,chainId:a,url:u,params:i,enableSmallAssetFilter:!0,enableHiddenTokenFilter:!0})}));n(this,"getFromCollectedTokens",Tt(function*(){let e={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:"",...this.computedCollectionGroupParams,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(e={...e,businessLine:oe.LIMIT_ORDER});let o=this.getCrossChainParams(this.commonStore.currentTab,e,{selectChainType:xt.FROM,toChainId:this.computedCurrentToChainId,fromTokenAddress:"",...this.computedCollectionGroupParams}),r=qt(Bt.COLLECT_LIST,this.commonStore.currentTab);return yield this.handleTokenList({field:T.FROM,chainId:B.chainId,url:r,params:o,enableSmallAssetFilter:!1,enableHiddenTokenFilter:!1})}));n(this,"getToCollectedTokens",Tt(function*(e){let o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:e,chainId:e,...this.computedCollectionGroupParams,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(o={...o,businessLine:oe.LIMIT_ORDER});let r=this.getCrossChainParams(this.commonStore.currentTab,o,{selectChainType:xt.TO,toChainId:"",fromTokenAddress:this.fromToStore.from.tokenContractAddress,...this.computedCollectionGroupParams}),s=qt(Bt.COLLECT_LIST,this.commonStore.currentTab);return yield this.handleTokenList({field:T.TO,chainId:B.chainId,url:s,params:r,enableSmallAssetFilter:!1,enableHiddenTokenFilter:!1})}));n(this,"getFromAllNetworksTokens",Tt(function*(){let e={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:"",walletAddress:this.accountStore.computedSignWalletAddress,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(e={...e,businessLine:oe.LIMIT_ORDER});let o=qt(Bt.ALL_NETWORK,this.commonStore.currentTab),r=this.getCrossChainParams(this.commonStore.currentTab,e,{selectChainType:xt.FROM,toChainId:this.computedCurrentToChainId,fromTokenAddress:""});return yield this.handleTokenList({field:T.FROM,chainId:X.chainId,url:o,params:r,enableSmallAssetFilter:!0,enableHiddenTokenFilter:!0})}));n(this,"getToAllNetworksTokens",Tt(function*(e){let o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:e,walletAddress:this.accountStore.computedSignWalletAddress,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(o={...o,businessLine:oe.LIMIT_ORDER});let r=qt(Bt.ALL_NETWORK,this.commonStore.currentTab),s=this.getCrossChainParams(this.commonStore.currentTab,o,{selectChainType:xt.TO,toChainId:"",fromTokenAddress:this.fromToStore.from.tokenContractAddress});return yield this.handleTokenList({field:T.TO,chainId:X.chainId,url:r,params:s,enableSmallAssetFilter:!0,enableHiddenTokenFilter:!0})}));n(this,"cancelSearchRef",null);n(this,"needRemoveChainId",t=>[X.chainId,B.chainId].includes(U(t)));n(this,"getSearchChainType",()=>{let t=go.SINGLE;return this.computedCurrentSearchChainId===X.chainId&&(t=go.ALL_NETWORK),this.computedCurrentSearchChainId===B.chainId&&(t=go.COLLECT),t});n(this,"getCrossChainSelectChainType",()=>this.tokenModalFromState===T.FROM?xt.FROM:xt.TO);n(this,"singleSearchParams",t=>{let e=this.getSearchChainType(),o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,chainType:e,searchType:e,walletAddress:this.accountStore.computedSignWalletAddress,...this.computedAdresses},r={},s={};return this.tokenModalFromState===T.FROM?(r={inputContent:t,fromChainId:this.fromSelectedChainAtSearch,chainId:this.fromSelectedChainAtSearch,toChainId:this.fromSelectedChainAtSearch},this.needRemoveChainId(this.fromSelectedChainAtSearch)&&(delete r.fromChainId,delete r.toChainId,delete r.chainId)):this.tokenModalFromState===T.TO&&(s={inputContent:t,fromChainId:this.fromToStore.from.chainId,chainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainAtSearch,fromTokenAddress:this.fromToStore.from.tokenContractAddress||""},this.needRemoveChainId(this.toSelectedChainAtSearch)&&(delete s.toChainId,delete r.chainId)),{...o,...r,...s}});n(this,"getSearchTokenList",async()=>{if(this.searchValue==="")return;if(this.cancelSearchRef&&this.cancelSearchRef.abort(),this.computedIsNotSupportToChain){this.setSearchTokenList({}),this.setLoading(this.tokenModalFromState,"search",!1);return}this.cancelSearchRef=kt(),this.setLoading(this.tokenModalFromState,"search",!0),this.setError(!1);let t=ur(this.searchValue),e=this.getSearchParams(t);hs({keyword:t});let o=qt(Bt.SEARCH,this.commonStore.currentTab),[r,s]=await _(E.get(o,{params:e,signal:this.cancelSearchRef?.signal}));if(r&&!this.isCancel(r)){this.setError(!0),this.setSearchTokenList({}),this.setLoading(this.tokenModalFromState,"search",!1);return}if(s){let{data:i}=s;if(this.commonStore.currentTab===A.BRIDGE)this.setSearchTokenList({list:i});else{let{systemList:a,thirdPartyList:u}=s.data;this.setSearchTokenList({systemList:a,thirdPartyList:u})}this.updateFromToSelectedChainIdAfterSearch(),this.setError(!1),this.setLoading(this.tokenModalFromState,"search",!1)}});n(this,"resetTokenModal",()=>{this.resetTokenData()});n(this,"resetTokenData",()=>{this.searchTokenList={},this.searchValue=""});n(this,"balancePushSort",(t,e)=>{let o=[...t],{currencyAmount:r,coinAmountOriginalDec:s}=e;for(let i=0;i<o.length;i++)if(this.commonStore.equalsToken(o[i],e)){o[i].amountNum=s,o[i].currencyAmount=r;break}return o});n(this,"updateAllTokenList",t=>{let{chainId:e}=t,o=U(e),r=this.fromTokenList.get(o);r&&this.setTokenList(o,this.balancePushSort(st(r),t),T.FROM,!0);let s=this.toTokenList.get(o);s&&this.setTokenList(o,this.balancePushSort(st(s),t),T.TO,!0)});n(this,"checkFromToLegal",(t,e)=>{let{currentTab:o}=this.commonStore,r={toToken:{...e,amount:""},isChanged:!1};if(Number(t.chainId)!==Number(e.chainId)){if(this.computedToChain?.some(S=>S.chainId===e.chainId&&!S.disabled))return r;let{dexDefaultFromToTokenShowVO:s}=this.commonStore.getChainByID(this.fromToStore.from.chainId),{fromDexMultiTokenInfoVO:i,toDexMultiTokenInfoVO:a,toCrossDexMultiTokenInfoVO:u}=s,m=o===A.BRIDGE,p;return m&&u?p=u:this.commonStore.equalsToken(t,a)?p=i:p=a,{toToken:p,isChanged:!0}}return r});n(this,"calcCurToChainIdIsInSupList",t=>{let e=!1;return st(this.computedToChain).forEach(o=>{Number(o.chainId)===Number(t)&&!o.disabled&&(e=!0)}),e});n(this,"hideCollectCancelConfirm",b.get(Xi));n(this,"showCollectOverLimitDialog",!1);n(this,"setShowCollectOverLimitDialog",t=>{this.showCollectOverLimitDialog=t});n(this,"setCommonlyUsedChain",t=>{let{from:e,to:o}=this.fromToStore,{chainList:r,currentTab:s}=this.commonStore,i=t&&t.length>0?t:[e.chainId,o.chainId];return $i(i,r,s)});n(this,"tokenPageChainList",[]);n(this,"setTokenPageChainList",t=>{this.tokenPageChainList=t?.filter(Boolean)||[]});n(this,"getCurrentToChainInfo",()=>this.computedToChain.find(e=>U(e.chainId)===U(this.toSelectedChainId)));n(this,"changeTokenPageChainList",async t=>{if(this.tokenPageChainList.findIndex(o=>U(o.chainId)===U(t))===-1){let o=this.commonStore.chainList.find(i=>U(i.chainId)===U(t)),r=[...this.tokenPageChainList],s=r.findIndex(i=>i?.needTop);s>-1?r.splice(s+1,0,o):r.unshift(o),r.length>4&&r.pop(),this.setTokenPageChainList(r)}this.tokenModalFromState===T.FROM?this.setFromSelectedChainId(t):this.setToSelectedChainId(t),await this.getTokenListByChainId()});n(this,"searchChainKeywords","");n(this,"setSearchChainKeywords",t=>{this.searchChainKeywords=t});n(this,"filterChains",t=>tn(t,e=>{let o=cr(ur(this.searchChainKeywords));return cr(e.chainName).includes(o)}));n(this,"dialogIndex",Sr.TOKEN_LIST);n(this,"setDialogIndex",t=>{this.dialogIndex=t});n(this,"hideTokenGuide",!!b.get(zi));n(this,"setHideTokenGuide",()=>{this.hideTokenGuide=!0,b.set(zi,"1")});n(this,"importToken",async(t,e)=>{let r=(await this.importUserToken(Array.isArray(t)?t:[t]))[0]||{};e&&e(r),As(r)&&await this.fromToStore.getTokenBalanceByAccount(this.tokenModalFromState,r),this.setImportTokenInfo({}),this.setDialogIndex(Sr.TOKEN_LIST)});n(this,"reloadTokenList",async()=>{!this.tokenModalVisible||(this.searchValue!==""?await this.getSearchTokenList():await this.getTokenListByChainId())});n(this,"selectTokenHandle",async t=>{let e=this.commonStore.getChainByID(Number(t?.chainId));if(await Ki(),!e)return;let{quoteStore:o}=this.rootStore,{from:r,updateFrom:s,updateTo:i,setBalance:a,setFromBalanceRequestError:u,setToBalanceRequestError:m,to:p,computedIsExactIn:S,needCrossChainDoubleConfirm:C,setNeedCrossChainDoubleConfirm:R}=this.fromToStore,{clearReceiveAddressValue:D}=this.rootStore.receiveAddressStore;this.setCommonlyUsedChain([t?.chainId]);let x=this.tokenModalFromState===T.FROM,dt=()=>{this.rootStore.fromToStore.setCacheTokenInfo({chainId:t.chainId,tokenContractAddress:t.tokenContractAddress,amountNum:t.balance},"tokenList"),u(!1),a(T.FROM,t.balance)},ot=()=>{m(!1),a(T.TO,t.balance)};if(t.selected){x?ot():dt(),this.fromToStore.onSwitchFromTo();return}x?dt():ot();let lt=()=>{C||R(!0)};if(x){if(Ro(t.chainId,p.chainId)&&this.commonStore.currentTab===A.BRIDGE){let $t=new Pt(this.commonStore.currentTab,{}),[vt,pt]=await $t.fetchCrossChainTokens({fromChainId:t.chainId,fromTokenAddress:t.tokenContractAddress}),{amount:Zr}=r,ze={...t},pe;vt?(s({...ze,amount:Zr}),pe=e?.dexDefaultFromToTokenShowVO?.toCrossDexMultiTokenInfoVO,i({...pe})):(ze=pt.data.fromTokenInfo,pe=pt.data.toTokenInfo,s({...ze,amount:Zr}),i(pe),lt(),this.fromToStore.getTokenBalanceByAccount("from",ze)),this.fromToStore.getTokenBalanceByAccount("to",pe)}else if(!this.commonStore.equalsToken(t,r)){let{amount:$t}=r;o.setQuoteNumber(2),s({...t,riskLevel:t.riskLevel,amount:$t});let{toToken:vt,isChanged:pt}=this.checkFromToLegal(t,p);i(vt),pt&&(lt(),this.fromToStore.getTokenBalanceByAccount("to",st(vt))),S&&this.fromToStore.advanceSetTypedValue("")}}else this.commonStore.equalsToken(t,p)||(lt(),o.setQuoteNumber(0),i({...t,amount:""}),S||this.fromToStore.advanceSetTypedValue(""));D()});n(this,"updateTokenCollectionStatus",(t,e,o)=>{let r=!o?.length,s=this.currentCollectionGroupId&&!o.includes(this.currentCollectionGroupId);this.updateTokenCollectedLocal({...e,isCollectToken:r||s})});n(this,"memeTagConfig",{});n(this,"setMemeTagConfig",t=>{this.memeTagConfig=t});n(this,"fetchMemeTagConfig",async()=>{let[,t]=await _(E.get(ss)),e=t?.data?.tagAndEmojiMap||{};return this.setMemeTagConfig(e),e});this.rootStore=t,this.commonStore=t.commonStore,this.swapStore=t.swapStore,this.accountStore=t.accountStore,this.fromToStore=t.fromToStore}get computedIsSearching(){return!!this.searchValue}get computedCollectionGroupParams(){let t={accountId:this.accountStore.computedAccountId,walletAddress:this.accountStore.computedSignWalletAddress};return this.currentCollectionGroupId?{...t,groupId:this.currentCollectionGroupId}:t}get computedAdresses(){return g(this,"accountStore.computedMultiAddresses",{})}setSearchTokenList(t){this.searchTokenList=t}setError(t){this.error=t}setLoading(t,e,o){this.loading[t][e]=o}get computedTokenList(){return this.tokenModalFromState===T.FROM?this.fromTokenList.get(this.fromSelectedChainId):this.toTokenList.get(this.toSelectedChainId)}get computedSearchTokenList(){let t={};return J(this.searchTokenList)||(t={systemList:this.extendTokenList(this.searchTokenList?.systemList,!1),thirdPartyList:this.extendTokenList(this.searchTokenList?.thirdPartyList,!1)}),t}toLowerCaseContractAddress(t){let e=[];return Array.isArray(t)&&t.forEach(o=>{e.push({...o,tokenContractAddress:this.commonStore.getTokenAddress(o)})}),e}isCancel(t){return St(t)}getSearchParams(){throw new Error("getSearchParams method must be implemented by subclass")}get computedFromChain(){let t=Be(),e=Zo({});return[t,e,...st(this.tokenPageChainList)]}get computedToChain(){let t=Be();if(M(this.fromToStore.from.chainId)){let e=this.tokenPageChainList.filter(o=>o?.chainId===this.fromToStore.from.chainId);return[t,...e]}return[t]}get computedCurrentToChainId(){return this.toSelectedChainId||M(this.toSelectedChainId)?this.toSelectedChainId:M(this.fromToStore.to.chainId)?this.calcCurToChainIdIsInSupList(this.fromToStore.to.chainId)?this.fromToStore.to.chainId:this.fromToStore.from.chainId:this.computedToChain.length>1?X.chainId:ee}reassignTokenInfo(t,e,o){if(this.commonStore.equalsToken(t,e)){let r=e?.isCollectToken;return Ot({},e,{isCollectToken:r?0:1,collectTime:r?"":Date.now().toString(),isCustomToken:o?1:e?.isCustomToken})}return t}filterCollectToken(t){let e=!t.isCustomToken||t.balance;return!!(!this.computedIsCollectChain&&e||this.searchValue||t.isCollectToken)}updateTokenCollectedLocal(t){let e=(o=[],r=!1)=>o.map(s=>this.reassignTokenInfo(s,t,r)).filter(s=>this.filterCollectToken(s));if(this.searchValue){let{systemList:o,thirdPartyList:r}=this.searchTokenList;this.setSearchTokenList({systemList:e(o),thirdPartyList:e(r,!0)})}else this.updateTokenList(e)}updateTokenList(t){if(this.tokenModalFromState===T.FROM){let e=t(this.fromTokenList.get(this.fromSelectedChainId));this.fromTokenList.set(this.fromSelectedChainId,e)}else if(this.tokenModalFromState===T.TO){let e=t(this.toTokenList.get(this.toSelectedChainId));this.toTokenList.set(this.toSelectedChainId,e)}}get computedCurrentChainId(){return U(this.tokenModalFromState===T.FROM?this.fromSelectedChainId:this.toSelectedChainId)}get computedCurrentSearchChainId(){return U(this.tokenModalFromState===T.FROM?this.fromSelectedChainAtSearch:this.toSelectedChainAtSearch)}get computedIsCollectChain(){return this.computedCurrentChainId===B.chainId}setShowCollectCancelConfirm(t){b.set(Xi,t),this.hideCollectCancelConfirm=t}get computedIsNotSupportToChain(){let t=this.getCurrentToChainInfo();return this.tokenModalFromState===T.TO&&t&&t.disabled}get computedSelectedChainId(){return this.tokenModalFromState===T.FROM?this.fromSelectedChainId||this.fromToStore.from.chainId:this.tokenModalFromState===T.TO?this.toSelectedChainId||this.fromToStore.to.chainId:""}get computedAllChainList(){let t=this.commonStore.chainList;return this.tokenModalFromState===T.FROM?{supported:t,unsupported:[]}:this.tokenModalFromState===T.TO?this.computedToChainList:{supported:[],unsupported:[]}}get computedToChainList(){let t=this.commonStore.chainList,e=Ze(st(t),{chainId:Number(this.fromToStore.to.chainId)});return{supported:e?[e]:[],unsupported:[]}}get computedIsSearchChainStatus(){return!!this.searchChainKeywords}get computedSearchedChainList(){if(!this.computedIsSearchChainStatus)return{supported:[],unsupported:[]};let{supported:t,unsupported:e}=this.computedAllChainList;return{supported:this.filterChains(t),unsupported:this.filterChains(e)}}get computedTokenGuideVisible(){return!1}get computedIsWatchListGroupShow(){return this.searchValue?!1:this.tokenModalFromState===T.FROM&&Number(this.fromSelectedChainId)===B.chainId||this.tokenModalFromState===T.TO&&Number(this.toSelectedChainId)===B.chainId}};var tr=class extends Wt{constructor(e){super(e);n(this,"showChainTab",!0);n(this,"clearCacheTokenList",()=>{this.fromTokenList.clear(),this.toTokenList.clear()});n(this,"extendTokenList",(e=[],o=!0)=>J(e)?e:e?.map(r=>({...r,tokenList:this.extendTokens(r.tokenList,o)})));n(this,"generateToChainMap",()=>{let e=this.commonStore.chainList,r=Ze(st(e),{chainId:Number(this.fromToStore.from.chainId)})?.bridgeSupportChainInfoList||[];return Xt([...r],"chainId")});n(this,"getCrossChainSearchType",()=>{let e=this.tokenModalFromState===T.FROM?this.fromSelectedChainAtSearch:this.toSelectedChainAtSearch;return Number(e)===B.chainId?br.COLLECTION:br.COMMON});n(this,"getToChainIdAtSearch",()=>{let e=this.toSelectedChainId;return this.tokenModalFromState===T.TO&&(e=this.toSelectedChainAtSearch),Number(e)===X.chainId?"":e});j(this)}get computedTokenGuideVisible(){let{tokenModalFromState:e,hideTokenGuide:o}=this;return e===T.TO&&!o}get computedSearchTokenList(){return this.extendTokenList(this.searchTokenList?.list,!1)}get computedToChainList(){let e=this.commonStore.chainList,o=[],r=[],s=this.generateToChainMap();return e.forEach(i=>{let a={...i};a.disabled=!s[i.chainId],a.disabled||o.push(a)}),{supported:o,unsupported:r}}updateTokenCollectedLocal(e){let o=(r=[],s=!1)=>{let i=[];return r?.forEach(a=>{let u=a?.tokenList.map(m=>this.reassignTokenInfo(m,e,s)).filter(m=>this.filterCollectToken(m));i.push({...a,tokenList:u})}),i};if(this.searchValue){let{list:r}=this.searchTokenList;this.setSearchTokenList({list:o(r)})}else this.updateTokenList(o)}get computedToChain(){let e=Be(),o=Zo({});if(M(this.fromToStore.from.chainId)){let r=this.generateToChainMap(),s=[];return st(this.tokenPageChainList).forEach(i=>{!i||i.chainId!==Number(this.fromToStore.from.chainId)&&s.push({...i,disabled:!r[i.chainId]})}),[e,o,...s]}return[e]}getSearchParams(e){let o={...this.computedAdresses};return this.tokenModalFromState===T.FROM&&(o={...o,fromChainId:this.fromSelectedChainAtSearch},this.needRemoveChainId(this.fromSelectedChainAtSearch)&&delete o.fromChainId),this.tokenModalFromState===T.TO&&(o={...o,fromChainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainAtSearch},this.needRemoveChainId(this.toSelectedChainAtSearch)&&delete o.toChainId),{fromChainId:o.fromChainId??o?.chainId,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,targetChainId:o.targetChainId,targetWalletAddress:o.targetWalletAddress,walletAddress:this.accountStore.computedSignWalletAddress,inputContent:e,selectChainType:this.getCrossChainSelectChainType(),searchType:this.getCrossChainSearchType(),toChainId:this.getToChainIdAtSearch(),fromTokenAddress:this.fromToStore.from?.tokenContractAddress||""}}};d();l();w();var{BigNumber:Ji}=I,qr="safemoon_slippage",Qr="safemoon_is_changed",Zi=50,Ur={NeedIncreaseSlip:0,AdviseGivenSlip:1,NotAvailableGivenSlip:2,AdviseSlip:3},Ht=class{constructor(t){n(this,"isChanged",!1);n(this,"getSafemoonIsChangedLocal",()=>!!b.get(`${Qr}_${this.computedSlippageTokenPair}`));n(this,"cacheSlippage",0);P(this),this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,gt(()=>this.computedSlippageTokenPair,()=>{this.setSafeMoonIsChanged(b.get(`${Qr}_${this.computedSlippageTokenPair}`)),this.setCacheSlippage(b.get(`${qr}_${this.computedSlippageTokenPair}`))}),gt(()=>({slippage:this.computedPairSlippage}),()=>{this.cacheSlippage>0&&this.computedPairSlippage>this.cacheSlippage&&this.setSafeMoonIsChanged(!1),this.setCacheSlippage(b.get(`${qr}_${this.computedSlippageTokenPair}`))}),gt(()=>this.computedSlippage,e=>{this.commonStore.safemoonSlippage=e})}setSafeMoonIsChanged(t){this.isChanged=t;let{computedIsSingleChain:e}=this.fromToStore;e||b.set(`${Qr}_${this.computedSlippageTokenPair}`,t)}checkIsChanged(t){let e=new Ji(t),o=e.gte(this.computedPairSlippage)&&e.lte(50);o&&this.setSafeMoonIsChanged(o)}setSafeMoonPairSlippage(t){!this.isAccessSlippage(t)||(this.setCacheSlippage(t),b.set(`${qr}_${this.computedSlippageTokenPair}`,t))}isAccessSlippage(t){let e=new Ji(t);return this.computedPairSlippage>0&&e.gte(this.computedPairSlippage)&&e.lte(50)}get computedAutoSlippage(){return Do(this.rootStore)}get computedSafeMoonToken(){let{from:t,to:e}=this.fromToStore;return this.checkIsSafeMoon(t)?t:this.checkIsSafeMoon(e)?e:null}get computedHoneypot(){let{from:t,to:e}=this.fromToStore;return this.checkIsHoneypot(t)?t:this.checkIsHoneypot(e)?e:null}setCacheSlippage(t){this.cacheSlippage=t}get computedPairSlippage(){return this.computedSafeMoonToken?1.1:0}get computedSlippage(){return this.cacheSlippage>this.computedPairSlippage?this.cacheSlippage:this.computedPairSlippage}get computedOverLimit(){return this.computedSlippage>50}get computedSlippageTokenPair(){let{from:t,to:e}=this.fromToStore;return`${this.checkIsSafeMoon(t)?t.tokenContractAddress:""}_${this.checkIsSafeMoon(e)?e.tokenContractAddress:""}`}get computedSlippageTips(){let t=Number(this.computedAutoSlippage),{tokenSymbol:e}=this.computedSafeMoonToken||{},{from:o,to:r}=this.fromToStore,s=this.checkIsSafeMoon(o)||this.checkIsSafeMoon(r),i=this.checkIsHoneypot(o)||this.checkIsHoneypot(r);return!s||i?null:t===Zi?{type:Ur.AdviseGivenSlip,safeMoonSlippage:t,equalLimit:!0,tip:h("swaptrade_card_errortip_autoadjust_to_50",{tokenSymbol:e,slippageTolerance:t}),tipEquation:h("swaptrade_card_errortip_autoadjust_to_50",{tokenSymbol:q(e),slippageTolerance:t}),inputWarning:h("swaptrade_adjustslip_modal_advise_givenslip")}:t>Zi?{type:Ur.NotAvailableGivenSlip,overLimit:!0,safeMoonSlippage:t,tip:h("wallet_swap_adjustslip_modal_slip_notsupported",{tokenSymbol:e}),tipEquation:h("wallet_swap_adjustslip_modal_slip_notsupported",{tokenSymbol:q(e)})}:{type:Ur.AdviseSlip,safeMoonSlippage:t,tip:h("swaptrade_card_errortip_autoadjust_to_less50",{slippageTolerance:t,tokenSymbol:e}),tipEquation:h("swaptrade_card_errortip_autoadjust_to_less50",{slippageTolerance:t,tokenSymbol:q(e)}),inputWarning:h("swaptrade_modal_errortip_adjust_to_suggested_range",{slippageTolerance:t})}}checkIsSafeMoon(t){return g(t,"isSafeMoonToken")===1}checkIsHoneypot(t){return g(t,"isHoneypot")===1}get computedInputVal(){let{computedSwapAmount:t}=this.fromToStore;return t[T.FROM]}get computedInputFiatVal(){let{computedFromLocalCostByUsd:t}=this.fromToStore;return t}get computedOutputVal(){let{computedSwapAmount:t}=this.fromToStore;return t[T.TO]}get computedOutputFiatVal(){let{computedToLocalCostByUsd:t}=this.fromToStore;return t}get computedOutputPopVal(){let{computedSwapAmount:t}=this.fromToStore;return is(t[T.TO])}};d();l();var qe=class{constructor({swapServStatusStore:t,chainIdList:e}){this.chainIdList=e,this.swapServStatusStore=t,P(this)}get currChainMaintenanceInfo(){let t=this.swapServStatusStore.maintenanceChainsMap,e=this.chainIdList?.get()?.slice()??[];if(!t||!e.length)return null;for(let o of e){let r=t[o];if(r)return r}return null}get isCurrChainInMaintenance(){return Boolean(this.currChainMaintenanceInfo)}};d();l();var er=class{constructor(){n(this,"gasDropConfig",{gasDropShow:!1,gasDropSwitch:b.get(fr)===gn.OPEN,chainName:"",chainId:"",deduction:"",gasDrop:"",tokenLogoUrl:"",tokenSymbol:""});n(this,"setGasDropInfo",t=>{this.gasDropConfig={...this.gasDropConfig,...t}});n(this,"setGasDropSwitch",t=>{this.setGasDropInfo({gasDropSwitch:t}),b.set(fr,`${Number(t)}`)});n(this,"resetGasDrop",()=>{this.setGasDropInfo({gasDropShow:!1})});P(this)}get computedGasDropSelected(){let{gasDropShow:t,gasDropSwitch:e}=this.gasDropConfig;return t&&e}};d();l();var Gr=class{constructor(t){n(this,"isShowMev",!1);n(this,"setShowMev",t=>{this.isShowMev=t});n(this,"mevSwitchOpenStatue",Io.AUTO_OFF);n(this,"setMevUserSwitchOpen",t=>{this.mevSwitchOpenStatue=t});n(this,"mevInfo",{});n(this,"setMevInfo",t=>{this.mevInfo=t});n(this,"walletMevControl",!1);n(this,"setWalletMevControl",t=>{this.walletMevControl=t});this.rootStore=t,this.quoteStore=this.rootStore.quoteStore,this.fromToStore=this.rootStore.fromToStore,P(this,{},{autoBind:!0})}get computedIsMevOpen(){return this.isShowMev&&(this.mevSwitchOpenStatue===Io.AUTO_ON||this.mevSwitchOpenStatue===Io.USER_ON)}},or=Gr;d();l();w();var Vr=class{constructor(t){n(this,"feeConfig",{});n(this,"setFeeConfig",t=>{if(!this.isIframe)return;if(!J(t)){this.feeConfig=t,Ae.set("feeConfig",t);return}let e=Ae.get("feeConfig"),o=to(e,["referrerAddress","feePercent"]);J(o)?(this.feeConfig={},Ae.remove("feeConfig")):this.feeConfig=o});n(this,"widgetFeeConfig",{});n(this,"setWidgetFeeConfig",t=>{this.isWidget&&(this.widgetFeeConfig=t)});n(this,"receiveQuoteUrl",()=>this.isIframe?vn:Nn);n(this,"aggregatorQuoteUrl",()=>Mn);n(this,"saveOrderUrl",()=>this.isIframe?Bn:xn);n(this,"illegalFeePercent",t=>{let{BigNumber:e}=I,o=e(t);return!!(o.isNaN()||o.gt(kn)||o.lte(0))});n(this,"extendFeeConfig",(t={})=>{if(this.isWidget){let o=g(this.widgetFeeConfig,[t.chainId],{});if(typeof o.referrerAddress=="string")return{...t,...o};let r=g(o,["referrerAddress",t.fromTokenAddress]),s=g(r,"account"),a=g(r,"feePercent")||o.feePercent;return s?{...t,referrerAddress:s,feePercent:a}:t}if(!this.computedHasFeeConfig)return t;let e=J(this.feeConfig)?Ae.get("feeConfig"):this.feeConfig;return{...t,...e}});P(this),this.rootStore=t,this.isIframe=!It()&&ls()&&!bs,this.isWidget=!It()&&re()}get computedHasFeeConfig(){return!!this.feeConfig?.referrerAddress&&!!this.feeConfig?.feePercent&&this.isIframe}get computedFeeConfigErrorTips(){return this.computedHasFeeConfig?this.illegalFeePercent(this.feeConfig?.feePercent):!1}},rr=Vr;d();l();w();d();l();w();d();l();var ta=()=>{let{swapStore:c,intentSwapStore:t,swapDappStore:e,approveStore:o,fromToStore:r}=y(),{from:s,to:i}=r;return!(!i?.tokenContractAddress||!s?.tokenContractAddress||o.visibleApprove||c.isConfirmLoading||t.isConfirmLoading||e.computedSupportDappTradeByChain)};d();l();d();l();var ea=c=>{let{fromToStore:t,quoteStore:e}=y(),{commonDexInfo:o,pathSelectionRouterList:r,singleChainSwapInfo:s}=c,{computedIsSingleChain:i}=t,a=Number(o?.code)===Z.CROSS_CHAIN_INTERVAL,u=a?{crossMaxAmount:o?.crossMaxAmount,crossMiniAmount:o?.crossMiniAmount}:null;return e.setQuoteScope(u),{isAutoError:a||(i?!s:!r?.length)}};var Xa=({quoteStore:c,fromToStore:t})=>{c.setQuoteNumber(c.quoteNumber+1),c.quoteNumber===1&&c.checkQuoteScopeLtMin(c.quoteScope,t.from.amount)&&t.advanceSetTypedValue("")},za=(c,{fromToStore:t,quoteStore:e})=>{let{commonDexInfo:o,pathSelectionRouterList:r,singleChainSwapInfo:s,swapType:i,intentCode:a,isSupportDappTrade:u,offlineType:m,traceData:p,serviceFeeInfo:S}=c,C={intentCode:a,offlineType:m,swapType:i,traceData:p},R=r?.map(x=>({...o,...x,...C,isSupportDappTrade:u}));return{bestRoute:t.computedIsSingleChain?{...o,...s,...C,serviceFeeInfo:S,intentInfo:c?.intentInfo||{},isSupportDappTrade:u}:e.pickBestRouterAccordingBridgeId(R)||{...o,...C,isSupportDappTrade:u},combineSelectionRouterList:R}},Ja=({bestRoute:c,combineSelectionRouterList:t,isAutoError:e,networkFeeInfo:o,jitoData:r,commonDexInfo:s},{fromToStore:i,quoteStore:a})=>{a.updateSlippageInfoFetched(c),a.setQuote({...a.quote,bestRoute:c,quoteNull:e,quoteError:null,isFetchQuoting:!1,networkFeeInfo:o,jitoData:r,commonDexInfo:s}),i.quoteUpdateFromTo(c),i.computedIsSingleChain||a.setPathSelectionRouterList(t||[])},Wr=({isAutoError:c},{approveStore:t})=>{if(!c){let{fromToStore:e,quoteStore:o,accountStore:r}=y(),{needApprove:s,defiPlatformId:i,defiPlatformIds:a,allowanceData:u}=z.getApproveInfo(e.computedIsCrossChain,o);t.isPendingNotCheck({token:e.from,needApprove:s,defiPlatformIds:a,defiPlatformId:i,allowanceData:u,userWalletAddress:r.getAddressByChainId(e.from.chainId)}).catch(()=>{})}},Qe=({isAutoError:c},{quoteStore:t})=>{c&&(t.handleReverseQuoteErrorAndNull(),nt(()=>{t.updateQuoteStatus(t.quoteScope?2:3)}))},Za=c=>{let{solanaPriorityFeeStore:t}=y();t&&t.setJitoData(c?.networkFeeInfo)},Hr=c=>{c?.networkFeeInfo&&mt.setNetworkFeeInfo(c?.networkFeeInfo)},oa=c=>{let{fromToStore:t,quoteStore:e,approveStore:o}=y(),{isAutoError:r}=ea(c);Xa({quoteStore:e,fromToStore:t});let{bestRoute:s,combineSelectionRouterList:i}=za(c,{fromToStore:t,quoteStore:e}),{networkFeeInfo:a,newPriorityFeeInfo:u,jitoData:m,commonDexInfo:p}=c;Ja({bestRoute:s,combineSelectionRouterList:i,isAutoError:r,jitoData:m,commonDexInfo:p,networkFeeInfo:u||a},{fromToStore:t,quoteStore:e,approveStore:o}),Za(c),Hr(c),Wr({isAutoError:r},{approveStore:o}),Qe({isAutoError:r},{quoteStore:e})};d();l();var Ue=class{constructor(t){n(this,"allTimerAndQuoteState",{[K.DEFAULT]:{isShowLoadingCpt:!1,quoteText:()=>""},[K.QUOTING]:{isShowLoadingCpt:!0,quoteText:()=>h(uo)},[K.TIMER]:{isShowLoadingCpt:!0,quoteText:()=>h(uo)},[K.QUOTE_IS_HONEYPOT]:{isShowLoadingCpt:!1,quoteText:()=>h(mo)},[K.QUOTE_NULL]:{isShowLoadingCpt:!0,quoteText:()=>h(mo)},[K.QUOTE_NULL_AND_SECTION]:{isShowLoadingCpt:!0,quoteText:()=>h(uo)},[K.QUOTE_ERROR]:{isShowLoadingCpt:!1,quoteText:()=>h(mo)}});Object.assign(this,t)}isValidRange(t){if(typeof t!="string")return!1;let{from:e}=this.fromToStore,o=t.split("-");if(o.length!==2)return!1;let{BigNumber:r}=I;return r(e.amount).lt(o[0])||r(e.amount).gt(o[1])}getCurrentTimerQuoteState(){let{quoteNull:t,isFetchQuoting:e,quoteError:o,bestRoute:r}=this.quote,s=this.fromToStore?.computedIfQuote,i=o!==null;return s?i?this.allTimerAndQuoteState[K.QUOTE_ERROR]:this.rootStore.safeMoonStore.computedHoneypot?this.allTimerAndQuoteState[K.QUOTE_IS_HONEYPOT]:t?r?.msg&&(e||this.isValidRange(r.msg))?this.allTimerAndQuoteState[K.QUOTE_NULL_AND_SECTION]:this.allTimerAndQuoteState[K.QUOTE_NULL]:e?e?this.allTimerAndQuoteState[K.QUOTING]:this.allTimerAndQuoteState[K.DEFAULT]:this.allTimerAndQuoteState[K.TIMER]:this.allTimerAndQuoteState[K.DEFAULT]}};var Yt=class{constructor(){n(this,"dialogCloseFlag",!1);n(this,"slippageInfoFetched",!1);n(this,"setDialogCloseFlag",t=>{this.dialogCloseFlag=t});n(this,"enableQuoteAggregates",!1);n(this,"dialogShowQuotationComparison",!1);n(this,"setDialogShowQuotationComparison",t=>{this.dialogShowQuotationComparison=t});n(this,"quoteNumber",0);n(this,"setQuoteNumber",t=>{this.quoteNumber=t});n(this,"aggregateSelectId",tt);n(this,"isDialog",!1);n(this,"setIsDialog",t=>{this.isDialog=t});n(this,"initQuote",{bestRoute:null,quoteError:null,quoteNull:!1,isFetchQuoting:!1});n(this,"isPickRouterFromWallet",!1);n(this,"setIsPickRouterFromWallet",t=>{this.isPickRouterFromWallet=t});n(this,"quoteScope",null);n(this,"setQuoteScope",t=>{this.quoteScope=t});n(this,"fetchQuoteStatus",0);n(this,"quote",{...this.initQuote});n(this,"setQuote",t=>{this.quote=t});n(this,"pathSelectionRouterList",[]);n(this,"setPathSelectionRouterList",t=>{this.pathSelectionRouterList=t});n(this,"pickRouter",{});n(this,"setPickRouter",(t,e)=>{this.pickRouter=t,e&&(this.setNoCurrentPathTipInfo({bridgeName:t?.bridge?.bridgeName}),this.updateBestRoute(t))});n(this,"showChainListModel",!1);n(this,"setShowChainListModel",t=>{this.showChainListModel=t});n(this,"noCurrentPathTipInfo",{visible:!1,bridgeName:""});n(this,"setNoCurrentPathTipInfo",t=>{this.noCurrentPathTipInfo={...this.noCurrentPathTipInfo,...t}});n(this,"currentBridgeId","");n(this,"setCurrentBridgeId",t=>{this.currentBridgeId=t});n(this,"updateBestRoute",t=>{this.setQuote({...this.quote,bestRoute:t}),this.rootStore.fromToStore?.quoteUpdateFromTo(t)});n(this,"pickBestRouterAccordingBridgeId",t=>{let{smartRouterStore:{showXRouteModal:e}}=this.rootStore;if(!t||t.length===0)return null;let o=t.find(r=>r?.bridge?.bridgeId===this.currentBridgeId);return this.currentBridgeId&&!o&&(this.setCurrentBridgeId(""),!this.showChainListModel&&e!==Eo.ROUTER_SELECT&&this.setNoCurrentPathTipInfo({visible:!0})),o||t?.[0]});n(this,"quoteTimer",null);n(this,"clearQuote",()=>{this.cleanQuoteTimer(),this.setQuote(this.initQuote),this.rootStore.fromToStore?.quoteUpdateFromTo(null),this.quotePending=!1;let{computedIsCrossChain:t,computedIfQuote:e}=this.fromToStore;t?(this.setBridgeQuoteSelectStatus?.(0),this.setBridgeFetchStatus?.(e?1:0)):(this.setAggregateSelectStatus(0),this.setAggregateFetchStatus(e?1:0))});n(this,"cancelRef",null);n(this,"cleanQuoteTimer",()=>{clearTimeout(this.quoteTimer),this.quoteTimer=null,this.cancelRef&&this.cancelRef.abort()});n(this,"isClearQuote",()=>{let{currentTab:t}=this.commonStore,{computedTypedValue:e,from:o,to:r,computedIsSingleChain:s,computedIsExactIn:i}=this.fromToStore;return t===A.LIMIT_ORDER||!At(e)||!r?.tokenContractAddress||!o?.tokenContractAddress||!i&&!s});n(this,"getQuoteData",async({signal:t})=>{let e=await Me();return _(bt(()=>E.get(this.getQuoteStoreUrl(),{params:e,signal:t,isolate:!0}),ht.NUM,ht.TIMER))});n(this,"handleUpdateQuote",t=>{if(t){let{data:e}=t;oa(e)}});n(this,"fetchQuote",async({source:t}={})=>{if(!ta())return this.quoteTimer=setTimeout(()=>{this.fetchQuote().catch(()=>{})},Ce),Promise.resolve(!1);if(t===0){let{computedIsCrossChain:r}=this.fromToStore;r?(this.setBridgeQuoteSelectStatus?.(0),this.setBridgeFetchStatus?.(1),this.setBridgeSelectId?.(tt)):(this.setAggregateSelectStatus(0),this.setAggregateFetchStatus(1),this.setAggregateSelectId(tt))}if(this.isClearQuote())return this.quoteScope=null,this.clearQuote(),Promise.resolve(!1);if(this.cleanQuoteTimer(),this.rootStore.outerStore.computedFeeConfigErrorTips)return this.handleQuoteError(null),Promise.resolve(!1);this.setQuote({...this.quote,isFetchQuoting:!0}),this.cancelRef=kt();let[e,o]=await this.getQuoteData(this.cancelRef.signal);return this.quotePending=!1,!St(e)&&e&&this.handleQuoteError(e),this.handleUpdateQuote(o),this.setIsPickRouterFromWallet(!1),this.commonStore.setResetFromToByTabChange(!1),!St(e)&&!this.dialogCloseFlag&&nt(()=>{this.quoteTimer=setTimeout(()=>{this.fetchQuote().catch(()=>{})},Ce)}),Promise.resolve(!0)});n(this,"cacheQuoteParams",{});n(this,"quotePending",!1);n(this,"debounceQuote",Je(this.fetchQuote,ko));n(this,"fetchQuoteDebounce",async({source:t}={})=>{let{computedIsCrossChain:e,computedIfQuote:o}=this.fromToStore;this.quotePending=!0,o&&e?await this.debounceQuote({source:t}):o&&!e?this.debounceQuote({source:t}):this.clearQuote()});n(this,"handleQuoteError",t=>{this.setQuote({...this.initQuote,quoteError:t}),this.handleReverseQuoteErrorAndNull()});n(this,"getGasTokenFeeLoading",!1);n(this,"getGasTokenFeeCancelRef",null);n(this,"cancelGasTokenGeeRequest",()=>{this.getGasTokenFeeCancelRef&&(this.getGasTokenFeeCancelRef.abort(),this.getGasTokenFeeCancelRef=null)});n(this,"cacheNativeGasFee","");n(this,"setCacheNativeGasFee",t=>{this.cacheNativeGasFee=t});n(this,"fetchGasTokenFee",async()=>{let{from:t}=this.rootStore.fromToStore,{computedReserveGas:e}=this.rootStore.commonStore,{decimals:o,balance:r}=t||{},s=rn(De(),["dexIds"]);this.getGasTokenFeeCancelRef=kt();let i=this.rootStore.fromToStore?.computedIsExactIn?Ln:On;this.getGasTokenFeeLoading=!0;let a=this.getGasTokenFeeCancelRef.signal,u=e,[m,p]=await _(E.get(i,{params:{...s,amount:cs(r,o)},signal:a}));if(this.getGasTokenFeeLoading=!1,!St(m)&&m)return-1;if(!m){let{data:S}=p||{},{commonDexInfo:C}=S||{};Number(C?.code)===0&&C?.estimateReserveGasTokenFee!==""&&(u=C.estimateReserveGasTokenFee)}return this.setCacheNativeGasFee(u),u})}initQuoteStatus(){this.fetchQuoteStatus=0}updateQuoteStatus(t){this.fetchQuoteStatus=t}get computedSlippage(){let{computedIsSingleChain:t,computedDefaultAutoSlippageInfo:e}=this.fromToStore,o=this.rootStore.slippageStore,r=qs({isSingleChain:t,autoSlippageInfo:e}),s=Dt.AUTO,i,a;return o&&(r=o.computedRealSlippageValue,s=o.getSlippageType(),i=t?o.computedRealCustomMaxSlippage:void 0,a=t?o.computedRealCustomSlippage:void 0),{slippage:r,slippageType:s,customSlippage:a,maxSlippage:i}}getQuoteStoreUrl(){return this.outerStore.receiveQuoteUrl()}handleReverseQuoteErrorAndNull(){let{updateFromAmount:t,computedIsExactIn:e,updateTo:o}=this.fromToStore;e?o({amount:""}):t({amount:""})}getQuoteError(t){let{commonDexInfo:e,pathSelectionRouterList:o,singleChainSwapInfo:r}=t,{computedIsSingleChain:s}=this.fromToStore,i=Number(e?.code)===Z.CROSS_CHAIN_INTERVAL,a=i?{crossMaxAmount:e?.crossMaxAmount,crossMiniAmount:e?.crossMiniAmount}:null;return this.setQuoteScope(a),{isAutoError:i||(s?!r:!o?.length)}}updateSlippageInfoFetched(t){let{referenceSlippage:e,autoSlippage:o,autoTotalSlippage:r}=t?.autoSlippageInfo||{};(e||o||r)&&(this.slippageInfoFetched=!0)}checkQuoteScopeLtMin(t,e){if(!t||!e)return!1;let{crossMiniAmount:o}=this.quoteScope||{};return!!I.BigNumber(e).lt(I.BigNumber(o))}get computedCurrentTimerQuoteState(){return new Ue(this).getCurrentTimerQuoteState()}get computedRouterForSmartRouterStore(){return this.fromToStore?.computedIsSingleChain?this.quote?.bestRoute:this.pickRouter}get computedMediaForChangeSmartRouterData(){return wo()?.media==="sm"||this.isDialog}get computedQuoteAmount(){let{computedIsExactIn:t}=this.fromToStore;return t?this.quote?.bestRoute?.fromTokenAmount:this.quote?.bestRoute?.payAmount}get computedQuoteIntervalIsEmpty(){return this.computedQuoteInterval.type===G.EMPTY}get computedShouldShowLimitRegionTip(){let t=!!Wo.computedIsLimitRegion;return this.fromToStore?.computedIsSingleChain?t&&!this.quote?.bestRoute:t}get computedQuoteInterval(){let{fromToStore:t,approveStore:e,swapBtnStore:o,swapDappStore:r}=this.rootStore;if(this.quote?.bestRoute?.code===yn||this.quote?.bestRoute?.code===bn||t.computedFormToTokenIsLeverageToken)return{type:G.EMPTY};let s=ci.handleQuoteErrorState({quote:this.quote,honeypotToken:g(this,"rootStore.safeMoonStore.computedHoneypot",!1),shouldShowLimitRegionTip:this.computedShouldShowLimitRegionTip})||this.accountStore.computedNonsupportChain,{from:i}=this.fromToStore;if(s)return{type:G.EMPTY};if(r.checkShouldJumpToDapp())return{type:G.SHOULD_JUMP_DAPPS};if(this.computedNotSupportBtcAddress&&this.accountStore.isConnectedWallet)return{type:G.NOT_SUPPORT_BTC_ADDRESS_TYPE,text:this.quote.bestRoute?.errorMsg};if(this.computedIsNoOkxLiquidity)return{type:G.NOT_OKX_LIQUIDITY};let u=t.computedIsCrossChain?g(this.quote?.bestRoute,"bridge.defiPlatformId"):g(this.quote?.bestRoute,"defiPlatformId",it);if((!this.quoteScope||!t.computedIfQuote)&&this.fetchQuoteStatus!==3&&!e.isCancelApproveStatus(i,u)&&!this.computedPriceWarn.show&&!this.quote?.bestRoute?.errorMsg)return{type:G.EMPTY};if(this.computedCrossAccuracyLimit)return{type:G.CROSS_CHAIN_ACCURACY,text:h("swaptrade_card_tooltips_adjust_pay_token_decimal",{fromToken:i.tokenSymbol,value:this.computedCrossAccuracyLimit}),equation:h("swaptrade_card_tooltips_adjust_pay_token_decimal",{fromToken:q(i.tokenSymbol),value:this.computedCrossAccuracyLimit})};let{crossMiniAmount:m,crossMaxAmount:p}=this.quoteScope||{};if(I.BigNumber(i.amount).lt(I.BigNumber(m))){let S=_t(m,{cutPriceText:!0,isFloor:!1});return{type:G.CROSS_CHAIN_MIN,text:h("swaptrade_bridge_toast_min_amout_crosschain_swap",{value:S,symbol:i.tokenSymbol}),equation:h("swaptrade_bridge_toast_min_amout_crosschain_swap",{value:S,symbol:q(i.tokenSymbol)})}}if(I.BigNumber(i.amount).gt(I.BigNumber(p))){let S=_t(p,{cutPriceText:!0});return{type:G.CROSS_CHAIN_MAX,text:h("swaptrade_bridge_toast_max_amout_crosschain_swap",{value:S,symbol:i.tokenSymbol}),equation:h("swaptrade_bridge_toast_max_amout_crosschain_swap",{value:S,symbol:q(i.tokenSymbol)})}}return this.quote?.bestRoute?.errorMsg?{type:G.CROSS_CHAIN_MORE_TIPS,text:this.quote?.bestRoute?.errorMsg}:this.computedIsNoLiquidity?{type:G.NOT_LIQUIDITY}:this.computedCrossChainIntervalOutOfRange?{type:G.NOT_LIQUIDITY}:e.isCancelApproveStatus(i,u)&&!o.computedTooBalance?{type:G.CANCEL_APPROVE_TIPS}:this.computedPriceWarn.show?{type:G.PROVIDER_PRICE_WARN}:{type:G.EMPTY}}get computedNotSupportFromBtcAddressType(){let t=this.quote?.bestRoute?.code;return Number(t)===Z.NOT_SUPPORT_FROM_BTC_ADDRESS}get computedNotSupportToBtcAddressType(){let t=this.quote?.bestRoute?.code;return Number(t)===Z.NOT_SUPPORT_TO_BTC_ADDRESS}get computedNotSupportBtcAddress(){return this.computedNotSupportFromBtcAddressType||this.computedNotSupportToBtcAddressType}get computedCrossChainIntervalOutOfRange(){let{from:t}=this.fromToStore,{crossMiniAmount:e,crossMaxAmount:o}=this.quoteScope||{};return I.BigNumber(t.amount).lte(o)&&I.BigNumber(t.amount).gte(e)}get computedIsNoLiquidity(){return this.fetchQuoteStatus===3&&this.quote.quoteNull}get computedIsNoOkxLiquidity(){let t=this.quote?.bestRoute?.defiPlatformInfoList;return this.enableQuoteAggregates&&t&&this.aggregateFetchStatus===3?!t.some(o=>o?.defiPlatformId===it):!1}get computedCrossAccuracyLimit(){let{crossAccuracyLimit:t,code:e}=this.quote.bestRoute||{};return Number(e)===Z.CROSS_CHAIN_ACCURACY?t:""}get computedYouSaveVisible(){let{computedNowCurrencySymbol:t,currencyConversion:e,computedIsWalletEnv:o}=this.commonStore,{computedIsExactIn:r,computedIsCrossChain:s}=this.rootStore.fromToStore,{quoteError:i,quoteNull:a,bestRoute:u}=this.quote;if(!r||i||a||!u?.youSaveDTO||s)return{visible:!1};let{youSaveDTO:m,fromToken:p,toToken:S}=u,{topTenDexInfoList:C,youSaveMoney:R}=m,D=Number(R)>=.1&&C?.length>0&&!p.isHoneypot&&!S.isHoneypot,x=e(R).toString(),dt=D?Nt(x,t,{isFloor:!1}):"",ot=D?C?.[1]?.dexName:"";return o&&(!s&&this.computedTopTenDexInfoList.length>0?D=!0:D=!1),{visible:D,youSaveStr:dt,dexName:ot}}get computedHasYouSave(){let{computedIsCrossChain:t}=this.rootStore.fromToStore;return!!this.quote?.bestRoute?.youSaveDTO||t}get computedTopTenDexInfoList(){if(!this.rootStore.fromToStore?.computedIsExactIn||!this.computedHasYouSave)return[];let{computedNowCurrencySymbol:t,currencyConversion:e}=this.commonStore;return this.quote?.bestRoute?.youSaveDTO?.topTenDexInfoList?.map(({logoUrl:o,dexName:r,comparePercent:s,price:i,dexAmountOut:a,amountOutOfMoney:u,gasOfMoney:m,isOkxDex:p})=>{let S=e(u)?.toString(),C=e(m)?.toString();return{logoUrl:o,dexName:r,comparePercent:s,price:i,isOkxDex:p,formatPrice:_t(i),dexAmountOut:I.BigNumber(a).toString(),formatDexAmountOut:_t(a),amountOutOfMoney:S,formatAmountOutOfMoney:Nt(S,t,{needBillionMillionUnit:!1}),gasOfMoney:Nt(C,t),symbol:t||""}})??[]}get computedReferredFee(){let{bestRoute:t}=this.quote,{referredNetWorkFee:e,referredAmount:o}=t||{};if(!o||!e)return"";let{computedNowCurrencySymbol:r,currencyConversion:s}=this.commonStore,{from:i}=this.fromToStore;return h("swaptrade_modal_desc_crosschain_valuediff_variavle",{price:`${_t(o)} ${i.tokenSymbol}`,fee:`${Nt(s(e).toString(),r)}`})}get computedIsUsingCentralizedBridge(){let t=["8"],e=String(this.quote.bestRoute?.bridge?.bridgeId);return t.includes(e)}get computedIsNoQuote(){return this.quote.quoteError||this.quote.quoteNull||!this.quote.bestRoute||this.fromToStore.computedFormToTokenIsLeverageToken||this.rootStore.outerStore.computedFeeConfigErrorTips||!this.fromToStore.computedTypedValueIsValid}get computedSupportDappTradeByQuote(){return Number(this.quote?.bestRoute?.isSupportDappTrade)===1}setAggregateFetchStatus(t){return t}setAggregateSelectStatus(t){return t}setAggregateSelectId(t){return t}get computedIsOfflineType(){let{computedIsCrossChain:t}=this.rootStore.fromToStore;return t?Number(this?.quote?.bestRoute?.bridge?.bridgeType)===Fs.INTENT_BRIDGE:this?.quote?.bestRoute?.offlineType===Ds.YES}get computedIsFreeNetworkFee(){return this?.quote?.bestRoute?.bridge?.isFreeNetworkFee===Ms.FREE_NETWORK_FEE}get computedIsOkxProvider(){return!this?.quote?.bestRoute?.defiPlatformId||this?.quote?.bestRoute?.defiPlatformId===it}get computedBridgeIsOkxProvider(){let{defiPlatformId:t}=this?.quote?.bestRoute?.bridge||{};return!t||t===it}get computedPriceWarn(){let t=I.BigNumber(this?.quote?.bestRoute?.reducePercent),e=I.BigNumber(this?.quote?.bestRoute?.warnPercent);return{show:t&&t.isGreaterThan(e)}}get computedreducePercent(){return us(this?.quote?.bestRoute?.reducePercent)}};d();l();w();var oc=c=>{let{quoteStore:t,swapStore:e}=y();!c&&t.bridgeQuoteSelectStatus!==0&&(t.setBridgeNoRouteTipStatus(e.confirmSwapVisible?2:1),t.setBridgeQuoteSelectStatus(0))},sa=c=>Number(c.commonDexInfo?.code)===Z.CROSS_CHAIN_INTERVAL,rc=c=>!c.pathSelectionRouterList?.length,nc=c=>sa(c)||rc(c),sc=c=>{let{quoteStore:t}=y(),e=sa(c)?{crossMaxAmount:c.commonDexInfo?.crossMaxAmount,crossMiniAmount:c.commonDexInfo?.crossMiniAmount}:null;t.setQuoteScope(e)},ic=c=>{let{quoteStore:t}=y(),e=t.bridgeSelectId===tt?c[0]:c?.find(o=>o.bridge.bridgeId===t.bridgeSelectId);return oc(e),e||c[0]},ac=({data:c})=>{let{commonDexInfo:t,singleChainSwapInfo:e,swapType:o,pathSelectionRouterList:r,intentCode:s,isSupportDappTrade:i,offlineType:a,traceData:u}=c||{},m=r?.map((R,D)=>({commonDexInfo:t,...R,...R?.valueDiffInfo,isBest:D===0})),p={intentCode:s,offlineType:a,swapType:o,traceData:u},S={...e,...t,swapType:o,pathSelectionRouterList:m},C=m?.map(R=>({...t,...R,...p,isSupportDappTrade:i}));return{bestRoute:S,combineSelectionRouterList:C}},cc=c=>{let{quoteStore:t,smartRouterStore:e}=y();if(e.showXRouteModal!==Eo.XROUTER)return;let o=c.find(r=>r?.bridge?.bridgeId===t.pickRouter?.bridge?.bridgeId);o&&t.setPickRouter(o)},uc=({isAutoError:c,approveStore:t})=>{if(!c){let{fromToStore:e,accountStore:o,quoteStore:r}=y(),{needApprove:s,defiPlatformId:i,defiPlatformIds:a,allowanceData:u}=z.getApproveInfo(e.computedIsCrossChain,r),m=g(e,"from.chainId");t.bridgePendingNotCheck({token:e.from,userWalletAddress:o.getAddressByChainId(m),needApprove:s,defiPlatformIds:a,defiPlatformId:i,allowanceData:u}).catch(()=>{})}},mc=({bestRoute:c,bridgeInfo:t,isAutoError:e,originData:o,combineSelectionRouterList:r},{fromToStore:s,quoteStore:i})=>{let a=Ot({},c,t);i.updateSlippageInfoFetched(a),i.setBridgeSelectId(a?.bridge?.bridgeId),i.setQuote({...i.quote,bestRoute:a,quoteNull:e,quoteError:null,isFetchQuoting:!1}),sc(o),e&&i.setBridgeFetchStatus(3),s.quoteUpdateFromTo(a),s.computedIsCrossChain&&(i.setPathSelectionRouterList(r||[]),cc(r||[]))},ia=c=>{let{fromToStore:t,quoteStore:e,approveStore:o}=y(),{bestRoute:r,combineSelectionRouterList:s}=ac({data:c}),i=ic(r.pathSelectionRouterList),a=nc(c);e.setQuoteNumber(e.quoteNumber+1),mc({bestRoute:r,bridgeInfo:i,isAutoError:a,originData:c,combineSelectionRouterList:s},{fromToStore:t,quoteStore:e}),uc({isAutoError:a,approveStore:o}),Qe({isAutoError:a},{quoteStore:e})};var Ge=class extends Yt{constructor(e){super();this.isEnableBridgeQuoteSearch=!0;this.bridgeListPending=!1;this.bridgeQuoteSelectStatus=0;this.bridgeFetchStatus=0;this.bridgeNoRouteTipStatus=0;this.compareVisible=!1;this.dialogGroupVisibleStatus=1;this.bridgeSortType=0;this.setBridgeSelectId=e=>{this.bridgeSelectId=e};this.setBridgeQuoteSelectStatus=e=>{this.bridgeQuoteSelectStatus=e};this.setBridgeFetchStatus=e=>{this.bridgeFetchStatus=e};this.setBridgeNoRouteTipStatus=e=>{this.bridgeNoRouteTipStatus=e};this.setBridgeList=e=>{this.bridgeList=e};this.setBridgeListPending=e=>{this.bridgeListPending=e};this.setBridgeSortType=e=>{this.bridgeSortType=e};this.setCompareVisible=e=>{this.compareVisible=e};this.setDialogGroupVisibleStatus=e=>{this.dialogGroupVisibleStatus=e};this.getQuoteData=({signal:e})=>{let o=xi();return this.bridgeFetchStatus===0&&this.setBridgeFetchStatus(1),_(bt(()=>E.get(this.getQuoteStoreUrl(),{params:o,signal:e,isolate:!0}).then(r=>(this.setBridgeFetchStatus(2),this.handleUpdateQuote(r),this.setQuoteNumber(this.quoteNumber+1),this.quotePending=!1,r)).catch(r=>{throw k.stuff(r),r}),ht.NUM,ht.TIMER))};this.handleUpdateQuote=e=>{if(e){let{data:o}=e;ia(o)}};this.updateBestRoute=e=>{let o={...this.quote.bestRoute,...e};this.setQuote({...this.quote,bestRoute:o}),this.rootStore.fromToStore?.quoteUpdateFromTo(o)};this.handleQuoteError=(e=null)=>{this.setQuote({...this.initQuote,quoteError:e}),this.handleReverseQuoteErrorAndNull(),this.setBridgeFetchStatus(4)};j(this),Object.assign(this,e),this.rootStore=e}static async getInitialProps(){let[e,o]=await _(E.get(Un));if(e)throw e;return g(o,"data",[]).map(s=>({platformId:s.chainId,logo:s.logoUrl}))}get bridgeList(){return this.initialPropsStore.initialProps.bridgeList||[]}get computedIsBridgeListLoading(){return no()?!this.bridgeList?.length:this.bridgeListPending}async getBridgeList(){this.setBridgeListPending(!0),await _(this.initialPropsStore.getInitialProps({key:"bridgeList",callee:Ge})),this.setBridgeListPending(!1)}getQuoteStoreUrl(){return Dn}},aa=Fo(Ge);d();l();w();var hc="1",fc="2",ca={minValue:.01,maxValue:.5},ua={minValue:.03,maxValue:.5},Kt=class{constructor(t){n(this,"slippageSetting",{autoIsSelected:!1,inputSlippage:"",mode:Mt.DYNAMIC,level:Ft.LOW,customMax:""});n(this,"configSingle",ca);n(this,"configCross",ua);n(this,"hasInit",!1);n(this,"inputCache","");n(this,"isFrozen",!1);n(this,"setFrozenInfo",({computedSafeMoonNotSupport:t,isCrossBridgeOnly:e})=>{this.isFrozen=t||e});this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,this.smartRouterStore=t.smartRouterStore,P(this,{},{autoBind:!0})}setInputCache(t){this.inputCache=t}getSafeMoonStore(){return this.rootStore.safeMoonStore}getOrderSlippageInfo(){let{autoIsSelected:t}=this.slippageSetting,e=Et(this.rootStore);return t||this.isFrozen?{maxSlippage:this.computedRealCustomMaxSlippage,autoSlippageInfo:e}:{customSlippage:this.computedRealCustomSlippage,autoSlippageInfo:e}}get isSingleChain(){return this.rootStore.fromToStore.computedIsSingleChain}get minSlippage(){return this.isSingleChain?this.configSingle.minValue:this.configCross.minValue}get maxSlippage(){return this.isSingleChain?this.configSingle.maxValue:this.configCross.maxValue}get minSlippageShow(){return I.mul(this.minSlippage,100)}get maxSlippageShow(){return I.mul(this.maxSlippage,100)}get computedSupportCustomMax(){return g(Et(this.rootStore),"supportMaxSlippage",!1)}get computedFixedSlippageLevelMap(){if(!this.isSingleChain)return null;let t=g(Et(this.rootStore),"shortcutFixSlippage",Object.values(ks));return{low:Rt(t[0]),medium:Rt(t[1]),high:Rt(t[2])}}get computedDynamicSlippageLimit(){let t=g(Et(this.rootStore),"dynamicSlippageRangeMin",Ee.DYNAMIC_MIN),e=g(Et(this.rootStore),"dynamicSlippageRangeMax",Ee.DYNAMIC_MAX),o=g(Et(this.rootStore),"recommendSlippageRangeMin",Ee.RECOMMEND_MIN),r=g(Et(this.rootStore),"recommendSlippageRangeMax",Ee.RECOMMEND_MAX);return{dynamicMin:Rt(t),dynamicMax:Rt(e),recommendMin:Rt(o),recommendMax:Rt(r)}}get computedAutoSlippage(){return Do(this.rootStore)}get computedRealCustomSlippage(){let t=g(this,"slippageSetting.inputSlippage","");return t?we(t):""}get computedRealCustomMaxSlippage(){let t=g(this,"slippageSetting.customMax","");return t?we(t):""}get computedSafeMoonNotSupport(){let{computedHoneypot:t,computedSlippageTips:e}=this.getSafeMoonStore();return!!(t||e?.overLimit||e?.equalLimit)}get computedSafeMoonSlippage(){return this.getSafeMoonStore().computedSlippage}get computedSafeMoonTips(){return this.getSafeMoonStore().computedSlippageTips}get computedSafeMoonTip(){return this.getSafeMoonStore().computedSlippageTips?.tip}get computedSafeMoonPairSlippage(){return this.getSafeMoonStore().computedPairSlippage}get computedSlippageValue(){return this.getSlippageValue()}get computedRealSlippageValue(){let t=this.getSlippageValue();return Number(we(t))||0}isValidVolatilityTip(){if(Number(this.computedSlippageValue)>this.computedAutoSlippage)return!1;let t=this.getSafeMoonStore(),e=this.smartRouterStore;return t.computedSafeMoonToken===null&&!e?.isCrossBridgeOnly}get computedVolatilityTips(){if(!this.isValidVolatilityTip())return null;let{computedAutoSlippage:t}=this,e=this.rootStore?.quoteStore?.quote?.bestRoute||{},{priceFluctuationMonitorTime:o,priceFluctuationThreshold:r,fromPriceFluctuation:s,toPriceFluctuation:i,rateFluctuationThreshold:a,slippageFluctuationhold:u,rateFluctuation:m}=e,{from:p,to:S}=this.fromToStore,C=S?.tokenSymbol||"",R=p?.tokenSymbol||"",D=I.mul(u,100),x=I.mul(r,100),dt=I.mul(a,100),ot=Number(m),lt=Number(a);if(t>D){if(ot<lt)return null}else if(t===D){let $t=Math.abs(s),vt=Math.abs(i),pt=Number(r);if($t>pt&&vt>pt)return{tip:h("swaptrade_placeorder_alert_both_volatility",{payToken:R,receiveToken:C,value:x,min:o}),tipEquation:h("swaptrade_placeorder_alert_both_volatility",{payToken:q(R),receiveToken:q(C),value:x,min:o})};if($t>pt)return{tip:h("swaptrade_placeorder_alert_pay_receive_volatility",{token:R,value:x,min:o}),tipEquation:h("swaptrade_placeorder_alert_pay_receive_volatility",{token:q(R),value:x,min:o})};if(vt>pt)return{tip:h("swaptrade_placeorder_alert_pay_receive_volatility",{token:C,value:x,min:o}),tipEquation:h("swaptrade_placeorder_alert_pay_receive_volatility",{token:q(C),value:x,min:o})};if(ot>=lt)return{tip:h("swaptrade_settings_alert_both_exchange",{payToken:R,receiveToken:C,value:dt,min:o}),tipEquation:h("swaptrade_settings_alert_both_exchange",{payToken:q(R),receiveToken:q(C),value:dt,min:o})}}return null}getDefaultSetting(){let t={inputSlippage:"",autoIsSelected:!0,mode:Mt.DYNAMIC,level:Ft.LOW,customMax:""},e=this.getSafeMoonStore();if(e.computedSafeMoonToken){let o=e.computedSlippage,r=ar(o);e.isChanged&&r&&(t.inputSlippage=r,t.autoIsSelected=!1,t.mode=Mt.FIXED,t.level=Ft.CUSTOM,t.customMax="")}return t}getSlippageType(){return this.slippageSetting.autoIsSelected||this.isFrozen?Dt.AUTO:Dt.CUSTOM}getSlippageValue(t=this.slippageSetting){let{autoIsSelected:e,inputSlippage:o}=t;return e||this.isFrozen?this.computedAutoSlippage:o||this.computedAutoSlippage}setSlippageSetting(t){let e={...t},o=this.getSafeMoonStore(),{computedSafeMoonToken:r}=o,{computedIsSingleChain:s}=this.fromToStore;if(!r||s){this.slippageSetting=e;return}let i=this.getSlippageValue(e);if(i===this.getSlippageValue(this.slippageSetting)||o.isAccessSlippage(i)||!o.getSafemoonIsChangedLocal()){e.inputSlippage="",e.autoIsSelected=!0,e.mode=Mt.DYNAMIC,e.level=Ft.LOW;let a=ar(i);o.isChanged&&a&&(e.inputSlippage=a,e.autoIsSelected=!1,e.mode=Mt.FIXED,e.level=Ft.CUSTOM,e.customMax=""),o.setSafeMoonPairSlippage(i),this.slippageSetting=e}}async initSlippageConfigs(){this.hasInit=!0;try{let{data:t}=await E.get(Hn),e=t?.find(({configId:r})=>hc===r),o=t?.find(({configId:r})=>fc===r);e&&(this.configSingle=e),o&&(this.configCross=o)}catch{this.configSingle=ca,this.configCross=ua}}initSlippageSetting(){let t=this.getDefaultSetting(),e;t?e={...t}:e={autoIsSelected:!0,inputSlippage:"",mode:Mt.DYNAMIC,level:Ft.LOW,customMax:""},this.setSlippageSetting(e)}initReactions(){gt(()=>{let{from:t,to:e}=this.fromToStore;return{chainId:t.chainId,toChainId:e.chainId,fromTokenAddress:t.tokenContractAddress,toTokenAddress:e.tokenContractAddress}},({fromTokenAddress:t,toTokenAddress:e})=>t&&e?(this.rootStore.quoteStore.slippageInfoFetched=!1,this.initSlippageSetting()):!1,{equals:oo.shallow}),gt(()=>{let{computedSafeMoonPairSlippage:t}=this;return{computedSafeMoonPairSlippage:t}},()=>{this.initSlippageSetting()},{equals:oo.shallow}),gt(()=>{let{quote:t}=this.rootStore.quoteStore,e=g(t,"bestRoute.smartRoutingMenuVoList"),o=g(e,[0,"smartRoutingMenuType"]),r=e&&e.length===1&&o===ri.BRIDGE,{computedSafeMoonNotSupport:s}=this;return{computedSafeMoonNotSupport:s,isCrossBridgeOnly:r}},this.setFrozenInfo,{equals:oo.shallow})}get computedMinimumReceived(){let{quote:t,computedIsOfflineType:e}=this.rootStore.quoteStore,{receiveAmount:o,minimumReceived:r}=t?.bestRoute||{},s=this.fromToStore.to?.tokenSymbol;if(!At(o))return"--";let i=this.inputCache?we(this.inputCache):this.computedRealSlippageValue,a=e?r:I.mul(o,1-(At(i)?i:0));return I.BigNumber(a).lte(0)?"--":`${_t(a,{needBillionMillionUnit:!1})} ${s}`}get computedMinimumReceivedIsOrange(){let{quote:t}=this.rootStore.quoteStore,e=this.computedMinimumReceived,o=t?.bestRoute?.receiveAmount,r=I.BigNumber(o);return!r.isZero()&&!r.isNaN()&&I.div(I.sub(r,e),r)>=.1}};d();l();w();var Kr=class{constructor(t){n(this,"checkCrossChainParams",()=>{let{quoteStore:t,receiveAddressStore:e}=this.rootStore,{quote:o}=t,r=this.checkCommonParams(),{receiveAddrObj:s}=e,i=g(o.bestRoute,"quoteNetWorkFeeOfMoney"),a=o?.bestRoute?.bridge?.bridgeId,u=s?.specifiedAddress;return{...r,fromSwapFeeUsd:i,bridgeId:a,receiveWalletAddress:u}});n(this,"checkCommonParams",()=>{let{accountStore:t,fromToStore:e,quoteStore:o}=this.rootStore,{from:r,to:s}=e;return{fromChainId:r.chainId,fromTokenAddress:r.tokenContractAddress,amount:o?.computedQuoteAmount,toChainId:s.chainId,toTokenAddress:s.tokenContractAddress,userWalletAddress:t.address,accountId:t.computedAccountId}});n(this,"repeatOrder",null);n(this,"checkRepeatOrder",async()=>{this.repeatOrder=null;let{fromChainId:t,...e}=this.checkCommonParams(),{quoteStore:{quote:o}}=this.rootStore,r=g(o.bestRoute,"fromSwapFeeUsd"),s={...e,chainId:t,fromSwapFeeUsd:r},[i,a]=await _(E.get(Gn,{params:s}));!i&&[Te.COMMON_REPEAT,Te.BTC_REPEAT].includes(a?.data.repeatFlag)&&nt(()=>{let{orderId:u,enoughFlag:m}=a?.data??{};this.repeatOrder={enoughFlag:m,repeatFlag:a?.data.repeatFlag,id:u}})});n(this,"checkSwapMoreInfo",null);n(this,"checkCrossChainSwap",async()=>{this.checkSwapMoreInfo=null;let t=this.checkCrossChainParams(),[e,o]=await _(E.post(Vn,{...t}));e||nt(()=>{this.checkSwapMoreInfo=o?.data})});P(this),this.rootStore=t}},nr=Kr;d();l();var jt=class{constructor(t){n(this,"swapOnDappBtnLoading",!1);n(this,"setSwapOnDappBtnLoading",t=>{this.swapOnDappBtnLoading=t});n(this,"dappPanelVisible",!1);n(this,"setDappPanelVisible",t=>{this.dappPanelVisible=t});n(this,"showDappPanel",()=>{this.setSwapOnDappBtnLoading(!0),this.setDappPanelVisible(!0)});n(this,"hideDappPanel",()=>{this.setSwapOnDappBtnLoading(!1),this.setDappPanelVisible(!1)});n(this,"getSupportDetail",(t={},e=!1)=>{let o=this.chainIsSupportMarket(t),r=this.chainIsSupportDappTrade(t),s=!!this.quoteStore?.computedSupportDappTradeByQuote,i=!o&&r,a=o&&r,u=o&&!r;return{chainSupportMarket:o,chainSupportDappTrade:r,quoteSupportDappTrade:s,balance:a||u,kline:a||u,klineJumpMarket:a||u,costValue:e&&a||u,valueDifference:u,liquidity:u,disableInput:i||a,showMax:u,showAddFund:u}});n(this,"mergeCurrencyInputProps",(t,e)=>({balanceStatus:e.balance?t.balanceStatus:fo.BALANCE_NOT_SHOW,costValue:e.costValue?t.costValue:"",valueDifference:e.valueDifference?t.valueDifference:{},disableInput:e.disableInput,showMax:e.showMax?t.showMax:!1,showMaxIcon:e.showMax?t.showMaxIcon:!1,showAddFund:e.showAddFund?t.showAddFund:!1}));n(this,"getCurrentFromToChainConfig",()=>{let t=this.fromToStore.from.chainId,e=this.fromToStore.to.chainId,o=this.commonStore.getChainByID(t),r=this.commonStore.getChainByID(e);return[o,r]});n(this,"chainIsSupportMarket",t=>Number(t?.isSupportMarket)===1);n(this,"chainIsSupportDappTrade",t=>Number(t?.isSupportDappTrade)===1);n(this,"bridgeSupportDappTrade",t=>Number(t?.supportLinkDapp)===1);n(this,"getSupportDappTradeByToken",()=>{let t=this.quoteStore?.computedSupportDappTradeByQuote,e=Oo?.computedIsSelectedAllDex;return this.fromToStore.computedIsSingleChain&&t&&e});n(this,"checkShouldJumpToDapp",()=>this.fromToStore.computedFormToTokenIsLeverageToken?!1:this.computedSupportDappTradeByChain?!0:this.getSupportDappTradeByToken());this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,this.quoteStore=t.quoteStore,P(this,{},{autoBind:!0})}get computedFromToSupportMarketAndDappTrade(){let[t,e]=this.getCurrentFromToChainConfig();return{from:{...this.getSupportDetail(t,!0)},to:{...this.getSupportDetail(e)}}}get computedFromToSupportMarket(){let[t,e]=this.getCurrentFromToChainConfig();return this.chainIsSupportMarket(t)&&this.chainIsSupportMarket(e)}get computedSupportDappTradeByChain(){let t=this.fromToStore.from.chainId,e=this.fromToStore.to.chainId,o=this.commonStore.getChainByID(t);if(this.fromToStore.computedIsSingleChain)return this.chainIsSupportDappTrade(o);let r=o?.bridgeSupportChainInfoList,s=Array.isArray(r)&&r.find(i=>Number(i.chainId)===Number(e));return this.bridgeSupportDappTrade(s)}};d();l();w();var Ve=class{constructor(){this.serviceStatus=null;P(this)}get maintenanceChainsMap(){return this.serviceStatus?Xt(this.serviceStatus?.maintenanceChains,"chainID")??{}:{}}async init(){if(this.serviceStatus!==null&&this.serviceStatus.maintenanceChains?.length===0)return;let t=await ii();nt(()=>{this.serviceStatus={...t}}),si.setServiceState(t)}};d();l();d();l();var We=class extends Uo{constructor(){super(...arguments);this.sendTransactionOrUpdateHash=e=>(k.info(v.UPDATE_HASH,{...e,tags:{orderId:e.orderId,status:e?.status||1}}),E.post(Qn,e).catch(o=>{k.info(v.UPDATE_HASH_ERROR,{...e,error:o,tags:{orderId:e.orderId}})}));this.extendSaveOrderParams=e=>{let{computedQuote:o}=this,{receiveAddressStore:r}=this.rootStore,{to:s}=this.rootStore.fromToStore,{receiveAddrObj:i}=r,{fromDexRouterList:a,bridge:u,toDexRouterToList:m,originFromDexRouterList:p}=o.bestRoute||{};return{...e,gasDropType:0,toChainId:s.chainId,crossChainDexRouter:{fromDexRouterList:a,toDexRouterToList:m,bridge:u,originFromDexRouterList:p},receiveWalletAddress:i?.specifiedAddress}};this.onGenerateCallData=e=>{let o={...e,...Qo()};return k.info(v.SAVE_ORDER_PARAMS,{data:o}),E.post(qn,o)};this.isSwapSolana=()=>!1;this.cancelOrder=e=>{e&&(k.info(v.CANCEL_ORDER,{tags:{orderId:e},data:{type:"bridge"}}),E.get($n,{params:{id:e}}))}}};var He=class extends We{constructor(e){super(e);this.sendTransactionEnhance=e=>{let{from:o}=this.rootStore?.fromToStore,{walletSendParams:r}=this.rootStore.walletContractStore;return this.rootStore.sendTransactionStore.sendTransaction(o.chainId,e,r).then(s=>yo(o.chainId,s))};this.showRecentTransactionModal=e=>{this.isConfirmLoading=!1,this.confirmSwapVisible=!1,k.stuff(`orderId: ${e}`),L.history.go(-1);let{advanceSetTypedValue:o}=this.rootStore?.fromToStore;o?.("")};this.baseSaveOrderParams=()=>({...super.baseSaveOrderParams()});this.extendsGas=e=>{let o={...e},{gasInfo:r}=this.rootStore.walletContractStore,{gasLimitInfo:s,isGasLimitLoading:i,gasType:a,...u}=r;return o.extParams.gasType=a,{...o,gasInfo:u}};this.extendTronParams=e=>{let o={...e},{maxGasFeeInt:r}=this.rootStore.walletContractStore;return o.maxGasFeeInt=r,o};this.onWalletFail=(e,o)=>{this.isConfirmLoading=!1,!e?.message?.includes(L.global?.HARDWALLETERROR)&&super.onWalletFail(e,o)};this.checkRepeatOrderDetail=e=>{e&&L.history.push(`${so}/${e}`)};this.onSwap=async e=>{let{computedIsOfflineType:o}=this.rootStore.quoteStore;o?await this.rootStore.intentSwapStore?.onIntentSwap():await super.onSwap(e)};this.getSaveOrderMonitorData=()=>({...V(),...this.rootStore.walletContractStore.computedMonitorGasType});this.isSwapSolana=()=>!1;this.onClaim=e=>{L.history.push(`${Zt}?orderId=${e.orderId}&source=orderDetail`)};j(this,{},{autoBind:!0})}isOkxWallet(){return!0}getTransaction(){}walletErrorMessage(e){return e}get walletSendParams(){return this.rootStore.walletContractStore.walletSendParams}};var de=class extends Ut{constructor(){super();n(this,"reset",()=>{this.receiveAddressStore=new Bo(this),this.outerStore=new rr(this),this.fromToStore=new xo(this),this.approveStore=new Gt(this),this.quoteStore=new aa(this),this.tokenModalStore=new tr(this),this.safeMoonStore=new Ht(this),this.walletContractStore=new Xo(this),this.sendTransactionStore=new qo(this),this.intentSwapStore=new zo(this),this.swapCheckStore=new nr(this),this.swapStore=new He(this),this.swapBtnStore=new Vt(this),this.mevStore=new or(this),this.recentTransactionStore=new Vo(this),this.swapDappStore=new jt(this),this.smartRouterStore=new Ho(this),this.slippageStore=new Kt(this),this.oneMoreOrderStore=new Go(this),this.gasDropStore=new er,this.swapServStatusStore=new Ve,this.chainMaintanceStore=new qe({swapServStatusStore:this.swapServStatusStore,chainIdList:un(()=>{let{from:e,to:o}=this.fromToStore;return sn([e.chainId,o.chainId].filter(Boolean))})})});this.reset()}},Ye=de;n(Ye,"instance",null),n(Ye,"getInstance",()=>(de.instance||(de.instance=new de),de.instance));var da=Ye;d();l();d();l();var sr=class extends Wt{constructor(t){super(t),j(this)}getSearchParams(t){return this.singleSearchParams(t)}};d();l();w();d();l();w();var Sc=c=>{let{quoteStore:t,swapStore:e}=y();!c&&t.aggregateSelectStatus!==0&&(t.setAggregateNoRouteTipStatus(e.confirmSwapVisible?2:1),t.setAggregateSelectStatus(0))},gc=c=>{let{quoteStore:t}=y(),e=c?.find(i=>i.defiPlatformId===it),o=t.aggregateSelectId===tt?e:c?.find(i=>i.defiPlatformId===t.aggregateSelectId),r=g(e,"dexRouterList",[]);Sc(o);let s=c?.[0]||{};return Ot({},o||s,{dexRouterList:r})},Tc=({data:c,isCompareResult:t})=>{let{commonDexInfo:e,swapType:o,isSupportDappTrade:r,defiPlatformInfoList:s,traceData:i}=c,a=s?.map((S,C)=>({...S,isBest:C===0}));return{bestRoute:{...s?.[0]||{},...e||{},isSupportDappTrade:t?r:"0",swapType:o,defiPlatformInfoList:a,traceData:i}}},Cc=({bestRoute:c,aggregateInfo:t,isAutoError:e,networkFeeInfo:o,jitoData:r,commonDexInfo:s},{fromToStore:i,quoteStore:a})=>{let u=Ot({},c,t);a.updateSlippageInfoFetched(u),a.setAggregateSelectId(u.defiPlatformId),a.setQuote({...a.quote,bestRoute:u,quoteNull:e,quoteError:null,isFetchQuoting:!1,networkFeeInfo:o,jitoData:r,commonDexInfo:s}),e&&a.setAggregateFetchStatus(4),i.quoteUpdateFromTo(u)},Ic=c=>{let{solanaPriorityFeeStore:t}=y();t&&c?.jitoData&&t.setJitoData(c?.jitoData)},la=c=>{let{fromToStore:t,quoteStore:e,approveStore:o}=y(),r=e.aggregateFetchStatus===3,{bestRoute:s}=Tc({data:c,isCompareResult:r}),i=gc(s.defiPlatformInfoList),a=r&&s.defiPlatformInfoList?.length===0;e.setQuoteNumber(e.quoteNumber+1);let{networkFeeInfo:u,jitoData:m,commonDexInfo:p}=c;Cc({bestRoute:s,aggregateInfo:i,isAutoError:a,networkFeeInfo:u,jitoData:m,commonDexInfo:p},{fromToStore:t,quoteStore:e}),Ic(c),Hr(c),Wr({isAutoError:a},{approveStore:o}),Qe({isAutoError:a},{quoteStore:e})};d();l();function pa({quoteParams:c,serviceStateError:t}){if(t||!c||!At(c.amount)||!c.fromTokenAddress||!c.chainId||!c.toTokenAddress||!c.slippageConfig?.slippageType)return!1;let{slippageType:e,slippage:o}=c.slippageConfig;return!(e===Dt.CUSTOM&&!At(o))}var Ke=class extends Yt{constructor(e){super();this.enableQuoteAggregates=!0;this.setAggregateSelectId=e=>{this.aggregateSelectId=e};this.aggregateSelectStatus=0;this.setAggregateSelectStatus=e=>{this.aggregateSelectStatus=e};this.aggregateFetchStatus=0;this.setAggregateFetchStatus=e=>{this.aggregateFetchStatus=e};this.cleanQuoteTimerAndCancelQuote=()=>{clearTimeout(this.quoteTimer),this.quoteTimer=null,this.cancelRef&&this.cancelRef.abort()};this.clearQuote=()=>{this.quoteScope=null,this.cleanQuoteTimerAndCancelQuote(),this.setQuote(this.initQuote),this.rootStore.fromToStore?.quoteUpdateFromTo(null),this.quotePending=!1,this.setAggregateSelectId(tt),this.setAggregateSelectStatus(0),this.setAggregateFetchStatus(0)};this.fetchQuoteStart=({quoteSource:e,isPolling:o})=>{o||(this.quotePending=!0),e===0&&!o&&(this.setAggregateSelectStatus(0),this.setAggregateFetchStatus(1)),!It()&&!o&&e===0&&this.setAggregateSelectId(tt),this.cleanQuoteTimerAndCancelQuote(),this.setQuote({...this.quote,isFetchQuoting:!0})};this.fetchQuoteEnd=(e,o)=>{this.quotePending=!1,!St(e)&&e&&this.handleQuoteError(e),this.defiPlatformChangeAlert({defiPlatformId:this.aggregateSelectId,preDefiPlatformName:this.quote.bestRoute?.name,quoteRes:o}),this.handleUpdateQuote(o),this.setIsPickRouterFromWallet(!1),this.rootStore.commonStore.setResetFromToByTabChange(!1)};this.stopIntervalQuote=!1;this.setStopIntervalQuote=e=>{this.stopIntervalQuote=e};this.pollingQuote=({quoteParams:e,error:o})=>{!St(o)&&!this.dialogCloseFlag&&(this.quoteTimer=setTimeout(()=>{this.fetchQuote({...e,config:{...e.config,isPolling:!0}}).catch(()=>{})},Ce))};this.fetchQuote=async e=>{let{params:o,config:r={}}=e||{},{quoteSource:s,serviceStateError:i,isPolling:a}=r;if(!pa({quoteParams:o,serviceStateError:i}))return this.clearQuote(),k.error(v.SWAP_QUOTE_PARAMS_ERROR,{quoteParams:e}),Promise.resolve(!1);if(this.stopIntervalQuote)return this.pollingQuote({quoteParams:e}),Promise.resolve(!1);this.fetchQuoteStart({quoteSource:s,isPolling:a}),this.cancelRef=kt();let[m,p]=await this.getQuoteData({signal:this.cancelRef.signal,params:o,quoteSource:s,isPolling:a});return this.fetchQuoteEnd(m,p),this.pollingQuote({quoteParams:e,error:m}),Promise.resolve(!0)};this.debouncedFetchQuote=Je(e=>this.fetchQuote(e),ko);this.fetchQuoteDebounce=async e=>{this.debouncedFetchQuote(e)};this.fetchOKXQuote=({params:e,signal:o})=>{se({...e,liquidityConfig:{...e.liquidityConfig,defiPlatformIds:it}},{signal:o}).then(r=>{this.aggregateFetchStatus===1&&(this.setAggregateFetchStatus(2),this.handleUpdateQuote(r),this.setQuoteNumber(this.quoteNumber+1),this.quotePending=!1)}).catch(r=>{k.stuff(r)})};this.getQuoteData=async({params:e,signal:o,quoteSource:r,isPolling:s})=>{let i=r===0&&!s,{media:a}=wo(),u=a!=="sm"&&a!=="md",m=Gs();return!It()&&i&&u&&!m&&this.fetchOKXQuote({params:e,signal:o}),_(bt(()=>this.fetchAggregatesQuote({params:e,signal:o}),ht.NUM,ht.TIMER))};this.handleUpdateQuote=e=>{if(e){let{data:o}=e;la(o)}};this.updateBestRoute=e=>{let o=e||{},r={...this.quote.bestRoute,...o};this.setQuote({...this.quote,bestRoute:r}),this.rootStore.fromToStore?.quoteUpdateFromTo(r)};this.aggregateNoRouteTipStatus=0;this.setAggregateNoRouteTipStatus=e=>{this.aggregateNoRouteTipStatus=e};this.handleQuoteError=(e=null)=>{this.setQuote({...this.initQuote,quoteError:e}),this.handleReverseQuoteErrorAndNull(),this.setAggregateFetchStatus(5)};this.aggregatorListPending=!1;this.setAggregatorListPending=e=>{this.aggregatorListPending=e};this.fetchAggregatorList=async()=>{this.setAggregatorListPending(!0),await _(this.initialPropsStore.getInitialProps({key:"aggregatorList",callee:Ke})),this.setAggregatorListPending(!1)};this.compareVisible=!1;this.setCompareVisible=e=>{this.compareVisible=e};this.dialogGroupVisibleStatus=1;this.setDialogGroupVisibleStatus=e=>{this.dialogGroupVisibleStatus=e};j(this),Object.assign(this,e),this.rootStore=e}static async getInitialProps(){let[e,o]=await _(E.get(Fn));if(e)throw e;return g(o,"data",[]).map(s=>({platformId:s.platformId,logo:s.logo}))}defiPlatformChangeAlert({defiPlatformId:e,preDefiPlatformName:o,quoteRes:r}){e!==tt&&r?.data?.defiPlatformInfoList&&!r.data.defiPlatformInfoList.find(s=>s.defiPlatformId===e)&&mr.warn({title:mn("swaptrade_swap_dialog_desc_provider_path_error",{name:o}),placement:mr.DIRECTION.top})}fetchAggregatesQuote({params:e,signal:o}){return se(e,{signal:o}).then(r=>(this.aggregateFetchStatus===2&&this.setAggregateSelectId(tt),this.setAggregateFetchStatus(3),r))}get aggregatorList(){return this.initialPropsStore.initialProps.aggregatorList||[]}get computedIsAggregatorListLoading(){return no()?!this.aggregatorList?.length:this.aggregatorListPending}get computedPriorityFeeInfo(){let e=g(this,"quote.networkFeeInfo.normal",{})??{},o=g(this,"quote.networkFeeInfo.mev.[0]",{})??{},r=yr(e);return{mevPriorityFeeInfo:yr(o),nonMevPriorityFeeInfo:r}}get computedNotLiquidity(){return this.quote.quoteError&&this.quote.quoteError?.code===Z.NOT_LIQUIDITY}get computedQuoteError(){return!!this.quote.quoteError}get computedQuoteNetworkError(){return this.quote.quoteError&&this.quote.quoteError?.status===Z.ERR_NETWORK}get computedSupportDappTradeByQuote(){return this.quote.quoteError&&this.quote.quoteError?.code===Z.JUMP_TO_DAPP}get computedQuoteSafemoon(){let e=g(this.quote,"commonDexInfo.fromToken",{}),o=g(this.quote,"commonDexInfo.toToken",{});return Number(e?.isSafeMoonToken)===1?e?.tokenSymbol:Number(o?.isSafeMoonToken)===1?o?.tokenSymbol:""}get computedQuoteIsNewAddress(){return this.quote.quoteError&&this.quote.quoteError?.code===Z.NEW_ADDRESS_ERROR_CODE}get computedQuoteErrorMsg(){return this.quote.quoteError?.error_message||this.quote.quoteError?.message||this.quote.quoteError?.detailMsg}},ha=Fo(Ke);d();l();d();l();w();var jr=c=>{if(!c)return[];let{solPrice:t,solTokenSymbol:e,solDecimals:o}=c;return Rr.map(r=>({type:r,fee:c[`${r}Fee`],usd:c[`${r}FeeUsd`],solPrice:t,solTokenSymbol:e,solDecimals:o}))},fa=c=>{let t={},e=Xt(jr(c),"type");return en(Rr).forEach(o=>{t[o]={amount:e[o]?.fee||"",price:e[o]?.usd||""}}),t};var $r=class{constructor(t){n(this,"visible",!1);n(this,"setVisible",t=>{this.visible=t});n(this,"feeType",Re.MARKET);n(this,"setFeeType",t=>{this.feeType=t});n(this,"customFee",null);n(this,"setCustomFee",t=>{this.customFee=t});n(this,"jitoData",null);n(this,"setJitoData",t=>{this.jitoData=t});this.rootStore=t,j(this)}get computedPriorityFeeList(){return jr(this.jitoData)}get computedPriorityFeeMap(){return fa(this.jitoData)}get computedPriorityFeeAmount(){return this.jitoData?this.feeType===Re.CUSTOM?this.customFee:this.computedPriorityFeeList.find(e=>e.type===this.feeType)?.fee:null}get computedPriorityFeeOfUsd(){if(!this.jitoData)return null;let{solPrice:t}=this.jitoData;return I.mul(this.computedPriorityFeeAmount,t,{returnString:!0})}},Sa=$r;d();l();d();l();_a();d();l();w();d();l();d();l();var Xr=class{constructor(){this.mevList=[];this.setMevList=t=>{this.mevList=t};this.getMevList=()=>this.mevList;P(this)}},zr=new Xr;var Jr=class{constructor(){this.fetchMevList=async()=>{let[t,e]=await _(bt(()=>E.get(ns)));return!t&&e?.data?.length?(zr.setMevList(e.data),e.data):(k.error(v.GET_MEV_LIST_ERROR,{error:t,data:e}),[])};this.getMevList=async t=>{let e=zr.getMevList();(!e||!e.length)&&(e=await this.fetchMevList());let r=(e||[]).filter(s=>s.chainIds&&s.chainIds.includes(t)).map(s=>s.supplier);if(r.length)return r}}},ga=new Jr;var _c=async({mevConfig:c,chainId:t})=>g(c,"enableMev")?bo(t)?{enableMev:!0,mevSuppliers:g(c,"mevSuppliers")}:{enableMev:!0,mevSuppliers:await ga.getMevList(Number(t))}:{enableMev:!1},Ta=_c;var je=class extends Uo{constructor(){super(...arguments);this.sendTransactionOrUpdateHash=async e=>{let{transactionHash:o,orderData:r,...s}=e;if(r?.approveTxInfo){let{mevSuppliers:i}=await Ta({mevConfig:r.mevConfig,chainId:r.swapParams.chainId});return Ns({...s,mevSuppliers:i,userWalletAddress:this.rootStore.accountStore.address,walletId:this.rootStore.accountStore.computedAccountId,chainId:r.swapParams.chainId})}return Os({signedInfoList:[{txHash:o}],...s,userWalletAddress:this.rootStore.accountStore.address,walletId:this.rootStore.accountStore.computedAccountId,orderId:e.orderId})};this.extendEvmParams=(e,o=!1)=>{let r=super.extendEvmParams(e),s=this.rootStore?.quoteStore?.quote?.bestRoute?.isEnableMev;return r.extParams.isMev=o,!o&&Number(s)===_o.ON&&(r.extParams.isShowBlockSwapMevTooltip=!0),r};this.extendSaveOrderParams=async e=>{let o={...e},{computedQuote:r}=this,{originDexRouterList:s,dexRouterList:i,serviceFeeInfo:a,quoteData:u,isEnableMev:m}=r.bestRoute||{},{supportCustomGasFee:p,feeType:S}=mt;if(o.mevInfo=mt.getMevInfo(m),p){let C=It();o.priorityFeeType=C?Ks[S]:S,o.priorityFee=mt.computedPriorityFeeAmount,o.chainId===Ie.X_LAYER_MAINNET&&(o.gasPrice=String(mt.computedPriorityFeeAmount))}return{...o,dexRouterList:i,originDexRouterList:s,serviceFeeInfo:a,referralCommissionJsVersion:Ts,quoteData:u}};this.onGenerateCallData=e=>{let o={...e,...Qo()};return k.info(v.SAVE_ORDER_PARAMS,{data:o}),ye(o)};this.extendSolanaCalldata=e=>{let o=mt.feeType===Re.CUSTOM;return{...e,tradeMode:2,customPriorityFee:o}};this.getSolanaCalldata=e=>(this.setSolanaSwapParams(e),_(this.onGenerateCallData(e)));this.onSolanaSwap=async e=>{let o=this.extendSolanaCalldata(e),[r,s]=await this.getSolanaCalldata(o);if(r){this.saveOrderError(r);return}k.info(v.SAVE_ORDER,{data:s?.data,tags:{orderId:s?.data.orderId}}),ke({...V(),order_id:s?.data.orderId,wallet_type:this.rootStore.accountStore.walletConfig?.walletType}),this.checkCallData({chainId:e.chainId,responseData:s?.data,requestParams:o}).catch(()=>{}),await this.solanaTransaction(s.data,o)};this.isSwapSolana=e=>bo(e);this.solanaTransaction=async(e,o)=>{let{from:r}=this.rootStore.fromToStore,{computedAccountId:s}=this.rootStore.accountStore,u=(await No(r,{orderData:e,extParams:{}},this).jitoTransaction()).map(S=>S.payload.transaction);this.walletSignConfirming=!0;let[m,p]=await _(Cs({transactions:u}));if(this.walletSignConfirming=!1,m){this.onWalletFail(m,e?.orderId),this.isConfirmLoading=!1,k.removeKeep();return}await this.sendSolanaTransaction({signedTransactions:p,swapParams:o,walletId:s,orderData:e})};this.sendSolanaTransaction=async({signedTransactions:e,swapParams:o,walletId:r,orderData:s})=>{let[i,a]=await _(mi({signedTransactions:e,swapParams:o,walletId:r,orderData:s}));if(this.isConfirmLoading=!1,k.removeKeep(),i){dr.error({title:i?.error_message||h("swaptrade_home_toast_initiation_error"),placement:dr.DIRECTION.top});return}let u=g(a,"data.orderId"),m=g(a,"data.transactionHash");this.afterTransaction(u,{txHash:m,chainId:o.chainId,txType:"SWAP"}),this.logVerifyCallDataResult({txHash:m,orderId:u})};this.cancelOrder=e=>{e&&(k.info(v.CANCEL_ORDER,{tags:{orderId:e},data:{type:"swap"}}),E.get(jn,{params:{id:e}}))}}};var $e=class extends je{constructor(e){super(e);this.sendTransactionEnhance=e=>{let{from:o}=this.rootStore?.fromToStore,{walletSendParams:r}=this.rootStore.walletContractStore;return this.rootStore.sendTransactionStore.sendTransaction(o.chainId,e,r).then(s=>yo(o.chainId,s))};this.showRecentTransactionModal=e=>{this.isConfirmLoading=!1,this.confirmSwapVisible=!1,k.stuff(`orderId: ${e}`),L.history.go(-1);let{advanceSetTypedValue:o}=this.rootStore?.fromToStore;o?.("")};this.baseSaveOrderParams=()=>({...super.baseSaveOrderParams()});this.extendsGas=e=>{let o={...e},{gasInfo:r}=this.rootStore.walletContractStore,{gasLimitInfo:s,isGasLimitLoading:i,gasType:a,...u}=r;return o.extParams.gasType=a,{...o,gasInfo:u}};this.extendEvmParams=(e,o=!1)=>{let r={...e},{activityId:s}=this.rootStore.walletContractStore,i=this.rootStore.quoteStore.quote?.bestRoute?.isEnableMev;s&&(r.extParams.activityId=s);let{computedIsMevOpen:a,mevInfo:u,walletMevControl:m}=this.rootStore.mevStore;return r.extParams.isMev=a||m||o,r.extParams.mevInfo=u,!o&&Number(i)===_o.ON&&(r.extParams.isShowBlockSwapMevTooltip=!0),r};this.extendTronParams=e=>{let o={...e},{maxGasFeeInt:r}=this.rootStore.walletContractStore;return o.maxGasFeeInt=r,o};this.onWalletFail=(e,o)=>{this.isConfirmLoading=!1,!e?.message?.includes(L.global?.HARDWALLETERROR)&&super.onWalletFail(e,o)};this.checkRepeatOrderDetail=e=>{e&&L.history.push(`${so}/${e}`)};this.onSwap=async e=>{let{computedIsOfflineType:o}=this.rootStore.quoteStore;o?await this.rootStore.intentSwapStore?.onIntentSwap():await super.onSwap(e)};this.getSaveOrderMonitorData=()=>({...V(),...this.rootStore.walletContractStore.computedMonitorGasType});this.onClaim=e=>{L.history.push(`${Zt}?orderId=${e.orderId}&source=orderDetail`)};j(this,{},{autoBind:!0})}isOkxWallet(){return!0}getTransaction(){}walletErrorMessage(e){return e}get walletSendParams(){return this.rootStore.walletContractStore.walletSendParams}};var le=class extends Ut{constructor(){super();n(this,"reset",()=>{this.receiveAddressStore=new Bo(this),this.outerStore=new rr(this),this.fromToStore=new xo(this),this.approveStore=new Gt(this),this.quoteStore=new ha(this),this.tokenModalStore=new sr(this),this.safeMoonStore=new Ht(this),this.walletContractStore=new Xo(this),this.sendTransactionStore=new qo(this),this.intentSwapStore=new zo(this),this.swapCheckStore=new nr(this),this.swapStore=new $e(this),this.swapBtnStore=new Vt(this),this.solanaPriorityFeeStore=new Sa(this),this.mevStore=new or(this),this.recentTransactionStore=new Vo(this),this.swapDappStore=new jt(this),this.smartRouterStore=new Ho(this),this.slippageStore=new Kt(this),this.oneMoreOrderStore=new Go(this)});this.reset()}},Xe=le;n(Xe,"instance",null),n(Xe,"getInstance",()=>(le.instance||(le.instance=new le),le.instance));var Ca=Xe;var Ac=({localeData:c,...t})=>{ui();let e=(0,Ia.useLocation)(),o;return e.pathname.includes(et)?o=A.BRIDGE:e.pathname.includes(An)?o=A.LIMIT_ORDER:e.pathname===$&&(o=A.SWAP),ir.default.createElement(Qs,{localeData:c,isDev:!0,noRemoteData:!0,customRender:r=>r},ir.default.createElement(pi,{swapRootStore:Ca,bridgeRootStore:da,initTab:o},ir.default.createElement(Fi,{currentTab:o,...t})))},iA=ct(Ac);export{iA as default};
//# sourceMappingURL=Advanced-W6UNTAXW.js.map
