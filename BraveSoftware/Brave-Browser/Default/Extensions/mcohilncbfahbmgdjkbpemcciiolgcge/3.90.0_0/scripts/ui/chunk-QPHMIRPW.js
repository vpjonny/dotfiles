import{a as Ee,b as Le}from"./chunk-EC2OS2MX.js";import{a as Fe}from"./chunk-52JFFT56.js";import{b as Ne}from"./chunk-T2UFMQPE.js";import{b as we}from"./chunk-6BWJUZYL.js";import{b as ue,g as fe,i as pe,l as Te,m as ye,q as _e,r as ge}from"./chunk-ITLSSVGE.js";import{a as P}from"./chunk-M2YFVDKX.js";import{a as de}from"./chunk-3MLYZLAT.js";import{b as gt}from"./chunk-P355XBV4.js";import{d as Ie}from"./chunk-C4TBDTQO.js";import{a as he}from"./chunk-6AUQLYPZ.js";import{a as Ae}from"./chunk-UPIYMC4Q.js";import{c as xe,e as Ce,f as _t}from"./chunk-ZUO5BDO3.js";import{a as xt}from"./chunk-QEPQGEPL.js";import{B as ce,a as me,l as R}from"./chunk-V7YATDMZ.js";import{d as ie,g as le}from"./chunk-YLT6ZRGE.js";import{e as ft}from"./chunk-HZ3JMDUS.js";import{m as Xt,n as Qt}from"./chunk-JYCBCMDP.js";import{c as ae}from"./chunk-GVYIP5Q5.js";import{e as yt}from"./chunk-M43NTBTB.js";import{c as Tt}from"./chunk-PMG6IXOR.js";import{b as ne}from"./chunk-YVLQLIW6.js";import{h as pt,o as w}from"./chunk-N6PI3XTA.js";import{j as oe,n as re,o as se}from"./chunk-WYX7GFOD.js";import{A as Jt,k as Zt,n as qt}from"./chunk-KC2XLVFC.js";import{qa as $t}from"./chunk-MJDO2VHF.js";import{h as Gt}from"./chunk-TBQGFYU3.js";import{a as ut}from"./chunk-QF42JCDG.js";import{Z as X,c as Y,ha as zt}from"./chunk-3F7OC7N7.js";import{b as Kt}from"./chunk-HZOYPVSA.js";import{c as N}from"./chunk-3FMJDUGT.js";import{c as q}from"./chunk-2O5TMJZM.js";import{O as J}from"./chunk-UI4IZNSB.js";import{$ as vt,Fb as $,Nb as Ht,Pb as K,Ub as jt,Wb as Vt,a as Wt,ab as Yt,bb as Rt}from"./chunk-EQ34WRCJ.js";import{k,p as T}from"./chunk-DSNMNSMD.js";import{a as Ke}from"./chunk-DOSBJ3L3.js";import{J as ee,o as te}from"./chunk-URGJ6D4O.js";import{b as U}from"./chunk-FLSAETOH.js";import{Aa as $e,M as Mt}from"./chunk-4C5HF6J2.js";import{f as b,o as c,q as d}from"./chunk-UWURTNRY.js";c();d();var t=b(U());var Re=b(Ke());$e();c();d();var C=b(U());c();d();var be={list:"_list_b7lh5_1"};var Xe=({coinId:e,value:s,visible:a,onToggleVisible:i,options:o,onChange:u})=>{let f=ie(e),A=p=>{let{addressType:y,address:g,canTransferAmount:E}=p;return C.default.createElement(yt.Card,{selected:s?.address===g,onClick:()=>{i?.(),u?.(p)}},C.default.createElement(N.Box,{style:{width:"100%"}},C.default.createElement(N.FlexBox,{justify:"space-between",align:N.ALIGN.center},C.default.createElement(w.Text,{strong:!0},T($[y])),C.default.createElement(w.DisplayAmount,{strong:!0,mode:w.CRYPTO,decimals:f?.decimals,precision:f?.displayPrecision,isStableCoin:f?.stableCoin},E)),C.default.createElement(N.FlexBox,{justify:"space-between",align:N.ALIGN.center},C.default.createElement(w.Address,{address:g,desensitize:!0,copyable:!1,size:w.SIZE.sm,type:w.TYPE.secondary}),C.default.createElement(w.Text,{type:w.TYPE.secondary,size:w.SIZE.xs},T("extension_wallet_available_coin_balance",{coin:f?.symbol})))))};return C.default.createElement(te,{visible:a,alignBottom:!0,noTopRadius:!1,windowStyle:{width:"100%"},title:T("btcnft_gas_title_pay_gas_with"),onClose:i},C.default.createElement(yt,{space:16,dataSource:o,renderItem:A,className:be.list}))},ke=Xe;c();d();var Pe=b(U());var Qe=()=>(0,Pe.useCallback)(({value:e,message:s,reportParams:a})=>{try{Wt.captureEvent({message:s,contexts:{report:{info:JSON.stringify(a)}},exception:{values:[{type:"BIZ_ERROR_btcPayWalletAddress",value:e}]},level:"warn"})}catch(i){console.log(i)}},[]),Se=Qe;c();d();var H=b(U());function to(e,s,a,i){let[o,u]=(0,H.useState)(a),[f,A]=(0,H.useState)([]);return(0,H.useEffect)(()=>{if(i?.chainId===void 0||i?.chainId===null)return;(async()=>{try{if(!a)return;let y=await J(q.checkDustForBtcTx,{inscriptionIds:s,targetAddress:e,scene:24,chain:i?.chainId,tokenStandard:jt(i?.chainId)});A(y?.data?.dustInscriptionIds||[])}finally{u(!1)}})()},[a,e,s,i]),{isDustLoading:o,dustError:f.length>0}}var Be=to;c();d();var Oe=b(U());var eo=({isMpcWallet:e,isHardware:s,feeError:a,isSufficientGas:i,dustError:o,transferReminder:u,addressCheckError:f=""})=>({tipMessageProps:(0,Oe.useMemo)(()=>e?{type:P.TIP_TYPE.COMMON_ERROR,message:T("extension_wallet_contractual_interaction_wallet_unavailable")}:s?{type:P.TIP_TYPE.COMMON_ERROR,message:T("wallet_extension_top_toast_dapp_comingsoon")}:a?{type:P.TIP_TYPE.FEE_ERROR}:i?o?{type:P.TIP_TYPE.COMMON_ERROR,message:T("wallet_info_dialog_dust_limit_individually")}:f?{type:P.TIP_TYPE.COMMON_ERROR,message:f}:{type:P.TIP_TYPE.COMMON_TIP,message:u}:{type:zt.FEE_BALANCE_INSUFFICIENT},[a,e,s,i,o,u,f])}),De=eo;c();d();var oo=e=>{let{loading:s,data:a}=Zt(async()=>(await J(q.batchBtcNftDetail,{inscriptionIdProtocols:Array.isArray(e)?e:[e]}))?.data?.details||[]);return[s,a||[]]},Ue=oo;c();d();var It=b(U());var ro=7*1e3,so=({walletId:e,coinId:s,satBytes:a,needFilteredUtxo:i,localType:o=vt})=>{let u=oe(e),f=(0,It.useMemo)(()=>{let g=Kt(o);return u?.addressType?.[g]||[]},[u?.walletId]),[A,p]=Te({coinId:s,walletId:e,satBytes:a,addressList:f?.map(({address:g})=>g),needFilteredUtxo:i},{pollingInterval:ro,ready:!!i?.length&&!!a}),y=(0,It.useMemo)(()=>f.map((E,x)=>({...E,canTransferAmount:p[x]}))?.sort((E,x)=>{let tt=k.sub(x.canTransferAmount,E.canTransferAmount);return Number(tt)}),[p,f]);return[A,y]},We=so;c();d();var Q={nftTransferExtend:"_nftTransferExtend_1l31g_1",nftTransferIcon:"_nftTransferIcon_1l31g_4",nftTransferHeaderTipWrapper:"_nftTransferHeaderTipWrapper_1l31g_7"};var Me={Ordinals:"Ordinals",Atomicals:"Atomicals"},ve=2,Ye="NFT",no=({unapproved:e})=>{let s=e?.walletId,a=e?.localType,o=ae({localType:a})?.coinId;o===void 0&&(o=Rt(a));let[u,f]=le(o),A=se(s),p=e.params.transfer.from,y=e.params.transfer.to,{feeRate:g}=e.params.transfer.options||{},E=Se(),[,x]=de({coinId:o,address:p,chainId:u?.chainId}),tt=x?.transferReminder,[Ct,j]=Jt({payWallet:!1,networkFee:!1}),[L,At]=(0,t.useState)(g&&typeof g=="number"?{satBytes:g,level:X.CUSTOM}:{satBytes:x?.normal,level:X.STANDARD});(0,t.useEffect)(()=>{!L?.satBytes&&x?.normal&&At({satBytes:x?.normal,level:X.STANDARD})},[x,L]);let V=e.params.transfer.data,S=Array.isArray(V)&&V.length>1,{isDustLoading:ht,dustError:et}=Be(y,V,S,f),[,l]=Ue(V),W=(0,t.useMemo)(()=>{if(!Array.isArray(l)||!l?.length)return;let[{protocol:r}]=l||[];if(r===Me.Atomicals)return K.ARC_20},[l]),ot=(0,t.useMemo)(()=>l.map(r=>`${r.btcNftUtxoDetail?.txId}-${r.btcNftUtxoDetail?.outputIndex}`),[l]),[Nt,B]=We({localType:a,coinId:o,walletId:s,needFilteredUtxo:ot,satBytes:L?.satBytes}),[n,rt]=(0,t.useState)({}),[st,{toggle:He}]=qt(!1);(0,t.useEffect)(()=>{let r=B?.[0];if(Mt(n)&&!!r&&r?.canTransferAmount&&rt(r),B&&n.address&&n?.canTransferAmount){let m=B.find(({address:I})=>I===n?.address);m||E({value:m,reportParams:{payWallet:n,payWallets:B},message:`payWallet address get ${m}`}),m&&rt(m)}},[E,n,B]);let M=(0,t.useMemo)(()=>l.map(r=>{let{tokenId:m,protocol:I}=r,{txId:v,outputIndex:Z,outputValue:Je}=r?.btcNftUtxoDetail||{},Ut={txHash:v,nftId:r.tokenId,status:1,address:p,vout:Number(Z),coinAmount:Number(Je),resourceUrl:r?.resourceUrl};return I===Me.Atomicals&&Object.assign(Ut,{data:[{atomicalId:m,type:Ye,amount:1}]}),Ut}),[p,l]),wt=(0,t.useMemo)(()=>l.map(r=>{let m=r?.tokenId,{outputValue:I}=r?.btcNftUtxoDetail||{},v=Number(I);S||(v=k.lt(I,546)?546:Number(I));let Z={amount:v,address:y};return W===K.ARC_20&&Object.assign(Z,{data:[{atomicalId:m,type:Ye,amount:1}]}),Z}),[S,l,W,y]),nt=(0,t.useMemo)(()=>{if(!S){let{outputValue:r=0}=l?.[0]?.btcNftUtxoDetail||{};if(r<546)return k.sub(546,r)}return 0},[S,l]),[at,_,z]=_e({coinId:o,protocolId:W,toAddr:y,coinAmount:nt,fromAddr:n?.address,satBytes:L?.satBytes,utxoParams:{satBytes:L?.satBytes,needFilteredUtxo:ot},canTransferAmount:n?.canTransferAmount,inputs:M,outputs:wt},{ready:!!M?.length}),it=S?Y.BTC_NFT_BULK_SEND:Y.SEND_NFT,Et=ge({coinId:o,walletId:s,protocolId:W,coinAmount:0,toAddr:y,fromAddr:p,changeAddr:n?.address,localType:u?.localType,dustSize:W===K.ARC_20?void 0:x?.minOutput,networkFee:_,satBytes:L.satBytes,inputs:M,outputs:wt}),lt=l.map(({tokenId:r})=>r),je=JSON.stringify({nftIds:lt,from:p,to:y,serviceCharge:_,gasFrom:n?.address}),Lt=ce({coinId:o,txType:it,walletId:s,coinAmount:"0",fromAddr:p,toAddr:y,networkFee:_,localType:u?.localType,extJson:je,txSource:Ht.NFT}),Ft=pe({coinId:o,walletId:s,address:n.address,utxoType:ue.TRANSFER,satBytes:L?.satBytes,needFilteredUtxo:ot}),h=$t(),O=(0,Re.useHistory)(),bt=ye({coinId:o,txType:Y.SEND_NFT,protocolId:Vt(u?.chainId),address:n.address}),mt=l?.length,Ve=(0,t.useMemo)(()=>(l?.slice(0,st?mt:ve)).map(({resourceUrl:m,name:I})=>({title:I,icon:{src:m}})),[l,st,mt]),D=(0,t.useMemo)(()=>!(n?.canTransferAmount&&k.lt(n?.canTransferAmount,k.add(_,nt))),[_,nt,n?.canTransferAmount]),ze=re(s),[Ge,ct]=(0,t.useState)(!1),G=(0,t.useCallback)(async()=>{e.id?(await h(Xt(e.id)),await h(gt()),await Gt(h)):(h(ft()),D?O.goBack():O.replace(ut)),ct(!1)},[h,O,D,e.id]),{addressCheckLoading:kt,addressCheckError:dt}=Fe({from:p,chainIndex:Yt(a),handleCancel:G,method:e.method}),{tipMessageProps:Ze}=De({isHardware:A,feeError:z,isSufficientGas:D,dustError:et,transferReminder:tt,addressCheckError:dt}),Pt=(0,t.useCallback)(async()=>{let r=await Ft(0,_);await bt([...M,...r],G),ct(!0);let m=await Et({utxoList:[],utxos:[{address:n.address,inputs:fe(r)}]}),I=await me(u?.localType,m);try{e.id?(await h(Qt(e.id,{coinId:o,txHash:I,signedTx:m,serviceCharge:_,gasFrom:n.address,txType:it,nftIds:lt})),await h(gt())):(await Lt(m),h(ft()),ee.success({title:T("wallet_transfer_notif_transaction_submit")})),O.push(ut)}catch{}finally{ct(!1)}},[G,bt,u?.localType,h,_,Ft,O,D,lt,n.address,Lt,Et,M,it,e.id]),{loading:St,onClick:Bt}=xt(Pt),{loading:Ot,onClick:Dt}=xt(G),qe=(0,t.useMemo)(()=>{let r={actionType:R.ACTION_TYPE.CANCEL,btnText:T("wallet_dapp_connection_btn_reject"),onClick:Dt,loading:Ot},m={disabled:Nt||at||z||A||!Number(_)||!l?.length||ht||et||dt,actionType:R.ACTION_TYPE.CONFIRM,onClick:Bt,loading:St||kt};return D||(m={coinId:o,walletId:s,address:n?.address,actionType:R.ACTION_TYPE.FILL_UP}),[r,m]},[Nt,at,z,A,_,l?.length,Pt,D,e.id,h,O,o,s,n?.address,ht,et,Ot,St,Dt,Bt,kt,dt]);return t.default.createElement(t.default.Fragment,null,t.default.createElement("div",{className:Q.nftTransferHeaderTipWrapper},t.default.createElement(Ie,{coinId:o,...Ze})),t.default.createElement(N.Space,{direction:N.DIRECTION.vertical,space:24},t.default.createElement(xe,{txType:Y.TRANS_OUT,noPadding:!0}),t.default.createElement(pt.Thin,{compact:!0}),t.default.createElement(Ne,{space:24,summaryList:Ve}),t.default.createElement(pt.Thin,{compact:!0}),mt>ve&&t.default.createElement(N.FlexBox,{justify:"center",className:Q.nftTransferExtend,onClick:He},t.default.createElement(Tt,{size:Tt.SIZE.xs,className:Q.nftTransferIcon,icon:st?"okx-wallet-plugin-arrow-small-up":"okx-wallet-plugin-add-arrow-chevrons"})),t.default.createElement(he,{coinId:o}),t.default.createElement(Ae,{coinId:o,loading:at,estimateFailed:z,networkFee:_,onClick:()=>{j({networkFee:!0})}}),t.default.createElement(Ce,{copyable:!1,label:T("btcnft_gas_label_pay_gas_with"),value:T($[n?.addressType]),onClick:()=>{j({payWallet:!0})}}),t.default.createElement(_t,{walletId:s,address:p,title:T("extension_send_mid_text_from")}),t.default.createElement(_t,{address:y,title:T("extension_send_mid_text_to")}),t.default.createElement(Ee,{coinBalance:n.canTransferAmount,coinId:o}),t.default.createElement(ke,{coinId:o,value:n,options:B,visible:Ct.payWallet,onChange:rt,onToggleVisible:()=>{j({payWallet:!1})}}),t.default.createElement(ne,{offsetBottom:0,placeholder:!0,borderTop:!0},t.default.createElement(R,{buttonGroup:qe})),t.default.createElement(we,{coinId:o,signInfo:x,visible:Ct?.networkFee,value:L,estimatedFee:_,onChange:At,onToggleVisible:()=>{j({networkFee:!1})}}),t.default.createElement(Le,{visible:ze&&Ge})))},$r=no;export{$r as a};
//# sourceMappingURL=chunk-QPHMIRPW.js.map
