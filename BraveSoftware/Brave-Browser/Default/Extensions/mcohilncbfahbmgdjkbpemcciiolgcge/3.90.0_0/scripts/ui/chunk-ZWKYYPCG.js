import{a as Dr,b as Br,d as $r,e as Qr,f as Yr,k as Xr,l as oo,m as io}from"./chunk-YLPOVMK6.js";import{a as Zr,b as Jr,c as eo,d as to,e as so}from"./chunk-GIKT3XNH.js";import{a as _t}from"./chunk-F43OFDEC.js";import{f as Fr}from"./chunk-OWPVBYY3.js";import{C as It,D as Xe,E as kt,F as ge,G as Ze,H as k,I as $,J as we,K as ao,N as S,O as co,p as Ct,q as $e,r as qr,s as ke,t as Ee,v as At,x as Hr,y as zr}from"./chunk-ZNFTIF43.js";import{b as Vr}from"./chunk-D52EE5TC.js";import{k as ve}from"./chunk-FEU7MNAN.js";import{a as Wr}from"./chunk-CWNI35TN.js";import{a as Gr}from"./chunk-E6SXR3B6.js";import{h as de}from"./chunk-GTBNRR37.js";import{d as Nr,e as br}from"./chunk-A7FGCMOW.js";import{a as x}from"./chunk-3PLVXUNW.js";import{d as ro}from"./chunk-RKCZ2ONP.js";import{a as Lr,b as ze,d as ce}from"./chunk-CJAFGYQK.js";import{g as Ye,n as no}from"./chunk-QED56456.js";import{a as Qe}from"./chunk-HSSW2VTC.js";import{b as Kr,e as jr}from"./chunk-2LQJ3JX6.js";import{a as fe}from"./chunk-KF7FMIRD.js";import{b as Ke,c as Mr}from"./chunk-CERSDYPT.js";import{b as Ur,c as je}from"./chunk-RZETZIQO.js";import{A as Rr,Ea as P,Sa as Or,Va as St,a as vr,ab as Pr,gb as Tt,mb as xr,pa as T,q as wr,r as gt,v as yr,va as h}from"./chunk-P5GHREX3.js";import{a as Z}from"./chunk-VL2JCPJS.js";import{g as Ar,h as _r,i as Ir,j as kr,k as Er,l as Ge,m as He}from"./chunk-CTJAEFLV.js";import{A as Tr,B as Cr,a as j,f as ht,h as gr,j as ft,l as Ie,m as We,o as qe,p as Sr,z as H}from"./chunk-AP4E6GDF.js";import{$a as Yt,$d as pr,Ac as y,Cc as rr,D as it,Dd as ar,Ed as pt,F as O,Fb as er,Fd as ir,Gb as _e,Gd as cr,Hd as dr,Ib as Y,Id as lr,Ja as _,Jb as ie,Jd as ur,Ka as ct,Kb as he,Ke as f,La as Te,Lc as Ue,Na as Ce,Nc as or,Qa as Ae,Qb as ut,Tc as X,U as jt,Zd as mr,b as zt,be as hr,db as Xt,f as Me,g as Fe,ga as $t,gd as nr,ha as q,hd as sr,j as R,jb as dt,k as Kt,kb as lt,l as Be,m as Ve,nb as pe,qb as Zt,rb as Jt,te as fr,xa as G,xc as mt,yc as tr,za as Qt}from"./chunk-RPH2MNBW.js";import{a as Gt}from"./chunk-DOSBJ3L3.js";import{I as ae,J as me,K as z,a as Uo,o as Ht}from"./chunk-URGJ6D4O.js";import{w as v}from"./chunk-XYWWXNVK.js";import{a as Le}from"./chunk-FB3ILH2L.js";import{b as W}from"./chunk-FLSAETOH.js";import{Aa as se,G as Bt,M as ue,P as Vt,Q as Se,aa as Ut,g as Ft,ja as Wt,l as A,ma as qt,pa as De,va as at,z as st}from"./chunk-4C5HF6J2.js";import{f as w,h as a,o as l,q as u}from"./chunk-UWURTNRY.js";l();u();se();l();u();se();l();u();l();u();var Go=w(W());l();u();var Je=w(W());l();u();var lo=w(W());var dn=(0,lo.createContext)({initialProps:{},getInitialProps:()=>Promise.reject(Error("You may forget to use InitialPropsProvider"))});l();u();var In=w(W());l();u();var Et=class{constructor(e){a(this,"_context",null);a(this,"getInitialProps",(...e)=>this._context?this._context.getInitialProps(...e):Promise.reject(Error("You may forget to use InitialPropsProvider")));Be(this),this._updateContext(e)}get initialProps(){return this._context?this._context.initialProps:{}}_updateContext(e){this._context=e}},uo=Et;var vt=null,qo=null;function wt(d){return vt||(vt=new uo(qo)),d.prototype.initialPropsStore=vt,d}l();u();l();u();l();u();l();u();l();u();l();u();l();u();se();var mo=(d,e)=>!!d.find(r=>Number(e)===Number(r.chainId)),po=d=>{if(!d)return!1;let{fromChainId:e,toChainId:t,fromTokenAddress:r,toTokenAddress:o}=d,n=[H(e)&&r,H(t)&&o];return!!qt(n,Boolean)};var{BigNumber:D}=j,yt=class{constructor(e){a(this,"defaultToken",{amount:"",prevAmount:"",balance:"",logoURI:"",coinId:"",decimals:"",usdPrice:"",tokenName:"",baseCoinId:"",tokenSymbol:"",tokenLogoUrl:"",isNativeToken:0,tokenContractAddress:"",isSafeMoonToken:"",isHoneypot:"",buyTaxes:"0",sellTaxes:"0",reverseReceiveAmount:"",chainId:""});a(this,"from",{...this.defaultToken});a(this,"to",{...this.defaultToken});a(this,"fromBalanceState",G.BALANCE_NOT_SHOW);a(this,"toBalanceState",G.BALANCE_NOT_SHOW);a(this,"fromBalanceRequestError",!1);a(this,"toBalanceRequestError",!1);a(this,"isBalanceLoading",!1);a(this,"visibleAddFunds",!1);a(this,"setFrom",e=>{this.from=e});a(this,"setTo",e=>{this.to=e});a(this,"maxDialogType",Ae.enough);a(this,"setMaxDialogType",e=>{this.maxDialogType=e});a(this,"checkMaxDialogTypeIsEnough",e=>Ae.enough===e);a(this,"typedValue","");a(this,"fromMax",!1);a(this,"independentField",y.FROM);a(this,"singleTypedValue","");a(this,"singleFromMax",!1);a(this,"advanceSetTypedValue",(e="",t=!1,r="")=>{(r||this.commonStore.currentTab)===X.SWAP?(this.singleTypedValue=e,this.singleFromMax=t):this.setTypeInput(e,t)});a(this,"needCrossChainDoubleConfirm",!1);a(this,"setNeedCrossChainDoubleConfirm",e=>{this.needCrossChainDoubleConfirm=e});a(this,"updateBtcFromBalance",async()=>this.computedIsFromBtcCoin?(await this.getTokenBalanceByAccount(y.FROM,R(this.from)),!this.fromBalanceRequestError):!this.fromBalanceRequestError);a(this,"onClickMax",async()=>{Rr({button_name:"max"});let{isNativeToken:e}=this.from;this.setField(y.FROM);let t="",r="";if(e===1){let[o,n]=await Promise.all([this.rootStore.quoteStore.fetchGasTokenFee(),this.updateBtcFromBalance()]);if(!n)return;let{balance:s,availableBalance:i}=this.from,c=(this.computedIsFromBtcCoin?i:s)||"0";if(o===-1)return;r=D(c).minus(o);let m=r.isNegative();this.setMaxDialogType(m?Ae.insufficient:Ae.enough),m&&this.setShowAddFund(!0),this.showMaxDialog(),this.setShowMaxIcon(!0),t=m?"":r.toString()}else t=this.from.balance;this.advanceSetTypedValue(t,!0)});a(this,"setTypeInput",(e,t)=>{this.typedValue=e,this.fromMax=!!t});a(this,"setField",e=>{this.independentField=e});a(this,"quoteUpdateFromTo",e=>{let{receiveAmount:t="",fromTokenPrice:r="",toTokenPrice:o="",payAmount:n="",inputToTokenPrice:s="",toTokenValue:i="",fromTokenValue:c=""}=e||{};!this.computedIsExactIn&&t?(this.from.amount=n,this.to.amount=this.computedTypedValue,this.to.prevAmount=this.computedTypedValue,this.from.currentTime=new Date().getTime(),this.to.usdPrice=s):this.computedIsExactIn&&(this.from.amount=this.computedTypedValue,this.to.amount=t,this.from.prevAmount=this.computedTypedValue,this.to.currentTime=new Date().getTime(),this.to.usdPrice=o||i),this.to.reverseReceiveAmount=t,this.from.usdPrice=r||c});a(this,"checkAndGetTokenInfo",async({chainId:e,tokenContractAddress:t})=>{let[r,o]=await this.getTokenInfoAndBalance(e,t);return r?null:o.data});a(this,"getDexMultiDefaultTokenInfo",e=>{let{chainList:t}=this.commonStore,r=R(t).find(o=>Number(o.chainId)===Number(e??mt))||{};return{fromDexMultiTokenInfoVO:{...r.dexDefaultFromToTokenShowVO?.fromDexMultiTokenInfoVO,reserveGas:r.reserveGas},toDexMultiTokenInfoVO:r.dexDefaultFromToTokenShowVO?.toDexMultiTokenInfoVO||{}}});a(this,"addressReplaceSymbol",e=>{let{fromDexMultiTokenInfoVO:t}=this.getDexMultiDefaultTokenInfo(e.chainId),{tokenSymbol:r,isNativeToken:o}=t;return o&&this.commonStore.getTokenAddress(e)===this.commonStore.getTokenAddress(t)?r:e?.tokenContractAddress});a(this,"symbolReplaceAddress",e=>this.tokenReplaceMainToken(e).tokenContractAddress);a(this,"validTokens",{});a(this,"fetchTokenInfo",async e=>{if(e.tokenContractAddress){let t=await this.checkAndGetTokenInfo(e);if(t?.tokenContractAddress){let o={...t,balance:t.amountNum,amount:e.amount||""},n=`${t.chainId}_${this.commonStore.getTokenAddress(t)}`;return this.validTokens[n]=!0,o}let r=`${e.chainId}_${this.commonStore.getTokenAddress(e)}`;return this.validTokens[r]=e.tokenContractAddress==rr,null}return null});a(this,"checkQueryToken",async(e,t=!0)=>{if(!H(e.chainId))return null;let r=e;if(mo(this.commonStore.chainList,Number(e.chainId))){let{from:n}=this.getInitializedValue(e.chainId);if(this.commonStore.getTokenAddress(e)===this.commonStore.getTokenAddress(n)&&t){let i=`${n?.chainId}_${this.commonStore.getTokenAddress(n)}`;return this.validTokens[i]=!0,n}let s=await this.fetchTokenInfo({chainId:Number(e.chainId),tokenContractAddress:e.tokenContractAddress});t?r=s||n:r=s}else r=null;return r});a(this,"updateFrom",e=>{(!this.commonStore.equalsToken(e,this.from)||this.from.balance!==e.balance)&&(this.setShowMaxIcon(!1),this.setShowAddFund(!1)),ce(this.from,e)?this.from={...R(this.from),...e}:this.from={...R(this.from),...e,wsPriceData:{}}});a(this,"updateFromAmount",e=>{this.from.amount=e,e||(this.from.usdPrice="0"),this.from.prevAmount||(this.from.prevAmount=e)});a(this,"updateFromUsdPriceFromWs",(e={})=>{!ce(e,this.from)||(this.from.wsPriceData=e,this.from.usdPrice=_t({realTimeTokenPrice:e.price,amount:this.from.amount,nonRealTimeTokenValue:this.from.usdPrice}))});a(this,"updateToUsdPriceFromWs",(e={})=>{!ce(e,this.to)||(this.to.wsPriceData=e,this.to.usdPrice=_t({realTimeTokenPrice:e.price,amount:this.to.amount,nonRealTimeTokenValue:this.to.usdPrice}))});a(this,"updateTo",e=>{ce(this.to,e)?this.to={...R(this.to),...e}:this.to={...R(this.to),...e,wsPriceData:{}}});a(this,"hideMaxDialog",!!Z.get(dt));a(this,"hideMaxDialogLessGas",!!Z.get(lt));a(this,"setStorageShowMaxDialog",e=>{if(e){let t=this.checkMaxDialogTypeIsEnough(this.maxDialogType);Z.set(t?dt:lt,"1"),t?this.hideMaxDialog=!0:this.hideMaxDialogLessGas=!0}this.visibleMaxDialog=!1});a(this,"visibleMaxDialog",!1);a(this,"showMaxDialog",()=>{let e=this.checkMaxDialogTypeIsEnough(this.maxDialogType);e&&this.hideMaxDialog||!e&&this.hideMaxDialogLessGas||(this.visibleMaxDialog=!0)});a(this,"showMaxIcon",!1);a(this,"setShowMaxIcon",e=>{this.showMaxIcon=e});a(this,"showAddFund",!1);a(this,"setShowAddFund",e=>{this.showAddFund=e});a(this,"setFromBalanceRequestError",e=>{this.fromBalanceRequestError=e});a(this,"setToBalanceRequestError",e=>{this.toBalanceRequestError=e});a(this,"resetBalanceState",()=>{this.setShowMaxIcon(!1),this.setShowAddFund(!1),[this.fromBalanceRequestError,this.toBalanceRequestError]=[this.toBalanceRequestError,this.fromBalanceRequestError]});a(this,"onSwitchFromTo",async()=>{if(!this.isBalanceLoading){this.rootStore.quoteStore.quoteScope=null;let[e,t]=[R(this.from),R(this.to)];this.resetBalanceState();let r={amount:this.computedTypedValue??"",prevAmount:this.computedTypedValue??"",usdPrice:""},o={amount:"",prevAmount:"",usdPrice:""};this.setNeedCrossChainDoubleConfirm(!0),this.setField(y.FROM),this.computedIsSingleChain?(this.setCacheTokenInfo({chainId:t.chainId,tokenContractAddress:t.tokenContractAddress,amountNum:t.balance},"switchFromTo"),this.setFrom({...t,...r})):(this.rootStore.quoteStore.setQuoteNumber(this.computedTypedValue?0:2),this.setCacheTokenInfo({chainId:t.chainId,tokenContractAddress:t.tokenContractAddress,amountNum:t.balance},"switchFromTo"),this.setFrom({...t,amount:t.amount||"",prevAmount:t.amount||"",usdPrice:""})),this.setTo({...e,...o}),this.advanceSetTypedValue(t.amount),this.rootStore.receiveAddressStore.clearReceiveAddressValue()}});a(this,"getChainInfo",e=>{let{chainList:t}=this.commonStore;return t.find(o=>Number(o.chainId)===Number(e))||{}});a(this,"getInitializedValue",(e=mt)=>{let t=this.getChainInfo(e),{fromDexMultiTokenInfoVO:r,toDexMultiTokenInfoVO:o}=t?.dexDefaultFromToTokenShowVO||{fromDexMultiTokenInfoVO:{},toDexMultiTokenInfoVO:{}},n={...R(r),balance:"",reserveGas:t?.reserveGas},s={...R(o),balance:""};return{from:n,to:s}});a(this,"resetFromTo",async e=>{let{chainList:t,currentTab:r}=this.commonStore,o=r===X.BRIDGE;if(Number(e)!==Number(this.from.chainId)){let n=R(t).find(p=>Number(p.chainId)===Number(e)),{fromDexMultiTokenInfoVO:s,toDexMultiTokenInfoVO:i,toCrossDexMultiTokenInfoVO:c}=n?.dexDefaultFromToTokenShowVO||{fromDexMultiTokenInfoVO:{},toDexMultiTokenInfoVO:{}};this.from={...R(s),balance:"",reserveGas:n?.reserveGas};let m=o&&c||i;this.to={...R(m),balance:""}}});a(this,"clearFromTo",()=>{this.from={},this.to={}});a(this,"updateBalanceIfNativeToken",(e,t)=>{t.isNativeToken?this.getTokenBalanceByAccount(e,t,!1).catch(Ft):(this.setFromBalanceRequestError(!1),this.setBalance(e,t.amountNum))});a(this,"getSwapTokenBalance",(e=!1)=>{this.getTokenBalanceByAccount(y.FROM,R(this.from),e).catch(()=>{}),this.getTokenBalanceByAccount(y.TO,R(this.to),e).catch(()=>{})});a(this,"getTokenInfoAndBalance",async(e,t)=>{let r=this.accountStore.getAddressByChainId(e),o={chainId:e,tokenAddress:t,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,userWalletAddress:r,businessType:this.commonStore.computedCurrentTabIsLimit?ut.LIMIT_ORDER:ut.SWAP_ORDER};return O(P.get(ar,{params:o}))});a(this,"needBalanceLoading",!0);a(this,"setNeedBalanceLoading",e=>{this.needBalanceLoading=e});a(this,"getTokenBalanceByAccount",async(e,t,r=!1)=>{let o=e===y.FROM,{chainId:n,tokenContractAddress:s}=t||{};if(H(n)&&s&&this.accountStore.computedAccountId){this.needBalanceLoading&&(this.isBalanceLoading=!0);let i=await this.getTokenInfoAndBalance(n,s);if(this.isBalanceLoading=!1,this.setNeedBalanceLoading(!0),!this.commonStore.equalsToken(t,o?this.from:this.to))return;if(i[0]){if(r){this.fromBalanceRequestError=!1,this.toBalanceRequestError=!1;return}o?(this.fromBalanceRequestError=!0,this.fromBalanceState=G.BALANCE_REQUEST_FAILED):(this.toBalanceRequestError=!0,this.toBalanceState=G.BALANCE_REQUEST_FAILED),this.setBalance(e,"0","0","0");return}o?this.fromBalanceRequestError=!1:this.toBalanceRequestError=!1;let{amountNum:c,availableAmountNum:m,currencyAmount:p}=i[1]?.data||{};o&&this.setCacheTokenInfo({chainId:n,tokenContractAddress:s,amountNum:c},"api"),this.setBalance(e,c,m,p)}});a(this,"cacheTokenInfo",{});a(this,"setCacheTokenInfo",(e,t)=>{this.cacheTokenInfo=e,h.info(T.GET_BALANCE,{...e,tokenContractAddress:Mr(e.tokenContractAddress),type:t})});a(this,"setBalance",(e,t="",r="",o="")=>{let n=e===y.TO,s={balance:t,availableBalance:r,currencyAmount:o};n?this.updateTo({...this.to,...s}):this.updateFrom({...this.from,...s})});a(this,"setBalanceState",e=>{let{amount:t,address:r,from:o,to:n}=e;Boolean(r)&&Boolean(o.tokenContractAddress)?this.fromBalanceRequestError===!0?this.fromBalanceState=G.BALANCE_REQUEST_FAILED:D(o.balance||"0").lt(t||"0")?this.fromBalanceState=G.BALANCE_INSUFFICIENT:this.fromBalanceState=G.COMMON:this.fromBalanceState=G.BALANCE_NOT_SHOW,!(Boolean(r)&&Boolean(n.tokenContractAddress))||!this.computedIsToAddressEqualsCurrentToAddress&&this.computedDiffCrossChain?this.toBalanceState=G.BALANCE_NOT_SHOW:this.toBalanceRequestError===!0?this.toBalanceState=G.BALANCE_REQUEST_FAILED:this.toBalanceState=G.COMMON});a(this,"equalsTokenAndAccount",(e,t)=>this.commonStore.equalsToken(e,t)&&this.accountStore.getAddressByChainId(e.chainId)===t.address);a(this,"updateFromBalancePush",e=>{let{coinAmountOriginalDec:t,availableAmountNum:r,currencyAmount:o}=e;this.equalsTokenAndAccount(this.from,e)?(this.setCacheTokenInfo({chainId:e.chainId,tokenContractAddress:e.tokenContractAddress,amountNum:t},"ws"),this.setBalance(y.FROM,t,r,o)):this.equalsTokenAndAccount(this.to,e)&&this.setBalance(y.TO,t,r,o)});a(this,"tokenReplaceMainToken",e=>{let t=e,{fromDexMultiTokenInfoVO:r}=this.getDexMultiDefaultTokenInfo(e?.chainId),{tokenSymbol:o,chainId:n}=r;return H(e?.chainId)&&e?.tokenContractAddress&&(this.commonStore.getTokenAddress(e)===(this.commonStore.isSensitiveChain(n)?o:De(o))||this.commonStore.getTokenAddress(e)===this.commonStore.getTokenAddress(r))&&(t={...r,amount:e.amount}),t});a(this,"onClickAddFunds",()=>{let{tokenSymbol:e,chainName:t}=this.from,{address:r}=this.accountStore,o={currency:e,network:t,address:r};this.getDeposit(o)});a(this,"calOrderUpdateFromTo",e=>{let{fromTokenUsd:t,toTokenUsd:r,fromAmount:o,toAmount:n}=e||{};Se(o)||(this.from.amount=o),Se(t)||(this.from.usdPrice=t),Se(n)||(this.to.amount=n),Se(r)||(this.to.usdPrice=r)});a(this,"isEvmChain",e=>H(e)?this.commonStore.getChainByID(e)?.chainType!==Qt.NO_EVM_CHAIN:!0);a(this,"isTronChain",e=>e===tr.TRON_MAINNET);a(this,"getFormatFromToToken",async({from:e,to:t},r)=>{let[o,n]=await Promise.all([this.checkQueryToken(e,r),this.checkQueryToken(t,r)]),s=o,i=n,c=m=>`${m?.chainId}-${m?.tokenContractAddress}`;if(o){let m=this.getInitializedValue(o?.chainId),p=st(at([o,n,m.from,m.to],c));s=p[0],i=p[1]}else if(n){let m=this.getInitializedValue(n.chainId),p=st(at([n,m.from,m.to],c));s=p[1],i=p[0]}return{token1:s,token2:i}});a(this,"orderContinueStatus",Y.DEFAULT);a(this,"setOrderContinueStatus",e=>{this.orderContinueStatus=e});a(this,"fillSwapFromTo",async({apiRequestParams:e,locationParams:t})=>{let{closeModal:r}=this.rootStore.recentTransactionStore;!await this.beforeCheckAndGetTokenInfo(e,t)||(r(),this.setSwapAndLimitTypeValue(t.inputAmount))});a(this,"beforeCheckAndGetTokenInfo",async(e,t)=>{let{orderCheckContinue:r}=this.rootStore.oneMoreOrderStore;if(this.setOrderContinueStatus(Y.LOADING),e&&!await r(e))return this.setOrderContinueStatus(Y.ERROR),!1;let{token1:o,token2:n}=await this.getFormatFromToToken(t,!1);return!o||!n?(ae.error({title:f("swaptrade_history_toast_setup_error"),duration:ie}),this.setOrderContinueStatus(Y.ERROR),!1):(this.setOrderContinueStatus(Y.READY),this.updateFromAndToInfo(o,n),!0)});a(this,"beforeCheckUrl",async e=>{this.setOrderContinueStatus(Y.LOADING);let{orderCheckContinue:t}=this.rootStore.oneMoreOrderStore;return await t(e)?(this.setOrderContinueStatus(Y.READY),!0):(this.setOrderContinueStatus(Y.ERROR),!1)});a(this,"updateFromAndToInfo",(e,t)=>{this.updateFrom(e),this.updateTo(t)});a(this,"nativeCoin",null);a(this,"setNativeCoin",e=>{this.nativeCoin={...e}});this.rootStore=e,this.accountStore=e.accountStore,this.commonStore=e.commonStore,Fe(()=>this.initialPropsStore.initialProps.fromTo,(t={})=>{let{from:r={},to:o={}}=t;this.setFrom(r),this.setTo(o)})}static async getInitialProps(e){let t=new URLSearchParams(e.route.search),{from:{chainId:r,tokenContractAddress:o},to:{chainId:n,tokenContractAddress:s}}=Fr(t);if(!po({fromChainId:r,toChainId:n,fromTokenAddress:o,toTokenAddress:s}))return{from:{},to:{}};let i=pr,c={chainId:r,fromTokenAddress:o,toTokenAddress:s};e.route.path.includes(Zt)&&(i=pt,c={chainId:r,toChainId:n,fromTokenAddress:o,toTokenAddress:s}),e.route.path.includes(Jt)&&(i=hr,c={fromChainId:r,toChainId:n,fromTokenAddress:o,toTokenAddress:s});let[C,E]=await O(P.get(i,{params:c}));return C?{from:{},to:{}}:{from:A(E,"data.fromTokenInfo")||A(E,"data.fromToken"),to:A(E,"data.toTokenInfo")||A(E,"data.toToken")}}get computedTypedValue(){return this.commonStore.currentTab===X.SWAP?this.singleTypedValue:this.typedValue}get computedFromMax(){return this.commonStore.currentTab===X.SWAP?this.singleFromMax:this.fromMax}get computedNeedCrossChainDoubleConfirm(){return this.computedIsSingleChain?!1:!this.needCrossChainDoubleConfirm}get dependentField(){return this.independentField===y.FROM?y.TO:y.FROM}get computedIsExactIn(){return this.independentField===y.FROM}get computedIsSingleChain(){return H(this.from.chainId)&&H(this.to.chainId)&&Number(this.from.chainId)===Number(this.to?.chainId)}get computedSwapAmount(){return{[this.independentField]:this.computedFromMax?We(this.computedTypedValue,{noNeedThousandth:!0}):this.computedTypedValue,[this.dependentField]:this.computedCalAmount[this.dependentField]}}get computedCalAmount(){return{[y.FROM]:We(this.from?.amount,{noNeedThousandth:!0})??"",[y.TO]:We(this.to?.amount,{noNeedThousandth:!0})??""}}get computedIfQuote(){return!!(this.computedTypedValueIsValid&&this.from&&this.to)}get computedTypedValueIsValid(){return!D(this.computedTypedValue).isZero()&&!D(this.computedTypedValue).isNaN()}get computedFromAmountIsValid(){let{amount:e}=this.from;return qe(e)}get computedFromLocalCostByUsd(){let{usdPrice:e}=this.from;if(!this.computedFromAmountIsValid)return"";let{nowCurrencyUnit:t}=this.commonStore,{symbol:r,usdToThisRate:o}=t,n=D(e);if(r&&e&&o&&!n.isNaN()){let i=n.multipliedBy(o).toString();return ft(i,r,{needBillionMillionUnit:!1})}return""}get computedToLocalCostByUsd(){let{usdPrice:e}=this.to,{nowCurrencyUnit:t}=this.commonStore,{symbol:r,usdToThisRate:o}=t,n=D(e);if(r&&e&&o&&this.to.amount&&!n.isNaN()&&qe(this.from.amount)){let i=n.multipliedBy(o).toString();return ft(i,r,{needBillionMillionUnit:!1})}return""}get computedRate(){let{from:e,to:t,computedIsExactIn:r}=this,{quoteStore:o,gasDropStore:n}=this.rootStore,s=A(o,"quote.bestRoute.gasDropFromAmount",""),i=s&&n?.gasDropConfig?.gasDrop?D(e?.amount).minus(s):D(e?.amount),c=t?.reverseReceiveAmount&&r||!r&&e?.amount;return i&&c?Ie(D(t?.reverseReceiveAmount).div(i).toString(10),{needBillionMillionUnit:!1}):""}get computedToFromRate(){let{from:e,to:t,computedIsExactIn:r}=this,{quoteStore:o,gasDropStore:n}=this.rootStore,s=A(o,"quote.bestRoute.gasDropFromAmount",""),i=s&&n?.gasDropConfig?.gasDrop?D(e?.amount).minus(s):D(e?.amount),c=t?.reverseReceiveAmount&&r||!r&&e?.amount;return i&&c?Ie(D(i).div(t?.reverseReceiveAmount).toString(10),{needBillionMillionUnit:!1}):""}get computedIsToAddressEqualsCurrentToAddress(){let e=this.accountStore.getAddressByChainId(this.to.chainId);return e&&this.rootStore.receiveAddressStore.computedReceiveAddr===e}get computedValueDifference(){let{quoteStore:e}=this.rootStore,t=A(e,"quote.bestRoute.quoteDiffValThreshold"),r=A(e,"quote.bestRoute.quoteDiffPercentThreshold");return ro({pay:this.from.usdPrice,receive:this.to.usdPrice,quoteDiffValThreshold:t,quoteDiffPercentThreshold:r})}get computedIsCrossChain(){return H(this.from.chainId)&&H(this.to.chainId)&&Number(this.from.chainId)!==Number(this.to?.chainId)}get computedIsBridge(){let{from:e,to:t}=this;return this.computedIsCrossChain&&e.tokenSymbol===t.tokenSymbol}getDeposit(){}get computedDiffCrossChain(){let e=!!this.accountStore.address,t=this.commonStore.getChainByID(this.from.chainId),r=this.commonStore.getChainByID(this.to.chainId),o=String(this.from.isHoneypot),n=String(this.to.isHoneypot),{computedNonsupportChain:s}=this.accountStore,i=t?.crossChainType||"",c=r?.crossChainType||"";return e&&!s&&o!=="1"&&n!=="1"&&i&&c&&i!==c}get computedMaxTipsText(){let{from:e,maxDialogType:t}=this,{cacheNativeGasFee:r}=this.rootStore.quoteStore;if(!e.isNativeToken||!r||!e.tokenSymbol)return f("wallet_swap_toast_reserve_mainnet_token");let o={value:Ie(r),tokenSymbol:e.tokenSymbol};if(this.checkMaxDialogTypeIsEnough(t)){if(this.computedIsFromBtcCoin&&j.gt(this.computedUnavailableBalance,0)){let n=Ie(this.computedUnavailableBalance);return f("swaptrade_dialog_pay_card_reserved_from_wallet",{symbol:o.tokenSymbol,value:o.value,unablevalue:n})}return f("swaptrade_dialog_desc_reserved_netfee",o)}return f("swaptrade_dialog_desc_please_reserve",o)}get computedShowAddFund(){let{accountStore:e,swapBtnStore:t}=this.rootStore,{from:r}=this;if(!e.computedNonsupportChain){let o=D(this.computedTypedValue||0),n=D(r.balance||0);if(this.independentField===y.FROM&&o.gt(n)||t.computedTooBalance)return!0}return this.showAddFund&&!this.checkMaxDialogTypeIsEnough(this.maxDialogType)}get computedIsEvmChain(){return this.isEvmChain(this.from.chainId)}get computedDefaultAutoSlippageInfo(){let e=this.commonStore.getChainByID(this.from.chainId);return{autoSlippage:e?.toleranceSlippage?.selectItem,autoTotalSlippage:e?.crossToleranceSlippage?.selectItem}}get computedIsSolanaChain(){return Ge(this.from.chainId)}get computedIsAptosChain(){return He(this.from.chainId)}get computedIsTronChain(){return _r(this.from.chainId)}get computedIsSuiChain(){return Ir(this.from.chainId)}get computedIsStacksChain(){return kr(this.from.chainId)}get computedIsStarknetChain(){return Er(this.from.chainId)}get computedHasToSwap(){let e=A(this.rootStore.quoteStore,"quote.bestRoute.toSwapFeeUsd");return this.computedIsCrossChain&&e>0}setSwapAndLimitTypeValue(e){let{computedCurrentTabIsLimit:t}=this.commonStore,{clearSellAndReceive:r}=this.rootStore?.limitOrderControlStore||{};t?r?.():qe(e)?(this.setField(y.FROM),this.advanceSetTypedValue(e)):this.advanceSetTypedValue("")}get computedLeverageTokenPair(){return to(this.from,this.to)}get computedFormToTokenIsLeverageToken(){let[e,t]=this.computedLeverageTokenPair;return!!e||!!t}get computedIsFromBtcChain(){return Ar(this.from.chainId)}get computedIsFromBtcCoin(){return this.computedIsFromBtcChain&&this.from.isNativeToken}get computedUnavailableBalance(){return D(this.from.balance).minus(this.from.availableBalance).toString()}},ho=wt(yt);var Re=class extends ho{constructor(t){super(t);a(this,"getDeposit",()=>()=>{});a(this,"addFundsParams",{});a(this,"closeAddFunds",()=>{this.visibleAddFunds=!1});a(this,"onClickAddFunds",()=>{let{tokenSymbol:t,chainName:r,tokenLogoUrl:o,chainId:n,isNativeToken:s,tokenContractAddress:i}=this.from;this.visibleAddFunds=!0;let c={currency:t,network:r,iconUrl:o,chainId:n,isNativeToken:s,tokenContractAddress:s?"":i,receiveOnly:!0};this.baseAddFunds(c)});a(this,"baseAddFunds",t=>{this.visibleAddFunds=!0,this.addFundsParams={...t}});a(this,"tokenReplaceMainToken",(t,r)=>{let o=t,n=!Lr(t),{fromDexMultiTokenInfoVO:s}=this.getDexMultiDefaultTokenInfo(n?r:t.chainId),{tokenSymbol:i,chainId:c}=s;return!n&&(this.commonStore.getTokenAddress(t)===(this.commonStore.isSensitiveChain(c)?i:De(i))||this.commonStore.getTokenAddress(t)===this.commonStore.getTokenAddress(s))&&(o={...s,amount:t.amount}),o});Qe(this),Fe(()=>{let{computedDiffCrossChain:r,to:o}=this;return{computedDiffCrossChain:r,toChainId:o?.chainId}},({computedDiffCrossChain:r,toChainId:o})=>{this.cacheToChainId!==o&&this.rootStore.receiveAddressStore.saveReceiveAddressValue({}),this.rootStore.receiveAddressStore.setCacheToChainId(r&&o?o:-1)},{equals:zt.shallow})}};l();u();l();u();var Rt=class{constructor(e){a(this,"receiveAddrStatus",Ce.NORMAL);a(this,"receiveAddrObj",{});a(this,"saveReceiveAddressValue",e=>{this.receiveAddrObj=this.filterReceiveWalletInfo(e),e?.specifiedAddress||this.initCheckAddrStatus()});a(this,"clearReceiveAddressValue",()=>{this.receiveAddrObj={},this.initCheckAddrStatus(),this.walletAddrInWeb3=[],this.getLinkedWalletAddrInWeb3().catch(()=>{})});a(this,"checkReceiveAddressLoading",!1);a(this,"filterReceiveAddress",(e,t,r=!0)=>{let o=t?.specifiedAddress||this.receiveAddrObj?.specifiedAddress||"";return o?e.filter(({specifiedAddress:n})=>r?n.includes(o):n===o):e});a(this,"filterReceiveWalletInfo",e=>{if(!e.specifiedAddress||e.walletId)return e;let t=this.filterReceiveAddress(this.initWalletAddrListFromChain,e,!1);return t.length?t[0]:e});a(this,"initCheckAddrStatus",()=>{this.checkReceiveAddressLoading=!1,this.receiveAddrStatus=Ce.NORMAL});a(this,"checkReceiveAddr",async e=>{if(e||this.receiveAddrObj.specifiedAddress){this.checkReceiveAddressLoading=!0;let{to:t}=this.rootStore.fromToStore,r=Symbol("requestId");this.currentRequestId=r;let[o,n]=await O(P.get(fr,{params:{address:e||this.receiveAddrObj.specifiedAddress,chainId:t?.chainId}}));if(this.checkReceiveAddressLoading=!1,o){h.stuff(o),this.receiveAddrStatus=Ce.ILLEGALITY;return}this.currentRequestId===r&&Me(()=>{this.receiveAddrStatus=n.data.status})}else this.initCheckAddrStatus()});a(this,"getSpecifiedChainWalletList",async e=>{let t=await this.getSpecifiedChainWalletListByWeb3(e),r={};return t?.forEach(o=>{let{specifiedAddress:n,walletType:s,createTime:i}=o,c=s===er.OKEXCHAIN;r[n]&&r[n]?.has&&c?r[n].walletInfo.createTime<i&&(r[n].walletInfo=o):(!r[n]?.has||c)&&(r[n]={walletInfo:o,has:c})}),Object.keys(r).map(o=>r[o].walletInfo)});a(this,"walletAddrInWeb3",[]);a(this,"getLinkedWalletAddrInWeb3",async()=>{let{computedDiffCrossChain:e,to:t}=this.rootStore.fromToStore,{computedAccountId:r}=this.rootStore.accountStore;if(!e)return;let[o,n]=await O(this.getSpecifiedChainWalletList({chainId:t.chainId,walletIds:[r]}));o||Me(()=>{this.walletAddrInWeb3=n})});a(this,"initWalletAddrListFromChain",[]);a(this,"initWalletAddrListInStorage",[]);a(this,"filterWalletAddrListFromChain",[]);a(this,"filterWalletAddrListInStorage",[]);a(this,"getWalletList",async()=>{let{to:e}=this.rootStore.fromToStore,t=await this.getSpecifiedChainWalletList({chainId:e.chainId});Me(()=>{this.initWalletAddrListFromChain=t,this.filterWalletAddrListFromChain=t;let r=Z.get(_e);if(r){let o=r[e.chainId]||[];this.initWalletAddrListInStorage=o,this.filterWalletAddrListInStorage=o}})});a(this,"getFilteredAddrList",e=>{this.filterWalletAddrListFromChain=this.filterReceiveAddress(this.initWalletAddrListFromChain,e),this.filterWalletAddrListInStorage=this.filterReceiveAddress(this.initWalletAddrListInStorage,e)});a(this,"saveWalletAddressToStorage",e=>{this.receiveAddrObj?.specifiedAddress&&Z.set(_e,{[e.chainId]:[this.receiveAddrObj]})});a(this,"formatInputValue",e=>{let{specifiedAddress:t,deriveName:r,label:o}=e;if(t.length<=9)return t;let n=Ke(e.specifiedAddress);return r&&(n=`(${n})`,o?n=`${r} - ${o} ${n}`:n=`${r} ${n}`),n});this.rootStore=e}get computedSwapHighLight(){return this.receiveAddrStatus===Ce.NORMAL&&!!this.receiveAddrObj?.specifiedAddress}get computedFormatReceiveAddr(){return this.receiveAddrObj?.specifiedAddress?this.formatInputValue(this.receiveAddrObj):""}get computedReceiveAddr(){return this.receiveAddrObj?.specifiedAddress||""}async getSpecifiedChainWalletListByWeb3(){return[]}get computedWalletAddrInWeb3(){return this.walletAddrInWeb3.length?this.walletAddrInWeb3[0]:null}get isFromFilterAddress(){let e=this.filterReceiveAddress(this.initWalletAddrListFromChain,this.receiveAddrObj?.specifiedAddress,!1),t=this.filterReceiveAddress(this.initWalletAddrListInStorage,this.receiveAddrObj?.specifiedAddress,!1);return!!(e.length+t.length)&&!!this.receiveAddrObj?.specifiedAddress}},fo=Rt;var Ot=class extends fo{constructor(t){super(t);a(this,"formatInputValueEx",(t,r)=>{let{keyringName:o,walletName:n}=t;if(r.length<=9)return r;let s=Ke(r);return o&&(s=`(${s})`,n?s=`${o} - ${n} ${s}`:s=`${o} ${s}`),s});a(this,"cacheToChainId",-1);a(this,"setCacheToChainId",t=>{this.cacheToChainId=t});a(this,"addressListEx",[]);a(this,"getWalletListEx",()=>{let{accountStore:t,fromToStore:r}=this.rootStore,o=q.getNetWorkName(r.to.chainId),{walletList:n,addressBookList:s,keyringIdentityTypeEnum:i}=t,m=(Z.get(_e)||{})[r.to.chainId]||[],p=Zr(s,o),C=Jr(n,o);this.addressListEx=eo({recentAddrData:m,addressBookData:p,walletListData:C,chainName:o,keyringIdentityTypeEnum:i})});Qe(this)}get computedFormatReceiveAddrEx(){let{accountStore:t,fromToStore:r}=this.rootStore,{walletConfig:o}=t;if(this.receiveAddrObj.specifiedAddress)return this.formatInputValueEx(this.receiveAddrObj,this.receiveAddrObj.specifiedAddress);let n=q.getNetWorkName(r.to.chainId),s=o?.account[n];return s?(this.receiveAddrObj={...o,specifiedAddress:s},this.formatInputValueEx(o,s)):""}},go=Ot;l();u();se();var Pt=class{constructor(e){a(this,"orderCheckContinue",async e=>{let[t,r]=await O(P.get(mr,{params:e}));if(t)return ae.error({title:f("swaptrade_history_toast_setup_error"),duration:ie}),!1;let o=A(r,"data"),n=String(o?.checkCode);return n===he.SUCCESS?!0:(n===he.SINGLE_ERROR||n===he.LIMIT_SINGLE_ERROR?ae.error({title:f("swaptrade_history_toast_chain_unsupported",{chain:o?.fromChainName}),duration:ie}):n===he.CROSS_ERRORL||n===he.LIMIT_CROSS_ERRORL?ae.error({title:f("swaptrade_history_toast_both_unsupported",{fromChain:o?.fromChainName,toChain:o?.toChainName}),duration:ie}):ae.error({title:f("swaptrade_history_toast_setup_error"),duration:ie}),!1)});this.rootStore=e,Be(this,{},{autoBind:!0})}},So=Pt;l();u();var rt=w(W());l();u();l();u();l();u();var To=Qr(["isWalletConfirm","isConfirmLoading","txInfo","confirmSwapVisible","walletConfirming","walletSignConfirming"],["computedEstimateGasFee","computedCrossChainFromFee","computedQuote"]);l();u();se();l();u();se();var jo=/\s/,xt=d=>!(!Bt(d)||jo.test(d)||d.length<10);var Oe=class{constructor(e){this.walletSignConfirming=!1;this.defaultGasFee="--";this.isWalletConfirm=!1;this.isConfirmLoading=!1;this.txInfo={};this.confirmSwapVisible=!1;this.calldataSign=null;this.cacheVerifyCallDataResult=null;this.autoShowDialog=!0;this.solanaSwapParams=null;this.walletConfirming=!1;this.setWalletConfirm=e=>{this.isWalletConfirm=e};this.resetTxInfo=()=>{this.txInfo={}};this.setConfirmSwapVisible=e=>{this.confirmSwapVisible=e};this.setAutoShowDialog=e=>{this.autoShowDialog=e};this.setCalldataSign=e=>{this.calldataSign=e};this.setCacheVerifyCallDataResult=e=>{this.cacheVerifyCallDataResult=e};this.setSolanaSwapParams=e=>{this.solanaSwapParams=e};this.showRecentTransactionModal=e=>{this.confirmSwapVisible=!1,this.rootStore.recentTransactionStore.showModal(e)};this.saveOrderParamsExtendSlippageAndGasPrice=e=>{let t={...e},{computedQuote:r}=this,{computedIsSingleChain:o,computedDefaultAutoSlippageInfo:n}=this.rootStore.fromToStore,{autoSlippageInfo:s}=r.bestRoute||{},i=Kr({isSingleChain:o,autoSlippageInfo:n}),c={autoSlippageInfo:s||{}},m=A(this,"rootStore.slippageStore");return m&&(i=m.computedRealSlippageValue,c=m.getOrderSlippageInfo()),Object.assign(t,{slippage:String(i),...jr({slippageInfo:c,isSingleChain:o})})};this.extendSaveOrderParams=e=>e;this.extendSignParams=async e=>{let t={...e},r=A(this.rootStore.quoteStore,"quote.bestRoute.permit2Data");if(r&&!this.calldataSign){let[o,n]=await this.checkPermit2();if(o)return null;this.setCalldataSign(n),t={...t,unsignedTx:r?.unsignedTx,signature:n}}else r&&this.calldataSign&&(t={...t,unsignedTx:r?.unsignedTx,signature:this.calldataSign});return t};this.checkPermit2=async()=>{let e=A(this.rootStore.quoteStore,"quote.bestRoute.permit2Data"),t=A(this.rootStore.quoteStore,"quote.bestRoute.fromToken.chainId"),{signTransaction:r}=this.rootStore.sendTransactionStore,o=e?.unsignedTx,[n,s]=await r(o,t);return n&&(h.error(T.SIGN_PERMIT2_DATA,{error:n,unsignedTx:o}),fe(n)||z.error({title:f("swaptrade_trading_mode_alert_order_fail"),placement:z.DIRECTION.top})),[n,s]};this.resetFromToAmount=()=>{this.rootStore.fromToStore.updateFrom({amount:"",currentTime:"",prevAmount:"",usdPrice:""}),this.rootStore.fromToStore.updateTo({amount:"",prevAmount:"",usdPrice:"",currentTime:""}),this.rootStore.fromToStore.advanceSetTypedValue("")};this.getExtParams=e=>{let{computedIsSingleChain:t,to:r,from:o,computedDiffCrossChain:n}=this.rootStore.fromToStore,{receiveAddrObj:s}=this.rootStore.receiveAddressStore,i=n?s?.specifiedAddress:r.tokenContractAddress;return{txSource:3,orderId:e,toTokenAddress:i,crossChain:t?0:1,chainId:o.chainId,tokenAddress:o.tokenContractAddress,amount:o.amount,toChainId:r.chainId}};this.checkCallData=async({chainId:e,responseData:t,requestParams:r})=>{let{computedAccountId:o,computedSignWalletAddress:n}=this.rootStore.accountStore,s=await Pr({callData:t?.callData?.data,chainId:e,hasReferralCommission:t?.hasReferralCommission,address:n});return s.success||this.setCacheVerifyCallDataResult({...s,walletId:o,requestCommissionAddress:r?.serviceFeeInfo?.referralCommissionAddress}),s};this.logVerifyCallDataResult=({txHash:e,orderId:t})=>{this.cacheVerifyCallDataResult&&!this.cacheVerifyCallDataResult.success&&(Or({...this.cacheVerifyCallDataResult,txHash:e,orderId:t}),this.setCacheVerifyCallDataResult(null))};this.handleSignOrSendTransactionSuccess=async e=>{let{transactionHash:t,nonce:r,orderData:o}=e,{callData:n,orderId:s,swapParams:i}=o,{computedIsEvmChain:c,from:m}=this.rootStore.fromToStore;if(this.walletSignConfirming=!1,!xt(t))throw new Error(`hash format is invalid: ${t}`);return this.txInfo={...n,txHash:t},o.approveTxInfo?await this.sendTransactionOrUpdateHash(e):new j.BigNumber(r).isNaN()?(this.sendTransactionOrUpdateHash({orderId:s,transactionHash:t}),c&&xr(t,this.rootStore.fromToStore.from.chainId).then(p=>{p&&(h.info(T.UPDATE_NONCE,{nonce:p.nonce,tags:{orderId:s}}),this.sendTransactionOrUpdateHash({orderId:s,transactionHash:t,nonce:p.nonce}))}).catch(p=>{h.error(T.UPDATE_NONCE_FAIL,{error:p})})):this.sendTransactionOrUpdateHash({orderId:s,transactionHash:t,nonce:r}),this.afterTransaction(s,{txHash:t,chainId:i.chainId,txType:"SWAP"}),this.logChainId({message:T.CHECK_CHAIN_ID_AFTER_SEND_TRANSACTION,fromChainId:m.chainId,saveOrderChainId:i.chainId,orderId:s}),this.logVerifyCallDataResult({txHash:t,orderId:s}),!0};this.widgetSubmitTxEvent=e=>{};this.formatClaimPayload=(e,t)=>{let{orderId:r,toChainId:o}=t;return At({chainId:o},{orderData:e,extParams:{txType:86,txSource:3,orderId:r,toTokenAddress:t.toTokenAddress,chainId:t.chainId||t.fromChainId,tokenAddress:t.fromTokenAddress,amount:t.fromAmount,toChainId:o}},this).getSendTransactionParams()};this.fetchClaimCalldata=async(e,t)=>{let{orderId:r}=e,[o,n]=await O(P.post(nr,{mainOrderId:r,payerWalletAddress:t}));if(o)return h.error(T.FETCH_CLAIM_CALDATA_ERROR,{error:o,tags:{orderId:r}}),z.error({title:o?.error_message||f("swaptrade_home_toast_initiation_error"),placement:z.DIRECTION.top}),null;let s=A(n,"data",{});return{payload:await this.formatClaimPayload(n?.data||{},e),sourceClaimPayload:s}};this.updateClaimOrder=e=>{h.info(T.UPDATE_CLAIM_ORDER,{params:e,tags:{orderId:e.mainOrderId}}),P.post(sr,e)};this.rootStore=e,this.gasDropStore=e.gasDropStore}get computedEstimateGasFee(){let e=this.defaultGasFee,t=this.rootStore.commonStore.nowCurrencyUnit,r=A(this.computedQuote.bestRoute,"quoteNetWorkFeeOfMoney");if(this.isSwapSolana(this.rootStore.fromToStore.from.chainId)&&this.rootStore.quoteStore.enableQuoteAggregates){let n=A(this.rootStore.solanaPriorityFeeStore,"computedPriorityFeeOfUsd",0);r=j.add(n,r,{returnString:!0})}let o=new j.BigNumber(r).multipliedBy(A(t,"usdToThisRate"));return!ue(t)&&!o.isNaN()&&(e=ht(o.toString(),{currencySign:t?.symbol}).value),e}get computedCrossChainFromFee(){let e=A(this.computedQuote.bestRoute,"fromSwapFeeUsd");if(!e||Vt(Number(e)))return"--";let{computedNowCurrencySymbol:t,currencyConversion:r}=this.rootStore.commonStore,o=r(e).toString();return ht(o,{currencySign:t}).value}get computedQuote(){return this.rootStore.quoteStore.quote}checkRepeatOrderDetail(e){e&&this.rootStore.recentTransactionStore.showModal(e)}baseSaveOrderParams(){let{computedQuote:e}=this,{from:t,to:r}=this.rootStore.fromToStore,{estimateGasFee:o,minimumReceived:n,defiPlatformId:s,traceData:i}=e.bestRoute||{},{computedIsMevOpen:c}=this.rootStore.mevStore,m={chainId:t.chainId,fromAmount:this.rootStore.quoteStore?.computedQuoteAmount,fromTokenAddress:t.tokenContractAddress,fromTokenDecimal:String(t.decimals),toAmount:r.reverseReceiveAmount,toTokenAddress:r.tokenContractAddress,toTokenDecimal:String(r.decimals),userWalletAddress:this.rootStore.accountStore.address,estimateGasFee:o,pmm:"1",minimumReceived:n,openMev:c,toChainId:r.chainId,traceData:i};s&&(m.defiPlatformId=s);let p=this.rootStore.outerStore.extendFeeConfig(m);return this.saveOrderParamsExtendSlippageAndGasPrice(p)}saveOrderParams(){let e=this.baseSaveOrderParams();return this.extendSaveOrderParams(e)}async onGenerateCallData(e){return h.info(T.SAVE_ORDER_PARAMS,{data:e}),{}}onSaveOrder(e){let t={...e,...so()};return h.info(T.SAVE_ORDER_PARAMS,{data:t}),Gr(t)}saveOrderErr(e){let{error_code:t,error_message:r=""}=e;return h.error(T.SAVE_ORDER_ERROR,{error:e}),t==="10014"?z.error({title:f("swaptrade_toast_trade_not_available"),placement:z.DIRECTION.top}):z.error({title:r||f("swaptrade_toast_save_order_fail"),placement:z.DIRECTION.top})}saveOrderError(e){this.saveOrderErr(e),this.isConfirmLoading=!1,h.removeKeep()}walletErrorMessage(e){let t=null;try{t=JSON.parse(e?.message)}catch{t={}}return t}walletErrToast(e,t){let r,o=this.walletErrorMessage(e);if(h.error(T.SEND_ERROR,{error:e,tags:{orderId:t}}),o?.code===Ue.SLIPPAGE_LOW)r=f("swaptrade_home_toast_slippage_too_low");else if(o?.code===Ue.SEND_TX_ERROR_CODE)r=o?.message;else if(o?.code===Ue.NOT_TIPS)return null;return z.error({title:r||f("swaptrade_home_toast_broadcast_failed"),placement:z.DIRECTION.top,duration:0})}onWalletFail(e,t,r=!1){fe(e)?r||this.cancelOrder(t):e?.code!==or.RECEIPT_ERROR&&(Ee.emit(ke.FAIL,{data:{orderId:t},status:-2,message:it("transaction fail")}),this.walletErrToast(e,t)),h.error(T.ON_WALLET_FAIL,{error:e,tags:{orderId:t}})}extendEvmParams(e){return e}isOkxWallet(){}async getTransactionPayload({orderData:e,orderId:t}){let{from:r,computedIsSingleChain:o}=this.rootStore.fromToStore,n=At(r,{orderData:e,extParams:this.getExtParams(t)},this),s=o&&no.supportCustomGasFee;return n.getSendTransactionParams({needGasPrice:s})}sendTransactionEnhance(...e){return this.rootStore.sendTransactionStore.sendTransaction(...e)}get walletSendParams(){return{}}getTransaction(){}logChainId(e){return!0}async doubleCheckChainId(e){return!0}async onChainTransaction(e){let{approveTxInfo:t,orderId:r,swapParams:o}=e,n=await this.getTransactionPayload({orderData:e,orderId:r}),{from:s}=this.rootStore.fromToStore;if(h.info(T.PAYLOAD,{payload:n,tags:{orderId:r}}),this.logChainId({message:T.CHECK_CHAIN_ID_BEFORE_SEND_TRANSACTION,fromChainId:s.chainId,saveOrderChainId:o.chainId,orderId:r}),!await this.doubleCheckChainId({saveOrderChainId:o.chainId,orderId:r}))return!1;if(this.walletSignConfirming=!0,t){let{transactionPayload:c}=ve({approveTxInfo:t,params:{chainId:o.chainId,isOnlySign:!0}});return Hr.signApproveAndSwap({chainId:o.chainId,approveParams:{payload:c,transactionData:t},swapParams:{payload:n[0],transactionData:e}}).then(({transactions:m,transactionHash:p})=>this.handleSignOrSendTransactionSuccess({transactionHash:p,transactions:m,orderData:e,fromTokenAddress:ze(s)}))}return St({chainId:s.chainId,walletType:this.rootStore.accountStore.walletConfig?.walletType,walletSendParams:this.walletSendParams},...n).then(({result:c,nonce:m})=>this.handleSignOrSendTransactionSuccess({transactionHash:c,nonce:m,orderData:e}))}afterTransaction(e,t){this.setWalletConfirm(!0),this.autoShowDialog&&this.showRecentTransactionModal(e),Ee.emit(ke.TXHASH,{status:0,data:R(this.txInfo),message:it("Transaction hash has been generated")}),this.widgetSubmitTxEvent(t)}async onSwap(e){this.isConfirmLoading=!0,h.keepLive(),this.setCalldataSign(null);let t=null;if(e)t=this.rootStore.outerStore.extendFeeConfig(e);else{let s=await this.saveOrderParams();t=await this.extendSignParams(s)}if(!t){this.isConfirmLoading=!1;return}if(this.isSwapSolana(this.rootStore.fromToStore.from.chainId)){await this.onSolanaSwap(t);return}let[r,o]=await O(this.onGenerateCallData(t));if(r){this.saveOrderError(r);return}h.info(T.SAVE_ORDER,{data:o?.data,tags:{orderId:o?.data.orderId}}),yr({...Ye(),order_id:o?.data.orderId,wallet_type:this.rootStore.accountStore.walletConfig?.walletType}),this.checkCallData({chainId:t.chainId,responseData:o?.data||{},requestParams:t}).catch(()=>{});let[n]=await O(this.onChainTransaction({...o?.data,swapParams:t}));n&&(this.walletSignConfirming=!1,this.onWalletFail(n,o?.data?.orderId)),this.isConfirmLoading=!1,h.removeKeep()}async onClaim(e){let{getAddressByChainId:t}=this.rootStore.accountStore,r=t(e.toChainId),o=await this.fetchClaimCalldata(e,r);if(!o||!o.payload)return!1;let{payload:n}=o;return await this.doubleCheckChainId({saveOrderChainId:e.toChainId,orderId:e.orderId})?(this.walletConfirming=!0,h.info(T.CLAIM_PAYLOAD,{payload:n,tags:{orderId:e.orderId}}),St({chainId:e.toChainId,walletType:this.rootStore.accountStore.walletConfig?.walletType,walletSendParams:this.walletSendParams},...n).then(({result:i,nonce:c})=>{if(this.walletConfirming=!1,!xt(i))throw new Error(`hash format is invalid: ${i}`);new j.BigNumber(c).isNaN()?this.updateClaimOrder({mainOrderId:e.orderId,redeemTxHash:i}):this.updateClaimOrder({mainOrderId:e.orderId,redeemTxHash:i,nonce:c})}).catch(i=>{this.walletConfirming=!1,this.onWalletFail(i,e.orderId,!0)})):!1}};var Pe=class extends Oe{constructor(t){super(t);a(this,"sendTransactionEnhance",t=>{let{from:r}=this.rootStore?.fromToStore,{walletSendParams:o}=this.rootStore.walletContractStore;return this.rootStore.sendTransactionStore.sendTransaction(r.chainId,t,o).then(n=>vr(r.chainId,n))});a(this,"showRecentTransactionModal",t=>{this.isConfirmLoading=!1,this.confirmSwapVisible=!1,h.stuff(`orderId: ${t}`),q.history.go(-1);let{advanceSetTypedValue:r}=this.rootStore?.fromToStore;r?.("")});a(this,"baseSaveOrderParams",()=>({...super.baseSaveOrderParams()}));a(this,"extendsGas",t=>{let r={...t},{gasInfo:o}=this.rootStore.walletContractStore,{gasLimitInfo:n,isGasLimitLoading:s,gasType:i,...c}=o;return r.extParams.gasType=i,{...r,gasInfo:c}});a(this,"extendEvmParams",(t,r=!1)=>{let o=super.extendEvmParams(t),{activityId:n}=this.rootStore.walletContractStore,s=this.rootStore.quoteStore.quote?.bestRoute?.isEnableMev;n&&(o.extParams.activityId=n);let{computedIsMevOpen:i,mevInfo:c,walletMevControl:m}=this.rootStore.mevStore;return o.extParams.isMev=i||m||r,o.extParams.mevInfo=c,!r&&Number(s)===Yt.ON&&(o.extParams.isShowBlockSwapMevTooltip=!0),o});a(this,"extendTronParams",t=>{let r={...t},{maxGasFeeInt:o}=this.rootStore.walletContractStore;return r.maxGasFeeInt=o,r});a(this,"onWalletFail",(t,r)=>{this.isConfirmLoading=!1,!t?.message?.includes(q.global?.HARDWALLETERROR)&&super.onWalletFail(t,r)});a(this,"checkRepeatOrderDetail",t=>{t&&q.history.push(`${jt}/${t}`)});a(this,"onSwap",async t=>{let{computedIsOfflineType:r}=this.rootStore.quoteStore;r?await this.rootStore.intentSwapStore?.onIntentSwap():await super.onSwap(t)});a(this,"getSaveOrderMonitorData",()=>({...Ye(),...this.rootStore.walletContractStore.computedMonitorGasType}));a(this,"onClaim",t=>{q.history.push(`${$t}?orderId=${t.orderId}&source=orderDetail`)});Kt(this,To)}isOkxWallet(){return!0}getTransaction(){}walletErrorMessage(t){return t}};var et=class{constructor(){this.receiveAddressStore=new go(this),this.commonStore=new Xr(this),this.accountStore=new Yr(this),this.fromToStore=new Re(this),this.swapStore=new Pe(this),this.recentTransactionStore=new ao(this),this.oneMoreOrderStore=new So(this),this.sendTransactionStore=new oo(this)}};l();u();var re=w(W()),Do=w(Gt());l();u();var V=w(W());l();u();var F=w(W()),J=w(Le());l();u();var Nt=w(W()),Co=w(Le());var $o=({expireTime:d,absoluteContent:e})=>Nt.default.createElement("div",{className:(0,Co.default)(S.expireTime,e&&S.absoluteExpireTime)},Nt.default.createElement("div",{className:S.expireTimeContent},Cr(d*1e3,{hideZero:!0})||"--")),tt=$o;var Qo=d=>{let t=S.loader,r=o=>({icon:F.default.createElement(v.Circle,{size:v.SIZE.md,type:v.TYPE.neutral,loaderClassName:t,className:S.loaderWrap}),descClassName:(0,J.default)(S.pendDescKey),descKey:o});switch(d){case k.Pending:return r("swaptrade_order_status_pending");case k.Succeed:return{icon:F.default.createElement(x,{className:(0,J.default)("okds-success-circle",S.successIcon),size:24}),descKey:"swaptrade_order_status_succeed"};case k.PendingWithdrawn:return{icon:F.default.createElement(x,{className:(0,J.default)("okx-defi-marketplace-clock"),size:24}),descKey:f("swaptrade_history_cell_tag_processing")};case k.Failed:return{icon:F.default.createElement(x,{className:(0,J.default)("okds-fail-circle",S.failIcon),size:24}),descKey:"swaptrade_orders_text_details_order_failed",descClassName:S.failDesc};case k.Canceling:return{icon:F.default.createElement(v.Circle,{size:v.SIZE.md,type:v.TYPE.neutral,loaderClassName:t,className:S.loaderWrap}),descKey:"swaptrade_placeorder_title_canceling"};case k.Canceled:return{icon:F.default.createElement(x,{className:(0,J.default)("okds-fail-circle",S.cancelIcon),size:24}),descKey:"swaptrade_placeorder_title_transaction_canceled"};case k.ReadyToClaim:case k.ClaimFailed:return{icon:F.default.createElement(x,{size:24,className:(0,J.default)("okx-defi-dex-ready-to-claim")}),descKey:"swaptrade_bridge_cell_tag_ready_to_claim"};case k.Claiming:return{icon:F.default.createElement(v.Circle,{size:v.SIZE.md,type:v.TYPE.neutral,loaderClassName:t,className:S.loaderWrap}),descKey:"swaptrade_bridge_header_claiming"};default:return{}}};function Yo({order:d,className:e="",computedPendingTimingStatus:t,expireTime:r,showExpireTime:o}){let{status:n}=d,s=[k.Waiting,k.SpeedingUp].includes(n)?k.Pending:n,i=Qo(s);return F.default.createElement("div",{className:S.headerStatusWrap},F.default.createElement("div",{className:(0,J.default)(S.status,e)},F.default.createElement("span",{className:S.headerStatusIcon},i?.icon),F.default.createElement("div",{className:(0,J.default)("font-700 font-18 content-primary",S.desc,i?.descClassName)},f(i?.descKey)||i?.descKey)),o&&s===k.Pending&&t===Ze.ESTIMATE&&F.default.createElement(tt,{expireTime:r}))}var Ao=Yo;l();u();var B=w(W()),K=w(Le());var Xo=(d,e)=>{let r=(0,K.default)({[S.loader]:!e});switch(Number(d)){case $.COMPLETED:return{icon:B.default.createElement(x,{className:(0,K.default)("okds-success-circle",S.successIcon),size:24}),descKey:"swaptrade_tee_header_completed"};case $.ACTIVE:return{icon:B.default.createElement(x,{className:(0,K.default)("okds-pending-circle",S.blueIcon),size:24}),descKey:"swaptrade_tee_header_active"};case $.TRADING:return{icon:B.default.createElement(v.Circle,{size:v.SIZE.xl,type:v.TYPE.neutral,loaderClassName:r,className:S.loaderWrap}),descKey:"swaptrade_tee_cell_header_trading"};case $.FAILED:return{icon:B.default.createElement(x,{className:(0,K.default)("okds-fail-circle",S.failIcon),size:24}),descKey:"swaptrade_orders_text_details_order_failed",descClassName:S.failDesc};case $.CREATING:return{icon:B.default.createElement(v.Circle,{size:v.SIZE.xl,type:v.TYPE.neutral,loaderClassName:r,className:S.loaderWrap}),descKey:"swaptrade_tee_header_creating_order"};case $.EXPIRED:return{icon:B.default.createElement(x,{className:(0,K.default)("okds-clock",S.greyIcon),size:24}),descKey:"swaptrade_tee_header_expired"};case $.CANCELLING:return{icon:B.default.createElement(x,{className:(0,K.default)("okds-pending-circle",S.blueIcon),size:24}),descKey:"swaptrade_tee_cell_header_canceling"};case $.CANCELLED:return{icon:B.default.createElement(x,{className:(0,K.default)("okds-warning-circle",S.greyIcon),size:24}),descKey:"swaptrade_tee_header_canceled"};case $.SUSPENDED:return{icon:B.default.createElement(x,{className:(0,K.default)("okds-warning-circle",S.greyIcon),size:24}),descKey:"swaptrade_tee_header_suspended"};default:return{}}};function Zo({order:d,isWalletEnv:e,className:t}){let{status:r}=d,o=Xo(r,e);return B.default.createElement("div",{className:S.headerStatusWrap},B.default.createElement("div",{className:(0,K.default)("text-center",S.status,t)},B.default.createElement("span",{className:S.headerStatusIcon},o?.icon),B.default.createElement("div",{className:(0,K.default)("font-700 font-18 content-primary",o?.descClassName)},f(o?.descKey))))}var _o=Zo;l();u();var xe=w(W()),Io=w(Le());var Jo=({isLimit:d,order:e,computedPendingTimingStatus:t,expireTime:r,onBack:o=()=>{},showBackButton:n,hideBackButton:s=!1})=>{let{status:i}=e||{},c=[k.Waiting,k.SpeedingUp].includes(i)?k.Pending:i;return{renderTopLeft:()=>s?xe.default.createElement("div",{style:{width:56}}):n||d?xe.default.createElement(x,{className:(0,Io.default)("okx-defi-dex-arrow-left",S.backIcon),size:24,onClick:o}):c===k.Pending&&t===Ze.ESTIMATE?xe.default.createElement(tt,{expireTime:r,absoluteContent:!0}):xe.default.createElement("div",{style:{width:56}}),topClassName:d?"":S.topWrapper}},ko=Jo;l();u();l();u();l();u();function Eo(d,e){me.error({title:d.error_message||d.msg||f(e||"swaptrade_home_toast_initiation_error"),placement:me.DIRECTION.top})}async function vo(d,{isSilent:e=!1}){h.info(T.INTENTION_ACTIVE_ORDER_START,{orderIds:d,orderCount:d.length,isSilent:e});try{let t=await Tt(),{currentWalletId:r}=t,{authToken:o}=await ge.getAuthToken(r),n={needSign:!0,headers:{"X-Web3-Auth":o||""}},[s,i]=await O(P.post("/priapi/v1/dx/strategy/common/reactivate",{accountId:r,orderIds:d},n));if(s){if(Number(s?.code)===Xe)return ge.removeAuthToken(),kt.update({authDialogVisible:!0}),!1;throw h.error(T.INTENTION_ACTIVE_ORDER_ERROR,{orderIds:d,error:s}),Eo(s,"swaptrade_tee_notification_header_unable_to_resume_some"),s}return h.info(T.INTENTION_ACTIVE_ORDER_SUCCESS,{orderIds:d,result:i}),i}catch(t){throw h.error(T.INTENTION_ACTIVE_ORDER_ERROR,{orderIds:d,error:t}),t}}async function wo(d,{isSilent:e=!1}){h.info(T.INTENTION_CANCEL_ORDER_START,{orderIds:d,isSilent:e});try{let t=await Tt(),{currentWalletId:r}=t,{authToken:o}=await ge.getAuthToken(r),n={needSign:!0,headers:{"X-Web3-Auth":o||""}},[s,i]=await O(P.post("/priapi/v1/dx/strategy/common/cancel",{accountId:r,orderIds:d},n));if(s){if(Number(s?.code)===Xe)return ge.removeAuthToken(),kt.update({authDialogVisible:!0}),!1;throw h.error(T.INTENTION_CANCEL_ORDER_ERROR,{orderIds:d,error:s}),Eo(s,"swaptrade_tee_notification_header_unable_to_cancel_some"),s}return h.info(T.INTENTION_CANCEL_ORDER_SUCCESS,{orderIds:d,result:i}),i}catch(t){throw h.error(T.INTENTION_CANCEL_ORDER_ERROR,{orderIds:d,error:t}),t}}function yo(d){return Number(d.orderType)===1?It.includes(Number(d.status))&&d?.fromChildOrderDetailVo?.isShowCancel&&gt.supportStatus:It.includes(Number(d.status))}function Ro(d){return Number(d.status)===4&&d.canResume}async function Oo(d){return zr.cancelOrder(d,{isSilent:gt.supportStatus})}async function Po(d,e){return wo([d],e)}async function xo(d,e){return vo([d],e)}var en=(d={})=>![we.SingleChain,we.GasStation,we.LimitOrder,we.MemeMode].includes(d.swapTradeType),tn=(d,e=!1,{onClose:t}={})=>{let r=d||{},o=!e&&en(r),{isSaAccountNormal:n}=wr,s=!pe()&&!o&&yo(r)&&n,i=!pe()&&!o&&Ro(r)&&n,c={text:f("commonall_text_btn_cancel"),action:async()=>{try{if(e){await Po(r.orderId,{}),t?.();return}await Oo({txHash:r.transactionHash,chainId:r.fromChainId,userWalletAddress:r.from}),t?.()}catch(p){throw p}}},m={text:f("swaptrade_tee_dialog_btn_resume"),action:async()=>{try{await xo(r.orderId,{}),t?.()}catch(p){throw p}}};if(i&&s)return{onCancel:c.action,cancelText:c.text,onConfirm:m.action,confirmText:m.text,confirmBtnProps:{block:!0,width:"50%"},cancelBtnProps:{block:!0,width:"50%"}};if(s)return{onConfirm:c.action,confirmText:c.text,confirmBtnProps:{block:!0}};if(i)return{onConfirm:m.action,confirmText:m.text,confirmBtnProps:{block:!0}}},No=tn;l();u();var bo={"loader-wrap":"_loader-wrap_7hvh8_1",loaderWrap:"_loader-wrap_7hvh8_1"};var rn=({orderId:d,onClose:e,visible:t,strategyMode:r=void 0,isLimit:o=void 0,isBridge:n=void 0,orderData:s=void 0,orderType:i=void 0,hideBackButton:c=!1,dialogProps:m={}})=>{let{recentTransactionStore:p,swapStore:C}=je(),{showModal:E}=p,{onClaim:N}=C||{};(0,V.useEffect)(()=>{t&&E(d,{tab:X.SWAP,isLimit:o,isBridge:n,orderData:s,orderType:i,strategyMode:r})},[n,o,s,d,i,E,r,t]);let{computedOrderInfo:I,expireTime:L,computedPendingTimingStatus:M,computedLimitOrderInfo:U}=p||{},Q=(0,V.useMemo)(()=>o?U&&V.default.createElement(_o,{order:U}):I&&V.default.createElement(Ao,{order:I,expireTime:L,computedPendingTimingStatus:M,showExpireTime:!1}),[o,U,I,L,M]),ee=ko({isLimit:!1,order:I,computedPendingTimingStatus:M,expireTime:L,showBackButton:!1,hideBackButton:c}),le=No(o?U:I,o,{onClose:e}),b=(0,V.useMemo)(()=>{let{status:be,toSymbol:Vo}=I||{},nt={onConfirm:()=>{Wr({fromChainId:I.chainId,toChainId:I.toChainId,bridgeRouter:I?.bridgeName}),N?.(I),e?.()},confirmText:f("swaptrade_bridge_btn_claim_token",{token:Vo})};return[k.ReadyToClaim,k.ClaimFailed].includes(be)?{confirmBtnProps:{block:!0},...nt}:be===k.Claiming?{confirmBtnProps:{block:!0,loading:!0,loadingText:nt.confirmText},...nt}:{}},[le,I,N,e]),Ne=(0,V.useRef)(null),Bo=()=>Ne.current;return V.default.createElement(Ht.Action,{noContentPadding:!0,visible:t,onClose:e,title:Q,...ee,...b,scrollBoxRef:be=>{Ne.current=be},...m},V.default.createElement(Br,{fallbackComponent:()=>V.default.createElement(v.Circle,{size:v.SIZE.md,type:v.TYPE.neutral,className:bo.loaderWrap})},V.default.createElement(co,{orderId:d,orderData:s,strategyMode:r,onClose:e,orderType:i,getScrollContainer:Bo,isLimit:o,isBridge:n})))},bt=Ve(rn);var on=({orderId:d,onClose:e,visible:t,showToast:r,currency:o,currentWallet:n,walletInfo:s,onBack:i=()=>{},t:c,dispatch:m,orderType:p=void 0,strategyMode:C=void 0,isLimit:E=void 0,isBridge:N=void 0,orderData:I=void 0})=>{let L=(0,Do.useHistory)();(0,re.useEffect)(()=>{q.setRuntimeContext({history:L,toLocale:c,dispatch:m,walletInfo:s,onBack:i})},[c,L,m,s,i]);let{commonStore:M,accountStore:U,recentTransactionStore:Q}=je();Dr(),(0,re.useEffect)(()=>{M.setCurrentTab(X.SWAP),M.getUserUnit(o)},[]);let ee=Q?.detail?.data?.fromChainId;(0,re.useEffect)(()=>{n&&U.setWalletConfig(n),ee&&U.setFromChainId(ee)},[ee,U,n]);let{computedAccountWalletAddresses:te}=U;(0,re.useEffect)(()=>{let b;return te&&(b=br(te)),()=>{te&&b?.()}},[te]),(0,re.useEffect)(()=>{let b=Nr({isPri:!0,needLogin:!0,subscribeParams:{channel:Vr.DEX_PUSH_ENGINE},onListenData:Ne=>{Q.onSocket(Ne,r)},onListenError:()=>{Q.onSocketError()}});return()=>{b()}},[te,Q,r]);let{initialized:le}=io();return le?re.default.createElement(bt,{orderId:d,visible:t,onClose:e,orderType:p,strategyMode:C,isLimit:E,isBridge:N,orderData:I}):null},Lo=Ve(on);var Mo=new et,nn=Ur(Mo),sn=({orderId:d,onClose:e,visible:t,showToast:r=!1,localeData:o,currency:n,currentWallet:s,walletInfo:i,onBack:c,t:m,dispatch:p,walletGlobalData:C,...E})=>(q.mergeGlobalData(C),rt.default.createElement(nn.Provider,{value:Mo},rt.default.createElement($r,{localeData:o,isDev:!0,noRemoteData:!0,customRender:N=>N},rt.default.createElement(Lo,{orderId:d,onClose:e,visible:t,showToast:r,currency:n,currentWallet:s,walletInfo:i,onBack:c,t:m,dispatch:p,...E})))),Dt=sn;l();u();var oe=w(W()),Lt=w(Gt()),Fo=w(Uo());var an=({orderId:d,onClose:e,...t})=>{let r=document.createElement("div");document.body.appendChild(r);let o=(0,Fo.createRoot)(r),n=()=>{o.unmount(),r.remove(),e&&e()},s=({currentId:c})=>{let[m,p]=(0,oe.useState)(!0);return oe.default.createElement(Dt,{visible:m,orderId:c,onClose:()=>{p(!1),setTimeout(()=>{n()},100)},...t})};return o.render(oe.default.createElement(Lt.HashRouter,null,oe.default.createElement(s,{currentId:d}))),{close:n,updateOrderId:c=>{o.render(oe.default.createElement(Lt.HashRouter,null,oe.default.createElement(s,{currentId:c})))}}},cn=an;l();u();l();u();se();l();u();var ot="NO_CHECK",ne="0",vl="0x".padEnd(66,"f");var Mt=class{constructor(){this.approveTokenDefaultConfig={status:_.Unknown,approvedAmount:ne,tagStatus:_.Unknown,successCallback:void 0,isCombineApproveAndSwap:!1,transactionHash:void 0,approveInfo:null};this.approveTokensConfig={};this.bridgeApproveSocketError=!1;this.getApproveTokenMapKey=(e,t)=>{let r=ze(e);return`${e?.chainId}_${r}_${t}`};this.registerApproveToken=(e,t)=>{let r=this.getApproveTokenMapKey(e,t),o=A(this.approveTokensConfig,r);ue(o)&&(this.approveTokensConfig[r]={...this.approveTokenDefaultConfig})};this.updateApproveTokenConfig=(e,t,r)=>{let o=this.getApproveTokenMapKey(e,t),n=A(this.approveTokensConfig,o),s=ue(n),i=n||this.approveTokenDefaultConfig;this.approveTokensConfig={...this.approveTokensConfig,[o]:{...i,...r}},s&&h.stuff("if you want to update approve token config, you should register it first.")};this.removeApproveTokenConfig=(e,t)=>{let r=this.getApproveTokenMapKey(e,t);delete this.approveTokensConfig[r]};this.getApproveTokenConfig=(e,t)=>{let r=this.getApproveTokenMapKey(e,t);return A(this.approveTokensConfig,r,this.approveTokenDefaultConfig)};this.clearNonApprovingTokensConfig=()=>{let e=Ut(this.approveTokensConfig,t=>[_.Approving,_.CancelApproving].includes(t.status));this.approveTokensConfig={...e}};this.getApprovalStatus=(e,t)=>this.getApproveTokenConfig(e,t).status;this.isApprovalCheckRequired=(e,t,r)=>{let{isNativeToken:o}=e;return(t?!0:r==="1")&&!o&&!Ge(e.chainId)&&!He(e.chainId)};this.validApproveAmountLessSwapAmount=(e,t)=>new j.BigNumber(e).isLessThan(t||ne);this.isValidApprovalStatus=(e,t,r)=>{let o=gr(e),n=this.validApproveAmountLessSwapAmount(e,t);return o?_.UnApproved:n&&r?_.CancelApprove:n?_.UnApproved:_.Approved};this.fetchApproveAllowance=async(e,t,r,o,n,s)=>{let i=()=>P.get(ir,{params:{userWalletAddress:t,tokenContractAddress:e.tokenContractAddress,chainId:e.chainId,defiPlatformIds:r}}).then(p=>p?.data),c=await i();return o&&c&&typeof c=="object"&&Object.keys(c).length>0&&Object.values(c).every(p=>p?.amount===ne)?(h.info(T.APPROVE_RETRY,{approveEventType:s,fromAmount:e.amount,defiPlatformId:n,isCrossChain:!1}),i()):c};this.getApproveUrl=e=>e?{approveDataUrl:dr,saveApproveUrl:ur}:{approveDataUrl:cr,saveApproveUrl:lr};this.fetchApproveData=({approveDataUrl:e,params:t,approveTxInfo:r})=>{if(r)return ve({approveTxInfo:r,params:t});let{isCrossChain:o,...n}=t;return P.get(e,{params:n}).then(s=>ve({approveTxInfo:s?.data,params:t}))};this.isApprovalStatusPending=(e,t)=>{let r=this.getApprovalStatus(e,t);return[_.Approving,_.CancelApproving].includes(r)};this.isCancelApproveStatus=(e,t)=>{let r=this.getApprovalStatus(e,t);return[_.CancelApprove,_.CancelApproving].includes(r)};this.isPendingNeedCheck=async e=>{this.isApprovalStatusPending(e.token,e.defiPlatformId)&&this.checkApprove({...e,needRetry:!0}).catch(()=>{})};this.isPendingNotCheck=async e=>{this.isApprovalStatusPending(e.token,e.defiPlatformId)||this.checkApprove({...e,needCheck:ot}).catch(()=>{})};this.bridgePendingNotCheck=async e=>{(!this.isApprovalStatusPending(e.token,e.defiPlatformId)||this.bridgeApproveSocketError)&&(await this.checkApprove({...e,isCrossChain:!0,needCheck:ot}),this.bridgeApproveSocketError=!1)};this.updateUnnecessaryApproveTokenStatus=(e,t)=>{t.forEach(r=>{this.registerApproveToken(e,r),this.updateApproveTokenConfig(e,r,{status:_.Approved,tagStatus:_.UnApproved})})};this.updateApproveConfigByAllowance=({allowanceData:e,token:t,defiPlatformId:r,needCheck:o})=>{if(!e||ue(e)){this.updateApproveTokenConfig(t,r,{status:_.Unknown,approvedAmount:ne,tagStatus:_.Unknown});return}o===ot&&this.isApprovalStatusPending(t,r)||Object.keys(e).forEach(n=>{let s=e[n];this.calcApproveState({approveInfo:s,token:t,defiPlatformId:n})})};this.checkApprove=async({token:e,userWalletAddress:t,needApprove:r,defiPlatformIds:o,defiPlatformId:n,allowanceData:s={},needCheck:i="",isLimitOrder:c=!1,isCrossChain:m=!1,needRetry:p=!1,approveEventType:C})=>{if(!this.isApprovalCheckRequired(e,c,r)){this.updateUnnecessaryApproveTokenStatus(e,o);return}let{tokenContractAddress:E}=e;if(E&&t){if(!m){let[,N]=await O(this.fetchApproveAllowance(e,t,o,p,n,C));this.updateApproveConfigByAllowance({allowanceData:N,token:e,defiPlatformId:n,needCheck:i});return}this.updateApproveConfigByAllowance({allowanceData:s,token:e,defiPlatformId:n,needCheck:i})}};this.calcApproveState=({approveInfo:e,token:t,defiPlatformId:r})=>{let{decimals:o}=t,n=Number(e.status);if([_.Approving,_.CancelApprove].includes(n))return;let s=Number(e.status)===_.Approved?e.amount:ne,i=Sr(s,o)||ne,c=e?.needCancelApproveToken,m=this.isValidApprovalStatus(i,t.amount||ne,c);this.registerApproveToken(t,r),this.updateApproveTokenConfig(t,r,{status:m,tagStatus:m,approvedAmount:i,approveInfo:e})};this.updateApproveState=({token:e,defiPlatformId:t,userWalletAddress:r,needApprove:o="1"})=>{if(!Tr(e))return;let n=this.getApproveTokenConfig(e,t);n?.approveInfo?this.calcApproveState({approveInfo:n?.approveInfo,token:e,defiPlatformId:t}):this.isPendingNotCheck({token:e,userWalletAddress:r,defiPlatformId:t,needApprove:o})};this.fetchApproveDataErrorTips=(e,t,r)=>{this.updateApproveTokenConfig(e,t,{status:_.UnApproved});let o=de(e?.tokenSymbol);$e({title:r?f("swaptrade_transfer_notification_title_ccy_unrevoked",{ccy:o}):f("swaptrade_toast_approve_fail",{tokenSymbol:o})})};this.approveErrorTips=({error:e,chainId:t,transactionPayload:r,token:o,defiPlatformId:n,cancelApproveTag:s})=>{h.error(T.APPROVE_TOKEN_ERROR,{chainId:t,transactionPayload:r,error:e,token:o,defiPlatformId:n}),fe(e)||me.error({title:e?.error_message||e?.message||e?.msg||f("swaptrade_home_toast_initiation_error"),placement:me.DIRECTION.top}),this.updateApproveTokenConfig(o,n,{status:this.isCancelApprove(s)?_.CancelApprove:_.UnApproved})};this.isCancelApprove=e=>e===ct.CANCEL_APPROVE;this.setApprove=async({token:e,userWalletAddress:t,defiPlatformId:r,isCrossChain:o=!1,cancelApproveTag:n,approveAmount:s,approveTxInfo:i},{isSilentSign:c=!1,isCombineApproveAndSwap:m=!1,successCallback:p}={isSilentSign:!1})=>{h.info(T.SET_APPROVE_PARAMS,{params:{token:e,userWalletAddress:t,defiPlatformId:r,isCrossChain:o,cancelApproveTag:n,approveAmount:s,approveTxInfo:i},config:{isSilentSign:c,isCombineApproveAndSwap:m}});let{chainId:C}=e;this.updateApproveTokenConfig(e,r,{status:this.isCancelApprove(n)?_.CancelApproving:_.Approving,isCombineApproveAndSwap:m,successCallback:p});try{let E={isCrossChain:o,userWalletAddress:t,tokenContractAddress:e.tokenContractAddress,chainId:e.chainId,defiPlatformId:r,cancelApproveTag:n,teeSilentSignEnabled:c};c&&!m&&(E.approveAmount=s);let{id:N,transactionPayload:I,defiPlatformId:L}=await this.fetchApproveData({approveTxInfo:i,approveDataUrl:this.getApproveUrl(o).approveDataUrl,params:E});return await this.approveToken({chainId:C,transactionPayload:I},{isSilentSign:c}).then(async({result:M})=>(this.toastApproveSubmitted({token:e,cancelApproveTag:n,isCombineApproveAndSwap:m}),h.info(T.APPROVE_BROADCAST_SUCCESS,{params:{id:N,chainId:C,transactionHash:M}}),this.updateApproveTokenConfig(e,r,{transactionHash:M}),await this.saveApprove({id:N,chainId:C,transactionHash:M,userWalletAddress:t,isCrossChain:o,cancelApproveTag:n,defiPlatformId:L}),!0)).catch(M=>(this.approveErrorTips({error:M,chainId:C,transactionPayload:I,token:e,defiPlatformId:L,cancelApproveTag:n}),!1))}catch{return this.fetchApproveDataErrorTips(e,r,n),!1}};this.saveApprove=async({id:e,chainId:t,transactionHash:r,userWalletAddress:o,isCrossChain:n,cancelApproveTag:s,defiPlatformId:i,refetchQuote:c})=>{if(!r)return;let m={id:e,transactionHash:r,chainId:t,userWalletAddress:o,cancelApproveTag:s};n&&Wt(m,"defiPlatformId",i),h.info(T.SAVE_APPROVE,m);let{saveApproveUrl:p}=this.getApproveUrl(n),[C]=await O(P.post(p,m));C&&h.info(T.SAVE_APPROVE_ERROR,{error:C?.message,...m}),n&&String(i)!==Xt&&c?.()};this.checkCurrentPushedApproveInfo=(e,t,r,o,n)=>{let{chainId:s,fromTokenAddress:i,platformId:c,defiPlatformId:m}=e,p=o?m:c,C={chainId:Number(s),tokenContractAddress:i},E=ce(t,C),N=String(r)===String(p),I=e.transactionHash===n;return{isCurrentToken:E,isSamePlatform:N,isSameTransactionHash:I,pushedToken:C,pushedPlatformId:p}};this.handleCurrentPushedApproveToken=async({dexData:e,pushedPlatformId:t,token:r,isCrossChain:o,refetchQuote:n,userWalletAddress:s,needApprove:i,approveEventType:c})=>{if(!o)await this.isPendingNeedCheck({token:r,userWalletAddress:s,defiPlatformIds:[t],defiPlatformId:t,needApprove:i,approveEventType:c});else{let m={status:e.status,amount:e.approveAmount,needCancelApproveToken:e.needCancelApproveToken};this.calcApproveState({approveInfo:m,token:r,defiPlatformId:t}),n?.()}};this.toastApproveSubmitted=({token:e,cancelApproveTag:t,isCombineApproveAndSwap:r})=>{if(pe())return;let o="swaptrade_transfer_notification_approval_submit";r&&(o="swaptrade_mid_dialog_toast_success_submitted"),t===ct.CANCEL_APPROVE&&(o="swaptrade_transfer_toast_ccy_unrevoke_submit"),qr({title:f(o,{ccy:de(e.tokenSymbol)})})};this.onSocket=async({data:e,token:t,defiPlatformId:r,isCrossChain:o,refetchQuote:n},s)=>{if(e?.type==="1"&&e?.dexData&&e.dexData.type==="approve"){let i=e.dexData,{status:c,transactionHash:m,fromTokenSymbol:p,exploreUrl:C,solanaToast:E,userWalletAddress:N}=i,I=pe(),{successCallback:L,transactionHash:M}=this.getApproveTokenConfig(t,r),{isCurrentToken:U,isSamePlatform:Q,isSameTransactionHash:ee,pushedToken:te,pushedPlatformId:le}=this.checkCurrentPushedApproveInfo(i,t,r,o,M);if(E==="1")return;if(U&&Q&&(h.info(T.APPROVE_SOCKET_SUCCESS,{fromAmount:t.amount,defiPlatformId:r,status:i.status,amount:i.approveAmount,needCancelApproveToken:i.needCancelApproveToken,isCrossChain:o}),await this.handleCurrentPushedApproveToken({dexData:i,pushedPlatformId:le,token:t,isCrossChain:o,userWalletAddress:N,refetchQuote:n,needApprove:"1",approveEventType:"onSocket"})),(!U||U&&!Q)&&this.removeApproveTokenConfig(te,le),c===Te.APPROVE_SUCCESS){let b=f("swaptrade_toast_approve_success",{tokenSymbol:de(p)});!I&&Ct({title:b,exploreUrl:C}),Ee.emit(ke.APPROVE,{data:m,status:0,message:b}),ee&&L?await L():s?.()}else if(c===Te.APPROVE_FAILED&&!I){let b=f("swaptrade_toast_approve_fail",{tokenSymbol:de(p)});$e({title:b,exploreUrl:C})}else if(c===Te.CANCEL_APPROVE_SUCCESS&&!I){let b=f("swaptrade_transfer_notification_title_ccy_revoked",{ccy:de(p)});ee&&L&&await L(),Ct({title:b,exploreUrl:C})}else if(c===Te.CANCEL_APPROVE_FAILED&&!I){let b=f("swaptrade_transfer_notification_title_ccy_unrevoked",{ccy:de(p)});$e({title:b,exploreUrl:C})}}};this.onSocketError=e=>{e.isCrossChain?this.bridgeApproveSocketError=!0:this.isPendingNeedCheck(e).catch(()=>{})}}approveToken(e,{isSilentSign:t}={isSilentSign:!1}){return Promise.resolve(e)}},jl=Mt;export{jl as a,wt as b,po as c,Re as d,go as e,Oe as f,So as g,bt as h,cn as i};
//# sourceMappingURL=chunk-ZWKYYPCG.js.map
