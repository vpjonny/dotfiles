import{a as ct}from"./chunk-PWVBSLOL.js";import{b as ee}from"./chunk-452JEOHF.js";import{a as te}from"./chunk-3MLYZLAT.js";import{P as Ut}from"./chunk-RZOHZNJG.js";import{A as It,B as kt}from"./chunk-V7YATDMZ.js";import{d as D,g as At,i as Qt}from"./chunk-YLT6ZRGE.js";import{c as tt}from"./chunk-PMG6IXOR.js";import{F as Yt}from"./chunk-NS5EW6UN.js";import{b as Ct,o as O}from"./chunk-N6PI3XTA.js";import{a as $t}from"./chunk-IPVHRCDK.js";import{h as Q,m as bt,s as ut}from"./chunk-WYX7GFOD.js";import{a as Gt,f as qt}from"./chunk-MJSLAJV6.js";import{a as B,i as Ht,k as H,n as st,s as Vt}from"./chunk-KC2XLVFC.js";import{M as Wt,ra as jt}from"./chunk-MJDO2VHF.js";import{c as Xt}from"./chunk-EAE2NUFS.js";import{V as Tt,c as ft}from"./chunk-3F7OC7N7.js";import{b as it}from"./chunk-HZOYPVSA.js";import{a as Bt,b as Lt,c as vt,j as Ot}from"./chunk-EPDR6VAQ.js";import{c as P}from"./chunk-3FMJDUGT.js";import{c as z}from"./chunk-2O5TMJZM.js";import{O as J,g as xt}from"./chunk-UI4IZNSB.js";import{$ as Dt,Ea as Kt,Pb as p,vb as Mt}from"./chunk-EQ34WRCJ.js";import{k as v,p as y}from"./chunk-DSNMNSMD.js";import{I as Jt,d as yt,o as at,r as zt}from"./chunk-URGJ6D4O.js";import{C as $}from"./chunk-XYWWXNVK.js";import{a as Zt}from"./chunk-FB3ILH2L.js";import{b as ot}from"./chunk-FLSAETOH.js";import{f as Z}from"./chunk-LRIABBHT.js";import{Aa as Te,fa as Rt,g as Et}from"./chunk-4C5HF6J2.js";import{f as Y,o as k,q as U}from"./chunk-UWURTNRY.js";k();U();var S=Y(ot());Te();k();U();var L=Y(ot());k();U();function ke(t,e,n,r,o=4){return B(async(s,i)=>{let a=0;for(let u=0;u<o;u++){let c=await t(s,void 0,{tempFeeRate:Number(i.expectedFeeRate)});if(!c.length)return[];a=c.reduce((d,_)=>d+_.coinAmount,0);let m=await e({inputs:c,outputs:[{address:n,amount:r}],dustSize:a});if(a-(m+Number(i.increaseFee))>r)return[!0,!1,c,m];if(a>r&&u===o-1)return m=a-r,[!1,!0,c,m]}return[]})}function ne(t){let[e,n]=(0,L.useState)({}),[r,o]=(0,L.useState)(0),[s,i]=(0,L.useState)([]),[a,u]=(0,L.useState)(void 0),{mainCoinId:c,address:m,btcSpeedUpInfo:l,txHash:d}=t,_=c,g=D(_),x=$t(),C=(0,L.useMemo)(()=>l?.cpfpSpeedUpUtxo?.map(w=>`${w.txHash}-${w.vout}`),[l]),[,F]=te({coinId:_,address:m,chainId:g?.chainId},{pollingInterval:20*1e3}),f=F?.minOutput||0,T=dt({coinId:_,fromAddr:m,output:[{to:m,value:f}],satBytes:e?.expectedFeeRate}),b=lt({coinId:_,address:m,walletId:x,utxoType:V.ACCELERATE_BTC_TX_UTXO,speedUpNeedUtxo:C}),{cancel:E}=H(async()=>{let w=await Yt({address:m,coinId:_,txHash:d});n(w);let R=await b(0,void 0,{tempFeeRate:e.expectedFeeRate});i(R),u(void 0)},{pollingInterval:20*1e3,onError:w=>{u(w),E()}});(0,L.useEffect)(()=>{if(e?.expectedFeeRate&&s.length){let w=s.reduce((R,j)=>R+j.coinAmount,0);T({inputs:s,outputs:[{address:m,amount:f}],satBytes:e.expectedFeeRate,dustSize:w}).then(R=>{let j=vt(R,Number(e.increaseFee),f);o(j)}).catch(R=>{throw R})}},[m,f,e,s,e?.expectedFeeRate]);let X=ke(b,T,m,f);return[r,e,f,X,a]}k();U();var h=Y(ot());var ue=Y(Zt());k();U();var A=Y(ot());var pt=Y(Zt());k();U();var I={"retina-border-basic":"_retina-border-basic_gm6nn_1",retinaBorderBasic:"_retina-border-basic_gm6nn_1",root:"_root_gm6nn_29",subTitle:"_subTitle_gm6nn_32",utxo:"_utxo_gm6nn_37",coin:"_coin_gm6nn_45",coinDetail:"_coinDetail_gm6nn_81",coinSymbol:"_coinSymbol_gm6nn_87",nftImage:"_nftImage_gm6nn_93",coinAmount:"_coinAmount_gm6nn_96",coinValue:"_coinValue_gm6nn_101",assetList:"_assetList_gm6nn_109",unresolvedTip:"_unresolvedTip_gm6nn_109",list:"_list_gm6nn_116",paddingTop:"_paddingTop_gm6nn_119",asset:"_asset_gm6nn_109",assetDetail:"_assetDetail_gm6nn_129",assetValue:"_assetValue_gm6nn_130",foldSwitch:"_foldSwitch_gm6nn_144",fold:"_fold_gm6nn_144"};var G=t=>[p.ARC_NFT,p.BRC_NFT,p.FRACTAL_ORDINAL,p.DRC_NFT,p.SRC_NFT].includes(t),ie=t=>G(t?.protocolId)?`${t.collectionName||""} ${t.inscriptionNumber||t.nftId||""}`:Gt(t.tokenAmount||"",{symbol:t.tokenSymbol||""}).value,ae=({asset:t,selectedCurrency:e,className:n})=>A.default.createElement(O.Text,{ellipsis:{tooltip:!0},className:n},Ot(t.usdAmount,0)?y("extension_defi_card_text_unknown_value"):qt(v.mul(t.usdAmount,e.usdToThisRate),{currencySign:e.symbol}).value),Ue=({assetList:t,assetUnknown:e,selectedCurrency:n})=>{let r=t.length>3,[o,{toggle:s}]=st(r),i=o?t.slice(0,3):t,a=!!e?.length;return A.default.createElement(P.Box,{className:I.assetList},a&&A.default.createElement(O.Text,{className:I.unresolvedTip},y("extension_defi_mid_alert_utxo_not_decode",{asset:e.join(y("extension_wallet_text_punctuation_mark"))})),i?.length?A.default.createElement(P.Box,{className:(0,pt.default)(I.list,{[I.paddingTop]:!a})},i.map(u=>A.default.createElement(P.Box,{className:I.asset},A.default.createElement(O.Text,{ellipsis:{tooltip:!0},className:I.assetDetail},ie(u)),A.default.createElement(ae,{asset:u,className:I.assetValue,selectedCurrency:n})))):null,!!r&&A.default.createElement(P.Box,{align:P.ALIGN.center,className:(0,pt.default)(I.foldSwitch,{[I.fold]:o}),onClick:s},A.default.createElement(P.Box,null,y(o?"extension_defi_card_textbtn_view_all":"extension_defi_card_textbtn_view_less")),A.default.createElement(tt,{className:"okx-wallet-plugin-add-arrow-chevrons"})))},he=({title:t,utxoList:e,selectedCurrency:n})=>A.default.createElement(P.Box,{className:I.root},A.default.createElement(O.Text,{className:I.subTitle},t),e.map(r=>{let{mainAsset:o,protocolAssetList:s,assetUnknown:i}=r;return A.default.createElement(P.Box,{className:I.utxo},A.default.createElement(P.Box,{className:I.coin},A.default.createElement(P.Box,{className:I.coinDetail},A.default.createElement(tt,{className:(0,pt.default)(I.coinSymbol,{[I.nftImage]:G(o.protocolId)}),radius:!1,size:G(o.protocolId)?Ct.sm:Ct.xs,src:o.image,text:o.tokenSymbol}),A.default.createElement(O.Text,{ellipsis:{tooltip:!0},className:I.coinAmount},ie(o))),A.default.createElement(ae,{className:I.coinValue,asset:o,selectedCurrency:n})),A.default.createElement(Ue,{assetList:s,assetUnknown:i,selectedCurrency:n}))})),St=he;k();U();var N={"retina-border-basic":"_retina-border-basic_5grf2_1",retinaBorderBasic:"_retina-border-basic_5grf2_1",root:"_root_5grf2_29",header:"_header_5grf2_35",back:"_back_5grf2_42",main:"_main_5grf2_45",title:"_title_5grf2_51",text:"_text_5grf2_87",checkBox:"_checkBox_5grf2_92",footerWrap:"_footerWrap_5grf2_95",tipMessage:"_tipMessage_5grf2_131",submitButton:"_submitButton_5grf2_135"};var Se=({conflictAssetUtxo:t,unlockFeeUtxo:e,selectedCurrency:n,protocolId:r,onConfirm:o,onCancel:s,coin:i,psbtTitle:a=""})=>{let[u,c]=(0,h.useState)(!1),m=(0,h.useRef)(),[l,d]=(0,h.useState)(!1);return Ht(()=>{d(ee(m.current,"vertical"))}),h.default.createElement(P.Box,{className:N.root},h.default.createElement(P.Box,{className:N.header},h.default.createElement(tt,{className:(0,ue.default)(N.back,"okx-wallet-plugin-back"),onClick:s})),h.default.createElement(P.Box,{ref:m,className:N.main},h.default.createElement(P.Box,{className:N.title},h.default.createElement(O.Text,{className:N.text},y("extension_defi_top_title_confirm_use_utxo"))),!!t.length&&h.default.createElement(St,{title:G(r)?y("extension_defi_top_subtitle_utxo_lose_all_assets_nft"):y("extension_defi_top_subtitle_utxo_lose_all_assets",{token:i.symbol}),utxoList:t,selectedCurrency:n}),!!e.length&&h.default.createElement(St,{title:a||([p.ARC_20,p.RUNES,p.BRC_20,p.FRACTAL_BRC20,p.RUNEMAIN,p.FRACTAL_RUNES].includes(r)||G(r)?y("extension_defi_mid_subtitle_utxo_cover_fee_icu",{chainName:i?.chainName}):y("extension_defi_top_subtitle_use_utxo_lose_assets",{chainName:i?.chainName})),utxoList:e,selectedCurrency:n}),h.default.createElement(zt,{className:N.checkBox,onChange:_=>{let g=_?.target?.checked;c(g)},checked:u},y("extension_defi_bot_checkbox_label_confirm_use_utxo"))),h.default.createElement(P.Box,{className:N.footerWrap},!u&&h.default.createElement(yt,{desc:y(l?"extension_defi_bot_tips_slide_check_box":"extension_defi_bot_tips_confirm_check_box"),type:yt.TYPE.info,closable:!1,className:N.tipMessage}),h.default.createElement($,{block:!0,className:N.submitButton,disabled:!u,category:$.CATEGORY.fill,size:$.SIZE.lg,type:$.TYPE.highlight,onClick:o},y("extension_defi_bot_btn_continue"))))},ce=Se;k();U();k();U();var V={TRANSFER:1,TRANSFER_NFT:2,COMPLETE:3,BRC20_CONVERTIBLE:4,NFT_REMOVAL:5,PSBT_DUMMY_OCCUPIED:6,EXPEND_ABLE:7,EXPEND_UNABLE:8,INSCRIPTION:9,BRC20S_CONVERTIBLE:4,NEW_INSCRIPTION:11,SPLIT_UTXO:13,INSCRIPTION_USE_NFT_UTXO:14,ACCELERATE_BTC_TX_UTXO:15},Fe={CAL_FEE:1,CONFIRM:2},M=546,W={INSCRIBE:1,PSBT:2,PSBT_MPC_UNSIGNED_LIST:21,PSBT_MPC_SIGNED_LIST:22,PSBT_MPC_UNSIGNED_BUY:23,PSBT_MPC_SIGNED_BUY:24,PSBT_MPC_UNSIGNED:25,PSBT_KEY_SCRIPT_PATH:3,PSBT_KEY_SCRIPT_PATH_BATCH:4,SRC20:101,RUNES:102,RUNEMAIN:103,ARC20:114,CAT20:115},q={TRANSFER:1,PSBT:2,ACCELERATE:3};var Pe={BRC20:1,SRC20:101},Ft=t=>{if(t===p.SRC_20)return W.SRC20;if(t===p.ARC_20)return W.ARC20;if(t===p.RUNES)return W.RUNES;if(t===p.RUNEMAIN||t===p.FRACTAL_RUNES)return W.RUNEMAIN;if(t===p.CAT_20)return W.CAT20},we=({data:t,nftLocaltionVOs:e},n)=>Array.isArray(t)&&t?.length?{data:t}:!n||!e?.[0]?.nftId||!Array.isArray(e)?{}:n===p.ARC_20?{data:e.map(({nftId:r,tokenType:o,value:s})=>({atomicalId:r,type:o,amount:s}))}:n===p.RUNES?{data:e.map(({nftId:r,value:o})=>({id:r,amount:o}))}:n===p.RUNEMAIN||n===p.FRACTAL_RUNES?{data:e.map(({nftId:r,value:o})=>({id:r,amount:o}))}:{},et=(t,e={},n)=>Array.isArray(t)?t.map(({txHash:r,vout:o,coinAmount:s,rawTransaction:i,...a})=>({vOut:o,amount:s,txId:r,rawTransaction:i,...we(a,n),...e})):[],me=(t,e,n={})=>{let r=e===Pe.BRC20?"text/plain;charset=utf-8":"stamp:",o=n?.revealAddr,s=n?.contentType;return s||(s=r),o||(o=t),{...n,revealAddr:o,contentType:s}},le=({type:t,toAddr:e,fromAddr:n,satBytes:r,utxoList:o,privateKey:s,inscriptionData:i,inscriptionDataList:a,revealOutValue:u=M})=>({type:t,revealOutValue:u,changeAddress:n,commitFeeRate:r,revealFeeRate:r,commitTxPrevOutputList:et(o,{privateKey:s,address:n}),inscriptionData:me(e||n,t,i),inscriptionDataList:a?.length?a.map(c=>me(e||n,t,c)):void 0}),Ne=({changeAddr:t,toAddr:e,satBytes:n,utxoList:r=[],coinAmount:o,inputs:s,outputs:i,...a})=>({address:t,feePerB:n,inputs:et([...s||[],...r]),outputs:i||[{address:e,amount:o}],...a}),Ee=({changeAddr:t,toAddr:e,satBytes:n,utxoList:r=[],coinAmount:o,inputs:s,outputs:i,protocolId:a,fromAddr:u,...c})=>{let m={feePerB:n,address:t,inputs:et([...s||[],...r],{address:u||t},a),outputs:i||[{address:e,amount:o}],...c};return a===p.RUNES&&Object.assign(m,{runeData:{etching:null,burn:!1}}),(a===p.RUNEMAIN||a===p.FRACTAL_RUNES)&&Object.assign(m,{runeData:{etching:null,burn:!1,useDefaultOutput:!1,defaultOutput:0}}),a===p.CAT_20&&Object.assign(m,{feeRate:n,changeAddress:t,toAddress:e,tokenAmount:o,verifyScript:!0}),m},Re=t=>[p.SRC_20,p.ARC_20,p.RUNES,p.RUNEMAIN,p.FRACTAL_RUNES,p.CAT_20].includes(t),mt=({toAddr:t,changeAddr:e,satBytes:n,utxoList:r=[],coinAmount:o,inputs:s,outputs:i,protocolId:a,...u})=>Re(a)?Ee({toAddr:t,changeAddr:e,satBytes:n,utxoList:r,coinAmount:o,inputs:s,outputs:i,protocolId:a,...u}):Ne({toAddr:t,changeAddr:e,satBytes:n,utxoList:r,coinAmount:o,inputs:s,outputs:i,...u});var lt=t=>{let{coinId:e,address:n,walletId:r,utxoType:o,satBytes:s,utxoRequests:i=[],...a}=t,u=D(e),c=u?.baseCoinId||u?.coinId;return B(async(m,l,d={})=>{let _={coinId:c,utxoRequests:[{address:n,coinAmount:m,serviceCharge:l,utxoType:o||V.TRANSFER,...a,...d},...i],accountId:r};try{let{data:g}=await J(z?.getBTCUTXO,_),{utxoList:x}=g?.[0]||{};return x}catch(g){return Promise.reject(g)}},[c,n,r,o,a])},Be=[],re=(t,e)=>{let{ready:n=!0,refreshDeps:r=[],...o}=e||{},{coinAmount:s="0",networkFee:i="0",...a}=t||{},u=lt(a),c={debounceWait:500,ready:n&&a?.address&&a?.walletId,refreshDeps:[s,i,u,...r],...o},{error:m,loading:l,data:d}=H(async()=>await u(s,i),c);return[l,d||Be,m]},ht=()=>B(async({coinId:t,baseCoinId:e,satBytes:n,addressList:r,walletId:o,utxoType:s,...i})=>{let a=Array.isArray(r)?r:[r],u={coinId:e,utxoRequests:a.map(c=>({address:c,coinAmount:0,serviceCharge:0,utxoType:s||V.TRANSFER,...i})),accountId:o};try{let{data:c}=await J(z?.getBTCUTXO,u);return a.map(m=>{let{canTransferAmount:l}=c.find(d=>d.address===m);return l})}catch(c){return Promise.reject(c)}}),ye=(t={},e)=>{let{address:n,coinId:r,...o}=t,{ready:s=!0,...i}=e||{},a=ht(),u=D(r),{loading:c,data:m,error:l}=H(async()=>{try{return(await a({addressList:[n],baseCoinId:u.baseCoinId||r,coinId:r,...o}))?.[0]||"0"}catch{return"0"}},{ready:!!n&&s&&u?.baseCoinId!==void 0,...i});return[c,m,l]},be=(t={},e)=>{let{addressList:n,coinId:r,...o}=t,{ready:s=!0,...i}=e||{},a=ht(),u=D(r),{loading:c,data:m,error:l}=H(async()=>await a({addressList:n,baseCoinId:u.baseCoinId||r,coinId:r,...o}),{ready:Array.isArray(n)&&n?.length&&s&&u?.baseCoinId!==void 0,...i});return[c,m||[],l]},Le=0,oe=()=>B((t,e)=>(t||[]).some(r=>r.status===Le)?new Promise((r,o)=>{let s=at.warn({alignBottom:!1,title:y("extension_wallet_transaction_title_low_tradingfee"),text:y("extension_wallet_transaction_subtitle_low_tradingfee"),confirmText:y("wallet_extension_address_popup_btn_continue"),cancelText:y("wallet_extension_btn_general_cancel"),onCancel:()=>{s.destroy(),o(),e?.()},onConfirm:()=>{s.destroy(),r()}})}):Promise.resolve(),[]),ve=(t,e)=>{let[,n]=At(e);return B(async r=>{if(n?.coinId!==Kt)return Promise.resolve();let{data:o}=await J(z.checkWalletCommonPending,{address:t,coinId:e});return o?new Promise((s,i)=>{let a=at.warn({alignBottom:!1,title:y("extension_defi_mid_title_reminder"),text:y("extension_defi_mid_subtitle_reminder_submit"),confirmText:y("extension_defi_mid_btn_cancel"),onConfirm:()=>{a.destroy(),i(),r?.()},cancelText:y("extension_defi_mid_btn_continue_submit"),onCancel:()=>{a.destroy(),s()}})}):Promise.resolve()})},Oe=({address:t,coinId:e,protocolId:n,txType:r=ft.TRANS_OUT,doubleConfirmSource:o=q.TRANSFER})=>{let[s,i]=At(e,{withPrice:!0});s=s||{},i=i||{};let a=jt(Wt),{currencyId:u}=a,c=Qt({currencyId:u});return B(async m=>{let l={};return m.forEach(({txHash:d,resourceUrl:_})=>{l[d]=_}),new Promise((d,_)=>{(async()=>{try{let{data:{conflictAssetUtxo:g,unlockFeeUtxo:x}}=await J(z.doubleCheckUtxo,{utxoList:m.map(T=>{let b=Rt(T,["vout","nftId","txHash","status","coinAmount"]);return o!==q.PSBT?b.unlockUtxo=T?.utxoStatusType===1:b.unlockUtxo=!0,b}),address:t,txType:r,coinId:e});if(!g?.length&&!x?.length){d();return}let C=g?.map(T=>{let[b,...E]=T.protocolAssetList;return b.image=l[T.txHash]||s.image,{...T,mainAsset:b,protocolAssetList:E}})||[],F=x?.map(T=>{let b=Lt(T.coinAmount,v.pow(10,i.decimals||0));return T.mainAsset={tokenSymbol:i.symbol,tokenAmount:b,usdAmount:Bt(b,i.usdPrice||0),image:i.image},T})||[],f=at.action({windowStyle:{width:"100%",height:"100%",maxHeight:"none"},alignBottom:!0,hideCloseBtn:!0,noContentPadding:!0,children:S.default.createElement(ce,{coin:s,selectedCurrency:a,coinToCurrencyFn:c,protocolId:n,conflictAssetUtxo:C,unlockFeeUtxo:F,txType:r,onConfirm:()=>{d(),f.destroy()},onCancel:()=>{_(new Error(Ut)),f.destroy()},psbtTitle:o=q.PSBT?y("extension_defi_top_toast_all_spent"):""})})}catch{Jt.error(y("extension_defi_toast_textarea_create_order_fail")),_(new Error(Ut))}})()})})},Ce=({address:t,coinId:e,currencyId:n,txType:r=ft.TRANS_OUT,protocolId:o,doubleConfirmSource:s=q.TRANSFER})=>{let i=Oe({address:t,coinId:e,protocolId:o,txType:r,currencyId:n,doubleConfirmSource:s}),a=ve(t,e),u=oe();return B(async(c,m=Et)=>{try{return s===q.TRANSFER&&(await a(m),await u(c,m)),await i(c),await Promise.resolve()}catch(l){return Promise.reject(l)}})};var de=async(t,e)=>{let n=e(t),{deriveIndex:r,address:o}=n?.addressType?.bitcoin?.find(i=>i?.addressType===n?.selectedAddressType?.bitcoin)||{};return{publicKey:await Xt().getPublicKey(o,Dt,t),deriveIndex:r}},wr=()=>{let t=ut(),e=bt(),n=(0,S.useCallback)((s,i,a="text/plain;charset=utf-8")=>{let u=[];return s.forEach(c=>{let m={...c};m.contentType||(m.contentType=a),m.revealAddr||(m.revealAddr=i),u.push(m)}),u},[]),r=(0,S.useCallback)(async(s,i)=>(await t(s))?.find(c=>c.address===i)?.privateKey,[]);return(0,S.useCallback)(async({walletId:s,address:i,tx:a={},privateKey:u})=>{let c=u;c||(c=await r(s,i));let{publicKey:m}=await de(s,e),l=ct(),{commitTxPrevOutputList:d,commitFeeRate:_,revealFeeRate:g,inscriptionData:x,inscriptionDataList:C,revealOutValue:F=546,changeAddress:f=i,toAddr:T}=a,E={commitTxPrevOutputList:d.map(w=>({...w,privateKey:c,publicKey:m,address:i})),commitFeeRate:_,revealFeeRate:g||_,inscriptionData:x,inscriptionDataList:n(C,T||i),revealOutValue:F,changeAddress:f,type:1};return await l.exec("signTransaction",[Z.BTC,{data:E}])},[r,e,n])},Nr=()=>{let t=ut(),e=bt(),n=(0,S.useCallback)(async(o,s)=>(await t(o))?.find(u=>u.address===s)?.privateKey,[]);return(0,S.useCallback)(async({walletId:o,address:s,tx:i={},privateKey:a,mintType:u=Tt.parallel})=>{let c=a;c||(c=await n(o,s));let{publicKey:m}=await de(o,e),l=ct(),{input:d,outValue:_,inscriptions:g}=i,x=d.map(b=>({...b,privateKey:c,publicKey:m,address:s})),C={type:W.RUNEMAIN,inputs:x,outputs:[{address:s,amount:_,data:g[0]}],runeData:{etching:null,useDefaultOutput:!1,defaultOutput:0,burn:!1,mint:!0,mintNum:g.length,serialMint:u===Tt.serial},...i},{estimateFee:F}=await xt(),f=await F(Z.BTC,{data:C});g.length===1&&(f=[f]);let T=await l.exec("signTransaction",[Z.BTC,{data:C,privateKey:c}]);return g.length===1&&(T=[T]),{commitTx:T[0],revealTxs:T.slice(1),commitAddrs:[],commitTxFee:f[0],revealTxFees:f.slice(1)}},[n,e])},pe=({type:t,toAddr:e,fromAddr:n,walletId:r,satBytes:o,inscriptionData:s,inscriptionDataList:i,revealOutValue:a=790})=>{let u=Q(),c=r||u,m=ut();return(0,S.useCallback)(async({utxoList:l})=>{let _=(await m(c)).find(({address:x})=>x===n)?.privateKey,g=le({type:t,toAddr:e,satBytes:o,fromAddr:n,utxoList:l,privateKey:_,revealOutValue:a,inscriptionData:s,inscriptionDataList:i});try{return await ct().exec("signTransaction",[Z.BTC,{data:g}])}catch{throw Error("sign error")}},[m,c,t,e,o,n,a,s,i])},De=({type:t,toAddr:e,fromAddr:n,walletId:r,satBytes:o,inscriptionData:s,inscriptionDataList:i,revealOutValue:a=M})=>{let u=pe({type:t,toAddr:e,fromAddr:n,walletId:r,satBytes:o,revealOutValue:a,inscriptionData:s,inscriptionDataList:i});return(0,S.useCallback)(async({utxoList:c,...m})=>{let{commitTxFee:l,revealTxFees:d=[]}=await u({utxoList:c,...m}),_=(d||[]).reduce((g,x)=>v.add(g,x),0);return v.add(l,_)},[u])},Ke=({type:t,coinId:e,fromAddr:n,toAddr:r,satBytes:o,coinAmount:s,protocolId:i})=>{let u=D(e)?.baseCoinId||e;return(0,S.useCallback)(async({utxoList:c,...m})=>{if(!Number(o))return Promise.reject();let{estimateFee:l}=await xt(),d=mt({type:t,toAddr:r,utxoList:c,satBytes:o,coinAmount:s,protocolId:i,changeAddr:n,...m}),g=Mt({coinId:+u})?.coinType;try{return await l(g,{data:d,privateKey:""})}catch(x){return Promise.reject(x)}},[u,s,n,i,o,r,t])},dt=({coinId:t,fromAddr:e,toAddr:n,satBytes:r,coinAmount:o,protocolId:s,revealOutValue:i,inscriptionData:a,inscriptionDataList:u,...c})=>{let m=Ft(s),l=Ke({coinId:t,satBytes:r,fromAddr:e,toAddr:n,coinAmount:o,protocolId:s,type:m,...c}),d=De({coinId:t,toAddr:n,fromAddr:e,satBytes:r,coinAmount:o,protocolId:s,revealOutValue:i,inscriptionData:a,inscriptionDataList:u,type:m,onlyCommitTxFee:!0,...c});return s===p.SRC_20?d:l},Ae=(t,e)=>{let{coinId:n,walletId:r,toAddr:o,fromAddr:s,satBytes:i,networkFee:a,coinAmount:u,canTransferAmount:c,utxoParams:m={},inscriptionData:l,protocolId:d,inscriptionDataList:_,revealOutValue:g=M,inputs:x,...C}=t,F=D(n),f=F?.baseCoinId===0,T=d||F?.protocolId,{ready:b=!0,refreshDeps:E}=e||{},[X,{setTrue:w,setFalse:R}]=st(!1),[j,Pt]=(0,S.useState)(),_e=Q(),ge=r||_e,[_t,xe]=(0,S.useState)(a),wt=dt({coinId:n,fromAddr:s,toAddr:o,satBytes:i,coinAmount:u,protocolId:T,revealOutValue:g,inscriptionData:l,inscriptionDataList:_}),Nt={coinAmount:u,networkFee:_t||"0"};f&&c&&v.gt(v.add(u,_t),c)&&(Nt={coinAmount:c,networkFee:0});let[fe,nt]=re({coinId:n,address:s,walletId:ge,...Nt,...m},{refreshDeps:E,ready:f&&!!c&&b||!f&&b}),gt=(0,S.useMemo)(()=>[...x||[],...nt||[]],[x,nt]);return Vt(()=>{!Array.isArray(gt)||!gt?.length||(w(),wt({utxoList:gt,...C}).then(rt=>{Pt(!1),xe(rt),e?.onSuccess?.(rt,nt)}).catch(rt=>{Pt(!0),e?.onError?.(rt)}).finally(()=>{R()}))},[nt,C,wt]),[X||fe,_t,j]},Me=({type:t,coinId:e,toAddr:n,walletId:r,fromAddr:o,changeAddr:s,satBytes:i,localType:a,coinAmount:u,networkFee:c,protocolId:m,dustSize:l=M,...d})=>{let _=Q(),g=r||_,x=it(a),C=It({fromAddr:o,localType:x,walletId:g});return(0,S.useCallback)(async({utxoList:F,...f})=>{let T=mt({toAddr:n,satBytes:i,type:t,changeAddr:s||o,dustSize:l,coinAmount:u,utxoList:F,protocolId:m,...d,...f});return await C({params:T,...f})},[s,u,l,o,m,d,i,C,n,t])},se=({coinId:t,toAddr:e,walletId:n,protocolId:r,fromAddr:o,changeAddr:s,satBytes:i,localType:a,coinAmount:u,networkFee:c,inscriptionData:m,inscriptionDataList:l,dustSize:d=M,..._})=>{let g=it(a),x=Ft(r),C=Me({coinId:t,toAddr:e,walletId:n,fromAddr:o,changeAddr:s,satBytes:i,localType:g,coinAmount:u,networkFee:c,dustSize:d,protocolId:r,type:x,..._}),F=pe({toAddr:e,fromAddr:o,walletId:n,satBytes:i,protocolId:r,inscriptionData:m,inscriptionDataList:l,type:x,..._});return r===p.SRC_20?F:C},Ie=({coinId:t,toAddr:e,txType:n,fromAddr:r,satBytes:o,walletId:s,localType:i,networkFee:a,coinAmount:u,protocolId:c,dustSize:m=M,extraPublishParams:l={},businessType:d,..._})=>{let g=Q(),x=s||g,C=it(i),F=se({coinId:t,toAddr:e,walletId:s,fromAddr:r,satBytes:o,localType:C,coinAmount:u,networkFee:a,dustSize:m,protocolId:c,..._}),f=kt({coinId:t,txType:n,coinAmount:u,fromAddr:r,toAddr:e,localType:C,networkFee:a,walletId:x,extJson:JSON.stringify({protocolId:c}),businessType:d,...l});return(0,S.useCallback)(async({utxoList:T,...b})=>{let E=await F({utxoList:T,...b}),X=E;return c===p.SRC_20&&(X=E?.commitTx),await f(X)},[c,f,F])};export{ne as a,V as b,Fe as c,M as d,q as e,we as f,et as g,Re as h,lt as i,re as j,ye as k,be as l,Ce as m,wr as n,Nr as o,dt as p,Ae as q,se as r,Ie as s};
//# sourceMappingURL=chunk-ITLSSVGE.js.map
