import{a as R,b as f,k as ze}from"./chunk-C7TFGGMX.js";import{a as We}from"./chunk-MNWYUYGW.js";import{a as Ve}from"./chunk-KDZWFWCG.js";import{a as Ye}from"./chunk-NP6SC5QM.js";import{a as He,c as W,d as Ke}from"./chunk-GCJ2PJNQ.js";import{a as Me,b as te}from"./chunk-P355XBV4.js";import{a as qe}from"./chunk-V7YATDMZ.js";import{a as Ge}from"./chunk-S63SUKPS.js";import{a as Fe}from"./chunk-CQHSO2TF.js";import{f as ke}from"./chunk-6HJJJE2I.js";import{a as De,e as be,f as Le}from"./chunk-MLF4IONJ.js";import{a as H}from"./chunk-JYCBCMDP.js";import{a as _}from"./chunk-W3VW6MYS.js";import{s as Se,u as Oe,w as Ie}from"./chunk-CKHT4PIF.js";import{a as ve}from"./chunk-JMNZU6WB.js";import{d as we}from"./chunk-7U7FORYL.js";import{b as V}from"./chunk-XBUPORYF.js";import{a as ee,k as Ue}from"./chunk-IPVHRCDK.js";import{a as O}from"./chunk-KC2XLVFC.js";import{H as ye,L as Re,R as Ee,S as Ne,qa as M,ra as x,v as Ae,x as Pe}from"./chunk-MJDO2VHF.js";import{h as F}from"./chunk-TBQGFYU3.js";import{_ as Ce}from"./chunk-QF42JCDG.js";import{c as E}from"./chunk-EAE2NUFS.js";import{a as xe,b as h}from"./chunk-6M37VPK2.js";import{D as U,m as L}from"./chunk-3F7OC7N7.js";import{D as de,p as le}from"./chunk-EPDR6VAQ.js";import{a as Y}from"./chunk-WN3TRBGI.js";import{f as ut,t as fe,v as Te}from"./chunk-UI4IZNSB.js";import{Z as ge,_ as _e,a as ce}from"./chunk-EQ34WRCJ.js";import{p as C}from"./chunk-DSNMNSMD.js";import{a as mt}from"./chunk-DOSBJ3L3.js";import{I as he,J as I}from"./chunk-URGJ6D4O.js";import{b as X}from"./chunk-FLSAETOH.js";import{Aa as ct,Q as me,ba as pe,g as ue}from"./chunk-4C5HF6J2.js";import{f as G,o as T,q as g}from"./chunk-UWURTNRY.js";T();g();function vt(){let e=x(Le),t=e&&e.metadata?e.metadata.id:null,o=t?1:0,n=x(Pe),r=n.length,s=x(Ae),i=x(Ne),a=i.length,c=x(Ee),u=c.length,m=x(be);return{unapprovedTxList:n,unapprovedTxCount:r,unapprovedSmCount:s,unapprovedStList:i,unapprovedStCount:a,unapprovedPermissionCount:o,unapprovedPermissionsRequestId:t,unapprovedSnList:c,unapprovedSnCount:u,realGeneralDappRequestsCount:m,unapprovedRequestCount:r+s+a+u+o+m}}T();g();T();g();var P=G(X());var ot=G(mt());T();g();var D=G(ut());ct();T();g();var Be=async e=>await E().rpcEvmAddTransaction(e),ne=async e=>await E().rpcEvmUpdateTransaction(e),Ze=async e=>await E().rpcEvmConfirmTransaction(e),je=async e=>await E().rpcEvmFindTransaction(e),$e=async(e,t)=>await E().rpcEvmPublishTransaction(e,t);T();g();var Je=G(X());var pt=()=>{let e=ze();return t=>{if(t){let{type:o,status:n,txHash:r,extraParams:s}=t,i={[f.TRANS_OUT]:{key:"wallet_transfer_notif_send_success",params:{first:s?.value,second:s?.coinSymbol}},[f.CONTRACT_CALL]:{key:"wallet_transfer_notif_contract_interaction_success"},[f.AUTHORIZATION]:{key:"wallet_transfer_notif_approval_success",params:{first:s?.coinSymbol}},[f.CANCEL_AUTHORIZATION]:{key:"wallet_transfer_notif_cancel_approval_success",params:{first:s?.coinSymbol}},[f.CONTRACT_DEPLOY]:{key:"developer_mode_dapp_toast_deployed_successfully"}},a={[f.TRANS_OUT]:{key:"wallet_transfer_notif_send_fail",params:{first:s?.value,second:s?.coinSymbol}},[f.CONTRACT_CALL]:{key:"wallet_transfer_notif_contract_interaction_fail"},[f.AUTHORIZATION]:{key:"wallet_transfer_notif_approval_fail",params:{first:s?.coinSymbol}},[f.CANCEL_AUTHORIZATION]:{key:"wallet_transfer_notif_cancel_approval_fail",params:{first:s?.coinSymbol}},[f.CONTRACT_DEPLOY]:{key:"developer_mode_dapp_toast_deployfailed"}},c,u,m,d,l;n===R.PENDING?(c=I.TYPE.success,o===f.CANCEL_AUTHORIZATION?(u="wallet_transfer_notif_cancel_approval_submit",m={first:s?.coinSymbol}):u="wallet_transfer_notif_transaction_submit"):(n===R.SUCCEED?(c=I.TYPE.success,u=i[o]?.key,m=i[o]?.params):(c=I.TYPE.error,u=a[o]?.key,m=a[o]?.params),n!==R.DROPPED&&(d=e(r),l="wallet_transfer_notif_view_on_explorer")),I[c]({title:C(u,m)||u,desc:d?Je.default.createElement(Fe,{url:d,urlText:C(l)}):null,duration:3})}}},Qe=pt;function lt(e){let t={to:e.to,value:(0,D.addHexPrefix)(h(e.value)),gasLimit:(0,D.addHexPrefix)(h(e.gasLimit)),nonce:(0,D.addHexPrefix)(h(e.nonce)),kaiaTxType:e.kaiaTxType,signFn:e.signFn};return e.type===L.FEE_MARKET?(t.maxFeePerGas=(0,D.addHexPrefix)(h(e.maxFeePerGas)),t.maxPriorityFeePerGas=(0,D.addHexPrefix)(h(e.maxPriorityFeePerGas)),t.type=e.type):(t.gasPrice=(0,D.addHexPrefix)(h(e.gasPrice)),e.type=L.LEGACY),e.data&&(t.data=e.data),t}function oe(e){let t=ve(),o=e||t,n=V();return O(r=>{let{type:s,txParams:i,extraParams:a}=r,c=s;return c||(i.to?c=f.CONTRACT_CALL:c=f.CONTRACT_DEPLOY),{id:de(),type:c,txParams:{...lt(i),from:i.from||n,chainId:o.chainId},status:R.UNAPPROVED,createTime:+new Date,txPool:[],isCanceling:!1,isSpeeding:!1,extraParams:a||{}}})}function re(e){let t=Qe(),o=x(Re),n=ee();return O(async(r,{walletId:s=n,signedCallback:i=ue}={})=>{if(!r)throw new Error("tx meta error");let a;if(r.txParams?.result)a=r.txParams.result;else{let{from:u}=r.txParams||{};a=await E().signRpcEvmTransaction(r.txParams,u,o,s)}if(r?.txParams?.signFn===U.KAIA_SIGN_TRANSACTION)return{rawTx:a};let c=await qe(ge,a);return await i({rawTx:a,txHash:c,status:R.PENDING}),new Promise((u,m)=>{$e({txId:r.id,rawTx:a},e).then(({error:d,data:l,tx:p})=>{if(d){(p?.status===R.PENDING||p?.status===R.DROPPED)&&t(p),m(d);let{type:A,txParams:v,extraParams:S}=r,{from:k,to:N,value:K,gasLimit:b,gasPrice:y,maxFeePerGas:z,maxPriorityFeePerGas:B,data:Z,nonce:j,chainId:$}=v||{},{approvedAmount:J,coinSymbol:ae,tokenAddress:ie,approvedAddress:Q,value:at,toAddress:it}=S||{};ce.captureEvent({tags:{address:k},message:"API_ERROR_evm_rpc_send_tx",contexts:{report:{info:JSON.stringify({type:A,txParams:{from:k,to:N,value:K,gasLimit:b,gasPrice:y,maxFeePerGas:z,maxPriorityFeePerGas:B,data:Z,nonce:j,chainId:$},extraParams:pe({approvedAmount:J,coinSymbol:ae,tokenAddress:ie,approvedAddress:Q,value:at,toAddress:it},me)})}},exception:{values:[{type:"API_ERROR_evm_rpc_send_tx",value:d?.message}]},level:"info"})}else t(p),u({id:r.id,txHash:l.result})}).catch(async d=>{await Ze({txId:r.id,tx:{status:R.DROPPED,finishTime:+new Date,errorMessage:d?.message},checkPoolEmpty:!0}),m(d)})})})}var se=()=>{let e=M(),t=ee();return async(o,n=t)=>{await e(Ge({walletId:n,txParams:o.txParams,isRpcMode:!0}));let{id:r}=o,s=await je(r);if(s&&(s.status===R.SUCCEED||s.status===R.DROPPED||s.status===R.DROPPED))throw Error(Y)}};function Xe(e){let t=oe(e),o=re(e),n=se();return O(async(r,s,i)=>{let a=t(r);return await n(a,s),o(a,{walletId:s,signedCallback:c=>{let u={...a,...c};try{i&&i(u)}catch{}return Be(u)}})})}function un(e){let t=oe(e),o=re(e),n=se();return O(async(r,s)=>{let{type:i,txParams:a,extraParams:c}=r,u=t({type:i,txParams:{...a,...s},extraParams:c}),{id:m,txPool:d}=r;return r.id=u.id,u.id=m,r.txPool=[],await n(u),o(u,{signedCallback:l=>ne({txId:m,tx:{...u,status:R.PENDING,isSpeeding:!0,txPool:[r,...d],...l}})})})}function mn(e){let t=Oe(!0),o=oe(e),n=re(e),r=se();return O(async(s,i)=>{let{txParams:a,extraParams:c}=s,{from:u,nonce:m,type:d,chainId:l}=a,p=t.find(({address:k})=>!k),A=o({type:f.TRANS_OUT,txParams:{to:u,value:"0x0",nonce:m,chainId:l,type:d,...i},extraParams:c}),{id:v,txPool:S}=s;return s.id=A.id,A.id=v,s.txPool=[],await r(A),n(A,{signedCallback:k=>ne({txId:v,tx:{...A,status:R.PENDING,isCanceling:!0,txPool:[s,...S],extraParams:{toAddress:u,tokenAddress:"",coinSymbol:p?.symbol,value:"0"},...k}})})})}T();g();var q=G(X());function et(e,t){let o=V(),n=e||o,[r,s]=(0,q.useState)(!1),[i,a]=(0,q.useState)(null),[c,u]=(0,q.useState)(null),m=E(),d=O(async()=>{s(!0);try{let l=await m.rpcEvmGetNonce(n,t);if(l){let{nonce:p,suggestedNonce:A}=l;a(p),u(A)}}catch(l){let p=l;he.error({title:p?.data?.msg||p?.msg||p?.data?.originalError?.msg||p?.message})}finally{s(!1)}});return(0,q.useEffect)(()=>{d()},[n,t?.uniqueId]),{loadingNonce:r,nonce:i,suggestedNonce:c}}T();g();var tt=async(e,t)=>{let o;try{o=await t.getCode(e)}catch{o=null}return{isContractAddress:Boolean(o&&o!=="0x"&&o!=="0x0")}};T();g();function nt(e,{customPermissionAmount:t}){let o=H(e);if(o){if(o.name!==_.TOKEN_METHOD_APPROVE)throw new Error(`Invalid data; should be 'approve' method, but instead is '${o.name}'`)}else throw new Error("Invalid data");let n=W(o);n.startsWith("0x")&&(n=n.substring(2));let[r,s]=e.split(n);if(!r||!s)throw new Error("Invalid data");if(s.length!==64)throw new Error("Invalid token value; should be exactly 64 hex digits long (u256)");let i=h(t);if(i.length>64)throw new Error("Custom value is larger than u256");return i=i.padStart(s.length,"0"),`${r}${n}${i}`}function dt({data:e,to:t}){let o=Se(),[n,r]=(0,P.useState)(""),[s,i]=(0,P.useState)(!1);return(0,P.useEffect)(()=>{(async()=>{if(e&&!t){r(_.DEPLOY_CONTRACT);return}try{let d=H(e)?.name,l=[_.TOKEN_METHOD_APPROVE,_.TOKEN_METHOD_TRANSFER,_.TOKEN_METHOD_TRANSFER_FROM].find(p=>p.toLowerCase()===d.toLowerCase());if(l){r(l);return}}catch{}i(!0);let c=await o(),{isContractAddress:u}=await tt(t,c);r(u?_.CONTRACT_INTERACTION:_.SENT_ETHER),i(!1)})()},[e,t,o]),[n,s]}function ft({data:e,type:t}){let o,n,r,s;try{let i=H(e),a=Ke(i);o=W(i),s=a,n=t===_.TOKEN_METHOD_APPROVE,r=n&&Number(s)===0}catch{}return{address:o,isApprove:n,isRevoke:r,amount:s}}function Tt(e,t){let o=Ie(void 0,t),[n,r]=(0,P.useState)({}),[s,i]=(0,P.useState)(!1),a=async()=>{try{i(!0);let{symbol:c,decimals:u}=await o(e);r({symbol:c,decimals:u}),i(!1)}catch{i(!1)}};return(0,P.useEffect)(()=>{e&&a()},[e]),[n,s]}function gt(e){let[t,o]=(0,P.useState)(-1),{isApprove:n,amount:r}=e;return(0,P.useEffect)(()=>{n&&o(r)},[n,r]),[{...e,customApproveAmount:t},o]}function _t({origin:e,isApprove:t,isRevoke:o,symbol:n,walletId:r}){let s=Ue(r),i=x(ye),a=r?s:i,u=x(De)[e]||{},[m,d]=(0,P.useState)({});return(0,P.useEffect)(()=>{let l=null,p=null,A=null;t?(l=null,p=n,A=o?C("wallet_approval_subtitle_revoke_approval_desc",{tokenSymbol:n}):C("wallet_dapp_conncetion_alert_approve_tip",{name:u.name,tokenSymbol:n})):(l=u.icon,A=u.host,p=u.name),d({icon:l,host:A,name:p})},[o,n]),{...m,originInfo:u,wallet:`${a.keyringName} - ${a.walletName}`}}function At(e,t){let{nonce:o,suggestedNonce:n}=et(e,t),[r,s]=(0,P.useState)(0),[i,a]=(0,P.useState)(!0);return(0,P.useEffect)(()=>{s(n),a(!1)},[n]),[{suggested:o,custom:r,pending:i},s]}var Pt=({tx:e,nonce:t,txData:o,tokenInfo:n,chain:r,customGasInfo:s,approvedAmount:i,formattedAmount:a,txType:c})=>{let{from:u,to:m,value:d,data:l}=e,{isSupportEip1559:p,maxFeePerGas:A,maxPriorityFeePerGas:v,gasPrice:S,gasLimit:k}=s,N={from:u,to:m,value:d,gasLimit:k,nonce:t,data:l};p?(N.maxFeePerGas=A,N.maxPriorityFeePerGas=v,N.type=L.FEE_MARKET):(N.gasPrice=S,N.type=L.LEGACY),e?.method===U.KAIA_SIGN_TRANSACTION&&(N.signFn=U.KAIA_SIGN_TRANSACTION,N.kaiaTxType=e?.typeInt);let b={[_.DEPLOY_CONTRACT]:f.CONTRACT_DEPLOY,[_.CONTRACT_INTERACTION]:f.CONTRACT_CALL,[_.TOKEN_METHOD_APPROVE]:f.AUTHORIZATION,[_.SENT_ETHER]:f.TRANS_OUT,[_.TOKEN_METHOD_TRANSFER]:f.TRANS_OUT,[_.TOKEN_METHOD_TRANSFER_FROM]:f.TRANS_OUT}[c]||f.CONTRACT_CALL;o.isRevoke&&(b=f.CANCEL_AUTHORIZATION);let y={};return c===_.TOKEN_METHOD_APPROVE&&(y.approvedAmount=i,y.coinSymbol=n.symbol,y.tokenAddress=m,y.approvedAddress=o.address),c===_.SENT_ETHER&&(y.value=le(xe(d)),y.toAddress=m,y.coinSymbol=r.symbol),(c===_.TOKEN_METHOD_TRANSFER||c===_.TOKEN_METHOD_TRANSFER_FROM)&&(y.value=a,y.tokenAddress=m,y.toAddress=o.address,y.coinSymbol=n.symbol),{type:b,txParams:N,extraParams:y}};function yt(e,t,o){let n=(0,ot.useHistory)(),r=Ve(),s=We(),i=Xe(o),[a,c]=(0,P.useState)(!1);return[{sign:async(d,l)=>{c(!0),i(e,d,l).then(async({txHash:p,rawTx:A})=>{let v=e.signFn===U.KAIA_SIGN_TRANSACTION?{raw:A}:p;r({id:t,result:v}),n.push(Ce)}).catch(p=>{p.message!==Y&&I.error({title:p?.message}),r({id:t,error:p?.message||"Transaction failed"}),c(!1)}).finally(()=>{n.go(0)})},cancel:async()=>{await s({id:t}),n.go(0)}},a]}function to(e,t){let[o]=dt(e),n=ft({data:e.data,type:o}),[r,s]=Tt(e?.to,t),i=_t({walletId:e?.walletId,origin:e.origin,...n,...r}),a=(0,P.useMemo)(()=>He(n?.amount||0,r?.decimals),[n?.amount,r?.decimals]),[c,u]=gt({...n,...r,formattedAmount:a}),[m,d]=(0,P.useState)(e.data);(0,P.useEffect)(()=>{if(o===_.TOKEN_METHOD_APPROVE)try{let Q=nt(e.data,{customPermissionAmount:c.customApproveAmount});d(Q)}catch{}},[c.customApproveAmount,e.data,r?.decimals,n,o]);let l={...t,name:t?.name||t?.chainName},[p,A]=At(e.from,t),{setGasType:v,currentGasInfo:S,chainGasLevels:k,chainGasLoading:N,setCustomGasOption:K,chainGasError:b,chainGasLoadFailed:y,chainGasLimitLoadFailed:z}=ke({to:e.to,from:e.from,value:e.value||"0x0",data:m,method:e.method},{gasLimit:e.gas||e.gasLimit,gasPrice:e.gasPrice,maxFeePerGas:e.maxFeePerGas,maxPriorityFeePerGas:e.maxPriorityFeePerGas},t),B=Pt({tx:{...e,data:m},nonce:p.custom||p.suggested,txData:n,tokenInfo:r,chain:l,customGasInfo:S,approvedAmount:c.customApproveAmount,formattedAmount:a,txType:o}),[{sign:Z,cancel:j},$]=yt(B,e.id,t),J=(0,P.useMemo)(()=>{switch(o){case _.DEPLOY_CONTRACT:return C("developer_mode_history_title_contract_eployment");case _.TOKEN_METHOD_APPROVE:return n?.isRevoke?C("wallet_extension_popup_btn_revoke_approval"):C("wallet_extension_popup_btn_approve");default:return C("wallet_extension_popup_title_contract_interaction")}},[o,n?.isRevoke]);return[{type:o,title:J,auth:{...c,...r,formattedAmount:a},meta:i,chain:l,nonce:p,gas:{setGasType:v,chainGasLevels:k,currentGasInfo:S,setCustomGasOption:K,chainGasLoading:N,chainGasError:b,chainGasLoadFailed:y,chainGasLimitLoadFailed:z},loading:{sign:$,token:s},data:m},{sign:Z,cancel:j,setNonce:A,setAuthAmount:u}]}T();g();T();g();function rt(e,t,o){return async n=>{await E().resolvePendingApproval(e,t);let{pendingApprovals:r}=await F(n);Object.values(r).length===0&&!o&&n(te())}}function st(e){return async t=>{await E().rejectPendingApproval(e);let{pendingApprovals:o}=await F(t);Object.values(o).length===0&&t(te())}}function Po(e){let t=M(),n=(a=>{let{id:c,origin:u,requestData:m,type:d,requestData:{chainId:l}}=a;return{id:c,origin:u,...m,requestData:m,chainIdToDisplay:parseInt(l,16),switchType:d,explorers:m.blockExplorerUrl}})(e),{addRpcNetwork:r}=we();return[n,{cancel:async()=>{await t(st(n.id)),await F(t)},approve:async()=>{let{rpcUrl:a,ticker:c,blockExplorerUrl:u,chainId:m,faucetUrl:d,chainName:l}=n,p=await r({chainId:m,explorerUrl:u,faucetUrl:d,name:l,rpcUrl:a,symbol:c}),{uniqueId:A}=p;await t(Me(_e,a,c,l,m,{},!0,A)),await t(Ye({isRpcMode:!0,currentNetworkUniqueId:A})),await t(rt(n.id,n.requestData)),await F(t)}}]}T();g();function xo(e){return fe(e?.image)?e.image=e.image[0]:Te(e?.image)&&(e.image=null),e}export{Ze as a,je as b,Qe as c,Xe as d,un as e,mn as f,et as g,dt as h,ft as i,Pt as j,to as k,Po as l,vt as m,xo as n};
//# sourceMappingURL=chunk-RS5XCICJ.js.map
