import{a as $}from"./chunk-GYSFU47H.js";import{a as B,b as S,g as b}from"./chunk-I6UBKGB5.js";import"./chunk-ZIR6OOXX.js";import"./chunk-KYVX6VSI.js";import{l as M}from"./chunk-WN3TRBGI.js";import"./chunk-3FMJDUGT.js";import{c as w}from"./chunk-2O5TMJZM.js";import{O as L,g as U}from"./chunk-UI4IZNSB.js";import"./chunk-FCGPU67F.js";import"./chunk-FXRKHQFW.js";import"./chunk-YTHL7242.js";import"./chunk-XOHZCMW2.js";import{da as D}from"./chunk-EQ34WRCJ.js";import"./chunk-DSNMNSMD.js";import"./chunk-U2IAA473.js";import"./chunk-3O2IEAHF.js";import"./chunk-URGJ6D4O.js";import"./chunk-WC6GCIBJ.js";import{a as X}from"./chunk-I2AEM4CA.js";import"./chunk-JRC3ZUKA.js";import"./chunk-4U5VOZ7H.js";import"./chunk-FVHZWNUE.js";import"./chunk-IQUFNLVG.js";import"./chunk-XYWWXNVK.js";import"./chunk-VYWNZTTM.js";import"./chunk-5CHTOVVG.js";import"./chunk-FB3ILH2L.js";import"./chunk-FLSAETOH.js";import"./chunk-TGW66MRK.js";import{f as R}from"./chunk-LRIABBHT.js";import{f as F,u as P}from"./chunk-TR37MFB4.js";import"./chunk-PNECIDQW.js";import"./chunk-BVDMVGLD.js";import{Aa as Q,B as C}from"./chunk-4C5HF6J2.js";import"./chunk-BY6XCDJZ.js";import"./chunk-U6W3TK77.js";import"./chunk-GTDBOF5Q.js";import"./chunk-EI7BJC6V.js";import"./chunk-B3EOGJ3Y.js";import"./chunk-YL2RBVBZ.js";import"./chunk-4HAPQ4J7.js";import"./chunk-WZALYVUQ.js";import"./chunk-F5YUOHHL.js";import"./chunk-LWG66QL2.js";import"./chunk-26XSB24L.js";import"./chunk-IFKSF5TW.js";import"./chunk-PDIVTGDM.js";import"./chunk-UL6IEE2K.js";import"./chunk-4ARIYUS3.js";import{f as m,o as f,p as l,q as x}from"./chunk-UWURTNRY.js";f();x();f();x();f();x();f();x();var J=function(){var a=function(o,r){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,t){i.__proto__=t}||function(i,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])},a(o,r)};return function(o,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");a(o,r);function i(){this.constructor=o}o.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}}();var Z={},ee={},N=function(a,o){ee[a]=o},e=function(a){var o=function(r){J(i,r);function i(t,n,s){var u=r.call(this,t||a,s)||this;if(Object.setPrototypeOf(u,i.prototype),u.name=a,n)for(var d in n)u[d]=n[d];if(s&&re(s)&&"cause"in s&&!("cause"in u)){var c=s.cause;u.cause=c,"stack"in c&&(u.stack=u.stack+`
CAUSE: `+c.stack)}return u}return i}(Error);return Z[a]=o,o};function re(a){return typeof a=="object"}var G=function(){var a=function(o,r){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,t){i.__proto__=t}||function(i,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])},a(o,r)};return function(o,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");a(o,r);function i(){this.constructor=o}o.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}}();var xe=e("AccountNameRequired"),he=e("AccountNotSupported"),Ee=e("AmountRequired"),ge=e("BluetoothRequired"),Te=e("BtcUnmatchedApp"),_e=e("CantOpenDevice"),Ae=e("CashAddrNotSupported"),De=e("CurrencyNotSupported"),Se=e("DeviceAppVerifyNotSupported"),Ne=e("DeviceGenuineSocketEarlyClose"),Oe=e("DeviceNotGenuine"),Ie=e("DeviceOnDashboardExpected"),ye=e("DeviceOnDashboardUnexpected"),me=e("DeviceInOSUExpected"),Ce=e("DeviceHalted"),Re=e("DeviceNameInvalid"),we=e("DeviceSocketFail"),Ue=e("DeviceSocketNoBulkStatus"),te=e("LockedDeviceError"),Le=e("DisconnectedDevice"),Fe=e("DisconnectedDeviceDuringOperation"),Pe=e("DeviceExtractOnboardingStateError"),Me=e("DeviceOnboardingStatePollingError"),Be=e("EnpointConfig"),be=e("EthAppPleaseEnableContractData"),ke=e("FeeEstimationFailed"),Ge=e("FirmwareNotRecognized"),He=e("HardResetFail"),ze=e("InvalidXRPTag"),We=e("InvalidAddress"),qe=e("InvalidAddressBecauseDestinationIsAlsoSource"),Ve=e("LatestMCUInstalledError"),je=e("UnknownMCU"),Ke=e("LedgerAPIError"),Ye=e("LedgerAPIErrorWithMessage"),Qe=e("LedgerAPINotAvailable"),Xe=e("ManagerAppAlreadyInstalled"),$e=e("ManagerAppRelyOnBTC"),Je=e("ManagerAppDepInstallRequired"),Ze=e("ManagerAppDepUninstallRequired"),er=e("ManagerDeviceLocked"),rr=e("ManagerFirmwareNotEnoughSpace"),tr=e("ManagerNotEnoughSpace"),nr=e("ManagerUninstallBTCDep"),ar=e("NetworkDown"),or=e("NoAddressesFound"),ir=e("NotEnoughBalance"),sr=e("NotEnoughBalanceToDelegate"),cr=e("NotEnoughBalanceInParentAccount"),ur=e("NotEnoughSpendableBalance"),pr=e("NotEnoughBalanceBecauseDestinationNotCreated"),dr=e("NoAccessToCamera"),lr=e("NotEnoughGas"),vr=e("NotSupportedLegacyAddress"),fr=e("GasLessThanEstimate"),xr=e("PriorityFeeTooLow"),hr=e("PriorityFeeTooHigh"),Er=e("PriorityFeeHigherThanMaxFee"),gr=e("MaxFeeTooLow"),Tr=e("PasswordsDontMatch"),_r=e("PasswordIncorrect"),Ar=e("RecommendSubAccountsToEmpty"),Dr=e("RecommendUndelegation"),Sr=e("TimeoutTagged"),Nr=e("UnexpectedBootloader"),Or=e("MCUNotGenuineToDashboard"),Ir=e("RecipientRequired"),yr=e("UnavailableTezosOriginatedAccountReceive"),mr=e("UnavailableTezosOriginatedAccountSend"),Cr=e("UpdateFetchFileFail"),Rr=e("UpdateIncorrectHash"),wr=e("UpdateIncorrectSig"),Ur=e("UpdateYourApp"),Lr=e("UserRefusedDeviceNameChange"),Fr=e("UserRefusedAddress"),Pr=e("UserRefusedFirmwareUpdate"),Mr=e("UserRefusedAllowManager"),Br=e("UserRefusedOnDevice"),br=e("TransportOpenUserCancelled"),kr=e("TransportInterfaceNotAvailable"),Gr=e("TransportRaceCondition"),Hr=e("TransportWebUSBGestureRequired"),zr=e("DeviceShouldStayInApp"),Wr=e("WebsocketConnectionError"),qr=e("WebsocketConnectionFailed"),Vr=e("WrongDeviceForAccount"),jr=e("WrongAppForCurrency"),Kr=e("ETHAddressNonEIP"),Yr=e("CantScanQRCode"),Qr=e("FeeNotLoaded"),Xr=e("FeeRequired"),$r=e("FeeTooHigh"),Jr=e("PendingOperation"),Zr=e("SyncError"),et=e("PairingFailed"),rt=e("GenuineCheckFailed"),tt=e("LedgerAPI4xx"),nt=e("LedgerAPI5xx"),at=e("FirmwareOrAppUpdateRequired"),ot=e("OpReturnSizeLimit"),it=e("DustLimit"),st=e("LanguageNotFound"),ct=e("NoDBPathGiven"),ut=e("DBWrongPassword"),pt=e("DBNotReset"),k;(function(a){a.Unknown="Unknown",a.LocationServicesDisabled="LocationServicesDisabled",a.LocationServicesUnauthorized="LocationServicesUnauthorized",a.BluetoothScanStartFailed="BluetoothScanStartFailed"})(k||(k={}));var dt=function(a){G(o,a);function o(r,i){var t=a.call(this,i)||this;return t.name="HwTransportError",t.type=r,Object.setPrototypeOf(t,o.prototype),t}return o}(Error);var ne=function(a){G(o,a);function o(r,i){var t=this,n="TransportError";return t=a.call(this,r||n)||this,t.name=n,t.message=r,t.stack=new Error().stack,t.id=i,t}return o}(Error);N("TransportError",function(a){return new ne(a.message,a.id)});var h={ACCESS_CONDITION_NOT_FULFILLED:38916,ALGORITHM_NOT_SUPPORTED:38020,CLA_NOT_SUPPORTED:28160,CODE_BLOCKED:38976,CODE_NOT_INITIALIZED:38914,COMMAND_INCOMPATIBLE_FILE_STRUCTURE:27009,CONDITIONS_OF_USE_NOT_SATISFIED:27013,CONTRADICTION_INVALIDATION:38928,CONTRADICTION_SECRET_CODE_STATUS:38920,CUSTOM_IMAGE_BOOTLOADER:26159,CUSTOM_IMAGE_EMPTY:26158,FILE_ALREADY_EXISTS:27273,FILE_NOT_FOUND:37892,GP_AUTH_FAILED:25344,HALTED:28586,INCONSISTENT_FILE:37896,INCORRECT_DATA:27264,INCORRECT_LENGTH:26368,INCORRECT_P1_P2:27392,INS_NOT_SUPPORTED:27904,DEVICE_NOT_ONBOARDED:27911,DEVICE_NOT_ONBOARDED_2:26129,INVALID_KCV:38021,INVALID_OFFSET:37890,LICENSING:28482,LOCKED_DEVICE:21781,MAX_VALUE_REACHED:38992,MEMORY_PROBLEM:37440,MISSING_CRITICAL_PARAMETER:26624,NO_EF_SELECTED:37888,NOT_ENOUGH_MEMORY_SPACE:27268,OK:36864,PIN_REMAINING_ATTEMPTS:25536,REFERENCED_DATA_NOT_FOUND:27272,SECURITY_STATUS_NOT_SATISFIED:27010,TECHNICAL_PROBLEM:28416,UNKNOWN_APDU:27906,USER_REFUSED_ON_DEVICE:21761,NOT_ENOUGH_SPACE:20738};function ae(a){switch(a){case 26368:return"Incorrect length";case 26624:return"Missing critical parameter";case 27010:return"Security not satisfied (dongle locked or have invalid access rights)";case 27013:return"Condition of use not satisfied (denied by the user?)";case 27264:return"Invalid data received";case 27392:return"Invalid parameter received";case 21781:return"Locked device"}if(28416<=a&&a<=28671)return"Internal error, please report"}function H(a){var o=Object.keys(h).find(function(n){return h[n]===a})||"UNKNOWN_ERROR",r=ae(a)||o,i=a.toString(16),t="Ledger device: ".concat(r," (0x").concat(i,")");if(a===h.LOCKED_DEVICE)throw new te(t);this.name="TransportStatusError",this.message=t,this.stack=new Error().stack,this.statusCode=a,this.statusText=o}H.prototype=new Error;N("TransportStatusError",function(a){return new H(a.statusCode)});var j=m($());var E=function(a,o,r,i){function t(n){return n instanceof r?n:new r(function(s){s(n)})}return new(r||(r=Promise))(function(n,s){function u(p){try{c(i.next(p))}catch(v){s(v)}}function d(p){try{c(i.throw(p))}catch(v){s(v)}}function c(p){p.done?n(p.value):t(p.value).then(u,d)}c((i=i.apply(a,o||[])).next())})},g=function(a,o){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,t,n,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(c){return function(p){return d([c,p])}}function d(c){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,t&&(n=c[0]&2?t.return:c[0]?t.throw||((n=t.return)&&n.call(t),0):t.next)&&!(n=n.call(t,c[1])).done)return n;switch(t=0,n&&(c=[c[0]&2,n.value]),c[0]){case 0:case 1:n=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,t=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!n||c[1]>n[0]&&c[1]<n[3])){r.label=c[1];break}if(c[0]===6&&r.label<n[1]){r.label=n[1],n=c;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(c);break}n[2]&&r.ops.pop(),r.trys.pop();continue}c=o.call(a,r)}catch(p){c=[6,p],t=0}finally{i=n=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},z=function(a,o){var r=typeof Symbol=="function"&&a[Symbol.iterator];if(!r)return a;var i=r.call(a),t,n=[],s;try{for(;(o===void 0||o-- >0)&&!(t=i.next()).done;)n.push(t.value)}catch(u){s={error:u}}finally{try{t&&!t.done&&(r=i.return)&&r.call(i)}finally{if(s)throw s.error}}return n},oe=function(a){var o=typeof Symbol=="function"&&Symbol.iterator,r=o&&a[o],i=0;if(r)return r.call(a);if(a&&typeof a.length=="number")return{next:function(){return a&&i>=a.length&&(a=void 0),{value:a&&a[i++],done:!a}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")},W=0,O=1,ie=1,se=2,T=255,q=224,_={GET_VERSION:4,GET_ADDR:5,SIGN:6,SIGN_OFFCHAIN:7},A;(function(a){a[a.BLIND_SIGNATURE_REQUIRED=26632]="BLIND_SIGNATURE_REQUIRED"})(A||(A={}));var ce=function(){function a(o,r){r===void 0&&(r="solana_default_scramble_key"),this.transport=o,this.transport.decorateAppAPIMethods(this,["getAddress","signTransaction","getAppConfiguration"],r)}return a.prototype.getAddress=function(o,r){return r===void 0&&(r=!1),E(this,void 0,void 0,function(){var i,t;return g(this,function(n){switch(n.label){case 0:return i=this.pathToBuffer(o),[4,this.sendToDevice(_.GET_ADDR,r?O:W,i)];case 1:return t=n.sent(),[2,{address:t}]}})})},a.prototype.signTransaction=function(o,r){return E(this,void 0,void 0,function(){var i,t,n,s;return g(this,function(u){switch(u.label){case 0:return i=this.pathToBuffer(o),t=l.Buffer.alloc(1),t.writeUInt8(1,0),n=l.Buffer.concat([t,i,r]),[4,this.sendToDevice(_.SIGN,O,n)];case 1:return s=u.sent(),[2,{signature:s}]}})})},a.prototype.signOffchainMessage=function(o,r){return E(this,void 0,void 0,function(){var i,t,n,s;return g(this,function(u){switch(u.label){case 0:return i=this.pathToBuffer(o),t=l.Buffer.alloc(1),t.writeUInt8(1,0),n=l.Buffer.concat([t,i,r]),[4,this.sendToDevice(_.SIGN_OFFCHAIN,O,n)];case 1:return s=u.sent(),[2,{signature:s}]}})})},a.prototype.getAppConfiguration=function(){return E(this,void 0,void 0,function(){var o,r,i,t,n,s;return g(this,function(u){switch(u.label){case 0:return[4,this.sendToDevice(_.GET_VERSION,W,l.Buffer.alloc(0))];case 1:return o=z.apply(void 0,[u.sent(),5]),r=o[0],i=o[1],t=o[2],n=o[3],s=o[4],[2,{blindSigningEnabled:Boolean(r),pubKeyDisplayMode:i,version:"".concat(t,".").concat(n,".").concat(s)}]}})})},a.prototype.pathToBuffer=function(o){var r=o.split("/").map(function(t){return t.endsWith("'")||t.endsWith("h")?t:t+"'"}).join("/"),i=j.default.fromString(r).toPathArray();return this.serializePath(i)},a.prototype.serializePath=function(o){var r,i,t=l.Buffer.alloc(1+o.length*4);t.writeUInt8(o.length,0);try{for(var n=oe(o.entries()),s=n.next();!s.done;s=n.next()){var u=z(s.value,2),d=u[0],c=u[1];t.writeUInt32BE(c,1+d*4)}}catch(p){r={error:p}}finally{try{s&&!s.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}return t},a.prototype.sendToDevice=function(o,r,i){return E(this,void 0,void 0,function(){var t,n,s,u,d,c,p;return g(this,function(v){switch(v.label){case 0:if(t=[h.OK,A.BLIND_SIGNATURE_REQUIRED],n=0,s=0,!(i.length>T))return[3,3];v.label=1;case 1:return i.length-s>T?(u=i.slice(s,s+T),s+=T,[4,this.transport.send(q,o,r,n|se,u,t)]):[3,3];case 2:return d=v.sent(),this.throwOnFailure(d),n|=ie,[3,1];case 3:return c=i.slice(s),[4,this.transport.send(q,o,r,n,c,t)];case 4:return p=v.sent(),this.throwOnFailure(p),[2,p.slice(0,p.length-2)]}})})},a.prototype.throwOnFailure=function(o){var r=o.readUInt16BE(o.length-2);switch(r){case A.BLIND_SIGNATURE_REQUIRED:throw new Error("Missing a parameter. Try enabling blind signature in the app");default:return}},a}(),K=ce,V;(function(a){a[a.LONG=0]="LONG",a[a.SHORT=1]="SHORT"})(V||(V={}));var I=m(X());Q();var y=class extends b{async makeApp(){await this.initLedgerTransPorter(),this.app||(this.app=new K(this.ledgerTransPorter))}async getAddressPromise(o,r){await this.makeApp();let i=[];for(let t=o*5;t<(o+1)*5;t++){let n=`44'/501'/${t}'/0'`;r===M&&(n=`44'/501'/${t}'`);let{address:s}=await this.app.getAddress(n,!1);i.push({address:I.default.encode(s),index:t,path:n})}return i}async getAddress(o=0,r=""){return await Promise.race([this.getAddressPromise(o,r),this.throwTimeoutError()])}async getTokens(o,r){let i=o.map(({address:t})=>t);try{let t=await L(w.getChainToken,{addressList:i,coinId:r});if(t?.code===0){let{data:n}=t;n.forEach(({address:s,coinAmount:u})=>{let d=C(o,{address:s});d.coinAmount=u})}}catch{}return o}async signTransaction(o,r){try{S.openModal(B.confirm);let i=o.hdPathMap[D];await this.checkLedgerConnection();let{payer:t}=r,{getHardWareRawTransaction:n}=await U(),s=await n(R.SOL,{data:r}),u=l.Buffer.from(s,"hex"),d=P.from(u),c=d.serializeMessage(),{signature:p}=await this.app.signTransaction(i,c),v=new F(t);d.signatures&&(d.signatures=[]),d.addSignature(v,p);let Y=d.serialize();return S.closeModal(),I.default.encode(Y)}catch(i){return this.handleErrors(i,D)}}},Rt=new y;export{Rt as default};
//# sourceMappingURL=solanaAdapter-GHMAL247.js.map
