import{a as Is,b as xl,c as wl,d as yl,e as Tl,f as kl,g as Pl,h as Ml,i as Al,j as Il,k as Bl,l as Dl}from"./chunk-6RMBLK33.js";import{c as Sl,e as Cl}from"./chunk-RL2ONFCU.js";import"./chunk-4R47QJTV.js";import"./chunk-7737QYC5.js";import"./chunk-PIPV5FEN.js";import"./chunk-XEYCZGG6.js";import{a as vl}from"./chunk-RGJMHVCN.js";import"./chunk-ZLI6GILE.js";import{a as ml}from"./chunk-PAQO5RV4.js";import{a as pl}from"./chunk-6AOLLEIE.js";import"./chunk-LOWDVO7P.js";import{a as fl,b as Ms,c as gl,d as As}from"./chunk-5FPC2YLZ.js";import{b as bl}from"./chunk-6JRCGATI.js";import"./chunk-5Q2KUGY5.js";import"./chunk-L5IAYR5L.js";import"./chunk-BHUBJAUL.js";import"./chunk-S32HDRQT.js";import"./chunk-HNGW4YGJ.js";import{a as jo,b as Go,c as ul,d as _l}from"./chunk-TCHCLDB5.js";import"./chunk-J5NCS5VO.js";import"./chunk-DGIOI3MN.js";import"./chunk-T475WHHH.js";import{a as dl}from"./chunk-OSD5TZNZ.js";import"./chunk-57J76VLB.js";import{a as me}from"./chunk-ZTAEYDNS.js";import{a as ll}from"./chunk-IWYRUFZN.js";import{a as al}from"./chunk-4JAEPDXN.js";import"./chunk-LLOOJQVQ.js";import"./chunk-YKQL2NOR.js";import"./chunk-7LMS53CN.js";import"./chunk-ITLSSVGE.js";import"./chunk-PWVBSLOL.js";import"./chunk-AOZHPYH5.js";import"./chunk-W25M53MS.js";import"./chunk-HLTJYEGI.js";import"./chunk-4YPL7LEO.js";import"./chunk-452JEOHF.js";import"./chunk-3MLYZLAT.js";import{a as hl}from"./chunk-TJAFWAJG.js";import"./chunk-EZ3BUTHE.js";import"./chunk-GZISJRKI.js";import"./chunk-TVBTJSJ6.js";import"./chunk-J6RZSPH6.js";import"./chunk-NIGR3I4J.js";import"./chunk-JXVJV7BH.js";import{a as cl}from"./chunk-5HKBJUHN.js";import"./chunk-RZOHZNJG.js";import"./chunk-RQTEHFJ2.js";import"./chunk-75EAYNWR.js";import"./chunk-DKVOSSSH.js";import"./chunk-V7YATDMZ.js";import"./chunk-YRQLRR65.js";import"./chunk-T2AAZNU7.js";import"./chunk-E4CKCWHV.js";import"./chunk-X4IU7NMU.js";import"./chunk-66RCYZEO.js";import"./chunk-BIUKJDG5.js";import"./chunk-MNRE2RWN.js";import"./chunk-S63SUKPS.js";import"./chunk-QR6SNDPA.js";import"./chunk-DB7NVRTE.js";import"./chunk-EF6FTTLT.js";import{a as Ps}from"./chunk-U44ZBWPF.js";import{b as Wt}from"./chunk-YPTISS47.js";import{a as Jt}from"./chunk-UX2JFEX5.js";import"./chunk-XHRUTTJG.js";import"./chunk-OS6U6P6N.js";import{a as rl,c as ol,k as nl}from"./chunk-PLVYKYSQ.js";import"./chunk-MEZ72IGZ.js";import"./chunk-ZLTTBRML.js";import"./chunk-XUGHAFHG.js";import{a as ye}from"./chunk-B5L26Z2J.js";import{d as il}from"./chunk-AVG63QW4.js";import{g as Ts,h as ks}from"./chunk-YLT6ZRGE.js";import{b as sl}from"./chunk-VSNCKUAC.js";import"./chunk-OB65JCC3.js";import"./chunk-ZWKYYPCG.js";import"./chunk-YLPOVMK6.js";import"./chunk-CAWXATKV.js";import"./chunk-GIKT3XNH.js";import"./chunk-4VAKOKZO.js";import"./chunk-F43OFDEC.js";import"./chunk-XAUZ4FZE.js";import"./chunk-5JVWMQI2.js";import"./chunk-KLS3SJXA.js";import"./chunk-5DQKP6TK.js";import"./chunk-QTPS5BDP.js";import"./chunk-KOQXCGQ5.js";import"./chunk-P7NYIGUS.js";import"./chunk-OWPVBYY3.js";import"./chunk-ZNFTIF43.js";import"./chunk-D52EE5TC.js";import"./chunk-FEU7MNAN.js";import"./chunk-CWNI35TN.js";import"./chunk-E6SXR3B6.js";import"./chunk-GTBNRR37.js";import"./chunk-UUOZSCBD.js";import"./chunk-A7FGCMOW.js";import"./chunk-V2CZ7DY4.js";import"./chunk-3PLVXUNW.js";import"./chunk-HIUQCAJS.js";import"./chunk-S6FHNOIH.js";import"./chunk-RKCZ2ONP.js";import"./chunk-RER2JAFZ.js";import"./chunk-CJAFGYQK.js";import"./chunk-QED56456.js";import"./chunk-HSSW2VTC.js";import"./chunk-PYCB247J.js";import"./chunk-2LQJ3JX6.js";import"./chunk-KF7FMIRD.js";import"./chunk-N4IYN7DD.js";import"./chunk-UY2DPNBT.js";import"./chunk-SZZZVLQW.js";import"./chunk-V5J3A5L5.js";import"./chunk-CERSDYPT.js";import"./chunk-RZETZIQO.js";import"./chunk-P5GHREX3.js";import"./chunk-HUG2KBCE.js";import"./chunk-6XMXPOUW.js";import"./chunk-3WKBEXBH.js";import"./chunk-RK4OLGCC.js";import"./chunk-NNPT43SF.js";import"./chunk-VL2JCPJS.js";import"./chunk-CTJAEFLV.js";import"./chunk-AP4E6GDF.js";import"./chunk-RPH2MNBW.js";import"./chunk-SKUQ6ZA4.js";import"./chunk-P3FTJE4X.js";import"./chunk-ACIP3YF7.js";import"./chunk-W6ZDZJCJ.js";import"./chunk-PGGBOJAH.js";import"./chunk-JDCCMYBK.js";import"./chunk-554VFFSY.js";import"./chunk-4ADHM5NM.js";import"./chunk-JBOOQ7HO.js";import"./chunk-RKPJE2LG.js";import"./chunk-55VRIXXR.js";import"./chunk-W6Z3G5IP.js";import{a as Fo,b as Ea}from"./chunk-B6ZJJVQC.js";import{a as qa}from"./chunk-ZYRXDVPT.js";import{a as Kt,d as Va,h as Ra,p as za,q as Na}from"./chunk-QZITJOI6.js";import"./chunk-B4CRE6WK.js";import"./chunk-VY2OGUH2.js";import{d as ya}from"./chunk-GHRGCPR7.js";import"./chunk-2XOPB27K.js";import"./chunk-LZL7SWT5.js";import"./chunk-NCGPJXQK.js";import"./chunk-VGYB2PVD.js";import"./chunk-JNWSF6O6.js";import{a as Vt}from"./chunk-OYIB3B2O.js";import"./chunk-OBLKTTHP.js";import"./chunk-NVBOE3PE.js";import"./chunk-TXIKSV43.js";import"./chunk-LQJXR5XX.js";import"./chunk-NQGIYDUG.js";import"./chunk-ARRY6F45.js";import"./chunk-QTCVWDVR.js";import"./chunk-4ITEJ5A6.js";import"./chunk-JYCBCMDP.js";import"./chunk-CBZ2RV36.js";import"./chunk-GVYIP5Q5.js";import{A as qt,Aa as as,Xa as Ca,_a as xa}from"./chunk-VHMBEOFX.js";import"./chunk-L3AMAP6V.js";import"./chunk-W3VW6MYS.js";import"./chunk-GWHLETPD.js";import"./chunk-6GJ4TEPK.js";import"./chunk-BYDDPVAA.js";import"./chunk-CSTKCSUP.js";import{e as Xo}from"./chunk-M43NTBTB.js";import"./chunk-CKHT4PIF.js";import"./chunk-JMNZU6WB.js";import{a as ht}from"./chunk-WXD7TULU.js";import"./chunk-JQHLKZPQ.js";import{l as ja}from"./chunk-ZZBUS7GI.js";import{c as j}from"./chunk-PMG6IXOR.js";import{a as Nt}from"./chunk-BD5XO4WL.js";import"./chunk-7U7FORYL.js";import{a as Ti,b as ki,c as Pi,d as _s,e as ms,f as Mi,g as ps,i as Ba,q as fs,r as gs,s as bs}from"./chunk-MT3ANHCR.js";import{j as el,l as tl}from"./chunk-2IJ4E4D3.js";import{i as Qa,j as Ja}from"./chunk-XJ2EVWVX.js";import"./chunk-DD6IGY5O.js";import"./chunk-JMM35KIH.js";import"./chunk-5E7YC7OF.js";import"./chunk-LYGOKEAJ.js";import"./chunk-NS5EW6UN.js";import"./chunk-VUBIYSGX.js";import"./chunk-PNOOVDMP.js";import"./chunk-FHFRBSOO.js";import"./chunk-DU4RS7AX.js";import{a as Sa}from"./chunk-5C7AUJM4.js";import"./chunk-FLXVXXZH.js";import{a as Ga}from"./chunk-XBUPORYF.js";import"./chunk-YVLQLIW6.js";import"./chunk-HBXZ3GPM.js";import"./chunk-6C7RJCTT.js";import{a as Wd,b as Yo,g as zt,j as $o,o as N}from"./chunk-N6PI3XTA.js";import{f as Cs}from"./chunk-7DW2ZPOD.js";import"./chunk-SI5WJURV.js";import"./chunk-MT4YWUUK.js";import{b as Za,i as ys,j as Ka}from"./chunk-IPVHRCDK.js";import"./chunk-JW2AVC2H.js";import"./chunk-AKOAGCJX.js";import"./chunk-ARDRUD4P.js";import{j as Xa}from"./chunk-WYX7GFOD.js";import{a as us}from"./chunk-G6PA2JD3.js";import"./chunk-N2N44VBE.js";import"./chunk-ZDJRNLYZ.js";import"./chunk-RV5WZKGQ.js";import{a as yi,b as Aa,c as it,f as Wo}from"./chunk-MJSLAJV6.js";import{b as Ta,d as ka,e as ls,i as cs,m as hs,p as Pa,u as Ma}from"./chunk-KC2XLVFC.js";import{B as va,M as os,P as ns,g as Gt,qa as ct,ra as oe}from"./chunk-MJDO2VHF.js";import"./chunk-TFTCL6XD.js";import"./chunk-TBQGFYU3.js";import"./chunk-L5AZICLM.js";import{b as wa}from"./chunk-WLEQHCLB.js";import{e as Zt,g as vs,ha as La,lb as Oa,wa as Ss,x as Ho}from"./chunk-QF42JCDG.js";import"./chunk-DRCTWZQB.js";import"./chunk-KGMP5AO5.js";import"./chunk-EAE2NUFS.js";import"./chunk-OLICTWCW.js";import"./chunk-SDBZJWGW.js";import{d as Da}from"./chunk-F3ILJHGP.js";import"./chunk-6M37VPK2.js";import"./chunk-WOJGOC63.js";import"./chunk-3F7OC7N7.js";import"./chunk-HZOYPVSA.js";import"./chunk-Z4GX4TH2.js";import{c as Ia,k as ds}from"./chunk-OKGWI7CU.js";import{b as da,c as Ot,g as No}from"./chunk-EPDR6VAQ.js";import"./chunk-RFTC6RNT.js";import"./chunk-I6UBKGB5.js";import{h as $a}from"./chunk-ZIR6OOXX.js";import"./chunk-KYVX6VSI.js";import"./chunk-WN3TRBGI.js";import{c as Ye}from"./chunk-3FMJDUGT.js";import{c as ua}from"./chunk-2O5TMJZM.js";import{K as _a}from"./chunk-UI4IZNSB.js";import"./chunk-FCGPU67F.js";import"./chunk-FXRKHQFW.js";import"./chunk-YTHL7242.js";import"./chunk-XOHZCMW2.js";import{$ as pa,Z as ma,eb as ga,ta as fa,vb as ba,wa as rs}from"./chunk-EQ34WRCJ.js";import"./chunk-UIZGYUZK.js";import{B as ha,j as ca,k as W,p as E,s as J,w as wi}from"./chunk-DSNMNSMD.js";import"./chunk-U2IAA473.js";import{a as Rt}from"./chunk-DOSBJ3L3.js";import"./chunk-DNGRHKLV.js";import"./chunk-3O2IEAHF.js";import{A as rt,I as Ua,J as Ya,R as we,_ as Qt,b as Wa,d as Ue,h as Ha,m as fe,o as xs,p as ws,y as Ii}from"./chunk-URGJ6D4O.js";import"./chunk-WC6GCIBJ.js";import"./chunk-I2AEM4CA.js";import"./chunk-JRC3ZUKA.js";import"./chunk-4U5VOZ7H.js";import"./chunk-FVHZWNUE.js";import{a as Fa}from"./chunk-IQUFNLVG.js";import{C as Ai,t as He,w as Uo}from"./chunk-XYWWXNVK.js";import"./chunk-VYWNZTTM.js";import"./chunk-5CHTOVVG.js";import{a as st}from"./chunk-FB3ILH2L.js";import{b as z}from"./chunk-FLSAETOH.js";import{c as Lt,d as ss}from"./chunk-TGW66MRK.js";import"./chunk-LRIABBHT.js";import"./chunk-KZ2ZLD6V.js";import"./chunk-NEASQB35.js";import"./chunk-5BYM6SMZ.js";import"./chunk-TR37MFB4.js";import"./chunk-PNECIDQW.js";import"./chunk-BVDMVGLD.js";import{Aa as tt,Q as U,e as la,r as zo}from"./chunk-4C5HF6J2.js";import"./chunk-4HSSECLD.js";import"./chunk-BY6XCDJZ.js";import"./chunk-U6W3TK77.js";import"./chunk-6GYKGMWB.js";import"./chunk-WJI4CIAQ.js";import"./chunk-PESQD55U.js";import"./chunk-WQGQVXPA.js";import"./chunk-GTDBOF5Q.js";import"./chunk-EI7BJC6V.js";import"./chunk-UY3WU5XU.js";import"./chunk-ALECRBLY.js";import"./chunk-B3EOGJ3Y.js";import"./chunk-YL2RBVBZ.js";import"./chunk-4HAPQ4J7.js";import"./chunk-QM6LXDU7.js";import"./chunk-WZALYVUQ.js";import"./chunk-F5YUOHHL.js";import"./chunk-26KHACOU.js";import"./chunk-VONUGAVN.js";import"./chunk-ZVKCRT3D.js";import"./chunk-MSOW5GDX.js";import"./chunk-O5NUB7LT.js";import"./chunk-QI2KSP5Y.js";import"./chunk-EL77VG5Z.js";import"./chunk-LWG66QL2.js";import"./chunk-26XSB24L.js";import"./chunk-IFKSF5TW.js";import"./chunk-PDIVTGDM.js";import"./chunk-UL6IEE2K.js";import"./chunk-4ARIYUS3.js";import{f as A,o as c,q as h}from"./chunk-UWURTNRY.js";c();h();var D=A(z());var Td=A(Rt());var kd=A(st()),Pd=A(Wd());c();h();var de=A(z());var Kl=A(st());c();h();var Bs=A(z());c();h();var El={"tx-list":"_tx-list_wy4tw_1",txList:"_tx-list_wy4tw_1"};var Fd=({coinId:s,address:e,container:t,txDetailData:i,setTxDetailData:r})=>{let o=ct(),[n]=ht(),a=oe(Ra),l=oe(Va),{run:d}=Pa(()=>{o(Kt({coinId:s,addressList:e?[e]:[]},{fromCoinDetail:!0}))},{wait:200});return Cl({scrollContainer:t},d),s?Bs.default.createElement(Sl.TxList,{hiddenAssets:n,className:El.txList,txList:l,isLoading:a,onRepeat:d,txDetailData:i,setTxDetailData:r}):null},Ll=(0,Bs.memo)(Fd);c();h();var ve=A(z()),Es=A(Rt()),$l=A(st());c();h();var ei=A(z()),Ol=A(st());function qo({buttonType:s="text",addressType:e,coinId:t}){let{handleClick:i}=Ms(e,t),r=me(qt);return s==="text"?ei.default.createElement(ei.default.Fragment,null,ei.default.createElement("div",{className:(0,Ol.default)(As.root,"hyperlink-text"),onClick:i},E("wallet_extension_mid_textbtn_manage_utxo")),ei.default.createElement("div",{className:As.line})):ei.default.createElement(j.IconButtonWithLabel,{iconClassName:As.iconButton,icon:"okx-wallet-plugin-funding-rates",onClick:()=>{r({button_clicked:"utxo"}),i()},space:13,text:E("wallet_extension_mid_item_uxto")})}c();h();var ge=A(z()),Vl=A(Rt());c();h();var dt={banner:"_banner_1dut7_1",bannerContent:"_bannerContent_1dut7_9",leftSection:"_leftSection_1dut7_13",apyIcon:"_apyIcon_1dut7_17",rightSection:"_rightSection_1dut7_21",mainTitle:"_mainTitle_1dut7_27",subTitle:"_subTitle_1dut7_33"};var Hd=({coin:s,coinList:e,className:t})=>{let i=Jt(),r=(0,Vl.useHistory)(),o=me(Ca),n=$a({dark:"/cdn/assets/imgs/2510/893899C7A6B3A368.png",light:"/cdn/assets/imgs/2510/F74DB740383EB349.png"}),a=(0,ge.useMemo)(()=>{if(s&&!e)return s.maxApy?{mode:"single",maxApy:s.maxApy,coin:s}:null;if(e&&e.length>0){let u=Ja(e);if(!u)return null;let _=Qa(e);return _.sort((f,m)=>W.gt(m.maxApy||"",f.maxApy||"")?1:-1),{mode:"list",maxApy:u,coinApyInfoList:_}}return null},[s,e]),l=(0,ge.useCallback)(u=>{if(!u.investmentId)return;let _=`${i?.defiDetail}/${u.investmentId}#source=extension`;globalThis.platform.openTab({url:_})},[i]),d=(0,ge.useCallback)(()=>{if(!a)return;let u={content_type:"defi_earn"};a.mode==="single"&&a.coin?(u.chainid=a.coin.chainId,u.address=a.coin.address,u.token_symbol=a.coin.symbol,o(u),l(a.coin)):a.mode==="list"&&(u.token_symbol=a.coinApyInfoList[0]?.symbol,o(u),r.push({pathname:La,state:{coinApyInfoList:a.coinApyInfoList}}))},[a,r,l,o]);return a?ge.default.createElement(Wa,{className:`${dt.banner} ${t||""}`,onClick:d},ge.default.createElement("div",{className:dt.bannerContent},ge.default.createElement("div",{className:dt.leftSection},ge.default.createElement(Fa,{src:n,className:dt.apyIcon})),ge.default.createElement("div",{className:dt.rightSection},ge.default.createElement("div",{className:dt.mainTitle},E("wallet_extension_defi_v2_banner_title_up_to_apy_with",{num:it(W.mul(a.maxApy,100)).value})),ge.default.createElement("div",{className:dt.subTitle},E("wallet_extension_defi_v2_banner_desc_try_earning_with_defi"))))):null},Ds=Hd;c();h();var $e=A(z()),Rl=A(st());c();h();var Bi={"retina-border-basic":"_retina-border-basic_1cqf3_1",retinaBorderBasic:"_retina-border-basic_1cqf3_1",container:"_container_1cqf3_29","container--has-tab":"_container--has-tab_1cqf3_32",containerHasTab:"_container--has-tab_1cqf3_32",textarea:"_textarea_1cqf3_35",link:"_link_1cqf3_41"};var Ud=({coinId:s,hasTab:e=!1})=>{let t=Jt(),i={coinId:s},[r,o]=(0,$e.useState)(!1);if($e.default.useEffect(()=>{(async()=>{try{let l=await _a(ua.checkDynamicValue,i);o(l.data)}catch{}})()},[s]),!r)return $e.default.createElement($e.default.Fragment,null);let n=E("wallet_extension_details_text_change_dynamically");return $e.default.createElement("div",{className:(0,Rl.default)(Bi.container,{[Bi["container--has-tab"]]:e})},$e.default.createElement(Ue,{title:$e.default.createElement(N.Text,{size:N.SIZE.xs,type:N.TYPE.secondary,className:Bi.textarea},n," ",$e.default.createElement("div",{className:Bi.link,onClick:()=>globalThis.platform.openTab({url:t.dynamicValueTip})},E("wallet_extension_details_textbtn_check_details"))),closable:!1}))},zl=Ud;c();h();var Xe=A(z());c();h();var Nl=A(Rt());function Yd(s,e){let t=(0,Nl.useHistory)();return()=>{t.push(`${vs}/${s.coinId}${Ss}?type=${fl.INSCRIBE}&from=${e}`)}}var Wl=Yd;c();h();var ut={info:"_info_19991_1",title:"_title_19991_11",amount:"_amount_19991_16",btn:"_btn_19991_23"};var $d=({coin:s,addressType:e,lockedAmount:t})=>{let r=ys(pa)[e],o=Wl(s,r),{availableWithoutSpending:n,availableWithoutSpendingDisplay:a}=gl(s,r),l=yi(t,{useContractPrecision:!0,contractPrecision:{decimals:s.decimals},precision:s.displayPrecision,isStableCoin:s.stableCoin}).value;return Xe.default.createElement(Xe.default.Fragment,null,Number(n)>0&&ps(s)&&Xe.default.createElement("div",{className:ut.info},Xe.default.createElement("span",{className:ut.title},E("extension_wallet_btc_to_be_inscribed")),Xe.default.createElement("span",{className:ut.amount},a),Xe.default.createElement(Ai,{category:Ai.CATEGORY.outline,type:Ai.TYPE.primary,size:Ai.SIZE.xxs,onClick:o,contentClassName:ut.btn},E("extension_wallet_btc_btn_inscribe"))),Number(t)>0&&us(s)&&Xe.default.createElement("div",{className:ut.info},Xe.default.createElement("span",{className:ut.title},E("extension_wallet_btc_send_in_use")),Xe.default.createElement("span",{className:ut.amount},l)))},Fl=$d;c();h();var be=A(z());c();h();var ot={container:"_container_it0m8_1",button:"_button_it0m8_4",iconButton:"_iconButton_it0m8_7",dialogWrapper:"_dialogWrapper_it0m8_12",moreWrapper:"_moreWrapper_it0m8_15",text:"_text_it0m8_19",itemIcon:"_itemIcon_it0m8_23",arrow:"_arrow_it0m8_26"};var Xd={2:"56px",3:"48px",4:"32px",5:"24px"},Hl=({buttonList:s,maxDisplayNumber:e=5,ellipsis:t=!0})=>{let[i,r]=(0,be.useState)(!1),o=s,n={comp:j.IconButtonWithLabel,props:{text:E("extension_wallet_list_btn_showmore"),icon:"okx-wallet-plugin-more-2",onClick:()=>r(!0)}},a=[];return s.length>e&&(a=s.slice(e-1),o=s.slice(0,e-1),o.push(n)),be.default.createElement(be.default.Fragment,null,be.default.createElement(Ye.FlexBox,{style:o.length>3?{}:{gap:Xd[o.length]},className:ot.container,justify:o.length>3?"space-between":Ye.ALIGN.start,"data-testid":Nt.COIN_DETAIL_PAGE.BUTTON_LIST},o.map((l,d)=>be.default.createElement(l.comp,{key:l.props.text+d,...l.props,className:ot.button,iconClassName:ot.iconButton,ellipsis:t,space:13}))),be.default.createElement(xs,{footer:null,alignBottom:!0,maskClosable:!0,noContentPadding:!0,hideCloseBtn:!0,windowStyle:{width:"100%"},visible:i,onClose:()=>r(!1)},be.default.createElement(Ye.Box,{className:ot.dialogWrapper},a.map(l=>{let{icon:d,text:u,onClick:_}=l.props;return be.default.createElement(Ye.FlexBox,{align:Ye.ALIGN.center,className:ot.moreWrapper,onClick:_},be.default.createElement(j,{className:`${d} ${ot.itemIcon}`,size:j.SIZE.lg}),be.default.createElement(N.Text,{strong:700,size:N.SIZE.lg,className:ot.text},u),be.default.createElement(j,{className:`okx-wallet-plugin-arrow-small-right ${ot.arrow}`,size:j.SIZE.md}))}))))};c();h();var Yl=A(z());c();h();var ce={[Ti]:{order:"brc20order",list:"brc20list",buy:"brc20buy",split:""},[ki]:{order:"fbrc20order",list:"fbrc20list",buy:"fbrc20buy",split:""},[Pi]:{order:"arc20order",list:"arc20list",buy:"arc20buy",split:""},[_s]:{order:"runesOrder",list:"runesOrder",buy:"runesOrder",split:"runesSplit"},[ms]:{order:"runesOrder",list:"runesOrder",buy:"runesOrder",split:"runesSplit"}};var De=(s,e,t)=>e.reduce((i,r,o)=>{let n=`{${t[o]}}`;return i.replace(n,encodeURIComponent(r))},s),jd=(s,e="",t="")=>{let i=`https://${s}`,r=`https://${s}/toolkit/runes-split`;return{[ce[Ti].order]:De(`${i}/inscription/ordinals/token/{symbol}`,[e],["symbol"]),[ce[Ti].list]:De(`${i}/inscription/ordinals/listing/{symbol}`,[e],["symbol"]),[ce[Ti].buy]:De(`${i}/inscription/ordinals/token/{symbol}`,[e],["symbol"]),[ce[ki].order]:De(`${i}/inscription/fractal-ordinals/token/{symbol}`,[e],["symbol"]),[ce[ki].list]:De(`${i}/inscription/fractal-ordinals/listing/{symbol}`,[e],["symbol"]),[ce[ki].buy]:De(`${i}/inscription/fractal-ordinals/token/{symbol}`,[e],["symbol"]),[ce[Pi].order]:De(`${i}/inscription/atomicals/token/{symbol}`,[e],["symbol"]),[ce[Pi].list]:De(`${i}/inscription/atomicals/listing/{symbol}`,[e],["symbol"]),[ce[Pi].buy]:De(`${i}/inscription/atomicals/token/{symbol}`,[e],["symbol"]),[ce[_s].order]:De(`${i}/runes/token/{symbol}/{name}`,[e,t],["symbol","name"]),[ce[_s].split]:`${r}#tokenName=${t}`,[ce[ms].order]:De(`${i}/runes/token/{symbol}/{name}`,[e,t],["symbol","name"]),[ce[ms].split]:`${r}#tokenName=${t}`}},Ul=(s,e,t)=>i=>{let r=jd(s,e,t)[i];return globalThis.platform.openTab({url:r})};function Zo({coinType:s,symbol:e,name:t}){let i=qa(),r=Ul(i,e,t),o=ce[s];return(0,Yl.useCallback)(()=>{r(o?.buy)},[o,r])}var Gd=({addressLabel:s,coin:e,activeTab:t,address:i,addressType:r,coinBalance:o,bottomSlot:n,containerClassName:a,isDefaultAddress:l,canChangeDefaultAddress:d,openAddressesDialog:u})=>{let _=(0,Es.useHistory)(),f=(0,Es.useLocation)(),{coinId:m,localType:g,symbol:b}=e,[,S]=Ts(m),v=ks(m),x=ml(),y=pl(),T=al(),w=hl(),{coinAmount:k,coinAmountDisplay:P,currencyAmountDisplay:M}=o,{fetch:G}=_l(),{data:F}=dl(G,{cacheKey:ul,staleTime:1e3*60*10}),{swap:re=[],bridge:H=[]}=F?.data||{},{isNotBackupWallet:xe}=cl(),V=re.includes(e?.chainId)&&!Mi(e),ie=H.includes(e?.chainId)&&!Mi(e),Ne=Go(e,r,jo.swap),It=Go(e,r,jo.bridge),{lockedAmount:se,UTXOList:Bt}=bl(i,e),Dt=Ba(e),Et=Ka(e?.localType),Xt=Zo({coinType:e.coinType,name:e.name,symbol:e.symbol}),le=(0,ve.useMemo)(()=>fs(e)||gs(e)||bs(e),[e]),Bo=async Fe=>{if(No(k,0)){Fe.preventDefault(),Fe.stopPropagation();return}let Ci=await x({coinId:m,baseCoinId:e?.baseCoinId}),Eo=await y({coinId:m}),xi=await T({coinId:m});if(!Ci||!Eo||!xi)return;let Lo=f.pathname+f.search,jt={pathname:`${vs}/${m}${Ss}`,state:{fromPage:Lo}};le&&(jt.search=`?from=${Et[r]}`),_.push(jt)},Do=async()=>{if(xe){w();return}if(le){let Fe=Wt({coinId:m,addressType:r});_.push(`${Ho}${Fe}`);return}_.push(`${Ho}?coinId=${m}`)},{handleClick:lt}=Ms(r,m),Ie=me(qt),We=[{comp:j.IconButtonWithLabel,props:{text:E("wallet_home_btn_send"),icon:"okx-wallet-plugin-up",onClick:Fe=>{Ie({button_clicked:"send"}),Bo(Fe)},disabled:No(k,0)}},{comp:j.IconButtonWithLabel,props:{text:E("wallet_home_btn_receive"),icon:"okx-wallet-plugin-down",onClick:()=>{Ie({button_clicked:"receive"}),Do()},disabled:v}}];return V&&We.push({comp:j.IconButtonWithLabel,props:{text:E("wallet_extension_homepage_feature_name_swap"),icon:"okx-wallet-plugin-swap-2",onClick:()=>{Ie({button_clicked:"swap"}),Ne()},disabled:!1}}),ie&&We.push({comp:j.IconButtonWithLabel,props:{text:E("wallet_extension_home_btn_bridge"),icon:"okx-wallet-plugin-bridge",onClick:()=>{Ie({button_clicked:"bridge"}),It()},disabled:!1}}),Dt&&We.push({comp:j.IconButtonWithLabel,props:{text:E("extension_defi_title_text_trade"),icon:"okx-wallet-plugin-trade-1",onClick:()=>{Ie({button_clicked:"marketplace"}),Xt()},disabled:!1}}),Bt?.length>0&&We.push({comp:qo,props:{buttonType:"action",addressType:r,coinId:e?.baseCoinId||e?.coinId,onClick:()=>{Ie({button_clicked:"utxo"}),lt()},icon:"okx-wallet-plugin-funding-rates",text:E("wallet_extension_mid_item_uxto")}}),!m&&!g?null:ve.default.createElement(Dl,{className:(0,$l.default)("coin-detail__overview",a)},ve.default.createElement(rl,{coin:e}),ve.default.createElement(zl,{hasTab:!!t,coinId:e?.coinId}),ve.default.createElement(Is,{justify:Ye.ALIGN.start,coinSymbol:b,amountDisplay:P,currencyDisplay:M}),(ps(e)||us(e))&&ve.default.createElement(Fl,{coin:e,addressType:r,lockedAmount:se}),ve.default.createElement(Hl,{buttonList:We}),ve.default.createElement(Ds,{coin:e}),ve.default.createElement(Bl,{addressLabel:s,address:i,addressType:r,isDefaultAddress:l,coin:e,baseCoin:S,canChangeDefaultAddress:d,openAddressesDialog:u}),n)},Xl=(0,ve.memo)(Gd);c();h();var q=A(z());var Rs=A(st());tt();c();h();var he={"pnl-container":"_pnl-container_ppk9c_1",pnlContainer:"_pnl-container_ppk9c_1","pnl-row":"_pnl-row_ppk9c_5",pnlRow:"_pnl-row_ppk9c_5","pnl-item":"_pnl-item_ppk9c_10",pnlItem:"_pnl-item_ppk9c_10","pnl-label":"_pnl-label_ppk9c_13",pnlLabel:"_pnl-label_ppk9c_13","pnl-value":"_pnl-value_ppk9c_20",pnlValue:"_pnl-value_ppk9c_20",emptyText:"_emptyText_ppk9c_25","pnl-value-text":"_pnl-value-text_ppk9c_28",pnlValueText:"_pnl-value-text_ppk9c_28","pnl-percentage-text":"_pnl-percentage-text_ppk9c_36",pnlPercentageText:"_pnl-percentage-text_ppk9c_36",change:"_change_ppk9c_44",up:"_up_ppk9c_47",down:"_down_ppk9c_50","hidden-text":"_hidden-text_ppk9c_53",hiddenText:"_hidden-text_ppk9c_53","hidden-text-percentage":"_hidden-text-percentage_ppk9c_59",hiddenTextPercentage:"_hidden-text-percentage_ppk9c_59"};c();h();var Os=A(z());tt();var Ls="SUPPORTED_PNL_CHAIN_IDS_STORAGE_KEY",jl=120,qd=async()=>{try{let s=Vt.get(Ls);if(!Array.isArray(s)){let[e,t]=await wi(Tl()),i=t?.data?.supportPnlChains;e||U(i)||!Array.isArray(i)?Vt.set(Ls,!0,jl):Vt.set(Ls,i,jl)}}catch{}},Zd=async({coin:s,address:e,setPnlData:t})=>{let[i,r]=await wi(wl({chainId:s.chainId,walletAddress:e,tokenContractAddress:s.address}));if(i){t(null);return}if(r?.data){let o=r.data;t(o)}else t(null)},Gl=({isPnlSupported:s,coin:e,address:t})=>{let[i,r]=(0,Os.useState)(null);return(0,Os.useEffect)(()=>{(async()=>{await qd();let n;try{n=Vt.get(Ls)}catch{}let a;if(n===!0||U(n)?a=s:a=s&&n?.includes(+e?.chainId),!a||!e?.address||!t||U(e?.chainId)){r(null);return}await Zd({coin:e,address:t,setPnlData:r})})()},[e?.chainId,e?.address,t,s]),i};var Kd="0",Qd="",je=s=>!U(s)&&s!=="",Vs=s=>(0,Rs.default)(he.change,{[he.up]:je(s)&&W.gt(s,0),[he.down]:je(s)&&W.lt(s,0)}),ql=({label:s,value:e,percentage:t,valueClassName:i,percentageClassName:r,hiddenAssets:o})=>{let n=(l,d)=>d?q.default.createElement(q.default.Fragment,null,je(l)?q.default.createElement(N.DisplayAmount,{autoColor:!0,useApproximate:!1,ellipsis:{tooltip:!0},mode:N.PERCENT,signDisplay:!0,size:$o.sm,zeroSign:"",amount:l,className:(0,Rs.default)(he.pnlPercentageText,r)}):q.default.createElement("span",{className:he.emptyText},"--")):q.default.createElement(q.default.Fragment,null,je(l)?q.default.createElement(N.DisplayAmount,{autoColor:!0,useApproximate:!1,ellipsis:{tooltip:!0},mode:N.LEGAL,signDisplay:!0,size:$o.sm,amount:l,className:(0,Rs.default)(he.pnlValueText,i)}):q.default.createElement("span",{className:he.emptyText},"--")),a=(l,d)=>o?q.default.createElement("span",{className:d?he.hiddenTextPercentage:he.hiddenText},"*****"):n(l,d);return q.default.createElement("div",{className:he.pnlItem},q.default.createElement(N.Text,{className:he.pnlLabel},s),q.default.createElement("div",{className:he.pnlValue},a(e,!1),a(t,!0)))},Jd=(0,q.memo)(({coin:s,chain:e,showOverviewPage:t})=>{let[i]=ht(),r=Xa(),o=oe(os),{usdToThisRate:n=1}=o||{},a=r?.account?.[e?.baseChain],l=!t&&s?.baseCoinId!==0,d=Gl({isPnlSupported:l,coin:s,address:a}),u=(0,q.useMemo)(()=>d&&{...d||{},currentProfit:je(d.currentProfit)?W.mul(d.currentProfit,n):d.currentProfit,realizedProfit:je(d.realizedProfit)?W.mul(d.realizedProfit,n):d.realizedProfit},[d,n]),_=Vs(u?.currentProfit),f=Vs(u?.realizedProfit),m=Vs(u?.currentProfitPercentage),g=Vs(u?.realizedProfitPercentage);return!d?.isPnlSupported||[Kd,Qd].includes(d?.boughtVolume)||!je(u?.currentProfit)&&!je(u?.realizedProfit)&&!je(u?.currentProfitPercentage)&&!je(u?.realizedProfitPercentage)?null:q.default.createElement("div",{className:he.pnlContainer},q.default.createElement("div",{className:he.pnlRow},q.default.createElement(ql,{hiddenAssets:i,label:J("wallet_extension_token_detail_title_tpnl"),value:u?.currentProfit,percentage:u?.currentProfitPercentage,valueClassName:_,percentageClassName:m}),q.default.createElement(ql,{hiddenAssets:i,label:J("wallet_extension_token_detail_title_realized_pnl"),value:u?.realizedProfit,percentage:u?.realizedProfitPercentage,valueClassName:f,percentageClassName:g})))}),Zl=Jd;c();h();c();h();var zs={"alert-container":"_alert-container_34jyb_1",alertContainer:"_alert-container_34jyb_1",addWeight:"_addWeight_34jyb_4",activeContainer:"_activeContainer_34jyb_4"};var eu=({coin:s,chain:e,activeTab:t,isDefaultAddress:i,address:r,canChangeDefaultAddress:o,openAddressesDialog:n,containerDOM:a,txDetailData:l,setTxDetailData:d})=>{let u=ct(),_=ye(),{coinId:f}=s,m=_.get("addressType"),g=Pl(f,m,{amountDisplayOptions:{useApproximate:!1}}),b=ks(f),S=(0,de.useMemo)(()=>t?.chainName??s.chainName,[t,s]),v=me(as),x=async()=>{if(b){u(za(!1));return}await u(Kt({coinId:f,addressList:r?[r]:[]},{initLoad:!0,fromCoinDetail:!0}))};return(0,de.useEffect)(()=>{if(!s||!f||!r||typeof r!="string")return;(async()=>{await Promise.all([x()])})()},[f,r]),(0,de.useEffect)(()=>{if(!s?.coinId)return;let y={chainid:s?.chainId,address:s?.address,token_symbol:s?.symbol};m&&(y.address_type=m),v(y)},[s?.coinId]),de.default.createElement("div",{className:"coin-detail__body__normal"},de.default.createElement(Xl,{coin:s,address:r,activeTab:t,addressType:m,coinBalance:g,bottomSlot:de.default.createElement(de.default.Fragment,null,de.default.createElement(nl,{coin:s,address:r,className:zs.alertContainer})),containerClassName:(0,Kl.default)({"coin-detail__overview--no-tab":!t,[zs.addWeight]:t,[zs.activeContainer]:t}),addressLabel:S,isDefaultAddress:i,canChangeDefaultAddress:o,openAddressesDialog:n}),de.default.createElement(Zl,{coin:s,chain:e}),de.default.createElement(Ll,{coinId:f,address:r,container:a,txDetailData:l,setTxDetailData:d}))},Ql=(0,de.memo)(eu);c();h();var Ns=A(z());var Ws=A(Rt());tt();var tu=()=>{let s=ct(),e=ye(),t=(0,Ws.useHistory)(),i=(0,Ws.useLocation)(),r=e.get("coinSymbol"),o=e.get("coinId"),n=e.get("aggregation"),a=e.get("btcAggregation"),l=e.get("nearAggregation"),d=e.get("tonAggregation"),u=oe(Ea),_=oe(va),f=a||l||d;return(0,Ns.useEffect)(()=>{document.oncontextmenu=()=>!1;let m=n&&r||f&&r&&o;if(m){let b=f?`${r}-${o}`:r,S=zo(u);S[_]=S[_]||{},S[_][b]=i.pathname+i.search,s(Fo(S))}let g=t.listen((b,S)=>{if((S==="PUSH"||S==="REPLACE")&&b.pathname===Zt&&m){let v=f?`${r}-${o}`:r,x=zo(u);x[_]=x[_]||{},x[_][v]=b.pathname+b.search,s(Fo(x))}});return()=>{g(),s(wa()),s(Na()),document.oncontextmenu=()=>!0}},[]),null},Jl=(0,Ns.memo)(tu);c();h();var te=A(z());c();h();var _t=A(z());c();h();var Z=A(z()),ec=A(Rt());c();h();var iu=({itemData:s,hiddenAssets:e})=>{let t=(0,Z.useMemo)(()=>s.tag?typeof s.tag=="string"?{title:s.tag,category:Qt.CATEGORY.fill,color:Qt.COLOR.grey}:s.tag:{title:"",category:Qt.CATEGORY.fill,color:Qt.COLOR.grey},[s.tag]);return Z.default.createElement("div",{className:"asset-list-item-info-left"},Z.default.createElement("div",{className:"asset-list-item-info-left-top"},Z.default.createElement("div",{className:"asset-list-item-info-symbol"},s.name),s.tag&&Z.default.createElement(Qt,{className:"asset-list-item-info-chain-info",category:t.category,color:t.color},t.title)),Z.default.createElement("div",{className:"asset-list-item-info-name"},e?Gt:s.rate))},su=({itemData:s,hiddenAssets:e})=>Z.default.createElement("div",{className:"asset-list-item-info-right"},Z.default.createElement("div",{className:"asset-list-item-info-account"},Z.default.createElement(ll,{maxWidth:"120px",text:e?Gt:s.coinAmountDisplay,className:"",style:{}})),Z.default.createElement("div",{className:"asset-list-item-info-amount"},e?Gt:s.currencyAmountNoUnitDisplay)),ru=({listData:s,hiddenAssets:e})=>{let t=(0,ec.useHistory)(),i=ye(),r=Boolean(i.get("aggregation")),o=Boolean(i.get("btcAggregation")),n=Boolean(i.get("nearAggregation")),a=Boolean(i.get("tonAggregation")),l=async u=>{let _={coinSymbol:u.symbol,coinId:u.coinId};r&&(_.aggregation=r),o&&(_.btcAggregation=o,_.addressType=u.addressType),n&&(_.nearAggregation=n,_.addressType=u.addressType),a&&(_.tonAggregation=a,_.addressType=u.addressType);let f=Wt(_);t.push(`${Zt}${f}`)},d=u=>Z.default.createElement(vl,{isNFT:!1,style:{},noBorder:!1,alt:"coin",src:u.image,className:"asset-list-item-icon"});return Z.default.createElement(Z.default.Fragment,null,s&&s.length>0?Z.default.createElement("div",{className:"asset-list"},s.map(u=>Z.default.createElement("div",{className:"asset-list-item",key:u.coinId,onClick:async()=>{await l(u)}},d(u),Z.default.createElement("div",{className:"asset-list-item-info"},Z.default.createElement(iu,{itemData:u,hiddenAssets:e}),Z.default.createElement(su,{itemData:u,hiddenAssets:e})),Z.default.createElement(He,{className:"okx-wallet-plugin-arrow-small-right asset-list-arrow-icon"})))):null)},tc=ru;var ou=({coinList:s,coinAmountAll:e,hiddenAssets:t})=>{let i=(0,_t.useCallback)(()=>!Array.isArray(s)||!s?.length?[]:s.map(n=>{let a="";if(+e==0)a=W.showFloorTruncation("0",2,{needZero:!0,style:"percent"});else{let f=W.div(n.coinAmount,e),m=W.mul(f,100);a=W.showTruncation(m,2,{needZero:!0,style:"percent"})}let l=fs(n)||gs(n)||bs(n),d=l?n.chainSymbol:n.tokenType,u=l?n.tokenType:null,_=n.chainImage||Ia;return{...n,rate:a,name:d,image:_,tag:u}}),[e,s]),[r,o]=(0,_t.useState)([]);return(0,_t.useEffect)(()=>{o(i())},[i]),_t.default.createElement(tc,{listData:r,hiddenAssets:t})},ic=ou;c();h();var $=A(z());c();h();c();h();var sc={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},rc={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},oc={color:"#2196f3",lineStyle:0,lineWidth:3,shadowColor:null,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,lineType:0,lineVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0,pointMarkersVisible:!1},nc={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",invertFilledArea:!1,lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,lineVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0,pointMarkersVisible:!1},ac={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,lineType:0,lineVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0,pointMarkersVisible:!1},lc={color:"#26a69a",base:0},Fs={color:"#2196f3"},Hs={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}};c();h();var Ko;(function(s){s[s.Simple=0]="Simple",s[s.WithSteps=1]="WithSteps",s[s.Curved=2]="Curved"})(Ko||(Ko={}));var Qo;(function(s){s[s.Solid=0]="Solid",s[s.Dotted=1]="Dotted",s[s.Dashed=2]="Dashed",s[s.LargeDashed=3]="LargeDashed",s[s.SparseDotted=4]="SparseDotted"})(Qo||(Qo={}));function Te(s,e){let i={[0]:[],[1]:[s.lineWidth,s.lineWidth],[2]:[2*s.lineWidth,2*s.lineWidth],[3]:[6*s.lineWidth,6*s.lineWidth],[4]:[s.lineWidth,4*s.lineWidth]}[e];s.setLineDash(i)}function Us(s,e,t,i){s.beginPath();let r=s.lineWidth%2?.5:0;s.moveTo(t,e+r),s.lineTo(i,e+r),s.stroke()}function cc(s,e,t,i){s.beginPath();let r=s.lineWidth%2?.5:0;s.moveTo(e+r,t),s.lineTo(e+r,i),s.stroke()}function hc(s,e){s.save(),s.lineWidth%2&&s.translate(.5,.5),e(),s.restore()}c();h();c();h();function ne(s,e){if(!s)throw new Error("Assertion failed"+(e?": "+e:""))}function Y(s){if(s===void 0)throw new Error("Value is undefined");return s}function C(s){if(s===null)throw new Error("Value is null");return s}function nt(s){return C(Y(s))}c();h();var dc={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function ke(s){return s<0?0:s>255?255:Math.round(s)||0}function uc(s){return s<=0||s>1?Math.min(Math.max(s,0),1):Math.round(s*1e4)/1e4}var nu=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,au=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,lu=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,cu=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d*\.?\d+)\s*\)$/;function Ys(s){s=s.toLowerCase(),s in dc&&(s=dc[s]);{let e=cu.exec(s)||lu.exec(s);if(e)return[ke(parseInt(e[1],10)),ke(parseInt(e[2],10)),ke(parseInt(e[3],10)),uc(e.length<5?1:parseFloat(e[4]))]}{let e=au.exec(s);if(e)return[ke(parseInt(e[1],16)),ke(parseInt(e[2],16)),ke(parseInt(e[3],16)),1]}{let e=nu.exec(s);if(e)return[ke(parseInt(e[1],16)*17),ke(parseInt(e[2],16)*17),ke(parseInt(e[3],16)*17),1]}throw new Error(`Cannot parse color: ${s}`)}function hu(s){return .199*s[0]+.687*s[1]+.114*s[2]}function $s(s,e){if(s==="transparent")return s;let t=Ys(s),i=t[3];return`rgba(${t[0]}, ${t[1]}, ${t[2]}, ${e*i})`}function mt(s){let e=Ys(s);return{background:`rgb(${e[0]}, ${e[1]}, ${e[2]})`,foreground:hu(e)>160?"black":"white"}}function _c(s,e,t){let[i,r,o,n]=Ys(s),[a,l,d,u]=Ys(e),_=[ke(i+t*(a-i)),ke(r+t*(l-r)),ke(o+t*(d-o)),uc(n+t*(u-n))];return`rgba(${_[0]}, ${_[1]}, ${_[2]}, ${_[3]})`}c();h();var L=class{constructor(){this._listeners=[]}subscribe(e,t,i){let r={callback:e,linkedObject:t,singleshot:i===!0};this._listeners.push(r)}unsubscribe(e){let t=this._listeners.findIndex(i=>e===i.callback);t>-1&&this._listeners.splice(t,1)}unsubscribeAll(e){this._listeners=this._listeners.filter(t=>t.linkedObject!==e)}fire(e,t,i){let r=[...this._listeners];this._listeners=this._listeners.filter(o=>!o.singleshot),r.forEach(o=>o.callback(e,t,i))}hasListeners(){return this._listeners.length>0}destroy(){this._listeners=[]}};c();h();function B(s,...e){for(let t of e)for(let i in t)t[i]!==void 0&&(typeof t[i]!="object"||s[i]===void 0||Array.isArray(t[i])?s[i]=t[i]:B(s[i],t[i]));return s}function ae(s){return typeof s=="number"&&isFinite(s)}function pt(s){return typeof s=="number"&&s%1===0}function ft(s){return typeof s=="string"}function Di(s){return typeof s=="boolean"}function ue(s){let e=s;if(!e||typeof e!="object")return e;let t;Array.isArray(e)?t=[]:t={};let i,r;for(i in e)e.hasOwnProperty(i)&&(r=e[i],r&&typeof r=="object"?t[i]=ue(r):t[i]=r);return t}function mc(s){return s!==null}function gt(s){return s===null?void 0:s}c();h();c();h();function Ei(){return typeof window>"u"||!window.getComputedStyle||!document.body?"-apple-system, BlinkMacSystemFont, 'Trebuchet MS', Roboto, Ubuntu, sans-serif":window.getComputedStyle(document.body).fontFamily}function Se(s,e,t){return t!==void 0?t=`${t} `:t="",e===void 0&&(e=Ei()),`${t}${s}px ${e}`}var pc;(function(s){s[s.BorderSize=1]="BorderSize",s[s.TickLength=5]="TickLength"})(pc||(pc={}));var Xs=class{constructor(e){this._rendererOptions={borderSize:1,tickLength:5,fontSize:NaN,font:"",fontFamily:"",color:"",paneBackgroundColor:"",paddingBottom:0,paddingInner:0,paddingOuter:0,paddingTop:0,baselineOffset:0},this._chartModel=e}options(){let e=this._rendererOptions,t=this._fontSize(),i=this._fontFamily();return(e.fontSize!==t||e.fontFamily!==i)&&(e.fontSize=t,e.fontFamily=i,e.font=Se(t,i),e.paddingTop=2.5/12*t,e.paddingBottom=e.paddingTop,e.paddingInner=t/12*e.tickLength,e.paddingOuter=t/12*e.tickLength,e.baselineOffset=0),e.color=this._textColor(),e.paneBackgroundColor=this._paneBackgroundColor(),this._rendererOptions}_textColor(){return this._chartModel.options().layout.textColor}_paneBackgroundColor(){return this._chartModel.backgroundTopColor()}_fontSize(){return this._chartModel.options().layout.fontSize}_fontFamily(){return this._chartModel.options().layout.fontFamily}};c();h();c();h();c();h();var bt=class{constructor(){this._renderers=[]}setRenderers(e){this._renderers=e}draw(e,t,i){this._renderers.forEach(r=>{r.draw(e,t,i)})}};c();h();c();h();var X=class{draw(e,t,i){e.useBitmapCoordinateSpace(r=>this._drawImpl(r,t,i))}};var js=class extends X{constructor(){super(...arguments),this._data=null}setData(e){this._data=e}_drawImpl({context:e,horizontalPixelRatio:t,verticalPixelRatio:i}){if(this._data===null||this._data.visibleRange===null)return;let r=this._data.visibleRange,o=this._data,a=Math.max(1,Math.floor(t))%2/2,l=d=>{e.beginPath();for(let u=r.to-1;u>=r.from;--u){let _=o.items[u],f=Math.round(_.x*t)+a,m=_.y*i,g=d*i+a;e.moveTo(f,m),e.arc(f,m,g,0,Math.PI*2)}e.fill()};o.lineWidth>0&&(e.fillStyle=o.backColor,l(o.radius+o.lineWidth)),e.fillStyle=o.lineColor,l(o.radius)}};function du(){return{items:[{x:0,y:0,time:0,price:0}],lineColor:"",backColor:"",radius:0,lineWidth:0,visibleRange:null}}var uu={from:0,to:1},Gs=class{constructor(e,t){this._compositeRenderer=new bt,this._markersRenderers=[],this._markersData=[],this._invalidated=!0,this._chartModel=e,this._crosshair=t,this._compositeRenderer.setRenderers(this._markersRenderers)}update(e){let t=this._chartModel.serieses();t.length!==this._markersRenderers.length&&(this._markersData=t.map(du),this._markersRenderers=this._markersData.map(i=>{let r=new js;return r.setData(i),r}),this._compositeRenderer.setRenderers(this._markersRenderers)),this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._compositeRenderer}_updateImpl(){let e=this._crosshair.options().mode===2,t=this._chartModel.serieses(),i=this._crosshair.appliedIndex(),r=this._chartModel.timeScale();t.forEach((o,n)=>{var a;let l=this._markersData[n],d=o.markerDataAtIndex(i);if(e||d===null||!o.visible()){l.visibleRange=null;return}let u=C(o.firstValue());l.lineColor=d.backgroundColor,l.radius=d.radius,l.lineWidth=d.borderWidth,l.items[0].price=d.price,l.items[0].y=o.priceScale().priceToCoordinate(d.price,u.value),l.backColor=(a=d.borderColor)!==null&&a!==void 0?a:this._chartModel.backgroundColorAtYPercentFromTop(l.items[0].y/o.priceScale().height()),l.items[0].time=i,l.items[0].x=r.indexToCoordinate(i),l.visibleRange=uu})}};c();h();c();h();var qs=class extends X{constructor(e){super(),this._data=e}_drawImpl({context:e,bitmapSize:t,horizontalPixelRatio:i,verticalPixelRatio:r}){if(this._data===null)return;let o=this._data.vertLine.visible,n=this._data.horzLine.visible;if(!o&&!n)return;let a=Math.round(this._data.x*i),l=Math.round(this._data.y*r);e.lineCap="butt",o&&a>=0&&(e.lineWidth=Math.floor(this._data.vertLine.lineWidth*i),e.strokeStyle=this._data.vertLine.color,e.fillStyle=this._data.vertLine.color,Te(e,this._data.vertLine.lineStyle),cc(e,a,0,t.height)),n&&l>=0&&(e.lineWidth=Math.floor(this._data.horzLine.lineWidth*r),e.strokeStyle=this._data.horzLine.color,e.fillStyle=this._data.horzLine.color,Te(e,this._data.horzLine.lineStyle),Us(e,l,0,t.width))}};var Zs=class{constructor(e){this._invalidated=!0,this._rendererData={vertLine:{lineWidth:1,lineStyle:0,color:"",visible:!1},horzLine:{lineWidth:1,lineStyle:0,color:"",visible:!1},x:0,y:0},this._renderer=new qs(this._rendererData),this._source=e}update(){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer}_updateImpl(){let e=this._source.visible(),t=C(this._source.pane()),i=t.model().options().crosshair,r=this._rendererData;if(i.mode===2){r.horzLine.visible=!1,r.vertLine.visible=!1;return}r.horzLine.visible=e&&this._source.horzLineVisible(t),r.vertLine.visible=e&&this._source.vertLineVisible(),r.horzLine.lineWidth=i.horzLine.width,r.horzLine.lineStyle=i.horzLine.style,r.horzLine.color=i.horzLine.color,r.vertLine.lineWidth=i.vertLine.width,r.vertLine.lineStyle=i.vertLine.style,r.vertLine.color=i.vertLine.color,r.x=this._source.appliedX(),r.y=this._source.appliedY()}};c();h();c();h();c();h();c();h();function gc(s,e,t,i,r,o){s.fillRect(e+o,t,i-o*2,o),s.fillRect(e+o,t+r-o,i-o*2,o),s.fillRect(e,t,o,r),s.fillRect(e+i-o,t,o,r)}function vt(s,e,t,i,r,o){s.save(),s.globalCompositeOperation="copy",s.fillStyle=o,s.fillRect(e,t,i,r),s.restore()}function fc(s,e){return s.map(t=>t===0?t:t+e)}function Jo(s,e,t,i,r,o){s.beginPath(),s.lineTo(e+i-o[1],t),o[1]!==0&&s.arcTo(e+i,t,e+i,t+o[1],o[1]),s.lineTo(e+i,t+r-o[2]),o[2]!==0&&s.arcTo(e+i,t+r,e+i-o[2],t+r,o[2]),s.lineTo(e+o[3],t+r),o[3]!==0&&s.arcTo(e,t+r,e,t+r-o[3],o[3]),s.lineTo(e,t+o[0]),o[0]!==0&&s.arcTo(e,t,e+o[0],t,o[0])}function en(s,e,t,i,r,o,n=0,a=[0,0,0,0],l=""){if(s.save(),!n||!l||l===o){Jo(s,e,t,i,r,a),s.fillStyle=o,s.fill(),s.restore();return}let d=n/2;if(o!=="transparent"){let u=fc(a,-n);Jo(s,e+n,t+n,i-n*2,r-n*2,u),s.fillStyle=o,s.fill()}if(l!=="transparent"){let u=fc(a,-d);Jo(s,e+d,t+d,i-n,r-n,u),s.lineWidth=n,s.strokeStyle=l,s.closePath(),s.stroke()}s.restore()}function Ks(s,e,t,i,r,o,n){s.save(),s.globalCompositeOperation="copy";let a=s.createLinearGradient(0,0,0,r);a.addColorStop(0,o),a.addColorStop(1,n),s.fillStyle=a,s.fillRect(e,t,i,r),s.restore()}var Li=class{constructor(e,t){this.setData(e,t)}setData(e,t){this._data=e,this._commonData=t}height(e,t){return this._data.visible?e.fontSize+e.paddingTop+e.paddingBottom:0}draw(e,t,i,r){if(!this._data.visible||this._data.text.length===0)return;let o=this._data.color,n=this._commonData.background,a=e.useBitmapCoordinateSpace(l=>{let d=l.context;d.font=t.font;let u=this._calculateGeometry(l,t,i,r),_=u.bitmap,f=(m,g)=>{u.alignRight?en(d,_.xOutside,_.yTop,_.totalWidth,_.totalHeight,m,_.horzBorder,[_.radius,0,0,_.radius],g):en(d,_.xInside,_.yTop,_.totalWidth,_.totalHeight,m,_.horzBorder,[0,_.radius,_.radius,0],g)};return f(n,"transparent"),this._data.tickVisible&&(d.fillStyle=o,d.fillRect(_.xInside,_.yMid,_.xTick-_.xInside,_.tickHeight)),f("transparent",n),this._data.borderVisible&&(d.fillStyle=t.paneBackgroundColor,d.fillRect(u.alignRight?_.right-_.horzBorder:0,_.yTop,_.horzBorder,_.yBottom-_.yTop)),u});e.useMediaCoordinateSpace(({context:l})=>{let d=a.media;l.font=t.font,l.textAlign=a.alignRight?"right":"left",l.textBaseline="middle",l.fillStyle=o,l.fillText(this._data.text,d.xText,(d.yTop+d.yBottom)/2+d.textMidCorrection)})}_calculateGeometry(e,t,i,r){var o;let{context:n,bitmapSize:a,mediaSize:l,horizontalPixelRatio:d,verticalPixelRatio:u}=e,_=this._data.tickVisible||!this._data.moveTextToInvisibleTick?t.tickLength:0,f=this._data.separatorVisible?t.borderSize:0,m=t.paddingTop+this._commonData.additionalPaddingTop,g=t.paddingBottom+this._commonData.additionalPaddingBottom,b=t.paddingInner,S=t.paddingOuter,v=this._data.text,x=t.fontSize,y=i.yMidCorrection(n,v),T=Math.ceil(i.measureText(n,v)),w=x+m+g,k=t.borderSize+b+S+T+_,P=Math.max(1,Math.floor(u)),M=Math.round(w*u);M%2!==P%2&&(M+=1);let G=f>0?Math.max(1,Math.floor(f*d)):0,F=Math.round(k*d),re=Math.round(_*d),H=(o=this._commonData.fixedCoordinate)!==null&&o!==void 0?o:this._commonData.coordinate,xe=Math.round(H*u)-Math.floor(u*.5),V=Math.floor(xe+P/2-M/2),ie=V+M,Ne=r==="right",It=Ne?l.width-f:f,se=Ne?a.width-G:G,Bt,Dt,Et;return Ne?(Bt=se-F,Dt=se-re,Et=It-_-b-f):(Bt=se+F,Dt=se+re,Et=It+_+b),{alignRight:Ne,bitmap:{yTop:V,yMid:xe,yBottom:ie,totalWidth:F,totalHeight:M,radius:2*d,horzBorder:G,xOutside:Bt,xInside:se,xTick:Dt,tickHeight:P,right:a.width},media:{yTop:V/u,yBottom:ie/u,xText:Et,textMidCorrection:y}}}};var Ge=class{constructor(e){this._commonRendererData={coordinate:0,background:"#000",additionalPaddingBottom:0,additionalPaddingTop:0},this._axisRendererData={text:"",visible:!1,tickVisible:!0,moveTextToInvisibleTick:!1,borderColor:"",color:"#FFF",borderVisible:!1,separatorVisible:!1},this._paneRendererData={text:"",visible:!1,tickVisible:!1,moveTextToInvisibleTick:!0,borderColor:"",color:"#FFF",borderVisible:!0,separatorVisible:!0},this._invalidated=!0,this._axisRenderer=new(e||Li)(this._axisRendererData,this._commonRendererData),this._paneRenderer=new(e||Li)(this._paneRendererData,this._commonRendererData)}text(){return this._updateRendererDataIfNeeded(),this._axisRendererData.text}coordinate(){return this._updateRendererDataIfNeeded(),this._commonRendererData.coordinate}update(){this._invalidated=!0}height(e,t=!1){return Math.max(this._axisRenderer.height(e,t),this._paneRenderer.height(e,t))}getFixedCoordinate(){return this._commonRendererData.fixedCoordinate||0}setFixedCoordinate(e){this._commonRendererData.fixedCoordinate=e}isVisible(){return this._updateRendererDataIfNeeded(),this._axisRendererData.visible||this._paneRendererData.visible}isAxisLabelVisible(){return this._updateRendererDataIfNeeded(),this._axisRendererData.visible}renderer(e){return this._updateRendererDataIfNeeded(),this._axisRendererData.tickVisible=this._axisRendererData.tickVisible&&e.options().ticksVisible,this._paneRendererData.tickVisible=this._paneRendererData.tickVisible&&e.options().ticksVisible,this._axisRenderer.setData(this._axisRendererData,this._commonRendererData),this._paneRenderer.setData(this._paneRendererData,this._commonRendererData),this._axisRenderer}paneRenderer(){return this._updateRendererDataIfNeeded(),this._axisRenderer.setData(this._axisRendererData,this._commonRendererData),this._paneRenderer.setData(this._paneRendererData,this._commonRendererData),this._paneRenderer}_updateRendererDataIfNeeded(){this._invalidated&&(this._axisRendererData.tickVisible=!0,this._paneRendererData.tickVisible=!1,this._updateRendererData(this._axisRendererData,this._paneRendererData,this._commonRendererData))}};var Qs=class extends Ge{constructor(e,t,i){super(),this._source=e,this._priceScale=t,this._valueProvider=i}_updateRendererData(e,t,i){if(e.visible=!1,this._source.options().mode===2)return;let r=this._source.options().horzLine;if(!r.labelVisible)return;let o=this._priceScale.firstValue();if(!this._source.visible()||this._priceScale.isEmpty()||o===null)return;let n=mt(r.labelBackgroundColor);i.background=n.background,e.color=n.foreground;let a=2/12*this._priceScale.fontSize();i.additionalPaddingTop=a,i.additionalPaddingBottom=a;let l=this._valueProvider(this._priceScale);i.coordinate=l.coordinate,e.text=this._priceScale.formatPrice(l.price,o),e.visible=!0}};c();h();c();h();var _u=/[1-9]/g,mu=2,ti=class{constructor(){this._data=null}setData(e){this._data=e}draw(e,t){if(this._data===null||this._data.visible===!1||this._data.text.length===0)return;let i=e.useMediaCoordinateSpace(({context:m})=>(m.font=t.font,Math.round(t.widthCache.measureText(m,C(this._data).text,_u))));if(i<=0)return;let r=t.paddingHorizontal,o=i+2*r,n=o/2,a=this._data.width,l=this._data.coordinate,d=Math.floor(l-n)+.5;d<0?(l=l+Math.abs(0-d),d=Math.floor(l-n)+.5):d+o>a&&(l=l-Math.abs(a-(d+o)),d=Math.floor(l-n)+.5);let u=d+o,_=0,f=Math.ceil(_+t.borderSize+t.tickLength+t.paddingTop+t.fontSize+t.paddingBottom);e.useBitmapCoordinateSpace(({context:m,horizontalPixelRatio:g,verticalPixelRatio:b})=>{let S=C(this._data);m.fillStyle=S.background;let v=Math.round(d*g),x=Math.round(_*b),y=Math.round(u*g),T=Math.round(f*b),w=Math.round(mu*g);if(m.beginPath(),m.moveTo(v,x),m.lineTo(v,T-w),m.arcTo(v,T,v+w,T,w),m.lineTo(y-w,T),m.arcTo(y,T,y,T-w,w),m.lineTo(y,x),m.fill(),S.tickVisible){let k=Math.round(S.coordinate*g),P=x,M=Math.round((P+t.tickLength)*b);m.fillStyle=S.color;let G=Math.max(1,Math.floor(g)),F=Math.floor(g*.5);m.fillRect(k-F,P,G,M-P)}}),e.useMediaCoordinateSpace(({context:m})=>{let g=C(this._data),b=_+t.borderSize+t.tickLength+t.paddingTop+t.fontSize/2;m.font=t.font,m.textAlign="left",m.textBaseline="middle",m.fillStyle=g.color;let S=t.widthCache.yMidCorrection(m,"Apr0");m.translate(d+r,b+S),m.fillText(g.text,0,0)})}};var Js=class{constructor(e,t,i){this._invalidated=!0,this._renderer=new ti,this._rendererData={visible:!1,background:"#4c525e",color:"white",text:"",width:0,coordinate:NaN,tickVisible:!0},this._crosshair=e,this._model=t,this._valueProvider=i}update(){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer.setData(this._rendererData),this._renderer}_updateImpl(){let e=this._rendererData;if(e.visible=!1,this._crosshair.options().mode===2)return;let t=this._crosshair.options().vertLine;if(!t.labelVisible)return;let i=this._model.timeScale();if(i.isEmpty())return;e.width=i.width();let r=this._valueProvider();if(r===null)return;e.coordinate=r.coordinate;let o=i.indexToTimeScalePoint(this._crosshair.appliedIndex());e.text=i.formatDateTime(C(o)),e.visible=!0;let n=mt(t.labelBackgroundColor);e.background=n.background,e.color=n.foreground,e.tickVisible=i.options().ticksVisible}};c();h();var St=class{constructor(){this._priceScale=null,this._zorder=0}zorder(){return this._zorder}setZorder(e){this._zorder=e}priceScale(){return this._priceScale}setPriceScale(e){this._priceScale=e}labelPaneViews(e){return[]}timeAxisViews(){return[]}visible(){return!0}};var tn;(function(s){s[s.Normal=0]="Normal",s[s.Magnet=1]="Magnet",s[s.Hidden=2]="Hidden"})(tn||(tn={}));var er=class extends St{constructor(e,t){super(),this._pane=null,this._price=NaN,this._index=0,this._visible=!0,this._priceAxisViews=new Map,this._subscribed=!1,this._x=NaN,this._y=NaN,this._originX=NaN,this._originY=NaN,this._model=e,this._options=t,this._markersPaneView=new Gs(e,this);let i=(n,a)=>l=>{let d=a(),u=n();if(l===C(this._pane).defaultPriceScale())return{price:u,coordinate:d};{let _=C(l.firstValue());return{price:l.coordinateToPrice(d,_),coordinate:d}}},r=(n,a)=>()=>{let l=this._model.timeScale().indexToTime(n()),d=a();return!l||!Number.isFinite(d)?null:{time:l,coordinate:d}};this._currentPosPriceProvider=i(()=>this._price,()=>this._y);let o=r(()=>this._index,()=>this.appliedX());this._timeAxisView=new Js(this,e,o),this._paneView=new Zs(this)}options(){return this._options}saveOriginCoord(e,t){this._originX=e,this._originY=t}clearOriginCoord(){this._originX=NaN,this._originY=NaN}originCoordX(){return this._originX}originCoordY(){return this._originY}setPosition(e,t,i){this._subscribed||(this._subscribed=!0),this._visible=!0,this._tryToUpdateViews(e,t,i)}appliedIndex(){return this._index}appliedX(){return this._x}appliedY(){return this._y}visible(){return this._visible}clearPosition(){this._visible=!1,this._setIndexToLastSeriesBarIndex(),this._price=NaN,this._x=NaN,this._y=NaN,this._pane=null,this.clearOriginCoord()}paneViews(e){return this._pane!==null?[this._paneView,this._markersPaneView]:[]}horzLineVisible(e){return e===this._pane&&this._options.horzLine.visible}vertLineVisible(){return this._options.vertLine.visible}priceAxisViews(e,t){(!this._visible||this._pane!==e)&&this._priceAxisViews.clear();let i=[];return this._pane===e&&i.push(this._createPriceAxisViewOnDemand(this._priceAxisViews,t,this._currentPosPriceProvider)),i}timeAxisViews(){return this._visible?[this._timeAxisView]:[]}pane(){return this._pane}updateAllViews(){this._paneView.update(),this._priceAxisViews.forEach(e=>e.update()),this._timeAxisView.update(),this._markersPaneView.update()}_priceScaleByPane(e){return e&&!e.defaultPriceScale().isEmpty()?e.defaultPriceScale():null}_tryToUpdateViews(e,t,i){this._tryToUpdateData(e,t,i)&&this.updateAllViews()}_tryToUpdateData(e,t,i){let r=this._x,o=this._y,n=this._price,a=this._index,l=this._pane,d=this._priceScaleByPane(i);this._index=e,this._x=isNaN(e)?NaN:this._model.timeScale().indexToCoordinate(e),this._pane=i;let u=d!==null?d.firstValue():null;return d!==null&&u!==null?(this._price=t,this._y=d.priceToCoordinate(t,u)):(this._price=NaN,this._y=NaN),r!==this._x||o!==this._y||a!==this._index||n!==this._price||l!==this._pane}_setIndexToLastSeriesBarIndex(){let e=this._model.serieses().map(i=>i.bars().lastIndex()).filter(mc),t=e.length===0?null:Math.max(...e);this._index=t!==null?t:NaN}_createPriceAxisViewOnDemand(e,t,i){let r=e.get(t);return r===void 0&&(r=new Qs(this,t,i),e.set(t,r)),r}};c();h();var bc;(function(s){s.Left="left",s.Right="right"})(bc||(bc={}));function Ct(s){return s==="left"||s==="right"}c();h();var vc;(function(s){s[s.None=0]="None",s[s.Cursor=1]="Cursor",s[s.Light=2]="Light",s[s.Full=3]="Full"})(vc||(vc={}));function pu(s,e){if(s===void 0)return e;let t=Math.max(s.level,e.level),i=s.autoScale||e.autoScale;return{level:t,autoScale:i}}var Sc;(function(s){s[s.FitContent=0]="FitContent",s[s.ApplyRange=1]="ApplyRange",s[s.ApplyBarSpacing=2]="ApplyBarSpacing",s[s.ApplyRightOffset=3]="ApplyRightOffset",s[s.Reset=4]="Reset",s[s.Animation=5]="Animation",s[s.StopAnimation=6]="StopAnimation"})(Sc||(Sc={}));var K=class{constructor(e){this._invalidatedPanes=new Map,this._timeScaleInvalidations=[],this._globalLevel=e}invalidatePane(e,t){let i=this._invalidatedPanes.get(e),r=pu(i,t);this._invalidatedPanes.set(e,r)}fullInvalidation(){return this._globalLevel}invalidateForPane(e){let t=this._invalidatedPanes.get(e);return t===void 0?{level:this._globalLevel}:{level:Math.max(this._globalLevel,t.level),autoScale:t.autoScale}}setFitContent(){this.stopTimeScaleAnimation(),this._timeScaleInvalidations=[{type:0}]}applyRange(e){this.stopTimeScaleAnimation(),this._timeScaleInvalidations=[{type:1,value:e}]}setTimeScaleAnimation(e){this._removeTimeScaleAnimation(),this._timeScaleInvalidations.push({type:5,value:e})}stopTimeScaleAnimation(){this._removeTimeScaleAnimation(),this._timeScaleInvalidations.push({type:6})}resetTimeScale(){this.stopTimeScaleAnimation(),this._timeScaleInvalidations=[{type:4}]}setBarSpacing(e){this.stopTimeScaleAnimation(),this._timeScaleInvalidations.push({type:2,value:e})}setRightOffset(e){this.stopTimeScaleAnimation(),this._timeScaleInvalidations.push({type:3,value:e})}timeScaleInvalidations(){return this._timeScaleInvalidations}merge(e){for(let t of e._timeScaleInvalidations)this._applyTimeScaleInvalidation(t);this._globalLevel=Math.max(this._globalLevel,e._globalLevel),e._invalidatedPanes.forEach((t,i)=>{this.invalidatePane(i,t)})}static light(){return new K(2)}static full(){return new K(3)}_applyTimeScaleInvalidation(e){switch(e.type){case 0:this.setFitContent();break;case 1:this.applyRange(e.value);break;case 2:this.setBarSpacing(e.value);break;case 3:this.setRightOffset(e.value);break;case 4:this.resetTimeScale();break;case 5:this.setTimeScaleAnimation(e.value);break;case 6:this._removeTimeScaleAnimation()}}_removeTimeScaleAnimation(){let e=this._timeScaleInvalidations.findIndex(t=>t.type===5);e!==-1&&this._timeScaleInvalidations.splice(e,1)}};c();h();c();h();c();h();c();h();var Cc={decimalSign:".",decimalSignFractional:"'"};function Ee(s,e){if(!ae(s))return"n/a";if(!pt(e))throw new TypeError("invalid length");if(e<0||e>16)throw new TypeError("invalid length");return e===0?s.toString():("0000000000000000"+s.toString()).slice(-e)}var at=class{constructor(e,t){if(t||(t=1),(!ae(e)||!pt(e))&&(e=100),e<0)throw new TypeError("invalid base");this._priceScale=e,this._minMove=t,this._calculateDecimal()}format(e){let t=e<0?"\u2212":"";return e=Math.abs(e),t+this._formatAsDecimal(e)}_calculateDecimal(){if(this._fractionalLength=0,this._priceScale>0&&this._minMove>0){let e=this._priceScale;for(;e>1;)e/=10,this._fractionalLength++}}_formatAsDecimal(e){let t=this._priceScale/this._minMove,i=Math.floor(e),r="",o=this._fractionalLength!==void 0?this._fractionalLength:NaN;if(t>1){let n=+(Math.round(e*t)-i*t).toFixed(this._fractionalLength);n>=t&&(n-=t,i+=1),r=Cc.decimalSign+Ee(+n.toFixed(this._fractionalLength)*this._minMove,o)}else i=Math.round(i*t)/t,o>0&&(r=Cc.decimalSign+Ee(0,o));return i.toFixed(0)+r}};var ii=class extends at{constructor(e=100){super(e)}format(e){return`${super.format(e)}%`}};c();h();var tr=class{constructor(e){this._precision=e}format(e){let t="";return e<0&&(t="-",e=-e),e<995?t+this._formatNumber(e):e<999995?t+this._formatNumber(e/1e3)+"K":e<999999995?(e=1e3*Math.round(e/1e3),t+this._formatNumber(e/1e6)+"M"):(e=1e6*Math.round(e/1e6),t+this._formatNumber(e/1e9)+"B")}_formatNumber(e){let t,i=Math.pow(10,this._precision);return e=Math.round(e*i)/i,e>=1e-15&&e<1?t=e.toFixed(this._precision).replace(/\.?0+$/,""):t=String(e),t.replace(/(\.[1-9]*)0+$/,(r,o)=>o)}};c();h();c();h();c();h();c();h();function ir(s,e,t,i,r,o,n){if(e.length===0||i.from>=e.length||i.to<=0)return;let{context:a,horizontalPixelRatio:l,verticalPixelRatio:d}=s,u=e[i.from],_=o(s,u),f=u;if(i.to-i.from<2){let m=r/2;a.beginPath();let g={x:u.x-m,y:u.y},b={x:u.x+m,y:u.y};a.moveTo(g.x*l,g.y*d),a.lineTo(b.x*l,b.y*d),n(s,_,g,b)}else{let m=(v,x)=>{n(s,_,f,x),a.beginPath(),_=v,f=x},g=f;a.beginPath(),a.moveTo(u.x*l,u.y*d);let b=e[0].x,S=e[0].y;for(let v=i.from+1;v<i.to;++v){g=e[v];let x=o(s,g);switch(t){case 0:a.lineTo(g.x*l,g.y*d);break;case 1:a.lineTo(g.x*l,e[v-1].y*d),x!==_&&(m(x,g),a.lineTo(g.x*l,e[v-1].y*d)),a.lineTo(g.x*l,g.y*d);break;case 2:{let[y,T,w]=fu(e,v,b,S);b=w.x,S=w.y,a.bezierCurveTo(y.x*l,y.y*d,T.x*l,T.y*d,g.x*l,g.y*d);break}}t!==1&&x!==_&&(m(x,g),a.moveTo(g.x*l,g.y*d))}(f!==g||f===g&&t===1)&&n(s,_,f,g)}}function fu(s,e,t,i){let r=t,o=i,n,a,l=s[e].x,d=s[e].y,u=.5,_=0,f=0,m=l,g=d;if(e===s.length-1)n=l,a=d;else{let b=s[e-1].x,S=s[e-1].y,v=s[e+1].x,x=s[e+1].y;_=v-b,f=x-S;let y=l-b,T=v-l,w=d-S,k=x-d,P=Math.sqrt(y*y+w*w),M=Math.sqrt(T*T+k*k);u=M/(M+P),n=l-_*.5*(1-u),a=d-f*.5*(1-u),m=l+_*.5*u,g=d+f*.5*u,m=Math.min(m,Math.max(v,l)),g=Math.min(g,Math.max(x,d)),m=Math.max(m,Math.min(v,l)),g=Math.max(g,Math.min(x,d)),_=m-l,f=g-d,n=l-_*P/M,a=d-f*P/M,n=Math.min(n,Math.max(b,l)),a=Math.min(a,Math.max(S,d)),n=Math.max(n,Math.min(b,l)),a=Math.max(a,Math.min(S,d)),_=l-n,f=d-a,m=l+_*M/P,g=d+f*M/P}return[{x:r,y:o},{x:n,y:a},{x:m,y:g}]}function gu(s,e,t,i,r){let{context:o,horizontalPixelRatio:n,verticalPixelRatio:a}=e;o.lineTo(r.x*n,s*a),o.lineTo(i.x*n,s*a),o.closePath(),o.fillStyle=t,o.fill()}var si=class extends X{constructor(){super(...arguments),this._data=null}setData(e){this._data=e}_drawImpl(e){var t;if(this._data===null)return;let{items:i,visibleRange:r,barWidth:o,lineWidth:n,lineStyle:a,lineType:l}=this._data,d=(t=this._data.baseLevelCoordinate)!==null&&t!==void 0?t:this._data.invertFilledArea?0:e.mediaSize.height;if(r===null)return;let u=e.context;u.lineCap="butt",u.lineJoin="round",u.lineWidth=n,Te(u,a),u.lineWidth=1,ir(e,i,l,r,o,this._fillStyle.bind(this),gu.bind(null,d))}};c();h();c();h();function Oi(s,e,t){return Math.min(Math.max(s,e),t)}function xc(s){if(s<0)return!1;for(let e=s;e>1;e/=10)if(e%10!==0)return!1;return!0}function Vi(s,e,t){return e-s<=t}function wc(s,e,t){return Math.abs(s-e)<t}function yc(s){if(s.length<1)throw Error("array is empty");let e=s[0];for(let t=1;t<s.length;++t)s[t]<e&&(e=s[t]);return e}function Tc(s){let e=Math.ceil(s);return e%2!==0?e-1:e}function sr(s){let e=Math.ceil(s);return e%2===0?e-1:e}var xt=class{get(e,t){let i=this._params,{topColor1:r,topColor2:o,bottomColor1:n,bottomColor2:a,bottom:l,baseLevelCoordinate:d}=t;if(this._cachedValue===void 0||i===void 0||i.topColor1!==r||i.topColor2!==o||i.bottomColor1!==n||i.bottomColor2!==a||i.baseLevelCoordinate!==d||i.bottom!==l){let u=e.context.createLinearGradient(0,0,0,l);if(u.addColorStop(0,r),d!=null){let _=Oi(d*e.verticalPixelRatio/l,0,1);u.addColorStop(_,o),u.addColorStop(_,n)}u.addColorStop(1,a),this._cachedValue=u,this._params=t}return this._cachedValue}};var rr=class extends si{constructor(){super(...arguments),this._fillCache=new xt}_fillStyle(e,t){return this._fillCache.get(e,{topColor1:t.topColor,topColor2:"",bottomColor1:"",bottomColor2:t.bottomColor,bottom:e.bitmapSize.height})}};c();h();c();h();c();h();function kc(s,e,t,i,r){let{horizontalPixelRatio:o,verticalPixelRatio:n,context:a}=s,l=null,u=Math.max(1,Math.floor(o))%2/2,_=t*n+u;for(let f=i.to-1;f>=i.from;--f){let m=e[f];if(m){let g=r(s,m);g!==l&&(a.beginPath(),l!==null&&a.fill(),a.fillStyle=g,l=g);let b=Math.round(m.x*o)+u,S=m.y*n;a.moveTo(b,S),a.arc(b,S,_,0,Math.PI*2)}}a.fill()}function bu(s,e){let t=s.context;t.strokeStyle=e,t.stroke()}var ri=class extends X{constructor(){super(...arguments),this._data=null,this._clipProgress=1}setData(e){this._data=e}setClipProgress(e){this._clipProgress=Math.max(0,Math.min(1,e))}_drawImpl(e){if(this._data===null)return;let{items:t,visibleRange:i,barWidth:r,lineType:o,lineWidth:n,lineStyle:a,pointMarkersRadius:l,shadowColor:d,shadowBlur:u,shadowOffsetX:_,shadowOffsetY:f}=this._data;if(i===null)return;let m=e.context;if(this._clipProgress<1){m.save(),m.beginPath();let b=0,S=0,v=m.canvas.width*this._clipProgress,x=m.canvas.height;m.rect(b,S,v,x),m.clip()}m.lineCap="butt",m.lineWidth=n*e.verticalPixelRatio,Te(m,a),d&&(m.shadowColor=d,m.shadowBlur=u,m.shadowOffsetX=_,m.shadowOffsetY=f),m.lineJoin="round";let g=this._strokeStyle.bind(this);o!==void 0&&ir(e,t,o,i,r,g,bu),l&&kc(e,t,l,i,g),this._clipProgress<1&&m.restore()}};var oi=class extends ri{_strokeStyle(e,t){return t.lineColor}};c();h();c();h();c();h();c();h();function Pc(s,e,t,i,r=0,o=e.length){let n=o-r;for(;0<n;){let a=n>>1,l=r+a;i(e[l],t)===s?(r=l+1,n-=a+1):n=a}return r}var qe=Pc.bind(null,!0),or=Pc.bind(null,!1);function vu(s,e){return s.time<e}function Su(s,e){return e<s.time}function nr(s,e,t){let i=e.left(),r=e.right(),o=qe(s,i,vu),n=or(s,r,Su);if(!t)return{from:o,to:n};let a=o,l=n;return o>0&&o<s.length&&s[o].time>=i&&(a=o-1),n>0&&n<s.length&&s[n-1].time<=r&&(l=n+1),{from:a,to:l}}var wt=class{constructor(e,t,i){this._invalidated=!0,this._dataInvalidated=!0,this._optionsInvalidated=!0,this._items=[],this._itemsVisibleRange=null,this._series=e,this._model=t,this._extendedVisibleRange=i}update(e){this._invalidated=!0,e==="data"&&(this._dataInvalidated=!0),e==="options"&&(this._optionsInvalidated=!0)}renderer(){return this._series.visible()?(this._makeValid(),this._itemsVisibleRange===null?null:this._renderer):null}_updateOptions(){this._items=this._items.map(e=>Object.assign(Object.assign({},e),this._series.barColorer().barStyle(e.time)))}_clearVisibleRange(){this._itemsVisibleRange=null}_makeValid(){this._dataInvalidated&&(this._fillRawPoints(),this._dataInvalidated=!1),this._optionsInvalidated&&(this._updateOptions(),this._optionsInvalidated=!1),this._invalidated&&(this._makeValidImpl(),this._invalidated=!1)}_makeValidImpl(){let e=this._series.priceScale(),t=this._model.timeScale();if(this._clearVisibleRange(),t.isEmpty()||e.isEmpty())return;let i=t.visibleStrictRange();if(i===null||this._series.bars().size()===0)return;let r=this._series.firstValue();r!==null&&(this._itemsVisibleRange=nr(this._items,i,this._extendedVisibleRange),this._convertToCoordinates(e,t,r.value),this._prepareRendererData())}};var Ze=class extends wt{constructor(e,t){super(e,t,!0)}_convertToCoordinates(e,t,i){t.indexesToCoordinates(this._items,gt(this._itemsVisibleRange)),e.pointsArrayToCoordinates(this._items,i,gt(this._itemsVisibleRange))}_createRawItemBase(e,t){return{time:e,price:t,x:NaN,y:NaN}}_fillRawPoints(){let e=this._series.barColorer();this._items=this._series.bars().rows().map(t=>{let i=t.value[3];return this._createRawItem(t.index,i,e)})}};var ar=class extends Ze{constructor(e,t){super(e,t),this._renderer=new bt,this._areaRenderer=new rr,this._lineRenderer=new oi,this._renderer.setRenderers([this._areaRenderer,this._lineRenderer])}_createRawItem(e,t,i){return Object.assign(Object.assign({},this._createRawItemBase(e,t)),i.barStyle(e))}_prepareRendererData(){let e=this._series.options();this._areaRenderer.setData({lineType:e.lineType,items:this._items,lineStyle:e.lineStyle,lineWidth:e.lineWidth,baseLevelCoordinate:null,invertFilledArea:e.invertFilledArea,visibleRange:this._itemsVisibleRange,barWidth:this._model.timeScale().barSpacing()}),this._lineRenderer.setData({lineType:e.lineVisible?e.lineType:void 0,items:this._items,lineStyle:e.lineStyle,lineWidth:e.lineWidth,shadowColor:null,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,visibleRange:this._itemsVisibleRange,barWidth:this._model.timeScale().barSpacing(),pointMarkersRadius:e.pointMarkersVisible?e.pointMarkersRadius||e.lineWidth/2+2:void 0})}};c();h();c();h();c();h();function Mc(s,e){return Math.floor(s*.3*e)}function Ac(s,e){if(s>=2.5&&s<=4)return Math.floor(3*e);let n=1-.2*Math.atan(Math.max(4,s)-4)/(Math.PI*.5),a=Math.floor(s*n*e),l=Math.floor(s*e),d=Math.min(a,l);return Math.max(Math.floor(e),d)}var lr=class extends X{constructor(){super(...arguments),this._data=null,this._barWidth=0,this._barLineWidth=0}setData(e){this._data=e}_drawImpl({context:e,horizontalPixelRatio:t,verticalPixelRatio:i}){if(this._data===null||this._data.bars.length===0||this._data.visibleRange===null)return;this._barWidth=this._calcBarWidth(t),this._barWidth>=2&&Math.max(1,Math.floor(t))%2!==this._barWidth%2&&this._barWidth--,this._barLineWidth=this._data.thinBars?Math.min(this._barWidth,Math.floor(t)):this._barWidth;let r=null,o=this._barLineWidth<=this._barWidth&&this._data.barSpacing>=Math.floor(1.5*t);for(let n=this._data.visibleRange.from;n<this._data.visibleRange.to;++n){let a=this._data.bars[n];r!==a.barColor&&(e.fillStyle=a.barColor,r=a.barColor);let l=Math.floor(this._barLineWidth*.5),d=Math.round(a.x*t),u=d-l,_=this._barLineWidth,f=u+_-1,m=Math.min(a.highY,a.lowY),g=Math.max(a.highY,a.lowY),b=Math.round(m*i)-l,S=Math.round(g*i)+l,v=Math.max(S-b,this._barLineWidth);e.fillRect(u,b,_,v);let x=Math.ceil(this._barWidth*1.5);if(o){if(this._data.openVisible){let k=d-x,P=Math.max(b,Math.round(a.openY*i)-l),M=P+_-1;M>b+v-1&&(M=b+v-1,P=M-_+1),e.fillRect(k,P,u-k,M-P+1)}let y=d+x,T=Math.max(b,Math.round(a.closeY*i)-l),w=T+_-1;w>b+v-1&&(w=b+v-1,T=w-_+1),e.fillRect(f+1,T,y-f,w-T+1)}}}_calcBarWidth(e){let t=Math.floor(e);return Math.max(t,Math.floor(Mc(C(this._data).barSpacing,e)))}};c();h();var ni=class extends wt{constructor(e,t){super(e,t,!1)}_convertToCoordinates(e,t,i){t.indexesToCoordinates(this._items,gt(this._itemsVisibleRange)),e.barPricesToCoordinates(this._items,i,gt(this._itemsVisibleRange))}_createDefaultItem(e,t,i){return{time:e,open:t.value[0],high:t.value[1],low:t.value[2],close:t.value[3],x:NaN,openY:NaN,highY:NaN,lowY:NaN,closeY:NaN}}_fillRawPoints(){let e=this._series.barColorer();this._items=this._series.bars().rows().map(t=>this._createRawItem(t.index,t,e))}};var cr=class extends ni{constructor(){super(...arguments),this._renderer=new lr}_createRawItem(e,t,i){return Object.assign(Object.assign({},this._createDefaultItem(e,t,i)),i.barStyle(e))}_prepareRendererData(){let e=this._series.options();this._renderer.setData({bars:this._items,barSpacing:this._model.timeScale().barSpacing(),openVisible:e.openVisible,thinBars:e.thinBars,visibleRange:this._itemsVisibleRange})}};c();h();c();h();var hr=class extends si{constructor(){super(...arguments),this._fillCache=new xt}_fillStyle(e,t){let i=this._data;return this._fillCache.get(e,{topColor1:t.topFillColor1,topColor2:t.topFillColor2,bottomColor1:t.bottomFillColor1,bottomColor2:t.bottomFillColor2,bottom:e.bitmapSize.height,baseLevelCoordinate:i.baseLevelCoordinate})}};c();h();var dr=class extends ri{constructor(){super(...arguments),this._strokeCache=new xt}_strokeStyle(e,t){let i=this._data;return this._strokeCache.get(e,{topColor1:t.topLineColor,topColor2:t.topLineColor,bottomColor1:t.bottomLineColor,bottomColor2:t.bottomLineColor,bottom:e.bitmapSize.height,baseLevelCoordinate:i.baseLevelCoordinate})}};var ur=class extends Ze{constructor(e,t){super(e,t),this._renderer=new bt,this._baselineAreaRenderer=new hr,this._baselineLineRenderer=new dr,this._renderer.setRenderers([this._baselineAreaRenderer,this._baselineLineRenderer])}_createRawItem(e,t,i){return Object.assign(Object.assign({},this._createRawItemBase(e,t)),i.barStyle(e))}_prepareRendererData(){let e=this._series.firstValue();if(e===null)return;let t=this._series.options(),i=this._series.priceScale().priceToCoordinate(t.baseValue.price,e.value),r=this._model.timeScale().barSpacing();this._baselineAreaRenderer.setData({items:this._items,lineWidth:t.lineWidth,lineStyle:t.lineStyle,lineType:t.lineType,baseLevelCoordinate:i,invertFilledArea:!1,visibleRange:this._itemsVisibleRange,barWidth:r}),this._baselineLineRenderer.setData({items:this._items,lineWidth:t.lineWidth,lineStyle:t.lineStyle,shadowColor:null,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,lineType:t.lineVisible?t.lineType:void 0,pointMarkersRadius:t.pointMarkersVisible?t.pointMarkersRadius||t.lineWidth/2+2:void 0,baseLevelCoordinate:i,visibleRange:this._itemsVisibleRange,barWidth:r})}};c();h();c();h();var Ic;(function(s){s[s.BarBorderWidth=1]="BarBorderWidth"})(Ic||(Ic={}));var _r=class extends X{constructor(){super(...arguments),this._data=null,this._barWidth=0}setData(e){this._data=e}_drawImpl(e){if(this._data===null||this._data.bars.length===0||this._data.visibleRange===null)return;let{horizontalPixelRatio:t}=e;this._barWidth=Ac(this._data.barSpacing,t),this._barWidth>=2&&Math.floor(t)%2!==this._barWidth%2&&this._barWidth--;let i=this._data.bars;this._data.wickVisible&&this._drawWicks(e,i,this._data.visibleRange),this._data.borderVisible&&this._drawBorder(e,i,this._data.visibleRange);let r=this._calculateBorderWidth(t);(!this._data.borderVisible||this._barWidth>r*2)&&this._drawCandles(e,i,this._data.visibleRange)}_drawWicks(e,t,i){if(this._data===null)return;let{context:r,horizontalPixelRatio:o,verticalPixelRatio:n}=e,a="",l=Math.min(Math.floor(o),Math.floor(this._data.barSpacing*o));l=Math.max(Math.floor(o),Math.min(l,this._barWidth));let d=Math.floor(l*.5),u=null;for(let _=i.from;_<i.to;_++){let f=t[_];f.barWickColor!==a&&(r.fillStyle=f.barWickColor,a=f.barWickColor);let m=Math.round(Math.min(f.openY,f.closeY)*n),g=Math.round(Math.max(f.openY,f.closeY)*n),b=Math.round(f.highY*n),S=Math.round(f.lowY*n),x=Math.round(o*f.x)-d,y=x+l-1;u!==null&&(x=Math.max(u+1,x),x=Math.min(x,y));let T=y-x+1;r.fillRect(x,b,T,m-b),r.fillRect(x,g+1,T,S-g),u=y}}_calculateBorderWidth(e){let t=Math.floor(1*e);this._barWidth<=2*t&&(t=Math.floor((this._barWidth-1)*.5));let i=Math.max(Math.floor(e),t);return this._barWidth<=i*2?Math.max(Math.floor(e),Math.floor(1*e)):i}_drawBorder(e,t,i){if(this._data===null)return;let{context:r,horizontalPixelRatio:o,verticalPixelRatio:n}=e,a="",l=this._calculateBorderWidth(o),d=null;for(let u=i.from;u<i.to;u++){let _=t[u];_.barBorderColor!==a&&(r.fillStyle=_.barBorderColor,a=_.barBorderColor);let f=Math.round(_.x*o)-Math.floor(this._barWidth*.5),m=f+this._barWidth-1,g=Math.round(Math.min(_.openY,_.closeY)*n),b=Math.round(Math.max(_.openY,_.closeY)*n);if(d!==null&&(f=Math.max(d+1,f),f=Math.min(f,m)),this._data.barSpacing*o>2*l)gc(r,f,g,m-f+1,b-g+1,l);else{let S=m-f+1;r.fillRect(f,g,S,b-g+1)}d=m}}_drawCandles(e,t,i){if(this._data===null)return;let{context:r,horizontalPixelRatio:o,verticalPixelRatio:n}=e,a="",l=this._calculateBorderWidth(o);for(let d=i.from;d<i.to;d++){let u=t[d],_=Math.round(Math.min(u.openY,u.closeY)*n),f=Math.round(Math.max(u.openY,u.closeY)*n),m=Math.round(u.x*o)-Math.floor(this._barWidth*.5),g=m+this._barWidth-1;if(u.barColor!==a){let b=u.barColor;r.fillStyle=b,a=b}this._data.borderVisible&&(m+=l,_+=l,g-=l,f-=l),!(_>f)&&r.fillRect(m,_,g-m+1,f-_+1)}}};var mr=class extends ni{constructor(){super(...arguments),this._renderer=new _r}_createRawItem(e,t,i){return Object.assign(Object.assign({},this._createDefaultItem(e,t,i)),i.barStyle(e))}_prepareRendererData(){let e=this._series.options();this._renderer.setData({bars:this._items,barSpacing:this._model.timeScale().barSpacing(),wickVisible:e.wickVisible,borderVisible:e.borderVisible,visibleRange:this._itemsVisibleRange})}};c();h();var sn=class{constructor(e,t){this._sourceRenderer=e,this._priceScale=t}draw(e,t,i){this._sourceRenderer.draw(e,this._priceScale,t,i)}},ai=class extends wt{constructor(e,t,i){super(e,t,!1),this._paneView=i,this._renderer=new sn(this._paneView.renderer(),r=>{let o=e.firstValue();return o===null?null:e.priceScale().priceToCoordinate(r,o.value)})}priceValueBuilder(e){return this._paneView.priceValueBuilder(e)}isWhitespace(e){return this._paneView.isWhitespace(e)}_fillRawPoints(){let e=this._series.barColorer();this._items=this._series.bars().rows().map(t=>Object.assign(Object.assign({time:t.index,x:NaN},e.barStyle(t.index)),{originalData:t.data}))}_convertToCoordinates(e,t){t.indexesToCoordinates(this._items,gt(this._itemsVisibleRange))}_prepareRendererData(){this._paneView.update({bars:this._items.map(Cu),barSpacing:this._model.timeScale().barSpacing(),visibleRange:this._itemsVisibleRange},this._series.options())}};function Cu(s){return{x:s.x,time:s.time,originalData:s.originalData,barColor:s.barColor}}c();h();c();h();var xu=1,wu=4,pr=class extends X{constructor(){super(...arguments),this._data=null,this._precalculatedCache=[],this._clipProgress=1}setData(e){this._data=e,this._precalculatedCache=[]}setClipProgress(e){this._clipProgress=Math.max(0,Math.min(1,e))}_drawImpl({context:e,horizontalPixelRatio:t,verticalPixelRatio:i}){if(this._data===null||this._data.items.length===0||this._data.visibleRange===null)return;if(this._precalculatedCache.length||this._fillPrecalculatedCache(t),this._clipProgress<1){e.save(),e.beginPath();let l=0,d=0,u=e.canvas.width*this._clipProgress,_=e.canvas.height;e.rect(l,d,u,_),e.clip()}let r=Math.max(1,Math.floor(i)),n=Math.round(this._data.histogramBase*i)-Math.floor(r/2),a=n+r;for(let l=this._data.visibleRange.from;l<this._data.visibleRange.to;l++){let d=this._data.items[l],u=this._precalculatedCache[l-this._data.visibleRange.from],_=Math.round(d.y*i),f,m;if(_<=n?(f=_,m=a):(f=n,m=_-Math.floor(r/2)+r),this._data.barGlobalGradient){let{from:g,to:b,height:S}=this._data.barGlobalGradient,v=S??Math.abs(_-this._data.histogramBase),x=0,y=v*i,T=e.createLinearGradient(0,x,0,y);T.addColorStop(0,g),T.addColorStop(1,b),e.fillStyle=T}else e.fillStyle=d.barColor;e.fillRect(u.left,f,u.right-u.left+1,m-f),d.barBorderColor&&(e.strokeStyle=d.barBorderColor,e.lineWidth=1,e.strokeRect(u.left,f,u.right-u.left+1,m-f))}this._clipProgress<1&&e.restore()}_fillPrecalculatedCache(e){if(this._data===null||this._data.items.length===0||this._data.visibleRange===null){this._precalculatedCache=[];return}let t=this._data.gap!==void 0?this._data.gap*e:void 0,i=t!==void 0?Math.max(0,Math.floor(t)):Math.ceil(this._data.barSpacing*e)<=xu?0:Math.max(1,Math.floor(e)),r=(this._data.fixedWidth||0)*e||Math.round(this._data.barSpacing*e)-i;this._precalculatedCache=new Array(this._data.visibleRange.to-this._data.visibleRange.from);for(let n=this._data.visibleRange.from;n<this._data.visibleRange.to;n++){let a=this._data.items[n],l=Math.round(a.x*e),d,u;if(r%2){let _=(r-1)/2;d=l-_,u=l+_}else{let _=r/2;d=l-_,u=l+_-1}this._precalculatedCache[n-this._data.visibleRange.from]={left:d,right:u,roundedCenter:l,center:a.x*e,time:a.time}}for(let n=this._data.visibleRange.from+1;n<this._data.visibleRange.to;n++){let a=this._precalculatedCache[n-this._data.visibleRange.from],l=this._precalculatedCache[n-this._data.visibleRange.from-1];a.time===l.time+1&&!this._data.fixedWidth&&a.left-l.right!==i+1&&t===void 0&&(l.roundedCenter>l.center?l.right=a.left-i-1:a.left=l.right+i+1)}let o=Math.ceil(this._data.barSpacing*e);for(let n=this._data.visibleRange.from;n<this._data.visibleRange.to;n++){let a=this._precalculatedCache[n-this._data.visibleRange.from];a.right<a.left&&(a.right=a.left);let l=a.right-a.left+1;o=Math.min(l,o)}if(i>0&&o<wu)for(let n=this._data.visibleRange.from;n<this._data.visibleRange.to;n++){let a=this._precalculatedCache[n-this._data.visibleRange.from];a.right-a.left+1>o&&(a.roundedCenter>a.center?a.right-=1:a.left+=1)}}};var fr=class extends Ze{constructor(){super(...arguments),this._renderer=new pr,this._animationProgress=0,this._animationStart=null,this._animationDuration=1e3,this._animationStarted=!1}_createRawItem(e,t,i){return Object.assign(Object.assign({},this._createRawItemBase(e,t)),i.barStyle(e))}_prepareRendererData(){var e,t,i,r;let o=this._series.options(),n={items:this._items,barSpacing:this._model.timeScale().barSpacing(),visibleRange:this._itemsVisibleRange,histogramBase:this._series.priceScale().priceToCoordinate(this._series.options().base,C(this._series.firstValue()).value),fixedWidth:this._series.options().fixedWidth,gap:this._series.options().gap,barGlobalGradient:this._series.options().barGlobalGradient};this._renderer.setData(n);let a=(t=(e=o.animation)===null||e===void 0?void 0:e.enabled)!==null&&t!==void 0?t:!1,l=(r=(i=o.animation)===null||i===void 0?void 0:i.duration)!==null&&r!==void 0?r:1e3;this._animationDuration=l,a&&!this._animationStarted&&this._items&&this._items.length>1&&(this._animationStarted=!0,this._animationProgress=0,this._animationStart=null,this._startAnimation()),a?this._renderer.setClipProgress(this._animationProgress):(this._animationStarted=!1,this._animationProgress=1,this._renderer.setClipProgress(1))}_startAnimation(){let e=t=>{this._animationStart===null&&(this._animationStart=t);let i=t-this._animationStart,r=Math.min(i/this._animationDuration,1);this._animationProgress=r,this._renderer.setClipProgress(this._animationProgress),this._model.fullUpdate(),r<1&&requestAnimationFrame(e)};requestAnimationFrame(e)}};c();h();var gr=class extends Ze{constructor(){super(...arguments),this._renderer=new oi,this._lineAnimationProgress=0,this._lineAnimationStart=null,this._animationDuration=1e3,this._lineAnimationStarted=!1}_createRawItem(e,t,i){return Object.assign(Object.assign({},this._createRawItemBase(e,t)),i.barStyle(e))}_prepareRendererData(){var e,t,i,r;let o=this._series.options(),n={items:this._items,lineStyle:o.lineStyle,shadowColor:o.shadowColor,shadowBlur:o.shadowBlur,shadowOffsetX:o.shadowOffsetX,shadowOffsetY:o.shadowOffsetY,lineType:o.lineVisible?o.lineType:void 0,lineWidth:o.lineWidth,pointMarkersRadius:o.pointMarkersVisible?o.pointMarkersRadius||o.lineWidth/2+2:void 0,visibleRange:this._itemsVisibleRange,barWidth:this._model.timeScale().barSpacing()};this._renderer.setData(n);let a=(t=(e=o.animation)===null||e===void 0?void 0:e.enabled)!==null&&t!==void 0?t:!1,l=(r=(i=o.animation)===null||i===void 0?void 0:i.duration)!==null&&r!==void 0?r:1e3;this._animationDuration=l,a&&!this._lineAnimationStarted&&this._items&&this._items.length>1&&(this._lineAnimationStarted=!0,this._lineAnimationProgress=0,this._lineAnimationStart=null,this._startLineAnimation()),a?this._renderer.setClipProgress(this._lineAnimationProgress):(this._lineAnimationStarted=!1,this._lineAnimationProgress=1,this._renderer.setClipProgress(1))}_startLineAnimation(){let e=t=>{this._lineAnimationStart===null&&(this._lineAnimationStart=t);let i=t-this._lineAnimationStart,r=Math.min(i/this._animationDuration,1);this._lineAnimationProgress=r,this._renderer.setClipProgress(this._lineAnimationProgress),this._model.fullUpdate(),r<1&&requestAnimationFrame(e)};requestAnimationFrame(e)}};c();h();c();h();var yu=/[2-9]/g,Le=class{constructor(e=50){this._actualSize=0,this._usageTick=1,this._oldestTick=1,this._tick2Labels={},this._cache=new Map,this._maxSize=e}reset(){this._actualSize=0,this._cache.clear(),this._usageTick=1,this._oldestTick=1,this._tick2Labels={}}measureText(e,t,i){return this._getMetrics(e,t,i).width}yMidCorrection(e,t,i){let r=this._getMetrics(e,t,i);return((r.actualBoundingBoxAscent||0)-(r.actualBoundingBoxDescent||0))/2}_getMetrics(e,t,i){let r=i||yu,o=String(t).replace(r,"0");if(this._cache.has(o))return Y(this._cache.get(o)).metrics;if(this._actualSize===this._maxSize){let a=this._tick2Labels[this._oldestTick];delete this._tick2Labels[this._oldestTick],this._cache.delete(a),this._oldestTick++,this._actualSize--}e.save(),e.textBaseline="middle";let n=e.measureText(o);return e.restore(),n.width===0&&!!t.length||(this._cache.set(o,{metrics:n,tick:this._usageTick}),this._tick2Labels[this._usageTick]=o,this._actualSize++,this._usageTick++),n}};var rn=class{constructor(e){this._priceAxisViewRenderer=null,this._rendererOptions=null,this._align="right",this._textWidthCache=e}setParams(e,t,i){this._priceAxisViewRenderer=e,this._rendererOptions=t,this._align=i}draw(e){this._rendererOptions===null||this._priceAxisViewRenderer===null||this._priceAxisViewRenderer.draw(e,this._rendererOptions,this._textWidthCache,this._align)}},li=class{constructor(e,t,i){this._priceAxisView=e,this._textWidthCache=new Le(50),this._dataSource=t,this._chartModel=i,this._fontSize=-1,this._renderer=new rn(this._textWidthCache)}renderer(){let e=this._chartModel.paneForSource(this._dataSource);if(e===null)return null;let t=e.isOverlay(this._dataSource)?e.defaultVisiblePriceScale():this._dataSource.priceScale();if(t===null)return null;let i=e.priceScalePosition(t);if(i==="overlay")return null;let r=this._chartModel.priceAxisRendererOptions();return r.fontSize!==this._fontSize&&(this._fontSize=r.fontSize,this._textWidthCache.reset()),this._renderer.setParams(this._priceAxisView.paneRenderer(),r,i),this._renderer}};c();h();c();h();c();h();var Bc;(function(s){s[s.HitTestThreshold=7]="HitTestThreshold"})(Bc||(Bc={}));var br=class extends X{constructor(){super(...arguments),this._data=null}setData(e){this._data=e}hitTest(e,t){var i;if(!(!((i=this._data)===null||i===void 0)&&i.visible))return null;let{y:r,lineWidth:o,externalId:n}=this._data;return t>=r-o-7&&t<=r+o+7?{hitTestData:this._data,externalId:n}:null}_drawImpl({context:e,bitmapSize:t,horizontalPixelRatio:i,verticalPixelRatio:r}){if(this._data===null||this._data.visible===!1)return;let o=Math.round(this._data.y*r);o<0||o>t.height||(e.lineCap="butt",e.strokeStyle=this._data.color,e.lineWidth=Math.floor(this._data.lineWidth*i),Te(e,this._data.lineStyle),Us(e,o,0,t.width))}};var yt=class{constructor(e){this._lineRendererData={y:0,color:"rgba(0, 0, 0, 0)",lineWidth:1,lineStyle:0,visible:!1},this._lineRenderer=new br,this._invalidated=!0,this._series=e,this._model=e.model(),this._lineRenderer.setData(this._lineRendererData)}update(){this._invalidated=!0}renderer(){return this._series.visible()?(this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._lineRenderer):null}};var vr=class extends yt{constructor(e){super(e)}_updateImpl(){this._lineRendererData.visible=!1;let e=this._series.priceScale(),t=e.mode().mode;if(t!==2&&t!==3)return;let i=this._series.options();if(!i.baseLineVisible||!this._series.visible())return;let r=this._series.firstValue();r!==null&&(this._lineRendererData.visible=!0,this._lineRendererData.y=e.priceToCoordinate(r.value,r.value),this._lineRendererData.color=i.baseLineColor,this._lineRendererData.lineWidth=i.baseLineWidth,this._lineRendererData.lineStyle=i.baseLineStyle)}};c();h();c();h();var Sr=class extends X{constructor(){super(...arguments),this._data=null}setData(e){this._data=e}data(){return this._data}_drawImpl({context:e,horizontalPixelRatio:t,verticalPixelRatio:i}){let r=this._data;if(r===null)return;let o=Math.max(1,Math.floor(t)),n=o%2/2,a=Math.round(r.center.x*t)+n,l=r.center.y*i;e.fillStyle=r.seriesLineColor,e.beginPath();let d=Math.max(2,r.seriesLineWidth*1.5)*t;e.arc(a,l,d,0,2*Math.PI,!1),e.fill(),e.fillStyle=r.fillColor,e.beginPath(),e.arc(a,l,r.radius*t,0,2*Math.PI,!1),e.fill(),e.lineWidth=o,e.strokeStyle=r.strokeColor,e.beginPath(),e.arc(a,l,r.radius*t+o/2,0,2*Math.PI,!1),e.stroke()}};var Dc;(function(s){s[s.AnimationPeriod=2600]="AnimationPeriod",s[s.Stage1Period=.25]="Stage1Period",s[s.Stage2Period=.275]="Stage2Period",s[s.Stage3Period=.475]="Stage3Period",s[s.Stage1StartCircleRadius=4]="Stage1StartCircleRadius",s[s.Stage1EndCircleRadius=10]="Stage1EndCircleRadius",s[s.Stage1StartFillAlpha=.25]="Stage1StartFillAlpha",s[s.Stage1EndFillAlpha=0]="Stage1EndFillAlpha",s[s.Stage1StartStrokeAlpha=.4]="Stage1StartStrokeAlpha",s[s.Stage1EndStrokeAlpha=.8]="Stage1EndStrokeAlpha",s[s.Stage2StartCircleRadius=10]="Stage2StartCircleRadius",s[s.Stage2EndCircleRadius=14]="Stage2EndCircleRadius",s[s.Stage2StartFillAlpha=0]="Stage2StartFillAlpha",s[s.Stage2EndFillAlpha=0]="Stage2EndFillAlpha",s[s.Stage2StartStrokeAlpha=.8]="Stage2StartStrokeAlpha",s[s.Stage2EndStrokeAlpha=0]="Stage2EndStrokeAlpha",s[s.Stage3StartCircleRadius=14]="Stage3StartCircleRadius",s[s.Stage3EndCircleRadius=14]="Stage3EndCircleRadius",s[s.Stage3StartFillAlpha=0]="Stage3StartFillAlpha",s[s.Stage3EndFillAlpha=0]="Stage3EndFillAlpha",s[s.Stage3StartStrokeAlpha=0]="Stage3StartStrokeAlpha",s[s.Stage3EndStrokeAlpha=0]="Stage3EndStrokeAlpha"})(Dc||(Dc={}));var Tu=[{start:0,end:.25,startRadius:4,endRadius:10,startFillAlpha:.25,endFillAlpha:0,startStrokeAlpha:.4,endStrokeAlpha:.8},{start:.25,end:.25+.275,startRadius:10,endRadius:14,startFillAlpha:0,endFillAlpha:0,startStrokeAlpha:.8,endStrokeAlpha:0},{start:.25+.275,end:.25+.275+.475,startRadius:14,endRadius:14,startFillAlpha:0,endFillAlpha:0,startStrokeAlpha:0,endStrokeAlpha:0}];function Ec(s,e,t,i){let r=t+(i-t)*e;return $s(s,r)}function ku(s,e,t){return e+(t-e)*s}function Lc(s,e){let t=s%2600/2600,i;for(let o of Tu)if(t>=o.start&&t<=o.end){i=o;break}ne(i!==void 0,"Last price animation internal logic error");let r=(t-i.start)/(i.end-i.start);return{fillColor:Ec(e,r,i.startFillAlpha,i.endFillAlpha),strokeColor:Ec(e,r,i.startStrokeAlpha,i.endStrokeAlpha),radius:ku(r,i.startRadius,i.endRadius)}}var Cr=class{constructor(e){this._renderer=new Sr,this._invalidated=!0,this._stageInvalidated=!0,this._startTime=performance.now(),this._endTime=this._startTime-1,this._series=e}onDataCleared(){this._endTime=this._startTime-1,this.update()}onNewRealtimeDataReceived(){if(this.update(),this._series.options().lastPriceAnimation===2){let e=performance.now(),t=this._endTime-e;if(t>0){t<2600/4&&(this._endTime+=2600);return}this._startTime=e,this._endTime=e+2600}}update(){this._invalidated=!0}invalidateStage(){this._stageInvalidated=!0}visible(){return this._series.options().lastPriceAnimation!==0}animationActive(){switch(this._series.options().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this._endTime}}renderer(){return this._invalidated?(this._updateImpl(),this._invalidated=!1,this._stageInvalidated=!1):this._stageInvalidated&&(this._updateRendererDataStage(),this._stageInvalidated=!1),this._renderer}_updateImpl(){this._renderer.setData(null);let e=this._series.model().timeScale(),t=e.visibleStrictRange(),i=this._series.firstValue();if(t===null||i===null)return;let r=this._series.lastValueData(!0);if(r.noData||!t.contains(r.index))return;let o={x:e.indexToCoordinate(r.index),y:this._series.priceScale().priceToCoordinate(r.price,i.value)},n=r.color,a=this._series.options().lineWidth,l=Lc(this._duration(),n);this._renderer.setData({seriesLineColor:n,seriesLineWidth:a,fillColor:l.fillColor,strokeColor:l.strokeColor,radius:l.radius,center:o})}_updateRendererDataStage(){let e=this._renderer.data();if(e!==null){let t=Lc(this._duration(),e.seriesLineColor);e.fillColor=t.fillColor,e.strokeColor=t.strokeColor,e.radius=t.radius}}_duration(){return this.animationActive()?performance.now()-this._startTime:2600-1}};c();h();c();h();c();h();c();h();c();h();var Oc;(function(s){s[s.MinShapeSize=12]="MinShapeSize",s[s.MaxShapeSize=30]="MaxShapeSize",s[s.MinShapeMargin=3]="MinShapeMargin"})(Oc||(Oc={}));function Ri(s,e){let t=Math.min(Math.max(s,12),30)*e;return sr(t)}function Tt(s,e){switch(s){case"arrowDown":case"arrowUp":return Ri(e,1);case"circle":return Ri(e,.8);case"square":return Ri(e,.7)}}function on(s){return Tc(Ri(s,1))}function nn(s){return Math.max(Ri(s,.1),3)}function an(s,e,t){return e?s:t?Math.ceil(s/2):0}function Vc(s,e,t){let i=Tt("square",t),r=(i-1)*e.pixelRatio/2,o=e.x-r,n=e.y-r;s.fillRect(o,n,i*e.pixelRatio,i*e.pixelRatio)}function xr(s,e,t,i,r){let o=Tt("square",t),n=(o-1)/2,a=s-n,l=e-n;return i>=a&&i<=a+o&&r>=l&&r<=l+o}function ln(s,e,t,i){let o=(Tt("arrowUp",i)-1)/2*t.pixelRatio,a=(sr(i/2)-1)/2*t.pixelRatio;e.beginPath(),s?(e.moveTo(t.x-o,t.y),e.lineTo(t.x,t.y-o),e.lineTo(t.x+o,t.y),e.lineTo(t.x+a,t.y),e.lineTo(t.x+a,t.y+o),e.lineTo(t.x-a,t.y+o),e.lineTo(t.x-a,t.y)):(e.moveTo(t.x-o,t.y),e.lineTo(t.x,t.y+o),e.lineTo(t.x+o,t.y),e.lineTo(t.x+a,t.y),e.lineTo(t.x+a,t.y-o),e.lineTo(t.x-a,t.y-o),e.lineTo(t.x-a,t.y)),e.fill()}function cn(s,e,t,i,r,o){return xr(e,t,i,r,o)}c();h();function Rc(s,e,t){let r=(Tt("circle",t)-1)/2;s.beginPath(),s.arc(e.x,e.y,r*e.pixelRatio,0,2*Math.PI,!1),s.fill()}function zc(s,e,t,i,r){let n=2+Tt("circle",t)/2,a=s-i,l=e-r;return Math.sqrt(a*a+l*l)<=n}c();h();function Nc(s,e,t,i,r,o){s.save(),s.scale(r,o),s.fillText(e,t,i),s.restore()}function Wc(s,e,t,i,r,o){let n=i/2;return r>=s&&r<=s+t&&o>=e-n&&o<=e+n}var wr=class extends X{constructor(){super(...arguments),this._data=null,this._textWidthCache=new Le,this._fontSize=-1,this._fontFamily="",this._font=""}setData(e){this._data=e}setParams(e,t){(this._fontSize!==e||this._fontFamily!==t)&&(this._fontSize=e,this._fontFamily=t,this._font=Se(e,t),this._textWidthCache.reset())}hitTest(e,t){if(this._data===null||this._data.visibleRange===null)return null;for(let i=this._data.visibleRange.from;i<this._data.visibleRange.to;i++){let r=this._data.items[i];if(Iu(r,e,t))return{hitTestData:r.internalId,externalId:r.externalId}}return null}_drawImpl({context:e,horizontalPixelRatio:t,verticalPixelRatio:i},r,o){if(!(this._data===null||this._data.visibleRange===null)){e.textBaseline="middle",e.font=this._font;for(let n=this._data.visibleRange.from;n<this._data.visibleRange.to;n++){let a=this._data.items[n];if(a.text!==void 0){a.text.width=this._textWidthCache.measureText(e,a.text.content),a.text.height=this._fontSize,a.text.x=a.x-a.text.width/2;let l=e.canvas.width/t;a.text.x>-a.text.width&&a.text.x<l&&(a.text.x=Math.min(Math.max(0,a.text.x),l-a.text.width))}Mu(a,e,t,i)}}}};function Pu(s,e,t){let r=Math.max(1,Math.floor(e))%2/2;return{x:Math.round(s.x*e)+r,y:s.y*t,pixelRatio:e}}function Mu(s,e,t,i){e.fillStyle=s.color,s.text!==void 0&&Nc(e,s.text.content,s.text.x,s.text.y,t,i),Au(s,e,Pu(s,t,i))}function Au(s,e,t){if(s.size!==0){switch(s.shape){case"arrowDown":ln(!1,e,t,s.size);return;case"arrowUp":ln(!0,e,t,s.size);return;case"circle":Rc(e,t,s.size);return;case"square":Vc(e,t,s.size);return}s.shape}}function Iu(s,e,t){return s.text!==void 0&&Wc(s.text.x,s.text.y,s.text.width,s.text.height,e,t)?!0:Bu(s,e,t)}function Bu(s,e,t){if(s.size===0)return!1;switch(s.shape){case"arrowDown":return cn(!0,s.x,s.y,s.size,e,t);case"arrowUp":return cn(!1,s.x,s.y,s.size,e,t);case"circle":return zc(s.x,s.y,s.size,e,t);case"square":return xr(s.x,s.y,s.size,e,t)}}var Hc;(function(s){s[s.TextMargin=.1]="TextMargin"})(Hc||(Hc={}));function Du(s,e,t,i,r,o,n,a,l){let d=ae(t)?t:t.close,u=ae(t)?t:t.high,_=ae(t)?t:t.low,f=ae(e.size)?Math.max(e.size,0):1,m=on(a.barSpacing())*f,g=m/2;switch(s.size=m,e.position){case"inBar":{s.y=n.priceToCoordinate(d,l),s.text!==void 0&&(s.text.y=s.y+g+o+r*(.5+.1));return}case"aboveBar":{s.y=n.priceToCoordinate(u,l)-g-i.aboveBar,s.text!==void 0&&(s.text.y=s.y-g-r*(.5+.1),i.aboveBar+=r*(1+2*.1)),i.aboveBar+=m+o;return}case"belowBar":{s.y=n.priceToCoordinate(_,l)+g+i.belowBar,s.text!==void 0&&(s.text.y=s.y+g+o+r*(.5+.1),i.belowBar+=r*(1+2*.1)),i.belowBar+=m+o;return}}e.position}var yr=class{constructor(e,t){this._invalidated=!0,this._dataInvalidated=!0,this._autoScaleMarginsInvalidated=!0,this._autoScaleMargins=null,this._markersPositions=null,this._renderer=new wr,this._series=e,this._model=t,this._data={items:[],visibleRange:null}}update(e){this._invalidated=!0,this._autoScaleMarginsInvalidated=!0,e==="data"&&(this._dataInvalidated=!0,this._markersPositions=null)}renderer(e){if(!this._series.visible())return null;this._invalidated&&this._makeValid();let t=this._model.options().layout;return this._renderer.setParams(t.fontSize,t.fontFamily),this._renderer.setData(this._data),this._renderer}autoScaleMargins(){if(this._autoScaleMarginsInvalidated){if(this._series.indexedMarkers().length>0){let e=this._model.timeScale().barSpacing(),t=nn(e),i=on(e)*1.5+t*2,r=this._getMarkerPositions();this._autoScaleMargins={above:an(i,r.aboveBar,r.inBar),below:an(i,r.belowBar,r.inBar)}}else this._autoScaleMargins=null;this._autoScaleMarginsInvalidated=!1}return this._autoScaleMargins}_getMarkerPositions(){return this._markersPositions===null&&(this._markersPositions=this._series.indexedMarkers().reduce((e,t)=>(e[t.position]||(e[t.position]=!0),e),{inBar:!1,aboveBar:!1,belowBar:!1})),this._markersPositions}_makeValid(){let e=this._series.priceScale(),t=this._model.timeScale(),i=this._series.indexedMarkers();this._dataInvalidated&&(this._data.items=i.map(u=>({time:u.time,x:0,y:0,size:0,shape:u.shape,color:u.color,internalId:u.internalId,externalId:u.id,text:void 0})),this._dataInvalidated=!1);let r=this._model.options().layout;this._data.visibleRange=null;let o=t.visibleStrictRange();if(o===null)return;let n=this._series.firstValue();if(n===null||this._data.items.length===0)return;let a=NaN,l=nn(t.barSpacing()),d={aboveBar:l,belowBar:l};this._data.visibleRange=nr(this._data.items,o,!0);for(let u=this._data.visibleRange.from;u<this._data.visibleRange.to;u++){let _=i[u];_.time!==a&&(d.aboveBar=l,d.belowBar=l,a=_.time);let f=this._data.items[u];f.x=t.indexToCoordinate(_.time),_.text!==void 0&&_.text.length>0&&(f.text={content:_.text,x:0,y:0,width:0,height:0});let m=this._series.dataAt(_.time);m!==null&&Du(f,_,m,d,r.fontSize,l,e,t,n.value)}this._invalidated=!1}};c();h();var Tr=class extends yt{constructor(e){super(e)}_updateImpl(){let e=this._lineRendererData;e.visible=!1;let t=this._series.options();if(!t.priceLineVisible||!this._series.visible())return;let i=this._series.lastValueData(t.priceLineSource===0);i.noData||(e.visible=!0,e.y=i.coordinate,e.color=this._series.priceLineColor(i.color),e.lineWidth=t.priceLineWidth,e.lineStyle=t.priceLineStyle)}};c();h();var kr=class extends Ge{constructor(e){super(),this._source=e}_updateRendererData(e,t,i){e.visible=!1,t.visible=!1;let r=this._source;if(!r.visible())return;let o=r.options(),n=o.lastValueVisible,a=r.title()!=="",l=o.seriesLastValueMode===0,d=r.lastValueData(!1);if(d.noData)return;n&&(e.text=this._axisText(d,n,l),e.visible=e.text.length!==0),(a||l)&&(t.text=this._paneText(d,n,a,l),t.visible=t.text.length>0);let u=r.priceLineColor(d.color),_=mt(u);i.background=_.background,i.coordinate=d.coordinate,t.borderColor=r.model().backgroundColorAtYPercentFromTop(d.coordinate/r.priceScale().height()),e.borderColor=u,e.color=_.foreground,t.color=_.foreground}_paneText(e,t,i,r){let o="",n=this._source.title();return i&&n.length!==0&&(o+=`${n} `),t&&r&&(o+=this._source.priceScale().isPercentage()?e.formattedPriceAbsolute:e.formattedPricePercentage),o.trim()}_axisText(e,t,i){return t?i?this._source.priceScale().isPercentage()?e.formattedPricePercentage:e.formattedPriceAbsolute:e.text:""}};c();h();c();h();function Uc(s,e,t,i){let r=Number.isFinite(e),o=Number.isFinite(t);return r&&o?s(e,t):!r&&!o?i:r?e:t}var Q=class{constructor(e,t){this._minValue=e,this._maxValue=t}equals(e){return e===null?!1:this._minValue===e._minValue&&this._maxValue===e._maxValue}clone(){return new Q(this._minValue,this._maxValue)}minValue(){return this._minValue}maxValue(){return this._maxValue}length(){return this._maxValue-this._minValue}isEmpty(){return this._maxValue===this._minValue||Number.isNaN(this._maxValue)||Number.isNaN(this._minValue)}merge(e){return e===null?this:new Q(Uc(Math.min,this.minValue(),e.minValue(),-1/0),Uc(Math.max,this.maxValue(),e.maxValue(),1/0))}scaleAroundCenter(e){if(!ae(e)||this._maxValue-this._minValue===0)return;let i=(this._maxValue+this._minValue)*.5,r=this._maxValue-i,o=this._minValue-i;r*=e,o*=e,this._maxValue=i+r,this._minValue=i+o}shift(e){!ae(e)||(this._maxValue+=e,this._minValue+=e)}toRaw(){return{minValue:this._minValue,maxValue:this._maxValue}}static fromRaw(e){return e===null?null:new Q(e.minValue,e.maxValue)}};var Ft=class{constructor(e,t){this._priceRange=e,this._margins=t||null}priceRange(){return this._priceRange}margins(){return this._margins}toRaw(){return this._priceRange===null?null:{priceRange:this._priceRange.toRaw(),margins:this._margins||void 0}}static fromRaw(e){return e===null?null:new Ft(Q.fromRaw(e.priceRange),e.margins)}};c();h();c();h();var Pr=class extends yt{constructor(e,t){super(e),this._priceLine=t}_updateImpl(){let e=this._lineRendererData;e.visible=!1;let t=this._priceLine.options();if(!this._series.visible()||!t.lineVisible)return;let i=this._priceLine.yCoord();i!==null&&(e.visible=!0,e.y=i,e.color=t.color,e.lineWidth=t.lineWidth,e.lineStyle=t.lineStyle,e.externalId=this._priceLine.options().id)}};c();h();var Mr=class extends Ge{constructor(e,t){super(),this._series=e,this._priceLine=t}_updateRendererData(e,t,i){e.visible=!1,t.visible=!1;let r=this._priceLine.options(),o=r.axisLabelVisible,n=r.title!=="",a=this._series;if(!o||!a.visible())return;let l=this._priceLine.yCoord();if(l===null)return;n&&(t.text=r.title,t.visible=!0),t.borderColor=a.model().backgroundColorAtYPercentFromTop(l/a.priceScale().height()),e.text=this._formatPrice(r.price),e.visible=!0;let d=mt(r.axisLabelColor||r.color);i.background=d.background;let u=r.axisLabelTextColor||d.foreground;e.color=u,t.color=u,i.coordinate=l}_formatPrice(e){let t=this._series.firstValue();return t===null?"":this._series.priceScale().formatPrice(e,t.value)}};var Ar=class{constructor(e,t){this._series=e,this._options=t,this._priceLineView=new Pr(e,this),this._priceAxisView=new Mr(e,this),this._panePriceAxisView=new li(this._priceAxisView,e,e.model())}applyOptions(e){B(this._options,e),this.update(),this._series.model().lightUpdate()}options(){return this._options}paneView(){return this._priceLineView}labelPaneView(){return this._panePriceAxisView}priceAxisView(){return this._priceAxisView}update(){this._priceLineView.update(),this._priceAxisView.update()}yCoord(){let e=this._series,t=e.priceScale();if(e.model().timeScale().isEmpty()||t.isEmpty())return null;let r=e.firstValue();return r===null?null:t.priceToCoordinate(this._options.price,r.value)}};c();h();var Ir=class extends St{constructor(e){super(),this._model=e}model(){return this._model}};c();h();var Eu={Bar:(s,e,t,i)=>{var r;let o=e.upColor,n=e.downColor,a=C(s(t,i)),l=nt(a.value[0])<=nt(a.value[3]);return{barColor:(r=a.color)!==null&&r!==void 0?r:l?o:n}},Candlestick:(s,e,t,i)=>{var r,o,n;let a=e.upColor,l=e.downColor,d=e.borderUpColor,u=e.borderDownColor,_=e.wickUpColor,f=e.wickDownColor,m=C(s(t,i)),g=nt(m.value[0])<=nt(m.value[3]);return{barColor:(r=m.color)!==null&&r!==void 0?r:g?a:l,barBorderColor:(o=m.borderColor)!==null&&o!==void 0?o:g?d:u,barWickColor:(n=m.wickColor)!==null&&n!==void 0?n:g?_:f}},Custom:(s,e,t,i)=>{var r;return{barColor:(r=C(s(t,i)).color)!==null&&r!==void 0?r:e.color}},Area:(s,e,t,i)=>{var r,o,n,a;let l=C(s(t,i));return{barColor:(r=l.lineColor)!==null&&r!==void 0?r:e.lineColor,lineColor:(o=l.lineColor)!==null&&o!==void 0?o:e.lineColor,topColor:(n=l.topColor)!==null&&n!==void 0?n:e.topColor,bottomColor:(a=l.bottomColor)!==null&&a!==void 0?a:e.bottomColor}},Baseline:(s,e,t,i)=>{var r,o,n,a,l,d;let u=C(s(t,i));return{barColor:u.value[3]>=e.baseValue.price?e.topLineColor:e.bottomLineColor,topLineColor:(r=u.topLineColor)!==null&&r!==void 0?r:e.topLineColor,bottomLineColor:(o=u.bottomLineColor)!==null&&o!==void 0?o:e.bottomLineColor,topFillColor1:(n=u.topFillColor1)!==null&&n!==void 0?n:e.topFillColor1,topFillColor2:(a=u.topFillColor2)!==null&&a!==void 0?a:e.topFillColor2,bottomFillColor1:(l=u.bottomFillColor1)!==null&&l!==void 0?l:e.bottomFillColor1,bottomFillColor2:(d=u.bottomFillColor2)!==null&&d!==void 0?d:e.bottomFillColor2}},Line:(s,e,t,i)=>{var r,o;let n=C(s(t,i));return{barColor:(r=n.color)!==null&&r!==void 0?r:e.color,lineColor:(o=n.color)!==null&&o!==void 0?o:e.color}},Histogram:(s,e,t,i)=>{var r,o;let n=C(s(t,i));return{barColor:(r=n.color)!==null&&r!==void 0?r:e.color,barBorderColor:(o=n.borderColor)!==null&&o!==void 0?o:e.borderColor}}},Br=class{constructor(e){this._findBar=(t,i)=>i!==void 0?i.value:this._series.bars().valueAt(t),this._series=e,this._styleGetter=Eu[e.seriesType()]}barStyle(e,t){return this._styleGetter(this._findBar,this._series.options(),e,t)}};c();h();c();h();var hn;(function(s){s[s.NearestLeft=-1]="NearestLeft",s[s.None=0]="None",s[s.NearestRight=1]="NearestRight"})(hn||(hn={}));var kt=30,Er=class{constructor(){this._items=[],this._minMaxCache=new Map,this._rowSearchCache=new Map}last(){return this.size()>0?this._items[this._items.length-1]:null}firstIndex(){return this.size()>0?this._indexAt(0):null}lastIndex(){return this.size()>0?this._indexAt(this._items.length-1):null}size(){return this._items.length}isEmpty(){return this.size()===0}contains(e){return this._search(e,0)!==null}valueAt(e){return this.search(e)}search(e,t=0){let i=this._search(e,t);return i===null?null:Object.assign(Object.assign({},this._valueAt(i)),{index:this._indexAt(i)})}rows(){return this._items}minMaxOnRangeCached(e,t,i){if(this.isEmpty())return null;let r=null;for(let o of i){let n=this._minMaxOnRangeCachedImpl(e,t,o);r=Dr(r,n)}return r}setData(e){this._rowSearchCache.clear(),this._minMaxCache.clear(),this._items=e}_indexAt(e){return this._items[e].index}_valueAt(e){return this._items[e]}_search(e,t){let i=this._bsearch(e);if(i===null&&t!==0)switch(t){case-1:return this._searchNearestLeft(e);case 1:return this._searchNearestRight(e);default:throw new TypeError("Unknown search mode")}return i}_searchNearestLeft(e){let t=this._lowerbound(e);return t>0&&(t=t-1),t!==this._items.length&&this._indexAt(t)<e?t:null}_searchNearestRight(e){let t=this._upperbound(e);return t!==this._items.length&&e<this._indexAt(t)?t:null}_bsearch(e){let t=this._lowerbound(e);return t!==this._items.length&&!(e<this._items[t].index)?t:null}_lowerbound(e){return qe(this._items,e,(t,i)=>t.index<i)}_upperbound(e){return or(this._items,e,(t,i)=>t.index>i)}_plotMinMax(e,t,i){let r=null;for(let o=e;o<t;o++){let a=this._items[o].value[i];Number.isNaN(a)||(r===null?r={min:a,max:a}:(a<r.min&&(r.min=a),a>r.max&&(r.max=a)))}return r}_minMaxOnRangeCachedImpl(e,t,i){if(this.isEmpty())return null;let r=null,o=C(this.firstIndex()),n=C(this.lastIndex()),a=Math.max(e,o),l=Math.min(t,n),d=Math.ceil(a/kt)*kt,u=Math.max(d,Math.floor(l/kt)*kt);{let f=this._lowerbound(a),m=this._upperbound(Math.min(l,d,t)),g=this._plotMinMax(f,m,i);r=Dr(r,g)}let _=this._minMaxCache.get(i);_===void 0&&(_=new Map,this._minMaxCache.set(i,_));for(let f=Math.max(d+1,a);f<u;f+=kt){let m=Math.floor(f/kt),g=_.get(m);if(g===void 0){let b=this._lowerbound(m*kt),S=this._upperbound((m+1)*kt-1);g=this._plotMinMax(b,S,i),_.set(m,g)}r=Dr(r,g)}{let f=this._lowerbound(u),m=this._upperbound(l),g=this._plotMinMax(f,m,i);r=Dr(r,g)}return r}};function Dr(s,e){if(s===null)return e;if(e===null)return s;{let t=Math.min(s.min,e.min),i=Math.max(s.max,e.max);return{min:t,max:i}}}function Yc(){return new Er}c();h();var dn=class{constructor(e){this._baseRenderer=e}draw(e,t,i){this._baseRenderer.draw(e)}drawBackground(e,t,i){var r,o;(o=(r=this._baseRenderer).drawBackground)===null||o===void 0||o.call(r,e)}},zi=class{constructor(e){this._cache=null,this._paneView=e}renderer(){var e;let t=this._paneView.renderer();if(t===null)return null;if(((e=this._cache)===null||e===void 0?void 0:e.base)===t)return this._cache.wrapper;let i=new dn(t);return this._cache={base:t,wrapper:i},i}zOrder(){var e,t,i;return(i=(t=(e=this._paneView).zOrder)===null||t===void 0?void 0:t.call(e))!==null&&i!==void 0?i:"normal"}};function $c(s){var e,t,i,r,o;return{text:s.text(),coordinate:s.coordinate(),fixedCoordinate:(e=s.fixedCoordinate)===null||e===void 0?void 0:e.call(s),color:s.textColor(),background:s.backColor(),visible:(i=(t=s.visible)===null||t===void 0?void 0:t.call(s))!==null&&i!==void 0?i:!0,tickVisible:(o=(r=s.tickVisible)===null||r===void 0?void 0:r.call(s))!==null&&o!==void 0?o:!0}}var un=class{constructor(e,t){this._renderer=new ti,this._baseView=e,this._timeScale=t}renderer(){return this._renderer.setData(Object.assign({width:this._timeScale.width()},$c(this._baseView))),this._renderer}},_n=class extends Ge{constructor(e,t){super(),this._baseView=e,this._priceScale=t}_updateRendererData(e,t,i){let r=$c(this._baseView);i.background=r.background,e.color=r.color;let o=2/12*this._priceScale.fontSize();i.additionalPaddingTop=o,i.additionalPaddingBottom=o,i.coordinate=r.coordinate,i.fixedCoordinate=r.fixedCoordinate,e.text=r.text,e.visible=r.visible,e.tickVisible=r.tickVisible}},Lr=class{constructor(e,t){this._paneViewsCache=null,this._timeAxisViewsCache=null,this._priceAxisViewsCache=null,this._priceAxisPaneViewsCache=null,this._timeAxisPaneViewsCache=null,this._primitive=e,this._series=t}primitive(){return this._primitive}updateAllViews(){var e,t;(t=(e=this._primitive).updateAllViews)===null||t===void 0||t.call(e)}paneViews(){var e,t,i,r;let o=(i=(t=(e=this._primitive).paneViews)===null||t===void 0?void 0:t.call(e))!==null&&i!==void 0?i:[];if(((r=this._paneViewsCache)===null||r===void 0?void 0:r.base)===o)return this._paneViewsCache.wrapper;let n=o.map(a=>new zi(a));return this._paneViewsCache={base:o,wrapper:n},n}timeAxisViews(){var e,t,i,r;let o=(i=(t=(e=this._primitive).timeAxisViews)===null||t===void 0?void 0:t.call(e))!==null&&i!==void 0?i:[];if(((r=this._timeAxisViewsCache)===null||r===void 0?void 0:r.base)===o)return this._timeAxisViewsCache.wrapper;let n=this._series.model().timeScale(),a=o.map(l=>new un(l,n));return this._timeAxisViewsCache={base:o,wrapper:a},a}priceAxisViews(){var e,t,i,r;let o=(i=(t=(e=this._primitive).priceAxisViews)===null||t===void 0?void 0:t.call(e))!==null&&i!==void 0?i:[];if(((r=this._priceAxisViewsCache)===null||r===void 0?void 0:r.base)===o)return this._priceAxisViewsCache.wrapper;let n=this._series.priceScale(),a=o.map(l=>new _n(l,n));return this._priceAxisViewsCache={base:o,wrapper:a},a}priceAxisPaneViews(){var e,t,i,r;let o=(i=(t=(e=this._primitive).priceAxisPaneViews)===null||t===void 0?void 0:t.call(e))!==null&&i!==void 0?i:[];if(((r=this._priceAxisPaneViewsCache)===null||r===void 0?void 0:r.base)===o)return this._priceAxisPaneViewsCache.wrapper;let n=o.map(a=>new zi(a));return this._priceAxisPaneViewsCache={base:o,wrapper:n},n}timeAxisPaneViews(){var e,t,i,r;let o=(i=(t=(e=this._primitive).timeAxisPaneViews)===null||t===void 0?void 0:t.call(e))!==null&&i!==void 0?i:[];if(((r=this._timeAxisPaneViewsCache)===null||r===void 0?void 0:r.base)===o)return this._timeAxisPaneViewsCache.wrapper;let n=o.map(a=>new zi(a));return this._timeAxisPaneViewsCache={base:o,wrapper:n},n}autoscaleInfo(e,t){var i,r,o;return(o=(r=(i=this._primitive).autoscaleInfo)===null||r===void 0?void 0:r.call(i,e,t))!==null&&o!==void 0?o:null}hitTest(e,t){var i,r,o;return(o=(r=(i=this._primitive).hitTest)===null||r===void 0?void 0:r.call(i,e,t))!==null&&o!==void 0?o:null}};function mn(s,e,t,i){s.forEach(r=>{e(r).forEach(o=>{o.zOrder()===t&&i.push(o)})})}function pn(s){return s.paneViews()}function Lu(s){return s.priceAxisPaneViews()}function Ou(s){return s.timeAxisPaneViews()}var Pt=class extends Ir{constructor(e,t,i,r,o){super(e),this._data=Yc(),this._priceLineView=new Tr(this),this._customPriceLines=[],this._baseHorizontalLineView=new vr(this),this._lastPriceAnimationPaneView=null,this._barColorerCache=null,this._markers=[],this._indexedMarkers=[],this._animationTimeoutId=null,this._primitives=[],this._options=t,this._seriesType=i;let n=new kr(this);this._priceAxisViews=[n],this._panePriceAxisView=new li(n,this,e),(i==="Area"||i==="Line"||i==="Baseline")&&(this._lastPriceAnimationPaneView=new Cr(this)),this._recreateFormatter(),this._recreatePaneViews(o)}destroy(){this._animationTimeoutId!==null&&clearTimeout(this._animationTimeoutId)}priceLineColor(e){return this._options.priceLineColor||e}lastValueData(e){let t={noData:!0},i=this.priceScale();if(this.model().timeScale().isEmpty()||i.isEmpty()||this._data.isEmpty())return t;let r=this.model().timeScale().visibleStrictRange(),o=this.firstValue();if(r===null||o===null)return t;let n,a;if(e){let f=this._data.last();if(f===null)return t;n=f,a=f.index}else{let f=this._data.search(r.right(),-1);if(f===null||(n=this._data.valueAt(f.index),n===null))return t;a=f.index}let l=n.value[3],u=this.barColorer().barStyle(a,{value:n}),_=i.priceToCoordinate(l,o.value);return{noData:!1,price:l,text:i.formatPrice(l,o.value),formattedPriceAbsolute:i.formatPriceAbsolute(l),formattedPricePercentage:i.formatPricePercentage(l,o.value),color:u.barColor,coordinate:_,index:a}}barColorer(){return this._barColorerCache!==null?this._barColorerCache:(this._barColorerCache=new Br(this),this._barColorerCache)}options(){return this._options}applyOptions(e){let t=e.priceScaleId;t!==void 0&&t!==this._options.priceScaleId&&this.model().moveSeriesToScale(this,t),B(this._options,e),e.priceFormat!==void 0&&(this._recreateFormatter(),this.model().fullUpdate()),this.model().updateSource(this),this.model().updateCrosshair(),this._paneView.update("options")}setData(e,t){this._data.setData(e),this._recalculateMarkers(),this._paneView.update("data"),this._markersPaneView.update("data"),this._lastPriceAnimationPaneView!==null&&(t&&t.lastBarUpdatedOrNewBarsAddedToTheRight?this._lastPriceAnimationPaneView.onNewRealtimeDataReceived():e.length===0&&this._lastPriceAnimationPaneView.onDataCleared());let i=this.model().paneForSource(this);this.model().recalculatePane(i),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()}setMarkers(e){this._markers=e,this._recalculateMarkers();let t=this.model().paneForSource(this);this._markersPaneView.update("data"),this.model().recalculatePane(t),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()}markers(){return this._markers}indexedMarkers(){return this._indexedMarkers}createPriceLine(e){let t=new Ar(this,e);return this._customPriceLines.push(t),this.model().updateSource(this),t}removePriceLine(e){let t=this._customPriceLines.indexOf(e);t!==-1&&this._customPriceLines.splice(t,1),this.model().updateSource(this)}seriesType(){return this._seriesType}firstValue(){let e=this.firstBar();return e===null?null:{value:e.value[3],timePoint:e.time}}firstBar(){let e=this.model().timeScale().visibleStrictRange();if(e===null)return null;let t=e.left();return this._data.search(t,1)}bars(){return this._data}dataAt(e){let t=this._data.valueAt(e);return t===null?null:this._seriesType==="Bar"||this._seriesType==="Candlestick"||this._seriesType==="Custom"?{open:t.value[0],high:t.value[1],low:t.value[2],close:t.value[3]}:t.value[3]}topPaneViews(e){let t=[];mn(this._primitives,pn,"top",t);let i=this._lastPriceAnimationPaneView;return i===null||!i.visible()||(this._animationTimeoutId===null&&i.animationActive()&&(this._animationTimeoutId=setTimeout(()=>{this._animationTimeoutId=null,this.model().cursorUpdate()},0)),i.invalidateStage(),t.push(i)),t}paneViews(){let e=[];this._isOverlay()||e.push(this._baseHorizontalLineView),e.push(this._paneView,this._priceLineView,this._markersPaneView);let t=this._customPriceLines.map(i=>i.paneView());return e.push(...t),mn(this._primitives,pn,"normal",e),e}bottomPaneViews(){return this._extractPaneViews(pn,"bottom")}pricePaneViews(e){return this._extractPaneViews(Lu,e)}timePaneViews(e){return this._extractPaneViews(Ou,e)}primitiveHitTest(e,t){return this._primitives.map(i=>i.hitTest(e,t)).filter(i=>i!==null)}labelPaneViews(e){return[this._panePriceAxisView,...this._customPriceLines.map(t=>t.labelPaneView())]}priceAxisViews(e,t){if(t!==this._priceScale&&!this._isOverlay())return[];let i=[...this._priceAxisViews];for(let r of this._customPriceLines)i.push(r.priceAxisView());return this._primitives.forEach(r=>{i.push(...r.priceAxisViews())}),i}timeAxisViews(){let e=[];return this._primitives.forEach(t=>{e.push(...t.timeAxisViews())}),e}autoscaleInfo(e,t){if(this._options.autoscaleInfoProvider!==void 0){let i=this._options.autoscaleInfoProvider(()=>{let r=this._autoscaleInfoImpl(e,t);return r===null?null:r.toRaw()});return Ft.fromRaw(i)}return this._autoscaleInfoImpl(e,t)}minMove(){return this._options.priceFormat.minMove}formatter(){return this._formatter}updateAllViews(){var e;this._paneView.update(),this._markersPaneView.update();for(let t of this._priceAxisViews)t.update();for(let t of this._customPriceLines)t.update();this._priceLineView.update(),this._baseHorizontalLineView.update(),(e=this._lastPriceAnimationPaneView)===null||e===void 0||e.update(),this._primitives.forEach(t=>t.updateAllViews())}priceScale(){return C(super.priceScale())}markerDataAtIndex(e){if(!((this._seriesType==="Line"||this._seriesType==="Area"||this._seriesType==="Baseline")&&this._options.crosshairMarkerVisible))return null;let i=this._data.valueAt(e);if(i===null)return null;let r=i.value[3],o=this._markerRadius(),n=this._markerBorderColor(),a=this._markerBorderWidth(),l=this._markerBackgroundColor(e);return{price:r,radius:o,borderColor:n,borderWidth:a,backgroundColor:l}}title(){return this._options.title}visible(){return this._options.visible}attachPrimitive(e){this._primitives.push(new Lr(e,this))}detachPrimitive(e){this._primitives=this._primitives.filter(t=>t.primitive()!==e)}customSeriesPlotValuesBuilder(){if(this._paneView instanceof ai)return e=>this._paneView.priceValueBuilder(e)}customSeriesWhitespaceCheck(){if(this._paneView instanceof ai)return e=>this._paneView.isWhitespace(e)}_isOverlay(){let e=this.priceScale();return!Ct(e.id())}_autoscaleInfoImpl(e,t){if(!pt(e)||!pt(t)||this._data.isEmpty())return null;let i=this._seriesType==="Line"||this._seriesType==="Area"||this._seriesType==="Baseline"||this._seriesType==="Histogram"?[3]:[2,1],r=this._data.minMaxOnRangeCached(e,t,i),o=r!==null?new Q(r.min,r.max):null;if(this.seriesType()==="Histogram"){let a=this._options.base,l=new Q(a,a);o=o!==null?o.merge(l):l}let n=this._markersPaneView.autoScaleMargins();return this._primitives.forEach(a=>{let l=a.autoscaleInfo(e,t);if(l?.priceRange){let d=new Q(l.priceRange.minValue,l.priceRange.maxValue);o=o!==null?o.merge(d):d}l?.margins&&(n=Vu(n,l.margins))}),new Ft(o,n)}_markerRadius(){switch(this._seriesType){case"Line":case"Area":case"Baseline":return this._options.crosshairMarkerRadius}return 0}_markerBorderColor(){switch(this._seriesType){case"Line":case"Area":case"Baseline":{let e=this._options.crosshairMarkerBorderColor;if(e.length!==0)return e}}return null}_markerBorderWidth(){switch(this._seriesType){case"Line":case"Area":case"Baseline":return this._options.crosshairMarkerBorderWidth}return 0}_markerBackgroundColor(e){switch(this._seriesType){case"Line":case"Area":case"Baseline":{let t=this._options.crosshairMarkerBackgroundColor;if(t.length!==0)return t}}return this.barColorer().barStyle(e).barColor}_recreateFormatter(){switch(this._options.priceFormat.type){case"custom":{this._formatter={format:this._options.priceFormat.formatter};break}case"volume":{this._formatter=new tr(this._options.priceFormat.precision);break}case"percent":{this._formatter=new ii(this._options.priceFormat.precision);break}default:{let e=Math.pow(10,this._options.priceFormat.precision);this._formatter=new at(e,this._options.priceFormat.minMove*e)}}this._priceScale!==null&&this._priceScale.updateFormatter()}_recalculateMarkers(){let e=this.model().timeScale();if(!e.hasPoints()||this._data.isEmpty()){this._indexedMarkers=[];return}let t=C(this._data.firstIndex());this._indexedMarkers=this._markers.map((i,r)=>{let o=C(e.timeToIndex(i.time,!0)),n=o<t?1:-1;return{time:C(this._data.search(o,n)).index,position:i.position,shape:i.shape,color:i.color,id:i.id,internalId:r,text:i.text,size:i.size,originalTime:i.originalTime}})}_recreatePaneViews(e){switch(this._markersPaneView=new yr(this,this.model()),this._seriesType){case"Bar":{this._paneView=new cr(this,this.model());break}case"Candlestick":{this._paneView=new mr(this,this.model());break}case"Line":{this._paneView=new gr(this,this.model());break}case"Custom":{this._paneView=new ai(this,this.model(),Y(e));break}case"Area":{this._paneView=new ar(this,this.model());break}case"Baseline":{this._paneView=new ur(this,this.model());break}case"Histogram":{this._paneView=new fr(this,this.model());break}default:throw Error("Unknown chart style assigned: "+this._seriesType)}}_extractPaneViews(e,t){let i=[];return mn(this._primitives,e,t,i),i}};function Vu(s,e){var t,i;return{above:Math.max((t=s?.above)!==null&&t!==void 0?t:0,e.above),below:Math.max((i=s?.below)!==null&&i!==void 0?i:0,e.below)}}var Or=class{constructor(e){this._options=e}align(e,t,i){let r=e;if(this._options.mode===0)return r;let o=i.defaultPriceScale(),n=o.firstValue();if(n===null)return r;let a=o.priceToCoordinate(e,n),d=i.dataSources().filter(_=>_ instanceof Pt).reduce((_,f)=>{if(i.isOverlay(f)||!f.visible())return _;let m=f.priceScale(),g=f.bars();if(m.isEmpty()||!g.contains(t))return _;let b=g.valueAt(t);if(b===null)return _;let S=nt(f.firstValue());return _.concat([m.priceToCoordinate(b.value[3],S.value)])},[]);if(d.length===0)return r;d.sort((_,f)=>Math.abs(_-a)-Math.abs(f-a));let u=d[0];return r=o.coordinateToPrice(u,n),r}};c();h();c();h();c();h();c();h();var Vr=class extends X{constructor(){super(...arguments),this._data=null}setData(e){this._data=e}_drawImpl({context:e,bitmapSize:t,horizontalPixelRatio:i,verticalPixelRatio:r}){if(this._data===null)return;let o=Math.max(1,Math.floor(i));e.lineWidth=o,hc(e,()=>{let n=C(this._data);if(n.vertLinesVisible){e.strokeStyle=n.vertLinesColor,Te(e,n.vertLineStyle),e.beginPath();for(let a of n.timeMarks){let l=Math.round(a.coord*i);e.moveTo(l,-o),e.lineTo(l,t.height+o)}e.stroke()}if(n.horzLinesVisible){e.strokeStyle=n.horzLinesColor,Te(e,n.horzLineStyle),e.beginPath();for(let a of n.priceMarks){let l=Math.round(a.coord*r);e.moveTo(-o,l),e.lineTo(t.width+o,l)}e.stroke()}})}};var Rr=class{constructor(e){this._renderer=new Vr,this._invalidated=!0,this._pane=e}update(){this._invalidated=!0}renderer(){if(this._invalidated){let e=this._pane.model().options().grid,t={horzLinesVisible:e.horzLines.visible,vertLinesVisible:e.vertLines.visible,horzLinesColor:e.horzLines.color,vertLinesColor:e.vertLines.color,horzLineStyle:e.horzLines.style,vertLineStyle:e.vertLines.style,priceMarks:this._pane.defaultPriceScale().marks(),timeMarks:(this._pane.model().timeScale().marks()||[]).map(i=>({coord:i.coord}))};this._renderer.setData(t),this._invalidated=!1}return this._renderer}};var zr=class{constructor(e){this._paneView=new Rr(e)}paneView(){return this._paneView}};c();h();c();h();var fn={logicalOffset:4,coordOffset:1e-4};function Xc(s,e){return e<0&&(s=-s),s/100*e+e}function Ht(s,e){let t=100*(s-e)/e;return e<0?-t:t}function jc(s,e){let t=Ht(s.minValue(),e),i=Ht(s.maxValue(),e);return new Q(t,i)}function Gc(s,e){return s-=100,e<0&&(s=-s),s/100*e+e}function ci(s,e){let t=100*(s-e)/e+100;return e<0?-t:t}function qc(s,e){let t=ci(s.minValue(),e),i=ci(s.maxValue(),e);return new Q(t,i)}function Ni(s,e){let t=Math.abs(s);if(t<1e-15)return 0;let i=Math.log10(t+e.coordOffset)+e.logicalOffset;return s<0?-i:i}function hi(s,e){let t=Math.abs(s);if(t<1e-15)return 0;let i=Math.pow(10,t-e.logicalOffset)-e.coordOffset;return s<0?-i:i}function di(s,e){if(s===null)return null;let t=Ni(s.minValue(),e),i=Ni(s.maxValue(),e);return new Q(t,i)}function Zc(s,e){if(s===null)return!1;let t=hi(s.minValue(),e),i=hi(s.maxValue(),e);return isFinite(t)&&isFinite(i)}function Wi(s,e){if(s===null)return null;let t=hi(s.minValue(),e),i=hi(s.maxValue(),e);return new Q(t,i)}function Nr(s){if(s===null)return fn;let e=Math.abs(s.maxValue()-s.minValue());if(e>=1||e<1e-15)return fn;let t=Math.ceil(Math.abs(Math.log10(e))),i=fn.logicalOffset+t,r=1/Math.pow(10,i);return{logicalOffset:i,coordOffset:r}}function Kc(s,e){return s.logicalOffset===e.logicalOffset&&s.coordOffset===e.coordOffset}c();h();c();h();var Qc;(function(s){s[s.TickSpanEpsilon=1e-14]="TickSpanEpsilon"})(Qc||(Qc={}));var ui=class{constructor(e,t){if(this._base=e,this._integralDividers=t,xc(this._base))this._fractionalDividers=[2,2.5,2];else{this._fractionalDividers=[];for(let i=this._base;i!==1;){if(i%2===0)this._fractionalDividers.push(2),i/=2;else if(i%5===0)this._fractionalDividers.push(2,2.5),i/=5;else throw new Error("unexpected base");if(this._fractionalDividers.length>100)throw new Error("something wrong with base")}}}tickSpan(e,t,i){let r=this._base===0?0:1/this._base,o=Math.pow(10,Math.max(0,Math.ceil(Math.log10(e-t)))),n=0,a=this._integralDividers[0];for(;;){let l=Vi(o,r,1e-14)&&o>r+1e-14,d=Vi(o,i*a,1e-14),u=Vi(o,1,1e-14);if(!(l&&d&&u))break;o/=a,a=this._integralDividers[++n%this._integralDividers.length]}if(o<=r+1e-14&&(o=r),o=Math.max(1,o),this._fractionalDividers.length>0&&wc(o,1,1e-14))for(n=0,a=this._fractionalDividers[0];Vi(o,i*a,1e-14)&&o>r+1e-14;)o/=a,a=this._fractionalDividers[++n%this._fractionalDividers.length];return o}};var Ru=2.5,Fi=class{constructor(e,t,i,r){this._marks=[],this._priceScale=e,this._base=t,this._coordinateToLogicalFunc=i,this._logicalToCoordinateFunc=r}tickSpan(e,t){if(e<t)throw new Error("high < low");let i=this._priceScale.height(),r=this._tickMarkHeight(),o=(e-t)*r/i,n=new ui(this._base,[2,2.5,2]),a=new ui(this._base,[2,2,2.5]),l=new ui(this._base,[2.5,2,2]),d=[];return d.push(n.tickSpan(e,t,o),a.tickSpan(e,t,o),l.tickSpan(e,t,o)),yc(d)}rebuildTickMarks(){let e=this._priceScale,t=e.firstValue();if(t===null){this._marks=[];return}let i=e.height(),r=this._coordinateToLogicalFunc(i-1,t),o=this._coordinateToLogicalFunc(0,t),n=this._priceScale.options().entireTextOnly?this._fontHeight()/2:0,a=n,l=i-1-n,d=Math.max(r,o),u=Math.min(r,o);if(d===u){this._marks=[];return}let _=this.tickSpan(d,u),f=d%_;f+=f<0?_:0;let m=d>=u?1:-1,g=null,b=0;for(let S=d-f;S>u;S-=_){let v=this._logicalToCoordinateFunc(S,t,!0);g!==null&&Math.abs(v-g)<this._tickMarkHeight()||v<a||v>l||(b<this._marks.length?(this._marks[b].coord=v,this._marks[b].label=e.formatLogical(S)):this._marks.push({coord:v,label:e.formatLogical(S)}),b++,g=v,e.isLog()&&(_=this.tickSpan(S*m,u)))}this._marks.length=b}marks(){return this._marks}_fontHeight(){return this._priceScale.fontSize()}_tickMarkHeight(){return Math.ceil(this._fontHeight()*Ru)}};c();h();function Wr(s){return s.slice().sort((e,t)=>C(e.zorder())-C(t.zorder()))}var gn;(function(s){s[s.Normal=0]="Normal",s[s.Logarithmic=1]="Logarithmic",s[s.Percentage=2]="Percentage",s[s.IndexedTo100=3]="IndexedTo100"})(gn||(gn={}));var Jc=new ii,eh=new at(100,1),Fr=class{constructor(e,t,i,r){this._height=0,this._internalHeightCache=null,this._priceRange=null,this._priceRangeSnapshot=null,this._invalidatedForRange={isValid:!1,visibleBars:null},this._marginAbove=0,this._marginBelow=0,this._onMarksChanged=new L,this._modeChanged=new L,this._dataSources=[],this._cachedOrderedSources=null,this._marksCache=null,this._scaleStartPoint=null,this._scrollStartPoint=null,this._formatter=eh,this._logFormula=Nr(null),this._id=e,this._options=t,this._layoutOptions=i,this._localizationOptions=r,this._markBuilder=new Fi(this,100,this._coordinateToLogical.bind(this),this._logicalToCoordinate.bind(this))}id(){return this._id}options(){return this._options}applyOptions(e){if(B(this._options,e),this.updateFormatter(),e.mode!==void 0&&this.setMode({mode:e.mode}),e.scaleMargins!==void 0){let t=Y(e.scaleMargins.top),i=Y(e.scaleMargins.bottom);if(t<0||t>1)throw new Error(`Invalid top margin - expect value between 0 and 1, given=${t}`);if(i<0||i>1)throw new Error(`Invalid bottom margin - expect value between 0 and 1, given=${i}`);if(t+i>1)throw new Error(`Invalid margins - sum of margins must be less than 1, given=${t+i}`);this._invalidateInternalHeightCache(),this._marksCache=null}}isAutoScale(){return this._options.autoScale}isLog(){return this._options.mode===1}isPercentage(){return this._options.mode===2}isIndexedTo100(){return this._options.mode===3}mode(){return{autoScale:this._options.autoScale,isInverted:this._options.invertScale,mode:this._options.mode}}setMode(e){let t=this.mode(),i=null;e.autoScale!==void 0&&(this._options.autoScale=e.autoScale),e.mode!==void 0&&(this._options.mode=e.mode,(e.mode===2||e.mode===3)&&(this._options.autoScale=!0),this._invalidatedForRange.isValid=!1),t.mode===1&&e.mode!==t.mode&&(Zc(this._priceRange,this._logFormula)?(i=Wi(this._priceRange,this._logFormula),i!==null&&this.setPriceRange(i)):this._options.autoScale=!0),e.mode===1&&e.mode!==t.mode&&(i=di(this._priceRange,this._logFormula),i!==null&&this.setPriceRange(i));let r=t.mode!==this._options.mode;r&&(t.mode===2||this.isPercentage())&&this.updateFormatter(),r&&(t.mode===3||this.isIndexedTo100())&&this.updateFormatter(),e.isInverted!==void 0&&t.isInverted!==e.isInverted&&(this._options.invertScale=e.isInverted,this._onIsInvertedChanged()),this._modeChanged.fire(t,this.mode())}modeChanged(){return this._modeChanged}fontSize(){return this._layoutOptions.fontSize}height(){return this._height}setHeight(e){this._height!==e&&(this._height=e,this._invalidateInternalHeightCache(),this._marksCache=null)}internalHeight(){if(this._internalHeightCache)return this._internalHeightCache;let e=this.height()-this._topMarginPx()-this._bottomMarginPx();return this._internalHeightCache=e,e}priceRange(){return this._makeSureItIsValid(),this._priceRange}setPriceRange(e,t){let i=this._priceRange;!t&&!(i===null&&e!==null)&&(i===null||i.equals(e))||(this._marksCache=null,this._priceRange=e)}isEmpty(){return this._makeSureItIsValid(),this._height===0||!this._priceRange||this._priceRange.isEmpty()}invertedCoordinate(e){return this.isInverted()?e:this.height()-1-e}priceToCoordinate(e,t){return this.isPercentage()?e=Ht(e,t):this.isIndexedTo100()&&(e=ci(e,t)),this._logicalToCoordinate(e,t)}pointsArrayToCoordinates(e,t,i){this._makeSureItIsValid();let r=this._bottomMarginPx(),o=C(this.priceRange()),n=o.minValue(),a=o.maxValue(),l=this.internalHeight()-1,d=this.isInverted(),u=l/(a-n),_=i===void 0?0:i.from,f=i===void 0?e.length:i.to,m=this._getCoordinateTransformer();for(let g=_;g<f;g++){let b=e[g],S=b.price;if(isNaN(S))continue;let v=S;m!==null&&(v=m(b.price,t));let x=r+u*(v-n),y=d?x:this._height-1-x;b.y=y}}barPricesToCoordinates(e,t,i){this._makeSureItIsValid();let r=this._bottomMarginPx(),o=C(this.priceRange()),n=o.minValue(),a=o.maxValue(),l=this.internalHeight()-1,d=this.isInverted(),u=l/(a-n),_=i===void 0?0:i.from,f=i===void 0?e.length:i.to,m=this._getCoordinateTransformer();for(let g=_;g<f;g++){let b=e[g],S=b.open,v=b.high,x=b.low,y=b.close;m!==null&&(S=m(b.open,t),v=m(b.high,t),x=m(b.low,t),y=m(b.close,t));let T=r+u*(S-n),w=d?T:this._height-1-T;b.openY=w,T=r+u*(v-n),w=d?T:this._height-1-T,b.highY=w,T=r+u*(x-n),w=d?T:this._height-1-T,b.lowY=w,T=r+u*(y-n),w=d?T:this._height-1-T,b.closeY=w}}coordinateToPrice(e,t){let i=this._coordinateToLogical(e,t);return this.logicalToPrice(i,t)}logicalToPrice(e,t){let i=e;return this.isPercentage()?i=Xc(i,t):this.isIndexedTo100()&&(i=Gc(i,t)),i}dataSources(){return this._dataSources}orderedSources(){if(this._cachedOrderedSources)return this._cachedOrderedSources;let e=[];for(let t=0;t<this._dataSources.length;t++){let i=this._dataSources[t];i.zorder()===null&&i.setZorder(t+1),e.push(i)}return e=Wr(e),this._cachedOrderedSources=e,this._cachedOrderedSources}addDataSource(e){this._dataSources.indexOf(e)===-1&&(this._dataSources.push(e),this.updateFormatter(),this.invalidateSourcesCache())}removeDataSource(e){let t=this._dataSources.indexOf(e);if(t===-1)throw new Error("source is not attached to scale");this._dataSources.splice(t,1),this._dataSources.length===0&&(this.setMode({autoScale:!0}),this.setPriceRange(null)),this.updateFormatter(),this.invalidateSourcesCache()}firstValue(){let e=null;for(let t of this._dataSources){let i=t.firstValue();i!==null&&(e===null||i.timePoint<e.timePoint)&&(e=i)}return e===null?null:e.value}isInverted(){return this._options.invertScale}marks(){let e=this.firstValue()===null;if(this._marksCache!==null&&(e||this._marksCache.firstValueIsNull===e))return this._marksCache.marks;this._markBuilder.rebuildTickMarks();let t=this._markBuilder.marks();return this._marksCache={marks:t,firstValueIsNull:e},this._onMarksChanged.fire(),t}onMarksChanged(){return this._onMarksChanged}startScale(e){this.isPercentage()||this.isIndexedTo100()||this._scaleStartPoint!==null||this._priceRangeSnapshot!==null||this.isEmpty()||(this._scaleStartPoint=this._height-e,this._priceRangeSnapshot=C(this.priceRange()).clone())}scaleTo(e){if(this.isPercentage()||this.isIndexedTo100()||this._scaleStartPoint===null)return;this.setMode({autoScale:!1}),e=this._height-e,e<0&&(e=0);let t=(this._scaleStartPoint+(this._height-1)*.2)/(e+(this._height-1)*.2),i=C(this._priceRangeSnapshot).clone();t=Math.max(t,.1),i.scaleAroundCenter(t),this.setPriceRange(i)}endScale(){this.isPercentage()||this.isIndexedTo100()||(this._scaleStartPoint=null,this._priceRangeSnapshot=null)}startScroll(e){this.isAutoScale()||this._scrollStartPoint!==null||this._priceRangeSnapshot!==null||this.isEmpty()||(this._scrollStartPoint=e,this._priceRangeSnapshot=C(this.priceRange()).clone())}scrollTo(e){if(this.isAutoScale()||this._scrollStartPoint===null)return;let t=C(this.priceRange()).length()/(this.internalHeight()-1),i=e-this._scrollStartPoint;this.isInverted()&&(i*=-1);let r=i*t,o=C(this._priceRangeSnapshot).clone();o.shift(r),this.setPriceRange(o,!0),this._marksCache=null}endScroll(){this.isAutoScale()||this._scrollStartPoint!==null&&(this._scrollStartPoint=null,this._priceRangeSnapshot=null)}formatter(){return this._formatter||this.updateFormatter(),this._formatter}formatPrice(e,t){switch(this._options.mode){case 2:return this._formatPercentage(Ht(e,t));case 3:return this.formatter().format(ci(e,t));default:return this._formatPrice(e)}}formatLogical(e){switch(this._options.mode){case 2:return this._formatPercentage(e);case 3:return this.formatter().format(e);default:return this._formatPrice(e)}}formatPriceAbsolute(e){return this._formatPrice(e,C(this._formatterSource()).formatter())}formatPricePercentage(e,t){return e=Ht(e,t),this._formatPercentage(e,Jc)}sourcesForAutoScale(){return this._dataSources}recalculatePriceRange(e){this._invalidatedForRange={visibleBars:e,isValid:!1}}updateAllViews(){this._dataSources.forEach(e=>e.updateAllViews())}updateFormatter(){this._marksCache=null;let e=this._formatterSource(),t=100;e!==null&&(t=Math.round(1/e.minMove())),this._formatter=eh,this.isPercentage()?(this._formatter=Jc,t=100):this.isIndexedTo100()?(this._formatter=new at(100,1),t=100):e!==null&&(this._formatter=e.formatter()),this._markBuilder=new Fi(this,t,this._coordinateToLogical.bind(this),this._logicalToCoordinate.bind(this)),this._markBuilder.rebuildTickMarks()}invalidateSourcesCache(){this._cachedOrderedSources=null}_formatterSource(){return this._dataSources[0]||null}_topMarginPx(){return this.isInverted()?this._options.scaleMargins.bottom*this.height()+this._marginBelow:this._options.scaleMargins.top*this.height()+this._marginAbove}_bottomMarginPx(){return this.isInverted()?this._options.scaleMargins.top*this.height()+this._marginAbove:this._options.scaleMargins.bottom*this.height()+this._marginBelow}_makeSureItIsValid(){this._invalidatedForRange.isValid||(this._invalidatedForRange.isValid=!0,this._recalculatePriceRangeImpl())}_invalidateInternalHeightCache(){this._internalHeightCache=null}_logicalToCoordinate(e,t){if(this._makeSureItIsValid(),this.isEmpty())return 0;e=this.isLog()&&e?Ni(e,this._logFormula):e;let i=C(this.priceRange()),r=this._bottomMarginPx()+(this.internalHeight()-1)*(e-i.minValue())/i.length();return this.invertedCoordinate(r)}_coordinateToLogical(e,t){if(this._makeSureItIsValid(),this.isEmpty())return 0;let i=this.invertedCoordinate(e),r=C(this.priceRange()),o=r.minValue()+r.length()*((i-this._bottomMarginPx())/(this.internalHeight()-1));return this.isLog()?hi(o,this._logFormula):o}_onIsInvertedChanged(){this._marksCache=null,this._markBuilder.rebuildTickMarks()}_recalculatePriceRangeImpl(){let e=this._invalidatedForRange.visibleBars;if(e===null)return;let t=null,i=this.sourcesForAutoScale(),r=0,o=0;for(let n of i){if(!n.visible())continue;let a=n.firstValue();if(a===null)continue;let l=n.autoscaleInfo(e.left(),e.right()),d=l&&l.priceRange();if(d!==null){switch(this._options.mode){case 1:d=di(d,this._logFormula);break;case 2:d=jc(d,a.value);break;case 3:d=qc(d,a.value);break}if(t===null?t=d:t=t.merge(C(d)),l!==null){let u=l.margins();u!==null&&(r=Math.max(r,u.above),o=Math.max(o,u.below))}}}if((r!==this._marginAbove||o!==this._marginBelow)&&(this._marginAbove=r,this._marginBelow=o,this._marksCache=null,this._invalidateInternalHeightCache()),t!==null){if(t.minValue()===t.maxValue()){let n=this._formatterSource(),l=5*(n===null||this.isPercentage()||this.isIndexedTo100()?1:n.minMove());this.isLog()&&(t=Wi(t,this._logFormula)),t=new Q(t.minValue()-l,t.maxValue()+l),this.isLog()&&(t=di(t,this._logFormula))}if(this.isLog()){let n=Wi(t,this._logFormula),a=Nr(n);if(!Kc(a,this._logFormula)){let l=this._priceRangeSnapshot!==null?Wi(this._priceRangeSnapshot,this._logFormula):null;this._logFormula=a,t=di(n,a),l!==null&&(this._priceRangeSnapshot=di(l,a))}}this.setPriceRange(t)}else this._priceRange===null&&(this.setPriceRange(new Q(-.5,.5)),this._logFormula=Nr(null));this._invalidatedForRange.isValid=!0}_getCoordinateTransformer(){return this.isPercentage()?Ht:this.isIndexedTo100()?ci:this.isLog()?e=>Ni(e,this._logFormula):null}_formatValue(e,t,i){return t===void 0?(i===void 0&&(i=this.formatter()),i.format(e)):t(e)}_formatPrice(e,t){return this._formatValue(e,this._localizationOptions.priceFormatter,t)}_formatPercentage(e,t){return this._formatValue(e,this._localizationOptions.percentageFormatter,t)}};var bn=1e3,Hr=class{constructor(e,t){this._dataSources=[],this._overlaySourcesByScaleId=new Map,this._height=0,this._width=0,this._stretchFactor=bn,this._cachedOrderedSources=null,this._destroyed=new L,this._timeScale=e,this._model=t,this._grid=new zr(this);let i=t.options();this._leftPriceScale=this._createPriceScale("left",i.leftPriceScale),this._rightPriceScale=this._createPriceScale("right",i.rightPriceScale),this._leftPriceScale.modeChanged().subscribe(this._onPriceScaleModeChanged.bind(this,this._leftPriceScale),this),this._rightPriceScale.modeChanged().subscribe(this._onPriceScaleModeChanged.bind(this,this._rightPriceScale),this),this.applyScaleOptions(i)}applyScaleOptions(e){if(e.leftPriceScale&&this._leftPriceScale.applyOptions(e.leftPriceScale),e.rightPriceScale&&this._rightPriceScale.applyOptions(e.rightPriceScale),e.localization&&(this._leftPriceScale.updateFormatter(),this._rightPriceScale.updateFormatter()),e.overlayPriceScales){let t=Array.from(this._overlaySourcesByScaleId.values());for(let i of t){let r=C(i[0].priceScale());r.applyOptions(e.overlayPriceScales),e.localization&&r.updateFormatter()}}}priceScaleById(e){switch(e){case"left":return this._leftPriceScale;case"right":return this._rightPriceScale}return this._overlaySourcesByScaleId.has(e)?Y(this._overlaySourcesByScaleId.get(e))[0].priceScale():null}destroy(){this.model().priceScalesOptionsChanged().unsubscribeAll(this),this._leftPriceScale.modeChanged().unsubscribeAll(this),this._rightPriceScale.modeChanged().unsubscribeAll(this),this._dataSources.forEach(e=>{e.destroy&&e.destroy()}),this._destroyed.fire()}stretchFactor(){return this._stretchFactor}setStretchFactor(e){this._stretchFactor=e}model(){return this._model}width(){return this._width}height(){return this._height}setWidth(e){this._width=e,this.updateAllSources()}setHeight(e){this._height=e,this._leftPriceScale.setHeight(e),this._rightPriceScale.setHeight(e),this._dataSources.forEach(t=>{if(this.isOverlay(t)){let i=t.priceScale();i!==null&&i.setHeight(e)}}),this.updateAllSources()}dataSources(){return this._dataSources}isOverlay(e){let t=e.priceScale();return t===null?!0:this._leftPriceScale!==t&&this._rightPriceScale!==t}addDataSource(e,t,i){let r=i!==void 0?i:this._getZOrderMinMax().maxZOrder+1;this._insertDataSource(e,t,r)}removeDataSource(e){let t=this._dataSources.indexOf(e);ne(t!==-1,"removeDataSource: invalid data source"),this._dataSources.splice(t,1);let i=C(e.priceScale()).id();if(this._overlaySourcesByScaleId.has(i)){let o=Y(this._overlaySourcesByScaleId.get(i)),n=o.indexOf(e);n!==-1&&(o.splice(n,1),o.length===0&&this._overlaySourcesByScaleId.delete(i))}let r=e.priceScale();r&&r.dataSources().indexOf(e)>=0&&r.removeDataSource(e),r!==null&&(r.invalidateSourcesCache(),this.recalculatePriceScale(r)),this._cachedOrderedSources=null}priceScalePosition(e){return e===this._leftPriceScale?"left":e===this._rightPriceScale?"right":"overlay"}leftPriceScale(){return this._leftPriceScale}rightPriceScale(){return this._rightPriceScale}startScalePrice(e,t){e.startScale(t)}scalePriceTo(e,t){e.scaleTo(t),this.updateAllSources()}endScalePrice(e){e.endScale()}startScrollPrice(e,t){e.startScroll(t)}scrollPriceTo(e,t){e.scrollTo(t),this.updateAllSources()}endScrollPrice(e){e.endScroll()}updateAllSources(){this._dataSources.forEach(e=>{e.updateAllViews()})}defaultPriceScale(){let e=null;return this._model.options().rightPriceScale.visible&&this._rightPriceScale.dataSources().length!==0?e=this._rightPriceScale:this._model.options().leftPriceScale.visible&&this._leftPriceScale.dataSources().length!==0?e=this._leftPriceScale:this._dataSources.length!==0&&(e=this._dataSources[0].priceScale()),e===null&&(e=this._rightPriceScale),e}defaultVisiblePriceScale(){let e=null;return this._model.options().rightPriceScale.visible?e=this._rightPriceScale:this._model.options().leftPriceScale.visible&&(e=this._leftPriceScale),e}recalculatePriceScale(e){e===null||!e.isAutoScale()||this._recalculatePriceScaleImpl(e)}resetPriceScale(e){let t=this._timeScale.visibleStrictRange();e.setMode({autoScale:!0}),t!==null&&e.recalculatePriceRange(t),this.updateAllSources()}momentaryAutoScale(){this._recalculatePriceScaleImpl(this._leftPriceScale),this._recalculatePriceScaleImpl(this._rightPriceScale)}recalculate(){this.recalculatePriceScale(this._leftPriceScale),this.recalculatePriceScale(this._rightPriceScale),this._dataSources.forEach(e=>{this.isOverlay(e)&&this.recalculatePriceScale(e.priceScale())}),this.updateAllSources(),this._model.lightUpdate()}orderedSources(){return this._cachedOrderedSources===null&&(this._cachedOrderedSources=Wr(this._dataSources)),this._cachedOrderedSources}onDestroyed(){return this._destroyed}grid(){return this._grid}_recalculatePriceScaleImpl(e){let t=e.sourcesForAutoScale();if(t&&t.length>0&&!this._timeScale.isEmpty()){let i=this._timeScale.visibleStrictRange();i!==null&&e.recalculatePriceRange(i)}e.updateAllViews()}_getZOrderMinMax(){let e=this.orderedSources();if(e.length===0)return{minZOrder:0,maxZOrder:0};let t=0,i=0;for(let r=0;r<e.length;r++){let n=e[r].zorder();n!==null&&(n<t&&(t=n),n>i&&(i=n))}return{minZOrder:t,maxZOrder:i}}_insertDataSource(e,t,i){let r=this.priceScaleById(t);if(r===null&&(r=this._createPriceScale(t,this._model.options().overlayPriceScales)),this._dataSources.push(e),!Ct(t)){let o=this._overlaySourcesByScaleId.get(t)||[];o.push(e),this._overlaySourcesByScaleId.set(t,o)}r.addDataSource(e),e.setPriceScale(r),e.setZorder(i),this.recalculatePriceScale(r),this._cachedOrderedSources=null}_onPriceScaleModeChanged(e,t,i){t.mode!==i.mode&&this._recalculatePriceScaleImpl(e)}_createPriceScale(e,t){let i=Object.assign({visible:!0,autoScale:!0},ue(t)),r=new Fr(e,i,this._model.options().layout,this._model.options().localization);return r.setHeight(this.height()),r}};c();h();c();h();var Ur=class{constructor(e,t,i=50){this._actualSize=0,this._usageTick=1,this._oldestTick=1,this._cache=new Map,this._tick2Labels=new Map,this._format=e,this._horzScaleBehavior=t,this._maxSize=i}format(e){let t=e.time,i=this._horzScaleBehavior.cacheKey(t),r=this._cache.get(i);if(r!==void 0)return r.string;if(this._actualSize===this._maxSize){let n=this._tick2Labels.get(this._oldestTick);this._tick2Labels.delete(this._oldestTick),this._cache.delete(Y(n)),this._oldestTick++,this._actualSize--}let o=this._format(e);return this._cache.set(i,{string:o,tick:this._usageTick}),this._tick2Labels.set(this._usageTick,i),this._actualSize++,this._usageTick++,o}};c();h();var Ke=class{constructor(e,t){ne(e<=t,"right should be >= left"),this._left=e,this._right=t}left(){return this._left}right(){return this._right}count(){return this._right-this._left+1}contains(e){return this._left<=e&&e<=this._right}equals(e){return this._left===e.left()&&this._right===e.right()}};function vn(s,e){return s===null||e===null?s===e:s.equals(e)}c();h();var Yr=class{constructor(){this._marksByWeight=new Map,this._cache=null,this._uniformDistribution=!1}setUniformDistribution(e){this._uniformDistribution=e,this._cache=null}setTimeScalePoints(e,t){this._removeMarksSinceIndex(t),this._cache=null;for(let i=t;i<e.length;++i){let r=e[i],o=this._marksByWeight.get(r.timeWeight);o===void 0&&(o=[],this._marksByWeight.set(r.timeWeight,o)),o.push({index:i,time:r.time,weight:r.timeWeight,originalTime:r.originalTime})}}build(e,t){let i=Math.ceil(t/e);return(this._cache===null||this._cache.maxIndexesPerMark!==i)&&(this._cache={marks:this._buildMarksImpl(i),maxIndexesPerMark:i}),this._cache.marks}_removeMarksSinceIndex(e){if(e===0){this._marksByWeight.clear();return}let t=[];this._marksByWeight.forEach((i,r)=>{e<=i[0].index?t.push(r):i.splice(qe(i,e,o=>o.index<e),1/0)});for(let i of t)this._marksByWeight.delete(i)}_buildMarksImpl(e){let t=[];for(let i of Array.from(this._marksByWeight.keys()).sort((r,o)=>o-r)){if(!this._marksByWeight.get(i))continue;let r=t;t=[];let o=r.length,n=0,a=Y(this._marksByWeight.get(i)),l=a.length,d=1/0,u=-1/0;for(let _=0;_<l;_++){let f=a[_],m=f.index;for(;n<o;){let g=r[n],b=g.index;if(b<m)n++,t.push(g),u=b,d=1/0;else{d=b;break}}if(d-m>=e&&m-u>=e)t.push(f),u=m;else if(this._uniformDistribution)return r}for(;n<o;n++)t.push(r[n])}return t}};c();h();var Qe=class{constructor(e){this._logicalRange=e}strictRange(){return this._logicalRange===null?null:new Ke(Math.floor(this._logicalRange.left()),Math.ceil(this._logicalRange.right()))}logicalRange(){return this._logicalRange}static invalid(){return new Qe(null)}};var th=8,ih;(function(s){s[s.DefaultAnimationDuration=400]="DefaultAnimationDuration",s[s.MinVisibleBarsCount=2]="MinVisibleBarsCount"})(ih||(ih={}));function sh(s,e){return s.weight>e.weight?s:e}var $r=class{constructor(e,t,i,r){this._width=0,this._baseIndexOrNull=null,this._points=[],this._scrollStartPoint=null,this._scaleStartPoint=null,this._tickMarks=new Yr,this._formattedByWeight=new Map,this._visibleRange=Qe.invalid(),this._visibleRangeInvalidated=!0,this._visibleBarsChanged=new L,this._logicalRangeChanged=new L,this._optionsApplied=new L,this._commonTransitionStartState=null,this._timeMarksCache=null,this._labels=[],this._options=t,this._localizationOptions=i,this._rightOffset=t.rightOffset,this._barSpacing=t.barSpacing,this._model=e,this._horzScaleBehavior=r,this._updateDateTimeFormatter(),this._tickMarks.setUniformDistribution(t.uniformDistribution)}options(){return this._options}applyLocalizationOptions(e){B(this._localizationOptions,e),this._invalidateTickMarks(),this._updateDateTimeFormatter()}applyOptions(e,t){var i;B(this._options,e),this._options.fixLeftEdge&&this._doFixLeftEdge(),this._options.fixRightEdge&&this._doFixRightEdge(),e.barSpacing!==void 0&&this._model.setBarSpacing(e.barSpacing),e.rightOffset!==void 0&&this._model.setRightOffset(e.rightOffset),e.minBarSpacing!==void 0&&this._model.setBarSpacing((i=e.barSpacing)!==null&&i!==void 0?i:this._barSpacing),this._invalidateTickMarks(),this._updateDateTimeFormatter(),this._optionsApplied.fire()}indexToTime(e){var t,i;return(i=(t=this._points[e])===null||t===void 0?void 0:t.time)!==null&&i!==void 0?i:null}indexToTimeScalePoint(e){var t;return(t=this._points[e])!==null&&t!==void 0?t:null}timeToIndex(e,t){if(this._points.length<1)return null;if(this._horzScaleBehavior.key(e)>this._horzScaleBehavior.key(this._points[this._points.length-1].time))return t?this._points.length-1:null;let i=qe(this._points,this._horzScaleBehavior.key(e),(r,o)=>this._horzScaleBehavior.key(r.time)<o);return this._horzScaleBehavior.key(e)<this._horzScaleBehavior.key(this._points[i].time)?t?i:null:i}isEmpty(){return this._width===0||this._points.length===0||this._baseIndexOrNull===null}hasPoints(){return this._points.length>0}visibleStrictRange(){return this._updateVisibleRange(),this._visibleRange.strictRange()}visibleLogicalRange(){return this._updateVisibleRange(),this._visibleRange.logicalRange()}visibleTimeRange(){let e=this.visibleStrictRange();if(e===null)return null;let t={from:e.left(),to:e.right()};return this.timeRangeForLogicalRange(t)}timeRangeForLogicalRange(e){let t=Math.round(e.from),i=Math.round(e.to),r=C(this._firstIndex()),o=C(this._lastIndex());return{from:C(this.indexToTimeScalePoint(Math.max(r,t))),to:C(this.indexToTimeScalePoint(Math.min(o,i)))}}logicalRangeForTimeRange(e){return{from:C(this.timeToIndex(e.from,!0)),to:C(this.timeToIndex(e.to,!0))}}width(){return this._width}setWidth(e){if(!isFinite(e)||e<=0||this._width===e)return;let t=this.visibleLogicalRange(),i=this._width;if(this._width=e,this._visibleRangeInvalidated=!0,this._options.lockVisibleTimeRangeOnResize&&i!==0){let r=this._barSpacing*e/i;this._barSpacing=r}if(this._options.fixLeftEdge&&t!==null&&t.left()<=0){let r=i-e;this._rightOffset-=Math.round(r/this._barSpacing)+1,this._visibleRangeInvalidated=!0}this._correctBarSpacing(),this._correctOffset()}indexToCoordinate(e){if(this.isEmpty()||!pt(e))return 0;let i=this.baseIndex()+this._rightOffset-e;return this._width-(i+.5)*this._barSpacing-1}indexesToCoordinates(e,t){let i=this.baseIndex(),r=t===void 0?0:t.from,o=t===void 0?e.length:t.to;for(let n=r;n<o;n++){let a=e[n].time,l=i+this._rightOffset-a,d=this._width-(l+.5)*this._barSpacing-1;e[n].x=d}}coordinateToIndex(e){return Math.ceil(this._coordinateToFloatIndex(e))}setRightOffset(e){this._visibleRangeInvalidated=!0,this._rightOffset=e,this._correctOffset(),this._model.recalculateAllPanes(),this._model.lightUpdate()}barSpacing(){return this._barSpacing}setBarSpacing(e){this._setBarSpacing(e),this._correctOffset(),this._model.recalculateAllPanes(),this._model.lightUpdate()}rightOffset(){return this._rightOffset}marks(){if(this.isEmpty())return null;if(this._timeMarksCache!==null)return this._timeMarksCache;let e=this._barSpacing,o=(this._model.options().layout.fontSize+4)*5/th*(this._options.tickMarkMaxCharacterLength||th),n=Math.round(o/e),a=C(this.visibleStrictRange()),l=Math.max(a.left(),a.left()-n),d=Math.max(a.right(),a.right()-n),u=this._tickMarks.build(e,o),_=this._firstIndex()+n,f=this._lastIndex()-n,m=this._isAllScalingAndScrollingDisabled(),g=this._options.fixLeftEdge||m,b=this._options.fixRightEdge||m,S=0;for(let v of u){if(!(l<=v.index&&v.index<=d))continue;let x;S<this._labels.length?(x=this._labels[S],x.coord=this.indexToCoordinate(v.index),x.label=this._formatLabel(v),x.weight=v.weight):(x={needAlignCoordinate:!1,coord:this.indexToCoordinate(v.index),label:this._formatLabel(v),weight:v.weight},this._labels.push(x)),this._barSpacing>o/2&&!m?x.needAlignCoordinate=!1:x.needAlignCoordinate=g&&v.index<=_||b&&v.index>=f,S++}return this._labels.length=S,this._timeMarksCache=this._labels,this._labels}restoreDefault(){this._visibleRangeInvalidated=!0,this.setBarSpacing(this._options.barSpacing),this.setRightOffset(this._options.rightOffset)}setBaseIndex(e){this._visibleRangeInvalidated=!0,this._baseIndexOrNull=e,this._correctOffset(),this._doFixLeftEdge()}zoom(e,t){let i=this._coordinateToFloatIndex(e),r=this.barSpacing(),o=r+t*(r/10);this.setBarSpacing(o),this._options.rightBarStaysOnScroll||this.setRightOffset(this.rightOffset()+(i-this._coordinateToFloatIndex(e)))}startScale(e){this._scrollStartPoint&&this.endScroll(),!(this._scaleStartPoint!==null||this._commonTransitionStartState!==null)&&(this.isEmpty()||(this._scaleStartPoint=e,this._saveCommonTransitionsStartState()))}scaleTo(e){if(this._commonTransitionStartState===null)return;let t=Oi(this._width-e,0,this._width),i=Oi(this._width-C(this._scaleStartPoint),0,this._width);t===0||i===0||this.setBarSpacing(this._commonTransitionStartState.barSpacing*t/i)}endScale(){this._scaleStartPoint!==null&&(this._scaleStartPoint=null,this._clearCommonTransitionsStartState())}startScroll(e){this._scrollStartPoint!==null||this._commonTransitionStartState!==null||this.isEmpty()||(this._scrollStartPoint=e,this._saveCommonTransitionsStartState())}scrollTo(e){if(this._scrollStartPoint===null)return;let t=(this._scrollStartPoint-e)/this.barSpacing();this._rightOffset=C(this._commonTransitionStartState).rightOffset+t,this._visibleRangeInvalidated=!0,this._correctOffset()}endScroll(){this._scrollStartPoint!==null&&(this._scrollStartPoint=null,this._clearCommonTransitionsStartState())}scrollToRealTime(){this.scrollToOffsetAnimated(this._options.rightOffset)}scrollToOffsetAnimated(e,t=400){if(!isFinite(e))throw new RangeError("offset is required and must be finite number");if(!isFinite(t)||t<=0)throw new RangeError("animationDuration (optional) must be finite positive number");let i=this._rightOffset,r=performance.now();this._model.setTimeScaleAnimation({finished:o=>(o-r)/t>=1,getPosition:o=>{let n=(o-r)/t;return n>=1?e:i+(e-i)*n}})}update(e,t){this._visibleRangeInvalidated=!0,this._points=e,this._tickMarks.setTimeScalePoints(e,t),this._correctOffset()}visibleBarsChanged(){return this._visibleBarsChanged}logicalRangeChanged(){return this._logicalRangeChanged}optionsApplied(){return this._optionsApplied}baseIndex(){return this._baseIndexOrNull||0}setVisibleRange(e){let t=e.count();this._setBarSpacing(this._width/t),this._rightOffset=e.right()-this.baseIndex(),this._correctOffset(),this._visibleRangeInvalidated=!0,this._model.recalculateAllPanes(),this._model.lightUpdate()}fitContent(){let e=this._firstIndex(),t=this._lastIndex();e===null||t===null||this.setVisibleRange(new Ke(e,t+this._options.rightOffset))}setLogicalRange(e){let t=new Ke(e.from,e.to);this.setVisibleRange(t)}formatDateTime(e){return this._localizationOptions.timeFormatter!==void 0?this._localizationOptions.timeFormatter(e.originalTime):this._horzScaleBehavior.formatHorzItem(e.time)}_isAllScalingAndScrollingDisabled(){let{handleScroll:e,handleScale:t}=this._model.options();return!e.horzTouchDrag&&!e.mouseWheel&&!e.pressedMouseMove&&!e.vertTouchDrag&&!t.axisDoubleClickReset.time&&!t.axisPressedMouseMove.time&&!t.mouseWheel&&!t.pinch}_firstIndex(){return this._points.length===0?null:0}_lastIndex(){return this._points.length===0?null:this._points.length-1}_rightOffsetForCoordinate(e){return(this._width-1-e)/this._barSpacing}_coordinateToFloatIndex(e){let t=this._rightOffsetForCoordinate(e),r=this.baseIndex()+this._rightOffset-t;return Math.round(r*1e6)/1e6}_setBarSpacing(e){let t=this._barSpacing;this._barSpacing=e,this._correctBarSpacing(),t!==this._barSpacing&&(this._visibleRangeInvalidated=!0,this._resetTimeMarksCache())}_updateVisibleRange(){if(!this._visibleRangeInvalidated)return;if(this._visibleRangeInvalidated=!1,this.isEmpty()){this._setVisibleRange(Qe.invalid());return}let e=this.baseIndex(),t=this._width/this._barSpacing,i=this._rightOffset+e,r=i-t+1,o=new Ke(r,i);this._setVisibleRange(new Qe(o))}_correctBarSpacing(){let e=this._minBarSpacing();if(this._barSpacing<e&&(this._barSpacing=e,this._visibleRangeInvalidated=!0),this._width!==0){let t=this._width*.5;this._barSpacing>t&&(this._barSpacing=t,this._visibleRangeInvalidated=!0)}}_minBarSpacing(){return this._options.fixLeftEdge&&this._options.fixRightEdge&&this._points.length!==0?this._width/this._points.length:this._options.minBarSpacing}_correctOffset(){let e=this._maxRightOffset();this._rightOffset>e&&(this._rightOffset=e,this._visibleRangeInvalidated=!0);let t=this._minRightOffset();t!==null&&this._rightOffset<t&&(this._rightOffset=t,this._visibleRangeInvalidated=!0)}_minRightOffset(){let e=this._firstIndex(),t=this._baseIndexOrNull;if(e===null||t===null)return null;let i=this._options.fixLeftEdge?this._width/this._barSpacing:Math.min(2,this._points.length);return e-t-1+i}_maxRightOffset(){return this._options.fixRightEdge?0:this._width/this._barSpacing-Math.min(2,this._points.length)}_saveCommonTransitionsStartState(){this._commonTransitionStartState={barSpacing:this.barSpacing(),rightOffset:this.rightOffset()}}_clearCommonTransitionsStartState(){this._commonTransitionStartState=null}_formatLabel(e){let t=this._formattedByWeight.get(e.weight);return t===void 0&&(t=new Ur(i=>this._formatLabelImpl(i),this._horzScaleBehavior),this._formattedByWeight.set(e.weight,t)),t.format(e)}_formatLabelImpl(e){return this._horzScaleBehavior.formatTickmark(e,this._localizationOptions)}_setVisibleRange(e){let t=this._visibleRange;this._visibleRange=e,vn(t.strictRange(),this._visibleRange.strictRange())||this._visibleBarsChanged.fire(),vn(t.logicalRange(),this._visibleRange.logicalRange())||this._logicalRangeChanged.fire(),this._resetTimeMarksCache()}_resetTimeMarksCache(){this._timeMarksCache=null}_invalidateTickMarks(){this._resetTimeMarksCache(),this._formattedByWeight.clear()}_updateDateTimeFormatter(){this._horzScaleBehavior.updateFormatter(this._localizationOptions)}_doFixLeftEdge(){if(!this._options.fixLeftEdge)return;let e=this._firstIndex();if(e===null)return;let t=this.visibleStrictRange();if(t===null)return;let i=t.left()-e;if(i<0){let r=this._rightOffset-i-1;this.setRightOffset(r)}this._correctBarSpacing()}_doFixRightEdge(){this._correctOffset(),this._correctBarSpacing()}};c();h();c();h();c();h();c();h();var Xr=class{draw(e,t,i){e.useMediaCoordinateSpace(r=>this._drawImpl(r,t,i))}drawBackground(e,t,i){e.useMediaCoordinateSpace(r=>this._drawBackgroundImpl(r,t,i))}_drawBackgroundImpl(e,t,i){}};var jr=class extends Xr{constructor(e){super(),this._metricsCache=new Map,this._data=e}_drawImpl(e){}_drawBackgroundImpl(e){if(!this._data.visible)return;let{context:t,mediaSize:i}=e,r=0;for(let n of this._data.lines){if(n.text.length===0)continue;t.font=n.font;let a=this._metrics(t,n.text);a>i.width?n.zoom=i.width/a:n.zoom=1,r+=n.lineHeight*n.zoom}let o=0;switch(this._data.vertAlign){case"top":o=0;break;case"center":o=Math.max((i.height-r)/2,0);break;case"bottom":o=Math.max(i.height-r,0);break}t.fillStyle=this._data.color;for(let n of this._data.lines){t.save();let a=0;switch(this._data.horzAlign){case"left":t.textAlign="left",a=n.lineHeight/2;break;case"center":t.textAlign="center",a=i.width/2;break;case"right":t.textAlign="right",a=i.width-1-n.lineHeight/2;break}t.translate(a,o),t.textBaseline="top",t.font=n.font,t.scale(n.zoom,n.zoom),t.fillText(n.text,0,n.vertOffset),t.restore(),o+=n.lineHeight*n.zoom}}_metrics(e,t){let i=this._fontCache(e.font),r=i.get(t);return r===void 0&&(r=e.measureText(t).width,i.set(t,r)),r}_fontCache(e){let t=this._metricsCache.get(e);return t===void 0&&(t=new Map,this._metricsCache.set(e,t)),t}};var Gr=class{constructor(e){this._invalidated=!0,this._rendererData={visible:!1,color:"",lines:[],vertAlign:"center",horzAlign:"center"},this._renderer=new jr(this._rendererData),this._source=e}update(){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer}_updateImpl(){let e=this._source.options(),t=this._rendererData;t.visible=e.visible,t.visible&&(t.color=e.color,t.horzAlign=e.horzAlign,t.vertAlign=e.vertAlign,t.lines=[{text:e.text,font:Se(e.fontSize,e.fontFamily,e.fontStyle),lineHeight:e.fontSize*1.2,vertOffset:0,zoom:0}])}};var qr=class extends St{constructor(e,t){super(),this._options=t,this._paneView=new Gr(this)}priceAxisViews(){return[]}paneViews(){return[this._paneView]}options(){return this._options}updateAllViews(){this._paneView.update()}};var rh;(function(s){s[s.Top=0]="Top",s[s.Bottom=1]="Bottom"})(rh||(rh={}));var oh;(function(s){s[s.Left=0]="Left",s[s.Middle=1]="Middle",s[s.Right=2]="Right",s[s.Fourth=3]="Fourth",s[s.Fifth=4]="Fifth"})(oh||(oh={}));var Sn;(function(s){s[s.OnTouchEnd=0]="OnTouchEnd",s[s.OnNextTap=1]="OnNextTap"})(Sn||(Sn={}));var Zr=class{constructor(e,t,i){this._panes=[],this._serieses=[],this._width=0,this._hoveredSource=null,this._priceScalesOptionsChanged=new L,this._crosshairMoved=new L,this._gradientColorsCache=null,this._invalidateHandler=e,this._options=t,this._horzScaleBehavior=i,this._rendererOptionsProvider=new Xs(this),this._timeScale=new $r(this,t.timeScale,this._options.localization,i),this._crosshair=new er(this,t.crosshair),this._magnet=new Or(t.crosshair),this._watermark=new qr(this,t.watermark),this.createPane(),this._panes[0].setStretchFactor(bn*2),this._backgroundTopColor=this._getBackgroundColor(0),this._backgroundBottomColor=this._getBackgroundColor(1)}fullUpdate(){this._invalidate(K.full())}lightUpdate(){this._invalidate(K.light())}cursorUpdate(){this._invalidate(new K(1))}updateSource(e){let t=this._invalidationMaskForSource(e);this._invalidate(t)}hoveredSource(){return this._hoveredSource}setHoveredSource(e){let t=this._hoveredSource;this._hoveredSource=e,t!==null&&this.updateSource(t.source),e!==null&&this.updateSource(e.source)}options(){return this._options}applyOptions(e){B(this._options,e),this._panes.forEach(t=>t.applyScaleOptions(e)),e.timeScale!==void 0&&this._timeScale.applyOptions(e.timeScale),e.localization!==void 0&&this._timeScale.applyLocalizationOptions(e.localization),(e.leftPriceScale||e.rightPriceScale)&&this._priceScalesOptionsChanged.fire(),this._backgroundTopColor=this._getBackgroundColor(0),this._backgroundBottomColor=this._getBackgroundColor(1),this.fullUpdate()}applyPriceScaleOptions(e,t){if(e==="left"){this.applyOptions({leftPriceScale:t});return}else if(e==="right"){this.applyOptions({rightPriceScale:t});return}let i=this.findPriceScale(e);i!==null&&(i.priceScale.applyOptions(t),this._priceScalesOptionsChanged.fire())}findPriceScale(e){for(let t of this._panes){let i=t.priceScaleById(e);if(i!==null)return{pane:t,priceScale:i}}return null}timeScale(){return this._timeScale}panes(){return this._panes}watermarkSource(){return this._watermark}crosshairSource(){return this._crosshair}crosshairMoved(){return this._crosshairMoved}setPaneHeight(e,t){e.setHeight(t),this.recalculateAllPanes()}setWidth(e){this._width=e,this._timeScale.setWidth(this._width),this._panes.forEach(t=>t.setWidth(e)),this.recalculateAllPanes()}createPane(e){let t=new Hr(this._timeScale,this);e!==void 0?this._panes.splice(e,0,t):this._panes.push(t);let i=e===void 0?this._panes.length-1:e,r=K.full();return r.invalidatePane(i,{level:0,autoScale:!0}),this._invalidate(r),t}startScalePrice(e,t,i){e.startScalePrice(t,i)}scalePriceTo(e,t,i){e.scalePriceTo(t,i),this.updateCrosshair(),this._invalidate(this._paneInvalidationMask(e,2))}endScalePrice(e,t){e.endScalePrice(t),this._invalidate(this._paneInvalidationMask(e,2))}startScrollPrice(e,t,i){t.isAutoScale()||e.startScrollPrice(t,i)}scrollPriceTo(e,t,i){t.isAutoScale()||(e.scrollPriceTo(t,i),this.updateCrosshair(),this._invalidate(this._paneInvalidationMask(e,2)))}endScrollPrice(e,t){t.isAutoScale()||(e.endScrollPrice(t),this._invalidate(this._paneInvalidationMask(e,2)))}resetPriceScale(e,t){e.resetPriceScale(t),this._invalidate(this._paneInvalidationMask(e,2))}startScaleTime(e){this._timeScale.startScale(e)}zoomTime(e,t){let i=this.timeScale();if(i.isEmpty()||t===0)return;let r=i.width();e=Math.max(1,Math.min(e,r)),i.zoom(e,t),this.recalculateAllPanes()}scrollChart(e){this.startScrollTime(0),this.scrollTimeTo(e),this.endScrollTime()}scaleTimeTo(e){this._timeScale.scaleTo(e),this.recalculateAllPanes()}endScaleTime(){this._timeScale.endScale(),this.lightUpdate()}startScrollTime(e){this._timeScale.startScroll(e)}scrollTimeTo(e){this._timeScale.scrollTo(e),this.recalculateAllPanes()}endScrollTime(){this._timeScale.endScroll(),this.lightUpdate()}serieses(){return this._serieses}setAndSaveCurrentPosition(e,t,i,r,o){this._crosshair.saveOriginCoord(e,t);let n=NaN,a=this._timeScale.coordinateToIndex(e),l=this._timeScale.visibleStrictRange();l!==null&&(a=Math.min(Math.max(l.left(),a),l.right()));let d=r.defaultPriceScale(),u=d.firstValue();u!==null&&(n=d.coordinateToPrice(t,u)),n=this._magnet.align(n,a,r),this._crosshair.setPosition(a,n,r),this.cursorUpdate(),o||this._crosshairMoved.fire(this._crosshair.appliedIndex(),{x:e,y:t},i)}setAndSaveSyntheticPosition(e,t,i){let r=i.defaultPriceScale(),o=r.firstValue(),n=r.priceToCoordinate(e,C(o)),a=this._timeScale.timeToIndex(t,!0),l=this._timeScale.indexToCoordinate(C(a));this.setAndSaveCurrentPosition(l,n,null,i,!0)}clearCurrentPosition(e){this.crosshairSource().clearPosition(),this.cursorUpdate(),e||this._crosshairMoved.fire(null,null,null)}updateCrosshair(){let e=this._crosshair.pane();if(e!==null){let t=this._crosshair.originCoordX(),i=this._crosshair.originCoordY();this.setAndSaveCurrentPosition(t,i,null,e)}this._crosshair.updateAllViews()}updateTimeScale(e,t,i){let r=this._timeScale.indexToTime(0);t!==void 0&&i!==void 0&&this._timeScale.update(t,i);let o=this._timeScale.indexToTime(0),n=this._timeScale.baseIndex(),a=this._timeScale.visibleStrictRange();if(a!==null&&r!==null&&o!==null){let l=a.contains(n),d=this._horzScaleBehavior.key(r)>this._horzScaleBehavior.key(o),_=e!==null&&e>n&&!d,f=this._timeScale.options().allowShiftVisibleRangeOnWhitespaceReplacement,g=l&&(!(i===void 0)||f)&&this._timeScale.options().shiftVisibleRangeOnNewBar;if(_&&!g){let b=e-n;this._timeScale.setRightOffset(this._timeScale.rightOffset()-b)}}this._timeScale.setBaseIndex(e)}recalculatePane(e){e!==null&&e.recalculate()}paneForSource(e){let t=this._panes.find(i=>i.orderedSources().includes(e));return t===void 0?null:t}recalculateAllPanes(){this._watermark.updateAllViews(),this._panes.forEach(e=>e.recalculate()),this.updateCrosshair()}destroy(){this._panes.forEach(e=>e.destroy()),this._panes.length=0,this._options.localization.priceFormatter=void 0,this._options.localization.percentageFormatter=void 0,this._options.localization.timeFormatter=void 0}rendererOptionsProvider(){return this._rendererOptionsProvider}priceAxisRendererOptions(){return this._rendererOptionsProvider.options()}priceScalesOptionsChanged(){return this._priceScalesOptionsChanged}createSeries(e,t,i){let r=this._panes[0],o=this._createSeries(t,e,r,i);return this._serieses.push(o),this._serieses.length===1?this.fullUpdate():this.lightUpdate(),o}removeSeries(e){let t=this.paneForSource(e),i=this._serieses.indexOf(e);ne(i!==-1,"Series not found"),this._serieses.splice(i,1),C(t).removeDataSource(e),e.destroy&&e.destroy()}moveSeriesToScale(e,t){let i=C(this.paneForSource(e));i.removeDataSource(e);let r=this.findPriceScale(t);if(r===null){let o=e.zorder();i.addDataSource(e,t,o)}else{let o=r.pane===i?e.zorder():void 0;r.pane.addDataSource(e,t,o)}}fitContent(){let e=K.light();e.setFitContent(),this._invalidate(e)}setTargetLogicalRange(e){let t=K.light();t.applyRange(e),this._invalidate(t)}resetTimeScale(){let e=K.light();e.resetTimeScale(),this._invalidate(e)}setBarSpacing(e){let t=K.light();t.setBarSpacing(e),this._invalidate(t)}setRightOffset(e){let t=K.light();t.setRightOffset(e),this._invalidate(t)}setTimeScaleAnimation(e){let t=K.light();t.setTimeScaleAnimation(e),this._invalidate(t)}stopTimeScaleAnimation(){let e=K.light();e.stopTimeScaleAnimation(),this._invalidate(e)}defaultVisiblePriceScaleId(){return this._options.rightPriceScale.visible?"right":"left"}backgroundBottomColor(){return this._backgroundBottomColor}backgroundTopColor(){return this._backgroundTopColor}backgroundColorAtYPercentFromTop(e){let t=this._backgroundBottomColor,i=this._backgroundTopColor;if(t===i)return t;if(e=Math.max(0,Math.min(100,Math.round(e*100))),this._gradientColorsCache===null||this._gradientColorsCache.topColor!==i||this._gradientColorsCache.bottomColor!==t)this._gradientColorsCache={topColor:i,bottomColor:t,colors:new Map};else{let o=this._gradientColorsCache.colors.get(e);if(o!==void 0)return o}let r=_c(i,t,e/100);return this._gradientColorsCache.colors.set(e,r),r}_paneInvalidationMask(e,t){let i=new K(t);if(e!==null){let r=this._panes.indexOf(e);i.invalidatePane(r,{level:t})}return i}_invalidationMaskForSource(e,t){return t===void 0&&(t=2),this._paneInvalidationMask(this.paneForSource(e),t)}_invalidate(e){this._invalidateHandler&&this._invalidateHandler(e),this._panes.forEach(t=>t.grid().paneView().update())}_createSeries(e,t,i,r){let o=new Pt(this,e,t,i,r),n=e.priceScaleId!==void 0?e.priceScaleId:this.defaultVisiblePriceScaleId();return i.addDataSource(o,n),Ct(n)||o.applyOptions(e),o}_getBackgroundColor(e){let t=this._options.layout;return t.background.type==="gradient"?e===0?t.background.topColor:t.background.bottomColor:t.background.color}};c();h();function ah(s){s.borderColor!==void 0&&(s.borderUpColor=s.borderColor,s.borderDownColor=s.borderColor),s.wickColor!==void 0&&(s.wickUpColor=s.wickColor,s.wickDownColor=s.wickColor)}var Cn;(function(s){s[s.Disabled=0]="Disabled",s[s.Continuous=1]="Continuous",s[s.OnDataUpdate=2]="OnDataUpdate"})(Cn||(Cn={}));function lh(s){if(s>=1)return 0;let e=0;for(;e<8;e++){let t=Math.round(s);if(Math.abs(t-s)<1e-8)return e;s=s*10}return e}var nh;(function(s){s[s.LastPriceAndPercentageValue=0]="LastPriceAndPercentageValue",s[s.LastValueAccordingToScale=1]="LastValueAccordingToScale"})(nh||(nh={}));var xn;(function(s){s[s.LastBar=0]="LastBar",s[s.LastVisible=1]="LastVisible"})(xn||(xn={}));c();h();var wn;(function(s){s.Solid="solid",s.VerticalGradient="gradient"})(wn||(wn={}));c();h();function Hi(s){return!ae(s)&&!ft(s)}function Kr(s){return ae(s)}var yn;(function(s){s[s.Year=0]="Year",s[s.Month=1]="Month",s[s.DayOfMonth=2]="DayOfMonth",s[s.Time=3]="Time",s[s.TimeWithSeconds=4]="TimeWithSeconds"})(yn||(yn={}));var ch;(function(s){s[s.LessThanSecond=0]="LessThanSecond",s[s.Second=10]="Second",s[s.Minute1=20]="Minute1",s[s.Minute5=21]="Minute5",s[s.Minute30=22]="Minute30",s[s.Hour1=30]="Hour1",s[s.Hour3=31]="Hour3",s[s.Hour6=32]="Hour6",s[s.Hour12=33]="Hour12",s[s.Day=50]="Day",s[s.Month=60]="Month",s[s.Year=70]="Year"})(ch||(ch={}));c();h();c();h();c();h();c();h();var zu=s=>s.getUTCMonth()+1,Nu=s=>s.getUTCDate(),hh=s=>s.getUTCFullYear(),Wu=s=>Ee(Nu(s),2),Fu=(s,e)=>new Date(s.getUTCFullYear(),s.getUTCMonth(),1).toLocaleString(e,{month:"long"}),Hu=(s,e)=>new Date(s.getUTCFullYear(),s.getUTCMonth(),1).toLocaleString(e,{month:"short"}),Uu=s=>Ee(zu(s),2),Yu=s=>Ee(hh(s)%100,2),$u=s=>Ee(hh(s),4);function dh(s,e,t){return e.replace(/yyyy/g,$u(s)).replace(/yy/g,Yu(s)).replace(/MMMM/g,Fu(s,t)).replace(/MMM/g,Hu(s,t)).replace(/MM/g,Uu(s)).replace(/dd/g,Wu(s))}var _i=class{constructor(e="yyyy-MM-dd",t="default"){this._dateFormat=e,this._locale=t}format(e){return dh(e,this._dateFormat,this._locale)}};c();h();c();h();var Qr=class{constructor(e){this._formatStr=e||"%h:%m:%s"}format(e){return this._formatStr.replace("%h",Ee(e.getUTCHours(),2)).replace("%m",Ee(e.getUTCMinutes(),2)).replace("%s",Ee(e.getUTCSeconds(),2))}};var Xu={dateFormat:"yyyy-MM-dd",timeFormat:"%h:%m:%s",dateTimeSeparator:" ",locale:"default"},Jr=class{constructor(e={}){let t=Object.assign(Object.assign({},Xu),e);this._dateFormatter=new _i(t.dateFormat,t.locale),this._timeFormatter=new Qr(t.timeFormat),this._separator=t.dateTimeSeparator}format(e){return`${this._dateFormatter.format(e)}${this._separator}${this._timeFormatter.format(e)}`}};c();h();function uh(s,e,t){let i={};switch(e){case 0:i.year="numeric";break;case 1:i.month="short";break;case 2:i.day="numeric";break;case 3:i.hour12=!1,i.hour="2-digit",i.minute="2-digit";break;case 4:i.hour12=!1,i.hour="2-digit",i.minute="2-digit",i.second="2-digit";break;default:}let r=s.businessDay===void 0?new Date(s.timestamp*1e3):new Date(Date.UTC(s.businessDay.year,s.businessDay.month-1,s.businessDay.day));return new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds(),r.getUTCMilliseconds()).toLocaleString(t,i)}c();h();function eo(s){return s*60*60*1e3}function Tn(s){return s*60*1e3}function ju(s){return s*1e3}var to=[{divisor:ju(1),weight:10},{divisor:Tn(1),weight:20},{divisor:Tn(5),weight:21},{divisor:Tn(30),weight:22},{divisor:eo(1),weight:30},{divisor:eo(3),weight:31},{divisor:eo(6),weight:32},{divisor:eo(12),weight:33}];function _h(s,e){if(s.getUTCFullYear()!==e.getUTCFullYear())return 70;if(s.getUTCMonth()!==e.getUTCMonth())return 60;if(s.getUTCDate()!==e.getUTCDate())return 50;for(let t=to.length-1;t>=0;--t)if(Math.floor(e.getTime()/to[t].divisor)!==Math.floor(s.getTime()/to[t].divisor))return to[t].weight;return 0}function mh(s,e=0){if(s.length===0)return;let t=e===0?null:s[e-1].time.timestamp,i=t!==null?new Date(t*1e3):null,r=0;for(let o=e;o<s.length;++o){let n=s[o],a=new Date(n.time.timestamp*1e3);i!==null&&(n.timeWeight=_h(a,i)),r+=n.time.timestamp-(t||n.time.timestamp),t=n.time.timestamp,i=a}if(e===0&&s.length>1){let o=Math.ceil(r/(s.length-1)),n=new Date((s[0].time.timestamp-o)*1e3);s[0].timeWeight=_h(new Date(s[0].time.timestamp*1e3),n)}}function kn(s){let e=s;if(ft(s)&&(e=Pn(s)),!Hi(e))throw new Error("time must be of type BusinessDay");let t=new Date(Date.UTC(e.year,e.month-1,e.day,0,0,0,0));return{timestamp:Math.round(t.getTime()/1e3),businessDay:e}}function ph(s){if(!Kr(s))throw new Error("time must be of type isUTCTimestamp");return{timestamp:s}}function Gu(s){return s.length===0?null:Hi(s[0].time)||ft(s[0].time)?kn:ph}function qu(s){return Kr(s)?ph(s):Hi(s)?kn(s):kn(Pn(s))}function Pn(s){let e=new Date(s);if(isNaN(e.getTime()))throw new Error(`Invalid date string=${s}, expected format=yyyy-mm-dd`);return{day:e.getUTCDate(),month:e.getUTCMonth()+1,year:e.getUTCFullYear()}}function fh(s){ft(s.time)&&(s.time=Pn(s.time))}function Zu(s){return s.forEach(fh)}function Ku(s,e,t){switch(s){case 0:case 10:return e?t?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return e?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}var Ui=class{options(){return this._options}setOptions(e){this._options=e,this.updateFormatter(e.localization)}preprocessData(e){Array.isArray(e)?Zu(e):fh(e)}createConverterToInternalObj(e){return C(Gu(e))}key(e){return typeof e=="object"&&"timestamp"in e?e.timestamp:this.key(this.convertHorzItemToInternal(e))}cacheKey(e){let t=e;return t.businessDay===void 0?new Date(t.timestamp*1e3).getTime():new Date(Date.UTC(t.businessDay.year,t.businessDay.month-1,t.businessDay.day)).getTime()}convertHorzItemToInternal(e){return qu(e)}updateFormatter(e){if(!this._options)return;let t=e.dateFormat;this._options.timeScale.timeVisible?this._dateTimeFormatter=new Jr({dateFormat:t,timeFormat:this._options.timeScale.secondsVisible?"%h:%m:%s":"%h:%m",dateTimeSeparator:"   ",locale:e.locale}):this._dateTimeFormatter=new _i(t,e.locale)}formatHorzItem(e){let t=e;return this._dateTimeFormatter.format(new Date(t.timestamp*1e3))}formatTickmark(e,t){let i=Ku(e.weight,this._options.timeScale.timeVisible,this._options.timeScale.secondsVisible),r=this._options.timeScale;if(r.tickMarkFormatter!==void 0){let o=r.tickMarkFormatter(e.originalTime,i,t.locale);if(o!==null)return o}return uh(e.time,i,t.locale)}maxTickMarkWeight(e){let t=e.reduce(sh,e[0]).weight;return t>30&&t<50&&(t=30),t}fillWeightsForPoints(e,t){mh(e,t)}static applyDefaults(e){return B({localization:{dateFormat:"dd MMM 'yy"}},e??{})}};c();h();c();h();c();h();c();h();var Mn=`
	position:absolute;display:none;padding:12px;box-sizing:border-box;
	font-size:14px;text-align:left;z-index:10;top:12px;left:12px;
	pointer-events:none;border:1px solid#EBEBEB;border-radius:4px;
	background-color:#FFFFFF;
	box-shadow:0px 10px 15px-3px rgba(0,0,0,0.1),0px 4px 6px-2px rgba(0,0,0,0.05);
`;function Yi(s,e){if(!s||!s.renderContent||!e)return null;let{style:t}=s,i=document.createElement("div");return i.style=`
		${Mn}
		${t||""}
	`,e.style.position="relative",e.appendChild(i),i}function $i(s,e,t,i,r){if(!s||!e||!t)return;let o,n,a=15;Xi(s,t),s.style.display="block";let l=s.clientWidth,d=s.clientHeight;o=i.x+a+r,o>e.clientWidth-l&&(o=i.x-a-l+r),n=i.y+a,n>e.clientHeight-d&&(n=i.y-d-a),s.style.left=`${o}px`,s.style.top=`${n}px`}function Xi(s,e){let i=new DOMParser().parseFromString(e,"text/html").body.firstElementChild;for(;s.firstChild;)s.removeChild(s.firstChild);i&&s.appendChild(i)}c();h();var pM=Math.PI/180;c();h();c();h();c();h();c();h();function O(s){var e=s.width,t=s.height;if(e<0)throw new Error("Negative width is not allowed for Size");if(t<0)throw new Error("Negative height is not allowed for Size");return{width:e,height:t}}function Ce(s,e){return s.width===e.width&&s.height===e.height}c();h();c();h();var t_=function(){function s(e){var t=this;this._resolutionListener=function(){return t._onResolutionChanged()},this._resolutionMediaQueryList=null,this._observers=[],this._window=e,this._installResolutionListener()}return s.prototype.dispose=function(){this._uninstallResolutionListener(),this._window=null},Object.defineProperty(s.prototype,"value",{get:function(){return this._window.devicePixelRatio},enumerable:!1,configurable:!0}),s.prototype.subscribe=function(e){var t=this,i={next:e};return this._observers.push(i),{unsubscribe:function(){t._observers=t._observers.filter(function(r){return r!==i})}}},s.prototype._installResolutionListener=function(){if(this._resolutionMediaQueryList!==null)throw new Error("Resolution listener is already installed");var e=this._window.devicePixelRatio;this._resolutionMediaQueryList=this._window.matchMedia("all and (resolution: ".concat(e,"dppx)")),this._resolutionMediaQueryList.addListener(this._resolutionListener)},s.prototype._uninstallResolutionListener=function(){this._resolutionMediaQueryList!==null&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},s.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},s.prototype._onResolutionChanged=function(){var e=this;this._observers.forEach(function(t){return t.next(e._window.devicePixelRatio)}),this._reinstallResolutionListener()},s}();function gh(s){return new t_(s)}var i_=function(){function s(e,t,i){var r;this._canvasElement=null,this._bitmapSizeChangedListeners=[],this._suggestedBitmapSize=null,this._suggestedBitmapSizeChangedListeners=[],this._devicePixelRatioObservable=null,this._canvasElementResizeObserver=null,this._canvasElement=e,this._canvasElementClientSize=O({width:this._canvasElement.clientWidth,height:this._canvasElement.clientHeight}),this._transformBitmapSize=t??function(o){return o},this._allowResizeObserver=(r=i?.allowResizeObserver)!==null&&r!==void 0?r:!0,this._chooseAndInitObserver()}return s.prototype.dispose=function(){var e,t;if(this._canvasElement===null)throw new Error("Object is disposed");(e=this._canvasElementResizeObserver)===null||e===void 0||e.disconnect(),this._canvasElementResizeObserver=null,(t=this._devicePixelRatioObservable)===null||t===void 0||t.dispose(),this._devicePixelRatioObservable=null,this._suggestedBitmapSizeChangedListeners.length=0,this._bitmapSizeChangedListeners.length=0,this._canvasElement=null},Object.defineProperty(s.prototype,"canvasElement",{get:function(){if(this._canvasElement===null)throw new Error("Object is disposed");return this._canvasElement},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"canvasElementClientSize",{get:function(){return this._canvasElementClientSize},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"bitmapSize",{get:function(){return O({width:this.canvasElement.width,height:this.canvasElement.height})},enumerable:!1,configurable:!0}),s.prototype.resizeCanvasElement=function(e){this._canvasElementClientSize=O(e),this.canvasElement.style.width="".concat(this._canvasElementClientSize.width,"px"),this.canvasElement.style.height="".concat(this._canvasElementClientSize.height,"px"),this._invalidateBitmapSize()},s.prototype.subscribeBitmapSizeChanged=function(e){this._bitmapSizeChangedListeners.push(e)},s.prototype.unsubscribeBitmapSizeChanged=function(e){this._bitmapSizeChangedListeners=this._bitmapSizeChangedListeners.filter(function(t){return t!==e})},Object.defineProperty(s.prototype,"suggestedBitmapSize",{get:function(){return this._suggestedBitmapSize},enumerable:!1,configurable:!0}),s.prototype.subscribeSuggestedBitmapSizeChanged=function(e){this._suggestedBitmapSizeChangedListeners.push(e)},s.prototype.unsubscribeSuggestedBitmapSizeChanged=function(e){this._suggestedBitmapSizeChangedListeners=this._suggestedBitmapSizeChangedListeners.filter(function(t){return t!==e})},s.prototype.applySuggestedBitmapSize=function(){if(this._suggestedBitmapSize!==null){var e=this._suggestedBitmapSize;this._suggestedBitmapSize=null,this._resizeBitmap(e),this._emitSuggestedBitmapSizeChanged(e,this._suggestedBitmapSize)}},s.prototype._resizeBitmap=function(e){var t=this.bitmapSize;Ce(t,e)||(this.canvasElement.width=e.width,this.canvasElement.height=e.height,this._emitBitmapSizeChanged(t,e))},s.prototype._emitBitmapSizeChanged=function(e,t){var i=this;this._bitmapSizeChangedListeners.forEach(function(r){return r.call(i,e,t)})},s.prototype._suggestNewBitmapSize=function(e){var t=this._suggestedBitmapSize,i=O(this._transformBitmapSize(e,this._canvasElementClientSize)),r=Ce(this.bitmapSize,i)?null:i;t===null&&r===null||t!==null&&r!==null&&Ce(t,r)||(this._suggestedBitmapSize=r,this._emitSuggestedBitmapSizeChanged(t,r))},s.prototype._emitSuggestedBitmapSizeChanged=function(e,t){var i=this;this._suggestedBitmapSizeChangedListeners.forEach(function(r){return r.call(i,e,t)})},s.prototype._chooseAndInitObserver=function(){var e=this;if(!this._allowResizeObserver){this._initDevicePixelRatioObservable();return}s_().then(function(t){return t?e._initResizeObserver():e._initDevicePixelRatioObservable()})},s.prototype._initDevicePixelRatioObservable=function(){var e=this;if(this._canvasElement!==null){var t=bh(this._canvasElement);if(t===null)throw new Error("No window is associated with the canvas");this._devicePixelRatioObservable=gh(t),this._devicePixelRatioObservable.subscribe(function(){return e._invalidateBitmapSize()}),this._invalidateBitmapSize()}},s.prototype._invalidateBitmapSize=function(){var e,t;if(this._canvasElement!==null){var i=bh(this._canvasElement);if(i!==null){var r=(t=(e=this._devicePixelRatioObservable)===null||e===void 0?void 0:e.value)!==null&&t!==void 0?t:i.devicePixelRatio,o=this._canvasElement.getClientRects(),n=o[0]!==void 0?r_(o[0],r):O({width:this._canvasElementClientSize.width*r,height:this._canvasElementClientSize.height*r});this._suggestNewBitmapSize(n)}}},s.prototype._initResizeObserver=function(){var e=this;this._canvasElement!==null&&(this._canvasElementResizeObserver=new ResizeObserver(function(t){var i=t.find(function(n){return n.target===e._canvasElement});if(!(!i||!i.devicePixelContentBoxSize||!i.devicePixelContentBoxSize[0])){var r=i.devicePixelContentBoxSize[0],o=O({width:r.inlineSize,height:r.blockSize});e._suggestNewBitmapSize(o)}}),this._canvasElementResizeObserver.observe(this._canvasElement,{box:"device-pixel-content-box"}))},s}();function An(s,e){if(e.type==="device-pixel-content-box")return new i_(s,e.transform,e.options);throw new Error("Unsupported binding target")}function bh(s){return s.ownerDocument.defaultView}function s_(){return new Promise(function(s){var e=new ResizeObserver(function(t){s(t.every(function(i){return"devicePixelContentBoxSize"in i})),e.disconnect()});e.observe(document.body,{box:"device-pixel-content-box"})}).catch(function(){return!1})}function r_(s,e){return O({width:Math.round(s.left*e+s.width*e)-Math.round(s.left*e),height:Math.round(s.top*e+s.height*e)-Math.round(s.top*e)})}c();h();var vh=function(){function s(e,t,i){if(t.width===0||t.height===0)throw new TypeError("Rendering target could only be created on a media with positive width and height");if(this._mediaSize=t,i.width===0||i.height===0)throw new TypeError("Rendering target could only be created using a bitmap with positive integer width and height");this._bitmapSize=i,this._context=e}return s.prototype.useMediaCoordinateSpace=function(e){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),this._context.scale(this._horizontalPixelRatio,this._verticalPixelRatio),e({context:this._context,mediaSize:this._mediaSize})}finally{this._context.restore()}},s.prototype.useBitmapCoordinateSpace=function(e){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),e({context:this._context,mediaSize:this._mediaSize,bitmapSize:this._bitmapSize,horizontalPixelRatio:this._horizontalPixelRatio,verticalPixelRatio:this._verticalPixelRatio})}finally{this._context.restore()}},Object.defineProperty(s.prototype,"_horizontalPixelRatio",{get:function(){return this._bitmapSize.width/this._mediaSize.width},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"_verticalPixelRatio",{get:function(){return this._bitmapSize.height/this._mediaSize.height},enumerable:!1,configurable:!0}),s}();function Pe(s,e){var t=s.canvasElementClientSize;if(t.width===0||t.height===0)return null;var i=s.bitmapSize;if(i.width===0||i.height===0)return null;var r=s.canvasElement.getContext("2d",e);return r===null?null:new vh(r,t,i)}c();h();c();h();var Mt=typeof window<"u";function In(){return Mt?window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1:!1}function io(){return Mt?/iPhone|iPad|iPod/.test(window.navigator.platform):!1}function Sh(){return Mt?window.chrome!==void 0:!1}function Ch(){var s;return Mt?!((s=navigator?.userAgentData)===null||s===void 0)&&s.platform?navigator.userAgentData.platform==="Windows":navigator.userAgent.toLowerCase().indexOf("win")>=0:!1}function xh(){return!Mt||!navigator.userAgentData?!1:navigator.userAgentData.brands.some(s=>s.brand.includes("Chromium"))}c();h();c();h();function wh(s){let e=Math.floor(s.width),t=Math.floor(s.height),i=e-e%2,r=t-t%2;return O({width:i,height:r})}function yh(s){return s+s%2}function ji(s){return s+s%2}c();h();c();h();var Th;(function(s){s[s.MaxStartDelay=50]="MaxStartDelay",s[s.EpsilonDistance=1]="EpsilonDistance"})(Th||(Th={}));function Bn(s,e){return s.position-e.position}function Dn(s,e,t){let i=(s.position-e.position)/(s.time-e.time);return Math.sign(i)*Math.min(Math.abs(i),t)}function o_(s,e){let t=Math.log(e);return Math.log(1*t/-s)/t}var so=class{constructor(e,t,i,r){this._position1=null,this._position2=null,this._position3=null,this._position4=null,this._animationStartPosition=null,this._durationMsecs=0,this._speedPxPerMsec=0,this._minSpeed=e,this._maxSpeed=t,this._dumpingCoeff=i,this._minMove=r}addPosition(e,t){if(this._position1!==null){if(this._position1.time===t){this._position1.position=e;return}if(Math.abs(this._position1.position-e)<this._minMove)return}this._position4=this._position3,this._position3=this._position2,this._position2=this._position1,this._position1={time:t,position:e}}start(e,t){if(this._position1===null||this._position2===null||t-this._position1.time>50)return;let i=0,r=Dn(this._position1,this._position2,this._maxSpeed),o=Bn(this._position1,this._position2),n=[r],a=[o];if(i+=o,this._position3!==null){let d=Dn(this._position2,this._position3,this._maxSpeed);if(Math.sign(d)===Math.sign(r)){let u=Bn(this._position2,this._position3);if(n.push(d),a.push(u),i+=u,this._position4!==null){let _=Dn(this._position3,this._position4,this._maxSpeed);if(Math.sign(_)===Math.sign(r)){let f=Bn(this._position3,this._position4);n.push(_),a.push(f),i+=f}}}}let l=0;for(let d=0;d<n.length;++d)l+=a[d]/i*n[d];Math.abs(l)<this._minSpeed||(this._animationStartPosition={position:e,time:t},this._speedPxPerMsec=l,this._durationMsecs=o_(Math.abs(l),this._dumpingCoeff))}getPosition(e){let t=C(this._animationStartPosition),i=e-t.time;return t.position+this._speedPxPerMsec*(Math.pow(this._dumpingCoeff,i)-1)/Math.log(this._dumpingCoeff)}finished(e){return this._animationStartPosition===null||this._progressDuration(e)===this._durationMsecs}_progressDuration(e){let t=C(this._animationStartPosition),i=e-t.time;return Math.min(i,this._durationMsecs)}};c();h();function Oe(s,e){let i=C(s.ownerDocument).createElement("canvas");s.appendChild(i);let r=An(i,{type:"device-pixel-content-box",options:{allowResizeObserver:!1},transform:(o,n)=>({width:Math.max(o.width,n.width),height:Math.max(o.height,n.height)})});return r.resizeCanvasElement(e),r}function Ve(s){var e;s.width=1,s.height=1,(e=s.getContext("2d"))===null||e===void 0||e.clearRect(0,0,1,1)}c();h();function Gi(s,e,t,i){s.drawBackground&&s.drawBackground(e,t,i)}function mi(s,e,t,i){s.draw(e,t,i)}function qi(s,e,t,i){let r=s(t,i);for(let o of r){let n=o.renderer();n!==null&&e(n)}}c();h();c();h();function kh(s){!Sh()||s.addEventListener("mousedown",e=>{if(e.button===1)return e.preventDefault(),!1})}var Ph;(function(s){s[s.ResetClick=500]="ResetClick",s[s.LongTap=240]="LongTap",s[s.PreventFiresTouchEvents=500]="PreventFiresTouchEvents"})(Ph||(Ph={}));var Mh;(function(s){s[s.CancelClickManhattanDistance=5]="CancelClickManhattanDistance",s[s.CancelTapManhattanDistance=5]="CancelTapManhattanDistance",s[s.DoubleClickManhattanDistance=5]="DoubleClickManhattanDistance",s[s.DoubleTapManhattanDistance=30]="DoubleTapManhattanDistance"})(Mh||(Mh={}));var At=class{constructor(e,t,i){this._clickCount=0,this._clickTimeoutId=null,this._clickPosition={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._tapCount=0,this._tapTimeoutId=null,this._tapPosition={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._longTapTimeoutId=null,this._longTapActive=!1,this._mouseMoveStartPosition=null,this._touchMoveStartPosition=null,this._touchMoveExceededManhattanDistance=!1,this._cancelClick=!1,this._cancelTap=!1,this._unsubscribeOutsideMouseEvents=null,this._unsubscribeOutsideTouchEvents=null,this._unsubscribeMobileSafariEvents=null,this._unsubscribeMousemove=null,this._unsubscribeRootMouseEvents=null,this._unsubscribeRootTouchEvents=null,this._startPinchMiddlePoint=null,this._startPinchDistance=0,this._pinchPrevented=!1,this._preventTouchDragProcess=!1,this._mousePressed=!1,this._lastTouchEventTimeStamp=0,this._activeTouchId=null,this._acceptMouseLeave=!io(),this._onFirefoxOutsideMouseUp=r=>{this._mouseUpHandler(r)},this._onMobileSafariDoubleClick=r=>{if(this._firesTouchEvents(r)){let o=this._makeCompatEvent(r);if(++this._tapCount,this._tapTimeoutId&&this._tapCount>1){let{manhattanDistance:n}=this._touchMouseMoveWithDownInfo(Je(r),this._tapPosition);n<30&&!this._cancelTap&&this._processTouchEvent(o,this._handler.doubleTapEvent),this._resetTapTimeout()}}else{let o=this._makeCompatEvent(r);if(++this._clickCount,this._clickTimeoutId&&this._clickCount>1){let{manhattanDistance:n}=this._touchMouseMoveWithDownInfo(Je(r),this._clickPosition);n<5&&!this._cancelClick&&this._processMouseEvent(o,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}}},this._target=e,this._handler=t,this._options=i,this._init()}destroy(){this._unsubscribeOutsideMouseEvents!==null&&(this._unsubscribeOutsideMouseEvents(),this._unsubscribeOutsideMouseEvents=null),this._unsubscribeOutsideTouchEvents!==null&&(this._unsubscribeOutsideTouchEvents(),this._unsubscribeOutsideTouchEvents=null),this._unsubscribeMousemove!==null&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null),this._unsubscribeMobileSafariEvents!==null&&(this._unsubscribeMobileSafariEvents(),this._unsubscribeMobileSafariEvents=null),this._clearLongTapTimeout(),this._resetClickTimeout()}_mouseEnterHandler(e){this._unsubscribeMousemove&&this._unsubscribeMousemove();let t=this._mouseMoveHandler.bind(this);if(this._unsubscribeMousemove=()=>{this._target.removeEventListener("mousemove",t)},this._target.addEventListener("mousemove",t),this._firesTouchEvents(e))return;let i=this._makeCompatEvent(e);this._processMouseEvent(i,this._handler.mouseEnterEvent),this._acceptMouseLeave=!0}_resetClickTimeout(){this._clickTimeoutId!==null&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null,this._clickPosition={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_resetTapTimeout(){this._tapTimeoutId!==null&&clearTimeout(this._tapTimeoutId),this._tapCount=0,this._tapTimeoutId=null,this._tapPosition={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_mouseMoveHandler(e){if(this._mousePressed||this._touchMoveStartPosition!==null||this._firesTouchEvents(e))return;let t=this._makeCompatEvent(e);this._processMouseEvent(t,this._handler.mouseMoveEvent),this._acceptMouseLeave=!0}_touchMoveHandler(e){let t=En(e.changedTouches,C(this._activeTouchId));if(t===null||(this._lastTouchEventTimeStamp=ro(e),this._startPinchMiddlePoint!==null)||this._preventTouchDragProcess)return;this._pinchPrevented=!0;let i=this._touchMouseMoveWithDownInfo(Je(t),C(this._touchMoveStartPosition)),{xOffset:r,yOffset:o,manhattanDistance:n}=i;if(!(!this._touchMoveExceededManhattanDistance&&n<5)){if(!this._touchMoveExceededManhattanDistance){let a=r*.5,l=o>=a&&!this._options.treatVertTouchDragAsPageScroll(),d=a>o&&!this._options.treatHorzTouchDragAsPageScroll();!l&&!d&&(this._preventTouchDragProcess=!0),this._touchMoveExceededManhattanDistance=!0,this._cancelTap=!0,this._clearLongTapTimeout(),this._resetTapTimeout()}if(!this._preventTouchDragProcess){let a=this._makeCompatEvent(e,t);this._processTouchEvent(a,this._handler.touchMoveEvent),pi(e)}}}_mouseMoveWithDownHandler(e){if(e.button!==0)return;let t=this._touchMouseMoveWithDownInfo(Je(e),C(this._mouseMoveStartPosition)),{manhattanDistance:i}=t;if(i>=5&&(this._cancelClick=!0,this._resetClickTimeout()),this._cancelClick){let r=this._makeCompatEvent(e);this._processMouseEvent(r,this._handler.pressedMouseMoveEvent)}}_touchMouseMoveWithDownInfo(e,t){let i=Math.abs(t.x-e.x),r=Math.abs(t.y-e.y),o=i+r;return{xOffset:i,yOffset:r,manhattanDistance:o}}_touchEndHandler(e){let t=En(e.changedTouches,C(this._activeTouchId));if(t===null&&e.touches.length===0&&(t=e.changedTouches[0]),t===null)return;this._activeTouchId=null,this._lastTouchEventTimeStamp=ro(e),this._clearLongTapTimeout(),this._touchMoveStartPosition=null,this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);let i=this._makeCompatEvent(e,t);if(this._processTouchEvent(i,this._handler.touchEndEvent),++this._tapCount,this._tapTimeoutId&&this._tapCount>1){let{manhattanDistance:r}=this._touchMouseMoveWithDownInfo(Je(t),this._tapPosition);r<30&&!this._cancelTap&&this._processTouchEvent(i,this._handler.doubleTapEvent),this._resetTapTimeout()}else this._cancelTap||(this._processTouchEvent(i,this._handler.tapEvent),this._handler.tapEvent&&pi(e));this._tapCount===0&&pi(e),e.touches.length===0&&this._longTapActive&&(this._longTapActive=!1,pi(e))}_mouseUpHandler(e){if(e.button!==0)return;let t=this._makeCompatEvent(e);if(this._mouseMoveStartPosition=null,this._mousePressed=!1,this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),In()&&this._target.ownerDocument.documentElement.removeEventListener("mouseleave",this._onFirefoxOutsideMouseUp),!this._firesTouchEvents(e))if(this._processMouseEvent(t,this._handler.mouseUpEvent),++this._clickCount,this._clickTimeoutId&&this._clickCount>1){let{manhattanDistance:i}=this._touchMouseMoveWithDownInfo(Je(e),this._clickPosition);i<5&&!this._cancelClick&&this._processMouseEvent(t,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}else this._cancelClick||this._processMouseEvent(t,this._handler.mouseClickEvent)}_clearLongTapTimeout(){this._longTapTimeoutId!==null&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)}_touchStartHandler(e){if(this._activeTouchId!==null)return;let t=e.changedTouches[0];this._activeTouchId=t.identifier,this._lastTouchEventTimeStamp=ro(e);let i=this._target.ownerDocument.documentElement;this._cancelTap=!1,this._touchMoveExceededManhattanDistance=!1,this._preventTouchDragProcess=!1,this._touchMoveStartPosition=Je(t),this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);{let o=this._touchMoveHandler.bind(this),n=this._touchEndHandler.bind(this);this._unsubscribeRootTouchEvents=()=>{i.removeEventListener("touchmove",o),i.removeEventListener("touchend",n)},i.addEventListener("touchmove",o,{passive:!1}),i.addEventListener("touchend",n,{passive:!1}),this._clearLongTapTimeout(),this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,e),240)}let r=this._makeCompatEvent(e,t);this._processTouchEvent(r,this._handler.touchStartEvent),this._tapTimeoutId||(this._tapCount=0,this._tapTimeoutId=setTimeout(this._resetTapTimeout.bind(this),500),this._tapPosition=Je(t))}_mouseDownHandler(e){if(e.button!==0)return;let t=this._target.ownerDocument.documentElement;In()&&t.addEventListener("mouseleave",this._onFirefoxOutsideMouseUp),this._cancelClick=!1,this._mouseMoveStartPosition=Je(e),this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null);{let r=this._mouseMoveWithDownHandler.bind(this),o=this._mouseUpHandler.bind(this);this._unsubscribeRootMouseEvents=()=>{t.removeEventListener("mousemove",r),t.removeEventListener("mouseup",o)},t.addEventListener("mousemove",r),t.addEventListener("mouseup",o)}if(this._mousePressed=!0,this._firesTouchEvents(e))return;let i=this._makeCompatEvent(e);this._processMouseEvent(i,this._handler.mouseDownEvent),this._clickTimeoutId||(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),500),this._clickPosition=Je(e))}_init(){this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));{let e=this._target.ownerDocument,t=i=>{!this._handler.mouseDownOutsideEvent||i.composed&&this._target.contains(i.composedPath()[0])||i.target&&this._target.contains(i.target)||this._handler.mouseDownOutsideEvent()};this._unsubscribeOutsideTouchEvents=()=>{e.removeEventListener("touchstart",t)},this._unsubscribeOutsideMouseEvents=()=>{e.removeEventListener("mousedown",t)},e.addEventListener("mousedown",t),e.addEventListener("touchstart",t,{passive:!0})}io()&&(this._unsubscribeMobileSafariEvents=()=>{this._target.removeEventListener("dblclick",this._onMobileSafariDoubleClick)},this._target.addEventListener("dblclick",this._onMobileSafariDoubleClick)),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._touchStartHandler.bind(this),{passive:!0}),kh(this._target),this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",()=>{},{passive:!1})}_initPinch(){this._handler.pinchStartEvent===void 0&&this._handler.pinchEvent===void 0&&this._handler.pinchEndEvent===void 0||(this._target.addEventListener("touchstart",e=>this._checkPinchState(e.touches),{passive:!0}),this._target.addEventListener("touchmove",e=>{if(!(e.touches.length!==2||this._startPinchMiddlePoint===null)&&this._handler.pinchEvent!==void 0){let i=Ah(e.touches[0],e.touches[1])/this._startPinchDistance;this._handler.pinchEvent(this._startPinchMiddlePoint,i),pi(e)}},{passive:!1}),this._target.addEventListener("touchend",e=>{this._checkPinchState(e.touches)}))}_checkPinchState(e){e.length===1&&(this._pinchPrevented=!1),e.length!==2||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(e)}_startPinch(e){let t=n_(this._target);this._startPinchMiddlePoint={x:(e[0].clientX-t.left+(e[1].clientX-t.left))/2,y:(e[0].clientY-t.top+(e[1].clientY-t.top))/2},this._startPinchDistance=Ah(e[0],e[1]),this._handler.pinchStartEvent!==void 0&&this._handler.pinchStartEvent(),this._clearLongTapTimeout()}_stopPinch(){this._startPinchMiddlePoint!==null&&(this._startPinchMiddlePoint=null,this._handler.pinchEndEvent!==void 0&&this._handler.pinchEndEvent())}_mouseLeaveHandler(e){if(this._unsubscribeMousemove&&this._unsubscribeMousemove(),this._firesTouchEvents(e)||!this._acceptMouseLeave)return;let t=this._makeCompatEvent(e);this._processMouseEvent(t,this._handler.mouseLeaveEvent),this._acceptMouseLeave=!io()}_longTapHandler(e){let t=En(e.touches,C(this._activeTouchId));if(t===null)return;let i=this._makeCompatEvent(e,t);this._processTouchEvent(i,this._handler.longTapEvent),this._cancelTap=!0,this._longTapActive=!0}_firesTouchEvents(e){return e.sourceCapabilities&&e.sourceCapabilities.firesTouchEvents!==void 0?e.sourceCapabilities.firesTouchEvents:ro(e)<this._lastTouchEventTimeStamp+500}_processTouchEvent(e,t){t&&t.call(this._handler,e)}_processMouseEvent(e,t){!t||t.call(this._handler,e)}_makeCompatEvent(e,t){let i=t||e,r=this._target.getBoundingClientRect()||{left:0,top:0};return{clientX:i.clientX,clientY:i.clientY,pageX:i.pageX,pageY:i.pageY,screenX:i.screenX,screenY:i.screenY,localX:i.clientX-r.left,localY:i.clientY-r.top,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey,isTouch:!e.type.startsWith("mouse")&&e.type!=="contextmenu"&&e.type!=="click",srcType:e.type,target:i.target,view:e.view,preventDefault:()=>{e.type!=="touchstart"&&pi(e)}}}};function n_(s){return s.getBoundingClientRect()||{left:0,top:0}}function Ah(s,e){let t=s.clientX-e.clientX,i=s.clientY-e.clientY;return Math.sqrt(t*t+i*i)}function pi(s){s.cancelable&&s.preventDefault()}function Je(s){return{x:s.pageX,y:s.pageY}}function ro(s){return s.timeStamp||performance.now()}function En(s,e){for(let t=0;t<s.length;++t)if(s[t].identifier===e)return s[t];return null}c();h();function a_(s,e){return!e||s==="top"&&e!=="top"||s==="normal"&&e==="bottom"}function l_(s,e,t){var i,r;let o,n;for(let a of s){let l=(r=(i=a.primitiveHitTest)===null||i===void 0?void 0:i.call(a,e,t))!==null&&r!==void 0?r:[];for(let d of l)a_(d.zOrder,o?.zOrder)&&(o=d,n=a)}return!o||!n?null:{hit:o,source:n}}function oo(s){return{source:s.source,object:{externalId:s.hit.externalId},cursorStyle:s.hit.cursorStyle}}function c_(s,e,t){for(let i of s){let r=i.renderer();if(r!==null&&r.hitTest){let o=r.hitTest(e,t);if(o!==null)return{view:i,object:o}}}return null}function Ih(s,e,t){let i=s.orderedSources(),r=l_(i,e,t);if(r?.hit.zOrder==="top")return oo(r);for(let o of i){if(r&&r.source===o&&r.hit.zOrder!=="bottom"&&!r.hit.isBackground)return oo(r);let n=c_(o.paneViews(s),e,t);if(n!==null)return{source:o,view:n.view,object:n.object};if(r&&r.source===o&&r.hit.zOrder!=="bottom"&&r.hit.isBackground)return oo(r)}return r?.hit?oo(r):null}c();h();var Bh;(function(s){s[s.Default=0]="Default",s[s.NsResize=1]="NsResize"})(Bh||(Bh={}));var no;(function(s){s[s.DefaultOptimalWidth=34]="DefaultOptimalWidth"})(no||(no={}));(function(s){s[s.LabelOffset=5]="LabelOffset"})(no||(no={}));function Ln(s,e){return t=>{var i,r,o,n;return((r=(i=t.priceScale())===null||i===void 0?void 0:i.id())!==null&&r!==void 0?r:"")!==e?[]:(n=(o=t.pricePaneViews)===null||o===void 0?void 0:o.call(t,s))!==null&&n!==void 0?n:[]}}var Zi=class{constructor(e,t,i,r){this._priceScale=null,this._size=null,this._mousedown=!1,this._widthCache=new Le(200),this._font=null,this._prevOptimalWidth=0,this._isSettingSize=!1,this._canvasSuggestedBitmapSizeChangedHandler=()=>{this._isSettingSize||this._pane.chart().model().lightUpdate()},this._topCanvasSuggestedBitmapSizeChangedHandler=()=>{this._isSettingSize||this._pane.chart().model().lightUpdate()},this._pane=e,this._options=t,this._layoutOptions=t.layout,this._rendererOptionsProvider=i,this._isLeft=r==="left",this._sourcePaneViews=Ln("normal",r),this._sourceTopPaneViews=Ln("top",r),this._sourceBottomPaneViews=Ln("bottom",r),this._cell=document.createElement("div"),this._cell.style.height="100%",this._cell.style.overflow="hidden",this._cell.style.width="25px",this._cell.style.left="0",this._cell.style.position="relative",this._canvasBinding=Oe(this._cell,O({width:16,height:16})),this._canvasBinding.subscribeSuggestedBitmapSizeChanged(this._canvasSuggestedBitmapSizeChangedHandler);let o=this._canvasBinding.canvasElement;o.style.position="absolute",o.style.zIndex="1",o.style.left="0",o.style.top="0",this._topCanvasBinding=Oe(this._cell,O({width:16,height:16})),this._topCanvasBinding.subscribeSuggestedBitmapSizeChanged(this._topCanvasSuggestedBitmapSizeChangedHandler);let n=this._topCanvasBinding.canvasElement;n.style.position="absolute",n.style.zIndex="2",n.style.left="0",n.style.top="0";let a={mouseDownEvent:this._mouseDownEvent.bind(this),touchStartEvent:this._mouseDownEvent.bind(this),pressedMouseMoveEvent:this._pressedMouseMoveEvent.bind(this),touchMoveEvent:this._pressedMouseMoveEvent.bind(this),mouseDownOutsideEvent:this._mouseDownOutsideEvent.bind(this),mouseUpEvent:this._mouseUpEvent.bind(this),touchEndEvent:this._mouseUpEvent.bind(this),mouseDoubleClickEvent:this._mouseDoubleClickEvent.bind(this),doubleTapEvent:this._mouseDoubleClickEvent.bind(this),mouseEnterEvent:this._mouseEnterEvent.bind(this),mouseLeaveEvent:this._mouseLeaveEvent.bind(this)};this._mouseEventHandler=new At(this._topCanvasBinding.canvasElement,a,{treatVertTouchDragAsPageScroll:()=>!this._options.handleScroll.vertTouchDrag,treatHorzTouchDragAsPageScroll:()=>!0})}destroy(){this._mouseEventHandler.destroy(),this._topCanvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._topCanvasSuggestedBitmapSizeChangedHandler),Ve(this._topCanvasBinding.canvasElement),this._topCanvasBinding.dispose(),this._canvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._canvasSuggestedBitmapSizeChangedHandler),Ve(this._canvasBinding.canvasElement),this._canvasBinding.dispose(),this._priceScale!==null&&this._priceScale.onMarksChanged().unsubscribeAll(this),this._priceScale=null}getElement(){return this._cell}fontSize(){return this._layoutOptions.fontSize}rendererOptions(){let e=this._rendererOptionsProvider.options();return this._font!==e.font&&(this._widthCache.reset(),this._font=e.font),e}optimalWidth(){if(this._priceScale===null)return 0;let e=0,t=this.rendererOptions(),i=C(this._canvasBinding.canvasElement.getContext("2d"));i.save();let r=this._priceScale.marks();i.font=this._baseFont(),r.length>0&&(e=Math.max(this._widthCache.measureText(i,r[0].label),this._widthCache.measureText(i,r[r.length-1].label)));let o=this._backLabels();for(let d=o.length;d--;){let u=this._widthCache.measureText(i,o[d].text());u>e&&(e=u)}let n=this._priceScale.firstValue();if(n!==null&&this._size!==null){let d=this._priceScale.coordinateToPrice(1,n),u=this._priceScale.coordinateToPrice(this._size.height-2,n);e=Math.max(e,this._widthCache.measureText(i,this._priceScale.formatPrice(Math.floor(Math.min(d,u))+.11111111111111,n)),this._widthCache.measureText(i,this._priceScale.formatPrice(Math.ceil(Math.max(d,u))-.11111111111111,n)))}i.restore();let a=e||34,l=Math.ceil(t.borderSize+t.tickLength+t.paddingInner+t.paddingOuter+5+a);return ji(l)}setSize(e){(this._size===null||!Ce(this._size,e))&&(this._size=e,this._isSettingSize=!0,this._canvasBinding.resizeCanvasElement(e),this._topCanvasBinding.resizeCanvasElement(e),this._isSettingSize=!1,this._cell.style.width=`${e.width}px`,this._cell.style.height=`${e.height}px`)}getWidth(){return C(this._size).width}setPriceScale(e){this._priceScale!==e&&(this._priceScale!==null&&this._priceScale.onMarksChanged().unsubscribeAll(this),this._priceScale=e,e.onMarksChanged().subscribe(this._onMarksChanged.bind(this),this))}priceScale(){return this._priceScale}reset(){let e=this._pane.state();this._pane.chart().model().resetPriceScale(e,C(this.priceScale()))}paint(e){if(this._size===null)return;if(e!==1){this._alignLabels(),this._canvasBinding.applySuggestedBitmapSize();let i=Pe(this._canvasBinding);i!==null&&(i.useBitmapCoordinateSpace(r=>{this._drawBackground(r),this._drawBorder(r)}),this._pane.drawAdditionalSources(i,this._sourceBottomPaneViews),this._drawTickMarks(i),this._pane.drawAdditionalSources(i,this._sourcePaneViews),this._drawBackLabels(i))}this._topCanvasBinding.applySuggestedBitmapSize();let t=Pe(this._topCanvasBinding);t!==null&&(t.useBitmapCoordinateSpace(({context:i,bitmapSize:r})=>{i.clearRect(0,0,r.width,r.height)}),this._drawCrosshairLabel(t),this._pane.drawAdditionalSources(t,this._sourceTopPaneViews))}getBitmapSize(){return this._canvasBinding.bitmapSize}drawBitmap(e,t,i){let r=this.getBitmapSize();r.width>0&&r.height>0&&e.drawImage(this._canvasBinding.canvasElement,t,i)}update(){var e;(e=this._priceScale)===null||e===void 0||e.marks()}_mouseDownEvent(e){if(this._priceScale===null||this._priceScale.isEmpty()||!this._options.handleScale.axisPressedMouseMove.price)return;let t=this._pane.chart().model(),i=this._pane.state();this._mousedown=!0,t.startScalePrice(i,this._priceScale,e.localY)}_pressedMouseMoveEvent(e){if(this._priceScale===null||!this._options.handleScale.axisPressedMouseMove.price)return;let t=this._pane.chart().model(),i=this._pane.state(),r=this._priceScale;t.scalePriceTo(i,r,e.localY)}_mouseDownOutsideEvent(){if(this._priceScale===null||!this._options.handleScale.axisPressedMouseMove.price)return;let e=this._pane.chart().model(),t=this._pane.state(),i=this._priceScale;this._mousedown&&(this._mousedown=!1,e.endScalePrice(t,i))}_mouseUpEvent(e){if(this._priceScale===null||!this._options.handleScale.axisPressedMouseMove.price)return;let t=this._pane.chart().model(),i=this._pane.state();this._mousedown=!1,t.endScalePrice(i,this._priceScale)}_mouseDoubleClickEvent(e){this._options.handleScale.axisDoubleClickReset.price&&this.reset()}_mouseEnterEvent(e){if(this._priceScale===null)return;this._pane.chart().model().options().handleScale.axisPressedMouseMove.price&&!this._priceScale.isPercentage()&&!this._priceScale.isIndexedTo100()&&this._setCursor(1)}_mouseLeaveEvent(e){this._setCursor(0)}_backLabels(){let e=[],t=this._priceScale===null?void 0:this._priceScale;return(r=>{for(let o=0;o<r.length;++o){let a=r[o].priceAxisViews(this._pane.state(),t);for(let l=0;l<a.length;l++)e.push(a[l])}})(this._pane.state().orderedSources()),e}_drawBackground({context:e,bitmapSize:t}){let{width:i,height:r}=t,o=this._pane.state().model(),n=o.backgroundTopColor(),a=o.backgroundBottomColor();n===a?vt(e,0,0,i,r,n):Ks(e,0,0,i,r,n,a)}_drawBorder({context:e,bitmapSize:t,horizontalPixelRatio:i}){if(this._size===null||this._priceScale===null||!this._priceScale.options().borderVisible)return;e.fillStyle=this._priceScale.options().borderColor;let r=Math.max(1,Math.floor(this.rendererOptions().borderSize*i)),o;this._isLeft?o=t.width-r:o=0,e.fillRect(o,0,r,t.height)}_drawTickMarks(e){if(this._size===null||this._priceScale===null)return;let t=this._priceScale.marks(),i=this._priceScale.options(),r=this.rendererOptions(),o=this._isLeft&&i.textAlign!=="left",n=o?this._size.width-r.tickLength:0;i.borderVisible&&i.ticksVisible&&e.useBitmapCoordinateSpace(({context:a,horizontalPixelRatio:l,verticalPixelRatio:d})=>{a.fillStyle=i.borderColor;let u=Math.max(1,Math.floor(d)),_=Math.floor(d*.5),f=Math.round(r.tickLength*l);a.beginPath();for(let m of t)a.rect(Math.floor(n*l),Math.round(m.coord*d)-_,f,u);a.fill()}),e.useMediaCoordinateSpace(({context:a})=>{var l;a.font=this._baseFont(),a.fillStyle=(l=i.textColor)!==null&&l!==void 0?l:this._layoutOptions.textColor,a.textAlign=o?"right":"left",a.textBaseline="middle";let d=Math.round(o?n-r.paddingInner:n+r.tickLength+r.paddingInner),u=t.map(_=>this._widthCache.yMidCorrection(a,_.label));for(let _=t.length;_--;){let f=t[_];a.fillText(f.label,d,f.coord+u[_])}})}_alignLabels(){if(this._size===null||this._priceScale===null)return;let e=this._size.height/2,t=[],i=this._priceScale.orderedSources().slice(),o=this._pane.state(),n=this.rendererOptions();this._priceScale===o.defaultVisiblePriceScale()&&this._pane.state().orderedSources().forEach(f=>{o.isOverlay(f)&&i.push(f)});let l=this._priceScale.dataSources()[0],d=this._priceScale;(f=>{f.forEach(m=>{let g=m.priceAxisViews(o,d);g.forEach(b=>{b.setFixedCoordinate(null),b.isVisible()&&t.push(b)}),l===m&&g.length>0&&(e=g[0].coordinate())})})(i),t.forEach(f=>f.setFixedCoordinate(f.coordinate())),this._priceScale.options().alignLabels&&this._fixLabelOverlap(t,n,e)}_fixLabelOverlap(e,t,i){if(this._size===null)return;let r=e.filter(n=>n.coordinate()<=i),o=e.filter(n=>n.coordinate()>i);r.sort((n,a)=>a.coordinate()-n.coordinate()),r.length&&o.length&&o.push(r[0]),o.sort((n,a)=>n.coordinate()-a.coordinate());for(let n of e){let a=Math.floor(n.height(t)/2),l=n.coordinate();l>-a&&l<a&&n.setFixedCoordinate(a),l>this._size.height-a&&l<this._size.height+a&&n.setFixedCoordinate(this._size.height-a)}for(let n=1;n<r.length;n++){let a=r[n],l=r[n-1],d=l.height(t,!1),u=a.coordinate(),_=l.getFixedCoordinate();u>_-d&&a.setFixedCoordinate(_-d)}for(let n=1;n<o.length;n++){let a=o[n],l=o[n-1],d=l.height(t,!0),u=a.coordinate(),_=l.getFixedCoordinate();u<_+d&&a.setFixedCoordinate(_+d)}}_drawBackLabels(e){if(this._size===null)return;let t=this._backLabels(),i=this.rendererOptions(),r=this._isLeft?"right":"left";t.forEach(o=>{o.isAxisLabelVisible()&&o.renderer(C(this._priceScale)).draw(e,i,this._widthCache,r)})}_drawCrosshairLabel(e){if(this._size===null||this._priceScale===null)return;let t=this._pane.chart().model(),i=[],r=this._pane.state(),o=t.crosshairSource().priceAxisViews(r,this._priceScale);o.length&&i.push(o);let n=this.rendererOptions(),a=this._isLeft?"right":"left";i.forEach(l=>{l.forEach(d=>{d.renderer(C(this._priceScale)).draw(e,n,this._widthCache,a)})})}_setCursor(e){this._cell.style.cursor=e===1?"ns-resize":"default"}_onMarksChanged(){let e=this.optimalWidth();this._prevOptimalWidth<e&&this._pane.chart().model().fullUpdate(),this._prevOptimalWidth=e}_baseFont(){return Se(this._layoutOptions.fontSize,this._layoutOptions.fontFamily)}};var Dh;(function(s){s[s.MinScrollSpeed=.2]="MinScrollSpeed",s[s.MaxScrollSpeed=7]="MaxScrollSpeed",s[s.DumpingCoeff=.997]="DumpingCoeff",s[s.ScrollMinMove=15]="ScrollMinMove"})(Dh||(Dh={}));function h_(s,e){var t,i;return(i=(t=s.bottomPaneViews)===null||t===void 0?void 0:t.call(s,e))!==null&&i!==void 0?i:[]}function ao(s,e){var t,i;return(i=(t=s.paneViews)===null||t===void 0?void 0:t.call(s,e))!==null&&i!==void 0?i:[]}function d_(s,e){var t,i;return(i=(t=s.labelPaneViews)===null||t===void 0?void 0:t.call(s,e))!==null&&i!==void 0?i:[]}function u_(s,e){var t,i;return(i=(t=s.topPaneViews)===null||t===void 0?void 0:t.call(s,e))!==null&&i!==void 0?i:[]}var fi=class{constructor(e,t){this._size=O({width:0,height:0}),this._leftPriceAxisWidget=null,this._rightPriceAxisWidget=null,this._startScrollingPos=null,this._isScrolling=!1,this._clicked=new L,this._dblClicked=new L,this._prevPinchScale=0,this._longTap=!1,this._startTrackPoint=null,this._exitTrackingModeOnNextTry=!1,this._initCrosshairPosition=null,this._scrollXAnimation=null,this._isSettingSize=!1,this._canvasSuggestedBitmapSizeChangedHandler=()=>{this._isSettingSize||this._state===null||this._model().lightUpdate()},this._topCanvasSuggestedBitmapSizeChangedHandler=()=>{this._isSettingSize||this._state===null||this._model().lightUpdate()},this._chart=e,this._state=t,this._state.onDestroyed().subscribe(this._onStateDestroyed.bind(this),this,!0),this._paneCell=document.createElement("td"),this._paneCell.style.padding="0",this._paneCell.style.position="relative";let i=document.createElement("div");i.style.width="100%",i.style.height="100%",i.style.position="relative",i.style.overflow="hidden",this._leftAxisCell=document.createElement("td"),this._leftAxisCell.style.padding="0",this._rightAxisCell=document.createElement("td"),this._rightAxisCell.style.padding="0",this._paneCell.appendChild(i),this._canvasBinding=Oe(i,O({width:16,height:16})),this._canvasBinding.subscribeSuggestedBitmapSizeChanged(this._canvasSuggestedBitmapSizeChangedHandler);let r=this._canvasBinding.canvasElement;r.style.position="absolute",r.style.zIndex="1",r.style.left="0",r.style.top="0",this._topCanvasBinding=Oe(i,O({width:16,height:16})),this._topCanvasBinding.subscribeSuggestedBitmapSizeChanged(this._topCanvasSuggestedBitmapSizeChangedHandler);let o=this._topCanvasBinding.canvasElement;o.style.position="absolute",o.style.zIndex="2",o.style.left="0",o.style.top="0",this._rowElement=document.createElement("tr"),this._rowElement.appendChild(this._leftAxisCell),this._rowElement.appendChild(this._paneCell),this._rowElement.appendChild(this._rightAxisCell),this.updatePriceAxisWidgetsStates(),this._mouseEventHandler=new At(this._topCanvasBinding.canvasElement,this,{treatVertTouchDragAsPageScroll:()=>this._startTrackPoint===null&&!this._chart.options().handleScroll.vertTouchDrag,treatHorzTouchDragAsPageScroll:()=>this._startTrackPoint===null&&!this._chart.options().handleScroll.horzTouchDrag})}destroy(){this._leftPriceAxisWidget!==null&&this._leftPriceAxisWidget.destroy(),this._rightPriceAxisWidget!==null&&this._rightPriceAxisWidget.destroy(),this._topCanvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._topCanvasSuggestedBitmapSizeChangedHandler),Ve(this._topCanvasBinding.canvasElement),this._topCanvasBinding.dispose(),this._canvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._canvasSuggestedBitmapSizeChangedHandler),Ve(this._canvasBinding.canvasElement),this._canvasBinding.dispose(),this._state!==null&&this._state.onDestroyed().unsubscribeAll(this),this._mouseEventHandler.destroy()}state(){return C(this._state)}setState(e){this._state!==null&&this._state.onDestroyed().unsubscribeAll(this),this._state=e,this._state!==null&&this._state.onDestroyed().subscribe(fi.prototype._onStateDestroyed.bind(this),this,!0),this.updatePriceAxisWidgetsStates()}chart(){return this._chart}getElement(){return this._rowElement}updatePriceAxisWidgetsStates(){if(this._state!==null&&(this._recreatePriceAxisWidgets(),this._model().serieses().length!==0)){if(this._leftPriceAxisWidget!==null){let e=this._state.leftPriceScale();this._leftPriceAxisWidget.setPriceScale(C(e))}if(this._rightPriceAxisWidget!==null){let e=this._state.rightPriceScale();this._rightPriceAxisWidget.setPriceScale(C(e))}}}updatePriceAxisWidgets(){this._leftPriceAxisWidget!==null&&this._leftPriceAxisWidget.update(),this._rightPriceAxisWidget!==null&&this._rightPriceAxisWidget.update()}stretchFactor(){return this._state!==null?this._state.stretchFactor():0}setStretchFactor(e){this._state&&this._state.setStretchFactor(e)}mouseEnterEvent(e){if(!this._state)return;this._onMouseEvent();let t=e.localX,i=e.localY;this._setCrosshairPosition(t,i,e)}mouseDownEvent(e){this._onMouseEvent(),this._mouseTouchDownEvent(),this._setCrosshairPosition(e.localX,e.localY,e)}mouseMoveEvent(e){var t;if(!this._state)return;this._onMouseEvent();let i=e.localX,r=e.localY;this._setCrosshairPosition(i,r,e);let o=this.hitTest(i,r);this._chart.setCursorStyle((t=o?.cursorStyle)!==null&&t!==void 0?t:null),this._model().setHoveredSource(o&&{source:o.source,object:o.object})}mouseClickEvent(e){this._state!==null&&(this._onMouseEvent(),this._fireClickedDelegate(e))}mouseDoubleClickEvent(e){this._state!==null&&this._fireMouseClickDelegate(this._dblClicked,e)}doubleTapEvent(e){this.mouseDoubleClickEvent(e)}pressedMouseMoveEvent(e){this._onMouseEvent(),this._pressedMouseTouchMoveEvent(e),this._setCrosshairPosition(e.localX,e.localY,e)}mouseUpEvent(e){this._state!==null&&(this._onMouseEvent(),this._longTap=!1,this._endScroll(e))}tapEvent(e){this._state!==null&&this._fireClickedDelegate(e)}longTapEvent(e){if(this._longTap=!0,this._startTrackPoint===null){let t={x:e.localX,y:e.localY};this._startTrackingMode(t,t,e)}}mouseLeaveEvent(e){this._state!==null&&(this._onMouseEvent(),this._state.model().setHoveredSource(null),this._clearCrosshairPosition())}clicked(){return this._clicked}dblClicked(){return this._dblClicked}pinchStartEvent(){this._prevPinchScale=1,this._model().stopTimeScaleAnimation()}pinchEvent(e,t){if(!this._chart.options().handleScale.pinch)return;let i=(t-this._prevPinchScale)*5;this._prevPinchScale=t,this._model().zoomTime(e.x,i)}touchStartEvent(e){this._longTap=!1,this._exitTrackingModeOnNextTry=this._startTrackPoint!==null,this._mouseTouchDownEvent();let t=this._model().crosshairSource();this._startTrackPoint!==null&&t.visible()&&(this._initCrosshairPosition={x:t.appliedX(),y:t.appliedY()},this._startTrackPoint={x:e.localX,y:e.localY})}touchMoveEvent(e){if(this._state===null)return;let t=e.localX,i=e.localY;if(this._startTrackPoint!==null){this._exitTrackingModeOnNextTry=!1;let r=C(this._initCrosshairPosition),o=r.x+(t-this._startTrackPoint.x),n=r.y+(i-this._startTrackPoint.y);this._setCrosshairPosition(o,n,e);return}this._pressedMouseTouchMoveEvent(e)}touchEndEvent(e){this.chart().options().trackingMode.exitMode===0&&(this._exitTrackingModeOnNextTry=!0),this._tryExitTrackingMode(),this._endScroll(e)}hitTest(e,t){let i=this._state;return i===null?null:Ih(i,e,t)}setPriceAxisSize(e,t){let i=t==="left"?this._leftPriceAxisWidget:this._rightPriceAxisWidget;C(i).setSize(O({width:e,height:this._size.height}))}getSize(){return this._size}setSize(e){Ce(this._size,e)||(this._size=e,this._isSettingSize=!0,this._canvasBinding.resizeCanvasElement(e),this._topCanvasBinding.resizeCanvasElement(e),this._isSettingSize=!1,this._paneCell.style.width=e.width+"px",this._paneCell.style.height=e.height+"px")}recalculatePriceScales(){let e=C(this._state);e.recalculatePriceScale(e.leftPriceScale()),e.recalculatePriceScale(e.rightPriceScale());for(let t of e.dataSources())if(e.isOverlay(t)){let i=t.priceScale();i!==null&&e.recalculatePriceScale(i),t.updateAllViews()}}getBitmapSize(){return this._canvasBinding.bitmapSize}drawBitmap(e,t,i){let r=this.getBitmapSize();r.width>0&&r.height>0&&e.drawImage(this._canvasBinding.canvasElement,t,i)}paint(e){if(e===0||this._state===null)return;if(e>1&&this.recalculatePriceScales(),this._leftPriceAxisWidget!==null&&this._leftPriceAxisWidget.paint(e),this._rightPriceAxisWidget!==null&&this._rightPriceAxisWidget.paint(e),e!==1){this._canvasBinding.applySuggestedBitmapSize();let i=Pe(this._canvasBinding);i!==null&&(i.useBitmapCoordinateSpace(r=>{this._drawBackground(r)}),this._state&&(this._drawSources(i,h_),this._drawGrid(i),this._drawWatermark(i),this._drawSources(i,ao),this._drawSources(i,d_)))}this._topCanvasBinding.applySuggestedBitmapSize();let t=Pe(this._topCanvasBinding);t!==null&&(t.useBitmapCoordinateSpace(({context:i,bitmapSize:r})=>{i.clearRect(0,0,r.width,r.height)}),this._drawCrosshair(t),this._drawSources(t,u_))}leftPriceAxisWidget(){return this._leftPriceAxisWidget}rightPriceAxisWidget(){return this._rightPriceAxisWidget}drawAdditionalSources(e,t){this._drawSources(e,t)}_onStateDestroyed(){this._state!==null&&this._state.onDestroyed().unsubscribeAll(this),this._state=null}_fireClickedDelegate(e){this._fireMouseClickDelegate(this._clicked,e)}_fireMouseClickDelegate(e,t){let i=t.localX,r=t.localY;e.hasListeners()&&e.fire(this._model().timeScale().coordinateToIndex(i),{x:i,y:r},t)}_drawBackground({context:e,bitmapSize:t}){let{width:i,height:r}=t,o=this._model(),n=o.backgroundTopColor(),a=o.backgroundBottomColor();n===a?vt(e,0,0,i,r,a):Ks(e,0,0,i,r,n,a)}_drawGrid(e){let r=C(this._state).grid().paneView().renderer();r!==null&&r.draw(e,!1)}_drawWatermark(e){let t=this._model().watermarkSource();this._drawSourceImpl(e,ao,Gi,t),this._drawSourceImpl(e,ao,mi,t)}_drawCrosshair(e){this._drawSourceImpl(e,ao,mi,this._model().crosshairSource())}_drawSources(e,t){let r=C(this._state).orderedSources();for(let o of r)this._drawSourceImpl(e,t,Gi,o);for(let o of r)this._drawSourceImpl(e,t,mi,o)}_drawSourceImpl(e,t,i,r){let o=C(this._state),n=o.model().hoveredSource(),a=n!==null&&n.source===r,l=n!==null&&a&&n.object!==void 0?n.object.hitTestData:void 0;qi(t,u=>i(u,e,a,l),r,o)}_recreatePriceAxisWidgets(){if(this._state===null)return;let e=this._chart,t=this._state.leftPriceScale().options().visible,i=this._state.rightPriceScale().options().visible;!t&&this._leftPriceAxisWidget!==null&&(this._leftAxisCell.removeChild(this._leftPriceAxisWidget.getElement()),this._leftPriceAxisWidget.destroy(),this._leftPriceAxisWidget=null),!i&&this._rightPriceAxisWidget!==null&&(this._rightAxisCell.removeChild(this._rightPriceAxisWidget.getElement()),this._rightPriceAxisWidget.destroy(),this._rightPriceAxisWidget=null);let r=e.model().rendererOptionsProvider();t&&this._leftPriceAxisWidget===null&&(this._leftPriceAxisWidget=new Zi(this,e.options(),r,"left"),this._leftAxisCell.appendChild(this._leftPriceAxisWidget.getElement())),i&&this._rightPriceAxisWidget===null&&(this._rightPriceAxisWidget=new Zi(this,e.options(),r,"right"),this._rightAxisCell.appendChild(this._rightPriceAxisWidget.getElement()))}_preventScroll(e){return e.isTouch&&this._longTap||this._startTrackPoint!==null}_correctXCoord(e){return Math.max(0,Math.min(e,this._size.width-1))}_correctYCoord(e){return Math.max(0,Math.min(e,this._size.height-1))}_setCrosshairPosition(e,t,i){this._model().setAndSaveCurrentPosition(this._correctXCoord(e),this._correctYCoord(t),i,C(this._state))}_clearCrosshairPosition(){this._model().clearCurrentPosition()}_tryExitTrackingMode(){this._exitTrackingModeOnNextTry&&(this._startTrackPoint=null,this._clearCrosshairPosition())}_startTrackingMode(e,t,i){this._startTrackPoint=e,this._exitTrackingModeOnNextTry=!1,this._setCrosshairPosition(t.x,t.y,i);let r=this._model().crosshairSource();this._initCrosshairPosition={x:r.appliedX(),y:r.appliedY()}}_model(){return this._chart.model()}_endScroll(e){if(!this._isScrolling)return;let t=this._model(),i=this.state();if(t.endScrollPrice(i,i.defaultPriceScale()),this._startScrollingPos=null,this._isScrolling=!1,t.endScrollTime(),this._scrollXAnimation!==null){let r=performance.now(),o=t.timeScale();this._scrollXAnimation.start(o.rightOffset(),r),this._scrollXAnimation.finished(r)||t.setTimeScaleAnimation(this._scrollXAnimation)}}_onMouseEvent(){this._startTrackPoint=null}_mouseTouchDownEvent(){if(!this._state)return;if(this._model().stopTimeScaleAnimation(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)C(document.activeElement).blur();else{let t=document.getSelection();t!==null&&t.removeAllRanges()}this._state.defaultPriceScale().isEmpty()||this._model().timeScale().isEmpty()}_pressedMouseTouchMoveEvent(e){if(this._state===null)return;let t=this._model(),i=t.timeScale();if(i.isEmpty())return;let r=this._chart.options(),o=r.handleScroll,n=r.kineticScroll;if((!o.pressedMouseMove||e.isTouch)&&(!o.horzTouchDrag&&!o.vertTouchDrag||!e.isTouch))return;let a=this._state.defaultPriceScale(),l=performance.now();if(this._startScrollingPos===null&&!this._preventScroll(e)&&(this._startScrollingPos={x:e.clientX,y:e.clientY,timestamp:l,localX:e.localX,localY:e.localY}),this._startScrollingPos!==null&&!this._isScrolling&&(this._startScrollingPos.x!==e.clientX||this._startScrollingPos.y!==e.clientY)){if(e.isTouch&&n.touch||!e.isTouch&&n.mouse){let d=i.barSpacing();this._scrollXAnimation=new so(.2/d,7/d,.997,15/d),this._scrollXAnimation.addPosition(i.rightOffset(),this._startScrollingPos.timestamp)}else this._scrollXAnimation=null;a.isEmpty()||t.startScrollPrice(this._state,a,e.localY),t.startScrollTime(e.localX),this._isScrolling=!0}this._isScrolling&&(a.isEmpty()||t.scrollPriceTo(this._state,a,e.localY),t.scrollTimeTo(e.localX),this._scrollXAnimation!==null&&this._scrollXAnimation.addPosition(i.rightOffset(),l))}};c();h();c();h();var Ki=class{constructor(e,t,i,r,o){this._invalidated=!0,this._size=O({width:0,height:0}),this._canvasSuggestedBitmapSizeChangedHandler=()=>this.paint(3),this._isLeft=e==="left",this._rendererOptionsProvider=i.rendererOptionsProvider,this._options=t,this._borderVisible=r,this._bottomColor=o,this._cell=document.createElement("div"),this._cell.style.width="25px",this._cell.style.height="100%",this._cell.style.overflow="hidden",this._canvasBinding=Oe(this._cell,O({width:16,height:16})),this._canvasBinding.subscribeSuggestedBitmapSizeChanged(this._canvasSuggestedBitmapSizeChangedHandler)}destroy(){this._canvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._canvasSuggestedBitmapSizeChangedHandler),Ve(this._canvasBinding.canvasElement),this._canvasBinding.dispose()}getElement(){return this._cell}getSize(){return this._size}setSize(e){Ce(this._size,e)||(this._size=e,this._canvasBinding.resizeCanvasElement(e),this._cell.style.width=`${e.width}px`,this._cell.style.height=`${e.height}px`,this._invalidated=!0)}paint(e){if(e<3&&!this._invalidated||this._size.width===0||this._size.height===0)return;this._invalidated=!1,this._canvasBinding.applySuggestedBitmapSize();let t=Pe(this._canvasBinding);t!==null&&t.useBitmapCoordinateSpace(i=>{this._drawBackground(i),this._drawBorder(i)})}getBitmapSize(){return this._canvasBinding.bitmapSize}drawBitmap(e,t,i){let r=this.getBitmapSize();r.width>0&&r.height>0&&e.drawImage(this._canvasBinding.canvasElement,t,i)}_drawBorder({context:e,bitmapSize:t,horizontalPixelRatio:i,verticalPixelRatio:r}){if(!this._borderVisible())return;e.fillStyle=this._options.timeScale.borderColor;let o=Math.floor(this._rendererOptionsProvider.options().borderSize*i),n=Math.floor(this._rendererOptionsProvider.options().borderSize*r),a=this._isLeft?t.width-o:0;e.fillRect(a,0,o,n)}_drawBackground({context:e,bitmapSize:t}){vt(e,0,0,t.width,t.height,this._bottomColor())}};var Eh;(function(s){s[s.BorderSize=1]="BorderSize",s[s.TickLength=5]="TickLength"})(Eh||(Eh={}));var Lh;(function(s){s[s.Default=0]="Default",s[s.EwResize=1]="EwResize"})(Lh||(Lh={}));function On(s){return e=>{var t,i;return(i=(t=e.timePaneViews)===null||t===void 0?void 0:t.call(e,s))!==null&&i!==void 0?i:[]}}var __=On("normal"),m_=On("top"),p_=On("bottom"),lo=class{constructor(e,t){this._leftStub=null,this._rightStub=null,this._rendererOptions=null,this._mouseDown=!1,this._size=O({width:0,height:0}),this._sizeChanged=new L,this._widthCache=new Le(5),this._isSettingSize=!1,this._canvasSuggestedBitmapSizeChangedHandler=()=>{this._isSettingSize||this._chart.model().lightUpdate()},this._topCanvasSuggestedBitmapSizeChangedHandler=()=>{this._isSettingSize||this._chart.model().lightUpdate()},this._chart=e,this._horzScaleBehavior=t,this._options=e.options().layout,this._element=document.createElement("tr"),this._leftStubCell=document.createElement("td"),this._leftStubCell.style.padding="0",this._rightStubCell=document.createElement("td"),this._rightStubCell.style.padding="0",this._cell=document.createElement("td"),this._cell.style.height="25px",this._cell.style.padding="0",this._dv=document.createElement("div"),this._dv.style.width="100%",this._dv.style.height="100%",this._dv.style.position="relative",this._dv.style.overflow="hidden",this._cell.appendChild(this._dv),this._canvasBinding=Oe(this._dv,O({width:16,height:16})),this._canvasBinding.subscribeSuggestedBitmapSizeChanged(this._canvasSuggestedBitmapSizeChangedHandler);let i=this._canvasBinding.canvasElement;i.style.position="absolute",i.style.zIndex="1",i.style.left="0",i.style.top="0",this._topCanvasBinding=Oe(this._dv,O({width:16,height:16})),this._topCanvasBinding.subscribeSuggestedBitmapSizeChanged(this._topCanvasSuggestedBitmapSizeChangedHandler);let r=this._topCanvasBinding.canvasElement;r.style.position="absolute",r.style.zIndex="2",r.style.left="0",r.style.top="0",this._element.appendChild(this._leftStubCell),this._element.appendChild(this._cell),this._element.appendChild(this._rightStubCell),this._recreateStubs(),this._chart.model().priceScalesOptionsChanged().subscribe(this._recreateStubs.bind(this),this),this._mouseEventHandler=new At(this._topCanvasBinding.canvasElement,this,{treatVertTouchDragAsPageScroll:()=>!0,treatHorzTouchDragAsPageScroll:()=>!this._chart.options().handleScroll.horzTouchDrag})}destroy(){this._mouseEventHandler.destroy(),this._leftStub!==null&&this._leftStub.destroy(),this._rightStub!==null&&this._rightStub.destroy(),this._topCanvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._topCanvasSuggestedBitmapSizeChangedHandler),Ve(this._topCanvasBinding.canvasElement),this._topCanvasBinding.dispose(),this._canvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._canvasSuggestedBitmapSizeChangedHandler),Ve(this._canvasBinding.canvasElement),this._canvasBinding.dispose()}getElement(){return this._element}leftStub(){return this._leftStub}rightStub(){return this._rightStub}mouseDownEvent(e){if(this._mouseDown)return;this._mouseDown=!0;let t=this._chart.model();t.timeScale().isEmpty()||!this._chart.options().handleScale.axisPressedMouseMove.time||t.startScaleTime(e.localX)}touchStartEvent(e){this.mouseDownEvent(e)}mouseDownOutsideEvent(){let e=this._chart.model();!e.timeScale().isEmpty()&&this._mouseDown&&(this._mouseDown=!1,this._chart.options().handleScale.axisPressedMouseMove.time&&e.endScaleTime())}pressedMouseMoveEvent(e){let t=this._chart.model();t.timeScale().isEmpty()||!this._chart.options().handleScale.axisPressedMouseMove.time||t.scaleTimeTo(e.localX)}touchMoveEvent(e){this.pressedMouseMoveEvent(e)}mouseUpEvent(){this._mouseDown=!1;let e=this._chart.model();e.timeScale().isEmpty()&&!this._chart.options().handleScale.axisPressedMouseMove.time||e.endScaleTime()}touchEndEvent(){this.mouseUpEvent()}mouseDoubleClickEvent(){this._chart.options().handleScale.axisDoubleClickReset.time&&this._chart.model().resetTimeScale()}doubleTapEvent(){this.mouseDoubleClickEvent()}mouseEnterEvent(){this._chart.model().options().handleScale.axisPressedMouseMove.time&&this._setCursor(1)}mouseLeaveEvent(){this._setCursor(0)}getSize(){return this._size}sizeChanged(){return this._sizeChanged}setSizes(e,t,i){Ce(this._size,e)||(this._size=e,this._isSettingSize=!0,this._canvasBinding.resizeCanvasElement(e),this._topCanvasBinding.resizeCanvasElement(e),this._isSettingSize=!1,this._cell.style.width=`${e.width}px`,this._cell.style.height=`${e.height}px`,this._sizeChanged.fire(e)),this._leftStub!==null&&this._leftStub.setSize(O({width:t,height:e.height})),this._rightStub!==null&&this._rightStub.setSize(O({width:i,height:e.height}))}optimalHeight(){let e=this._getRendererOptions();return Math.ceil(e.borderSize+e.tickLength+e.fontSize+e.paddingTop+e.paddingBottom+e.labelBottomOffset)}update(){this._chart.model().timeScale().marks()}getBitmapSize(){return this._canvasBinding.bitmapSize}drawBitmap(e,t,i){let r=this.getBitmapSize();r.width>0&&r.height>0&&e.drawImage(this._canvasBinding.canvasElement,t,i)}paint(e){if(e===0)return;if(e!==1){this._canvasBinding.applySuggestedBitmapSize();let i=Pe(this._canvasBinding);i!==null&&(i.useBitmapCoordinateSpace(r=>{this._drawBackground(r),this._drawBorder(r),this._drawAdditionalSources(i,p_)}),this._drawTickMarks(i),this._drawAdditionalSources(i,__)),this._leftStub!==null&&this._leftStub.paint(e),this._rightStub!==null&&this._rightStub.paint(e)}this._topCanvasBinding.applySuggestedBitmapSize();let t=Pe(this._topCanvasBinding);t!==null&&(t.useBitmapCoordinateSpace(({context:i,bitmapSize:r})=>{i.clearRect(0,0,r.width,r.height)}),this._drawLabels([...this._chart.model().serieses(),this._chart.model().crosshairSource()],t),this._drawAdditionalSources(t,m_))}_drawAdditionalSources(e,t){let i=this._chart.model().serieses();for(let r of i)qi(t,o=>Gi(o,e,!1,void 0),r,void 0);for(let r of i)qi(t,o=>mi(o,e,!1,void 0),r,void 0)}_drawBackground({context:e,bitmapSize:t}){vt(e,0,0,t.width,t.height,this._chart.model().backgroundBottomColor())}_drawBorder({context:e,bitmapSize:t,verticalPixelRatio:i}){if(this._chart.options().timeScale.borderVisible){e.fillStyle=this._lineColor();let r=Math.max(1,Math.floor(this._getRendererOptions().borderSize*i));e.fillRect(0,0,t.width,r)}}_drawTickMarks(e){let t=this._chart.model().timeScale(),i=t.marks();if(!i||i.length===0)return;let r=this._horzScaleBehavior.maxTickMarkWeight(i),o=this._getRendererOptions(),n=t.options();n.borderVisible&&n.ticksVisible&&e.useBitmapCoordinateSpace(({context:a,horizontalPixelRatio:l,verticalPixelRatio:d})=>{a.strokeStyle=this._lineColor(),a.fillStyle=this._lineColor();let u=Math.max(1,Math.floor(l)),_=Math.floor(l*.5);a.beginPath();let f=Math.round(o.tickLength*d);for(let m=i.length;m--;){let g=Math.round(i[m].coord*l);a.rect(g-_,0,u,f)}a.fill()}),e.useMediaCoordinateSpace(({context:a})=>{let l=o.borderSize+o.tickLength+o.paddingTop+o.fontSize/2;a.textAlign="center",a.textBaseline="middle",a.fillStyle=this._textColor(),a.font=this._baseFont();for(let d of i)if(d.weight<r){let u=d.needAlignCoordinate?this._alignTickMarkLabelCoordinate(a,d.coord,d.label):d.coord;a.fillText(d.label,u,l)}this._chart.options().timeScale.allowBoldLabels&&(a.font=this._baseBoldFont());for(let d of i)if(d.weight>=r){let u=d.needAlignCoordinate?this._alignTickMarkLabelCoordinate(a,d.coord,d.label):d.coord;a.fillText(d.label,u,l)}})}_alignTickMarkLabelCoordinate(e,t,i){let r=this._widthCache.measureText(e,i),o=r/2,n=Math.floor(t-o)+.5;return n<0?t=t+Math.abs(0-n):n+r>this._size.width&&(t=t-Math.abs(this._size.width-(n+r))),t}_drawLabels(e,t){let i=this._getRendererOptions();for(let r of e)for(let o of r.timeAxisViews())o.renderer().draw(t,i)}_lineColor(){return this._chart.options().timeScale.borderColor}_textColor(){return this._options.textColor}_fontSize(){return this._options.fontSize}_baseFont(){return Se(this._fontSize(),this._options.fontFamily)}_baseBoldFont(){return Se(this._fontSize(),this._options.fontFamily,"bold")}_getRendererOptions(){this._rendererOptions===null&&(this._rendererOptions={borderSize:1,baselineOffset:NaN,paddingTop:NaN,paddingBottom:NaN,paddingHorizontal:NaN,tickLength:5,fontSize:NaN,font:"",widthCache:new Le,labelBottomOffset:0});let e=this._rendererOptions,t=this._baseFont();if(e.font!==t){let i=this._fontSize();e.fontSize=i,e.font=t,e.paddingTop=3*i/12,e.paddingBottom=3*i/12,e.paddingHorizontal=9*i/12,e.baselineOffset=0,e.labelBottomOffset=4*i/12,e.widthCache.reset()}return this._rendererOptions}_setCursor(e){this._cell.style.cursor=e===1?"ew-resize":"default"}_recreateStubs(){let e=this._chart.model(),t=e.options();!t.leftPriceScale.visible&&this._leftStub!==null&&(this._leftStubCell.removeChild(this._leftStub.getElement()),this._leftStub.destroy(),this._leftStub=null),!t.rightPriceScale.visible&&this._rightStub!==null&&(this._rightStubCell.removeChild(this._rightStub.getElement()),this._rightStub.destroy(),this._rightStub=null);let r={rendererOptionsProvider:this._chart.model().rendererOptionsProvider()},o=()=>t.leftPriceScale.borderVisible&&e.timeScale().options().borderVisible,n=()=>e.backgroundBottomColor();t.leftPriceScale.visible&&this._leftStub===null&&(this._leftStub=new Ki("left",t,r,o,n),this._leftStubCell.appendChild(this._leftStub.getElement())),t.rightPriceScale.visible&&this._rightStub===null&&(this._rightStub=new Ki("right",t,r,o,n),this._rightStubCell.appendChild(this._rightStub.getElement()))}};var g_=xh()&&Ch(),co=class{constructor(e,t,i){this._paneWidgets=[],this._drawRafId=0,this._height=0,this._width=0,this._leftPriceAxisWidth=0,this._rightPriceAxisWidth=0,this._invalidateMask=null,this._drawPlanned=!1,this._clicked=new L,this._dblClicked=new L,this._crosshairMoved=new L,this._observer=null,this._cursorStyleOverride=null,this._container=e,this._options=t,this._horzScaleBehavior=i,this._element=document.createElement("div"),this._element.classList.add("tv-lightweight-charts"),this._element.style.overflow="hidden",this._element.style.direction="ltr",this._element.style.width="100%",this._element.style.height="100%",b_(this._element),this._tableElement=document.createElement("table"),this._tableElement.setAttribute("cellspacing","0"),this._element.appendChild(this._tableElement),this._onWheelBound=this._onMousewheel.bind(this),Vn(this._options)&&this._setMouseWheelEventListener(!0),this._model=new Zr(this._invalidateHandler.bind(this),this._options,i),this.model().crosshairMoved().subscribe(this._onPaneWidgetCrosshairMoved.bind(this),this),this._timeAxisWidget=new lo(this,this._horzScaleBehavior),this._tableElement.appendChild(this._timeAxisWidget.getElement());let r=t.autoSize&&this._installObserver(),o=this._options.width,n=this._options.height;if(r||o===0||n===0){let a=e.getBoundingClientRect();o=o||a.width,n=n||a.height}this.resize(o,n),this._syncGuiWithModel(),e.appendChild(this._element),this._updateTimeAxisVisibility(),this._model.timeScale().optionsApplied().subscribe(this._model.fullUpdate.bind(this._model),this),this._model.priceScalesOptionsChanged().subscribe(this._model.fullUpdate.bind(this._model),this)}model(){return this._model}options(){return this._options}paneWidgets(){return this._paneWidgets}timeAxisWidget(){return this._timeAxisWidget}destroy(){this._setMouseWheelEventListener(!1),this._drawRafId!==0&&window.cancelAnimationFrame(this._drawRafId),this._model.crosshairMoved().unsubscribeAll(this),this._model.timeScale().optionsApplied().unsubscribeAll(this),this._model.priceScalesOptionsChanged().unsubscribeAll(this),this._model.destroy();for(let e of this._paneWidgets)this._tableElement.removeChild(e.getElement()),e.clicked().unsubscribeAll(this),e.dblClicked().unsubscribeAll(this),e.destroy();this._paneWidgets=[],C(this._timeAxisWidget).destroy(),this._element.parentElement!==null&&this._element.parentElement.removeChild(this._element),this._crosshairMoved.destroy(),this._clicked.destroy(),this._dblClicked.destroy(),this._uninstallObserver()}resize(e,t,i=!1){if(this._height===t&&this._width===e)return;let r=wh(O({width:e,height:t}));this._height=r.height,this._width=r.width;let o=this._height+"px",n=this._width+"px";C(this._element).style.height=o,C(this._element).style.width=n,this._tableElement.style.height=o,this._tableElement.style.width=n,i?this._drawImpl(K.full(),performance.now()):this._model.fullUpdate()}paint(e){e===void 0&&(e=K.full());for(let t=0;t<this._paneWidgets.length;t++)this._paneWidgets[t].paint(e.invalidateForPane(t).level);this._options.timeScale.visible&&this._timeAxisWidget.paint(e.fullInvalidation())}applyOptions(e){let t=Vn(this._options);this._model.applyOptions(e);let i=Vn(this._options);i!==t&&this._setMouseWheelEventListener(i),this._updateTimeAxisVisibility(),this._applyAutoSizeOptions(e)}clicked(){return this._clicked}dblClicked(){return this._dblClicked}crosshairMoved(){return this._crosshairMoved}takeScreenshot(){this._invalidateMask!==null&&(this._drawImpl(this._invalidateMask,performance.now()),this._invalidateMask=null);let e=this._traverseLayout(null),t=document.createElement("canvas");t.width=e.width,t.height=e.height;let i=C(t.getContext("2d"));return this._traverseLayout(i),t}getPriceAxisWidth(e){if(e==="left"&&!this._isLeftAxisVisible()||e==="right"&&!this._isRightAxisVisible()||this._paneWidgets.length===0)return 0;let t=e==="left"?this._paneWidgets[0].leftPriceAxisWidget():this._paneWidgets[0].rightPriceAxisWidget();return C(t).getWidth()}autoSizeActive(){return this._options.autoSize&&this._observer!==null}element(){return this._element}setCursorStyle(e){this._cursorStyleOverride=e,this._cursorStyleOverride?this.element().style.setProperty("cursor",e):this.element().style.removeProperty("cursor")}getCursorOverrideStyle(){return this._cursorStyleOverride}paneSize(){return Y(this._paneWidgets[0]).getSize()}_applyAutoSizeOptions(e){if(e.autoSize===void 0&&this._observer&&(e.width!==void 0||e.height!==void 0)){return}e.autoSize&&!this._observer&&this._installObserver(),e.autoSize===!1&&this._observer!==null&&this._uninstallObserver(),!e.autoSize&&(e.width!==void 0||e.height!==void 0)&&this.resize(e.width||this._width,e.height||this._height)}_traverseLayout(e){let t=0,i=0,r=this._paneWidgets[0],o=(l,d)=>{let u=0;for(let _=0;_<this._paneWidgets.length;_++){let f=this._paneWidgets[_],m=C(l==="left"?f.leftPriceAxisWidget():f.rightPriceAxisWidget()),g=m.getBitmapSize();e!==null&&m.drawBitmap(e,d,u),u+=g.height}};if(this._isLeftAxisVisible()){o("left",0);let l=C(r.leftPriceAxisWidget()).getBitmapSize().width;t+=l}for(let l=0;l<this._paneWidgets.length;l++){let d=this._paneWidgets[l],u=d.getBitmapSize();e!==null&&d.drawBitmap(e,t,i),i+=u.height}let n=r.getBitmapSize().width;if(t+=n,this._isRightAxisVisible()){o("right",t);let l=C(r.rightPriceAxisWidget()).getBitmapSize().width;t+=l}let a=(l,d,u)=>{C(l==="left"?this._timeAxisWidget.leftStub():this._timeAxisWidget.rightStub()).drawBitmap(C(e),d,u)};if(this._options.timeScale.visible){let l=this._timeAxisWidget.getBitmapSize();if(e!==null){let d=0;this._isLeftAxisVisible()&&(a("left",d,i),d=C(r.leftPriceAxisWidget()).getBitmapSize().width),this._timeAxisWidget.drawBitmap(e,d,i),d+=l.width,this._isRightAxisVisible()&&a("right",d,i)}i+=l.height}return O({width:t,height:i})}_adjustSizeImpl(){let e=0,t=0,i=0;for(let g of this._paneWidgets)this._isLeftAxisVisible()&&(t=Math.max(t,C(g.leftPriceAxisWidget()).optimalWidth(),this._options.leftPriceScale.minimumWidth)),this._isRightAxisVisible()&&(i=Math.max(i,C(g.rightPriceAxisWidget()).optimalWidth(),this._options.rightPriceScale.minimumWidth)),e+=g.stretchFactor();t=ji(t),i=ji(i);let r=this._width,o=this._height,n=Math.max(r-t-i,0),a=0,l=this._options.timeScale.visible,d=l?Math.max(this._timeAxisWidget.optimalHeight(),this._options.timeScale.minimumHeight):0;d=yh(d);let u=a+d,_=o<u?0:o-u,f=_/e,m=0;for(let g=0;g<this._paneWidgets.length;++g){let b=this._paneWidgets[g];b.setState(this._model.panes()[g]);let S=0,v=0;g===this._paneWidgets.length-1?v=_-m:v=Math.round(b.stretchFactor()*f),S=Math.max(v,2),m+=S,b.setSize(O({width:n,height:S})),this._isLeftAxisVisible()&&b.setPriceAxisSize(t,"left"),this._isRightAxisVisible()&&b.setPriceAxisSize(i,"right"),b.state()&&this._model.setPaneHeight(b.state(),S)}this._timeAxisWidget.setSizes(O({width:l?n:0,height:d}),l?t:0,l?i:0),this._model.setWidth(n),this._leftPriceAxisWidth!==t&&(this._leftPriceAxisWidth=t),this._rightPriceAxisWidth!==i&&(this._rightPriceAxisWidth=i)}_setMouseWheelEventListener(e){if(e){this._element.addEventListener("wheel",this._onWheelBound,{passive:!1});return}this._element.removeEventListener("wheel",this._onWheelBound)}_determineWheelSpeedAdjustment(e){switch(e.deltaMode){case e.DOM_DELTA_PAGE:return 120;case e.DOM_DELTA_LINE:return 32}return g_?1/window.devicePixelRatio:1}_onMousewheel(e){if((e.deltaX===0||!this._options.handleScroll.mouseWheel)&&(e.deltaY===0||!this._options.handleScale.mouseWheel))return;let t=this._determineWheelSpeedAdjustment(e),i=t*e.deltaX/100,r=-(t*e.deltaY/100);if(e.cancelable&&e.preventDefault(),r!==0&&this._options.handleScale.mouseWheel){let o=Math.sign(r)*Math.min(1,Math.abs(r)),n=e.clientX-this._element.getBoundingClientRect().left;this.model().zoomTime(n,o)}i!==0&&this._options.handleScroll.mouseWheel&&this.model().scrollChart(i*-80)}_drawImpl(e,t){var i;let r=e.fullInvalidation();r===3&&this._updateGui(),(r===3||r===2)&&(this._applyMomentaryAutoScale(e),this._applyTimeScaleInvalidations(e,t),this._timeAxisWidget.update(),this._paneWidgets.forEach(o=>{o.updatePriceAxisWidgets()}),((i=this._invalidateMask)===null||i===void 0?void 0:i.fullInvalidation())===3&&(this._invalidateMask.merge(e),this._updateGui(),this._applyMomentaryAutoScale(this._invalidateMask),this._applyTimeScaleInvalidations(this._invalidateMask,t),e=this._invalidateMask,this._invalidateMask=null)),this.paint(e)}_applyTimeScaleInvalidations(e,t){for(let i of e.timeScaleInvalidations())this._applyTimeScaleInvalidation(i,t)}_applyMomentaryAutoScale(e){let t=this._model.panes();for(let i=0;i<t.length;i++)e.invalidateForPane(i).autoScale&&t[i].momentaryAutoScale()}_applyTimeScaleInvalidation(e,t){let i=this._model.timeScale();switch(e.type){case 0:i.fitContent();break;case 1:i.setLogicalRange(e.value);break;case 2:i.setBarSpacing(e.value);break;case 3:i.setRightOffset(e.value);break;case 4:i.restoreDefault();break;case 5:e.value.finished(t)||i.setRightOffset(e.value.getPosition(t));break}}_invalidateHandler(e){this._invalidateMask!==null?this._invalidateMask.merge(e):this._invalidateMask=e,this._drawPlanned||(this._drawPlanned=!0,this._drawRafId=window.requestAnimationFrame(t=>{if(this._drawPlanned=!1,this._drawRafId=0,this._invalidateMask!==null){let i=this._invalidateMask;this._invalidateMask=null,this._drawImpl(i,t);for(let r of i.timeScaleInvalidations())if(r.type===5&&!r.value.finished(t)){this.model().setTimeScaleAnimation(r.value);break}}}))}_updateGui(){this._syncGuiWithModel()}_syncGuiWithModel(){let e=this._model.panes(),t=e.length,i=this._paneWidgets.length;for(let r=t;r<i;r++){let o=Y(this._paneWidgets.pop());this._tableElement.removeChild(o.getElement()),o.clicked().unsubscribeAll(this),o.dblClicked().unsubscribeAll(this),o.destroy()}for(let r=i;r<t;r++){let o=new fi(this,e[r]);o.clicked().subscribe(this._onPaneWidgetClicked.bind(this),this),o.dblClicked().subscribe(this._onPaneWidgetDblClicked.bind(this),this),this._paneWidgets.push(o),this._tableElement.insertBefore(o.getElement(),this._timeAxisWidget.getElement())}for(let r=0;r<t;r++){let o=e[r],n=this._paneWidgets[r];n.state()!==o?n.setState(o):n.updatePriceAxisWidgetsStates()}this._updateTimeAxisVisibility(),this._adjustSizeImpl()}_getMouseEventParamsImpl(e,t,i){var r;let o=new Map;e!==null&&this._model.serieses().forEach(_=>{let f=_.bars().search(e);f!==null&&o.set(_,f)});let n;if(e!==null){let u=(r=this._model.timeScale().indexToTimeScalePoint(e))===null||r===void 0?void 0:r.originalTime;u!==void 0&&(n=u)}let a=this.model().hoveredSource(),l=a!==null&&a.source instanceof Pt?a.source:void 0,d=a!==null&&a.object!==void 0?a.object.externalId:void 0;return{originalTime:n,index:e??void 0,point:t??void 0,hoveredSeries:l,seriesData:o,hoveredObject:d,touchMouseEventData:i??void 0}}_onPaneWidgetClicked(e,t,i){this._clicked.fire(()=>this._getMouseEventParamsImpl(e,t,i))}_onPaneWidgetDblClicked(e,t,i){this._dblClicked.fire(()=>this._getMouseEventParamsImpl(e,t,i))}_onPaneWidgetCrosshairMoved(e,t,i){this._crosshairMoved.fire(()=>this._getMouseEventParamsImpl(e,t,i))}_updateTimeAxisVisibility(){let e=this._options.timeScale.visible?"":"none";this._timeAxisWidget.getElement().style.display=e}_isLeftAxisVisible(){return this._paneWidgets[0].state().leftPriceScale().options().visible}_isRightAxisVisible(){return this._paneWidgets[0].state().rightPriceScale().options().visible}_installObserver(){return"ResizeObserver"in window?(this._observer=new ResizeObserver(e=>{let t=e.find(i=>i.target===this._container);!t||this.resize(t.contentRect.width,t.contentRect.height)}),this._observer.observe(this._container,{box:"border-box"}),!0):!1}_uninstallObserver(){this._observer!==null&&this._observer.disconnect(),this._observer=null}};function b_(s){s.style.userSelect="none",s.style.webkitUserSelect="none",s.style.msUserSelect="none",s.style.MozUserSelect="none",s.style.webkitTapHighlightColor="transparent"}function Vn(s){return Boolean(s.handleScroll.mouseWheel||s.handleScale.mouseWheel)}c();h();function Oh(s){return s.open===void 0&&s.value===void 0}function Rn(s){return s.open!==void 0||s.value!==void 0}c();h();c();h();function Vh(s,e,t,i){let r=t.value,o={index:e,time:s,value:[r,r,r,r],originalTime:i};return t.color!==void 0&&(o.color=t.color),t.borderColor!==void 0&&(o.borderColor=t.borderColor),o}function v_(s,e,t,i){let r=t.value,o={index:e,time:s,value:[r,r,r,r],originalTime:i};return t.lineColor!==void 0&&(o.lineColor=t.lineColor),t.topColor!==void 0&&(o.topColor=t.topColor),t.bottomColor!==void 0&&(o.bottomColor=t.bottomColor),o}function S_(s,e,t,i){let r=t.value,o={index:e,time:s,value:[r,r,r,r],originalTime:i};return t.topLineColor!==void 0&&(o.topLineColor=t.topLineColor),t.bottomLineColor!==void 0&&(o.bottomLineColor=t.bottomLineColor),t.topFillColor1!==void 0&&(o.topFillColor1=t.topFillColor1),t.topFillColor2!==void 0&&(o.topFillColor2=t.topFillColor2),t.bottomFillColor1!==void 0&&(o.bottomFillColor1=t.bottomFillColor1),t.bottomFillColor2!==void 0&&(o.bottomFillColor2=t.bottomFillColor2),o}function C_(s,e,t,i){let r={index:e,time:s,value:[t.open,t.high,t.low,t.close],originalTime:i};return t.color!==void 0&&(r.color=t.color),r}function x_(s,e,t,i){let r={index:e,time:s,value:[t.open,t.high,t.low,t.close],originalTime:i};return t.color!==void 0&&(r.color=t.color),t.borderColor!==void 0&&(r.borderColor=t.borderColor),t.wickColor!==void 0&&(r.wickColor=t.wickColor),r}function w_(s,e,t,i,r){let o=Y(r)(t),n=Math.max(...o),a=Math.min(...o),l=o[o.length-1],d=[l,n,a,l],u=t,{time:_,color:f}=u,m=Lt(u,["time","color"]);return{index:e,time:s,value:d,originalTime:i,data:m,color:f}}function Qi(s){return s.value!==void 0}function Rh(s,e){return e.customValues!==void 0&&(s.customValues=e.customValues),s}function y_(s,e){return e?e(s):Oh(s)}function Ut(s){return(e,t,i,r,o,n)=>y_(i,n)?Rh({time:e,index:t,originalTime:r},i):Rh(s(e,t,i,r,o),i)}function zn(s){return{Candlestick:Ut(x_),Bar:Ut(C_),Area:Ut(v_),Baseline:Ut(S_),Histogram:Ut(Vh),Line:Ut(Vh),Custom:Ut(w_)}[s]}function zh(s){return{index:0,mapping:new Map,timePoint:s}}function Nh(s,e){if(!(s===void 0||s.length===0))return{firstTime:e.key(s[0].time),lastTime:e.key(s[s.length-1].time)}}function T_(s,e,t){let i=Nh(s,t),r=Nh(e,t);if(i!==void 0&&r!==void 0)return{lastBarUpdatedOrNewBarsAddedToTheRight:i.lastTime>=r.lastTime&&i.firstTime>=r.firstTime}}function Wh(s){let e;return s.forEach(t=>{e===void 0&&(e=t.originalTime)}),Y(e)}function k_(s){s.originalTime===void 0&&(s.originalTime=s.time)}var ho=class{constructor(e){this._pointDataByTimePoint=new Map,this._seriesRowsBySeries=new Map,this._seriesLastTimePoint=new Map,this._sortedTimePoints=[],this._horzScaleBehavior=e}destroy(){this._pointDataByTimePoint.clear(),this._seriesRowsBySeries.clear(),this._seriesLastTimePoint.clear(),this._sortedTimePoints=[]}setSeriesData(e,t){let i=this._pointDataByTimePoint.size!==0,r=!1,o=this._seriesRowsBySeries.get(e);if(o!==void 0)if(this._seriesRowsBySeries.size===1)i=!1,r=!0,this._pointDataByTimePoint.clear();else for(let l of this._sortedTimePoints)l.pointData.mapping.delete(e)&&(r=!0);let n=[];if(t.length!==0){let l=t.map(m=>m.time),d=this._horzScaleBehavior.createConverterToInternalObj(t),u=zn(e.seriesType()),_=e.customSeriesPlotValuesBuilder(),f=e.customSeriesWhitespaceCheck();n=t.map((m,g)=>{let b=d(m.time),S=this._horzScaleBehavior.key(b),v=this._pointDataByTimePoint.get(S);v===void 0&&(v=zh(b),this._pointDataByTimePoint.set(S,v),r=!0);let x=u(b,v.index,m,l[g],_,f);return v.mapping.set(e,x),x})}i&&this._cleanupPointsData(),this._setRowsToSeries(e,n);let a=-1;if(r){let l=[];this._pointDataByTimePoint.forEach(d=>{l.push({timeWeight:0,time:d.timePoint,pointData:d,originalTime:Wh(d.mapping)})}),l.sort((d,u)=>this._horzScaleBehavior.key(d.time)-this._horzScaleBehavior.key(u.time)),a=this._replaceTimeScalePoints(l)}return this._getUpdateResponse(e,a,T_(this._seriesRowsBySeries.get(e),o,this._horzScaleBehavior))}removeSeries(e){return this.setSeriesData(e,[])}updateSeriesData(e,t){let i=t;k_(i),this._horzScaleBehavior.preprocessData(t);let o=this._horzScaleBehavior.createConverterToInternalObj([t])(t.time),n=this._seriesLastTimePoint.get(e);if(n!==void 0&&this._horzScaleBehavior.key(o)<this._horzScaleBehavior.key(n))throw new Error(`Cannot update oldest data, last time=${n}, new time=${o}`);let a=this._pointDataByTimePoint.get(this._horzScaleBehavior.key(o)),l=a===void 0;a===void 0&&(a=zh(o),this._pointDataByTimePoint.set(this._horzScaleBehavior.key(o),a));let d=zn(e.seriesType()),u=e.customSeriesPlotValuesBuilder(),_=e.customSeriesWhitespaceCheck(),f=d(o,a.index,t,i.originalTime,u,_);a.mapping.set(e,f),this._updateLastSeriesRow(e,f);let m={lastBarUpdatedOrNewBarsAddedToTheRight:Qi(f)};if(!l)return this._getUpdateResponse(e,-1,m);let g={timeWeight:0,time:a.timePoint,pointData:a,originalTime:Wh(a.mapping)},b=qe(this._sortedTimePoints,this._horzScaleBehavior.key(g.time),(S,v)=>this._horzScaleBehavior.key(S.time)<v);this._sortedTimePoints.splice(b,0,g);for(let S=b;S<this._sortedTimePoints.length;++S)Nn(this._sortedTimePoints[S].pointData,S);return this._horzScaleBehavior.fillWeightsForPoints(this._sortedTimePoints,b),this._getUpdateResponse(e,b,m)}_updateLastSeriesRow(e,t){let i=this._seriesRowsBySeries.get(e);i===void 0&&(i=[],this._seriesRowsBySeries.set(e,i));let r=i.length!==0?i[i.length-1]:null;r===null||this._horzScaleBehavior.key(t.time)>this._horzScaleBehavior.key(r.time)?Qi(t)&&i.push(t):Qi(t)?i[i.length-1]=t:i.splice(-1,1),this._seriesLastTimePoint.set(e,t.time)}_setRowsToSeries(e,t){t.length!==0?(this._seriesRowsBySeries.set(e,t.filter(Qi)),this._seriesLastTimePoint.set(e,t[t.length-1].time)):(this._seriesRowsBySeries.delete(e),this._seriesLastTimePoint.delete(e))}_cleanupPointsData(){for(let e of this._sortedTimePoints)e.pointData.mapping.size===0&&this._pointDataByTimePoint.delete(this._horzScaleBehavior.key(e.time))}_replaceTimeScalePoints(e){let t=-1;for(let i=0;i<this._sortedTimePoints.length&&i<e.length;++i){let r=this._sortedTimePoints[i],o=e[i];if(this._horzScaleBehavior.key(r.time)!==this._horzScaleBehavior.key(o.time)){t=i;break}o.timeWeight=r.timeWeight,Nn(o.pointData,i)}if(t===-1&&this._sortedTimePoints.length!==e.length&&(t=Math.min(this._sortedTimePoints.length,e.length)),t===-1)return-1;for(let i=t;i<e.length;++i)Nn(e[i].pointData,i);return this._horzScaleBehavior.fillWeightsForPoints(e,t),this._sortedTimePoints=e,t}_getBaseIndex(){if(this._seriesRowsBySeries.size===0)return null;let e=0;return this._seriesRowsBySeries.forEach(t=>{t.length!==0&&(e=Math.max(e,t[t.length-1].index))}),e}_getUpdateResponse(e,t,i){let r={series:new Map,timeScale:{baseIndex:this._getBaseIndex()}};if(t!==-1)this._seriesRowsBySeries.forEach((o,n)=>{r.series.set(n,{data:o,info:n===e?i:void 0})}),this._seriesRowsBySeries.has(e)||r.series.set(e,{data:[],info:i}),r.timeScale.points=this._sortedTimePoints,r.timeScale.firstChangedPointIndex=t;else{let o=this._seriesRowsBySeries.get(e);r.series.set(e,{data:o||[],info:i})}return r}};function Nn(s,e){s.index=e,s.mapping.forEach(t=>{t.index=e})}c();h();function Wn(s){let e={value:s.value[3],time:s.originalTime};return s.customValues!==void 0&&(e.customValues=s.customValues),e}function Fh(s){let e=Wn(s);return s.color!==void 0&&(e.color=s.color),e}function P_(s){let e=Wn(s);return s.lineColor!==void 0&&(e.lineColor=s.lineColor),s.topColor!==void 0&&(e.topColor=s.topColor),s.bottomColor!==void 0&&(e.bottomColor=s.bottomColor),e}function M_(s){let e=Wn(s);return s.topLineColor!==void 0&&(e.topLineColor=s.topLineColor),s.bottomLineColor!==void 0&&(e.bottomLineColor=s.bottomLineColor),s.topFillColor1!==void 0&&(e.topFillColor1=s.topFillColor1),s.topFillColor2!==void 0&&(e.topFillColor2=s.topFillColor2),s.bottomFillColor1!==void 0&&(e.bottomFillColor1=s.bottomFillColor1),s.bottomFillColor2!==void 0&&(e.bottomFillColor2=s.bottomFillColor2),e}function Hh(s){let e={open:s.value[0],high:s.value[1],low:s.value[2],close:s.value[3],time:s.originalTime};return s.customValues!==void 0&&(e.customValues=s.customValues),e}function A_(s){let e=Hh(s);return s.color!==void 0&&(e.color=s.color),e}function I_(s){let e=Hh(s),{color:t,borderColor:i,wickColor:r}=s;return t!==void 0&&(e.color=t),i!==void 0&&(e.borderColor=i),r!==void 0&&(e.wickColor=r),e}function Ji(s){return{Area:P_,Line:Fh,Baseline:M_,Histogram:Fh,Bar:A_,Candlestick:I_,Custom:B_}[s]}function B_(s){let e=s.originalTime;return Object.assign(Object.assign({},s.data),{time:e})}c();h();c();h();var Uh={vertLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},horzLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},mode:1};c();h();var Yh={vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}};c();h();var $h={background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:12,fontFamily:Ei()};c();h();var uo={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,ticksVisible:!1,scaleMargins:{bottom:.1,top:.2},minimumWidth:0,textAlign:""};c();h();var Xh={rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0,allowShiftVisibleRangeOnWhitespaceReplacement:!1,ticksVisible:!1,uniformDistribution:!1,minimumHeight:0,allowBoldLabels:!0};c();h();var jh={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:Ei(),fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"};function Fn(){return{width:0,height:0,autoSize:!1,layout:$h,crosshair:Uh,grid:Yh,overlayPriceScales:Object.assign({},uo),leftPriceScale:Object.assign(Object.assign({},uo),{visible:!1}),rightPriceScale:Object.assign(Object.assign({},uo),{visible:!0}),timeScale:Xh,watermark:jh,localization:{locale:Mt?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:{time:!0,price:!0},mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}}}c();h();var _o=class{constructor(e,t){this._chartWidget=e,this._priceScaleId=t}applyOptions(e){this._chartWidget.model().applyPriceScaleOptions(this._priceScaleId,e)}options(){return this._priceScale().options()}width(){return Ct(this._priceScaleId)?this._chartWidget.getPriceAxisWidth(this._priceScaleId):0}_priceScale(){return C(this._chartWidget.model().findPriceScale(this._priceScaleId)).priceScale}};c();h();c();h();c();h();function Hn(s,e,t){let{time:i,originalTime:r}=s,o=Lt(s,["time","originalTime"]),n=Object.assign({time:e},o);return t!==void 0&&(n.originalTime=t),n}c();h();c();h();c();h();c();h();var gi;(function(s){s[s.Buy=1]="Buy",s[s.Sell=-1]="Sell"})(gi||(gi={}));var Un=null;function D_(){return Un||(Un={executionFillPath:new Path2D("M2.75 13.5333H11.25C11.9588 13.5333 12.5333 12.9588 12.5333 12.25V5.00918C12.5333 4.58443 12.3232 4.1872 11.972 3.94823L7.39384 0.832512C7.15619 0.670777 6.84381 0.670777 6.60616 0.832512L2.02797 3.94823C1.67682 4.1872 1.46667 4.58443 1.46667 5.00918V12.25C1.46667 12.9588 2.04124 13.5333 2.75 13.5333Z"),bsBuyIconPath:new Path2D("M2.5 8.85h2.76c1.23 0 2.28-.78 2.28-2.11 0-1-.66-1.53-1.14-1.72v-.07c.55-.3.89-.85.89-1.55 0-1.08-.82-1.9-2.24-1.9H2.5v7.35ZM3.6 4.6V2.47h1.38c.7 0 1.18.4 1.18 1.04 0 .65-.48 1.09-1.2 1.09H3.6Zm0 3.28v-2.4h1.35c.74 0 1.41.35 1.41 1.19S5.8 7.88 5.02 7.88H3.6Z"),bsSellIconPath:new Path2D("M7.9 6.8c0 .5-.1.9-.4 1.2-.2.3-.5.6-1 .7-.3.2-.8.3-1.3.3-.7 0-1.4-.2-2-.5-.5-.3-.8-.8-1-1.3l1-.5c.1.4.4.7.7 1 .4.2.8.3 1.3.3s.9 0 1.1-.3c.3-.1.4-.4.4-.7 0-.3 0-.5-.3-.7-.1-.2-.3-.3-.6-.4l-1-.3L3.6 5c-.3 0-.5-.3-.8-.5-.2-.3-.3-.6-.3-1 0-.5.1-.9.4-1.2.2-.3.5-.5 1-.7l1.3-.2a3 3 0 0 1 1.7.4c.4.3.7.7.9 1.1l-1 .5c-.3-.7-.8-1-1.6-1-.5 0-.8 0-1.1.2-.3.2-.4.5-.4.8 0 .2 0 .4.2.5l.6.4 1 .3 1.2.4.8.6c.3.3.4.7.4 1.1Z"),customIconPaths:new Map}),Un}function E_(s,e,t,i,r,o,n,a){s.save(),s.scale(e,t),s.translate(i,r),s.translate(-o/2,0),a(s),s.restore()}var mo=class{constructor(){this._data=null}setData(e){this._data=e}draw(e){e.useBitmapCoordinateSpace(t=>{if(!this._data||this._data.x===null||this._data.top===null)return;let i=t.context,{executionFillPath:r,bsBuyIconPath:o,bsSellIconPath:n,customIconPaths:a}=D_(),l=this._data.side===gi.Sell?"#eb4b6d":"#31bd65",d=14,u=14,_=10,f=10,{x:m,top:g,side:b,background:S,icon:v,iconColor:x,text:y,textColor:T}=this._data;E_(i,t.horizontalPixelRatio,t.verticalPixelRatio,m,g,d,u,w=>{let k=b!==gi.Buy;w.save(),k&&(w.rotate(Math.PI),w.translate(-d,0)),w.fillStyle=S||l,w.fill(r);let P;if(v?(a.has(v)||a.set(v,new Path2D(v)),P=a.get(v)):P=k?n:o,k&&(w.translate(d,u),w.rotate(Math.PI),w.translate(0,-(u-f)/2)),w.translate(0,1),w.translate((d-_)/2,(u-f)/2),w.fillStyle=x||"#FFFFFF",w.fill(P),w.restore(),y){let M=k?-u:u;w.textAlign="center",w.textBaseline=k?"bottom":"top",w.fillStyle=T||"#000000",w.translate(d/2,M),w.fillText(y,0,0)}})})}hitTest(e,t){if(!this._data||this._data.x===null||this._data.top===null)return null;let i=14,r=14,o=this._data.side!==gi.Buy,n=i,a=r,l=this._data.x-i/2,d=this._data.top-(o?r:0);return e>=l&&e<=l+n&&t>=d&&t<=d+a}};var po=class{constructor(e){this._invalidated=!0,this._source=e,this._renderer=new mo}update(){this._invalidated=!0}renderer(){return this._makeValid(),this._renderer}_makeValid(){this._invalidated&&(this._makeValidImpl(),this._invalidated=!1)}_makeValidImpl(){this._prepareRendererData()}_prepareRendererData(){var e;let t=this._source.data(),i=this._source._series,o=this._source._chart.timeScale().timeToCoordinate(t.time),n=(e=i.priceToCoordinate(t.price))!==null&&e!==void 0?e:0;this._renderer.setData({x:o,top:n,side:t.side,text:t.text,textColor:t.textColor,icon:t.icon,iconColor:t.iconColor,background:t.background})}};var fo=class{constructor(e,t,i){this._tooltip=null,this._moveHandler=r=>{this._onMouseMove(r)},this._chart=e,this._series=t,this._data=i,this._paneViews=[new po(this)],this._chart.subscribeCrosshairMove(this._moveHandler),this._chart.subscribeClick(this._moveHandler),this._tooltip=Yi(this._data.tooltip,this._chart.chartElement())}data(){return this._data}updateAllViews(){this._paneViews.forEach(e=>e.update())}paneViews(){return this._paneViews}attached({requestUpdate:e}){this.requestUpdate=e}detached(){var e,t;this.requestUpdate=void 0,this._showTooltip(),(e=this._chart)===null||e===void 0||e.unsubscribeCrosshairMove(this._moveHandler),(t=this._chart)===null||t===void 0||t.unsubscribeClick(this._moveHandler)}applyOptions(e){var t;B(this._data,e??{}),(t=this.requestUpdate)===null||t===void 0||t.call(this)}_onMouseMove(e){let{point:t}=e;if(!(!this._data||!t))for(let i of this._paneViews){let r=i.renderer();r!==null&&r.hitTest&&(r.hitTest(t.x,t.y)?this._showTooltip({x:t.x,y:t.y}):this._showTooltip())}}_showTooltip(e){if(!(!this._data.tooltip||!this._tooltip))if(!e)this._tooltip.style.display="none";else{let{renderContent:t}=this._data.tooltip,i=this._chart.chartElement(),r=t(),o=this._chart.options().leftPriceScale.visible?this._chart.priceScale("left").width():0;$i(this._tooltip,i,r,e,o)}}setText(e){var t;!e||(B(this._data,{text:e}),(t=this.requestUpdate)===null||t===void 0||t.call(this))}setTextColor(e){var t;!e||(B(this._data,{textColor:e}),(t=this.requestUpdate)===null||t===void 0||t.call(this))}setIcon(e){var t;!e||(B(this._data,{icon:e}),(t=this.requestUpdate)===null||t===void 0||t.call(this))}setIconColor(e){var t;!e||(B(this._data,{iconColor:e}),(t=this.requestUpdate)===null||t===void 0||t.call(this))}setBackground(e){var t;!e||(B(this._data,{background:e}),(t=this.requestUpdate)===null||t===void 0||t.call(this))}setTooltip(e){var t;!e||!e.renderContent||(B(this._data,{tooltip:e}),(t=this.requestUpdate)===null||t===void 0||t.call(this))}};c();h();c();h();c();h();c();h();var go=class{constructor(){this._data=null}setData(e){this._data=e}draw(e){e.useBitmapCoordinateSpace(t=>{if(!this._data||this._data.x===null||this._data.top===null)return;let i=t.context,{horizontalPixelRatio:r,verticalPixelRatio:o}=t,{x:n,top:a,text:l,textColor:d,borderColor:u,borderWidth:_,size:f=28,background:m,image:g,direction:b,stackOffset:S}=this._data,v=f/2*r,x=(_||0)*r,y=(S||0)*o,T=n*r,w=a*o;if(b==="up"?w=w-v-4*o-y:b==="down"&&(w=w+v+4*o+y),f!==0){if((!g||g.complete)&&(this._drawShadow({ctx:i,cx:T,cy:w,r:v+x/2}),this._drawBorder({ctx:i,cx:T,cy:w,r:v,borderWidth:x,borderColor:u})),g){this._drawImage(i,g,T,w,v);return}this._drawCircleAndText(i,T,w,v,m,l,d)}})}hitTest(e,t){if(!this._data||this._data.x===null||this._data.top===null)return null;let r=(this._data.size||28)/2,o=this._data.top,n=this._data.stackOffset||0;this._data.direction==="up"&&(o=o-r-4-n),this._data.direction==="down"&&(o=o+r+4+n);let a=e-this._data.x,l=t-o;return a*a+l*l<=r*r}_drawImage(e,t,i,r,o){t.complete&&(e.save(),e.beginPath(),e.arc(i,r,o,0,2*Math.PI),e.clip(),e.drawImage(t,i-o,r-o,o*2,o*2),e.restore())}_drawBorder({ctx:e,cx:t,cy:i,r,borderWidth:o,borderColor:n}){o&&n&&(e.save(),e.beginPath(),e.arc(t,i,r+o/2,0,2*Math.PI),e.fillStyle=n,e.fill(),e.restore())}_drawShadow({ctx:e,cx:t,cy:i,r}){var o,n,a,l,d,u,_;if(!this._data)return;let f=(o=this._data.hoveredShadowColor)!==null&&o!==void 0?o:this._data.shadowColor,m=(a=(n=this._data.hoveredShadowBlur)!==null&&n!==void 0?n:this._data.shadowBlur)!==null&&a!==void 0?a:8,g=(d=(l=this._data.hoveredShadowOffsetX)!==null&&l!==void 0?l:this._data.shadowOffsetX)!==null&&d!==void 0?d:0,b=(_=(u=this._data.hoveredShadowOffsetY)!==null&&u!==void 0?u:this._data.shadowOffsetY)!==null&&_!==void 0?_:2;f&&(e.save(),e.beginPath(),e.arc(t,i,r,0,2*Math.PI),e.shadowColor=f,e.shadowBlur=m,e.shadowOffsetX=g,e.shadowOffsetY=b,e.fill(),e.restore())}_drawCircleAndText(e,t,i,r,o,n,a){e.beginPath(),e.arc(t,i,r,0,2*Math.PI),e.fillStyle=o||"#fff",e.fill(),n&&(e.fillStyle=a||"#000",e.font=`${Math.floor(r)}px sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillText(n,t,i))}};var bo=class{constructor(e){this._invalidated=!0,this._source=e,this._renderer=new go}update(){this._invalidated=!0}renderer(){return this._makeValid(),this._renderer}_makeValid(){this._invalidated&&(this._makeValidImpl(),this._invalidated=!1)}_makeValidImpl(){this._prepareRendererData()}_getHoverValue(e,t){return this._source.isHovered&&t!==void 0?t:e}_prepareRendererData(){var e,t;let i=this._source.data(),r=this._source.series,n=this._source.chart.timeScale().timeToCoordinate(i.time),a=(t=r.priceToCoordinate((e=i.price)!==null&&e!==void 0?e:0))!==null&&t!==void 0?t:0,l=this._getHoverValue(i.background,i.hoveredBackground),d=this._getHoverValue(i.borderColor,i.hoveredBorderColor),u=this._getHoverValue(i.borderWidth,i.hoveredBorderWidth),_=this._getHoverValue(i.shadowColor,i.hoveredShadowColor),f=this._getHoverValue(i.shadowBlur,i.hoveredShadowBlur),m=this._getHoverValue(i.shadowOffsetX,i.hoveredShadowOffsetX),g=this._getHoverValue(i.shadowOffsetY,i.hoveredShadowOffsetY),b=this._source.animatedRadius();this._renderer.setData({x:n,top:a,text:i.text,textColor:i.textColor,borderColor:d,borderWidth:u,size:b*2,background:l,image:this._source.getImageElement(),direction:i.direction,stackOffset:this._source.stackOffset,shadowColor:_,shadowBlur:f,shadowOffsetX:m,shadowOffsetY:g})}};var vo=class{constructor(e,t,i,r){var o;this.stackOffset=0,this.isHovered=!1,this._tooltip=null,this._animationState={status:"finished",startTime:null,duration:300},this._animatedRadius=0,this._imageElement=null,this.chart=e,this._data=i,this.series=t,this._paneViews=[new bo(this)],this._imageLoadPromise=Promise.resolve(),i.image&&(this._imageLoadPromise=new Promise(n=>{this._imageElement=new window.Image,this._imageElement.onload=()=>n(),this._imageElement.onerror=()=>n(),this._imageElement.src=i.image})),this._data.tooltip&&(this._tooltip=Yi(this._data.tooltip,this.chart.chartElement())),!((o=r?.animation)===null||o===void 0)&&o.enabled&&(this._animationState.status="pending")}data(){return this._data}animatedRadius(){var e;return this._animationState.status==="pending"?0:this._animationState.status==="running"?this._animatedRadius:((e=this._data.size)!==null&&e!==void 0?e:28)/2}getAnimationDuration(){return this._animationState.duration}getImageElement(){return this._imageElement}updateAllViews(){this._paneViews.forEach(e=>e.update())}paneViews(){return this._paneViews}attached({requestUpdate:e}){this.requestUpdate=e}detached(){this.requestUpdate=void 0,this.showTooltip()}applyOptions(e){var t;B(this._data,e??{}),(t=this.requestUpdate)===null||t===void 0||t.call(this)}setHovered(e){var t;this.isHovered!==e&&(this.isHovered=e,(t=this.requestUpdate)===null||t===void 0||t.call(this))}showTooltip(e){if(!(!this._data.tooltip||!this._tooltip))if(!e)this._tooltip.style.display="none";else{let{renderContent:t}=this._data.tooltip,i=this.chart.chartElement(),r=t(),o=this.chart.options().leftPriceScale.visible?this.chart.priceScale("left").width():0;$i(this._tooltip,i,r,e,o)}}updateOptions(e){var t;B(this._data,e??{}),(t=this.requestUpdate)===null||t===void 0||t.call(this)}playAnimation(){return ss(this,void 0,void 0,function*(){yield this._imageLoadPromise,this._animationState.status="running",this._animationState.startTime=performance.now(),this._animatedRadius=0,this._updateAnimation()})}_updateAnimation(){var e,t,i,r;if(this._animationState.status!=="running"||this._animationState.startTime===null)return;let n=performance.now()-this._animationState.startTime,a=Math.min(n/this._animationState.duration,1),d=(_=>1-Math.pow(1-_,3))(a),u=((e=this._data.size)!==null&&e!==void 0?e:28)/2;this._animatedRadius=u*d,(t=this.requestUpdate)===null||t===void 0||t.call(this),a<1?requestAnimationFrame(this._updateAnimation.bind(this)):(this._animationState.status="finished",this._animationState.startTime=null,this._animatedRadius=((i=this._data.size)!==null&&i!==void 0?i:28)/2,(r=this.requestUpdate)===null||r===void 0||r.call(this))}};var So=class{constructor(e,t,i){this._markers=[],this._onMouseMove=r=>{this._handleEvent(r,!1)},this._onClick=r=>{this._handleEvent(r,!0)},this._onMouseLeave=()=>{this._markers.forEach(r=>{r.setHovered(!1),r.showTooltip()})},this.chart=e,this._series=t,this.chart.subscribeCrosshairMove(this._onMouseMove),this.chart.subscribeClick(this._onClick),this._globalOptions=i}destroy(){this.chart.unsubscribeCrosshairMove(this._onMouseMove),this.chart.unsubscribeClick(this._onClick)}setMarkers(e,t){var i,r,o,n,a;let l=this.chart.timeScale(),d=(r=(i=this._globalOptions)===null||i===void 0?void 0:i.timeAlignment)!==null&&r!==void 0?r:"nearest",u=e.map(S=>{let v=ue(S),x=this._alignTime(v.time,d,l);x!==null&&(v.time=x);let y=t(v.time);return y&&(y.length>=4&&!isNaN(y[0])&&!isNaN(y[1])&&!isNaN(y[2])&&!isNaN(y[3])?v.direction==="down"?v.price=y[2]:v.price=y[1]:v.price=y[0]),v}),_=((o=this._globalOptions)===null||o===void 0?void 0:o.stack)!==!1,f=new Map,m=4,g=28,b;if(_)b=u.map(S=>{var v,x;let y=`${S.time}_${S.direction||"up"}`,T=(v=S.size)!==null&&v!==void 0?v:g,w=(x=S.margin)!==null&&x!==void 0?x:m,k=0,P=0,M=f.get(y);if(M){let[G,F]=M;k=G+1,P=F+w+T}else P=T;return f.set(y,[k,P]),Object.assign(Object.assign({},S),{stackOffset:P-T})});else{let S=(a=(n=this._globalOptions)===null||n===void 0?void 0:n.conflictResolution)!==null&&a!==void 0?a:"last",v=new Map;S==="first"?u.forEach(x=>{let y=String(x.time);v.has(y)||v.set(y,x)}):u.forEach(x=>{let y=String(x.time);v.set(y,x)}),b=Array.from(v.values()).map(x=>Object.assign(Object.assign({},x),{direction:void 0,stackIndex:0,stackOffset:0}))}this._markers=b.map(S=>{let v=new vo(this.chart,this._series,S,this._globalOptions);return v.stackOffset=S.stackOffset,v})}playAnimation(){var e,t,i;let r=[...this._markers].sort((d,u)=>d.data().time-u.data().time);if(r.length===0)return;let o=(i=(t=(e=this._globalOptions)===null||e===void 0?void 0:e.animation)===null||t===void 0?void 0:t.duration)!==null&&i!==void 0?i:1500,n=r[0].getAnimationDuration(),a=o-n,l=0;r.length>1&&(l=a/(r.length-1)),l=Math.max(0,l),r.forEach((d,u)=>{setTimeout(()=>ss(this,void 0,void 0,function*(){yield d.playAnimation()}),u*l)})}markers(){return this._markers}_alignTime(e,t,i){switch(t){case"exact":return this._alignTimeExact(e,i);case"nearest":return this._alignTimeNearest(e,i);case"before":return this._alignTimeBefore(e);case"after":return this._alignTimeAfter(e);default:return e}}_alignTimeExact(e,t){let i=t.timeToCoordinate(e,!1);return ae(i)?e:null}_alignTimeNearest(e,t){let i=this._series.data(),r=null,o=Number.MAX_VALUE;for(let n of i){let a=n.time,d=Math.abs(a-e);d<o&&(o=d,r=n.time)}return r||e}_alignTimeBefore(e){let t=this._series.data(),i=null;for(let r of t){let o=r.time;o<=e&&(i===null||o>Number(i))&&(i=r.time)}return i||e}_alignTimeAfter(e){let t=this._series.data(),i=null;for(let r of t){let o=r.time;o>=e&&(i===null||o<Number(i))&&(i=r.time)}return i||e}_handleEvent(e,t){var i,r;let{point:o}=e;if(!o){this._onMouseLeave();return}let n=!1;for(let a=this._markers.length-1;a>=0;a--){let l=this._markers[a],u=l.paneViews()[0].renderer();if(u&&u.hitTest&&u.hitTest(o.x,o.y)&&!n){l.setHovered(!0);let _={x:o.x,y:o.y};l.showTooltip(_),t&&((r=(i=l.data()).onClick)===null||r===void 0||r.call(i,l)),n=!0}else l.setHovered(!1),l.showTooltip()}}};c();h();var Gh={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:"",axisLabelColor:"",axisLabelTextColor:""};c();h();var Co=class{constructor(e){this._priceLine=e}applyOptions(e){this._priceLine.applyOptions(e)}options(){return this._priceLine.options()}priceLine(){return this._priceLine}};var xo=class{constructor(e,t,i,r,o){this._dataChangedDelegate=new L,this._customMarkers=[],this._series=e,this._dataUpdatesConsumer=t,this._priceScaleApiProvider=i,this._horzScaleBehavior=o,this._chartApi=r}destroy(){this._dataChangedDelegate.destroy()}priceFormatter(){return this._series.formatter()}priceToCoordinate(e){let t=this._series.firstValue();return t===null?null:this._series.priceScale().priceToCoordinate(e,t.value)}coordinateToPrice(e){let t=this._series.firstValue();return t===null?null:this._series.priceScale().coordinateToPrice(e,t.value)}barsInLogicalRange(e){if(e===null)return null;let t=new Qe(new Ke(e.from,e.to)).strictRange(),i=this._series.bars();if(i.isEmpty())return null;let r=i.search(t.left(),1),o=i.search(t.right(),-1),n=C(i.firstIndex()),a=C(i.lastIndex());if(r!==null&&o!==null&&r.index>o.index)return{barsBefore:e.from-n,barsAfter:a-e.to};let l=r===null||r.index===n?e.from-n:r.index-n,d=o===null||o.index===a?a-e.to:a-o.index,u={barsBefore:l,barsAfter:d};return r!==null&&o!==null&&(u.from=r.originalTime,u.to=o.originalTime),u}setData(e){this._horzScaleBehavior,this._series.seriesType(),this._dataUpdatesConsumer.applyNewData(this._series,e),this._onDataChanged("full")}update(e){this._series.seriesType(),this._dataUpdatesConsumer.updateData(this._series,e),this._onDataChanged("update")}dataByIndex(e,t){let i=this._series.bars().search(e,t);return i===null?null:Ji(this.seriesType())(i)}data(){let e=Ji(this.seriesType());return this._series.bars().rows().map(i=>e(i))}subscribeDataChanged(e){this._dataChangedDelegate.subscribe(e)}unsubscribeDataChanged(e){this._dataChangedDelegate.unsubscribe(e)}setMarkers(e){this._horzScaleBehavior;let t=e.map(i=>Hn(i,this._horzScaleBehavior.convertHorzItemToInternal(i.time),i.time));this._series.setMarkers(t)}markers(){return this._series.markers().map(e=>Hn(e,e.originalTime,void 0))}setCustomMarkers(e){!Array.isArray(e)||(this.customMarkers().forEach(t=>{this.detachPrimitive(t)}),this._customMarkers=e.map(t=>{let i=new fo(this._chartApi,this,t);return this.attachPrimitive(i),i}),this._series.model().fullUpdate())}customMarkers(){return this._customMarkers}getValueByTime(e){let t=this._series.bars().rows().find(i=>i.originalTime===e);return t?.value||null}setCircleMarkers(e,t){var i;this.clearCircleMarkers(),this._circleMarkerManager=new So(this._chartApi,this,t),this._circleMarkerManager.setMarkers(e,this.getValueByTime.bind(this)),this._circleMarkerManager.markers().forEach(r=>{this.attachPrimitive(r)}),!((i=t?.animation)===null||i===void 0)&&i.enabled&&this._circleMarkerManager.playAnimation()}circleMarkers(){var e;return((e=this._circleMarkerManager)===null||e===void 0?void 0:e.markers())||[]}clearCircleMarkers(){var e,t;(e=this._circleMarkerManager)===null||e===void 0||e.markers().forEach(i=>{this.detachPrimitive(i)}),(t=this._circleMarkerManager)===null||t===void 0||t.destroy(),this._circleMarkerManager=void 0,this._series.model().fullUpdate()}applyOptions(e){this._series.applyOptions(e)}options(){return ue(this._series.options())}priceScale(){return this._priceScaleApiProvider.priceScale(this._series.priceScale().id())}createPriceLine(e){let t=B(ue(Gh),e),i=this._series.createPriceLine(t);return new Co(i)}removePriceLine(e){this._series.removePriceLine(e.priceLine())}seriesType(){return this._series.seriesType()}attachPrimitive(e){this._series.attachPrimitive(e),e.attached&&e.attached({chart:this._chartApi,series:this,requestUpdate:()=>this._series.model().fullUpdate()})}detachPrimitive(e){this._series.detachPrimitive(e),e.detached&&e.detached()}_onDataChanged(e){this._dataChangedDelegate.hasListeners()&&this._dataChangedDelegate.fire(e)}};c();h();var qh;(function(s){s[s.AnimationDurationMs=1e3]="AnimationDurationMs"})(qh||(qh={}));var wo=class{constructor(e,t,i){this._timeRangeChanged=new L,this._logicalRangeChanged=new L,this._sizeChanged=new L,this._model=e,this._timeScale=e.timeScale(),this._timeAxisWidget=t,this._timeScale.visibleBarsChanged().subscribe(this._onVisibleBarsChanged.bind(this)),this._timeScale.logicalRangeChanged().subscribe(this._onVisibleLogicalRangeChanged.bind(this)),this._timeAxisWidget.sizeChanged().subscribe(this._onSizeChanged.bind(this)),this._horzScaleBehavior=i}destroy(){this._timeScale.visibleBarsChanged().unsubscribeAll(this),this._timeScale.logicalRangeChanged().unsubscribeAll(this),this._timeAxisWidget.sizeChanged().unsubscribeAll(this),this._timeRangeChanged.destroy(),this._logicalRangeChanged.destroy(),this._sizeChanged.destroy()}scrollPosition(){return this._timeScale.rightOffset()}scrollToPosition(e,t){if(!t){this._model.setRightOffset(e);return}this._timeScale.scrollToOffsetAnimated(e,1e3)}scrollToRealTime(){this._timeScale.scrollToRealTime()}getVisibleRange(){let e=this._timeScale.visibleTimeRange();return e===null?null:{from:e.from.originalTime,to:e.to.originalTime}}setVisibleRange(e){let t={from:this._horzScaleBehavior.convertHorzItemToInternal(e.from),to:this._horzScaleBehavior.convertHorzItemToInternal(e.to)},i=this._timeScale.logicalRangeForTimeRange(t);this._model.setTargetLogicalRange(i)}getVisibleLogicalRange(){let e=this._timeScale.visibleLogicalRange();return e===null?null:{from:e.left(),to:e.right()}}setVisibleLogicalRange(e){ne(e.from<=e.to,"The from index cannot be after the to index."),this._model.setTargetLogicalRange(e)}resetTimeScale(){this._model.resetTimeScale()}fitContent(){this._model.fitContent()}logicalToCoordinate(e){let t=this._model.timeScale();return t.isEmpty()?null:t.indexToCoordinate(e)}coordinateToLogical(e){return this._timeScale.isEmpty()?null:this._timeScale.coordinateToIndex(e)}timeToCoordinate(e,t=!1){let i=this._horzScaleBehavior.convertHorzItemToInternal(e),r=this._timeScale.timeToIndex(i,t);return r===null?null:this._timeScale.indexToCoordinate(r)}coordinateToTime(e){let t=this._model.timeScale(),i=t.coordinateToIndex(e),r=t.indexToTimeScalePoint(i);return r===null?null:r.originalTime}width(){return this._timeAxisWidget.getSize().width}height(){return this._timeAxisWidget.getSize().height}subscribeVisibleTimeRangeChange(e){this._timeRangeChanged.subscribe(e)}unsubscribeVisibleTimeRangeChange(e){this._timeRangeChanged.unsubscribe(e)}subscribeVisibleLogicalRangeChange(e){this._logicalRangeChanged.subscribe(e)}unsubscribeVisibleLogicalRangeChange(e){this._logicalRangeChanged.unsubscribe(e)}subscribeSizeChange(e){this._sizeChanged.subscribe(e)}unsubscribeSizeChange(e){this._sizeChanged.unsubscribe(e)}applyOptions(e){this._timeScale.applyOptions(e)}options(){return Object.assign(Object.assign({},ue(this._timeScale.options())),{barSpacing:this._timeScale.barSpacing()})}_onVisibleBarsChanged(){this._timeRangeChanged.hasListeners()&&this._timeRangeChanged.fire(this.getVisibleRange())}_onVisibleLogicalRangeChanged(){this._logicalRangeChanged.hasListeners()&&this._logicalRangeChanged.fire(this.getVisibleLogicalRange())}_onSizeChanged(e){this._sizeChanged.fire(e.width,e.height)}};function L_(s){if(s===void 0||s.type==="custom")return;let e=s;e.minMove!==void 0&&e.precision===void 0&&(e.precision=lh(e.minMove))}function O_(s){if(Di(s.handleScale)){let t=s.handleScale;s.handleScale={axisDoubleClickReset:{time:t,price:t},axisPressedMouseMove:{time:t,price:t},mouseWheel:t,pinch:t}}else if(s.handleScale!==void 0){let{axisPressedMouseMove:t,axisDoubleClickReset:i}=s.handleScale;Di(t)&&(s.handleScale.axisPressedMouseMove={time:t,price:t}),Di(i)&&(s.handleScale.axisDoubleClickReset={time:i,price:i})}let e=s.handleScroll;Di(e)&&(s.handleScroll={horzTouchDrag:e,vertTouchDrag:e,mouseWheel:e,pressedMouseMove:e})}function Zh(s){return O_(s),s}var yo=class{constructor(e,t,i){this._seriesMap=new Map,this._seriesMapReversed=new Map,this._clickedDelegate=new L,this._dblClickedDelegate=new L,this._crosshairMovedDelegate=new L,this._tooltipUnsubscriber=null,this._tooltipElement=null,this._dataLayer=new ho(t);let r=i===void 0?ue(Fn()):B(ue(Fn()),Zh(i));this._horzScaleBehavior=t,this._chartWidget=new co(e,r,t),this._chartWidget.clicked().subscribe(n=>{this._clickedDelegate.hasListeners()&&this._clickedDelegate.fire(this._convertMouseParams(n()))},this),this._chartWidget.dblClicked().subscribe(n=>{this._dblClickedDelegate.hasListeners()&&this._dblClickedDelegate.fire(this._convertMouseParams(n()))},this),this._chartWidget.crosshairMoved().subscribe(n=>{this._crosshairMovedDelegate.hasListeners()&&this._crosshairMovedDelegate.fire(this._convertMouseParams(n()))},this);let o=this._chartWidget.model();this._timeScaleApi=new wo(o,this._chartWidget.timeAxisWidget(),this._horzScaleBehavior)}remove(){this._chartWidget.clicked().unsubscribeAll(this),this._chartWidget.dblClicked().unsubscribeAll(this),this._chartWidget.crosshairMoved().unsubscribeAll(this),this._timeScaleApi.destroy(),this._chartWidget.destroy(),this._seriesMap.clear(),this._seriesMapReversed.clear(),this._clickedDelegate.destroy(),this._dblClickedDelegate.destroy(),this._crosshairMovedDelegate.destroy(),this._dataLayer.destroy()}resize(e,t,i){if(this.autoSizeActive()){return}this._chartWidget.resize(e,t,i)}addCustomSeries(e,t){let i=nt(e),r=Object.assign(Object.assign({},Fs),i.defaultOptions());return this._addSeriesImpl("Custom",r,t,i)}addAreaSeries(e){return this._addSeriesImpl("Area",nc,e)}addBaselineSeries(e){return this._addSeriesImpl("Baseline",ac,e)}addBarSeries(e){return this._addSeriesImpl("Bar",rc,e)}addCandlestickSeries(e={}){return ah(e),this._addSeriesImpl("Candlestick",sc,e)}addHistogramSeries(e){return this._addSeriesImpl("Histogram",lc,e)}addLineSeries(e){return this._addSeriesImpl("Line",oc,e)}removeSeries(e){let t=Y(this._seriesMap.get(e)),i=this._dataLayer.removeSeries(t);this._chartWidget.model().removeSeries(t),this._sendUpdateToChart(i),this._seriesMap.delete(e),this._seriesMapReversed.delete(t)}applyNewData(e,t){this._sendUpdateToChart(this._dataLayer.setSeriesData(e,t))}updateData(e,t){this._sendUpdateToChart(this._dataLayer.updateSeriesData(e,t))}subscribeTooltip(e){this._tooltipUnsubscriber!==null&&(this._tooltipUnsubscriber(),this._tooltipUnsubscriber=null);let{className:t,style:i,renderHTML:r,inside:o}=e,n=document.createElement("div");n.className=t||"",n.style.cssText=`
			${Mn}
			${i||""}
		`;let a=this.chartElement();a.style.position="relative",a.appendChild(n),this._tooltipElement=n;let l=15,d=_=>{if(_.point===void 0||!_.time||_.point.x<0||_.point.x>a.clientWidth||_.point.y<0||_.point.y>a.clientHeight)n.style.display="none";else{let f=new Date().getTimezoneOffset()*6e4,m=_.time*1e3+f;Xi(n,r(Object.assign(Object.assign({},_),{time:m}))),n.style.display="block";let g=n.clientWidth,b=n.clientHeight,S,v,x=this.options().leftPriceScale.visible?this.priceScale("left").width():0,y=_.point.y;S=_.point.x+l+x,S>a.clientWidth-g&&(S=_.point.x-l-g+x),v=y+l,v>a.clientHeight-b&&(v=y-b-l),o&&(S=Math.max(0,Math.min(a.clientWidth-g,S)),v=Math.max(0,Math.min(a.clientHeight-b,v))),n.style.left=`${S}px`,n.style.top=`${v}px`}};this.subscribeCrosshairMove(d);let u=()=>{this.unsubscribeCrosshairMove(d),this._tooltipElement!==null&&(this._tooltipElement.remove(),this._tooltipElement=null),this._tooltipUnsubscriber===u&&(this._tooltipUnsubscriber=null)};return this._tooltipUnsubscriber=u,u}subscribeClick(e){this._clickedDelegate.subscribe(e)}unsubscribeClick(e){this._clickedDelegate.unsubscribe(e)}subscribeCrosshairMove(e){this._crosshairMovedDelegate.subscribe(e)}unsubscribeCrosshairMove(e){this._crosshairMovedDelegate.unsubscribe(e)}subscribeDblClick(e){this._dblClickedDelegate.subscribe(e)}unsubscribeDblClick(e){this._dblClickedDelegate.unsubscribe(e)}priceScale(e){return new _o(this._chartWidget,e)}timeScale(){return this._timeScaleApi}applyOptions(e){this._chartWidget.applyOptions(Zh(e))}options(){return this._chartWidget.options()}takeScreenshot(){return this._chartWidget.takeScreenshot()}autoSizeActive(){return this._chartWidget.autoSizeActive()}chartElement(){return this._chartWidget.element()}paneSize(){let e=this._chartWidget.paneSize();return{height:e.height,width:e.width}}setCrosshairPosition(e,t,i){let r=this._seriesMap.get(i);if(r===void 0)return;let o=this._chartWidget.model().paneForSource(r);o!==null&&this._chartWidget.model().setAndSaveSyntheticPosition(e,t,o)}clearCrosshairPosition(){this._chartWidget.model().clearCurrentPosition(!0)}_addSeriesImpl(e,t,i={},r){L_(i.priceFormat);let o=B(ue(Hs),ue(t),i),n=this._chartWidget.model().createSeries(e,o,r),a=new xo(n,this,this,this,this._horzScaleBehavior);return this._seriesMap.set(a,n),this._seriesMapReversed.set(n,a),a}_sendUpdateToChart(e){let t=this._chartWidget.model();t.updateTimeScale(e.timeScale.baseIndex,e.timeScale.points,e.timeScale.firstChangedPointIndex),e.series.forEach((i,r)=>r.setData(i.data,i.info)),t.recalculateAllPanes()}_mapSeriesToApi(e){return Y(this._seriesMapReversed.get(e))}_convertMouseParams(e){let t=new Map;e.seriesData.forEach((r,o)=>{let n=o.seriesType(),a=Ji(n)(r);if(n!=="Custom")ne(Rn(a));else{let l=o.customSeriesWhitespaceCheck();ne(!l||l(a)===!1)}t.set(this._mapSeriesToApi(o),a)});let i=e.hoveredSeries===void 0?void 0:this._mapSeriesToApi(e.hoveredSeries);return{time:e.originalTime,logical:e.index,point:e.point,hoveredSeries:i,hoveredObjectId:e.hoveredObject,seriesData:t,sourceEvent:e.touchMouseEventData}}};c();h();c();h();c();h();c();h();c();h();c();h();var V_={gridSize:4,gridGap:1},R_={color:"rgba(255, 255, 255, 0.36)",fontSize:10,margin:3,lineHeight:12,fontWeight:500},z_={color:"#909090",fontSize:10,margin:1,lineHeight:12,fontWeight:500},UD={upShadowColor:"#07FF4D",downShadowColor:"#FC46AB",upColor:"#BCFF2F",downColor:"#FC46AB",gridStyle:V_,data:[],showMaxMinValue:!0,maxMinLabel:Object.assign({},R_),crosshairLabel:Object.assign({},z_),backgroundColor:"#000",showBackgroundGrid:!0,interactive:!0,showShadow:!0};c();h();c();h();c();h();c();h();c();h();c();h();c();h();c();h();c();h();c();h();c();h();function Kh(s,e,t){let i;if(ft(s)){let o=document.getElementById(s);ne(o!==null,`Cannot find element in DOM with id=${s}`),i=o}else i=s;let r=new yo(i,e,t);return e.setOptions(r.options()),r}function Yn(s,e){return Kh(s,new Ui,Ui.applyDefaults(e))}var F_={autoSize:!0,handleScroll:!1,handleScale:!1},H_={vertLine:{visible:!1,labelVisible:!1},horzLine:{visible:!1,labelVisible:!1}},U_={background:{color:"transparent"}},AL=Object.assign(Object.assign({layout:U_},F_),{timeScale:{visible:!1},crosshair:H_,rightPriceScale:{visible:!1}});c();h();function To(s){if(!s.children||s.children.length===0){if(typeof s.value!="number")throw new Error(`Leaf node "${s.name}" must provide a value`);return s.value}return s.children.reduce((e,t)=>e+To(t),0)}function Y_(s,e){return s.map(t=>{var i;return Object.assign(Object.assign({},t),{area:Math.max(0,((i=t.value)!==null&&i!==void 0?i:0)*e),content:t.content,backgroundColor:t.backgroundColor})})}function $_(s,e,t){let i=e*e,r=s.reduce((a,l)=>a+l.area,0),o=1/0,n=0;for(let a of s)a.area<o&&(o=a.area),a.area>n&&(n=a.area);return!r||o===0?1/0:Math.max(i*n*t/(r*r),r*r/(i*o*t))}function X_(s,e,t){let i=s.reduce((n,a)=>n+a.area,0),r=e?i/e:0;r>t.height&&(r=t.height);let o=t.x;for(let n=0;n<s.length;n++){let a=s[n];a.x=o,a.y=t.y,a.height=r,n===s.length-1?a.width=t.x+t.width-o:a.width=a.area/r,o+=a.width}return Object.assign(Object.assign({},t),{y:t.y+r,height:t.height-r})}function j_(s,e,t){let i=s.reduce((n,a)=>n+a.area,0),r=e?i/e:0;r>t.width&&(r=t.width);let o=t.y;for(let n=0;n<s.length;n++){let a=s[n];a.x=t.x,a.y=o,a.width=r,n===s.length-1?a.height=t.y+t.height-o:a.height=a.area/r,o+=a.height}return Object.assign(Object.assign({},t),{x:t.x+r,width:t.width-r})}function Qh(s,e,t){return e===t.width?X_(s,e,t):j_(s,e,t)}function Jh(s,e,t,i){for(let r of s)typeof r.x=="number"&&typeof r.y=="number"&&typeof r.width=="number"&&typeof r.height=="number"&&e.push(ed({name:r.name,value:r.value,children:r.children,content:r.content,backgroundColor:r.backgroundColor},{x:r.x,y:r.y,width:r.width,height:r.height},t,i+1))}function ed(s,e,t,i=0){if(!s.children||s.children.length===0){let{children:g,content:b}=s,S=Lt(s,["children","content"]);return Object.assign(Object.assign(Object.assign(Object.assign({},S),{content:b}),e),{depth:i})}let r=To(s),o=e.width*e.height/r,a=Y_(s.children,o).slice(),l=[],d=1/0,u=Object.assign({},e),_=[];for(;a.length>0;){l.push(a[0]);let g=$_(l,Math.min(u.width,u.height),t);g<=d?(a.shift(),d=g):(l.pop(),u=Qh(l,Math.min(u.width,u.height),u),Jh(l,_,t,i),l=[],d=1/0)}l.length&&(u=Qh(l,Math.min(u.width,u.height),u),Jh(l,_,t,i));let{children:f}=s,m=Lt(s,["children"]);return Object.assign(Object.assign(Object.assign({},m),e),{depth:i,children:_})}function $n(s,e,t){if(!s.children||s.children.length===0)return s;let i=To(s);if(i===0)return s;let r=e/i,o=t/r,n=s.children.map(a=>{var l;let d=(l=a.value)!==null&&l!==void 0?l:a.children?To(a):0,u=d*r;if(u<t&&d>0){let _=Object.assign({},a);if(a.children){let f=o*r;_.children=$n(a,f,t).children}else _.value=Math.max(d,o);return _}else if(a.children){let _=u;return Object.assign(Object.assign({},a),{children:$n(a,_,t).children})}return a});return Object.assign(Object.assign({},s),{children:n})}function G_(s,e,t,i=1.618,r){let o=e*t,n=$n(s,o,r??1e3);return ed(n,{x:0,y:0,width:e,height:t},i)}function q_(s,e){var t,i,r,o;let n=(t=e?.width)!==null&&t!==void 0?t:s.width,a=(i=e?.height)!==null&&i!==void 0?i:s.height,l=(r=e?.splitLineColor)!==null&&r!==void 0?r:"#000000",d="#4fd1c5";function u(m){return m.children?[m].concat(m.children.reduce((g,b)=>g.concat(u(b)),[])):[m]}let _=u(s),f=`<svg width="${n}" height="${a}" xmlns="http://www.w3.org/2000/svg">
`;for(let m of _){let g=(o=m.backgroundColor)!==null&&o!==void 0?o:d,b=m.x,S=m.y,v=m.width,x=m.height;f+=`<rect x="${b}" y="${S}" width="${v}" height="${x}" fill="${g}" fill-opacity="0.7" stroke="${l}" stroke-width="1"/>
`,m.content?(f+=`<foreignObject x="${b}" y="${S}" width="${v}" height="${x}">
`,f+=`<div xmlns="http://www.w3.org/1999/xhtml" style="width:100%;height:100%;overflow:hidden;background-color: ${g};">${m.content}</div>
`,f+=`</foreignObject>
`):v>30&&x>16&&(f+=`<text x="${b+4}" y="${S+16}" font-size="12" fill="#222">${m.name}</text>
`)}return f+="</svg>",f}function Xn(s,e,t){let i=t?.width||s.clientWidth||800,r=t?.height||s.clientHeight||600,n=G_(e,i,r,1.618,t?.minArea),a=q_(n,{width:i,height:r,splitLineColor:t?.splitLineColor});Xi(s,a);function l(w,k,P=[]){if(P.push({node:w,origin:k}),w.children&&k.children)for(let M=0;M<w.children.length;M++)l(w.children[M],k.children[M],P);return P}let d=l(n,e),u=null,_=null;function f(w){u&&u(w)}function m(w){_&&_(w)}function g(w){let k=s.getBoundingClientRect(),P=w.clientX-k.left,M=w.clientY-k.top,G,F=-1;for(let re of d){let H=re.node;P>=H.x&&P<=H.x+H.width&&M>=H.y&&M<=H.y+H.height&&H.depth>F&&(G=re.origin,F=H.depth)}f({point:{x:P,y:M},node:G})}function b(w){let k=s.getBoundingClientRect(),P=w.clientX-k.left,M=w.clientY-k.top;f({point:{x:P,y:M},node:void 0})}function S(w){let k=s.getBoundingClientRect(),P=w.clientX-k.left,M=w.clientY-k.top,G,F=-1;for(let re of d){let H=re.node;P>=H.x&&P<=H.x+H.width&&M>=H.y&&M<=H.y+H.height&&H.depth>F&&(G=re.origin,F=H.depth)}m({point:{x:P,y:M},node:G})}function v(w){u=w,s.addEventListener("mousemove",g),s.addEventListener("mouseleave",b)}function x(w){_=w,s.addEventListener("click",S)}function y(){s.removeEventListener("click",S),_=null}function T(){s.removeEventListener("mousemove",g),s.removeEventListener("mouseleave",b),s.removeEventListener("click",S),u=null,_=null}return{subscribeMouseMove:v,unsubscribeMouseMove:T,subscribeClick:x,unsubscribeClick:y,destroy:T}}var YL=Object.assign(Object.assign({},Hs),Fs);c();h();c();h();var Re={"chart-container":"_chart-container_1kzd7_1",chartContainer:"_chart-container_1kzd7_1",chart:"_chart_1kzd7_1",content:"_content_1kzd7_12",ellipsis:"_ellipsis_1kzd7_25",hover:"_hover_1kzd7_31",amount:"_amount_1kzd7_35",tokenAmount:"_tokenAmount_1kzd7_40",currencyAmount:"_currencyAmount_1kzd7_48",value:"_value_1kzd7_56",name:"_name_1kzd7_62"};var id=(s,e)=>s===null||s===e?"":Re.hover,sd=(s,e,t,i)=>`<div class="${Re.content} ${t}">
    <div class="${Re.ellipsis} ${Re.value}">${i?Gt:e}</div>
  <div class="${Re.ellipsis} ${Re.name}">${s}</div>
</div>`,rd=(s,e)=>da(s,e,{returnString:!1}),jn=(s,e)=>s.reduce((t,i)=>Ot(t,i[e]),0),td=(s,e,t,i,r)=>{let o=rd(s.coinAmount,t),n=id(i,e);return{...s,name:s.tokenType,value:o,backgroundColor:fe("--okd-color-background-base-primary"),content:sd(s.tokenType,it(o*100).value,n,r)}},Z_=(s,e,t,i)=>{let r=s.slice(5),o=jn(r,"coinAmount"),n=jn(r,"currencyAmount"),a=rd(o,e),d=id(t,5);return{name:J("wallet_extension_asset_distribution_label_others"),value:a,coinAmount:o,displayPrecision:s[0]?.displayPrecision,stableCoin:s[0]?.stableCoin,currencyAmount:n,backgroundColor:fe("--okd-color-background-base-primary"),content:sd(J("wallet_extension_asset_distribution_label_others"),it(a*100).value,d,i)}},od=(s,e=null,t=!1)=>{if(!Array.isArray(s))return[];let i=jn(s,"coinAmount");if(s.length<=6)return s.map((n,a)=>td(n,a,i,e,t));let r=s.slice(0,5).map((n,a)=>td(n,a,i,e,t)),o=Z_(s,i,e,t);return[...r,o]};function Gn({coinList:s=[],coinAmountAll:e,currencyAmountAll:t,showChart:i=!0}){let[r]=ht(),o=(0,$.useRef)(null),n=(0,$.useRef)(null),a=oe(ns),[l,d]=(0,$.useState)(null),u=(0,$.useMemo)(()=>s.filter(T=>W.gt(T.coinAmount,0)),[s]),_=(0,$.useMemo)(()=>od(u,l,r),[u,l,r]),f=(0,$.useMemo)(()=>s[0],[s]),m=(0,$.useMemo)(()=>yi(e,{precision:f?.displayPrecision,isStableCoin:f?.stableCoin,useLargeNumberPrecision:!0}).value,[e,f?.displayPrecision,f?.stableCoin]),g=(0,$.useMemo)(()=>Wo(t,{currencySign:a}).value,[t,a]),[b,S]=(0,$.useState)(m),[v,x]=(0,$.useState)(g),y=(0,$.useCallback)(()=>{if(!(!n.current||_.length===0))try{o.current&&(o.current.destroy(),o.current=null),o.current=Xn(n.current,{name:"",children:_},{width:n.current.clientWidth,height:240,minArea:25e3,splitLineColor:fe("--okd-color-background-base-primary")}),o.current.subscribeMouseMove(T=>{if(T.node){let w=_.findIndex(k=>k.name===T.node?.name);if(w!==-1){d(w);let k=_[w];k&&(S(yi(k.coinAmount,{precision:k.displayPrecision,isStableCoin:k.stableCoin,useLargeNumberPrecision:!0}).value),x(Wo(k.currencyAmount,{currencySign:a}).value))}}else d(null),S(m),x(g)})}catch{}},[_,a,m,g]);return cs(()=>{y()}),ls(()=>{o.current&&(o.current?.destroy?.(),o.current=null)}),Ta(()=>{o.current&&y()},[y]),(0,$.useEffect)(()=>{l===null&&(S(m),x(g))},[m,g,l]),$.default.createElement($.default.Fragment,null,$.default.createElement("div",{className:Re.amount},$.default.createElement(Is,{coinSymbol:f?.symbol,currencyDisplay:v,amountDisplay:b,justify:Ye.ALIGN.start})),i&&$.default.createElement(Ha,{onResize:ca(()=>{o.current&&n.current&&y()},100)},$.default.createElement("div",{className:Re.chartContainer},$.default.createElement("div",{ref:n,className:Re.chart}))))}c();h();function K_(s){let e=s.reduce((i,r)=>Ot(i,r.coinAmount),0),t=s.reduce((i,r)=>Ot(i,r.currencyAmount),0);return{coinAmountAll:e,currencyAmountAll:t}}var Q_=({coinList:s,canChangeDefaultAddress:e,openAddressesDialog:t,showChart:i,hiddenAssets:r})=>{let o=Il({canChangeDefaultAddress:e}),n=ye(),a=Boolean(n.get("btcAggregation")),l=n.get("addressType"),{coinAmountAll:d,currencyAmountAll:u}=K_(s),_=Number(n.get("coinId")),[f,m]=Ts(_),g=me(as);return(0,te.useEffect)(()=>{if(!f?.coinId)return;let b={token_symbol:f?.symbol};l&&(b.address_type=l),g(b)},[f?.coinId]),te.default.createElement("div",{className:"coin-detail__body__overview"},te.default.createElement(Gn,{coinList:s,coinAmountAll:d,currencyAmountAll:u,showChart:i}),te.default.createElement(Ds,{coinList:s}),te.default.createElement("div",{className:"coin-detail__body__overview__line"}),te.default.createElement("div",{className:"coin-detail__body__overview__header"},te.default.createElement("div",{className:"coin-detail__body__overview__header-inner"},te.default.createElement("div",{className:"coin-detail__body__overview__title"},E("wallet_extension_overview_subtitle_assetsby_network")),a&&te.default.createElement(rt,{placement:rt.DIRECTION.topLeft,maxWidth:212,title:E("extension_defi_mid_tooltips_asset_in_4address_icu",{chainName:m?.chainName})},te.default.createElement(He,{className:"okx-wallet-plugin-information-circle coin-detail__body__overview-yield__icon"}))),e&&te.default.createElement(rt,{popupRef:o,placement:rt.DIRECTION.topRight,title:E("wallet_extension_hover_change_address_format")},te.default.createElement("div",{onClick:t,className:"coin-detail__body__overview-address"},E("extension_wallet_settings_title_set_default"),te.default.createElement(He,{className:"okx-wallet-plugin-arrow-small-right coin-detail__body__overview-address__icon"})))),te.default.createElement(ic,{coinList:s,coinAmountAll:d,hiddenAssets:r}))},nd=(0,te.memo)(Q_);c();h();var R=A(z()),hd=A(st());tt();c();h();c();h();var bi=A(z());var J_=()=>{let[s,e]=(0,bi.useState)(null),[t,i]=(0,bi.useState)(!1),[r,o]=(0,bi.useState)(null),n=(0,bi.useCallback)(async({scale:a=1,coinId:l})=>{if(!l)return null;i(!0),o(null);let[d,u]=await wi(yl({coinId:l,scale:a}));return i(!1),d?(o(d),e(null)):u?.data&&e(u.data),u?.data},[]);return{data:s,loading:t,error:r,fetchData:n}},ko=J_;c();h();var es=A(z());tt();var em=()=>{let s=Jt(),[e,t]=(0,es.useState)(null),i=(0,es.useCallback)(async({chainId:o,contractAddress:n,type:a})=>{if(!U(o)&&o!==""&&!U(n)){let l=await xl({chainId:o,contractAddress:n,type:a}),d="";l&&(d=`${s.origin}${l}`),t(d)}},[s.origin]),r=(0,es.useCallback)(()=>{e&&setTimeout(()=>{globalThis.platform.openTab({url:e})},100)},[e]);return{marketUrl:e,handleJumpDex:r,getMarketUrl:i}},Po=em;c();h();tt();var Mo=({chartPoints:s})=>!Array.isArray(s)||Array.isArray(s)&&s.length===0?[]:s.map(t=>({time:t.timestamp,value:Number.isNaN(+t?.price)?0:+t?.price})),ad=s=>{if(!s||s.length===0)return{minPoint:null,maxPoint:null};let e=s[0],t=s[0];return s.forEach(i=>{W.lt(i.value,e.value)&&(e=i),W.gt(i.value,t.value)&&(t=i)}),{minPoint:e,maxPoint:t}},ld=(s,e,t)=>!s||!e?[]:[{time:s.time,position:"belowBar",color:fe("--okd-color-content-secondary"),text:t(s.value),size:0},{time:e.time,position:"aboveBar",color:fe("--okd-color-content-secondary"),text:t(e.value),size:0}].sort((r,o)=>r.time-o.time),qn=s=>!U(s)&&s!=="",Ao=s=>!qn(s)||+s==0?fe("--okd-color-content-contrast"):!U(s)&&W.gt(s,0)?fe("--global-color-surface-pnl-profit-graph"):fe("--global-color-surface-pnl-loss-graph");c();h();var Me=A(z());var tm=({data:s,onCrosshairMove:e,lineWidth:t,chartOptions:i={},seriesOptions:r={},enableHover:o=!0,enableMinMaxMarkers:n=!0,enableResize:a=!0,formatMinMax:l=d=>`${d}`})=>{let d=(0,Me.useRef)(null),u=(0,Me.useRef)(null),_=(0,Me.useRef)(null),f=(0,Me.useRef)(s),m=(0,Me.useRef)(null),g=(0,Me.useMemo)(()=>({autoSize:!0,handleScroll:!1,handleScale:!1,layout:{background:{type:"solid",color:"transparent"}},rightPriceScale:{visible:!1},leftPriceScale:{visible:!1},timeScale:{visible:!1},grid:{horzLines:{visible:!1},vertLines:{visible:!1}},crosshair:{vertLine:{visible:!1},horzLine:{visible:!1}},...i}),[i]),b=v=>{!o||e?.(v.logical===void 0?void 0:f.current[v.logical])},S=()=>{!a||!u.current||!m.current||u.current.timeScale().setVisibleLogicalRange(m.current)};return cs(()=>{u.current||!d.current||(u.current=Yn(d.current,g),u.current&&(_.current=u.current.addAreaSeries({lineColor:fe("--okd-color-brand-primary-alternative"),topColor:"transparent",bottomColor:"transparent",lineWidth:t||1.5,lineType:2,lastValueVisible:!1,priceLineVisible:!1,priceScaleId:"right",...r}),o&&u.current.subscribeCrosshairMove(b),a&&window.addEventListener("resize",S)))}),ls(()=>{u.current&&o&&u.current.unsubscribeCrosshairMove(b),a&&window.removeEventListener("resize",S)}),(0,Me.useEffect)(()=>{if(f.current=s,!u.current||!_.current)return;if(s.length===0){_.current.setData(s),_.current.applyOptions(r);return}let v=null,x=null;if(n){let k=ad(s);v=k.minPoint,x=k.maxPoint}_.current.setData(s),_.current.applyOptions(r);let y=s.length===1,T=y?{from:-.5,to:.5}:{from:0,to:s.length};m.current=T,y&&u.current.applyOptions({timeScale:{fixLeftEdge:!1,fixRightEdge:!1}}),u.current.timeScale().setVisibleLogicalRange(T),requestAnimationFrame(()=>{if(n&&v&&x){let k=ld(v,x,l);k?.length&&_.current&&_.current.setMarkers(k)}})},[s,n,a,l,r]),Me.default.createElement("div",{ref:d,style:{width:"100%",height:"100%"}})},Io=tm;c();h();var I=A(z());tt();c();h();var ee={modal:"_modal_1rnsz_1",modalHeader:"_modalHeader_1rnsz_8",modalHeaderIcon:"_modalHeaderIcon_1rnsz_15",modalHeaderTitle:"_modalHeaderTitle_1rnsz_18",priceContainer:"_priceContainer_1rnsz_24",time:"_time_1rnsz_33",price:"_price_1rnsz_24",percent:"_percent_1rnsz_48",period:"_period_1rnsz_54",tabs:"_tabs_1rnsz_61",tabsPanelList:"_tabsPanelList_1rnsz_65",tabsPaneListContainer:"_tabsPaneListContainer_1rnsz_69",modalChart:"_modalChart_1rnsz_72",loading:"_loading_1rnsz_76",content:"_content_1rnsz_82"};var Zn={1:{scale:1,text:"wallet_extension_token_detail_bot_option_days",num:1,label:"wallet_extension_token_detail_bot_label_24hrs"},2:{scale:2,text:"wallet_extension_token_detail_bot_option_days",num:7,label:"wallet_extension_token_detail_bot_label_7days"},3:{scale:3,text:"wallet_extension_token_detail_bot_option_days",num:30,label:"wallet_extension_token_detail_bot_label_30days"}},im=({visible:s,onClose:e,coin:t,initialCurveData:i})=>{let[r,o]=(0,I.useState)(null),[n,a]=(0,I.useState)(null),[l,d]=(0,I.useState)(1),[u,_]=(0,I.useState)(null),{fetchData:f,loading:m,error:g}=ko(),b=oe(Cs),S=oe(ns),v=oe(os),{usdToThisRate:x=1}=v||{},y=r?.chartPoints,T=r?.priceChangePercent,w=(0,I.useMemo)(()=>Mo({chartPoints:y}),[y]),k=(0,I.useMemo)(()=>u?ha(new Date(u),{format:"yyyyMMddHHmm",locale:b}):null,[u,b]),P=(0,I.useMemo)(()=>{let V;return U(n)?V=r?.price:V=n,V!==void 0?W.mul(V,x):V},[n,r?.price,x]);(0,I.useEffect)(()=>{(async()=>{if(s&&i&&!r){o(i);return}if(s&&!i&&!r){let ie=await f({scale:1,coinId:t?.coinId});o(ie)}})()},[s,i,r,f,t?.coinId]);let M=async V=>{let ie=Number(V);if(ie===l)return;d(ie);let Ne=Zn[ie].scale,It=await f({scale:Ne,coinId:t?.coinId});o(It)},G=V=>{V?(a(V.value),_(V.time)):(a(null),_(null))};(0,I.useEffect)(()=>{s||(a(null),_(null),o(null),d(1))},[s]);let F=(0,I.useMemo)(()=>{let V=Ao(T);return{chartOptions:{crosshair:{vertLine:{color:V},horzLine:{visible:!1}}},seriesOptions:{lineColor:V}}},[T]),re=w?.length===0,H=(0,I.useCallback)(V=>{let ie=!U(t?.displayPrecision)&&!U(t?.stableCoin)?{useApproximate:!1,currencySign:S||"",precision:t.displayPrecision,isStableCoin:t.stableCoin}:{useApproximate:!1,currencySign:S||""};return Aa(W.mul(V,x),ie).value},[t?.displayPrecision,t?.stableCoin,S,x]),xe=()=>g?I.default.createElement("div",{className:ee.loading},I.default.createElement(Ii.State,{type:Ii.State.TYPE.noNetwork,title:J("wallet_extension_general_empty_title_loading_failed"),description:J("wallet_extension_general_empty_subtitle_data_retrive_fail"),onButtonClick:async()=>{let V=await f({scale:l,coinId:t?.coinId});o(V)},buttonText:J("wallet_extension_general_empty_btn_reload")})):m?I.default.createElement("div",{className:ee.loading},I.default.createElement(Uo,{shape:Uo.SHAPE.circle})):re?I.default.createElement("div",{className:ee.loading},I.default.createElement(Ii.State,{type:Ii.State.TYPE.noResult,title:J("wallet_extension_general_emptystate_no_data"),description:J("wallet_extension_emptystate_desc_no_history_price")})):I.default.createElement("div",{className:ee.modalChart},I.default.createElement(Io,{data:w,onCrosshairMove:G,chartOptions:F.chartOptions,seriesOptions:F.seriesOptions,enableHover:!0,enableMinMaxMarkers:!0,enableResize:!0,formatMinMax:H}));return I.default.createElement(xs.Action,{visible:s,title:I.default.createElement("div",{className:ee.modalHeader},I.default.createElement(j,{src:t?.image,size:j.SIZE.md,className:ee.modalHeaderIcon}),I.default.createElement(N.Text,{ellipsis:{tooltip:!0},nowrap:!0,className:ee.modalHeaderTitle},t?.symbol)),onClose:e},I.default.createElement("div",{className:ee.modal},I.default.createElement("div",null,!U(P)&&I.default.createElement(N.DisplayAmount,{useApproximate:!1,ellipsis:{tooltip:!0},mode:N.PRICE,amount:P,isStableCoin:t?.stableCoin,className:ee.priceContainer}),I.default.createElement("div",{className:ee.percentContainer},U(u)?I.default.createElement("div",{className:ee.price},!U(T)&&I.default.createElement(I.default.Fragment,null,I.default.createElement(N.AdaptiveText,{autoColor:!0,text:T,nowrap:!0,ellipsis:{tooltip:!0},size:N.SIZE.sm,type:N.TYPE.secondary,className:ee.percent},it(T,{signDisplay:!0}).value),I.default.createElement("div",{className:ee.period},J(Zn[l].label)))):I.default.createElement("div",{className:ee.time},k))),I.default.createElement("div",{className:ee.content},xe()),I.default.createElement("div",null,I.default.createElement(we,{className:ee.tabs,paneListInnerClassName:ee.tabsPanelList,paneListContainerClassName:ee.tabsPaneListContainer,category:we.CATEGORY.fill,type:we.NEW_TYPE.primary,size:we.SIZE.xs,hideContent:!0,activeId:l,onChange:M},Object.values(Zn).map(V=>I.default.createElement(we.TabPane,{tab:J("wallet_extension_token_detail_bot_option_days",{num:V.num}),id:V.scale,key:V.scale}))))))},cd=im;c();h();var et={coinPrice:"_coinPrice_x8wk4_1","price-box":"_price-box_x8wk4_11",priceBox:"_price-box_x8wk4_11",title:"_title_x8wk4_18",text:"_text_x8wk4_24",up:"_up_x8wk4_30",price:"_price_x8wk4_11","price-value":"_price-value_x8wk4_39",priceValue:"_price-value_x8wk4_39","price-percent":"_price-percent_x8wk4_46",pricePercent:"_price-percent_x8wk4_46","chart-box":"_chart-box_x8wk4_52",chartBox:"_chart-box_x8wk4_52"};var rm={width:62,height:40,crosshair:{visible:!1,horzLine:{visible:!1},vertLine:{visible:!1}}},om=({overviewCoinId:s})=>{let e=ye(),t=s||e.get("coinId"),i=el(t),r=tl(t)??void 0,[o,n]=(0,R.useState)(!1),{data:a,fetchData:l}=ko(),{chartPoints:d}=a||{},_=Ps(Number(t),!0)?.coin||{},{marketUrl:f,getMarketUrl:m,handleJumpDex:g}=Po(),b=(0,R.useMemo)(()=>Mo({chartPoints:d}),[d]),S=(0,R.useCallback)(async({curCoinId:P,chainId:M,address:G})=>{try{await Promise.allSettled([m({chainId:M,contractAddress:G,type:1}),l({scale:1,coinId:P})])}catch{}},[m,l]);(0,R.useEffect)(()=>{S({curCoinId:_.coinId,chainId:_.chainId,address:_.address})},[_.coinId,_.chainId,_.address,S]);let v=me(xa),x=()=>{if(f){v({chainId:_?.chainId,address:_?.address,token_symbol:_?.symbol}),g();return}a&&!o&&n(!0)},y=()=>{n(!1)},T=(0,R.useMemo)(()=>qn(r),[r]),w=b?.length>0&&T,k=(0,R.useMemo)(()=>({lineColor:Ao(r),crosshairMarkerVisible:!1,topColor:"transparent",bottomColor:"transparent"}),[r]);return R.default.createElement(R.default.Fragment,null,R.default.createElement("div",{className:et.coinPrice,onClick:x},R.default.createElement("div",{className:et.priceBox},R.default.createElement("div",{className:et.title},R.default.createElement(N.Text,{ellipsis:{tooltip:!0},nowrap:!0,className:et.text},E("wallet_extension_bot_label_token_price",{token:_?.symbol})),!U(f)&&R.default.createElement(He,{className:(0,hd.default)(!f&&et.up,"okx-wallet-plugin-chevron-right"),fontSize:"14px"})),R.default.createElement("div",{className:et.price},U(i)?R.default.createElement("span",null,"--"):R.default.createElement(N.DisplayAmount,{useApproximate:!1,ellipsis:{tooltip:!0},size:N.SIZE.sm,mode:N.PRICE,type:N.TYPE.secondary,amount:i,isStableCoin:_?.stableCoin,className:et.priceValue}),U(r)?R.default.createElement("span",null,"--"):R.default.createElement(N.AdaptiveText,{autoColor:!0,text:r,nowrap:!0,ellipsis:{tooltip:!0},className:et.pricePercent},it(r,{signDisplay:!0}).value))),R.default.createElement("div",{className:et.chartBox},w&&R.default.createElement(Io,{data:b,chartOptions:rm,seriesOptions:k,enableHover:!1,enableMinMaxMarkers:!1,enableResize:!1}))),R.default.createElement(cd,{visible:o,onClose:y,coin:_,initialCurveData:a}))},dd=(0,R.memo)(om);c();h();var ze=A(z()),ud=A(Rt());tt();var Kn=({data:s,address:e,onlyIcon:t=!1,size:i=Yo.sm})=>{let[r,o]=(0,ze.useState)(!1),n=(0,ud.useHistory)(),a=(0,ze.useCallback)(()=>{if(r){Ua.info(E("wallet_extension_assets_notification_desc_already_reported"));return}n.push(`/coin-report?coinId=${s.coinId}&address=${e}`)},[r,n,s.coinId,e]);return(0,ze.useEffect)(()=>{if(U(s?.coinId))return;(Vt.get(Sa.reportedCoins)||[]).includes(s?.coinId)&&o(!0)},[s?.coinId]),t?ze.default.createElement(zt,{icon:"okx-wallet-plugin-web3-report",size:i,style:{opacity:r?.5:1},onClick:a}):ze.default.createElement("div",{"data-testid":Nt.COIN_DETAIL_PAGE.REPORT_COIN_BUTTON,className:"coin-detail__header__menu-item",onClick:a,style:{opacity:r?.5:1}},ze.default.createElement(zt,{icon:"okx-wallet-plugin-web3-report",size:Yo.sm}),ze.default.createElement("span",{className:"coin-detail__header__menu-item__text"},E("wallet_extension_top_textbtn_report")))};c();h();var Yt=A(z()),Qn=A(st());c();h();var ts={icon:"_icon_6w6z5_1","cursor-pointer":"_cursor-pointer_6w6z5_4",cursorPointer:"_cursor-pointer_6w6z5_4",desc:"_desc_6w6z5_7",wrapper:"_wrapper_6w6z5_12"};var nm=({coin:s})=>{let{getMarketUrl:e,handleJumpDex:t,marketUrl:i}=Po();return(0,Yt.useEffect)(()=>{e({chainId:s.chainId,contractAddress:s.address,type:2})},[s,e]),Yt.default.createElement("div",{onClick:t,className:(0,Qn.default)(ts.wrapper,i?ts.cursorPointer:"")},Yt.default.createElement(Ue,{desc:Yt.default.createElement("div",{className:ts.desc},J("wallet_extension_risk_alertbanner_trade_risk"),Boolean(i)&&Yt.default.createElement(j,{size:j.SIZE.sm,className:(0,Qn.default)("okx-wallet-plugin-right",ts.icon)})),type:Ue.TYPE.error,closable:!1,icon:"okx-wallet-plugin-warning-circle"}))},_d=nm;c();h();var Ae=A(z());c();h();var _e=A(z()),Si=A(st());c();h();var vi=A(z());tt();var Jn="unmount",md="entering",pd="entered",fd="exiting",ea="exited",gd=0,bd=0,vd=(s,e,t)=>{let[i,r]=(0,vi.useState)(Jn),o=(0,vi.useCallback)(n=>{n!==i&&r(n)},[i]);return(0,vi.useEffect)(()=>{if(s){if(clearTimeout(bd),i===Jn){o(ea);return}i===ea&&la(t.current?.clientWidth),(i===ea||i===fd)&&(o(md),gd=setTimeout(()=>{o(pd)},e))}else clearTimeout(gd),(i===pd||i===md)&&(o(fd),bd=setTimeout(()=>{o(Jn)},e))},[t,s,o,i,e]),i};vd.STATUS={UNMOUNT:"unmount",ENTERING:"entering",ENTERED:"entered",EXITING:"exiting",EXITED:"exited"};var ta=vd;c();h();var $t={list:"_list_11h85_1","row-item":"_row-item_11h85_4",rowItem:"_row-item_11h85_4",search:"_search_11h85_7","check-icon":"_check-icon_11h85_10",checkIcon:"_check-icon_11h85_10",wrapper:"_wrapper_11h85_14","overview-icon":"_overview-icon_11h85_23",overviewIcon:"_overview-icon_11h85_23"};c();h();var Sd=s=>s.reduce((e,t)=>Ot(e,t.currencyAmount),0),Cd=(s,e)=>e.filter(t=>t.overview?!0:t?.tokenType?.toUpperCase()?.indexOf(s?.toUpperCase())>=0);var am=({visible:s,onClick:e,onClose:t,options:i,activeId:r=0,timeout:o=0})=>{let n=(0,_e.useRef)(null),a=ta(s,o,n),l=i.length>=7,d=(0,_e.useMemo)(()=>i.map((u,_)=>({...u,originIndex:_})),[i]);return a===ta.STATUS.UNMOUNT?null:_e.default.createElement("div",{className:(0,Si.default)("coin-detail__network-select",`coin-detail__network-select--${a}`),ref:n},_e.default.createElement("div",{className:(0,Si.default)("coin-detail__network-select__mask",`coin-detail__network-select__mask--${a}`),onClick:t}),_e.default.createElement("div",{className:(0,Si.default)("coin-detail__network-select__content",`coin-detail__network-select__content--${a}`)},_e.default.createElement(Xo,{className:$t.list,dataSource:d,itemKey:"tokenType",searchable:l?{keyword:"tokenType",placeholder:J("wallet_extension_assets_input_search_crypto"),offsetTop:0,searchClassName:$t.search,customFilter:Cd}:void 0,renderItem:u=>{let _=u.overview,f=_?Sd(i):u.currencyAmount;return _e.default.createElement(Xo.Coin,{icon:_?_e.default.createElement("div",{className:$t.wrapper},_e.default.createElement(He,{className:(0,Si.default)("okx-wallet-plugin-switch-view-chart-filled",$t.overviewIcon)})):u.chainImage,symbol:_?J("wallet_extension_dashboard_tab_overview"):u.tokenType,className:$t.rowItem,price:f,onClick:()=>{e(u.originIndex),t()}},u.originIndex===r&&_e.default.createElement(He,{className:(0,Si.default)("okx-wallet-plugin-check",$t.checkIcon)}))}})))},xd=(0,_e.memo)(am);var lm=({activeId:s,onChange:e,tabList:t,onToggleShow:i,showSelect:r,setTabShowSelect:o})=>{let[n,{toggle:a}]=hs(!1);return(0,Ae.useEffect)(()=>{let l=document.querySelector(".coin-detail__tabs-pane-list-container");l?.clientWidth&&l.clientWidth>290&&a()},[a]),Ae.default.createElement(Ae.default.Fragment,null,Ae.default.createElement(we,{className:"coin-detail__tabs-container",paneListContainerClassName:"coin-detail__tabs-pane-list-container",category:we.CATEGORY.fill,type:we.NEW_TYPE.highlight,size:we.SIZE.xs,activeId:s,headerClassName:"coin-detail__tabs",fullScreenScroll:!0,hideContent:!0,hideNav:!0,clickToView:!0,noLine:!0,afterSlot:n?Ae.default.createElement(rt,{className:"coin-detail__tooltip",title:E("wallet_extension_overview_more"),type:rt.TYPES.neutral,placement:rt.DIRECTION.bottom,zIndex:10},Ae.default.createElement(j.IconButton,{icon:r?"okx-wallet-plugin-arrow-small-up":"okx-wallet-plugin-arrow-small-down",className:"coin-detail__tooltip-icon",onClick:()=>{o(!r),i()}})):null},t.map((l,d)=>Ae.default.createElement(we.TabPane,{tab:l.tokenType,key:l.tokenType,id:d,onClick:()=>{e(d),r&&o(!1)},className:"coin-detail__tabs-pane"}))),Ae.default.createElement(xd,{visible:r,timeout:400,onClose:()=>{o(!r),i()},onClick:e,options:t,activeId:s}))},wd=(0,Ae.memo)(lm);c();h();var cm=({aggregation:s,btcAggregation:e,tonAggregation:t,nearAggregation:i,isAggregationCoin:r,addressType:o,tabList:n,coinId:a})=>{let l=Boolean((s||e||t)&&n.length||i&&n.length>1),d=Boolean(l&&n[0]?.overview);return{hasTab:l,hasOverview:d,showOverviewPage:d&&s&&!a||r&&!o}},hm=({isAggregationCoin:s,coinId:e,addressType:t,tabList:i})=>{let r=0;return s?r=i.findIndex(o=>o&&+o.coinId==+e&&+o.addressType==+t):e&&(r=i.findIndex(o=>o&&o.coinId===+e)),r},dm=(s,e,t)=>{let i=Boolean(s!==ma&&e[t]);return s===fa&&Object.keys(e[s]).length<2&&(i=!1),Da()&&s===rs&&(i=!0),i},um=(s,e,t,i)=>s?e[t]?.chainImage:i.image,_m=(s,e,t)=>Boolean(s?e:t?.supportShowDetail),yd=s=>s||"",mm=({showOverviewPage:s,aggregation:e,coin:t,btcAggregation:i})=>s&&e||i?!1:t&&!t?.isHighQuality,pm=(s,e)=>s&&e,fm=s=>Mi(s)?s?.tokenType:null,gm=s=>{let e=s?.baseCoinId===0?s?.coinId:s?.baseCoinId;return ba({coinId:e})},bm=(s,e,t)=>t?!1:s===ds.NORMAL||e,vm=s=>{let e=0,t=0,i=!1;return s.forEach((o,n)=>{let a=o?.coinAmount||0,l=o?.maxApy||0;W.gt(a,s[e]?.coinAmount||0)&&(e=n),W.gt(a,0)&&(i=!0),W.gt(l,s[t]?.maxApy||0)&&(t=n)}),i?e:t};function Sm(){let s=ct(),e=(0,Td.useHistory)(),t=ye(),i=t.get("coinId"),r=t.get("coinSymbol"),o=Boolean(t.get("aggregation")),n=Boolean(t.get("btcAggregation")),a=Boolean(t.get("nearAggregation")),l=Boolean(t.get("tonAggregation")),d=n||a||l,u=t.get("sameNameCoin"),_=t.get("addressType"),[f]=ht(),m={},g={},{coin:b=m,baseCoin:S=g}=Ps(i===""||i===null?void 0:+i,!0),v=gm(b),x=(0,D.useMemo)(()=>!(o||n||b?.baseCoinId===0),[o,n,b?.baseCoinId]),{id:y,accountsMap:T={},keyringIdentityType:w}=Za(),k=(0,D.useRef)(null),[P,M]=(0,D.useState)(null),G=ka(P),{localType:F,address:re}=b,H=sl({localType:F}),xe=ga(F),V=ys(xe),ie=Ga(xe),Ne=H({address:ie}),se=(d?V[_]:ie)||"",Bt=oe(Cs),Dt=Ml(b,se,Bt),Et=Al(b,w),Xt=Dt||Et,{tabList:le,hasBalChainGte3:Bo}=kl({aggregation:o,coinSymbol:r,btcAggregation:n,nearAggregation:a,tonAggregation:l,coin:b}),{hasTab:Do,hasOverview:lt,showOverviewPage:Ie}=cm({aggregation:o,btcAggregation:n,tonAggregation:l,nearAggregation:a,isAggregationCoin:d,addressType:_,tabList:le,coinId:i}),We=lt?le.slice(1):le,Fe=hm({coinId:i,tabList:le,addressType:_,isAggregationCoin:d}),Ci=(0,D.useMemo)(()=>o&&(!b||Object.keys(b).length===0)&&lt&&We.length>0?We[0]:b,[o,b,lt,We]),Eo=fm(b),xi=dm(F,T,xe),Lo=um(d,le,Fe,S),jt=_m(o,r,b),Oo=mm({showOverviewPage:Ie,aggregation:o,coin:b,btcAggregation:n}),Md=pm(jt,Oo),ia=pe=>{let Be={coinSymbol:r,coinId:le[pe]?.coinId||"",sameNameCoin:u};o&&(Be.aggregation=o),Object.entries({btcAggregation:n,nearAggregation:a,tonAggregation:l}).forEach(([Nd,aa])=>{aa&&(Be[Nd]=aa,Be.addressType=le[pe]?.addressType||"",Be.coinId=i||"")});let zd=Wt(Be);return`${Zt}${zd}`},Vo=me(qt),Ad=pe=>{Vo({button_clicked:"address_type"});let Be=ia(pe);e.replace(Be)};(0,D.useEffect)(()=>{if(!lt&&(o&&!i||d&&!_)){let pe=vm(le),Be=ia(pe);e.replace(Be)}},[]);let[Id,is]=(0,D.useState)(!1),Bd=pe=>(is(!1),s(F===rs?ja(pe.addressType):ya(y,{[xe]:pe.addressType}))),[sa,Dd]=(0,D.useState)(null);Ma(()=>{!b||!i||!se||typeof se!="string"||s(Kt({coinId:i,addressList:se?[se]:[]},{scrollLoad:!0,autoRefresh:!0,fromCoinDetail:!0}))},{target:sa,threshold:80});let Ed=(0,D.useCallback)(()=>{G.current&&M(null)},[P]),ra=(0,D.useCallback)(()=>{if(Vo({button_clicked:"token_info"}),!b?.coinId&&!r)return;let pe={aggregation:o};b?.coinId&&(pe.coinId=b.coinId),r&&(pe.coinSymbol=r);let Be=`${Oa}${Wt(pe)}`;e.push(Be)},[b?.coinId,r,o,Vo,e]),[Ld,{toggle:Od}]=hs(!1),[Ro,oa]=(0,D.useState)(!1),na=b?.riskType||ds.NORMAL,Vd=u==="true",Rd=o&&le?.[0]?.stableCoin;return D.default.createElement("div",{className:"coin-detail",ref:k},D.default.createElement("div",{className:"coin-detail__header"},D.default.createElement(il,{classNames:{box:"coin-detail__header__box",title:"coin-detail__header__title",tag:"coin-detail__header__tag",icon:"coin-detail__header__icon"},backable:{className:"coin-detail__header__back_icon"},stickyClassName:"coin-detail__header-nav",bordered:!1,onClose:Ed,className:(0,kd.default)({"coin-detail__header-nav-custom":!0,"coin-detail__header-nav-selected":Ld}),closeable:!!P,tag:yd(Eo),title:yd(Ci?.symbol),icon:{src:Ci?.image,alt:Ci?.symbol},titleLeft:{titleClass:"coin-detail__header__title_left",headerAddress:x?re:null,chainLogo:x?v?.imageUrl:null,onCopyAddress:()=>{(0,Pd.default)(re||""),Ya.success({title:E("wallet_extension_asset_toast_address_copied"),desc:re})}}},Md?D.default.createElement(ws,{onVisibleChange:()=>{Ro&&oa(!Ro)},content:D.default.createElement("div",{className:"coin-detail__header__menu"},jt&&D.default.createElement("div",{className:"coin-detail__header__menu-item",onClick:ra},D.default.createElement(zt,{icon:"okx-wallet-plugin-information-circle",size:"sm"}),D.default.createElement("span",{className:"coin-detail__header__menu-item__text"},E("wallet_extension_cryptodetail_tooltips_token_info"))),Oo&&D.default.createElement(Kn,{data:b,address:se})),trigger:ws.TRIGGER.click,placement:ws.DIRECTION.bottomRight},D.default.createElement(zt,{icon:"okx-wallet-plugin-more","data-testid":Nt.COIN_DETAIL_PAGE.NAVIGATOR_RIGHT_BUTTON})):D.default.createElement(D.default.Fragment,null,jt&&D.default.createElement(zt,{icon:"okx-wallet-plugin-information-circle",size:"md",onClick:ra}),Oo&&D.default.createElement(Kn,{data:b,address:se,size:"md",onlyIcon:!0}))),Xt?.showTonMessage&&D.default.createElement(Ue,{desc:Xt?.desc,type:Ue.TYPE.warn,onClose:Xt?.onClose,closable:Xt?.closable}),Do&&D.default.createElement(wd,{tabList:le,activeId:Fe,onChange:Ad,onToggleShow:Od,showSelect:Ro,setTabShowSelect:oa}),na!==ds.NORMAL&&D.default.createElement(_d,{coin:b}),Vd&&D.default.createElement("div",{"data-testid":Nt.COIN_DETAIL_PAGE.SAME_NAME_COIN_TIP},D.default.createElement(Ue,{desc:E("wallet_extension_same_name_alert_token"),type:Ue.TYPE.error,closable:!1,icon:"okx-wallet-plugin-warning-circle",className:"coin-detail__header-same-name-alert"}))),D.default.createElement("div",{className:"coin-detail__body",ref:Dd},Ie?D.default.createElement(nd,{hiddenAssets:f,showChart:Bo,coinList:We,hasOverview:lt,canChangeDefaultAddress:xi,openAddressesDialog:()=>{is(!0)}}):D.default.createElement(Ql,{coin:b,chain:v,hasOverview:lt,activeTab:le?.[Fe],isDefaultAddress:F!==rs&&se===ie,address:se,canChangeDefaultAddress:xi,openAddressesDialog:()=>{is(!0)},containerDOM:sa,coinDetailRef:k,txDetailData:P,setTxDetailData:M})),xi&&D.default.createElement(ol,{visible:Id,onClose:()=>is(!1),onChange:Bd,baseChain:xe,address:ie,normalAddress:Ne,chainImage:Lo}),D.default.createElement(Jl,null),bm(na,Ie,Rd)&&D.default.createElement(dd,{overviewCoinId:Ie?le?.[1]?.coinId:null}))}export{Sm as default};
//# sourceMappingURL=CoinDetail-E6RKHD4P.js.map
