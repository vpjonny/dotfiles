import{a as le}from"./chunk-VD2FZ6U7.js";import{a as se,b as ie}from"./chunk-RDYVJHBN.js";import{b as re}from"./chunk-DE2ULVLJ.js";import"./chunk-SNOTXOHI.js";import{a as ae}from"./chunk-MTRP4US5.js";import"./chunk-NYWY25X4.js";import{a as ne,b as oe}from"./chunk-T2BANNCO.js";import"./chunk-RE74DUYA.js";import{d as te}from"./chunk-AVG63QW4.js";import{c as X}from"./chunk-VX6OVCCX.js";import{a as ee}from"./chunk-DL6F7SAI.js";import{c as O}from"./chunk-RYVYRLUT.js";import"./chunk-NQGIYDUG.js";import{ta as R}from"./chunk-VHMBEOFX.js";import"./chunk-CKHT4PIF.js";import"./chunk-JMNZU6WB.js";import"./chunk-WXD7TULU.js";import"./chunk-JQHLKZPQ.js";import"./chunk-ZZBUS7GI.js";import"./chunk-PMG6IXOR.js";import"./chunk-BD5XO4WL.js";import"./chunk-7U7FORYL.js";import"./chunk-FLXVXXZH.js";import"./chunk-XBUPORYF.js";import{b as Q}from"./chunk-YVLQLIW6.js";import"./chunk-HBXZ3GPM.js";import"./chunk-6C7RJCTT.js";import"./chunk-N6PI3XTA.js";import"./chunk-7DW2ZPOD.js";import"./chunk-MT4YWUUK.js";import"./chunk-ARDRUD4P.js";import{h as Z}from"./chunk-WYX7GFOD.js";import"./chunk-G6PA2JD3.js";import"./chunk-N2N44VBE.js";import"./chunk-ZDJRNLYZ.js";import"./chunk-RV5WZKGQ.js";import"./chunk-MJSLAJV6.js";import{i as H,k as W}from"./chunk-KC2XLVFC.js";import{qa as $,ra as z}from"./chunk-MJDO2VHF.js";import"./chunk-TFTCL6XD.js";import"./chunk-TBQGFYU3.js";import"./chunk-L5AZICLM.js";import"./chunk-WLEQHCLB.js";import{vb as V}from"./chunk-QF42JCDG.js";import"./chunk-DRCTWZQB.js";import"./chunk-KGMP5AO5.js";import"./chunk-EAE2NUFS.js";import"./chunk-OLICTWCW.js";import"./chunk-SDBZJWGW.js";import"./chunk-F3ILJHGP.js";import"./chunk-6M37VPK2.js";import"./chunk-WOJGOC63.js";import"./chunk-3F7OC7N7.js";import"./chunk-HZOYPVSA.js";import"./chunk-Z4GX4TH2.js";import"./chunk-OKGWI7CU.js";import"./chunk-EPDR6VAQ.js";import"./chunk-RFTC6RNT.js";import"./chunk-I6UBKGB5.js";import{h as J}from"./chunk-ZIR6OOXX.js";import"./chunk-KYVX6VSI.js";import"./chunk-WN3TRBGI.js";import{c as T}from"./chunk-3FMJDUGT.js";import"./chunk-2O5TMJZM.js";import"./chunk-UI4IZNSB.js";import"./chunk-FCGPU67F.js";import"./chunk-FXRKHQFW.js";import"./chunk-YTHL7242.js";import"./chunk-XOHZCMW2.js";import"./chunk-EQ34WRCJ.js";import"./chunk-UIZGYUZK.js";import{s as c}from"./chunk-DSNMNSMD.js";import"./chunk-U2IAA473.js";import{a as Pe}from"./chunk-DOSBJ3L3.js";import"./chunk-DNGRHKLV.js";import"./chunk-3O2IEAHF.js";import{J as E,r as q}from"./chunk-URGJ6D4O.js";import"./chunk-WC6GCIBJ.js";import"./chunk-JRC3ZUKA.js";import"./chunk-4U5VOZ7H.js";import"./chunk-FVHZWNUE.js";import{a as Y}from"./chunk-IQUFNLVG.js";import{C as A}from"./chunk-XYWWXNVK.js";import"./chunk-VYWNZTTM.js";import"./chunk-5CHTOVVG.js";import"./chunk-FB3ILH2L.js";import{b as we}from"./chunk-FLSAETOH.js";import"./chunk-TGW66MRK.js";import"./chunk-LRIABBHT.js";import"./chunk-NEASQB35.js";import{Aa as De,M as N}from"./chunk-4C5HF6J2.js";import"./chunk-U6W3TK77.js";import"./chunk-WJI4CIAQ.js";import"./chunk-GTDBOF5Q.js";import"./chunk-EI7BJC6V.js";import"./chunk-B3EOGJ3Y.js";import"./chunk-YL2RBVBZ.js";import"./chunk-4HAPQ4J7.js";import"./chunk-F5YUOHHL.js";import"./chunk-EL77VG5Z.js";import"./chunk-LWG66QL2.js";import"./chunk-26XSB24L.js";import"./chunk-IFKSF5TW.js";import"./chunk-PDIVTGDM.js";import"./chunk-UL6IEE2K.js";import"./chunk-4ARIYUS3.js";import{f as G,o as w,q as D}from"./chunk-UWURTNRY.js";w();D();var e=G(we());var pe=G(Pe());De();w();D();var u={"retina-border-basic":"_retina-border-basic_n7dio_1",retinaBorderBasic:"_retina-border-basic_n7dio_1",container:"_container_n7dio_29","img-wrapper":"_img-wrapper_n7dio_32",imgWrapper:"_img-wrapper_n7dio_32",pic:"_pic_n7dio_38",img:"_img_n7dio_32",text:"_text_n7dio_46","risk-addr":"_risk-addr_n7dio_57",riskAddr:"_risk-addr_n7dio_57","select-all":"_select-all_n7dio_96",selectAll:"_select-all_n7dio_96","list-item-wrapper":"_list-item-wrapper_n7dio_131",listItemWrapper:"_list-item-wrapper_n7dio_131",checkbox:"_checkbox_n7dio_147"};var ce=(o,i)=>o.some(m=>m.status===i),Se=o=>{let i=ce(o,2),m=ce(o,3);return{loading:i||m,loadingTextKey:i?"wallet_extension_approval_btn_revoking":"wallet_extension_approval_btn_approving"}},Le=o=>o.data.length>1,Ne=o=>{let i=1;return o.length<1?i:o.length===1?o[0].status:i},Re=({currentWalletId:o,selectedProjectList:i})=>{let m=(0,e.useRef)([]),g=(0,e.useCallback)(h=>m.current.find(v=>v.chainIndex===h),[]),x=(0,e.useCallback)(async()=>{let h=await ee(o);m.current=h?.chainList||[]},[o]);return(0,e.useEffect)(()=>{x()},[x]),{getNeedUpgradeChains:(0,e.useCallback)(()=>{let{chainCountMap:h,chainHasNotUpgradedMap:v}=i.reduce((r,d)=>{let _=d.chainId,f=g(_);if(!f)return r;let b=d.tokens.filter(y=>y.status===1);return r.chainCountMap.set(_,(r.chainCountMap.get(_)||0)+b.length),f.status!==3&&!r.chainHasNotUpgradedMap.get(_)&&r.chainHasNotUpgradedMap.set(_,f.status),r},{chainCountMap:new Map,chainHasNotUpgradedMap:new Map});return Array.from(h.entries()).filter(([r,d])=>d>1&&v.get(r)!==void 0).map(([r])=>({chainId:r,status:v.get(r)})).filter(r=>r.status!==void 0)},[i,g]),fetch7702ChainList:x,getSupport7702Chain:g}},Ee=()=>{let o=(0,pe.useHistory)(),i=J({light:"/cdn/assets/imgs/572/DF7EA0E91C054564BEE2F4C8DB4126AC.png",dark:"/cdn/assets/imgs/745/1604A772E2424A839B5E75E665FD5BC6.png"}),m=$(),g=Z(),x=ne(),{loading:U,run:h,error:v}=W(async()=>await x(),{manual:!0}),l=ae(),r=z(O),[d,_]=(0,e.useState)(new Set),[f,b]=(0,e.useState)([]),y=(0,e.useRef)(!1),P=(0,e.useMemo)(()=>l.filter(t=>d.has(`${t.chainId}-${t.approvalAddress}`)),[l,d]),{getNeedUpgradeChains:de,fetch7702ChainList:ue,getSupport7702Chain:me}=Re({currentWalletId:g,selectedProjectList:P});(0,e.useEffect)(()=>{if(l.length>0&&!y.current){let t=new Set(l.map(a=>`${a.chainId}-${a.approvalAddress}`));y.current=!0,_(t)}},[l]),H(()=>{h()}),(0,e.useEffect)(()=>{r&&!l.length&&o.goBack()},[r,o,l.length]);let he=l?.length||0;oe();let _e=(0,e.useCallback)(t=>{_(a=>{let n=new Set(a);return n.has(t)?n.delete(t):n.add(t),n})},[]),j=(0,e.useCallback)(async({tokens:t,chainId:a})=>{if(N(t))return[];let s=t.filter(p=>p.status===1).map(async({coinId:p,tokenAddress:S,approvalAddress:C,permit2Address:L,address:I,approvalNum:Ie})=>await le({address:I,chainId:a,tokenAddress:S,approvalAddress:C,permit2Address:L,coinId:p,approvalNum:Ie}));return await Promise.all(s)},[]),ge=async t=>(await Promise.all(t.map(async n=>j({tokens:n.tokens,chainId:n.chainId})))).flat(),fe=async t=>{let a=new Map,n=[];return await Promise.all(t.map(async s=>{let k=await j({tokens:s.tokens,chainId:s.chainId}),p=s.chainId,S=s.coinId,C=me(p);if(!C){n.push(...k);return}let L=C.status!==3;a.has(p)||a.set(p,{chainId:p,shouldUpgrade7702:L,data:[],chain7702Data:C,coinId:S});let I=a.get(p);I&&I.data.push(...k)})),{chainGroups:a,otherTxs:n}},ke=t=>Array.from(t.values()).reduce((a,n)=>(Le(n)?a.push(n):a.push(...n.data),a),[]),xe=async t=>{if(!t)return ge(P);let{chainGroups:a,otherTxs:n}=await fe(P);return[...ke(a),...n]},ve=(0,e.useCallback)(t=>{if(t.some(s=>N(s))){E.error({title:c("wallet_extension_approval_toast_initiate_fail"),duration:3,showClose:!0,placement:E.DIRECTION.top});return}m(X({type:"approve",data:t})),o.push(`${V}?type=approve`)},[]),{revokeAllBtnLoading:Te,revokeAllBtnLoadingTextKey:be}=(0,e.useMemo)(()=>{let t=l.map(s=>s?.tokens||[]).flat(),{loading:a,loadingTextKey:n}=Se(t);return{revokeAllBtnLoading:a,revokeAllBtnLoadingTextKey:n}},[l]),B=async(t=!1)=>{let a=await xe(t);ve(a)},Ce=async()=>{await ue();let t=de();if(t.length>0){b(t);return}B(!0)},Ae=()=>{R({skip:!0,proceed:!1}),b([]),B(!1)},ye=()=>{R({skip:!1,proceed:!0}),b([]),B(!0)},M=Ne(f),F={[1]:{title:c("wallet_extension_approval_bttmsheet_header_7702_upgrade"),subtitle:c("wallet_extension_approval_bttmsheet_desc_7702_batch_txn")},[4]:{title:c("wallet_extension_approval_bttmsheet_header_okx_7702"),subtitle:c("wallet_extension_approval_bttmsheet_desc_okx_7702_batch")}},K=F[M]||F[1];return e.default.createElement(T.Container,{loading:!1,className:u.container},e.default.createElement(te,{bordered:!1,closeable:!1}),e.default.createElement(ie,{isError:!!v,isLoading:U,reload:h},e.default.createElement(e.default.Fragment,null,e.default.createElement(T.Box,{className:u.imgWrapper},e.default.createElement(Y,{src:i,pictureClassName:u.pic,className:u.img})),e.default.createElement(T.Box,{className:u.text},c("wallet_extension_approval_header_num_risky",{num:he})),e.default.createElement(T.Box,{className:u.riskAddr},c("wallet_extension_approval_label_malicious")),e.default.createElement(T.Box,null,l.map(t=>{let{projectIcon:a,projectName:n,network:s}=t;if(!t?.tokens?.length)return null;let k=`${t.chainId}-${t.approvalAddress}`,p=d.has(k);return e.default.createElement("div",{key:k,className:u.listItemWrapper,onClick:()=>_e(k)},e.default.createElement(se,{title:n,desc:s,icon:a}),e.default.createElement(q.Circle,{checked:p,className:u.checkbox}))})),e.default.createElement(Q.FooterActions,{zIndex:f.length>0?0:1e5},e.default.createElement(A,{disabled:d.size===0,loading:Te,loadingText:c(be),category:A.CATEGORY.fill,type:A.TYPE.highlight,size:A.SIZE.lg,onClick:Ce},c("wallet_extension_approval_btn_revoke_all"))))),f.length>0&&e.default.createElement(re,{status:M,title:K.title,subtitle:K.subtitle,walletId:g,onCancel:Ae,onClose:ye,initCheckStatus:!1,cancelBtnProps:{text:c("wallet_extension_approval_bttmsheet_btn_skip"),loading:!1},confirmBtnProps:{text:c("wallet_extension_transfer_bttmsheet_btn_apply_continue"),loading:!1}}))},ft=Ee;export{ft as default};
//# sourceMappingURL=RiskApprovePage-6GRNNH47.js.map
