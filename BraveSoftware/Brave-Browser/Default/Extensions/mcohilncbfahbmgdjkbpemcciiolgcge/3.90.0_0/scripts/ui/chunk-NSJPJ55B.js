import{n as f}from"./chunk-QED56456.js";import{e as D}from"./chunk-2LQJ3JX6.js";import{a as v}from"./chunk-KF7FMIRD.js";import{a as F,g as M}from"./chunk-V5J3A5L5.js";import{c}from"./chunk-RZETZIQO.js";import{Wa as R,pa as u,r as O,tb as b,va as l}from"./chunk-P5GHREX3.js";import{F as d,Ja as w,Ke as E,Nb as y}from"./chunk-RPH2MNBW.js";import{J as A}from"./chunk-URGJ6D4O.js";import{b as C}from"./chunk-FLSAETOH.js";import{f as I,o as i,q as s}from"./chunk-UWURTNRY.js";i();s();var _=I(C());i();s();async function j(o){let e=o?.unsignedTx;if(!e)return[null,null];l.info(u.SIGN_INTENT_SWAP,{tradeType:y.MARKET,unsignedTx:e});let r=JSON.parse(e),[t,n]=await d(R({message:r,chainId:o.chainId}));return t&&(l.error(u.SIGN_PERMIT2_DATA,{error:t,unsignedTx:e}),v(t)||A.error({title:E("swaptrade_trading_mode_alert_order_fail"),placement:A.DIRECTION.top})),[t,n]}async function N({chainId:o,defiPlatformInfo:e}){let r=e?.permit2Data;if(!r||!r.unsignedTx)return null;let[t,n]=await j({unsignedTx:r.unsignedTx,chainId:o});if(t)throw t;return{unsignedTx:r.unsignedTx,signature:n}}i();s();var g=I(C());i();s();var S=I(C());var J=()=>{let{accountStore:{isConnectedWallet:o}}=c(),[e,r]=(0,S.useState)(!1);return(0,S.useEffect)(()=>{(async()=>{if(o){let n=await b();r(n)}})()},[o]),{isWalletSupportSignApprovalAndSwap:e}},B=J;var U=({chainId:o})=>{let{commonStore:e}=c(),{chainList:r}=e,t=(0,g.useMemo)(()=>Array.isArray(e.chainList)&&e.chainList.length>0?e.getChainByID(o):null,[o,r]);return(0,g.useMemo)(()=>t?t.supportBatchBroadcast:!1,[t])},K=({isSingleChain:o,isOkxAggregator:e,isChainSupportBatchBroadcast:r})=>{let{isWalletSupportSignApprovalAndSwap:t}=B();return(0,g.useMemo)(()=>!o||!r||!e?!1:t,[r,e,o,t])},L=K;function H(o){let e=o?.computedRealSlippageValue||0,r=o?.getOrderSlippageInfo()||{autoSlippageInfo:{}},t=D({slippageInfo:r,isSingleChain:!0}),n=o?.getSlippageType()||F.AUTO;return{slippage:String(e),slippageType:n,maxSlippage:t.maxSlippage||""}}function Q(o){let{feeType:e,computedPriorityFeeAmount:r}=o;return{priorityFeeType:M[e]||1,priorityFee:r}}function X(o){let{priorityMode:e,manualType:r}=o,t=1;return e==="auto"?t=1:r===0?t=2:r===1&&(t=3),{routerModeType:t}}var Z=({computedIsCrossChain:o,computedIsOkxProvider:e,chainId:r})=>{let t=U({chainId:r}),n=L({isSingleChain:!o,isOkxAggregator:e,isChainSupportBatchBroadcast:t});return(0,_.useCallback)(({approveStatus:h})=>({needApproveTxInfo:h===w.UnApproved&&n}),[n])},Ne=()=>{let{quoteStore:o,accountStore:e,fromToStore:r,slippageStore:t,approveStore:n}=c(),{getApprovalStatus:h}=n,{computedIsOkxProvider:P}=o,{from:p,computedIsCrossChain:V}=r,x=Z({computedIsCrossChain:V,computedIsOkxProvider:P,chainId:p.chainId});return(0,_.useCallback)(async(W=!0,G)=>{if(!W)return null;let m=G||o.quote?.bestRoute,q=m?.quoteId,Y=h(p,m?.defiPlatformId),a={quoteId:q,userWalletAddress:e.getAddressByChainId(p.chainId)};a.accountInfo={accountId:e.computedAccountId,teeId:e.computedTeeInfo?.teeId||"",accountBizLine:2,teeSilentSignEnabled:O.supportStatus},a.slippageConfig=H(t),a.networkFee=Q(f),a.preSetConfig=X(f),a.simulate=!1;let[k,z]=await d(N({chainId:p.chainId,defiPlatformInfo:m}));return k&&l.error(u.SIGN_PERMIT2_ERROR,{error:k,data:{chainId:p.chainId,defiPlatformInfo:m}}),a.permit2=z,a.chainId=p.chainId,a.ext=x({approveStatus:Y}),a},[o.quote?.bestRoute,e,p.chainId,t,f,x])};export{U as a,L as b,Ne as c};
//# sourceMappingURL=chunk-NSJPJ55B.js.map
