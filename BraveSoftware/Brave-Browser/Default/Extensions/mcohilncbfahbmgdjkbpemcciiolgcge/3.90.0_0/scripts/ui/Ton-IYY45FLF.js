import{a as ke,b as Te}from"./chunk-ZFEZH6WT.js";import{a as _e,b as we}from"./chunk-S5YUS2I7.js";import"./chunk-A7Y6FGTK.js";import"./chunk-NO3OY2S6.js";import"./chunk-PEKFKA6I.js";import"./chunk-2KBIS3G2.js";import"./chunk-BDLFPOJT.js";import"./chunk-7SVXGEVR.js";import"./chunk-CVLOEZ64.js";import"./chunk-ZBCYRIHC.js";import"./chunk-T2UFMQPE.js";import"./chunk-X7JU5VY4.js";import"./chunk-ITLSSVGE.js";import"./chunk-PWVBSLOL.js";import"./chunk-452JEOHF.js";import"./chunk-3MLYZLAT.js";import{a as D}from"./chunk-LHFDZX73.js";import"./chunk-OHHYJNZI.js";import{a as ge}from"./chunk-5EFGCLI4.js";import"./chunk-B4MQLH4C.js";import"./chunk-VWVRJUMU.js";import{a as pe}from"./chunk-ZFAUEPQW.js";import"./chunk-GMVPA3MX.js";import"./chunk-C4TBDTQO.js";import"./chunk-6AUQLYPZ.js";import"./chunk-UPIYMC4Q.js";import"./chunk-ZUO5BDO3.js";import"./chunk-A7EUFORV.js";import"./chunk-QEPQGEPL.js";import"./chunk-RZOHZNJG.js";import"./chunk-RQTEHFJ2.js";import{a as le}from"./chunk-75EAYNWR.js";import"./chunk-DKVOSSSH.js";import"./chunk-FWL474H4.js";import{n as ue,t as de,x as J}from"./chunk-V7YATDMZ.js";import"./chunk-YRQLRR65.js";import"./chunk-T2AAZNU7.js";import"./chunk-E4CKCWHV.js";import"./chunk-66RCYZEO.js";import{y as me,z as fe}from"./chunk-BIUKJDG5.js";import"./chunk-MNRE2RWN.js";import"./chunk-S63SUKPS.js";import"./chunk-QR6SNDPA.js";import"./chunk-DB7NVRTE.js";import"./chunk-EF6FTTLT.js";import"./chunk-U44ZBWPF.js";import"./chunk-YPTISS47.js";import"./chunk-UX2JFEX5.js";import"./chunk-XHRUTTJG.js";import"./chunk-OS6U6P6N.js";import"./chunk-PLVYKYSQ.js";import"./chunk-MEZ72IGZ.js";import"./chunk-ZLTTBRML.js";import"./chunk-XUGHAFHG.js";import"./chunk-B5L26Z2J.js";import"./chunk-AVG63QW4.js";import{d as V}from"./chunk-YLT6ZRGE.js";import"./chunk-VSNCKUAC.js";import"./chunk-OB65JCC3.js";import"./chunk-ZWKYYPCG.js";import"./chunk-YLPOVMK6.js";import"./chunk-CAWXATKV.js";import"./chunk-GIKT3XNH.js";import"./chunk-4VAKOKZO.js";import"./chunk-F43OFDEC.js";import"./chunk-XAUZ4FZE.js";import"./chunk-5JVWMQI2.js";import"./chunk-KLS3SJXA.js";import"./chunk-5DQKP6TK.js";import"./chunk-QTPS5BDP.js";import"./chunk-KOQXCGQ5.js";import"./chunk-P7NYIGUS.js";import"./chunk-OWPVBYY3.js";import"./chunk-ZNFTIF43.js";import"./chunk-D52EE5TC.js";import"./chunk-FEU7MNAN.js";import"./chunk-CWNI35TN.js";import"./chunk-E6SXR3B6.js";import"./chunk-GTBNRR37.js";import"./chunk-UUOZSCBD.js";import"./chunk-A7FGCMOW.js";import"./chunk-V2CZ7DY4.js";import"./chunk-3PLVXUNW.js";import"./chunk-HIUQCAJS.js";import"./chunk-S6FHNOIH.js";import"./chunk-RKCZ2ONP.js";import"./chunk-RER2JAFZ.js";import"./chunk-CJAFGYQK.js";import"./chunk-QED56456.js";import"./chunk-HSSW2VTC.js";import"./chunk-PYCB247J.js";import"./chunk-2LQJ3JX6.js";import"./chunk-KF7FMIRD.js";import"./chunk-N4IYN7DD.js";import"./chunk-UY2DPNBT.js";import"./chunk-SZZZVLQW.js";import"./chunk-V5J3A5L5.js";import"./chunk-CERSDYPT.js";import"./chunk-RZETZIQO.js";import"./chunk-P5GHREX3.js";import"./chunk-HUG2KBCE.js";import"./chunk-6XMXPOUW.js";import"./chunk-3WKBEXBH.js";import"./chunk-RK4OLGCC.js";import"./chunk-NNPT43SF.js";import"./chunk-VL2JCPJS.js";import"./chunk-CTJAEFLV.js";import"./chunk-AP4E6GDF.js";import"./chunk-RPH2MNBW.js";import"./chunk-SKUQ6ZA4.js";import"./chunk-P3FTJE4X.js";import"./chunk-ACIP3YF7.js";import"./chunk-W6ZDZJCJ.js";import"./chunk-PGGBOJAH.js";import"./chunk-JDCCMYBK.js";import"./chunk-554VFFSY.js";import"./chunk-4ADHM5NM.js";import"./chunk-JBOOQ7HO.js";import"./chunk-RKPJE2LG.js";import"./chunk-NQGIYDUG.js";import"./chunk-QTCVWDVR.js";import"./chunk-MLF4IONJ.js";import"./chunk-4ITEJ5A6.js";import"./chunk-JYCBCMDP.js";import"./chunk-CBZ2RV36.js";import"./chunk-GVYIP5Q5.js";import"./chunk-VHMBEOFX.js";import"./chunk-L3AMAP6V.js";import{d as ae,e as ie}from"./chunk-W3VW6MYS.js";import"./chunk-GWHLETPD.js";import"./chunk-6GJ4TEPK.js";import"./chunk-BYDDPVAA.js";import"./chunk-CSTKCSUP.js";import"./chunk-M43NTBTB.js";import{p as ce}from"./chunk-CKHT4PIF.js";import"./chunk-JMNZU6WB.js";import"./chunk-WXD7TULU.js";import"./chunk-JQHLKZPQ.js";import"./chunk-ZZBUS7GI.js";import"./chunk-PMG6IXOR.js";import"./chunk-BD5XO4WL.js";import"./chunk-7U7FORYL.js";import"./chunk-MT3ANHCR.js";import"./chunk-2IJ4E4D3.js";import"./chunk-XJ2EVWVX.js";import"./chunk-DD6IGY5O.js";import"./chunk-JMM35KIH.js";import"./chunk-5E7YC7OF.js";import"./chunk-LYGOKEAJ.js";import"./chunk-NS5EW6UN.js";import"./chunk-VUBIYSGX.js";import"./chunk-PNOOVDMP.js";import"./chunk-FHFRBSOO.js";import"./chunk-DU4RS7AX.js";import"./chunk-5C7AUJM4.js";import"./chunk-FLXVXXZH.js";import"./chunk-XBUPORYF.js";import"./chunk-YVLQLIW6.js";import"./chunk-HBXZ3GPM.js";import"./chunk-6C7RJCTT.js";import"./chunk-N6PI3XTA.js";import"./chunk-7DW2ZPOD.js";import"./chunk-SI5WJURV.js";import"./chunk-MT4YWUUK.js";import"./chunk-IPVHRCDK.js";import"./chunk-JW2AVC2H.js";import"./chunk-AKOAGCJX.js";import"./chunk-ARDRUD4P.js";import"./chunk-WYX7GFOD.js";import"./chunk-G6PA2JD3.js";import"./chunk-N2N44VBE.js";import"./chunk-ZDJRNLYZ.js";import"./chunk-RV5WZKGQ.js";import"./chunk-MJSLAJV6.js";import{l as oe}from"./chunk-KC2XLVFC.js";import{qa as se}from"./chunk-MJDO2VHF.js";import"./chunk-TFTCL6XD.js";import{h as ne}from"./chunk-TBQGFYU3.js";import"./chunk-L5AZICLM.js";import"./chunk-WLEQHCLB.js";import"./chunk-QF42JCDG.js";import"./chunk-DRCTWZQB.js";import"./chunk-KGMP5AO5.js";import{c as re}from"./chunk-EAE2NUFS.js";import"./chunk-OLICTWCW.js";import"./chunk-SDBZJWGW.js";import"./chunk-F3ILJHGP.js";import"./chunk-6M37VPK2.js";import"./chunk-WOJGOC63.js";import{ca as b}from"./chunk-3F7OC7N7.js";import"./chunk-HZOYPVSA.js";import"./chunk-Z4GX4TH2.js";import"./chunk-OKGWI7CU.js";import{i as j}from"./chunk-EPDR6VAQ.js";import"./chunk-RFTC6RNT.js";import"./chunk-I6UBKGB5.js";import"./chunk-ZIR6OOXX.js";import"./chunk-KYVX6VSI.js";import"./chunk-WN3TRBGI.js";import"./chunk-3FMJDUGT.js";import"./chunk-2O5TMJZM.js";import{l as ee}from"./chunk-UI4IZNSB.js";import"./chunk-FCGPU67F.js";import"./chunk-FXRKHQFW.js";import"./chunk-YTHL7242.js";import"./chunk-XOHZCMW2.js";import{Hb as te,Ua as h,ua as O}from"./chunk-EQ34WRCJ.js";import"./chunk-UIZGYUZK.js";import{p as _}from"./chunk-DSNMNSMD.js";import"./chunk-U2IAA473.js";import"./chunk-DOSBJ3L3.js";import"./chunk-DNGRHKLV.js";import"./chunk-3O2IEAHF.js";import{I as H}from"./chunk-URGJ6D4O.js";import"./chunk-WC6GCIBJ.js";import"./chunk-I2AEM4CA.js";import"./chunk-JRC3ZUKA.js";import"./chunk-4U5VOZ7H.js";import"./chunk-FVHZWNUE.js";import"./chunk-IQUFNLVG.js";import"./chunk-XYWWXNVK.js";import"./chunk-VYWNZTTM.js";import"./chunk-5CHTOVVG.js";import"./chunk-FB3ILH2L.js";import{b as G}from"./chunk-FLSAETOH.js";import"./chunk-TGW66MRK.js";import"./chunk-LRIABBHT.js";import"./chunk-NEASQB35.js";import"./chunk-5BYM6SMZ.js";import"./chunk-TR37MFB4.js";import"./chunk-PNECIDQW.js";import"./chunk-BVDMVGLD.js";import{Aa as Me,Q}from"./chunk-4C5HF6J2.js";import"./chunk-4HSSECLD.js";import"./chunk-BY6XCDJZ.js";import"./chunk-U6W3TK77.js";import"./chunk-6GYKGMWB.js";import"./chunk-WJI4CIAQ.js";import"./chunk-PESQD55U.js";import"./chunk-WQGQVXPA.js";import"./chunk-GTDBOF5Q.js";import"./chunk-EI7BJC6V.js";import"./chunk-UY3WU5XU.js";import"./chunk-ALECRBLY.js";import"./chunk-B3EOGJ3Y.js";import"./chunk-YL2RBVBZ.js";import"./chunk-4HAPQ4J7.js";import"./chunk-QM6LXDU7.js";import"./chunk-WZALYVUQ.js";import"./chunk-F5YUOHHL.js";import"./chunk-26KHACOU.js";import"./chunk-VONUGAVN.js";import"./chunk-ZVKCRT3D.js";import"./chunk-MSOW5GDX.js";import"./chunk-O5NUB7LT.js";import"./chunk-QI2KSP5Y.js";import"./chunk-EL77VG5Z.js";import"./chunk-LWG66QL2.js";import"./chunk-26XSB24L.js";import"./chunk-IFKSF5TW.js";import"./chunk-PDIVTGDM.js";import"./chunk-UL6IEE2K.js";import"./chunk-4ARIYUS3.js";import{f as N,o as f,q as u}from"./chunk-UWURTNRY.js";f();u();var Ae=N(G());f();u();var S=N(G());f();u();var w=N(G());Me();var Re=({code:e,data:r,error_message:o,error:s})=>{if(e!==0||!r||r.queryGasLimitErrorUseDefault||s)return{fee:0,feeError:!0,feeErrorMsg:o};let{gasLimit:a="0"}=r;return{...r,fee:a,feeError:!1,feeErrorMsg:""}},ve=e=>e?.feeError&&e?.feeErrorMsg?e.feeErrorMsg:"",De=(e,r)=>{let o=Q(e)||j(e,r),s=Q(e)||j(e,0);return{isSufficientGas:o,isSufficientBalance:s}},Ue=({coinId:e,unapproved:r,paramsInfo:o})=>{let{coin:s,toAdr:a,fromAddr:t,walletId:i,messages:n,network:c,validUntil:k}=o,{chainId:T,localType:m}=s||{},d=ce(t,r?.walletId,O),y=te?.[O]?.[d],A=pe(e,r.walletId,{addressType:y})||{},{coinAmountInt:F}=A,P=J(),x=(0,w.useRef)(null),[M,g]=(0,w.useState)(!0),[l,U]=(0,w.useState)({}),[E,q]=(0,w.useState)({});(0,w.useEffect)(()=>{m&&e&&t&&i&&n&&(async()=>{try{g(!0);let p=await P({coinId:e,address:t,toAddr:a,fromAddr:t}),C=await me({nonce:p?.nonce,localType:m,fromAddr:t,walletId:i,messages:n,network:c,validUntil:k});q({signInfo:p,sequence:p?.nonce,inputData:JSON.stringify(C?.stringInputParams),transactionParams:C?.transactionParams})}catch(p){g(!1),U({feeError:!0,feeErrorMsg:p?.message})}})()},[m,e,t,i,n]),(0,w.useEffect)(()=>((()=>{let{inputData:p}=E;if(g(!0),p){let C=async()=>{let Y=await fe({fromAddr:t,chainId:T,coinId:e,inputData:p}),z=Re(Y);g(!1),U(z)};(()=>{clearInterval(x.current),C(),x.current=setInterval(C,7e3)})()}})(),()=>{clearInterval(x.current)}),[E.inputData,T,t,e]);let{isSufficientGas:W,isSufficientBalance:K}=De(F,l?.fee),R=ve(l);return{networkFeeProps:{coinId:e,loading:M,estimateFailed:l?.feeError,estimateFailedMsg:R,networkFee:l?.fee},isSufficientGas:W,isSufficientBalance:K,estimateFailed:l?.feeError,estimateFailedMsg:R,extParams:{coinId:e,coinAmount:0,inputData:E?.inputData,fromAdr:t,toAdr:a,serviceCharge:l?.fee,extJson:JSON.stringify({nonce:E?.sequence}),txSource:2,accountId:r?.walletId,walletType:2,transactionParams:E?.transactionParams},coinWithBalance:A}},ye=Ue;f();u();function Ne(e){let r=V(h)||{},{address:o,walletId:s}=D(e),a=e?.params?.transaction||{},t=a?.messages||[],i=a?.network,n=a?.valid_until,{address:c}=t[0]||{};return{toAdr:c,coin:r,fromAddr:o,walletId:s,messages:t,validUntil:n,network:i}}var xe=Ne;f();u();var I=N(G());var Ge=({origin:e,walletId:r,localType:o})=>{let s=de(),[a,t]=(0,I.useState)(!0),{host:i}=ge({origin:e}),n=D({walletId:r,localType:o}),[c,k]=(0,I.useState)({}),T=(0,I.useCallback)(async(y,A,F)=>{let P="";try{P=JSON.stringify(F)}catch{}let{coinId:x,chainId:M}=y,g=await s({coinId:x,checkTypes:[b.KYS,b.VERIFY_GAS_LIMIT],amount:0,from:n.address,to:"",txType:3,domain:i,tokenAddress:"",inputData:A,chainId:M,additionalData:{tonSignData:P}});k(g),t(!1)},[i,s,n.address]),m=(0,I.useMemo)(()=>({loading:a,...c[b.KYS]||{}}),[a,c]),d=(0,I.useMemo)(()=>c[b.VERIFY_GAS_LIMIT]||{},[c]);return{kysRet:m,loading:a,preExecute:T,preExecuteRet:c,verifyGasLimitRet:d}},Ee=Ge;f();u();var Ce=N(G());var Oe=e=>e?{message:e}:null,be=e=>e?ie.BAD_REQUEST_ERROR:null,Le=e=>!e||e.length===0;function We({transaction:e,fromAddress:r}){let{valid_until:o,network:s,from:a,messages:t}=e,[i,n]=(0,Ce.useState)("");return oe(async()=>{if(s!==ae.MAINNET)n(_("wallet_extension_error_incorrect_destination_network"));else if(o<Math.floor(Date.now()/1e3))n(_("wallet_extension_error_expired_transaction"));else if(Le(t))n(_("wallet_extension_error_invalid_transaction_parameter"));else{let{TonWallet:c}=await ee(),k=new c;for(let d=0;d<t.length;d++){let y=t[d]?.address;if(!await le(y,h)){n(_("wallet_extension_error_incorrect_destination_network"));return}}let T=await k.convertAddress({address:r}),m=await k.convertAddress({address:a});T?.raw!==m?.raw&&n(_("wallet_extension_error_incorrect_receiving_address"))}},[o,s,a,r]),{checkParamsTipMessage:Oe(i),code:be(i)}}var Ie=We;var Be=(0,S.memo)(({unapproved:e})=>{let r=se(),o=V(h)||{},s=o?.coinId||h,{walletId:a,address:t,addressType:i}=D(e),n=xe(e),k=(i?.[O]||[]).find(v=>v.address===t),T=J(),{networkFeeProps:m,isSufficientGas:d,estimateFailed:y,estimateFailedMsg:A,isSufficientBalance:F,extParams:P,coinWithBalance:x}=ye({coinId:s,unapproved:e,paramsInfo:n}),{id:M,origin:g,localType:l}=e,U=Ee({origin:g,walletId:a,localType:l}),{inputData:E,transactionParams:q}=P,W=(0,S.useRef)(),{preExecute:K,kysRet:R,verifyGasLimitRet:X}=U,B=e?.params?.transaction||{};(0,S.useEffect)(()=>{o?.coinId&&!m?.loading&&!W.current&&(W.current=!0,K(o,E,B))},[o?.coinId,m?.loading,E]);let p=_e({kysRet:R,baseCoin:o,estimateFailed:y,estimateFailedMsg:A,isSufficientGas:d,isSufficientBalance:F,verifyGasLimitRet:X,coinWithBalance:x}),{checkParamsTipMessage:C,code:Z}=Ie({transaction:B,fromAddress:t}),Y=ke({id:M,walletId:a,origin:g,localType:l,extraParams:{code:Z}}),z=C||p,Pe=async()=>{try{let v=await T({coinId:s,address:n?.fromAddr,toAddr:n?.toAdr,fromAddr:n?.fromAddr}),$=await re().approveDappRequest(M,{...P,transactionParams:{...q,seqno:v?.nonce,walletVersion:k?.addressType},extJson:JSON.stringify({nonce:v?.nonce})});if($.code===10009){H.error($?.msg||_("wallet_extension_failure_subtitle_fail_resend"));return}await ne(r)}catch(v){H.error(v?.msg||_("wallet_extension_failure_subtitle_fail_resend"))}},{buttonGroup:he,handleCancel:Fe}=Te({coinId:s,unapproved:e,preExecuteRet:U,feeLoading:m?.loading,estimateFailed:y,isSufficientGas:d,isSufficientBalance:F,disabledConfirmBtn:!!C,onConfirm:Pe,onCancel:Y,coinWithBalance:x});return ue({kysRet:R,handleCancel:Fe}),S.default.createElement(we,{kysRet:R,unapproved:e,tipMessage:z,buttonGroup:he,networkFee:m,coinId:s})}),Se=Be;var qt=({unapproved:e})=>Ae.default.createElement(Se,{unapproved:e});export{qt as default};
//# sourceMappingURL=Ton-IYY45FLF.js.map
