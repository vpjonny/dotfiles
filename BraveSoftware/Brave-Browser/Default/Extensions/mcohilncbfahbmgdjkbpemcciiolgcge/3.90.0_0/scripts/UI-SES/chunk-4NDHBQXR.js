import{h as Se,i as be,j as Ie,k as Ne,m as Ue}from"./chunk-E2GB7AO4.js";import{a as B}from"./chunk-YTEKE6MB.js";import{a as G,b as K}from"./chunk-WX3NG5HB.js";import{d as he,e as ke,f as Le}from"./chunk-HRKKQNEB.js";import{c as Pe,d as ee}from"./chunk-GZTCY5NF.js";import{f as Ee}from"./chunk-FOIG34R3.js";import{f as ge,n as g,q as ve,s as Ae}from"./chunk-P6LOADSA.js";import{Q as V,Sb as de,Vc as Te,Yc as Y,_c as we,bc as L,dc as A,g as me,h as i,kd as xe,mc as q,pd as v,qd as U,sd as Ce,tc as h}from"./chunk-CS663DOD.js";import{a as ye}from"./chunk-WFJJHRZ4.js";import{e as ce,n as ue,q as fe}from"./chunk-L3SRMZJF.js";import{a as _e}from"./chunk-SRAKDH5C.js";import{z as y}from"./chunk-K36OLSUR.js";import{N as J,d as E}from"./chunk-4RYTWPZK.js";import{e as P,n as t,p as o}from"./chunk-N62DF26F.js";t();o();var l=P(E());var nt=P(ge());var ae=P(J());t();o();t();o();var Oe=me.init({project:fe});function Re(...r){return Oe.set(...r)}function Fe(...r){return Oe.get(...r)}var $="wallet_collapsed_keyrings",Be=r=>{let s=(Fe($)||[]).filter(n=>n!==r);return Re($,s),s};t();o();var S=P(E());var De=({elementName:r,children:e})=>{let s={lastTimestamp:null,charCount:0,paste:!1,result:[]},[{lastTimestamp:n,charCount:a,paste:u,result:p},_]=(0,S.useState)(s),d=f=>{let N=Date.now(),b=null;if(n){let I=N-n,X=f.length-a;I>0&&(b={count:X,duration:I},p.push(b))}_({lastTimestamp:N,charCount:f.length,paste:u,result:f?[...p]:[]})},T=()=>{if(p.length>0&&a!==0&&u){let f=p.reduce((b,I)=>b+I.duration,0),N={e:r,l:a,d:f};ee.logPostRate(N),_({lastTimestamp:n,charCount:a,paste:!1,result:p})}},x=()=>{_({lastTimestamp:Date.now(),charCount:a,paste:u,result:p})},k=()=>{_({lastTimestamp:n,charCount:a,paste:!0,result:p})};return S.default.cloneElement(e,{onChange(...f){e.props.onChange&&e.props.onChange(...f),d(typeof f[0]=="string"?f[0]:f[0].target.value)},onBlur(...f){e.props.onBlur&&e.props.onBlur(...f),T()},onFocus(...f){e.props.onFocus&&e.props.onFocus(...f),x()},onPaste(...f){e.props.onPaste&&e.props.onPaste(...f),k()}})};var Gt=r=>{let{elementName:e,...s}=r;return S.default.createElement(De,{elementName:e},S.default.createElement(A.Password,{...s}))};var Kt=({elementName:r,children:e})=>{let s={lastTimestamp:null},[{lastTimestamp:n},a]=(0,S.useState)(s),u=()=>{a({lastTimestamp:Date.now()})},p=d=>{let T=Date.now();if(n){let x=T-n;if(x>0&&d){let k={e:r,l:d.length,d:x};ee.logPostRate(k)}}a({lastTimestamp:T})};return S.default.cloneElement(e,{onFocus(...d){e.props.onFocus&&e.props.onFocus(...d),u()},onPaste(...d){let T=d[0]?.clipboardData?.getData("text");e.props.onPaste&&e.props.onPaste(...d),p(T)}})},Me=De;t();o();var z=P(E());t();o();t();o();var ut=()=>{};function ft(){return[!1,ut]}var We=ft;var Ve=We;t();o();t();o();t();o();var dt=()=>"extension",j=()=>null;var gt=()=>{try{B.BiometricsVerificationSecondFailurePopupView({tg_platform:j()||""})}catch{}},Ye=(r=!1)=>{try{B.BiometricsVerificationSecondFailurePopupButtonClick({tg_platform:j()||"",button:r?"password":"cancel"})}catch{}},_t=(r,e)=>{gt();let s=L.tip({infoType:L.Tip.INFO_TYPE.default,title:i("wallet_extension_tgsync_dialog_title_verification_fail"),children:i("wallet_extension_tgsync_dialog_desc_verification_fail"),confirmText:i("wallet_extension_tgsync_dialog_btn_use_password"),btnFull:!1,zIndex:40003,cancelText:i("commonall_text_btn_cancel"),onConfirm:async()=>{Ye(!0),await Promise.resolve(r()),s.destroy()},onCancel:async()=>{Ye(!1),await Promise.resolve(e?.()),s.destroy()}});return s},Ge=_t;var Pt=r=>{let[e]=K(G.passwordType),[s]=Ve(),[n,a]=(0,z.useState)(e),u=()=>{a(1)},p=U(async(d=!0)=>{if(!s){await Promise.resolve(r?.());return}if(!d){await Promise.resolve(r?.());return}Ge(u,r)}),_=U(()=>{a(e)});return(0,z.useEffect)(()=>{a(e)},[e]),{currentPasswordType:n,isPasskeyNewUser:s,onVerifyPasskeyFailed:p,onResetPasswordType:_}},Ke=Pt;t();o();var Z=P(E()),ze=P(ge());t();o();var $e=null;function ko(r){$e=r}function Tt(){return $e}function wt(){return Tt()?.url}function je(){return Pe(wt())}t();o();var R=P(E());t();o();var O={root:"_root_mkvsv_1",title:"_title_mkvsv_4",desc:"_desc_mkvsv_13",btn:"_btn_mkvsv_22",still:"_still_mkvsv_25",forgot:"_forgot_mkvsv_29"};function te({openNotification:r,resetPassword:e}){return R.default.createElement(h.Container,{className:O.root},R.default.createElement(g.Text,{className:O.title},i("wallet_extension_biometrics_dialog_title_cant_unlock")),R.default.createElement(g.Text,{className:O.desc},i("wallet_extension_biometrics_dialog_desc_cant_unlock")),R.default.createElement(y,{block:!0,category:y.CATEGORY.fill,type:y.TYPE.highlight,size:y.SIZE.lg,onClick:()=>{r()},className:O.btn},i("wallet_extension_biometrics_dialog_btn_cant_unlock_switch")),R.default.createElement(g.Text,{className:O.forgot,strong:!0,size:g.SIZE.sm,type:g.TYPE.secondary,onClick:()=>{e()}},i("wallet_extension_biometrics_btn_still_unable_unlock")))}function oe(){let r=(0,ze.useHistory)(),e=(0,Z.useRef)(null),s=()=>{e.current&&(e.current.destroyAll(),setTimeout(()=>{e.current=null}))},n=()=>{e.current||(e.current=L.action({onClose:()=>{s()},visible:!0,maskClosable:!0,children:Z.default.createElement(te,{openNotification:()=>{let{pathname:a,search:u}=r.location,_=je()===ce;globalThis.platform.openExtensionInPopup(`${a}${u}`,null,!_)},resetPassword:()=>{s(),B.webMetaxSettingsWalletSecurityResetWalletClick(),v.push(Y)}})}))};return Ce(()=>{s()}),{open:n,close:s}}t();o();t();o();var F=P(E());t();o();var re=class{getUiConnection(){let e=V();if(!e)throw new Error("[PassKey Proxy] UI connection not available");return e}async isSupportPasskey(){return this.getUiConnection().passkeyIsSupportPasskey()}async isSupportModernAuth(){return this.getUiConnection().passkeyIsSupportModernAuth()}async createPasskey(){return this.getUiConnection().passkeyCreatePasskey()}async verifyPasskey({credential:e,password:s}){return this.getUiConnection().passkeyVerifyPasskey({credential:e,password:s})}async getPassword(e){return this.getUiConnection().passkeyGetPassword(e)}async getAuthToken(){return this.getUiConnection().passkeyGetAuthToken()}async randomBytes(e=64){return this.getUiConnection().passkeyRandomBytes(e)}},xt=new re,Ze=xt;var He=P(J());t();o();var H={root:"_root_g36fg_1",image:"_image_g36fg_4",btn:"_btn_g36fg_7"};function se({className:r,onPass:e}){let[s]=K(G.credentialId),n=Ee({light:"./static/images/passkey-light.png",dark:"./static/images/passkey-dark.png"}),[a,u]=(0,F.useState)(!1),p=async()=>{try{u(!0);let{password:_}=await Ze.getPassword(s);e(_)}catch{u(!1)}finally{u(!1)}};return F.default.createElement(h.FlexBox,{className:(0,He.default)(H.root,r),direction:h.DIRECTION.vertical,align:h.ALIGN.center,justify:"center",onClick:p},F.default.createElement(_e,{className:H.image,src:n,width:80,height:80}),F.default.createElement(y,{className:H.btn,category:y.CATEGORY.fill,type:y.TYPE.primary,loading:a,size:y.SIZE.md,onClick:p},i("wallet_extension_biometrics_loading_unlock")))}var Xe=se;t();o();var ne=P(E());t();o();var D=P(E()),Je=P(J());t();o();var Qe={"wallet-link":"_wallet-link_fxfbg_1",walletLink:"_wallet-link_fxfbg_1"};var Ct=({to:r,href:e,style:s,target:n,children:a,className:u,replace:p=!1})=>{let _=n||(e?"_blank":"_self"),d=(0,D.useCallback)(T=>{if(T.preventDefault(),T.stopPropagation(),p){v.replace(r);return}r&&v.push(r)},[r,p]);return D.default.createElement("a",{to:r,href:e,style:s,target:_,className:(0,Je.default)(Qe["wallet-link"],u),onClick:d},a)},qe=D.default.memo(Ct);t();o();var et={forgetPasswordLink:"_forgetPasswordLink_l8eva_1"};var Et=({className:r="",strong:e=!1,from:s="",replace:n,path:a})=>{let u=a??Y;return ne.default.createElement(qe,{to:s?`${u}?from=${s}`:u,className:`${r} ${et.forgetPasswordLink}`,replace:n},ne.default.createElement(g.Text,{size:g.SIZE.xs,type:g.TYPE.secondary,align:g.ALIGN.left,strong:e},i("wallet_footer_subtitle_forgot_password")))},tt=Et;t();o();var ot=(r="")=>{let e=r.trim().split("&").map(n=>n.split("=")),s={};return e.forEach(n=>{n[0]&&(s[n[0]]=decodeURIComponent(n[1]))}),s};t();o();t();o();var rt=P(E());var st=({confirm:r,visible:e})=>rt.default.createElement(L.Prompt,{visible:e,infoType:L.Prompt.INFO_TYPE.warn,title:i("wallet_extension_security_dialog_protect_seed_phrase"),confirmText:i("commonall_text_btn_ok_passive"),text:i("wallet_extension_security_dialog_no_leak"),onConfirm:r,hideCloseBtn:!0,alignBottom:!1,maskClosable:!1,confirmBtnProps:{type:y.TYPE.highlight,size:y.SIZE.lg}});t();o();t();o();var w={guard:"_guard_12t0i_1",title:"_title_12t0i_1",subTitle:"_subTitle_12t0i_6",inputPassword:"_inputPassword_12t0i_11",inputClass:"_inputClass_12t0i_15",guardInputClass:"_guardInputClass_12t0i_19",guardHeaderClass:"_guardHeaderClass_12t0i_22",forgot:"_forgot_12t0i_25",forgotInput:"_forgotInput_12t0i_30",unlockTrigger:"_unlockTrigger_12t0i_34"};var ht=async({actionType:r,dispatch:e,groupId:s,keyringId:n,walletId:a})=>{if(["removeLastWallet","removeWallet"].includes(r)){await e(Ne(s));try{let u=Be(n);await V().setLocalStorage($,u)}catch{}}else r==="removeAccount"&&await e(Ie(a))},kt=async({passwordResult:r,setRemoveLoading:e,guard:s,setVisible:n,actionType:a,keyringId:u,dispatch:p,groupId:_,walletId:d,confirm:T,password:x,setPasswordError:k})=>{if(!!r)try{if(e(!0),await Se(r)===!0){if(s){n(!0);return}if(await ht({actionType:a,dispatch:p,groupId:_,keyringId:u,walletId:d}),a==="removeLastWallet"){await p(be()),await p(Ue()),await p(he(1)),await p(ke(void 0)),await p(Le("XKO")),v.push(we);return}a==="removeAccount"?q.success(i("wallet_extension_delete_notification_account_deleted")):a==="removeWallet"&&q.success(i("wallet_editwallet_toast_delete_wallet_success")),T(x)}}catch{e(!1),k(i("wallet_set_password_errortip_password_wrong"))}},Zs=r=>{let e=(0,nt.useHistory)(),{current:{walletId:s,actionType:n,nextPath:a=Te,groupId:u,keyringId:p}}=l.default.useRef(ot(e&&e.location.search.slice(1))),{callback:_,guard:d,onBack:T,path:x}=r,k=(0,l.useRef)(),M=de(),[f,N]=l.default.useState(),[b,I]=l.default.useState(),[X,ie]=(0,l.useState)(!1),[at,it]=(0,l.useState)(!1),{currentPasswordType:lt,onVerifyPasskeyFailed:pt}=Ke(),W=lt===2,mt=U(({target:{value:C}})=>{N(C),I(void 0)},[]),le=C=>{if(ie(!1),_){_(C);return}a&&v.replace(a)},Q=U(async()=>{let C=k.current||f;await kt({passwordResult:C,setRemoveLoading:ie,guard:d,setVisible:it,actionType:n,keyringId:p,dispatch:M,groupId:u,walletId:s,confirm:le,password:f,setPasswordError:I})},[a,s,f,n]),{open:ct}=oe(),pe=(0,l.useMemo)(()=>x===xe,[x]);return l.default.createElement("div",{className:"verify_password_page__wrapper main-container",onKeyDown:C=>{C.key==="Enter"&&Q()}},l.default.createElement(Ae,{bordered:!1,closeable:["removeWallet"].includes(n),onBack:T}),l.default.createElement("div",{className:"verify-password-page"},pe?l.default.createElement(l.default.Fragment,null,l.default.createElement(h.FlexBox,{className:w.guard,direction:h.DIRECTION.vertical},l.default.createElement(g.Text,{strong:700,className:w.title},i("wallet_extension_security_header_backup_seed_phrase")),l.default.createElement(g.Text,{type:g.TYPE.secondary,className:w.subTitle},i("wallet_extension_security_desc_seed_phrase_leak")))):l.default.createElement("h2",{className:(0,ae.default)("verify-password-page__header",{[w.guardHeaderClass]:d})},i("wallet_extension_tgsync_current_password_verify")),l.default.createElement("div",{className:`verify-password-page__input ${(0,ae.default)(w.inputClass,{[w.guardInputClass]:d})}`},W?l.default.createElement(Xe,{className:w.unlockTrigger,onPass:async C=>{k.current=C,await Q()},onCancel:pt}):l.default.createElement(Me,{elementName:"v"},l.default.createElement(A.Password,{autoFocus:!0,value:f,autoComplete:"off",onChange:mt,placeholder:i("wallet_extension_tg_enter_password",{},{useBr:!1}),size:A.SIZE.xl,error:b,errorType:A.TIP_TYPE.always,inputClassName:"verify-password-page__input__core",label:pe?i("wallet_set_password_maintitle_enter_password"):""}))),W&&ye()!==ue?l.default.createElement(g.Text,{className:w.forgot,align:g.ALIGN.center,size:g.SIZE.xs,type:g.TYPE.secondary,onClick:()=>{ct()}},i("wallet_extension_biometrics_dialog_title_cant_unlock")):l.default.createElement(tt,{className:W?w.forgot:w.forgotInput}),l.default.createElement(ve.FooterActions,{usePortal:!0,renderNative:!0,buttonGroup:[{loading:X,onClick:Q,size:y.SIZE.lg,visible:!W,type:y.TYPE.highlight,category:y.CATEGORY.fill,disabled:!f||f?.length<6||!!b,btnText:i("wallet_set_password_btn_confirm")}]}),l.default.createElement(st,{visible:at,confirm:le})))};export{Ve as a,dt as b,j as c,Ke as d,Ze as e,Xe as f,Gt as g,Kt as h,Me as i,qe as j,ko as k,je as l,oe as m,tt as n,Zs as o};
//# sourceMappingURL=chunk-4NDHBQXR.js.map
