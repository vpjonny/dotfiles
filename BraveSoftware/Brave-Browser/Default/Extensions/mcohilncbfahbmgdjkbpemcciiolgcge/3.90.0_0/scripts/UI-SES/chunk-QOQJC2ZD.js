import{b as Ft,d as Dt,e as Se}from"./chunk-GZUN7S34.js";import{a as Rt,c as zt,d as Ht,e as Kt}from"./chunk-NIQLLW5J.js";import{a as oe}from"./chunk-JXSHNBQI.js";import{b as Qe,c as Je,d as Xe,e as et,f as tt,g as ot,j as rt,k as st,l as nt,m as at}from"./chunk-DOYXPNLR.js";import{b as Mt,c as Me}from"./chunk-VUC4EO27.js";import{e as B,f as bt,g as ge,h as ee,j as Nt,k as At}from"./chunk-XUNQN7AR.js";import{a as It,e as we,l as he,n as Ot,o as Ut}from"./chunk-4NDHBQXR.js";import{b as St,e as Lt,f as vt,g as Wt,l as te}from"./chunk-E2GB7AO4.js";import{a as Ct,b as Et}from"./chunk-U5ZZGKGM.js";import{a as M}from"./chunk-YTEKE6MB.js";import{a as ye,b as _e}from"./chunk-WX3NG5HB.js";import{d as H,e as K}from"./chunk-HRKKQNEB.js";import{f as xt,g as Ae}from"./chunk-FOIG34R3.js";import{f as No,n as z,q as Pe,s as Bt}from"./chunk-P6LOADSA.js";import{$c as ut,Cc as dt,E as ie,Lc as ft,N as D,Oc as pe,Q as Ge,Sb as X,Tb as Z,Vc as j,Zc as fe,a as He,bc as mt,cd as be,dc as le,dd as yt,ec as pt,h as _,kc as me,ld as _t,m as Ke,mc as ne,n as Ve,nd as wt,pd as T,qd as ue,rd as Pt,sd as gt,tc as k,td as ht,ud as kt,vd as Ne,wd as Tt,x as Ye,y as $e}from"./chunk-CS663DOD.js";import{a as de}from"./chunk-WFJJHRZ4.js";import{a as qe,b as Ze,c as je,e as Ee,n as ce}from"./chunk-L3SRMZJF.js";import{a as lt}from"./chunk-SRAKDH5C.js";import{a as ct,t as Ie,z as h}from"./chunk-K36OLSUR.js";import{N as it,d as q}from"./chunk-4RYTWPZK.js";import{e as W,n as r,p as s}from"./chunk-N62DF26F.js";r();s();var I=W(q());var Fe=W(No());r();s();var Vt=W(q());var Ao={"MNEMONIC WALLET":"seed_phrase","PRIVATE KEY WALLET":"private_key","MPC WALLET":"mpc","HARDWARE WALLET":"hardware"},Mo=o=>{let t=Nt(),i=At(t),e=Ao[i?.keyringIdentityType];return(0,Vt.useCallback)(a=>{o({...a,wallet_type:e})},[o,e])},Le=Mo;r();s();var V=W(q());r();s();r();s();function So(){}var Yt=So;var $t=Yt;r();s();var R=W(q()),Gt=W(it());r();s();var Q={root:"_root_15akf_1",image:"_image_15akf_4",title:"_title_15akf_7",desc:"_desc_15akf_15",btns:"_btns_15akf_23","cancel-width":"_cancel-width_15akf_26",cancelWidth:"_cancel-width_15akf_26"};function ve({type:o,step:t,onCancel:i,onRetry:e}){let n=xt({light:"./static/images/passkey-light-big.png",dark:"./static/images/passkey-dark-big.png"}),c={["create"]:{title:{text:"wallet_extension_biometrics_drawer_title_verification",keys:{num:1,total:2},color:"var(--okd-color-content-primary)"},desc:"wallet_extension_biometrics_drawer_desc_verification",cancel:"commonall_text_btn_cancel",onCancel:i},["verify"]:{title:{text:o==="create"?"wallet_extension_biometrics_drawer_title_verification":"wallet_extension_biometrics_drawer_title_unlock",keys:{num:2,total:2},color:"var(--okd-color-content-primary)"},desc:o==="create"?"wallet_extension_biometrics_drawer_desc_verification":"wallet_extension_biometrics_drawer_desc_unlock",cancel:"commonall_text_btn_cancel",onCancel:i},["error"]:{title:{text:"wallet_extension_biometrics_drawer_title_fail_setup",color:"var(--okd-color-semantic-negative)"},desc:"wallet_extension_biometrics_drawer_desc_fail_setup",confirm:"commonall_emptystate_text_try_again",onConfirm:e,cancel:"commonall_text_btn_cancel",onCancel:i},["init"]:null,["success"]:null}[t];return c?R.default.createElement(k.Container,{className:Q.root},R.default.createElement(k.FlexBox,{className:Q.image,align:k.ALIGN.center,justify:"center"},R.default.createElement(lt,{src:n,width:120,height:120})),R.default.createElement(z.Text,{strong:700,className:Q.title,style:{color:c.title.color}},_(c.title.text,c.title.keys)),R.default.createElement(z.Text,{strong:400,className:Q.desc},_(c.desc)),R.default.createElement(k.FlexBox,{className:Q.btns,align:k.ALIGN.center,justify:"center"},R.default.createElement(h,{block:c.confirm,category:h.CATEGORY.fill,type:h.TYPE.gray,size:h.SIZE.lg,onClick:()=>{c.onCancel()},className:(0,Gt.default)({[Q.cancelWidth]:!c.confirm})},_(c.cancel)),c.confirm?R.default.createElement(h,{block:!0,category:h.CATEGORY.fill,type:h.TYPE.highlight,size:h.SIZE.lg,onClick:()=>{c.onConfirm()}},_(c.confirm)):null)):null}function J(){let[o]=_e(ye.credentialId),[t,i]=(0,V.useState)("init"),[e,n]=(0,V.useState)("init"),a=(0,V.useRef)(null),c=(0,V.useRef)(d=>d),C=async(d,m)=>{try{n("create"),i("create"),c.current=d,await Se(500);let{password:P,credential:Y,credentialId:U}=await we.createPasskey(m??"");i("verify");try{await we.verifyPasskey({credential:Y,password:P})}catch($){$t(),i("error"),await d(null,$);return}a.current?.destroy(),i("success"),await d({password:P,credentialId:U})}catch(P){i("error"),await d(null,P)}},w=async d=>{try{n("verify"),i("verify"),c.current=d;let{password:m}=await we.getPassword(o);await D().verifyPassword({__secretData__:{password:m}}),a.current?.destroy(),i("success"),await d(!!m)}catch{i("error"),await d(!1)}},E=()=>{i("init"),n("init"),a.current?.destroy()},L=()=>{e==="create"&&C(c.current),e==="verify"&&w(c.current)},b=async()=>{de()!==ce&&(a.current||(a.current=mt.action({mask:!1})),await Se(100),a.current.update({visible:!0,mask:!0,onClose:()=>{E()},children:V.default.createElement(ve,{step:t,type:e,onRetry:()=>{L()},onCancel:()=>{E()}})}))};return Pt(()=>{if(t==="init"||t==="success"){a.current?.destroy();return}b()},[t]),gt(()=>{a.current?.destroy()}),{create:C,verify:w}}r();s();var N=W(q());r();s();var ke={root:"_root_cl85f_1",passwordInput:"_passwordInput_cl85f_6"};var qt=({onBack:o,onComplete:t,title:i=void 0,desc:e=void 0,learnMoreProps:n={},showLearnMore:a=!0,disabled:c=!1,autoFocus:C=!1,customContent:w=N.default.createElement(N.default.Fragment,null),containerClassName:E=""})=>{let d=oe().get("from")===x.HARDWARE,m=me.useForm(),[P,Y]=(0,N.useState)({}),[U,{setTrue:$,setFalse:se}]=Tt(!1);Kt(m,P);let G=!P.password||!P.confirm||P.password?.length<Me||P.confirm?.length<Me||P.password!==P.confirm,l=ue(async()=>{let{password:p,confirm:v}=P;if(!(U||G)){if(p!==v){Rt(m);return}M.Web3ExtensionPasswordBtmConfirmClick(),$(),await t(v),se()}},[G,P]),g=(0,N.useCallback)(async p=>{(p?.key==="Enter"||p?.keyCode===13)&&await l()},[]);return(0,N.useEffect)(()=>(document.addEventListener("keydown",g),()=>{document.removeEventListener("keydown",g)}),[]),N.default.createElement(zt,{className:ke.root,containerClassName:E,title:i||_("wallet_signup_maintitle_set_password"),desc:e||_(d?"wallet_extension_signup_subtitle_set_password_hardware":"wallet_extension_subtitle_password_unlock"),showLearnMore:a,learnMoreProps:n,onBack:o},({formClass:p,formErrorClass:v,itemClass:A})=>N.default.createElement(me,{form:m,size:le.SIZE.lg,validateTrigger:["onChange","onBlur"],className:p,errorClassName:v,onValuesChange:(ae,xe)=>{Y(xe)}},N.default.createElement(me.Item,{name:"password",style:{marginBottom:0},className:A,label:_("wallet_set_password_subtitle_password")},N.default.createElement(le.Password,{autoFocus:C,autoComplete:"off",size:le.SIZE.xl,inputClassName:ke.passwordInput,placeholder:_("wallet_settings_reset_passord_placeholder_input_desc",void 0,{useBr:!1})})),N.default.createElement(Ht,{form:m,itemClass:A,inputClassName:ke.passwordInput}),w,N.default.createElement(Pe.FooterActions,{usePortal:!0,renderNative:!0,buttonGroup:[{loading:U,disabled:c||G,block:!0,type:h.TYPE.highlight,category:h.CATEGORY.fill,size:h.SIZE.lg,btnText:_("wallet_set_password_btn_confirm"),onClick:l}]})))};r();s();var We=class{getUiConnection(){let t=Ge();if(!t)throw new Error("[Window Proxy] UI connection not available");return t}async open(t,i,e){await this.getUiConnection().windowOpen(t,i,e)}async close(){await this.getUiConnection().windowClose()}},Lo=new We,Zt=Lo;r();s();r();s();var S=W(q());var Be=W(it());r();s();var O={content:"_content_16nvb_1",title:"_title_16nvb_4",desc:"_desc_16nvb_12",list:"_list_16nvb_19",item:"_item_16nvb_22","item-select":"_item-select_16nvb_39",itemSelect:"_item-select_16nvb_39","item-content":"_item-content_16nvb_42",itemContent:"_item-content_16nvb_42","item-title":"_item-title_16nvb_46",itemTitle:"_item-title_16nvb_46",questionMarkIcon:"_questionMarkIcon_16nvb_55","item-desc":"_item-desc_16nvb_60",itemDesc:"_item-desc_16nvb_60",link:"_link_16nvb_67",anchor:"_anchor_16nvb_71",icon:"_icon_16nvb_72"};function Oe({list:o,active:t}){let i=Mt();return S.default.createElement(S.default.Fragment,null,o.map(e=>S.default.createElement(k.FlexBox,{className:(0,Be.default)(O.item,{[O.itemSelect]:t(e.type)}),direction:k.DIRECTION.horizontal,align:k.ALIGN.center,justify:"space-between",onClick:()=>{e.onClick()},key:e.type},S.default.createElement(k.Box,{className:O.itemContent},S.default.createElement(z.Text,{className:O.itemTitle},_(e.title),e?.info?.url&&S.default.createElement(Ie,{className:(0,Be.default)("okx-wallet-plugin-question-mark",O.questionMarkIcon),onClick:n=>{n.stopPropagation(),n.preventDefault(),Ke(`${i.origin}${e.info.url}`,"_blank")}})),S.default.createElement(z.Text,{className:O.itemDesc},_(e.desc)),e.link?S.default.createElement(k.FlexBox,{className:O.link,direction:k.DIRECTION.horizontal,align:k.ALIGN.center},S.default.createElement(ct,{alt:_(e.link.text),rel:"nofollow",onClick:n=>{n.stopPropagation(),n.preventDefault(),M.webMetaxSettingsWalletSecurityResetPasswordClick(),T.push(e.link.url)},className:O.anchor},_(e.link.text),S.default.createElement(Ie,{iconName:"okx-wallet-plugin-right",className:O.icon}))):null,e.bottomElement??null),t(e.type)?S.default.createElement(pt.Circle,{checked:!0}):null)))}var jt=Oe;r();s();function Qt(){let o=Z(pe),t=Z(ft);o&&!t&&T.replace(j)}var Jt=({handleClickPasskey:o,handleClickPassword:t,completedOnboarding:i,passwordType:e})=>[{type:1,title:"wallet_extension_biometrics_radio_title_password",desc:"wallet_extension_biometrics_radio_desc_password",onClick:t,link:i&&e===1?{url:fe,text:"wallet_extension_biometrics_btn_change_password"}:null},{type:2,title:"wallet_extension_biometrics_radio_title_authentication",desc:"wallet_extension_biometrics_radio_tips_keep_passkey",onClick:o,info:{url:""}}],Xt=async({result:o,modifyPassword:t})=>{let i=!1;return i=await t(o?.password),i},eo=!1,to=async()=>await Ct(),oo=()=>{};r();s();var re={root:"_root_mpzi1_1",content:"_content_mpzi1_4",title:"_title_mpzi1_7",desc:"_desc_mpzi1_15",list:"_list_mpzi1_22",item:"_item_mpzi1_25","item-select":"_item-select_mpzi1_32",itemSelect:"_item-select_mpzi1_32","item-title":"_item-title_mpzi1_35",itemTitle:"_item-title_mpzi1_35","item-desc":"_item-desc_mpzi1_43",itemDesc:"_item-desc_mpzi1_43",link:"_link_mpzi1_50",anchor:"_anchor_mpzi1_54",icon:"_icon_mpzi1_55",forgot:"_forgot_mpzi1_67"};r();s();r();s();function vo(){let{verify:o}=J();return async i=>{await o(e=>{e&&i()})}}var ro=vo;var so=ro;r();s();var co=W(q());r();s();var Wo=()=>ue((...o)=>{let t=o[0];T.push({pathname:_t,search:`?type=${dt.INITIALIZE}`,...t!==void 0&&{state:{hasPassword:t}}})}),no=Wo;r();s();r();s();function ao({getBackground:o}){let t={[ge.addAccount]({hardware:e,account:n,baseChain:a,walletId:c}){return Ae(),o().addHardwareWalletAccount(e,n,a,c)},[ge.addChain]({account:e,baseChain:n,walletId:a}){return o().addChainForHardwareWallet(e,n,a)},others({hardware:e,account:n,baseChain:a}){return Ae(),o().importHardwareWalletAccount(e,n,a)}},i={[B.ledger](e){let{otherInfo:n}=e,{ledgerInfo:a}=n||{};e.hardwareWalletModel=a.productName||ee[B.ledger]},[B.trezor](e){e.hardwareWalletModel=ee[B.trezor]},[B.keystone](e){let{otherInfo:n}=e,{keystoneInfo:a}=n||{};e.hardwareWalletModel=a.device||ee[B.keystone]},[B.onekey](e){let{otherInfo:n}=e,{onekeyInfo:a}=n||{},c=a?.deviceType?`${bt[B.onekey]} ${Ye(a?.deviceType)}`:"";e.hardwareWalletModel=c||ee[B.onekey]}};return({accounts:e,hardware:n,baseChain:a,walletId:c,type:C,...w})=>async()=>{let E;for(let L of e){let b=$e(L);b.otherInfo=w,i[n](b),b.hardwareWalletType=ee[n];let d=t[C];d||(E?.walletId?(C=ge.addAccount,c=E.walletId,d=t[C]):d=t.others);let m=await d({hardware:n,account:b,baseChain:a,walletId:c});E??=m}return E}}var io=ao({getBackground:D});var Te=o=>{let t=X(),i=no(),{seedPhrase:e,privateKey:n,mpcInfo:a,unlockHardwareWallets:c,chooseNetworkList:C,isTonMnemonic:w}=Z(l=>({seedPhrase:Qe(l),isTonMnemonic:ot(l),privateKey:Je(l),chooseNetworkList:tt(l),mpcInfo:et(l),unlockHardwareWallets:Xe(l)})),{setValue:E}=Dt(),{value:L}=Ft();(o===x.SEED&&!e||o===x.KEY&&!n||o===x.BULK&&!L||o===x.MPC&&(!a||ie(a))||o===x.HARDWARE&&(!c||ie(c)))&&T.push(j);let b=async l=>{let g=`${be}/${o}`,{keyringName:p="",walletName:v=""}=l||{},A=`${p}-${v}`;await T.push({pathname:g,state:{walletName:A,anim:"1",next:j}})},d=async l=>{await t(St(l)),await t(te()),i(!0)},m=async l=>{let g=e?.trim().toLowerCase().match(/\w+/gu)?.join(" ")||"",p=await t(Lt({password:l,mnemonic:g,isTonMnemonic:w}));await t(te()),await b(p),t(rt())},P=async l=>{let g=await t(vt({password:l,baseChains:C,privateKey:n}));await t(te()),await b(g),t(st())},Y=l=>{E(l),T.push(wt)},U=async(l,g)=>{ie(c)||(await D().setPassword({__secretData__:{password:l}},!0),await t(H(g?2:1)),await t(K(g)),await t(io(c)),await t(te()),t(nt()));let p=`${be}/${x.HARDWARE}`;he()===je&&globalThis.platform.openExtensionInPopup(`${p}?anim=1`)},$=async l=>{let{cipherText:g,privateKey:p,mpcId:v,userInfo:A}=a;if(g&&p&&v){let ae=await t(Wt(l,{cipherText:g,privateKey:p},{mpcId:v,userInfo:A},!0));await t(te()),await b(ae),t(at())}},se={[x.CREATE]:d,[x.SEED]:m,[x.KEY]:P,[x.BULK]:Y,[x.HARDWARE]:U,[x.MPC]:$};return(0,co.useCallback)(async(l,g)=>{try{await se[o](l,g)}catch(p){ne.error(p.message?p.message:JSON.stringify(p))}},[o])};r();s();r();s();var Bo=()=>{let{create:o}=J(),i=oe().get("from")||x.CREATE,e=Te(i),n=X();return async(...a)=>{await o(async c=>{if(c){let{password:C,credentialId:w}=c;await e(C,w),await n(H(2)),await n(K(w)),M.WalletBiometricsExtensionButtonClick({button_name:"biometric",platform:"extension"})}},...a)}},lo=Bo;var mo=lo;var x={SEED:"seed",KEY:"key",HARDWARE:"hardware",CREATE:"create",MPC:"mpc",BULK:"bulk"},Oo=()=>{let o=(0,Fe.useHistory)(),t=he(),i=t===qe||t===Ee,e=t===Ze,n=t===Ee;return{openNotification:()=>{let{pathname:C,search:w}=o.location,E=w?"&":"?",L="openFromThisPage=1";globalThis.platform.openExtensionInPopup(`${C}${w}${E}${L}`,null,!n)},closeNotification:()=>{Zt.close()},needOpenNotification:i,isNotification:e}};function Uo(){let o=X(),t=(0,Fe.useHistory)(),i=so(),{needOpenNotification:e,isNotification:n,openNotification:a,closeNotification:c}=Oo(),C=()=>{if(!e){let y=new Ve(He(T.history.location.search));y.remove("from"),T.push({pathname:j,search:y?`?${y.stringify()}`:""});return}T.goBack()},[w]=_e(ye.passwordType),[,E]=It(),[L,b]=(0,I.useState)(1),d=de()===ce?"telegram":"extension";ht(async()=>{await Et()||b(1)});let m=Z(pe);Qt();let[P,Y]=(0,I.useState)(!1);kt(async()=>{try{if(await to(m))return;let F=m?yt:ut;T.replace({pathname:F,search:t.location.search})}finally{Y(!0)}},[]);let U=oe(),$=U.get("from")||x.CREATE,se=Te($),G=U.get("openFromThisPage")==="1",l=y=>m?w===y:L===y,[g,{toggle:p}]=Ne(!1),[v,{toggle:A}]=Ne(!1),ae=Le(M.UnlockWalletTopBiometricsClick),xe=Le(M.UnlockWalletTopPasswordClick),{create:po,verify:fo}=J(),uo=mo(),yo=async()=>{if(e){a();return}uo()},_o=async()=>{A()},wo=async y=>{await po(async F=>{if(F){let ze=!1,bo=F?.credentialId;p(),ze=await Xt({result:F,modifyPassword:D().modifyPassword}),ze&&(ne.success(_("wallet_edit_wallet_toast_renamed_success")),await o(H(2)),E(!0),await o(K(bo)),M.WalletBiometricsExtensionButtonClick({button_name:"biometric",platform:d}),n&&G&&c())}},eo?y:"")},De=async y=>{let F=null;y?(A(),F=await D().modifyPassword(y)):F=!0,F&&(ne.success(_("wallet_edit_wallet_toast_renamed_success")),await o(H(1)),E(!0),await o(K(void 0)),M.WalletBiometricsExtensionButtonClick({button_name:"password",platform:d}),n&&G&&c())},Po=()=>{if(!m){b(2);return}if(m&&w===2){T.goBack();return}if(e){a();return}p()},go=async()=>{if(!m){b(1);return}if(m&&w===1){T.goBack();return}if(e){a();return}await fo(y=>{y&&A()})},ho=()=>{p()},ko=async()=>{await i(A,De)},[To,Ce]=(0,I.useState)(!1),xo=async()=>{try{Ce(!0),L===2?(await yo(),ae()):(await _o(),xe())}catch{Ce(!1)}finally{Ce(!1)}},Re=async y=>{oo(y),y?ho():ko()},Co=()=>{T.push({pathname:fe})},Eo=()=>Jt({handleOpenVerify:Re,handleSetPassword:Co,handleClickPasskey:Po,handleClickPassword:go,completedOnboarding:m,passwordType:w});if(!P)return null;if(g)return I.default.createElement(Ut,{onBack:p,callback:wo});if(v)return I.default.createElement(qt,{onBack:A,onComplete:async y=>{m?await De(y):(await se(y),await o(H(1)),await o(K(void 0)),M.WalletBiometricsExtensionButtonClick({button_name:"password",platform:d}))}});let Io={list:Eo(),active:l,passwordType:w,handleOpenVerify:Re};return I.default.createElement(k.Box,{className:re.root},I.default.createElement(Bt,{bordered:!1,closeable:!1,onBack:C}),I.default.createElement(k.Container,{className:re.content},I.default.createElement(z.Text,{className:re.title},_("wallet_extension_biometrics_header_title_unlock")),I.default.createElement(k.Box,{className:re.list},I.default.createElement(jt,{...Io})),I.default.createElement(Pe.FooterActions,null,m?I.default.createElement(Ot,{className:re.forgot,strong:!0}):I.default.createElement(h,{block:!0,category:h.CATEGORY.fill,type:h.TYPE.highlight,size:h.SIZE.lg,loading:To,onClick:()=>{xo()}},_("commonall_button_text_next")))))}export{qt as a,no as b,io as c,mo as d,x as e,Uo as f};
//# sourceMappingURL=chunk-QOQJC2ZD.js.map
