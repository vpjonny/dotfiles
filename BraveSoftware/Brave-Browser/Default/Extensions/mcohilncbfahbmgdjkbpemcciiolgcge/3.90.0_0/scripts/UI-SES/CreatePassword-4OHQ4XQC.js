import{b as Fe,c as Ne,d as We}from"./chunk-QOQJC2ZD.js";import{d as Me}from"./chunk-GZUN7S34.js";import{b as L,c as Ue}from"./chunk-NIQLLW5J.js";import{a as Be}from"./chunk-JXSHNBQI.js";import{b as X,c as ee,d as oe,e as te,f as re,g as se,j as ae,k as ne,l as ie,m as me}from"./chunk-DOYXPNLR.js";import"./chunk-KANP3CMI.js";import{c as Ie,d as Ae}from"./chunk-VUC4EO27.js";import"./chunk-XUNQN7AR.js";import"./chunk-NM4WOM75.js";import{b as $,c as G,l as Se,n as ke}from"./chunk-4NDHBQXR.js";import{b as ye,e as be,f as Ce,g as Re,l as xe}from"./chunk-E2GB7AO4.js";import"./chunk-U5ZZGKGM.js";import{a as T}from"./chunk-YTEKE6MB.js";import"./chunk-WX3NG5HB.js";import{d as Te,e as Ee}from"./chunk-HRKKQNEB.js";import"./chunk-GZTCY5NF.js";import{a as Je}from"./chunk-FOIG34R3.js";import{f as Pe}from"./chunk-HJASUAAI.js";import{q as he}from"./chunk-P6LOADSA.js";import{E as z,Ec as ce,N as U,Oc as le,Q as j,Sb as F,Tb as N,Vc as W,cd as de,dc as A,h as u,kc as y,mc as pe,nd as fe,pd as k,qd as we,td as _e,wd as ge}from"./chunk-CS663DOD.js";import{a as ue}from"./chunk-WFJJHRZ4.js";import{c as Q,n as J}from"./chunk-L3SRMZJF.js";import"./chunk-OSJ66QVC.js";import"./chunk-PHQSAPCN.js";import"./chunk-H7A2GXA7.js";import"./chunk-SRAKDH5C.js";import{z as I}from"./chunk-K36OLSUR.js";import"./chunk-VYWNZTTM.js";import{d as Y}from"./chunk-4RYTWPZK.js";import{e as B,n as r,p as s}from"./chunk-N62DF26F.js";r();s();var _=B(Y());r();s();r();s();var Xe=()=>()=>Promise.resolve(!1),Le=Xe;var Oe=Le;r();s();var R=B(Y());function ve(){let i=F(),a=N(le),[n,o]=(0,R.useState)(!1);return(0,R.useEffect)(()=>{a&&!n&&k.push(W)},[a,n,i]),(0,R.useCallback)(()=>{o(!0)},[])}r();s();var c=B(Y());var qe=({onSubmit:i,formClass:a,itemClass:n,formErrorClass:o,setFormValues:O,bulkButtonStyle:v={},disabled:q,loading:t,showConfirm:g=!0,showForgetPassword:P=!1,showPasswordIndicator:D=!0,forgetPwdFrom:E="",forgetPasswordPath:x})=>{let K=y.useForm();return c.default.createElement(y,{form:K,size:I.SIZE.lg,onSubmit:i,validateTrigger:["onChange"],className:a,errorClassName:o,onValuesChange:(f,w)=>{O(w)}},c.default.createElement(y.Item,{name:"password",style:{marginBottom:"0px"},className:n},c.default.createElement(A.Password,{autoFocus:!0,autoComplete:"off",inputClassName:L.passwordInput,size:A.SIZE.xl,placeholder:u("wallet_set_password_maintitle_enter_password")})),D&&c.default.createElement(y.Item,{noStyle:!0,shouldUpdate:(f,w)=>f.password!==w.password},({getFieldValue:f})=>{let w=f("password");return c.default.createElement(Ae,{password:w})}),g&&c.default.createElement(y.Item,{name:"confirmPassword",style:{flex:1,margin:"16px 0px 0px"},dependencies:["password"],className:n,rules:[({getFieldValue:f})=>({validator:(w,h)=>{let H=f("password");return h&&H!==h?Promise.reject(u("wallet_set_password_errortip_password_not_match")):Promise.resolve()}})]},c.default.createElement(A.Password,{autoComplete:"off",inputClassName:L.passwordInput,size:A.SIZE.xl,placeholder:u("wallet_set_password_input_reenter")})),P&&c.default.createElement(ke,{className:L.forgot,from:E,replace:!0,path:x}),c.default.createElement(he.FooterActions,{affixStyle:v,renderNative:!0,buttonGroup:[{loading:t,disabled:q,block:!0,type:I.TYPE.highlight,category:I.CATEGORY.fill,size:I.SIZE.lg,onClick:i,btnText:u("wallet_set_password_btn_confirm")}]}))};r();s();var De=B(Je());function Ke(i){return a=>(De.default.debug("background.setSeedPhraseBackedUp"),U().setSeedPhraseBackedUp(i).then(async()=>{await j().forceUpdateMetamaskState()}).catch(n=>{throw a(Pe(n.message)),n}))}r();s();function eo(i=""){let a=i==="create"?"create_wallet":"import_wallet";return _e(()=>{try{T.Web3NewOnboardingSetupPasswordFullPageView({source:a,platform:$(),tg_platform:G()})}catch{}}),{confirmMonitor:o=>{try{T.Web3NewOnboardingSetupPasswordConfirmButtonClick({platform:$(),tg_platform:G(),is_biometrics_enabled:o?"yes":"no",source:a})}catch{}}}}var He=eo;var d={SEED:"seed",KEY:"key",HARDWARE:"hardware",CREATE:"create",MPC:"mpc",BULK:"bulk"},_t=()=>{let i=Be(),[a,{set:n}]=ge(!1),[o,O]=(0,_.useState)({}),v=We(),q=Oe(),t=F(),{seedPhrase:g,privateKey:P,mpcInfo:D,unlockHardwareWallets:E,chooseNetworkList:x,isTonMnemonic:K}=N(e=>({seedPhrase:X(e),privateKey:ee(e),mpcInfo:te(e),unlockHardwareWallets:oe(e),chooseNetworkList:re(e),isTonMnemonic:se(e)})),f=ue()===J?"telegram":"extension",w=ve(),h=i.get("from"),H=h===d.HARDWARE,Ve=Fe(),M=h===d.BULK,{setValue:Ye}=Me(),{confirmMonitor:ze}=He(h),S=async(e,m)=>{try{t(Ke(!0)).then(async()=>{if(w(),await t(xe()),e===d.CREATE){Ve();return}let l=`${de}/${e}`,{keyringName:V="",walletName:p=""}=m||{},Qe=`${V}-${p}`;if(e===d.HARDWARE&&Se()===Q){globalThis.platform.openExtensionInPopup(`${l}?anim=1`);return}k.push({pathname:l,state:{walletName:Qe,anim:"1",next:W}})}).catch(()=>{})}catch{}},Z=_.default.useMemo(()=>{let{password:e,confirmPassword:m}=o;return!(e?.length>=Ie&&e===m)},[a,P,g,E,o]),$e=we(async()=>{if(T.Web3ExtensionPasswordBtmConfirmClick(),g){let p=await t(be({password:o.password,mnemonic:g?.trim().toLowerCase().match(/\w+/gu)?.join(" ")||"",isTonMnemonic:K}));S(d.SEED,p),t(ae())}if(P){let p=await t(Ce({password:o.password,privateKey:P,baseChains:x}));S(d.KEY,p),t(ne())}if(M){Ye(o.password),k.push(fe);return}let{cipherText:e,privateKey:m,mpcId:l,userInfo:V}=D;if(e&&m&&l){let p=await t(Re(o.password,{cipherText:e,privateKey:m},{mpcId:l,userInfo:V},!0));S(d.MPC,p),t(me())}if(!z(E)){await U().setPassword({__secretData__:{password:o.password}},!0);let p=await t(Ne(E));S(d.HARDWARE,p),t(ie())}if(!g&&!P&&!(e&&m&&l)&&z(E)){let p=await t(ye(o.password));S(d.CREATE,p)}},[Z,o,g,P,x]),Ge=()=>v(o?.password),Ze=async()=>{n(!0),ze(),T.Web3ExtensionPasswordBtmConfirmClick();let e=await q();try{e?await Ge():(await $e(),t(Te(1)),t(Ee(void 0)),T.WalletBiometricsExtensionButtonClick({button_name:"password",platform:f}))}catch(m){m.message===ce&&pe.error(u("wallet_home_toast_network_error"))}finally{n(!1)}};(0,_.useEffect)(()=>{if(M){let e=document.querySelector("#app");e&&(e.classList.remove("fullscreen"),e.classList.add("popup"))}return()=>{if(M){let e=document.querySelector("#app");e&&(e.classList.remove("popup"),e.classList.add("fullscreen"))}}},[]);let je=M?{position:"absolute",bottom:0,left:0}:{};return _.default.createElement(Ue,{title:u("wallet_signup_maintitle_set_password"),desc:u(H?"wallet_extension_signup_subtitle_set_password_hardware":"wallet_extension_subtitle_password_unlock")},({formClass:e,formErrorClass:m,itemClass:l})=>_.default.createElement(qe,{onSubmit:Ze,formClass:e,itemClass:l,formErrorClass:m,setFormValues:O,bulkButtonStyle:je,disabled:Z,loading:a}))};export{_t as default};
//# sourceMappingURL=CreatePassword-4OHQ4XQC.js.map
