import{a as oi,b as ce,c as ri,d as mi,f as di}from"./chunk-7SZ5M2YJ.js";import{a as Js}from"./chunk-LJH5W7ES.js";import{a as ii}from"./chunk-V347ZKZ3.js";import{a as J}from"./chunk-PSGT3KTF.js";import{a as ci}from"./chunk-E5UIMO2Q.js";import{b as ui}from"./chunk-POOOO7BN.js";import{a as ae,b as Zs,c as ti,f as ei,k as ni,n as Yo,o as ai}from"./chunk-E4GROAX5.js";import"./chunk-EYUFC4TO.js";import{a as Ho,b as Ko}from"./chunk-6U5AQS6C.js";import{a as si}from"./chunk-K6IXN25O.js";import{m as Os,n as xo,o as Ys,p as Bo,q as qo,r as Go,s as Vo,t as zs}from"./chunk-4E6PJXXD.js";import{b as As,e as Us,f as Fo,g as Gs,h as Bt,i as yr,j as qt,k as Qt,l as Hs,m as Qo,n as $s}from"./chunk-567ZSQZY.js";import{e as Uo}from"./chunk-RRYQDZYV.js";import"./chunk-AGXWN2TT.js";import"./chunk-S4V3ABCT.js";import{a as Vs,c as Ws}from"./chunk-R6FBHCT7.js";import"./chunk-J63JN6ZK.js";import{K as Wo,L as yt,M as Xs,u as qs,v as Do}from"./chunk-VHSFEXWL.js";import{a as bs,b as ye,d as wr}from"./chunk-MOM36K3J.js";import{e as Ps,j as Ls,k as vs}from"./chunk-LOS6KRNX.js";import"./chunk-O7CVD42X.js";import{a as we,c as Ns,d as Ds,e as ie}from"./chunk-LOGCUUNU.js";import{h as Q}from"./chunk-KUKFUJBA.js";import"./chunk-DWEK3EIG.js";import{d as vo,e as _s}from"./chunk-QR5EI5TJ.js";import"./chunk-BHFRQZBI.js";import"./chunk-57DLZB3H.js";import"./chunk-KJYTBTZX.js";import"./chunk-7B2UMYR3.js";import"./chunk-DLWPK36I.js";import{a as ys}from"./chunk-5T4URYBB.js";import{a as ks,d as Rr}from"./chunk-6KT3MJYR.js";import{f as Ks,g as W,m as js,n as dt}from"./chunk-ER33EHJQ.js";import{a as $}from"./chunk-LUU4SMIP.js";import{a as No}from"./chunk-4TAIYLPS.js";import{a as Rt,b as Qs,c as Mo,f as bt,g as Pe}from"./chunk-LQG7SAW5.js";import"./chunk-CTJA2WQT.js";import"./chunk-IKQGQFXB.js";import{a as Ms,b as Fs,c as xs,f as Bs}from"./chunk-F2F65RJN.js";import"./chunk-EGIK3RWU.js";import{a as Mt,b as Ft,c as xt,d as Es,e as Re,f as be,j as br,x as Rs}from"./chunk-TQ2XASI3.js";import{c as Oo}from"./chunk-XXAIJB4T.js";import{a as Jt}from"./chunk-VPT3GAIN.js";import{a as w,b as ws,c as x}from"./chunk-VJ2JNI4M.js";import{Aa as gt,Ba as R,D as Lo,H as fs,O as Ss,Pa as Ts,R as se,Ra as Cs,Va as Is,c as wo,f as ls,la as gs,na as Er,p as ne,q as hs,ra as O,x as Ee,xa as E,za as Et}from"./chunk-22THXMTO.js";import"./chunk-HUG2KBCE.js";import"./chunk-MCCEOABZ.js";import{a as Po}from"./chunk-UJWKDH2G.js";import{A as dr,B as lr,b as un,z as Y}from"./chunk-AHLFMVMC.js";import"./chunk-KZDRRGNV.js";import{a as y,b as ke,c as ps}from"./chunk-3DAKLS7D.js";import{e as bo,l as yo}from"./chunk-JVJHSYZS.js";import{A as Ae,C as kr,a as _,e as Ar,j as Dt,l as At,m as as,o as kt,p as cs,r as us,w as ms,x as ds,z as F}from"./chunk-IFGNGASP.js";import{$ as hn,$a as _o,$b as Rn,$d as zn,Ba as Tn,Bc as C,Bd as Gn,C as dn,Ca as D,Cd as Vn,Da as go,Dd as Wn,Ea as Cn,Eb as Ie,Fa as In,Fb as Eo,Fd as Hn,G as A,He as h,Ia as To,Ka as mt,Kc as z,La as Co,Lc as q,Na as hr,Pa as Ce,Qa as fr,Qb as gr,Sb as En,Ta as Io,Tc as Ro,Uc as k,Ud as Yn,V as io,Va as V,Vb as Tr,Vd as Kn,W as ln,Wa as tt,Wb as Cr,Wd as jn,X as Zt,Xa as ft,Xb as Ir,Xc as re,Xd as $n,Y as ao,Yd as Xn,Z as co,Za as _n,_ as pn,_a as It,_b as _r,_c as Pn,aa as fn,ab as Ao,ac as St,ae as Jn,be as Zn,c as ro,ce as ts,db as Sr,de as es,e as mn,eb as at,ec as bn,ee as os,fb as et,fe as rs,g as st,ga as uo,gc as yn,h as Tt,ha as te,hc as wn,i as Ct,ia as v,ie as ns,ja as mo,k as it,ka as lo,l as no,la as Se,ld as Ln,m as L,ma as po,md as vn,me as ss,n as ut,na as ho,nb as An,nd as On,o as so,oa as ge,ob as _t,od as Nn,pa as pr,pb as ko,pd as Dn,qa as fo,qb as X,qd as Mn,ra as ee,rb as ot,rd as Fn,sa as Sn,sb as kn,sd as xn,se as is,ta as Te,td as Bn,ua as gn,ud as qn,vd as Qn,xa as K,xd as Un,ya as So,yc as oe,za as j,zc as _e}from"./chunk-NPJCEXXH.js";import"./chunk-4HHTYYQM.js";import"./chunk-MTBP4NOE.js";import"./chunk-PWGSI7LM.js";import"./chunk-RVS5KJOS.js";import{B as oo}from"./chunk-5RLAMZDG.js";import"./chunk-VYWNZTTM.js";import"./chunk-K6YGPUNZ.js";import"./chunk-K6262WF4.js";import"./chunk-ZJ4FWIGG.js";import"./chunk-34KDKISZ.js";import"./chunk-AL77NTUI.js";import"./chunk-V3FLECS4.js";import"./chunk-LHUS6JBK.js";import"./chunk-R6TSAW7C.js";import"./chunk-2W2QYRRT.js";import"./chunk-Q7AZQDRY.js";import"./chunk-DSO47LPO.js";import"./chunk-QOQ6OPZO.js";import"./chunk-MGS2LE6A.js";import"./chunk-CBNY2XQM.js";import{q as cn}from"./chunk-FRGP5XJV.js";import{a as ka}from"./chunk-Q2B4R57L.js";import{b as U}from"./chunk-PJC4UBLU.js";import"./chunk-HDMZQINQ.js";import{$ as P,B as rn,G as zt,I as nn,L as sn,M as eo,S as ur,U as mr,W as an,Z as fe,c as G,f as nt,h as Nt,i as cr,j as T,k as Aa,o as Ze,r as en,s as to,x as on,z as Z}from"./chunk-JYNY5RZ4.js";import"./chunk-F6LAWA6D.js";import"./chunk-OAMYZMR4.js";import"./chunk-I7KURANN.js";import"./chunk-BGUOO6AC.js";import"./chunk-7R3RT472.js";import"./chunk-WIH4P5EU.js";import"./chunk-OQWPK3VC.js";import"./chunk-GUM36CPA.js";import{f as N,h as n,o as d,q as l}from"./chunk-LHDKEQAM.js";d();l();var ar=N(U()),_a=N(Jt());d();l();var pi=N(U());d();l();var jo=N(U());var li=({children:c,rootStore:t})=>{let e=ws(t),o=(0,jo.useMemo)(()=>(t.commonStore.rootStore=t,t.accountStore.rootStore=t,t),[t]);return jo.default.createElement(e.Provider,{value:o},c)};var hi=ut(({swapRootStore:c,bridgeRootStore:t,children:e,initTab:o})=>{let{commonStore:{currentTab:r}}=c.getInstance(),s=o||r,i=c.getInstance();return s===k.BRIDGE&&(i=t.getInstance()),pi.default.createElement(li,{rootStore:i},e)});d();l();var Oe=N(U());d();l();d();l();var ve=N(U()),fi=N(Jt());d();l();P();var Ea=()=>({from:{chainId:null,tokenContractAddress:null},to:{chainId:null,tokenContractAddress:null}}),Pr={BRIDGE:"bridge",SWAP:"swap"},Pt=class{constructor(t,e={},o={}){n(this,"setTab",t=>{this.tab=t});n(this,"hasFromToToken",t=>this.tab===k.LIMIT_ORDER?!Z(t?.data?.fromToken)&&!Z(t?.data?.toToken):!Z(t?.data?.fromTokenInfo)&&!Z(t?.data?.toTokenInfo));n(this,"getWidgetVersionParams",()=>!this.config.widgetVersion||this.tab===k.LIMIT_ORDER?{}:this.tab===k.BRIDGE?{widgetVersion:this.config.widgetVersion}:{widgetVersion:this.config.widgetVersion,widgetChainIds:this.config.widgetChainIds});n(this,"fetchSingleChainTokens",async({fromTokenAddress:t,toTokenAddress:e,chainId:o})=>{let[r,s]=await A(R.get(Jn,{params:{fromTokenAddress:t,toTokenAddress:e,chainId:o,...this.getWidgetVersionParams()}}));return[r,s]});n(this,"generateSingleChainTokenPair",async({walletChainId:t,...e})=>{let r={chainId:F(e.fromChainId)?e.fromChainId:e.toChainId,fromTokenAddress:e.fromTokenAddress,toTokenAddress:e.toTokenAddress};if(F(r.chainId)){let[a,u]=await this.fetchSingleChainTokens(r);if(!a&&this.hasFromToToken(u))return[a,u]}if(F(t)){let[a,u]=await this.fetchSingleChainTokens({chainId:t});if(!a&&this.hasFromToToken(u))return[a,u]}let[s,i]=await this.fetchSingleChainTokens({chainId:oe});return[s,i]});n(this,"fetchCrossChainTokens",async({fromChainId:t,toChainId:e,fromTokenAddress:o,toTokenAddress:r})=>{let[s,i]=await A(R.get(Hn,{params:{chainId:t,toChainId:e,fromTokenAddress:o,toTokenAddress:r,...this.getWidgetVersionParams()}}));return[s,i]});n(this,"generateCrossChainTokenPair",async({walletChainId:t,...e})=>{if(F(e.fromChainId)||F(e.toChainId)){let s={...e},{hasFrom:i,hasTo:a}=Pt.checkTokenParams({chainId:e.fromChainId,tokenContractAddress:e.fromTokenAddress},{chainId:e.toChainId,tokenContractAddress:e.toTokenAddress});bo(e.fromChainId,e.toChainId)&&(i?s={fromChainId:e.fromChainId,fromTokenAddress:e.fromTokenAddress}:a&&(s={toChainId:e.toChainId,toTokenAddress:e.toTokenAddress}));let[u,m]=await this.fetchCrossChainTokens(s);if(!u&&this.hasFromToToken(m))return[u,m]}if(F(t)){let[s,i]=await this.fetchCrossChainTokens({fromChainId:t});if(!s&&this.hasFromToToken(i))return[s,i]}let[o,r]=await this.fetchCrossChainTokens({fromChainId:oe});return[o,r]});n(this,"fetchLimitOrderRecommendTokens",async({fromChainId:t,toChainId:e,fromTokenAddress:o,toTokenAddress:r})=>{let[s,i]=await A(R.get(ts,{params:{fromChainId:t,toChainId:e,fromTokenAddress:o,toTokenAddress:r}}));return[s,i]});n(this,"generateLimitOrderTokenPair",async({walletChainId:t,...e})=>{let o=F(e.fromChainId),s=F(e.toChainId)?e.fromChainId===e.toChainId:!0;if(o&&s){let[u,m]=await this.fetchLimitOrderRecommendTokens(e);if(!u&&this.hasFromToToken(m))return[u,m]}if(F(t)){let[u,m]=await this.fetchLimitOrderRecommendTokens({fromChainId:t});if(!u&&this.hasFromToToken(m))return[u,m]}let[i,a]=await this.fetchLimitOrderRecommendTokens({fromChainId:oe,fromTokenAddress:""});return[i,a]});n(this,"getTokenPairByResponseData",t=>this.tab===k.LIMIT_ORDER?{from:t?.fromToken,to:t?.toToken}:{from:t?.fromTokenInfo,to:t?.toTokenInfo});n(this,"generateTokenAndTabConfig",({error:t,data:e})=>{if(t)return{error:t,from:null,to:null,tab:this.tab};let{from:o,to:r}=this.getTokenPairByResponseData(e);return{error:null,from:o,to:r,tab:this.tab}});n(this,"checkInputAmount",t=>{let e=_.BigNumber(t);return!e.isNaN()&&e.isFinite()&&e.gt(0)?e.toString():""});n(this,"generateInitConfigByParams",async({from:t,to:e,inputAmount:o,walletChainId:r})=>{let s=this.checkInputAmount(o),i={fromChainId:t.chainId,toChainId:e.chainId,fromTokenAddress:t.tokenContractAddress,toTokenAddress:e.tokenContractAddress,walletChainId:r};if(this.tab===k.BRIDGE){let[a,u]=await this.generateCrossChainTokenPair(i);return{...this.generateTokenAndTabConfig({error:a,data:u.data}),inputAmount:s}}if(this.tab===k.SWAP){let[a,u]=await this.generateSingleChainTokenPair(i);return{...this.generateTokenAndTabConfig({error:a,data:u.data}),inputAmount:s}}if(this.tab===k.LIMIT_ORDER){let[a,u]=await this.generateLimitOrderTokenPair(i);return{...this.generateTokenAndTabConfig({error:a,data:u.data}),inputAmount:s}}return{error:new Error("tab is not valid"),from:null,to:null,tab:this.tab,inputAmount:s}});this.setTab(t),this.dexParams=e,this.config=o}async makeDexParams(){let{dexParams:t}=this,e=t;Js(t)&&(e=this.readInfoFromLocalStorage());let o=F(e?.from?.chainId),r=F(e?.to?.chainId);return!o&&!r&&(e.walletChainId=await this.config.getChainId?.()),e}async initTokenPair(){let t=await this.makeDexParams(),{from:e,to:o,tab:r,inputAmount:s,error:i}=await this.generateInitConfigByParams(t);return{from:e,to:o,tab:r,inputAmount:s,error:i}}async switchTabAndInitToken(t){let{walletChainId:e,...o}=await this.makeDexParams(),{from:r,to:s,tab:i,inputAmount:a,error:u}=await this.generateInitConfigByParams({...o,tab:t});return{from:r,to:s,tab:i,inputAmount:a,error:u}}readInfoFromLocalStorage(){let t=Ea(),e;switch(this.tab){case k.SWAP:e=y.get(Tr);break;case k.BRIDGE:e=y.get(Cr);break;case k.LIMIT_ORDER:e=y.get(Ir)||y.get(Pn)?.LIMIT_ORDER;break;default:break}let o={from:{...t.from,...e?.from},to:{...t.to,...e?.to}};return e?.from?.tokenContractAddress?o:t}writeTabInfoToLocalStorage(t){Pt.writeTabInfoToLocalStorage(this.tab,t)}static writeTabInfoToLocalStorage(t,e){switch(t){case k.SWAP:y.set(Tr,e);break;case k.BRIDGE:y.set(Cr,e);break;case k.LIMIT_ORDER:y.set(Ir,e);break;default:break}}},wt=Pt;n(wt,"checkTokenParams",(t,e)=>{let o=Ys({fromChainId:t?.chainId,toChainId:e?.chainId,fromTokenAddress:t?.tokenContractAddress,toTokenAddress:e?.tokenContractAddress}),r=F(t?.chainId)&&!!t?.tokenContractAddress,s=F(e?.chainId)&&!!e?.tokenContractAddress;return{isValid:o,hasFrom:r,hasTo:s}}),n(wt,"judgeTabTypeByChainId",async t=>{let[e,o]=await A(R.get(es));if(e)return k.SWAP;let{swap:r=[],bridge:s=[]}=o.data;return r.includes(G(t))?k.SWAP:s.includes(G(t))?k.BRIDGE:k.SWAP}),n(wt,"judgeTabTypeByParams",async(t,e)=>{let{isValid:o,hasFrom:r,hasTo:s}=Pt.checkTokenParams(t,e);if(!o)return k.SWAP;let i=t?.chainId,a=e?.chainId;if(r&&s)return i===a?k.SWAP:k.BRIDGE;let u;return r&&!s&&(u=i),!r&&s&&(u=a),await Pt.judgeTabTypeByChainId(u)}),n(wt,"formatDialogParams",t=>({from:{chainId:t?.fromChainId,tokenContractAddress:t?.fromTokenAddress},to:{chainId:t?.toChainId,tokenContractAddress:t?.toTokenAddress}})),n(wt,"getDialogInitTab",async t=>{let{from:e,to:o}=Pt.formatDialogParams(t);return await Pt.judgeTabTypeByParams(e,o)});var Lt=wt;var Ra=()=>{let c=y.get(_r);if(c){if(y.remove(_r),c.startsWith(pn))return St.MEME_BUY;if(c.startsWith(ot))return St.BRIDGE;if(c.startsWith(X))return St.SWAP}return y.get(Rn)||St.SWAP},ba=c=>({[St.SWAP]:X,[St.BRIDGE]:ot,[St.MEME_BUY]:hn,[St.MEME_SELL]:fn})[c]||X,ya=c=>{switch(c){case ko:case X:return k.SWAP;case ot:return k.BRIDGE;default:return""}},Si=()=>{let{pathname:c}=(0,fi.useLocation)(),{params:t,replace:e}=ae(),{autoSwitch:o,from:r}=t,[s,i]=(0,ve.useState)(""),[a,u]=(0,ve.useState)(!0);return(0,ve.useEffect)(()=>{let m=Ra(),p=ba(m);if(o===Pr.BRIDGE&&!r.tokenContractAddress&&p!==c){e({pathname:p,params:{...t,autoSwitch:void 0}});return}let g=ya(c);g&&(async()=>{if(g===k.SWAP&&o===Pr.BRIDGE){let b=await Lt.judgeTabTypeByParams(t?.from,t?.to);b===k.BRIDGE&&e({pathname:ot,params:{...t,autoSwitch:void 0}}),i(b),u(!1)}else i(g),u(!1)})().catch(()=>{})},[c,o,r]),{tabType:s,autoSwitching:a}};d();l();var Lr=N(U());var gi=(c,t)=>{let{accountStore:e}=x(),{params:o}=ae(),{addressType:r}=o;(0,Lr.useEffect)(()=>{e.setAddressType(r)},[]);let s=Zs();(0,Lr.useEffect)(()=>{async function i(){let a=new Lt(c,o),{from:u,to:m,tab:p,inputAmount:g,error:I}=await a.initTokenPair(t);I||s(u,m,g,p)}c&&i().catch(()=>{})},[c])};d();l();var Ti=N(U()),Ci=N(Jt());var Ii=c=>{let{fromToStore:t}=x(),{from:e,to:o}=t,{params:r,replace:s}=ae(),{pathname:i}=(0,Ci.useLocation)(),a=ti();(0,Ti.useEffect)(()=>{let u=a(e,o);u&&c&&[X,ot].includes(i)&&(new Lt(c).writeTabInfoToLocalStorage(u),s({params:{...u,feeConfig:r.feeConfig}}))},[e?.chainId,e?.tokenContractAddress,o?.chainId,o?.tokenContractAddress,c,i])};var wa=c=>{let{tabType:t}=Si();gi(t,c),Ii(t)},_i=wa;d();l();var Ai=N(U());function ki(){let{accountStore:c,receiveAddressStore:t}=x(),{address:e,setUserForbiddenBridge:o}=c,{receiveAddrObj:r,computedSwapHighLight:s}=t,{specifiedAddress:i}=r||{};(0,Ai.useEffect)(()=>{let a=()=>{};if(e&&s){let{promise:u,cancel:m}=Xs(zn,{params:{userWalletAddress:e,receiveWalletAddress:i}});a=m,u.then(p=>{o(p?.data.blackListTypes||Io)}).catch(()=>{o(Io)})}else o(Io);return a},[e,o,i,s])}d();l();var Ei=N(U());function vr(){let{accountStore:{address:c}}=x();(0,Ei.useEffect)(()=>{E.setTags({address:c})},[c])}d();l();var Or=N(U());P();var Pa=()=>{let{quoteStore:c,accountStore:t,fromToStore:e,approveStore:o,recentTransactionStore:r,tokenModalStore:s}=x(),{computedAccountWalletAddresses:i}=t;(0,Or.useEffect)(()=>{let a=()=>{};return i&&(a=_s(i)),()=>{a?.()}},[i]),(0,Or.useEffect)(()=>{let a=vo({isPri:!0,needLogin:!0,subscribeParams:[{channel:ye.DEX_PUSH_ENGINE},{channel:ye.WALLET_ASSET}],onListenError:()=>{let u=T(c,"quote.bestRoute"),m={token:e.from,defiPlatformId:J.getCurrentRouteDefiPlatformId(e.computedIsCrossChain,u),isCrossChain:e.computedIsCrossChain,refetchQuote:()=>{c.fetchQuote()}};o.onSocketError(m),r.onSocketError(),e.setNeedBalanceLoading(!1),e.getSwapTokenBalance(),s.reloadTokenList()},onListenData:(u,m)=>{if(!!u){if(m?.channel===ye.DEX_PUSH_ENGINE){r.onSocket(u);let p=T(c,"quote.bestRoute"),g={token:e.from,defiPlatformId:J.getCurrentRouteDefiPlatformId(e.computedIsCrossChain,p),isCrossChain:e.computedIsCrossChain,refetchQuote:()=>{c.fetchQuote()}};o.onSocket({data:u,...g});return}m.channel===ye.WALLET_ASSET&&(s.updateAllTokenList(u),e.updateFromBalancePush(u))}}});return()=>{a?.()}},[r.onSocket,s.updateAllTokenList,e.updateFromBalancePush,t,c,r,s,e])},Ri=Pa;d();l();var Nr=N(U());P();var bi=({token:c,onListenData:t=nt,globalPrice:e})=>{(0,Nr.useEffect)(()=>{!Ae(c)||Rr(c,e)&&t(e)},[e,c?.chainId,c?.tokenContractAddress]),(0,Nr.useEffect)(()=>{if(!Ae(c))return nt;if(Rr(c,e))return nt;let o=vo({subscribeParams:{channel:bs.DEX_MARKET_TX_CHANNEL,chainId:String(c.chainId),tokenAddress:c.tokenContractAddress},onListenData:r=>{t(r?.[0]||{})},onListenError:nt});return()=>{o()}},[c?.chainId,c?.tokenContractAddress])},La=()=>{let{fromToStore:c={},commonMarketStore:t={}}=x(),{from:e,updateFromUsdPriceFromWs:o,to:r,updateToUsdPriceFromWs:s}=c,{globalPrice:i}=t;bi({token:e,onListenData:o,globalPrice:i}),bi({token:r,onListenData:s,globalPrice:i})},yi=La;d();l();var ue=N(U()),wi=N(Jt());ls.setDataProxy(R);var va=({currency:c,currentWallet:t,walletInfo:e,keyringIdentityTypeEnum:o,t:r,dispatch:s,currentTab:i,onBack:a})=>{let{commonStore:u,accountStore:m,recentTransactionStore:p,reset:g}=x();As();let I=(0,wi.useHistory)();(0,ue.useEffect)(()=>{v.setRuntimeContext({history:I,toLocale:r,dispatch:s,walletInfo:e,onBack:a})},[r,I,s,e,a]),(0,ue.useEffect)(()=>(t&&(v.updateGlobal({currentWallet:t}),m.setWalletConfig(t)),()=>{m.cleanWalletConfig()}),[t]),(0,ue.useEffect)(()=>(u.getUserUnit(c),u.fetchChainList({businessLine:1,currentTab:i}).catch(()=>{u.setChainListLoadError(!0)}),()=>{g()}),[]),(0,ue.useEffect)(()=>{m.setKeyringIdentityTypeEnum(o)},[o]),(0,ue.useEffect)(()=>{t.walletId?p.updatePendingOrders(t.walletId,i):p.setPendingOrders([])},[t.walletId,i]),ei()},Pi=va;d();l();var H=N(U()),vt=N(Jt());d();l();var me=N(U()),$o=N(Jt()),Di=N(ka());d();l();var Li=N(U());var Oa=()=>{let{fromToStore:c}=x(),{visibleAddFunds:t,addFundsParams:e,closeAddFunds:o}=c;return Li.default.createElement(oi,{visible:t,params:e,onBack:()=>{o()}})},vi=ut(Oa);d();l();var Oi=N(U());var Ni=()=>{let{fromToStore:c}=x(),{closeAddFunds:t}=c;(0,Oi.useEffect)(()=>{t()},[])};var Na=[X,ot],Da=({children:c,onBack:t})=>{let{showNavigator:e,title:o}=ri(),r=(0,$o.useLocation)(),s=(0,$o.useHistory)(),{isTelegramMiniApp:i}=v.global,{Navigator:a}=v.components,u=r.pathname.includes(Zt),m=r.pathname===X;Ni();let p=()=>{u&&se({...W(),button_name:"back"}),t?t(s.goBack,Na.includes(r.pathname)):s.goBack()},g=()=>i?ce.telegramContainer:e?m?ce.extensionFullContainer:ce.extensionContainer:ce.extensionContainerNoHeader,{recentTransactionStore:I}=x(),{dialogVisible:b,dialogOrderId:M,closeDialog:B}=I;return me.default.createElement("div",{className:(0,Di.default)("universe-swap background-base-primary",ce.wrapper)},e?me.default.createElement(a,{asPage:!0,title:o,onBack:p,closeable:!1}):null,me.default.createElement("div",{className:g()},c),me.default.createElement(vi,null),me.default.createElement(zs,{orderId:M,visible:b,onClose:B}))},Mi=ut(Da);var Ma=(0,H.lazy)(()=>import("./Swap-H27PKWQL.js")),Fa=(0,H.lazy)(()=>import("./Bridge-NOOWV4JK.js")),xa=(0,H.lazy)(()=>import("./OrderDetail-P6QUWHJP.js")),Ba=(0,H.lazy)(()=>import("./Contract-HBSHKLO4.js")),qa=(0,H.lazy)(()=>import("./Approve-JUEXREKI.js")),Qa=(0,H.lazy)(()=>import("./ApproveAndSwap-NMFS2ETF.js")),Ua=(0,H.lazy)(()=>import("./Solana-IYE7CCZ3.js")),Ga=(0,H.lazy)(()=>import("./Claim-SK76ZZMQ.js")),Va=({onBack:c})=>{let t=(0,vt.useLocation)();return H.default.createElement(Mi,{onBack:c},H.default.createElement(H.Suspense,null,H.default.createElement(vt.Switch,null,[{path:X,component:Ma,exact:!0},{path:ot,component:Fa,exact:!0},{path:ln,component:xa,exact:!0},{path:Zt,component:Ba,exact:!0},{path:co,component:Qa,exact:!0},{path:ao,component:qa,exact:!0},{path:uo,component:Ua,exact:!0},{path:te,component:Ga,exact:!0}].map((o,r)=>H.default.createElement(vt.Route,{key:r,path:o.path,component:o.component,exact:o.exact})),H.default.createElement(vt.Redirect,{from:ko,to:{pathname:X,search:t.search},strict:!0,exact:!0}))))},Fi=Va;var Wa=({...c})=>{let{initialized:t}=$s();return t?Oe.default.createElement(Ha,{...c}):null};function Ha({...c}){let{currency:t,currentWallet:e,keyringIdentityTypeEnum:o,walletInfo:r,onBack:s,t:i,dispatch:a,currentTab:u=k.SWAP}=c;return _i(r.chainId),Pi({currency:t,currentWallet:e,walletInfo:r,keyringIdentityTypeEnum:o,t:i,dispatch:a,currentTab:u,onBack:s}),ki(),Ri(),vr(),yi(),Oe.default.createElement(Fi,{onBack:s})}var xi=(0,Oe.memo)(ut(Wa));d();l();P();d();l();d();l();var Ne=class{constructor(){this.isSwapLoading=!1;this.setSwapLoading=t=>{this.isSwapLoading=t};this.checkCancelLimitOrder=async()=>{};L(this)}};d();l();P();var De=class{constructor(t){n(this,"checkTokenValid",async t=>{if(!Ae(t))return!1;let[e,o]=await A(R.get(ns,{params:eo(t,["chainId","tokenContractAddress"])}));return e?!1:o.data.supportMarket});this.rootStore=t,this.accountStore=t.accountStore,L(this,{},{autoBind:!0})}};var Ut=class{constructor(){Ut.instance?(this.commonStore=Ut.instance.commonStore,this.accountStore=Ut.instance.accountStore,this.checkTokenStore=Ut.instance.checkTokenStore,this.limitOrderConfirmStore=new Ne(this)):(this.commonStore=new Hs(this),this.accountStore=new Gs(this),this.checkTokenStore=new De(this),this.limitOrderConfirmStore=new Ne(this),Ut.instance=this)}},Gt=Ut;n(Gt,"instance",null);d();l();P();var Vt=class extends Os{constructor(e){super(e);n(this,"approveInfo",{});n(this,"setApproveInfo",e=>{this.approveInfo=e});n(this,"setApprove",async(e=Co.APPROVE)=>{let{fromToStore:o,quoteStore:r,accountStore:s}=this.rootStore,i=T(r,"quote.bestRoute"),a=J.getCurrentRouteDefiPlatformId(o.computedIsCrossChain,i),u=o.from,{chainId:m,tokenContractAddress:p}=u,g=s.getAddressByChainId(m);this.updateApproveTokenConfig(u,a,{status:this.isCancelApprove(e)?mt.CancelApproving:mt.Approving});try{let{id:I,transactionPayload:b}=await this.fetchApproveData({approveDataUrl:this.getApproveUrl(o.computedIsCrossChain).approveDataUrl,params:{userWalletAddress:g,tokenContractAddress:p,chainId:m,defiPlatformId:a,cancelApproveTag:e}});this.setApproveInfo({chainId:m,id:I,transactionPayload:b,token:u,defiPlatformId:a,cancelApproveTag:e}),v.history?.push({pathname:ao})}catch{this.fetchApproveDataErrorTips(u,a,e)}});n(this,"approveCancel",()=>{let e=this.approveInfo.cancelApproveTag;this.setApproveInfo({}),v.history?.goBack?.();let{fromToStore:o,quoteStore:r}=this.rootStore,s=T(r,"quote.bestRoute"),i=J.getCurrentRouteDefiPlatformId(o.computedIsCrossChain,s),a=o.from;this.updateApproveTokenConfig(a,i,{status:this.isCancelApprove(e)?mt.CancelApprove:mt.UnApproved})});n(this,"approveConfirm",async({txHash:e,error:o})=>{if(o){this.approveErrorTips({error:o,...this.approveInfo}),this.approveCancel();return}let{fromToStore:r,accountStore:s,quoteStore:i}=this.rootStore,{id:a,chainId:u,cancelApproveTag:m,defiPlatformId:p}=this.approveInfo;await this.saveApprove({id:a,chainId:u,transactionHash:e,userWalletAddress:s.getAddressByChainId(u),cancelApproveTag:m,defiPlatformId:p,isCrossChain:r.computedIsCrossChain,refetchQuote:()=>{i.fetchQuote()}}),v.history?.goBack?.(),this.setApproveInfo({})});$(this),this.rootStore=e}};d();l();P();d();l();var Me=()=>{let{fromToStore:c,gasDropStore:t,receiveAddressStore:e,outerStore:o,quoteStore:r,accountStore:s}=w(),{from:i,to:a}=c,{receiveAddrObj:u}=e,{computedForbiddenBridge:m,address:p}=s,g=c.computedTypedValue&&c.computedTypedValue.endsWith(".")?c.computedTypedValue.slice(0,-1):c.computedTypedValue,b={...{chainId:i.chainId,toChainId:a.chainId,toTokenAddress:a.tokenContractAddress,fromTokenAddress:i.tokenContractAddress,amount:g,userWalletAddress:p},...r.computedSlippage,pmm:"1",gasDropType:t?.computedGasDropSelected?1:0,forbiddenBridgeTypes:kr(m),dexIds:kr(No?.computedDexIds),receiveWalletAddress:u?.specifiedAddress};return ne()?b:o.extendFeeConfig(b)},Fe=async()=>{let{fromToStore:c,accountStore:t}=w(),{from:e}=c,{computedSignWalletAddress:o}=t,r=await Ts(o,e.chainId);return{...Me(),refCode:si.refCode,...r}},Bi=()=>{let{quoteStore:c}=w();return{...Me(),sort:c.bridgeSortType}},qi=()=>{let{quoteStore:c}=w(),{quote:t}=c,e=t?.bestRoute?.bridge?.bridgeId,{slippage:o,toChainId:r,receiveWalletAddress:s,userWalletAddress:i,chainId:a,fromTokenAddress:u,toTokenAddress:m,amount:p}=Me();return{slippage:o,toChainId:r,receiveWalletAddress:s,userWalletAddress:i,chainId:a,fromTokenAddress:u,toTokenAddress:m,amount:p,bridgeId:e}};d();l();function Ya({selector:c}){let t=document.querySelector(c);t&&t.scrollTo({top:0,behavior:"smooth"})}var Xo=Ya;var Qi=20,ct={CONFIRM:"confirm",UPDATE:"update",FILL_UP:"fill_up",SNAP_UPDATE:"snap_update",CANCEL:"cancel",DEFAULT:"default"},Dr=class{constructor(t){n(this,"quoteData",null);n(this,"preDataForSendBtc",null);n(this,"setPreDataForSendBtc",t=>{this.preDataForSendBtc=t});n(this,"setQuoteData",t=>{this.quoteData=t});n(this,"quoteParams",async()=>{let{accountStore:t,fromToStore:e,receiveAddressStore:o}=this.rootStore,s={...await Fe(),userWalletAddress:t.address};return e.computedDiffCrossChain&&(s.receiveWalletAddress=o.receiveAddrObj?.specifiedAddress),s});n(this,"updating",!1);n(this,"updateV6QuoteData",async({quoteParams:t,getCalldataParams:e})=>{let[o,r]=await A(ie(t));if(o){Y.error({title:o?.data?.msg||h("swaptrade_top_notif_data_failed")});return}let s=r?.data||{};this.rootStore.quoteStore.handleUpdateQuote({data:s});let i=await e(!0,this.rootStore.quoteStore.quote?.bestRoute),[a,u]=await A(we(i));if(a){Y.error({title:a?.data?.msg||h("swaptrade_top_notif_data_failed")});return}let m=u?.data;if(m){let p=await this.getPreExecutionPayload({orderData:m,requestParams:i});st(()=>{this.transactionPayload=p,this.orderId=m?.orderId||""})}this.initCountDown(),this.startCountdown()});n(this,"updateQuoteData",async()=>{let{quoteStore:{quote:t},swapStore:e}=this.rootStore,o=this.rootStore?.quoteStore?.quote?.bestRoute?.defiPlatformId;this.updating=!0;let s={...await Fe(),bridgeId:t?.bestRoute?.bridge?.bridgeId,...o&&{defiPlatformId:o}},i=await e.extendSignParams(s),[a,u]=await A(R.post(`${jn}`,i));if(this.updating=!1,Xo({selector:"#wallet_scroll"}),a){Y.error({title:a?.data?.msg||h("swaptrade_top_notif_data_failed")});return}let{callDataResult:m,quoteResult:p}=u?.data||{};if(this.rootStore.quoteStore.handleUpdateQuote({data:p}),m){let g=await this.getPreExecutionPayload({orderData:m,requestParams:i});st(()=>{this.transactionPayload=g,this.params=i,this.orderId=m?.orderId||""})}this.initCountDown(),this.startCountdown()});n(this,"updateBridgeGetIntentQuoteCallData",async()=>{let t=qi();this.updating=!0;let[e,o]=await A(R.get(os,{params:{...t}}));if(this.updating=!1,Xo({selector:"#wallet_scroll"}),e){Y.error({title:e?.data?.msg||h("swaptrade_trading_mode_error_no_update")});return}let{quoteResult:r}=o?.data||{};r&&this.rootStore.quoteStore.handleUpdateQuote({data:r}),this.initCountDown(),this.startCountdown()});n(this,"updateSnapQuoteData",async t=>{this.updating=!0;let[e,o]=await A(ie(t));if(this.updating=!1,Xo({selector:"#wallet_scroll"}),e){Y.error({title:e?.data?.msg||h("swaptrade_trading_mode_error_no_update")});return}let{quoteResult:r}=o?.data||{};r&&this.rootStore.quoteStore.handleUpdateQuote({data:r}),this.initCountDown(),this.startCountdown()});n(this,"timer",null);n(this,"countdown",Qi);n(this,"initCountDown",()=>{this.countdown=Qi});n(this,"startCountdown",()=>{this.timer=setTimeout(()=>{let t=this.countdown;if(t===0){this.clearTimer();return}this.countdown=t-1,this.startCountdown()},1e3)});n(this,"clearTimer",()=>{this.timer&&clearTimeout(this.timer)});n(this,"initGasInfo",()=>({gasType:"normal",gasLimit:"0",gasPrice:"0",maxFeePerGas:"0",maxPriorityFeePerGas:"0",supportEip1559:!1,isNetworkFeeLoading:!0,isGasLimitLoading:!0}));n(this,"gasInfo",this.initGasInfo());n(this,"setGasInfo",t=>{this.gasInfo=t});n(this,"gasFee",0);n(this,"setGasFee",t=>{this.gasFee=t});n(this,"cacheCallData",null);n(this,"cacheParams",null);n(this,"setCacheCallData",t=>{this.cacheCallData=t});n(this,"orderInfo",{});n(this,"transactionPayload",null);n(this,"approvePayload",null);n(this,"orderId","");n(this,"solonaRent","");n(this,"getPreExecutionPayload",async({orderData:t,isSwapSolana:e,requestParams:o})=>{let{swapStore:r,quoteStore:s,fromToStore:i}=this.rootStore;r?.checkCallData?.({chainId:o?.chainId,responseData:t,isSingleChain:!0,requestParams:o}).catch(()=>{});let a=s?.quote?.bestRoute||{},{fromToken:u}=a,{computedIsSingleChain:m}=i,p=Do(u,{orderData:t},r);if(e){let M=await p.jitoTransaction();return this.solonaRent=Ls(M),M}let g=m&&dt.supportCustomGasFee,{payload:I,rent:b}=await p.preExecution({needGasPrice:g});return u.chainId===_e.SOLANA_MAINNET&&b&&(this.solonaRent=b),I});n(this,"getApprovePayload",async({orderData:t,chainId:e})=>{let{approveTxInfo:o}=t;if(o){let{transactionPayload:r}=vs({approveTxInfo:o,params:{chainId:e,isOnlySign:!0}});return r}return null});n(this,"setTransactionPayload",t=>{this.transactionPayload=t});n(this,"solanaSwapTransactionData",null);n(this,"setSolanaSwapTransactionData",t=>{this.solanaSwapTransactionData=t});n(this,"handleSolanaOfflineData",async t=>{let{offlineType:e,calldata:o,defiPlatformId:r}=t,{unsignedTx:s,quote:i}=o||{},a=await Ps(s);this.solanaSwapTransactionData={transaction:a,offlineType:e,defiPlatformId:r,quote:i}});n(this,"fetchCallData",async t=>{let{swapStore:e}=this.rootStore||{};e.setCalldataSign(null);let o=null;if(t)o=t;else{let p=await e.saveOrderParams();o=await e.extendSignParams(p)}if(!o)return!1;let r=e.isSwapSolana(o.chainId),s,i,a=null;if(r){let p=e.extendSolanaCalldata(o);a=p,[s,i]=await e.getSolanaCalldata(p)}else t?[s,i]=await A(we(o)):[s,i]=await A(R.post(Kn,o));if(s){let p=s?.error_message;return Y.error({title:p||h("swaptrade_top_notif_data_failed")}),!0}this.setCacheCallData(i?.data||{}),this.cacheParams=o;let u=await this.getPreExecutionPayload({orderData:i?.data||{},isSwapSolana:r,requestParams:a});this.transactionPayload=u;let m=await this.getApprovePayload({orderData:i?.data||{},chainId:o.chainId});return this.approvePayload=m,this.orderId=i?.data?.orderId||"",!1});n(this,"preExecutionResult",{});n(this,"setPreExecutionResult",t=>{this.preExecutionResult=t});n(this,"nativeCoin",null);n(this,"setNativeCoin",t=>{this.nativeCoin={...t}});n(this,"calcNativeCoinAmount",()=>{let{coinAmountInt:t,decimals:e}=this.nativeCoin,{from:o,computedIsFromBtcCoin:r}=this.rootStore.fromToStore;return _.BigNumber(r?o.availableBalance:cs(t,e))});n(this,"calcNativeCoinAmountChange",()=>{let{fromToStore:t}=this.rootStore,e=t.from,o=_.BigNumber(this.gasFee).isNaN()?"0":this.gasFee;return e.isNativeToken?_.BigNumber(e.amount).plus(o):_.BigNumber(o)});n(this,"gasFeeLoading",!0);n(this,"setGasFeeLoading",t=>{this.gasFeeLoading=t});n(this,"gasLimitError",null);n(this,"setGasLimitError",t=>{this.gasLimitError=t});n(this,"maxGasFeeInt","");n(this,"setMaxGasFeeInt",t=>{this.maxGasFeeInt=t});n(this,"activityId",null);n(this,"setActivityId",t=>{this.activityId=t});n(this,"type",It.SWAP);n(this,"setSwapType",t=>{this.type=t});n(this,"reset",()=>{this.gasInfo=this.initGasInfo(),this.setGasFeeLoading(!1),this.nativeCoin=null,this.transactionPayload=null,this.approvePayload=null,this.cacheParams=null,this.orderId="",this.gasFee=0,this.setGasLimitError(null),this.setStarknetRegisterStatus(""),this.setVisibleStarknetRegister(!1),this.setActivityId(null),this.setSwapType(It.SWAP),this.clearTimer(),this.solonaRent=""});n(this,"starknetRegisterStatus","");n(this,"setStarknetRegisterStatus",t=>{this.starknetRegisterStatus=t});n(this,"visibleStarknetRegister",!1);n(this,"setVisibleStarknetRegister",t=>{this.visibleStarknetRegister=t});n(this,"onSwap",t=>{se({...W(),button_name:"confirm"}),this.rootStore.swapStore.onSwap(t)});n(this,"onIntentSwap",()=>{this.rootStore.intentSwapStore.onIntentSwap()});n(this,"confirmSwapMap",{[It.SWAP]:this.onSwap,[It.INTENT_SWAP]:this.onIntentSwap});n(this,"onConfirm",t=>{this.confirmSwapMap[t]?.()});n(this,"getBtnProps",t=>{let{fromToStore:e}=this.rootStore,{symbol:o,coinId:r,chainId:s}=this.nativeCoin||{};return{[ct.CONFIRM]:{disabled:this.computedConfirmBtnDisabled,onClick:a=>{this.onConfirm(a)},btnText:h("swaptrade_card_swap_btn_confirm_swap"),loading:this.computedIsConfirming},[ct.UPDATE]:{onClick:()=>{se({...W(),button_name:"update"}),this.updateQuoteData().catch(nt)},btnText:h("swaptrade_confirmswap_btn_update_price")},[ct.SNAP_UPDATE]:{onClick:()=>{se({...W(),button_name:"update"}),e.computedIsCrossChain?this.updateBridgeGetIntentQuoteCallData().catch(nt):this.updateSnapQuoteData().catch(nt)},btnText:h("swaptrade_confirmswap_btn_update_price")},[ct.FILL_UP]:{onClick:()=>{Er({wallet_address:this.rootStore.accountStore.address,button_name:"fill_up"}),e.baseAddFunds({coinId:r,chainId:s,receiveOnly:!1})},btnText:h("swaptrade_dialog_btn_supplement",{token:o})},[ct.CANCEL]:{onClick:()=>{Er({wallet_address:this.rootStore.accountStore.address,button_name:"cancel"});let{history:a}=v;a?.goBack()},btnText:h("swaptrade_top_btn_cancel")},default:{}}[t]});L(this),this.rootStore=t}get computedFormatTime(){return ds(this.countdown)}get computedPriceUpdate(){return this.countdown===0}get computedIsSufficientGas(){if(!this.nativeCoin)return!0;let t=this.calcNativeCoinAmount(),e=this.calcNativeCoinAmountChange();return t.gte(e)}get computedSolonaNativeTokenSufficientRent(){let{quoteStore:t}=this.rootStore,e=t?.quote?.bestRoute||{},{fromToken:o}=e||{};if(o?.chainId!==_e.SOLANA_MAINNET||!this.nativeCoin||!this.solonaRent)return!0;let r=this.calcNativeCoinAmount(),s=this.calcNativeCoinAmountChange();return r.gte(s.plus(this.solonaRent))}get walletSendParams(){let{toLocale:t,dispatch:e}=v;return!t||!e?null:{t,dispatch:e}}get computedIsIntentSwap(){return this.rootStore?.quoteStore?.computedIsOfflineType}get compuletedGetNativeCoinLoading(){return this.nativeCoin?this.nativeCoin?.isBalanceLoading:!0}get compuletedGetNativeCoinError(){return this.nativeCoin?this.nativeCoin.isBalanceLoadError:!0}get computedConfirmBtnDisabled(){let{RegisterLocalStatusEnum:t}=v.global,{computedIsStarknetChain:e,computedIsFromBtcCoin:o,computedIsEvmChain:r}=this.rootStore.fromToStore;if(this.computedIsIntentSwap)return this.computedPriceUpdate;if(e&&this.starknetRegisterStatus!==t?.COMPLETED)return!0;let s=this.computedPriceUpdate||!this.computedIsSufficientGas||!this.computedSolonaNativeTokenSufficientRent||this.gasFeeLoading||this.gasLimitError||this.compuletedGetNativeCoinError||this.compuletedGetNativeCoinLoading||this.updating;return o||!r?s:s||this.gasInfo?.isGasLimitLoading||this.gasInfo?.gasLimitInfo?.queryGasLimitErrorUseDefault}get computedIsConfirming(){let{swapStore:t,intentSwapStore:e}=this.rootStore;return this.computedIsIntentSwap?!!e.isConfirmLoading:t.isConfirmLoading}get computedConfirmBtnProps(){return this.getBtnProps(ct.CONFIRM)}get computedCancelBtnProps(){return this.getBtnProps(ct.CANCEL)}get computedTipsBtnProps(){let t=ct.DEFAULT;return(!this.computedIsSufficientGas||!this.computedSolonaNativeTokenSufficientRent)&&!this.compuletedGetNativeCoinError&&!this.compuletedGetNativeCoinLoading?t=ct.FILL_UP:this.computedPriceUpdate&&(t=this.computedIsIntentSwap?ct.SNAP_UPDATE:ct.UPDATE),this.getBtnProps(t)}get computedMonitorGasType(){return this.gasInfo?.gasType?{network_fee_details:{gas_level:this.gasInfo?.gasType}}:{}}},zo=Dr;d();l();P();d();l();var Mr=class{constructor(t){n(this,"signIntentSwap",async()=>[]);n(this,"createIntentOrder",async t=>{let e={intentCode:t.offlineType,signature:t.signature,quote:t?.quote,userWalletAddress:this.rootStore?.accountStore?.address,defiPlatformId:t.defiPlatformId,tradeMode:Bs.SWAP},[o,r]=await A(R.post(Zn,{...e}));return o&&(E.error(O.INTENT_ORDER_CREATE_ERROR,{error:o}),Y.error({title:o?.error_message||h("swaptrade_trading_mode_alert_order_fail")})),Ee({...W(),order_id:r?.data?.orderId,wallet_type:this.rootStore?.accountStore.walletConfig?.walletType}),[o,r]});n(this,"bridgeSumbitIntentOrder",async t=>{let{slippageStore:e,quoteStore:o,receiveAddressStore:r,fromToStore:s,accountStore:i}=this.rootStore,{quote:a,computedQuoteAmount:u}=o,{from:m,to:p}=s,{computedRealSlippageValue:g}=e,I=r?.receiveAddrObj?.specifiedAddress,b=g,M=a?.bestRoute?.bridge?.bridgeId,B=i?.address,lt={signature:t.signature,quote:t?.quote,defiPlatformId:t.defiPlatformId,receiveWalletAddress:I,fromChainId:m?.chainId,fromTokenAddress:m?.tokenContractAddress,fromAmount:u,toChainId:p.chainId,toTokenAddress:p.tokenContractAddress,toAmount:p.reverseReceiveAmount,walletAddress:B,bridgeId:M,minimumReceived:a?.bestRoute?.minimumReceived,slippage:b},[rt,pt]=await A(R.post(rs,{...lt}));return rt&&(E.error(O.INTENT_ORDER_CREATE_ERROR,{error:rt}),Y.error({title:rt?.error_message||h("swaptrade_trading_mode_alert_order_fail")})),Ee({...W(),order_id:pt?.data?.orderId,wallet_type:this.rootStore?.accountStore.walletConfig?.walletType}),[rt,pt]});this.rootStore=t}},Ui=Mr;d();l();var Gi=Fo(["isConfirmLoading"],[]);var Fr=class extends Ui{constructor(e){super(e);n(this,"isConfirmLoading",!1);n(this,"setIsConfirmLoading",e=>{this.isConfirmLoading=e});n(this,"signIntentSwap",async(e,o)=>{let{signTransaction:r}=this.rootStore.sendTransactionStore,[s,i]=await r(o,e);return s&&(E.error(O.INTENT_SWAP_SIGN_ERROR,{error:s,msg:{chainId:e,unsignedTx:o}}),Y.error({title:h("swaptrade_trading_mode_alert_order_fail")})),[s,i]});n(this,"onIntentSwap",async()=>{let{fromToStore:e}=this.rootStore;if(e?.computedIsCrossChain){await this.onIntentBridgeOrder();return}await this.onIntentSwapOrder()});n(this,"onIntentSwapOrder",async()=>{this.setIsConfirmLoading(!0),E.keepLive();let{swapStore:e,quoteStore:o}=this.rootStore,r=T(o,"quote.bestRoute.fromToken.chainId");try{let{offlineType:s,calldata:i,defiPlatformId:a}=o?.quote?.bestRoute||{},{quote:u,unsignedTx:m}=i||{};if(!u||!m)return;let[p,g]=await this.signIntentSwap(r,m);if(p)return;let[I,b]=await this.createIntentOrder({quote:u,offlineType:s,signature:g,defiPlatformId:a});if(I)return;e.afterTransaction(b.data?.orderId)}catch(s){E.error(O.INTENT_SWAP_PROCESS_ERROR,{error:s})}finally{this.setIsConfirmLoading(!1),E.removeKeep()}});n(this,"onIntentBridgeOrder",async()=>{this.setIsConfirmLoading(!0),E.keepLive();let{swapStore:e,quoteStore:o}=this.rootStore,r=T(o,"quote.bestRoute.fromToken.chainId");try{let{bridge:s}=o?.quote?.bestRoute||{},{calldata:i,defiPlatformId:a}=s||{},{quote:u,unsignedTx:m}=i||{};if(!u||!m)return;let[p,g]=await this.signIntentSwap(r,m);if(p)return;let[I,b]=await this.bridgeSumbitIntentOrder({quote:u,signature:g,defiPlatformId:a});if(I)return;e.afterTransaction(b.data?.orderId)}catch(s){E.error(O.INTENT_SWAP_PROCESS_ERROR,{error:s})}finally{this.setIsConfirmLoading(!1),E.removeKeep()}});no(this,Gi)}},Jo=Fr;d();l();P();d();l();P();d();l();P();P();var xr=class{constructor(t){n(this,"rootStore");this.rootStore=t}checkBridgeZeroValue(){let t=null,o=this.rootStore.quoteStore.quote?.bestRoute,{fromTokenPrice:r,toTokenPrice:s,fromToken:i,toToken:a}=o||{};return!Number(r)&&!Number(s)?t=i.tokenSymbol===a.tokenSymbol?D.ALIKE_TOKEN_SYMBOL_PRICE_UNKNOWN:D.ALL_TOKEN_PRICE_UNKNOWN:Number(r)?Number(s)||(t=D.TO_TOKEN_PRICE_UNKNOWN):t=D.FROM_TOKEN_PRICE_UNKNOWN,{errorType:t,continueToNextInterceptor:!1}}checkZeroValue(){let t=null,o=this.rootStore.quoteStore.quote?.bestRoute,{fromTokenValue:r,toTokenValue:s,fromToken:i,toToken:a}=o||{};return!Number(r)&&!Number(s)?t=i.tokenSymbol===a.tokenSymbol?D.ALIKE_TOKEN_SYMBOL_PRICE_UNKNOWN:D.ALL_TOKEN_PRICE_UNKNOWN:Number(r)?Number(s)||(t=D.TO_TOKEN_PRICE_UNKNOWN):t=D.FROM_TOKEN_PRICE_UNKNOWN,{errorType:t,continueToNextInterceptor:!1}}checkValueDifference(){let t=null,{fromToStore:e}=this.rootStore,{computedValueDifference:o,computedIsCrossChain:r}=e;return o.showValueDiffDialog&&(t=r?D.VALUE_DIFFERENCE_TOO_MUCH_CROSS:D.VALUE_DIFFERENCE_TOO_MUCH),{errorType:t,continueToNextInterceptor:!1}}checkMinReceive(){let t=null,e=this.rootStore.quoteStore,o=this.rootStore.slippageStore;return e?null:(o?.computedMinimumReceivedIsOrange&&(t=D.MIN_RECEIVED_TOO_SMALL),{errorType:t,continueToNextInterceptor:!1})}checkRepeatOrderWithEnoughBalance(){let t=null,{swapCheckStore:e}=this.rootStore,{repeatOrder:o}=e;return o?.enoughFlag===fr.ENOUGH&&(t=D.REPEAT_ORDER),{errorType:t,continueToNextInterceptor:!1}}async checkBlockedRepeatOrder(){let t=null,{swapCheckStore:e}=this.rootStore;await e.checkRepeatOrder();let{repeatOrder:o}=e;return o&&(o.repeatFlag===Ce.BTC_REPEAT?t=D.REPEAT_ORDER_BTC:o.enoughFlag!==fr.ENOUGH&&(t=D.REPEAT_ORDER_NOT_ENOUGH)),{errorType:t,continueToNextInterceptor:!1}}checkCrossChain(){let t=null;return this.rootStore.fromToStore.computedNeedCrossChainDoubleConfirm&&!y.get(In)&&(t=D.CROSS_CHAIN_DOUBLE_CONFIRM),{errorType:t,continueToNextInterceptor:!1}}checkGasMoreThanReceive(){let t=null,{fromToStore:e,quoteStore:o}=this.rootStore,{computedIsCrossChain:r}=e,s=o.quote?.bestRoute,{toTokenPrice:i,quoteNetWorkFeeOfMoney:a,fromSwapFeeUsd:u}=s||{},{BigNumber:m}=_;return(r?new m(u):new m(a)).gte(new m(i))&&(t=D.GAS_MORE_THAN_RECEIVE_VALUE),{errorType:t,continueToNextInterceptor:!1}}checkToSwapThanGasFee(){let t=null,{fromToStore:e,quoteStore:o}=this.rootStore,{computedHasToSwap:r}=e,s=Number(e.to.chainId)===1;if(r&&s){let i=T(o,"quote.bestRoute.toSwapFeeUsd"),a=T(o,"quote.bestRoute.bridge.bridgeAmountOutUsd"),u=T(o,"quote.bestRoute.bridge.toRiskLimit");_.BigNumber(i).dividedBy(a).gte(u)&&(t=D.TO_SWAP_THAN_GAS_FEE)}return{errorType:t,continueToNextInterceptor:!1}}checkVolatilitySlippage(){let t=null,o=this.rootStore.slippageStore.computedVolatilityTips?.swapInterceptorType;return o&&(t=o),{errorType:t,continueToNextInterceptor:!0}}async checkBtcBalance(){let{fromToStore:t,safeMoonStore:e}=this.rootStore,{computedIsFromBtcCoin:o,from:r,updateBtcFromBalance:s}=t;if(o){if(!await s())throw Error("btc balance update failed");let a=e.computedInputVal,u=r.availableBalance;if(_.BigNumber(a).gt(u))return{errorType:D.BTC_AVAILABLE_BALANCE_NOT_ENOUGH,continueToNextInterceptor:!1}}return null}async checkCrossChainSwap(){let{swapCheckStore:t}=this.rootStore;await t.checkCrossChainSwap();let e=t.checkSwapMoreInfo?.errorCode;return rn(e)&&e!==0?e===4&&y.get(`${go}_${t.checkSwapMoreInfo?.contentTip?.extra?.bridgeName}_${e}`)||y.get(`${go}_${e}`)?null:{errorType:D.CHECK_CROSS_MORE,continueToNextInterceptor:!1}:null}async checkThirdPartyProvider(){let{quoteStore:t}=this.rootStore,{computedIsOkxProvider:e}=t,o=y.get(`${go}_${Cn}`);return!e&&!o?{errorType:D.THIRD_PARTY_PROVIDER,continueToNextInterceptor:!0}:null}async checkBridgeThirdPartyProvider(){let{quoteStore:t}=this.rootStore,{computedBridgeIsOkxProvider:e,computedIsOfflineType:o}=t;return!e&&o?{errorType:D.THIRD_PARTY_PROVIDER,continueToNextInterceptor:!0}:null}async checkDisclaimerVisible(){return Ws()?{errorType:D.DISCLAIMER_VISIBLE,continueToNextInterceptor:!0}:null}makeCheckers(){let{fromToStore:{computedIsCrossChain:t}}=this.rootStore;return t?[this.checkDisclaimerVisible,this.checkBridgeThirdPartyProvider,this.checkVolatilitySlippage,this.checkCrossChainSwap,this.checkBtcBalance,this.checkBridgeZeroValue,this.checkToSwapThanGasFee,this.checkValueDifference,this.checkMinReceive,this.checkGasMoreThanReceive]:[this.checkDisclaimerVisible]}async check(){let t=[],e=this.makeCheckers();for(let o=0;o<e.length;o++){let r=e[o],{errorType:s,continueToNextInterceptor:i}=await r.call(this)||{};if(s&&(t.push(s),!i))return t}return t}},Vi=xr;d();l();P();var Ka=()=>{let{quoteStore:c}=w(),t=c.enableQuoteAggregates?T(c,"quote.bestRoute"):null;return T(t,"defiPlatformId")===at?h("swaptrade_trade_placeholder_okxdex"):T(t,"name")},Br=({disabled:c,isUnApproved:t})=>{let{fromToStore:e,quoteStore:o}=w();if(t)return h("swaptrade_common_btn_approve_and_swap");let i=(o.enableQuoteAggregates?T(o,"quote.bestRoute"):null)?Sn:c?K:ee;if(e.computedIsSingleChain){let a=Ka();return h(i,{provider:a})}return h(gn)},Wi=()=>{let{commonStore:c,swapBtnStore:t,swapStore:e}=w();return c.portal===An.MARKET?e.isConfirmLoading:t.swapBtnLoading};d();l();P();var Hi=()=>{let{accountStore:c}=w(),t=T(c,"walletConfig.isWCApp"),e=T(c,"walletConfig.isOkxConnect"),o=h("swaptrade_card_swap_modal_btn_confirming_in_your_wallet"),r=h("swaptrade_modal_confirm_swap_btn_confirming_in_app");return t||e?r:o};var xe=class{constructor(t){n(this,"swapBtnErrorTipsDialog",null);n(this,"swapInterceptor");n(this,"isInterceptionProcessing",!1);n(this,"defaultTipsDialogInfo",()=>({type:"",visible:!1,confirmCallBack:()=>{}}));n(this,"notShowAgainCrossChainConfirm",!1);n(this,"setNotShowAgainCrossChainConfirm",t=>{this.notShowAgainCrossChainConfirm=t});n(this,"tipsDialogInfo",this.defaultTipsDialogInfo());n(this,"swapBtnLoading",!1);n(this,"showErrorTips",(t,e)=>{this.tipsDialogInfo={type:t,visible:!0,confirmCallBack:e},this.setNotShowAgainCrossChainConfirm(!1)});n(this,"closeErrorTipsDialog",()=>{this.swapBtnLoading=!1,this.tipsDialogInfo.visible=!1});n(this,"openConfirmSwapDialog",(t,e)=>{let{swapStore:o}=this,{receiveAddressStore:r}=this.rootStore;r.saveWalletAddressToStorage(e),o.setConfirmSwapVisible(!0)});n(this,"connectWallet",()=>{});n(this,"approve",()=>{});n(this,"cancelApprove",()=>{});n(this,"swap",()=>{});n(this,"clickSwapOnDapp",()=>{let{from:t,to:e,computedIsSingleChain:o}=this.fromToStore,{computedNotThirdBiz:r}=this.commonStore;Lo({business_type:o?"swap":"bridge",trade_dialog:r?"no":"yes",from_token_address:t.tokenContractAddress,to_token_address:e.tokenContractAddress,swap_type:o?"discover_swap":"discover_cross_chain_swap",from_chain:t.chainName,to_chain:e.chainName}),this.rootStore.swapDappStore?.showDappPanel()});n(this,"checkDappTrade",()=>{let t=this.rootStore.swapDappStore?.checkShouldJumpToDapp;return typeof t=="function"&&t()?Te:null});n(this,"checkBlackAddress",()=>{let{quoteStore:t}=this.rootStore,{quoteError:e}=t.quote;return e?.error_code===bn?K:null});n(this,"checkShowLimitRegion",()=>this.checkDappTrade()?null:Ho.computedIsLimitRegion?K:null);n(this,"isQuoting",()=>{let{fromToStore:t,quoteStore:e,slippageStore:o}=this.rootStore,{isFetchQuoting:r,bestRoute:s,quoteError:i,quoteNull:a}=e.quote,{from:u,to:m,computedTypedValue:p}=t,{tokenContractAddress:g}=u,{computedRealSlippageValue:I}=o;return a||!s&&i&&!r||!p||!m.tokenContractAddress||!g||I>50||I<0?K:null});n(this,"isHoneypot",()=>this.rootStore?.safeMoonStore?.computedHoneypot?K:null);n(this,"noAmountOrOverLimit",()=>{let{fromToStore:t}=this,{overLimit:e}=this.rootStore?.safeMoonStore?.computedSlippageTips||{},{computedTypedValue:o}=t;return Number(o)===0||e?K:null});n(this,"hasFeeConfigErrorTips",()=>this.outerStore.computedFeeConfigErrorTips?K:null);n(this,"uninitializedWalletInfo",()=>{let{accountStore:{hasInitWalletInfo:t}}=this;return t?null:K});n(this,"unConnectedWallet",()=>{let{accountStore:{isConnectedWallet:t,hasInitWalletInfo:e}}=this;return!t&&e?Se:null});n(this,"nonsupportChain",()=>{let{accountStore:{computedNonsupportChain:t}}=this;return t?K:null});n(this,"checkReceiveAddressStatus",()=>{let{fromToStore:{computedDiffCrossChain:t}}=this,{receiveAddressStore:{checkReceiveAddressLoading:e,computedSwapHighLight:o}}=this.rootStore;return t&&!o||e?K:null});n(this,"interceptionProcessing",()=>{let{fromToStore:t}=this;return!this.isInterceptionProcessing&&t.isBalanceLoading||t.fromBalanceState===So.BALANCE_REQUEST_FAILED?K:null});n(this,"balanceLessThenInputAmount",()=>this.computedTooBalance?po:null);n(this,"approveStatus",()=>{let{fromToStore:t,quoteStore:e,approveStore:{getApprovalStatus:o}}=this,{from:r,computedIsCrossChain:s}=t,i=T(e,"quote.bestRoute"),a=J.getCurrentRouteDefiPlatformId(s,i),u=o(r,a);return hr[u]||null});n(this,"isValidAmount",()=>{let{fromToStore:t}=this,{from:e,to:o}=t;return o.amount&&e.amount?ee:null});n(this,"getBtnStatus",()=>{let t=[this.checkBlackAddress,this.checkShowLimitRegion,this.hasFeeConfigErrorTips,this.unConnectedWallet,this.nonsupportChain,this.checkDappTrade,this.checkReceiveAddressStatus,this.noAmountOrOverLimit,this.interceptionProcessing,this.balanceLessThenInputAmount,this.isQuoting,this.approveStatus,this.isValidAmount],e;for(let o of t){let r=o();if(r){e=r;break}}return e||(e=K),e});n(this,"checkIsCurrentQuote",()=>(this.computedIsCurrentQuote||Y.warn({title:h("swaptrade_mid_toast_tryagain_with_newquote")}),this.computedIsCurrentQuote));let{accountStore:e,fromToStore:o,swapStore:r,commonStore:s,quoteStore:i,approveStore:a}=t;this.rootStore=t,this.accountStore=e,this.fromToStore=o,this.swapStore=r,this.commonStore=s,this.quoteStore=i,this.approveStore=a,this.swapInterceptor=new Vi(t),Object.assign(this,t)}async runSwapInterceptor(t){this.isInterceptionProcessing=!0;let[e,o]=await A(this.swapInterceptor.check());if(this.isInterceptionProcessing=!1,e){E.error(O.UPDATE_BTC_BALANCE_ERROR_BEFORE_SWAP,{error:e});return}if(o.length===0){t();return}let r=-1,s=()=>{r++;let i=r===o.length-1;this.showErrorTips(o[r],i?t:s)};s()}getBtnAllStatus({from:t,toUsdPrice:e}){return{[Se]:{statusType:Se,disabled:!1,toLocaleText:()=>h(Se),onClick:this.connectWallet},[po]:{statusType:po,disabled:!this.fromToStore.computedShowAddFund||ne(),toLocaleText:()=>h(ci["FILL_UP"],{token:Q(t.tokenSymbol)}),onClick:()=>{this.fromToStore.onClickAddFunds()},symbol:t.tokenSymbol},[ho]:{statusType:ho,disabled:!1,toLocaleText:()=>h(ho,{tokenSymbol:Q(t.tokenSymbol)}),onClick:()=>{this.quoteStore.setAggregateSelectStatus(1),this.approve()},icon:"okx-defi-dex-authorization",iconType:oo.ICON_POSITION.leading},[ge]:{statusType:ge,loading:!0,disabled:!0,toLocaleText:()=>h(ge)},[pr]:{statusType:ge,disabled:!1,toLocaleText:()=>h(pr,{ccy:t.tokenSymbol}),onClick:this.cancelApprove,icon:"okx-defi-dex-authorization",iconType:oo.ICON_POSITION.leading},[fo]:{statusType:fo,loading:!0,disabled:!0,toLocaleText:()=>h(fo)},[K]:{statusType:K,disabled:!0,toLocaleText:()=>Br({disabled:!0,toUsdPrice:e})},[ee]:{statusType:ee,disabled:!1,loading:Wi(),toLocaleText:()=>{let r=this.approveStatus()===hr[mt.UnApproved];return Br({disabled:!1,isUnApproved:r})},toLoadingLocaleText:()=>Hi(),onClick:o=>{this.quoteStore.setAggregateSelectStatus(1),o?this.swap(o):this.swap()}},[Te]:{statusType:Te,disabled:!1,loading:this.rootStore.swapDappStore?.swapOnDappBtnLoading,toLocaleText:()=>h(Te),icon:"okds-open-link",iconType:oo.ICON_POSITION.leading,onClick:this.clickSwapOnDapp}}}get needToCrossChainDoubleCheck(){return!0}get computedTooBalance(){let{rootStore:t,fromToStore:e,accountStore:o}=this,{isConnectedWallet:r}=o,s=e.from.balance,i=t.safeMoonStore.computedInputVal;return r?_.BigNumber(s||0).isLessThan(i):!1}get computedBtnStatus(){let{fromToStore:t}=this,{from:e,to:o}=t,r=this.getBtnStatus();return this.getBtnAllStatus({from:e,swapLoading:this.swapBtnLoading,toUsdPrice:T(o,"usdPrice")})[r]}get computedIsCurrentQuote(){let{fromToStore:t,quoteStore:e}=this,{computedIsExactIn:o,computedTypedValue:r}=t,{quote:s,getGasTokenFeeLoading:i,quotePending:a}=e,{fromTokenAmount:u="",inputToTokenAmount:m=""}=s?.bestRoute||{},p=!!r,g=p&&o&&_.BigNumber(r).isEqualTo(u),I=p&&!o&&_.BigNumber(r).isEqualTo(m);return!i&&(g||I)&&!a}};d();l();var Ki=Fo(["tipsDialogInfo","notShowAgainCrossChainConfirm","isInterceptionProcessing","swapBtnLoading"],["computedTooBalance","computedBtnStatus","computedIsCurrentQuote"]);d();l();var qr=()=>{let{accountStore:c}=w();gs({wallet_address:c.address,...Ks()})};var Wt=class extends xe{constructor(e){super(e);n(this,"handleSwap",async e=>{let{quote:o,computedIsOfflineType:r}=this.quoteStore,{receiveAddressStore:s,swapStore:i}=this.rootStore,{from:a,cacheTokenInfo:u}=this.fromToStore;this.swapBtnLoading=!0,this.walletContractStore.setQuoteData(o.bestRoute),E.info(O.CLICK_WALLET_SWAP_BUTTON,{chainId:a.chainId,tokenContractAddress:Oo(a.tokenContractAddress),amountNum:a.balance}),_.eq(a.balance,u.amountNum)||E.info(O.BALANCE_IS_ERROR,{chainId:a.chainId,tokenContractAddress:Oo(a.tokenContractAddress),amountNum:a.balance,cacheTokenInfo:{...u,tokenContractAddress:Oo(u.tokenContractAddress)}});let{fromToken:m}=fe.get(o,"bestRoute",{});if(r){if(qs(o?.bestRoute?.structureType)&&i.isSwapSolana(m.chainId)&&await this.walletContractStore.handleSolanaOfflineData(o?.bestRoute))return}else{let g=await this.walletContractStore.fetchCallData(e);if(this.swapBtnLoading=!1,g)return}this.swapBtnLoading=!1;let p=r?It.INTENT_SWAP:It.SWAP;if(s.saveWalletAddressToStorage(this.fromToStore?.to),i.isSwapSolana(m.chainId)){v.history?.push({pathname:uo});return}if(this.walletContractStore.approvePayload){v.history?.push({pathname:co});return}v.history?.push({pathname:Zt,search:`needUpdate=${_n.on}&type=${p}`})});n(this,"swap",async e=>{console.log("swap===>",e);let o=this.checkIsCurrentQuote(),{fromToStore:r,quoteStore:s}=this,{from:i,to:a}=r;Lo({wallet_address:this.accountStore.address,button_name:"confirm",...W()});let u=fe.get(s,"quote.bestRoute.serviceFeeInfo.serviceFeeUsd","0");Ss({fee_shown:u,from_token_symbol:i?.tokenSymbol,to_token_symbol:a?.tokenSymbol,from_to_pair_symbol:`${i?.tokenSymbol}:${a?.tokenSymbol}`,input_amount_usd:i?.usdPrice,source:hs()?.source,terminal:Rs.Plugin,selected_chain_id:i?.chainId,auto_confirm_enter:"off",chain_name:i?.chainName}),o&&(this.swapBtnLoading=!0,this.runSwapInterceptor(()=>{this.handleSwap(e)}))});n(this,"approve",async()=>{let{fromToStore:e,quoteStore:o}=this.rootStore,r=fe.get(o,"quote.bestRoute"),s=J.getCurrentRouteDefiPlatformId(e.computedIsCrossChain,r),i=e.from;this.approveStore.updateApproveTokenConfig(i,s,{status:mt.Approving}),qr(),this.approveStore.setApprove()});n(this,"cancelApprove",async()=>{let{fromToStore:e,quoteStore:o}=this.rootStore,r=fe.get(o,"quote.bestRoute"),s=J.getCurrentRouteDefiPlatformId(e.computedIsCrossChain,r),i=e.from;this.approveStore.updateApproveTokenConfig(i,s,{status:mt.CancelApproving}),qr(),this.approveStore.setApprove(Co.CANCEL_APPROVE)});this.walletContractStore=e.walletContractStore,no(this,Ki)}};d();l();P();P();d();l();P();P();d();l();d();l();var ji=function(){return new Promise(function(t){setTimeout(t,1)})};d();l();var de=N(U());d();l();var ja={["SWAP"]:"swap_used_chain_cache",["LIMIT_ORDER"]:"limit_used_chain_cache",["BRIDGE"]:"bridge_used_chain_cache"},$i="USED_CHAIN_CACHE",Zo=4,$a=c=>{let t=ja[c],e=y.get(t)||[],o=y.get($i)||[];return e.length!==0&&y.remove(t),o.filter(Boolean)},Xa=({selectedChainIdList:c,chainList:t,cacheChainIdList:e})=>{t.sort((m,p)=>Number(p.popularWeight)-Number(m.popularWeight));let o=t.find(m=>m?.needTop)?.chainId,r=t.map(m=>m.chainId);if(e.length===0){let m=r.slice(0,Zo);if(o){let p=m.indexOf(o);p>-1&&m.splice(p,1),m.unshift(o)}return{sortedChainList:m.slice(0,Zo),cacheChainIds:r}}let s=new Set(r),i=e.filter(m=>s.has(m)),a=[...e],u=[...i.slice(0,Zo)];if(c.forEach(m=>{if(u.includes(m)||!m)return;let p=a.indexOf(m);p>-1&&a.splice(p,1),u.unshift(m),a.unshift(m)}),o){let m=u.indexOf(o);m>-1&&u.splice(m,1),u.unshift(o);let p=a.indexOf(o);p>-1&&a.splice(p,1),a.unshift(o)}return{sortedChainList:u.slice(0,Zo),cacheChainIds:a}},Xi=(c,t,e)=>{E.info(O.GET_CHAINLIST_BY_STORAGE,{data:{fromAndToChainIdList:c,isChainListEmpty:t.length===0,hasUndefinedChain:t.some(i=>!i?.chainId),currentTab:e}});let o=$a(e),{sortedChainList:r,cacheChainIds:s}=Xa({selectedChainIdList:c,chainList:t,cacheChainIdList:o});return y.set($i,s.filter(Boolean)),r.filter(Boolean)};d();l();var Be=class{constructor(t){n(this,"id",1);n(this,"tokenSymbol","--");n(this,"tokenName","--");n(this,"decimals",6);n(this,"tokenContractAddress","");n(this,"tokenLogoUrl","");n(this,"type","");n(this,"amountNum",0);n(this,"currencyAmount",0);L(this),Object.assign(this,t),this.tokenModalStore=w().tokenModalStore}get computedPrice(){let{nowCurrencyUnit:t}=this.tokenModalStore.commonStore,{symbol:e,usdToThisRate:o}=t,r=_.BigNumber(this.currencyAmount);return r.isNaN()||r.isZero()?`${e||""}0.00`:e&&o&&!r.isNaN()&&!r.isZero()?Dt(r.multipliedBy(o).toJSON(),e):"0"}get computedIsSelect(){let{equalsToken:t}=this.tokenModalStore.commonStore,{from:e,to:o}=this.tokenModalStore.fromToStore;return this.tokenModalStore.tokenModalFromState===C.FROM?t(this,o):t(this,e)}get computedIsSelectOrigin(){let{from:t,to:e}=this.tokenModalStore.fromToStore,{equalsToken:o}=this.tokenModalStore.commonStore;return this.tokenModalStore.tokenModalFromState===C.FROM?o(this,t):o(this,e)}get computedAmountNum(){return this.amountNumBigDecimal!==""?this.amountNum:0}toJSON(){return it(this)}get computedTokenVolume(){let{currencyConversion:t,computedNowCurrencySymbol:e}=this.tokenModalStore.commonStore;return this.volume?Ar(t(this.volume).toString(),{currencySign:e}).value:"--"}get computedTokenLiquidity(){let{currencyConversion:t,computedNowCurrencySymbol:e}=this.tokenModalStore.commonStore;return this.liquidity?Ar(t(this.liquidity).toString(),{currencySign:e}).value:"--"}};d();l();var qe=(c={})=>({...q,logoUrl:q.logoUrl(),chainName:h(q.localKey),...c}),tr=(c={})=>{let t=un();return{...z,get logoUrl(){return t===cn.dark?z.darkLogoUrl():z.logoUrl()},chainName:h(z.localKey),...c}};var zi="hide_collect_cancel_dialog",Ji="hideTokenGuide",Ht=class{constructor(t){n(this,"searchValue","");n(this,"setSearchValue",t=>{this.searchValue=t});n(this,"fromTokenList",new Map);n(this,"toTokenList",new Map);n(this,"searchTokenList",{});n(this,"currentCollectionGroupId");n(this,"setCurrentCollectionGroupId",t=>{this.currentCollectionGroupId=t});n(this,"setCurrentCollectionGroupIdAndGetList",t=>{t&&t===this.currentCollectionGroupId||(this.setCurrentCollectionGroupId(t),this[`${this.tokenModalFromState}TokenList`].set(q.chainId),this.getTokenListByChainId().then(nt).catch(nt))});n(this,"error",!1);n(this,"tokenModalVisible",!1);n(this,"tokenModalFromState",C.FROM);n(this,"setTokenModalFromState",t=>{this.tokenModalFromState=t});n(this,"loading",{[C.FROM]:{},[C.TO]:{}});n(this,"initLoading",()=>{this.loading={[C.FROM]:{},[C.TO]:{}}});n(this,"importTokenInfo",{});n(this,"setImportTokenInfo",t=>{this.importTokenInfo={...t}});n(this,"toSelectedChainId","");n(this,"fromSelectedChainId","");n(this,"setToSelectedChainId",t=>{this.toSelectedChainId=t});n(this,"setFromSelectedChainId",t=>{this.fromSelectedChainId=t});n(this,"fromSelectedChainAtSearch","");n(this,"toSelectedChainAtSearch","");n(this,"setFromSelectedChainAtSearch",t=>{this.fromSelectedChainAtSearch=t});n(this,"setToSelectedChainAtSearch",t=>{this.toSelectedChainAtSearch=t});n(this,"updateSelectedChainAtSearch",t=>{this.tokenModalFromState===C.FROM?this.setFromSelectedChainAtSearch(t):this.setToSelectedChainAtSearch(t)});n(this,"updateFromToSelectedChainIdAfterSearch",()=>{if(this.tokenModalFromState===C.FROM&&this.fromSelectedChainAtSearch!==this.fromSelectedChainId){this.setFromSelectedChainId(this.fromSelectedChainAtSearch);return}this.tokenModalFromState===C.TO&&this.toSelectedChainAtSearch!==this.toSelectedChainId&&this.setToSelectedChainId(this.toSelectedChainAtSearch)});n(this,"extendTokens",(t,e)=>t.filter(o=>this.commonStore.getChainByID(G(o.chainId))).map(o=>{let r=new Be(o,this);return{...o,balance:r.computedAmountNum,selected:r.computedIsSelect,selectedOrigin:e?r.computedIsSelectOrigin:!1,price:r.computedPrice,formattedVolume:r.computedTokenVolume,formattedLiquidity:r.computedTokenLiquidity}}));n(this,"extendTokenList",(t=[],e=!0)=>Z(t)?t:this.extendTokens(t,e));n(this,"importUserToken",Ct(function*(e,o=!0){let r=e.map(a=>{let{chainId:u,tokenContractAddress:m,tokenSymbol:p,decimals:g}=a;return{chainId:u,contractAddress:m,tokenSymbol:p,precision:g}}),s={userUniqueId:this.commonStore.userUniqueId,tokenDetailList:r},i=[];try{i=(yield R.post(Ln,s)).data}catch(a){throw Y.error(h("swaptrade_pricechart_no_connection_desc")),a}return o&&(this.searchValue="",this.changeTokenModalVisible(!1)),i}));n(this,"sortTokens",t=>sn(t,[e=>Number(e.topPlacement),e=>Number(e.currencyAmount),e=>Number(e.amountNum),e=>Number(e.isCollectToken),e=>Number(e.collectTime)],["desc","desc","desc","desc","desc"]));n(this,"orderTokenList",t=>this.computedIsCollectChain?t:this.commonStore.currentTab===k.BRIDGE?t.map(e=>({...e,tokenList:this.sortTokens(e.tokenList)})):this.sortTokens(t));n(this,"formatTokenList",(t,e,o=!1)=>{let r=t;t.length>100&&e!==q.chainId&&(r=t.slice(0,100)),o&&(r=Ko.filterHiddenTokenList(r));let s=this.extendTokenList(r,!0);return this.orderTokenList(s)});n(this,"changeTokenModalVisible",t=>{this.tokenModalVisible=t});n(this,"clearCacheTokenList",()=>{});n(this,"getTokenListByChainId",async()=>{let t=this.tokenModalFromState===C.FROM,e={};if(this.clearCacheTokenList(),this.tokenModalFromState===C.FROM?e={fromChainId:this.fromSelectedChainId}:this.tokenModalFromState===C.TO&&(e={fromChainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainId}),this.tokenModalFromState===C.FROM&&Number(this.fromSelectedChainId)===z.chainId){this.getFromAllNetworksTokens();return}if(this.tokenModalFromState===C.TO&&Number(this.toSelectedChainId)===z.chainId){this.getToAllNetworksTokens(e.fromChainId);return}if(this.tokenModalFromState===C.FROM&&Number(this.fromSelectedChainId)===q.chainId){this.getFromCollectedTokens();return}if(this.tokenModalFromState===C.TO&&Number(this.toSelectedChainId)===q.chainId){this.getToCollectedTokens(e.fromChainId);return}t?this.getTokenList(C.FROM,e.fromChainId):this.getTokenList(C.TO,e.toChainId,e.fromChainId)});n(this,"setTokenList",(t,e,o,r=!1)=>{let s=this.formatTokenList(e,t,r);this[`${o}TokenList`].set(t,s)});n(this,"cancelGetTokenListRef",null);n(this,"handleTokenList",Ct(function*(e){let{field:o,chainId:r,url:s,params:i,enableSmallAssetFilter:a,enableHiddenTokenFilter:u}=e;this.setError(!1),this.cancelGetTokenListRef&&this.cancelGetTokenListRef.abort(),this[`${o}TokenList`].get(r)||this.setLoading(o,r,!0),this.cancelGetTokenListRef=Et();let m={...i};if(a){yield Ko.initializePromise;let p=Ko.getMinAmountThresholdParam();p!==void 0&&(m.minAmountThreshold=p)}try{let{data:p}=yield R.get(s,{params:m,signal:this.cancelGetTokenListRef?.signal,isolate:!0}),g=this.toLowerCaseContractAddress(p);return this.setTokenList(r,g,o,u),this.setLoading(o,r,!1),{data:g}}catch(p){return this.isCancel(p)?null:(this.setTokenList(r,[],o,!1),this.setLoading(o,r,!1),this.setError(!0),p)}}).bind(this));n(this,"getCrossChainParams",(t,e,o)=>{switch(t){case k.BRIDGE:return{fromChainId:e.fromChainId??e?.chainId,userUniqueId:e.userUniqueId,accountId:e.accountId,targetChainId:e.targetChainId,targetWalletAddress:e.targetWalletAddress,walletAddress:e.walletAddress,...o,toChainId:o.toChainId===-1?"":o?.toChainId};case k.SWAP:default:return e}});n(this,"getTokenList",Ct(function*(e,o,r){let s={fromChainId:r,chainId:o,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,walletAddress:this.accountStore.computedSignWalletAddress,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(s={...s,businessLine:re.LIMIT_ORDER});let i=this.getCrossChainParams(this.commonStore.currentTab,s,{selectChainType:this.getCrossChainSelectChainType(),toChainId:this.computedCurrentToChainId,fromTokenAddress:this.fromToStore.from.tokenContractAddress||""}),a=G(o);if(this.computedIsNotSupportToChain)return this.setTokenList(a,[],e,!1),{data:[]};let u=Qt(qt.ALL_TOKENS,this.commonStore.currentTab);return yield this.handleTokenList({field:e,chainId:a,url:u,params:i,enableSmallAssetFilter:!0,enableHiddenTokenFilter:!0})}));n(this,"getFromCollectedTokens",Ct(function*(){let e={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:"",...this.computedCollectionGroupParams,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(e={...e,businessLine:re.LIMIT_ORDER});let o=this.getCrossChainParams(this.commonStore.currentTab,e,{selectChainType:Bt.FROM,toChainId:this.computedCurrentToChainId,fromTokenAddress:"",...this.computedCollectionGroupParams}),r=Qt(qt.COLLECT_LIST,this.commonStore.currentTab);return yield this.handleTokenList({field:C.FROM,chainId:q.chainId,url:r,params:o,enableSmallAssetFilter:!1,enableHiddenTokenFilter:!1})}));n(this,"getToCollectedTokens",Ct(function*(e){let o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:e,chainId:e,...this.computedCollectionGroupParams,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(o={...o,businessLine:re.LIMIT_ORDER});let r=this.getCrossChainParams(this.commonStore.currentTab,o,{selectChainType:Bt.TO,toChainId:"",fromTokenAddress:this.fromToStore.from.tokenContractAddress,...this.computedCollectionGroupParams}),s=Qt(qt.COLLECT_LIST,this.commonStore.currentTab);return yield this.handleTokenList({field:C.TO,chainId:q.chainId,url:s,params:r,enableSmallAssetFilter:!1,enableHiddenTokenFilter:!1})}));n(this,"getFromAllNetworksTokens",Ct(function*(){let e={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:"",walletAddress:this.accountStore.computedSignWalletAddress,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(e={...e,businessLine:re.LIMIT_ORDER});let o=Qt(qt.ALL_NETWORK,this.commonStore.currentTab),r=this.getCrossChainParams(this.commonStore.currentTab,e,{selectChainType:Bt.FROM,toChainId:this.computedCurrentToChainId,fromTokenAddress:""});return yield this.handleTokenList({field:C.FROM,chainId:z.chainId,url:o,params:r,enableSmallAssetFilter:!0,enableHiddenTokenFilter:!0})}));n(this,"getToAllNetworksTokens",Ct(function*(e){let o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:e,walletAddress:this.accountStore.computedSignWalletAddress,...this.computedAdresses};this.commonStore?.computedCurrentTabIsLimit&&(o={...o,businessLine:re.LIMIT_ORDER});let r=Qt(qt.ALL_NETWORK,this.commonStore.currentTab),s=this.getCrossChainParams(this.commonStore.currentTab,o,{selectChainType:Bt.TO,toChainId:"",fromTokenAddress:this.fromToStore.from.tokenContractAddress});return yield this.handleTokenList({field:C.TO,chainId:z.chainId,url:r,params:s,enableSmallAssetFilter:!0,enableHiddenTokenFilter:!0})}));n(this,"cancelSearchRef",null);n(this,"needRemoveChainId",t=>[z.chainId,q.chainId].includes(G(t)));n(this,"getSearchChainType",()=>{let t=To.SINGLE;return this.computedCurrentSearchChainId===z.chainId&&(t=To.ALL_NETWORK),this.computedCurrentSearchChainId===q.chainId&&(t=To.COLLECT),t});n(this,"getCrossChainSelectChainType",()=>this.tokenModalFromState===C.FROM?Bt.FROM:Bt.TO);n(this,"singleSearchParams",t=>{let e=this.getSearchChainType(),o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,chainType:e,searchType:e,walletAddress:this.accountStore.computedSignWalletAddress,...this.computedAdresses},r={},s={};return this.tokenModalFromState===C.FROM?(r={inputContent:t,fromChainId:this.fromSelectedChainAtSearch,chainId:this.fromSelectedChainAtSearch,toChainId:this.fromSelectedChainAtSearch},this.needRemoveChainId(this.fromSelectedChainAtSearch)&&(delete r.fromChainId,delete r.toChainId,delete r.chainId)):this.tokenModalFromState===C.TO&&(s={inputContent:t,fromChainId:this.fromToStore.from.chainId,chainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainAtSearch,fromTokenAddress:this.fromToStore.from.tokenContractAddress||""},this.needRemoveChainId(this.toSelectedChainAtSearch)&&(delete s.toChainId,delete r.chainId)),{...o,...r,...s}});n(this,"getSearchTokenList",async()=>{if(this.searchValue==="")return;if(this.cancelSearchRef&&this.cancelSearchRef.abort(),this.computedIsNotSupportToChain){this.setSearchTokenList({}),this.setLoading(this.tokenModalFromState,"search",!1);return}this.cancelSearchRef=Et(),this.setLoading(this.tokenModalFromState,"search",!0),this.setError(!1);let t=mr(this.searchValue),e=this.getSearchParams(t);fs({keyword:t});let o=Qt(qt.SEARCH,this.commonStore.currentTab),[r,s]=await A(R.get(o,{params:e,signal:this.cancelSearchRef?.signal}));if(r&&!this.isCancel(r)){this.setError(!0),this.setSearchTokenList({}),this.setLoading(this.tokenModalFromState,"search",!1);return}if(s){let{data:i}=s;if(this.commonStore.currentTab===k.BRIDGE)this.setSearchTokenList({list:i});else{let{systemList:a,thirdPartyList:u}=s.data;this.setSearchTokenList({systemList:a,thirdPartyList:u})}this.updateFromToSelectedChainIdAfterSearch(),this.setError(!1),this.setLoading(this.tokenModalFromState,"search",!1)}});n(this,"resetTokenModal",()=>{this.resetTokenData()});n(this,"resetTokenData",()=>{this.searchTokenList={},this.searchValue=""});n(this,"balancePushSort",(t,e)=>{let o=[...t],{currencyAmount:r,coinAmountOriginalDec:s}=e;for(let i=0;i<o.length;i++)if(this.commonStore.equalsToken(o[i],e)){o[i].amountNum=s,o[i].currencyAmount=r;break}return o});n(this,"updateAllTokenList",t=>{let{chainId:e}=t,o=G(e),r=this.fromTokenList.get(o);r&&this.setTokenList(o,this.balancePushSort(it(r),t),C.FROM,!0);let s=this.toTokenList.get(o);s&&this.setTokenList(o,this.balancePushSort(it(s),t),C.TO,!0)});n(this,"checkFromToLegal",(t,e)=>{let{currentTab:o}=this.commonStore,r={toToken:{...e,amount:""},isChanged:!1};if(Number(t.chainId)!==Number(e.chainId)){if(this.computedToChain?.some(g=>g.chainId===e.chainId&&!g.disabled))return r;let{dexDefaultFromToTokenShowVO:s}=this.commonStore.getChainByID(this.fromToStore.from.chainId),{fromDexMultiTokenInfoVO:i,toDexMultiTokenInfoVO:a,toCrossDexMultiTokenInfoVO:u}=s,m=o===k.BRIDGE,p;return m&&u?p=u:this.commonStore.equalsToken(t,a)?p=i:p=a,{toToken:p,isChanged:!0}}return r});n(this,"calcCurToChainIdIsInSupList",t=>{let e=!1;return it(this.computedToChain).forEach(o=>{Number(o.chainId)===Number(t)&&!o.disabled&&(e=!0)}),e});n(this,"hideCollectCancelConfirm",y.get(zi));n(this,"showCollectOverLimitDialog",!1);n(this,"setShowCollectOverLimitDialog",t=>{this.showCollectOverLimitDialog=t});n(this,"setCommonlyUsedChain",t=>{let{from:e,to:o}=this.fromToStore,{chainList:r,currentTab:s}=this.commonStore,i=t&&t.length>0?t:[e.chainId,o.chainId];return Xi(i,r,s)});n(this,"tokenPageChainList",[]);n(this,"setTokenPageChainList",t=>{this.tokenPageChainList=t?.filter(Boolean)||[]});n(this,"getCurrentToChainInfo",()=>this.computedToChain.find(e=>G(e.chainId)===G(this.toSelectedChainId)));n(this,"changeTokenPageChainList",async t=>{if(this.tokenPageChainList.findIndex(o=>G(o.chainId)===G(t))===-1){let o=this.commonStore.chainList.find(i=>G(i.chainId)===G(t)),r=[...this.tokenPageChainList],s=r.findIndex(i=>i?.needTop);s>-1?r.splice(s+1,0,o):r.unshift(o),r.length>4&&r.pop(),this.setTokenPageChainList(r)}this.tokenModalFromState===C.FROM?this.setFromSelectedChainId(t):this.setToSelectedChainId(t),await this.getTokenListByChainId()});n(this,"searchChainKeywords","");n(this,"setSearchChainKeywords",t=>{this.searchChainKeywords=t});n(this,"filterChains",t=>en(t,e=>{let o=ur(mr(this.searchChainKeywords));return ur(e.chainName).includes(o)}));n(this,"dialogIndex",gr.TOKEN_LIST);n(this,"setDialogIndex",t=>{this.dialogIndex=t});n(this,"hideTokenGuide",!!y.get(Ji));n(this,"setHideTokenGuide",()=>{this.hideTokenGuide=!0,y.set(Ji,"1")});n(this,"importToken",async(t,e)=>{let r=(await this.importUserToken(Array.isArray(t)?t:[t]))[0]||{};e&&e(r),ks(r)&&await this.fromToStore.getTokenBalanceByAccount(this.tokenModalFromState,r),this.setImportTokenInfo({}),this.setDialogIndex(gr.TOKEN_LIST)});n(this,"reloadTokenList",async()=>{!this.tokenModalVisible||(this.searchValue!==""?await this.getSearchTokenList():await this.getTokenListByChainId())});n(this,"selectTokenHandle",async t=>{let e=this.commonStore.getChainByID(Number(t?.chainId));if(await ji(),!e)return;let{quoteStore:o}=this.rootStore,{from:r,updateFrom:s,updateTo:i,setBalance:a,setFromBalanceRequestError:u,setToBalanceRequestError:m,to:p,computedIsExactIn:g,needCrossChainDoubleConfirm:I,setNeedCrossChainDoubleConfirm:b}=this.fromToStore,{clearReceiveAddressValue:M}=this.rootStore.receiveAddressStore;this.setCommonlyUsedChain([t?.chainId]);let B=this.tokenModalFromState===C.FROM,lt=()=>{this.rootStore.fromToStore.setCacheTokenInfo({chainId:t.chainId,tokenContractAddress:t.tokenContractAddress,amountNum:t.balance},"tokenList"),u(!1),a(C.FROM,t.balance)},rt=()=>{m(!1),a(C.TO,t.balance)};if(t.selected){B?rt():lt(),this.fromToStore.onSwitchFromTo();return}B?lt():rt();let pt=()=>{I||b(!0)};if(B){if(bo(t.chainId,p.chainId)&&this.commonStore.currentTab===k.BRIDGE){let Xt=new Lt(this.commonStore.currentTab,{}),[Ot,ht]=await Xt.fetchCrossChainTokens({fromChainId:t.chainId,fromTokenAddress:t.tokenContractAddress}),{amount:tn}=r,Je={...t},he;Ot?(s({...Je,amount:tn}),he=e?.dexDefaultFromToTokenShowVO?.toCrossDexMultiTokenInfoVO,i({...he})):(Je=ht.data.fromTokenInfo,he=ht.data.toTokenInfo,s({...Je,amount:tn}),i(he),pt(),this.fromToStore.getTokenBalanceByAccount("from",Je)),this.fromToStore.getTokenBalanceByAccount("to",he)}else if(!this.commonStore.equalsToken(t,r)){let{amount:Xt}=r;o.setQuoteNumber(2),s({...t,riskLevel:t.riskLevel,amount:Xt});let{toToken:Ot,isChanged:ht}=this.checkFromToLegal(t,p);i(Ot),ht&&(pt(),this.fromToStore.getTokenBalanceByAccount("to",it(Ot))),g&&this.fromToStore.advanceSetTypedValue("")}}else this.commonStore.equalsToken(t,p)||(pt(),o.setQuoteNumber(0),i({...t,amount:""}),g||this.fromToStore.advanceSetTypedValue(""));M()});n(this,"updateTokenCollectionStatus",(t,e,o)=>{let r=!o?.length,s=this.currentCollectionGroupId&&!o.includes(this.currentCollectionGroupId);this.updateTokenCollectedLocal({...e,isCollectToken:r||s})});n(this,"memeTagConfig",{});n(this,"setMemeTagConfig",t=>{this.memeTagConfig=t});n(this,"fetchMemeTagConfig",async()=>{let[,t]=await A(R.get(is)),e=t?.data?.tagAndEmojiMap||{};return this.setMemeTagConfig(e),e});this.rootStore=t,this.commonStore=t.commonStore,this.swapStore=t.swapStore,this.accountStore=t.accountStore,this.fromToStore=t.fromToStore}get computedIsSearching(){return!!this.searchValue}get computedCollectionGroupParams(){let t={accountId:this.accountStore.computedAccountId,walletAddress:this.accountStore.computedSignWalletAddress};return this.currentCollectionGroupId?{...t,groupId:this.currentCollectionGroupId}:t}get computedAdresses(){return T(this,"accountStore.computedMultiAddresses",{})}setSearchTokenList(t){this.searchTokenList=t}setError(t){this.error=t}setLoading(t,e,o){this.loading[t][e]=o}get computedTokenList(){return this.tokenModalFromState===C.FROM?this.fromTokenList.get(this.fromSelectedChainId):this.toTokenList.get(this.toSelectedChainId)}get computedSearchTokenList(){let t={};return Z(this.searchTokenList)||(t={systemList:this.extendTokenList(this.searchTokenList?.systemList,!1),thirdPartyList:this.extendTokenList(this.searchTokenList?.thirdPartyList,!1)}),t}toLowerCaseContractAddress(t){let e=[];return Array.isArray(t)&&t.forEach(o=>{e.push({...o,tokenContractAddress:this.commonStore.getTokenAddress(o)})}),e}isCancel(t){return gt(t)}getSearchParams(){throw new Error("getSearchParams method must be implemented by subclass")}get computedFromChain(){let t=qe(),e=tr({});return[t,e,...it(this.tokenPageChainList)]}get computedToChain(){let t=qe();if(F(this.fromToStore.from.chainId)){let e=this.tokenPageChainList.filter(o=>o?.chainId===this.fromToStore.from.chainId);return[t,...e]}return[t]}get computedCurrentToChainId(){return this.toSelectedChainId||F(this.toSelectedChainId)?this.toSelectedChainId:F(this.fromToStore.to.chainId)?this.calcCurToChainIdIsInSupList(this.fromToStore.to.chainId)?this.fromToStore.to.chainId:this.fromToStore.from.chainId:this.computedToChain.length>1?z.chainId:oe}reassignTokenInfo(t,e,o){if(this.commonStore.equalsToken(t,e)){let r=e?.isCollectToken;return Nt({},e,{isCollectToken:r?0:1,collectTime:r?"":Date.now().toString(),isCustomToken:o?1:e?.isCustomToken})}return t}filterCollectToken(t){let e=!t.isCustomToken||t.balance;return!!(!this.computedIsCollectChain&&e||this.searchValue||t.isCollectToken)}updateTokenCollectedLocal(t){let e=(o=[],r=!1)=>o.map(s=>this.reassignTokenInfo(s,t,r)).filter(s=>this.filterCollectToken(s));if(this.searchValue){let{systemList:o,thirdPartyList:r}=this.searchTokenList;this.setSearchTokenList({systemList:e(o),thirdPartyList:e(r,!0)})}else this.updateTokenList(e)}updateTokenList(t){if(this.tokenModalFromState===C.FROM){let e=t(this.fromTokenList.get(this.fromSelectedChainId));this.fromTokenList.set(this.fromSelectedChainId,e)}else if(this.tokenModalFromState===C.TO){let e=t(this.toTokenList.get(this.toSelectedChainId));this.toTokenList.set(this.toSelectedChainId,e)}}get computedCurrentChainId(){return G(this.tokenModalFromState===C.FROM?this.fromSelectedChainId:this.toSelectedChainId)}get computedCurrentSearchChainId(){return G(this.tokenModalFromState===C.FROM?this.fromSelectedChainAtSearch:this.toSelectedChainAtSearch)}get computedIsCollectChain(){return this.computedCurrentChainId===q.chainId}setShowCollectCancelConfirm(t){y.set(zi,t),this.hideCollectCancelConfirm=t}get computedIsNotSupportToChain(){let t=this.getCurrentToChainInfo();return this.tokenModalFromState===C.TO&&t&&t.disabled}get computedSelectedChainId(){return this.tokenModalFromState===C.FROM?this.fromSelectedChainId||this.fromToStore.from.chainId:this.tokenModalFromState===C.TO?this.toSelectedChainId||this.fromToStore.to.chainId:""}get computedAllChainList(){let t=this.commonStore.chainList;return this.tokenModalFromState===C.FROM?{supported:t,unsupported:[]}:this.tokenModalFromState===C.TO?this.computedToChainList:{supported:[],unsupported:[]}}get computedToChainList(){let t=this.commonStore.chainList,e=to(it(t),{chainId:Number(this.fromToStore.to.chainId)});return{supported:e?[e]:[],unsupported:[]}}get computedIsSearchChainStatus(){return!!this.searchChainKeywords}get computedSearchedChainList(){if(!this.computedIsSearchChainStatus)return{supported:[],unsupported:[]};let{supported:t,unsupported:e}=this.computedAllChainList;return{supported:this.filterChains(t),unsupported:this.filterChains(e)}}get computedTokenGuideVisible(){return!1}get computedIsWatchListGroupShow(){return this.searchValue?!1:this.tokenModalFromState===C.FROM&&Number(this.fromSelectedChainId)===q.chainId||this.tokenModalFromState===C.TO&&Number(this.toSelectedChainId)===q.chainId}};var er=class extends Ht{constructor(e){super(e);n(this,"showChainTab",!0);n(this,"clearCacheTokenList",()=>{this.fromTokenList.clear(),this.toTokenList.clear()});n(this,"extendTokenList",(e=[],o=!0)=>Z(e)?e:e?.map(r=>({...r,tokenList:this.extendTokens(r.tokenList,o)})));n(this,"generateToChainMap",()=>{let e=this.commonStore.chainList,r=to(it(e),{chainId:Number(this.fromToStore.from.chainId)})?.bridgeSupportChainInfoList||[];return zt([...r],"chainId")});n(this,"getCrossChainSearchType",()=>{let e=this.tokenModalFromState===C.FROM?this.fromSelectedChainAtSearch:this.toSelectedChainAtSearch;return Number(e)===q.chainId?yr.COLLECTION:yr.COMMON});n(this,"getToChainIdAtSearch",()=>{let e=this.toSelectedChainId;return this.tokenModalFromState===C.TO&&(e=this.toSelectedChainAtSearch),Number(e)===z.chainId?"":e});$(this)}get computedTokenGuideVisible(){let{tokenModalFromState:e,hideTokenGuide:o}=this;return e===C.TO&&!o}get computedSearchTokenList(){return this.extendTokenList(this.searchTokenList?.list,!1)}get computedToChainList(){let e=this.commonStore.chainList,o=[],r=[],s=this.generateToChainMap();return e.forEach(i=>{let a={...i};a.disabled=!s[i.chainId],a.disabled||o.push(a)}),{supported:o,unsupported:r}}updateTokenCollectedLocal(e){let o=(r=[],s=!1)=>{let i=[];return r?.forEach(a=>{let u=a?.tokenList.map(m=>this.reassignTokenInfo(m,e,s)).filter(m=>this.filterCollectToken(m));i.push({...a,tokenList:u})}),i};if(this.searchValue){let{list:r}=this.searchTokenList;this.setSearchTokenList({list:o(r)})}else this.updateTokenList(o)}get computedToChain(){let e=qe(),o=tr({});if(F(this.fromToStore.from.chainId)){let r=this.generateToChainMap(),s=[];return it(this.tokenPageChainList).forEach(i=>{!i||i.chainId!==Number(this.fromToStore.from.chainId)&&s.push({...i,disabled:!r[i.chainId]})}),[e,o,...s]}return[e]}getSearchParams(e){let o={...this.computedAdresses};return this.tokenModalFromState===C.FROM&&(o={...o,fromChainId:this.fromSelectedChainAtSearch},this.needRemoveChainId(this.fromSelectedChainAtSearch)&&delete o.fromChainId),this.tokenModalFromState===C.TO&&(o={...o,fromChainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainAtSearch},this.needRemoveChainId(this.toSelectedChainAtSearch)&&delete o.toChainId),{fromChainId:o.fromChainId??o?.chainId,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,targetChainId:o.targetChainId,targetWalletAddress:o.targetWalletAddress,walletAddress:this.accountStore.computedSignWalletAddress,inputContent:e,selectChainType:this.getCrossChainSelectChainType(),searchType:this.getCrossChainSearchType(),toChainId:this.getToChainIdAtSearch(),fromTokenAddress:this.fromToStore.from?.tokenContractAddress||""}}};d();l();P();var{BigNumber:Zi}=_,Qr="safemoon_slippage",Ur="safemoon_is_changed",ta=50,Gr={NeedIncreaseSlip:0,AdviseGivenSlip:1,NotAvailableGivenSlip:2,AdviseSlip:3},Yt=class{constructor(t){n(this,"isChanged",!1);n(this,"getSafemoonIsChangedLocal",()=>!!y.get(`${Ur}_${this.computedSlippageTokenPair}`));n(this,"cacheSlippage",0);L(this),this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,Tt(()=>this.computedSlippageTokenPair,()=>{this.setSafeMoonIsChanged(y.get(`${Ur}_${this.computedSlippageTokenPair}`)),this.setCacheSlippage(y.get(`${Qr}_${this.computedSlippageTokenPair}`))}),Tt(()=>({slippage:this.computedPairSlippage}),()=>{this.cacheSlippage>0&&this.computedPairSlippage>this.cacheSlippage&&this.setSafeMoonIsChanged(!1),this.setCacheSlippage(y.get(`${Qr}_${this.computedSlippageTokenPair}`))}),Tt(()=>this.computedSlippage,e=>{this.commonStore.safemoonSlippage=e})}setSafeMoonIsChanged(t){this.isChanged=t;let{computedIsSingleChain:e}=this.fromToStore;e||y.set(`${Ur}_${this.computedSlippageTokenPair}`,t)}checkIsChanged(t){let e=new Zi(t),o=e.gte(this.computedPairSlippage)&&e.lte(50);o&&this.setSafeMoonIsChanged(o)}setSafeMoonPairSlippage(t){!this.isAccessSlippage(t)||(this.setCacheSlippage(t),y.set(`${Qr}_${this.computedSlippageTokenPair}`,t))}isAccessSlippage(t){let e=new Zi(t);return this.computedPairSlippage>0&&e.gte(this.computedPairSlippage)&&e.lte(50)}get computedAutoSlippage(){return Mo(this.rootStore)}get computedSafeMoonToken(){let{from:t,to:e}=this.fromToStore;return this.checkIsSafeMoon(t)?t:this.checkIsSafeMoon(e)?e:null}get computedHoneypot(){let{from:t,to:e}=this.fromToStore;return this.checkIsHoneypot(t)?t:this.checkIsHoneypot(e)?e:null}setCacheSlippage(t){this.cacheSlippage=t}get computedPairSlippage(){return this.computedSafeMoonToken?1.1:0}get computedSlippage(){return this.cacheSlippage>this.computedPairSlippage?this.cacheSlippage:this.computedPairSlippage}get computedOverLimit(){return this.computedSlippage>50}get computedSlippageTokenPair(){let{from:t,to:e}=this.fromToStore;return`${this.checkIsSafeMoon(t)?t.tokenContractAddress:""}_${this.checkIsSafeMoon(e)?e.tokenContractAddress:""}`}get computedSlippageTips(){let t=Number(this.computedAutoSlippage),{tokenSymbol:e}=this.computedSafeMoonToken||{},{from:o,to:r}=this.fromToStore,s=this.checkIsSafeMoon(o)||this.checkIsSafeMoon(r),i=this.checkIsHoneypot(o)||this.checkIsHoneypot(r);return!s||i?null:t===ta?{type:Gr.AdviseGivenSlip,safeMoonSlippage:t,equalLimit:!0,tip:h("swaptrade_card_errortip_autoadjust_to_50",{tokenSymbol:e,slippageTolerance:t}),tipEquation:h("swaptrade_card_errortip_autoadjust_to_50",{tokenSymbol:Q(e),slippageTolerance:t}),inputWarning:h("swaptrade_adjustslip_modal_advise_givenslip")}:t>ta?{type:Gr.NotAvailableGivenSlip,overLimit:!0,safeMoonSlippage:t,tip:h("wallet_swap_adjustslip_modal_slip_notsupported",{tokenSymbol:e}),tipEquation:h("wallet_swap_adjustslip_modal_slip_notsupported",{tokenSymbol:Q(e)})}:{type:Gr.AdviseSlip,safeMoonSlippage:t,tip:h("swaptrade_card_errortip_autoadjust_to_less50",{slippageTolerance:t,tokenSymbol:e}),tipEquation:h("swaptrade_card_errortip_autoadjust_to_less50",{slippageTolerance:t,tokenSymbol:Q(e)}),inputWarning:h("swaptrade_modal_errortip_adjust_to_suggested_range",{slippageTolerance:t})}}checkIsSafeMoon(t){return T(t,"isSafeMoonToken")===1}checkIsHoneypot(t){return T(t,"isHoneypot")===1}get computedInputVal(){let{computedSwapAmount:t}=this.fromToStore;return t[C.FROM]}get computedInputFiatVal(){let{computedFromLocalCostByUsd:t}=this.fromToStore;return t}get computedOutputVal(){let{computedSwapAmount:t}=this.fromToStore;return t[C.TO]}get computedOutputFiatVal(){let{computedToLocalCostByUsd:t}=this.fromToStore;return t}get computedOutputPopVal(){let{computedSwapAmount:t}=this.fromToStore;return as(t[C.TO])}};d();l();var Qe=class{constructor({swapServStatusStore:t,chainIdList:e}){this.chainIdList=e,this.swapServStatusStore=t,L(this)}get currChainMaintenanceInfo(){let t=this.swapServStatusStore.maintenanceChainsMap,e=this.chainIdList?.get()?.slice()??[];if(!t||!e.length)return null;for(let o of e){let r=t[o];if(r)return r}return null}get isCurrChainInMaintenance(){return Boolean(this.currChainMaintenanceInfo)}};d();l();var or=class{constructor(){n(this,"gasDropConfig",{gasDropShow:!1,gasDropSwitch:y.get(Sr)===Tn.OPEN,chainName:"",chainId:"",deduction:"",gasDrop:"",tokenLogoUrl:"",tokenSymbol:""});n(this,"setGasDropInfo",t=>{this.gasDropConfig={...this.gasDropConfig,...t}});n(this,"setGasDropSwitch",t=>{this.setGasDropInfo({gasDropSwitch:t}),y.set(Sr,`${Number(t)}`)});n(this,"resetGasDrop",()=>{this.setGasDropInfo({gasDropShow:!1})});L(this)}get computedGasDropSelected(){let{gasDropShow:t,gasDropSwitch:e}=this.gasDropConfig;return t&&e}};d();l();var Vr=class{constructor(t){n(this,"isShowMev",!1);n(this,"setShowMev",t=>{this.isShowMev=t});n(this,"mevSwitchOpenStatue",_o.AUTO_OFF);n(this,"setMevUserSwitchOpen",t=>{this.mevSwitchOpenStatue=t});n(this,"mevInfo",{});n(this,"setMevInfo",t=>{this.mevInfo=t});n(this,"walletMevControl",!1);n(this,"setWalletMevControl",t=>{this.walletMevControl=t});this.rootStore=t,this.quoteStore=this.rootStore.quoteStore,this.fromToStore=this.rootStore.fromToStore,L(this,{},{autoBind:!0})}get computedIsMevOpen(){return this.isShowMev&&(this.mevSwitchOpenStatue===_o.AUTO_ON||this.mevSwitchOpenStatue===_o.USER_ON)}},rr=Vr;d();l();P();var Wr=class{constructor(t){n(this,"feeConfig",{});n(this,"setFeeConfig",t=>{if(!this.isIframe)return;if(!Z(t)){this.feeConfig=t,ke.set("feeConfig",t);return}let e=ke.get("feeConfig"),o=eo(e,["referrerAddress","feePercent"]);Z(o)?(this.feeConfig={},ke.remove("feeConfig")):this.feeConfig=o});n(this,"widgetFeeConfig",{});n(this,"setWidgetFeeConfig",t=>{this.isWidget&&(this.widgetFeeConfig=t)});n(this,"receiveQuoteUrl",()=>this.isIframe?On:Dn);n(this,"aggregatorQuoteUrl",()=>Fn);n(this,"saveOrderUrl",()=>this.isIframe?qn:Bn);n(this,"illegalFeePercent",t=>{let{BigNumber:e}=_,o=e(t);return!!(o.isNaN()||o.gt(En)||o.lte(0))});n(this,"extendFeeConfig",(t={})=>{if(this.isWidget){let o=T(this.widgetFeeConfig,[t.chainId],{});if(typeof o.referrerAddress=="string")return{...t,...o};let r=T(o,["referrerAddress",t.fromTokenAddress]),s=T(r,"account"),a=T(r,"feePercent")||o.feePercent;return s?{...t,referrerAddress:s,feePercent:a}:t}if(!this.computedHasFeeConfig)return t;let e=Z(this.feeConfig)?ke.get("feeConfig"):this.feeConfig;return{...t,...e}});L(this),this.rootStore=t,this.isIframe=!_t()&&ps()&&!ys,this.isWidget=!_t()&&ne()}get computedHasFeeConfig(){return!!this.feeConfig?.referrerAddress&&!!this.feeConfig?.feePercent&&this.isIframe}get computedFeeConfigErrorTips(){return this.computedHasFeeConfig?this.illegalFeePercent(this.feeConfig?.feePercent):!1}},nr=Wr;d();l();P();d();l();P();d();l();var ea=()=>{let{swapStore:c,intentSwapStore:t,swapDappStore:e,approveStore:o,fromToStore:r}=w(),{from:s,to:i}=r;return!(!i?.tokenContractAddress||!s?.tokenContractAddress||o.visibleApprove||c.isConfirmLoading||t.isConfirmLoading||e.computedSupportDappTradeByChain)};d();l();d();l();var oa=c=>{let{fromToStore:t,quoteStore:e}=w(),{commonDexInfo:o,pathSelectionRouterList:r,singleChainSwapInfo:s}=c,{computedIsSingleChain:i}=t,a=Number(o?.code)===tt.CROSS_CHAIN_INTERVAL,u=a?{crossMaxAmount:o?.crossMaxAmount,crossMiniAmount:o?.crossMiniAmount}:null;return e.setQuoteScope(u),{isAutoError:a||(i?!s:!r?.length)}};var za=({quoteStore:c,fromToStore:t})=>{c.setQuoteNumber(c.quoteNumber+1),c.quoteNumber===1&&c.checkQuoteScopeLtMin(c.quoteScope,t.from.amount)&&t.advanceSetTypedValue("")},Ja=(c,{fromToStore:t,quoteStore:e})=>{let{commonDexInfo:o,pathSelectionRouterList:r,singleChainSwapInfo:s,swapType:i,intentCode:a,isSupportDappTrade:u,offlineType:m,traceData:p,serviceFeeInfo:g}=c,I={intentCode:a,offlineType:m,swapType:i,traceData:p},b=r?.map(B=>({...o,...B,...I,isSupportDappTrade:u}));return{bestRoute:t.computedIsSingleChain?{...o,...s,...I,serviceFeeInfo:g,intentInfo:c?.intentInfo||{},isSupportDappTrade:u}:e.pickBestRouterAccordingBridgeId(b)||{...o,...I,isSupportDappTrade:u},combineSelectionRouterList:b}},Za=({bestRoute:c,combineSelectionRouterList:t,isAutoError:e,networkFeeInfo:o,jitoData:r,commonDexInfo:s},{fromToStore:i,quoteStore:a})=>{a.updateSlippageInfoFetched(c),a.setQuote({...a.quote,bestRoute:c,quoteNull:e,quoteError:null,isFetchQuoting:!1,networkFeeInfo:o,jitoData:r,commonDexInfo:s}),i.quoteUpdateFromTo(c),i.computedIsSingleChain||a.setPathSelectionRouterList(t||[])},Hr=({isAutoError:c},{approveStore:t})=>{if(!c){let{fromToStore:e,quoteStore:o,accountStore:r}=w(),{needApprove:s,defiPlatformId:i,defiPlatformIds:a,allowanceData:u}=J.getApproveInfo(e.computedIsCrossChain,o);t.isPendingNotCheck({token:e.from,needApprove:s,defiPlatformIds:a,defiPlatformId:i,allowanceData:u,userWalletAddress:r.getAddressByChainId(e.from.chainId)}).catch(()=>{})}},Ue=({isAutoError:c},{quoteStore:t})=>{c&&(t.handleReverseQuoteErrorAndNull(),st(()=>{t.updateQuoteStatus(t.quoteScope?2:3)}))},tc=c=>{let{solanaPriorityFeeStore:t}=w();t&&t.setJitoData(c?.networkFeeInfo)},Yr=c=>{c?.networkFeeInfo&&dt.setNetworkFeeInfo(c?.networkFeeInfo)},ra=c=>{let{fromToStore:t,quoteStore:e,approveStore:o}=w(),{isAutoError:r}=oa(c);za({quoteStore:e,fromToStore:t});let{bestRoute:s,combineSelectionRouterList:i}=Ja(c,{fromToStore:t,quoteStore:e}),{networkFeeInfo:a,newPriorityFeeInfo:u,jitoData:m,commonDexInfo:p}=c;Za({bestRoute:s,combineSelectionRouterList:i,isAutoError:r,jitoData:m,commonDexInfo:p,networkFeeInfo:u||a},{fromToStore:t,quoteStore:e,approveStore:o}),tc(c),Yr(c),Hr({isAutoError:r},{approveStore:o}),Ue({isAutoError:r},{quoteStore:e})};d();l();var Ge=class{constructor(t){n(this,"allTimerAndQuoteState",{[j.DEFAULT]:{isShowLoadingCpt:!1,quoteText:()=>""},[j.QUOTING]:{isShowLoadingCpt:!0,quoteText:()=>h(mo)},[j.TIMER]:{isShowLoadingCpt:!0,quoteText:()=>h(mo)},[j.QUOTE_IS_HONEYPOT]:{isShowLoadingCpt:!1,quoteText:()=>h(lo)},[j.QUOTE_NULL]:{isShowLoadingCpt:!0,quoteText:()=>h(lo)},[j.QUOTE_NULL_AND_SECTION]:{isShowLoadingCpt:!0,quoteText:()=>h(mo)},[j.QUOTE_ERROR]:{isShowLoadingCpt:!1,quoteText:()=>h(lo)}});Object.assign(this,t)}isValidRange(t){if(typeof t!="string")return!1;let{from:e}=this.fromToStore,o=t.split("-");if(o.length!==2)return!1;let{BigNumber:r}=_;return r(e.amount).lt(o[0])||r(e.amount).gt(o[1])}getCurrentTimerQuoteState(){let{quoteNull:t,isFetchQuoting:e,quoteError:o,bestRoute:r}=this.quote,s=this.fromToStore?.computedIfQuote,i=o!==null;return s?i?this.allTimerAndQuoteState[j.QUOTE_ERROR]:this.rootStore.safeMoonStore.computedHoneypot?this.allTimerAndQuoteState[j.QUOTE_IS_HONEYPOT]:t?r?.msg&&(e||this.isValidRange(r.msg))?this.allTimerAndQuoteState[j.QUOTE_NULL_AND_SECTION]:this.allTimerAndQuoteState[j.QUOTE_NULL]:e?e?this.allTimerAndQuoteState[j.QUOTING]:this.allTimerAndQuoteState[j.DEFAULT]:this.allTimerAndQuoteState[j.TIMER]:this.allTimerAndQuoteState[j.DEFAULT]}};var Kt=class{constructor(){n(this,"dialogCloseFlag",!1);n(this,"slippageInfoFetched",!1);n(this,"setDialogCloseFlag",t=>{this.dialogCloseFlag=t});n(this,"enableQuoteAggregates",!1);n(this,"dialogShowQuotationComparison",!1);n(this,"setDialogShowQuotationComparison",t=>{this.dialogShowQuotationComparison=t});n(this,"quoteNumber",0);n(this,"setQuoteNumber",t=>{this.quoteNumber=t});n(this,"aggregateSelectId",et);n(this,"isDialog",!1);n(this,"setIsDialog",t=>{this.isDialog=t});n(this,"initQuote",{bestRoute:null,quoteError:null,quoteNull:!1,isFetchQuoting:!1});n(this,"isPickRouterFromWallet",!1);n(this,"setIsPickRouterFromWallet",t=>{this.isPickRouterFromWallet=t});n(this,"quoteScope",null);n(this,"setQuoteScope",t=>{this.quoteScope=t});n(this,"fetchQuoteStatus",0);n(this,"quote",{...this.initQuote});n(this,"setQuote",t=>{this.quote=t});n(this,"pathSelectionRouterList",[]);n(this,"setPathSelectionRouterList",t=>{this.pathSelectionRouterList=t});n(this,"pickRouter",{});n(this,"setPickRouter",(t,e)=>{this.pickRouter=t,e&&(this.setNoCurrentPathTipInfo({bridgeName:t?.bridge?.bridgeName}),this.updateBestRoute(t))});n(this,"showChainListModel",!1);n(this,"setShowChainListModel",t=>{this.showChainListModel=t});n(this,"noCurrentPathTipInfo",{visible:!1,bridgeName:""});n(this,"setNoCurrentPathTipInfo",t=>{this.noCurrentPathTipInfo={...this.noCurrentPathTipInfo,...t}});n(this,"currentBridgeId","");n(this,"setCurrentBridgeId",t=>{this.currentBridgeId=t});n(this,"updateBestRoute",t=>{this.setQuote({...this.quote,bestRoute:t}),this.rootStore.fromToStore?.quoteUpdateFromTo(t)});n(this,"pickBestRouterAccordingBridgeId",t=>{let{smartRouterStore:{showXRouteModal:e}}=this.rootStore;if(!t||t.length===0)return null;let o=t.find(r=>r?.bridge?.bridgeId===this.currentBridgeId);return this.currentBridgeId&&!o&&(this.setCurrentBridgeId(""),!this.showChainListModel&&e!==Ro.ROUTER_SELECT&&this.setNoCurrentPathTipInfo({visible:!0})),o||t?.[0]});n(this,"quoteTimer",null);n(this,"clearQuote",()=>{this.cleanQuoteTimer(),this.setQuote(this.initQuote),this.rootStore.fromToStore?.quoteUpdateFromTo(null),this.quotePending=!1;let{computedIsCrossChain:t,computedIfQuote:e}=this.fromToStore;t?(this.setBridgeQuoteSelectStatus?.(0),this.setBridgeFetchStatus?.(e?1:0)):(this.setAggregateSelectStatus(0),this.setAggregateFetchStatus(e?1:0))});n(this,"cancelRef",null);n(this,"cleanQuoteTimer",()=>{clearTimeout(this.quoteTimer),this.quoteTimer=null,this.cancelRef&&this.cancelRef.abort()});n(this,"isClearQuote",()=>{let{currentTab:t}=this.commonStore,{computedTypedValue:e,from:o,to:r,computedIsSingleChain:s,computedIsExactIn:i}=this.fromToStore;return t===k.LIMIT_ORDER||!kt(e)||!r?.tokenContractAddress||!o?.tokenContractAddress||!i&&!s});n(this,"getQuoteData",async({signal:t})=>{let e=await Fe();return A(yt(()=>R.get(this.getQuoteStoreUrl(),{params:e,signal:t,isolate:!0}),ft.NUM,ft.TIMER))});n(this,"handleUpdateQuote",t=>{if(t){let{data:e}=t;ra(e)}});n(this,"fetchQuote",async({source:t}={})=>{if(!ea())return this.quoteTimer=setTimeout(()=>{this.fetchQuote().catch(()=>{})},Ie),Promise.resolve(!1);if(t===0){let{computedIsCrossChain:r}=this.fromToStore;r?(this.setBridgeQuoteSelectStatus?.(0),this.setBridgeFetchStatus?.(1),this.setBridgeSelectId?.(et)):(this.setAggregateSelectStatus(0),this.setAggregateFetchStatus(1),this.setAggregateSelectId(et))}if(this.isClearQuote())return this.quoteScope=null,this.clearQuote(),Promise.resolve(!1);if(this.cleanQuoteTimer(),this.rootStore.outerStore.computedFeeConfigErrorTips)return this.handleQuoteError(null),Promise.resolve(!1);this.setQuote({...this.quote,isFetchQuoting:!0}),this.cancelRef=Et();let[e,o]=await this.getQuoteData(this.cancelRef.signal);return this.quotePending=!1,!gt(e)&&e&&this.handleQuoteError(e),this.handleUpdateQuote(o),this.setIsPickRouterFromWallet(!1),this.commonStore.setResetFromToByTabChange(!1),!gt(e)&&!this.dialogCloseFlag&&st(()=>{this.quoteTimer=setTimeout(()=>{this.fetchQuote().catch(()=>{})},Ie)}),Promise.resolve(!0)});n(this,"cacheQuoteParams",{});n(this,"quotePending",!1);n(this,"debounceQuote",Ze(this.fetchQuote,Eo));n(this,"fetchQuoteDebounce",async({source:t}={})=>{let{computedIsCrossChain:e,computedIfQuote:o}=this.fromToStore;this.quotePending=!0,o&&e?await this.debounceQuote({source:t}):o&&!e?this.debounceQuote({source:t}):this.clearQuote()});n(this,"handleQuoteError",t=>{this.setQuote({...this.initQuote,quoteError:t}),this.handleReverseQuoteErrorAndNull()});n(this,"getGasTokenFeeLoading",!1);n(this,"getGasTokenFeeCancelRef",null);n(this,"cancelGasTokenGeeRequest",()=>{this.getGasTokenFeeCancelRef&&(this.getGasTokenFeeCancelRef.abort(),this.getGasTokenFeeCancelRef=null)});n(this,"cacheNativeGasFee","");n(this,"setCacheNativeGasFee",t=>{this.cacheNativeGasFee=t});n(this,"fetchGasTokenFee",async()=>{let{from:t}=this.rootStore.fromToStore,{computedReserveGas:e}=this.rootStore.commonStore,{decimals:o,balance:r}=t||{},s=nn(Me(),["dexIds"]);this.getGasTokenFeeCancelRef=Et();let i=this.rootStore.fromToStore?.computedIsExactIn?vn:Nn;this.getGasTokenFeeLoading=!0;let a=this.getGasTokenFeeCancelRef.signal,u=e,[m,p]=await A(R.get(i,{params:{...s,amount:us(r,o)},signal:a}));if(this.getGasTokenFeeLoading=!1,!gt(m)&&m)return-1;if(!m){let{data:g}=p||{},{commonDexInfo:I}=g||{};Number(I?.code)===0&&I?.estimateReserveGasTokenFee!==""&&(u=I.estimateReserveGasTokenFee)}return this.setCacheNativeGasFee(u),u})}initQuoteStatus(){this.fetchQuoteStatus=0}updateQuoteStatus(t){this.fetchQuoteStatus=t}get computedSlippage(){let{computedIsSingleChain:t,computedDefaultAutoSlippageInfo:e}=this.fromToStore,o=this.rootStore.slippageStore,r=Qs({isSingleChain:t,autoSlippageInfo:e}),s=Mt.AUTO,i,a;return o&&(r=o.computedRealSlippageValue,s=o.getSlippageType(),i=t?o.computedRealCustomMaxSlippage:void 0,a=t?o.computedRealCustomSlippage:void 0),{slippage:r,slippageType:s,customSlippage:a,maxSlippage:i}}getQuoteStoreUrl(){return this.outerStore.receiveQuoteUrl()}handleReverseQuoteErrorAndNull(){let{updateFromAmount:t,computedIsExactIn:e,updateTo:o}=this.fromToStore;e?o({amount:""}):t({amount:""})}getQuoteError(t){let{commonDexInfo:e,pathSelectionRouterList:o,singleChainSwapInfo:r}=t,{computedIsSingleChain:s}=this.fromToStore,i=Number(e?.code)===tt.CROSS_CHAIN_INTERVAL,a=i?{crossMaxAmount:e?.crossMaxAmount,crossMiniAmount:e?.crossMiniAmount}:null;return this.setQuoteScope(a),{isAutoError:i||(s?!r:!o?.length)}}updateSlippageInfoFetched(t){let{referenceSlippage:e,autoSlippage:o,autoTotalSlippage:r}=t?.autoSlippageInfo||{};(e||o||r)&&(this.slippageInfoFetched=!0)}checkQuoteScopeLtMin(t,e){if(!t||!e)return!1;let{crossMiniAmount:o}=this.quoteScope||{};return!!_.BigNumber(e).lt(_.BigNumber(o))}get computedCurrentTimerQuoteState(){return new Ge(this).getCurrentTimerQuoteState()}get computedRouterForSmartRouterStore(){return this.fromToStore?.computedIsSingleChain?this.quote?.bestRoute:this.pickRouter}get computedMediaForChangeSmartRouterData(){return Po()?.media==="sm"||this.isDialog}get computedQuoteAmount(){let{computedIsExactIn:t}=this.fromToStore;return t?this.quote?.bestRoute?.fromTokenAmount:this.quote?.bestRoute?.payAmount}get computedQuoteIntervalIsEmpty(){return this.computedQuoteInterval.type===V.EMPTY}get computedShouldShowLimitRegionTip(){let t=!!Ho.computedIsLimitRegion;return this.fromToStore?.computedIsSingleChain?t&&!this.quote?.bestRoute:t}get computedQuoteInterval(){let{fromToStore:t,approveStore:e,swapBtnStore:o,swapDappStore:r}=this.rootStore;if(this.quote?.bestRoute?.code===wn||this.quote?.bestRoute?.code===yn||t.computedFormToTokenIsLeverageToken)return{type:V.EMPTY};let s=ui.handleQuoteErrorState({quote:this.quote,honeypotToken:T(this,"rootStore.safeMoonStore.computedHoneypot",!1),shouldShowLimitRegionTip:this.computedShouldShowLimitRegionTip})||this.accountStore.computedNonsupportChain,{from:i}=this.fromToStore;if(s)return{type:V.EMPTY};if(r.checkShouldJumpToDapp())return{type:V.SHOULD_JUMP_DAPPS};if(this.computedNotSupportBtcAddress&&this.accountStore.isConnectedWallet)return{type:V.NOT_SUPPORT_BTC_ADDRESS_TYPE,text:this.quote.bestRoute?.errorMsg};if(this.computedIsNoOkxLiquidity)return{type:V.NOT_OKX_LIQUIDITY};let u=t.computedIsCrossChain?T(this.quote?.bestRoute,"bridge.defiPlatformId"):T(this.quote?.bestRoute,"defiPlatformId",at);if((!this.quoteScope||!t.computedIfQuote)&&this.fetchQuoteStatus!==3&&!e.isCancelApproveStatus(i,u)&&!this.computedPriceWarn.show&&!this.quote?.bestRoute?.errorMsg)return{type:V.EMPTY};if(this.computedCrossAccuracyLimit)return{type:V.CROSS_CHAIN_ACCURACY,text:h("swaptrade_card_tooltips_adjust_pay_token_decimal",{fromToken:i.tokenSymbol,value:this.computedCrossAccuracyLimit}),equation:h("swaptrade_card_tooltips_adjust_pay_token_decimal",{fromToken:Q(i.tokenSymbol),value:this.computedCrossAccuracyLimit})};let{crossMiniAmount:m,crossMaxAmount:p}=this.quoteScope||{};if(_.BigNumber(i.amount).lt(_.BigNumber(m))){let g=At(m,{cutPriceText:!0,isFloor:!1});return{type:V.CROSS_CHAIN_MIN,text:h("swaptrade_bridge_toast_min_amout_crosschain_swap",{value:g,symbol:i.tokenSymbol}),equation:h("swaptrade_bridge_toast_min_amout_crosschain_swap",{value:g,symbol:Q(i.tokenSymbol)})}}if(_.BigNumber(i.amount).gt(_.BigNumber(p))){let g=At(p,{cutPriceText:!0});return{type:V.CROSS_CHAIN_MAX,text:h("swaptrade_bridge_toast_max_amout_crosschain_swap",{value:g,symbol:i.tokenSymbol}),equation:h("swaptrade_bridge_toast_max_amout_crosschain_swap",{value:g,symbol:Q(i.tokenSymbol)})}}return this.quote?.bestRoute?.errorMsg?{type:V.CROSS_CHAIN_MORE_TIPS,text:this.quote?.bestRoute?.errorMsg}:this.computedIsNoLiquidity?{type:V.NOT_LIQUIDITY}:this.computedCrossChainIntervalOutOfRange?{type:V.NOT_LIQUIDITY}:e.isCancelApproveStatus(i,u)&&!o.computedTooBalance?{type:V.CANCEL_APPROVE_TIPS}:this.computedPriceWarn.show?{type:V.PROVIDER_PRICE_WARN}:{type:V.EMPTY}}get computedNotSupportFromBtcAddressType(){let t=this.quote?.bestRoute?.code;return Number(t)===tt.NOT_SUPPORT_FROM_BTC_ADDRESS}get computedNotSupportToBtcAddressType(){let t=this.quote?.bestRoute?.code;return Number(t)===tt.NOT_SUPPORT_TO_BTC_ADDRESS}get computedNotSupportBtcAddress(){return this.computedNotSupportFromBtcAddressType||this.computedNotSupportToBtcAddressType}get computedCrossChainIntervalOutOfRange(){let{from:t}=this.fromToStore,{crossMiniAmount:e,crossMaxAmount:o}=this.quoteScope||{};return _.BigNumber(t.amount).lte(o)&&_.BigNumber(t.amount).gte(e)}get computedIsNoLiquidity(){return this.fetchQuoteStatus===3&&this.quote.quoteNull}get computedIsNoOkxLiquidity(){let t=this.quote?.bestRoute?.defiPlatformInfoList;return this.enableQuoteAggregates&&t&&this.aggregateFetchStatus===3?!t.some(o=>o?.defiPlatformId===at):!1}get computedCrossAccuracyLimit(){let{crossAccuracyLimit:t,code:e}=this.quote.bestRoute||{};return Number(e)===tt.CROSS_CHAIN_ACCURACY?t:""}get computedYouSaveVisible(){let{computedNowCurrencySymbol:t,currencyConversion:e,computedIsWalletEnv:o}=this.commonStore,{computedIsExactIn:r,computedIsCrossChain:s}=this.rootStore.fromToStore,{quoteError:i,quoteNull:a,bestRoute:u}=this.quote;if(!r||i||a||!u?.youSaveDTO||s)return{visible:!1};let{youSaveDTO:m,fromToken:p,toToken:g}=u,{topTenDexInfoList:I,youSaveMoney:b}=m,M=Number(b)>=.1&&I?.length>0&&!p.isHoneypot&&!g.isHoneypot,B=e(b).toString(),lt=M?Dt(B,t,{isFloor:!1}):"",rt=M?I?.[1]?.dexName:"";return o&&(!s&&this.computedTopTenDexInfoList.length>0?M=!0:M=!1),{visible:M,youSaveStr:lt,dexName:rt}}get computedHasYouSave(){let{computedIsCrossChain:t}=this.rootStore.fromToStore;return!!this.quote?.bestRoute?.youSaveDTO||t}get computedTopTenDexInfoList(){if(!this.rootStore.fromToStore?.computedIsExactIn||!this.computedHasYouSave)return[];let{computedNowCurrencySymbol:t,currencyConversion:e}=this.commonStore;return this.quote?.bestRoute?.youSaveDTO?.topTenDexInfoList?.map(({logoUrl:o,dexName:r,comparePercent:s,price:i,dexAmountOut:a,amountOutOfMoney:u,gasOfMoney:m,isOkxDex:p})=>{let g=e(u)?.toString(),I=e(m)?.toString();return{logoUrl:o,dexName:r,comparePercent:s,price:i,isOkxDex:p,formatPrice:At(i),dexAmountOut:_.BigNumber(a).toString(),formatDexAmountOut:At(a),amountOutOfMoney:g,formatAmountOutOfMoney:Dt(g,t,{needBillionMillionUnit:!1}),gasOfMoney:Dt(I,t),symbol:t||""}})??[]}get computedReferredFee(){let{bestRoute:t}=this.quote,{referredNetWorkFee:e,referredAmount:o}=t||{};if(!o||!e)return"";let{computedNowCurrencySymbol:r,currencyConversion:s}=this.commonStore,{from:i}=this.fromToStore;return h("swaptrade_modal_desc_crosschain_valuediff_variavle",{price:`${At(o)} ${i.tokenSymbol}`,fee:`${Dt(s(e).toString(),r)}`})}get computedIsUsingCentralizedBridge(){let t=["8"],e=String(this.quote.bestRoute?.bridge?.bridgeId);return t.includes(e)}get computedIsNoQuote(){return this.quote.quoteError||this.quote.quoteNull||!this.quote.bestRoute||this.fromToStore.computedFormToTokenIsLeverageToken||this.rootStore.outerStore.computedFeeConfigErrorTips||!this.fromToStore.computedTypedValueIsValid}get computedSupportDappTradeByQuote(){return Number(this.quote?.bestRoute?.isSupportDappTrade)===1}setAggregateFetchStatus(t){return t}setAggregateSelectStatus(t){return t}setAggregateSelectId(t){return t}get computedIsOfflineType(){let{computedIsCrossChain:t}=this.rootStore.fromToStore;return t?Number(this?.quote?.bestRoute?.bridge?.bridgeType)===xs.INTENT_BRIDGE:this?.quote?.bestRoute?.offlineType===Ms.YES}get computedIsFreeNetworkFee(){return this?.quote?.bestRoute?.bridge?.isFreeNetworkFee===Fs.FREE_NETWORK_FEE}get computedIsOkxProvider(){return!this?.quote?.bestRoute?.defiPlatformId||this?.quote?.bestRoute?.defiPlatformId===at}get computedBridgeIsOkxProvider(){let{defiPlatformId:t}=this?.quote?.bestRoute?.bridge||{};return!t||t===at}get computedPriceWarn(){let t=_.BigNumber(this?.quote?.bestRoute?.reducePercent),e=_.BigNumber(this?.quote?.bestRoute?.warnPercent);return{show:t&&t.isGreaterThan(e)}}get computedreducePercent(){return ms(this?.quote?.bestRoute?.reducePercent)}};d();l();P();var rc=c=>{let{quoteStore:t,swapStore:e}=w();!c&&t.bridgeQuoteSelectStatus!==0&&(t.setBridgeNoRouteTipStatus(e.confirmSwapVisible?2:1),t.setBridgeQuoteSelectStatus(0))},ia=c=>Number(c.commonDexInfo?.code)===tt.CROSS_CHAIN_INTERVAL,nc=c=>!c.pathSelectionRouterList?.length,sc=c=>ia(c)||nc(c),ic=c=>{let{quoteStore:t}=w(),e=ia(c)?{crossMaxAmount:c.commonDexInfo?.crossMaxAmount,crossMiniAmount:c.commonDexInfo?.crossMiniAmount}:null;t.setQuoteScope(e)},ac=c=>{let{quoteStore:t}=w(),e=t.bridgeSelectId===et?c[0]:c?.find(o=>o.bridge.bridgeId===t.bridgeSelectId);return rc(e),e||c[0]},cc=({data:c})=>{let{commonDexInfo:t,singleChainSwapInfo:e,swapType:o,pathSelectionRouterList:r,intentCode:s,isSupportDappTrade:i,offlineType:a,traceData:u}=c||{},m=r?.map((b,M)=>({commonDexInfo:t,...b,...b?.valueDiffInfo,isBest:M===0})),p={intentCode:s,offlineType:a,swapType:o,traceData:u},g={...e,...t,swapType:o,pathSelectionRouterList:m},I=m?.map(b=>({...t,...b,...p,isSupportDappTrade:i}));return{bestRoute:g,combineSelectionRouterList:I}},uc=c=>{let{quoteStore:t,smartRouterStore:e}=w();if(e.showXRouteModal!==Ro.XROUTER)return;let o=c.find(r=>r?.bridge?.bridgeId===t.pickRouter?.bridge?.bridgeId);o&&t.setPickRouter(o)},mc=({isAutoError:c,approveStore:t})=>{if(!c){let{fromToStore:e,accountStore:o,quoteStore:r}=w(),{needApprove:s,defiPlatformId:i,defiPlatformIds:a,allowanceData:u}=J.getApproveInfo(e.computedIsCrossChain,r),m=T(e,"from.chainId");t.bridgePendingNotCheck({token:e.from,userWalletAddress:o.getAddressByChainId(m),needApprove:s,defiPlatformIds:a,defiPlatformId:i,allowanceData:u}).catch(()=>{})}},dc=({bestRoute:c,bridgeInfo:t,isAutoError:e,originData:o,combineSelectionRouterList:r},{fromToStore:s,quoteStore:i})=>{let a=Nt({},c,t);i.updateSlippageInfoFetched(a),i.setBridgeSelectId(a?.bridge?.bridgeId),i.setQuote({...i.quote,bestRoute:a,quoteNull:e,quoteError:null,isFetchQuoting:!1}),ic(o),e&&i.setBridgeFetchStatus(3),s.quoteUpdateFromTo(a),s.computedIsCrossChain&&(i.setPathSelectionRouterList(r||[]),uc(r||[]))},aa=c=>{let{fromToStore:t,quoteStore:e,approveStore:o}=w(),{bestRoute:r,combineSelectionRouterList:s}=cc({data:c}),i=ac(r.pathSelectionRouterList),a=sc(c);e.setQuoteNumber(e.quoteNumber+1),dc({bestRoute:r,bridgeInfo:i,isAutoError:a,originData:c,combineSelectionRouterList:s},{fromToStore:t,quoteStore:e}),mc({isAutoError:a,approveStore:o}),Ue({isAutoError:a},{quoteStore:e})};var Ve=class extends Kt{constructor(e){super();this.isEnableBridgeQuoteSearch=!0;this.bridgeListPending=!1;this.bridgeQuoteSelectStatus=0;this.bridgeFetchStatus=0;this.bridgeNoRouteTipStatus=0;this.compareVisible=!1;this.dialogGroupVisibleStatus=1;this.bridgeSortType=0;this.setBridgeSelectId=e=>{this.bridgeSelectId=e};this.setBridgeQuoteSelectStatus=e=>{this.bridgeQuoteSelectStatus=e};this.setBridgeFetchStatus=e=>{this.bridgeFetchStatus=e};this.setBridgeNoRouteTipStatus=e=>{this.bridgeNoRouteTipStatus=e};this.setBridgeList=e=>{this.bridgeList=e};this.setBridgeListPending=e=>{this.bridgeListPending=e};this.setBridgeSortType=e=>{this.bridgeSortType=e};this.setCompareVisible=e=>{this.compareVisible=e};this.setDialogGroupVisibleStatus=e=>{this.dialogGroupVisibleStatus=e};this.getQuoteData=({signal:e})=>{let o=Bi();return this.bridgeFetchStatus===0&&this.setBridgeFetchStatus(1),A(yt(()=>R.get(this.getQuoteStoreUrl(),{params:o,signal:e,isolate:!0}).then(r=>(this.setBridgeFetchStatus(2),this.handleUpdateQuote(r),this.setQuoteNumber(this.quoteNumber+1),this.quotePending=!1,r)).catch(r=>{throw E.stuff(r),r}),ft.NUM,ft.TIMER))};this.handleUpdateQuote=e=>{if(e){let{data:o}=e;aa(o)}};this.updateBestRoute=e=>{let o={...this.quote.bestRoute,...e};this.setQuote({...this.quote,bestRoute:o}),this.rootStore.fromToStore?.quoteUpdateFromTo(o)};this.handleQuoteError=(e=null)=>{this.setQuote({...this.initQuote,quoteError:e}),this.handleReverseQuoteErrorAndNull(),this.setBridgeFetchStatus(4)};$(this),Object.assign(this,e),this.rootStore=e}static async getInitialProps(){let[e,o]=await A(R.get(Gn));if(e)throw e;return T(o,"data",[]).map(s=>({platformId:s.chainId,logo:s.logoUrl}))}get bridgeList(){return this.initialPropsStore.initialProps.bridgeList||[]}get computedIsBridgeListLoading(){return so()?!this.bridgeList?.length:this.bridgeListPending}async getBridgeList(){this.setBridgeListPending(!0),await A(this.initialPropsStore.getInitialProps({key:"bridgeList",callee:Ve})),this.setBridgeListPending(!1)}getQuoteStoreUrl(){return Mn}},ca=xo(Ve);d();l();P();var fc="1",Sc="2",ua={minValue:.01,maxValue:.5},ma={minValue:.03,maxValue:.5},jt=class{constructor(t){n(this,"slippageSetting",{autoIsSelected:!1,inputSlippage:"",mode:Ft.DYNAMIC,level:xt.LOW,customMax:""});n(this,"configSingle",ua);n(this,"configCross",ma);n(this,"hasInit",!1);n(this,"inputCache","");n(this,"isFrozen",!1);n(this,"setFrozenInfo",({computedSafeMoonNotSupport:t,isCrossBridgeOnly:e})=>{this.isFrozen=t||e});this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,this.smartRouterStore=t.smartRouterStore,L(this,{},{autoBind:!0})}setInputCache(t){this.inputCache=t}getSafeMoonStore(){return this.rootStore.safeMoonStore}getOrderSlippageInfo(){let{autoIsSelected:t}=this.slippageSetting,e=Rt(this.rootStore);return t||this.isFrozen?{maxSlippage:this.computedRealCustomMaxSlippage,autoSlippageInfo:e}:{customSlippage:this.computedRealCustomSlippage,autoSlippageInfo:e}}get isSingleChain(){return this.rootStore.fromToStore.computedIsSingleChain}get minSlippage(){return this.isSingleChain?this.configSingle.minValue:this.configCross.minValue}get maxSlippage(){return this.isSingleChain?this.configSingle.maxValue:this.configCross.maxValue}get minSlippageShow(){return _.mul(this.minSlippage,100)}get maxSlippageShow(){return _.mul(this.maxSlippage,100)}get computedSupportCustomMax(){return T(Rt(this.rootStore),"supportMaxSlippage",!1)}get computedFixedSlippageLevelMap(){if(!this.isSingleChain)return null;let t=T(Rt(this.rootStore),"shortcutFixSlippage",Object.values(Es));return{low:bt(t[0]),medium:bt(t[1]),high:bt(t[2])}}get computedDynamicSlippageLimit(){let t=T(Rt(this.rootStore),"dynamicSlippageRangeMin",Re.DYNAMIC_MIN),e=T(Rt(this.rootStore),"dynamicSlippageRangeMax",Re.DYNAMIC_MAX),o=T(Rt(this.rootStore),"recommendSlippageRangeMin",Re.RECOMMEND_MIN),r=T(Rt(this.rootStore),"recommendSlippageRangeMax",Re.RECOMMEND_MAX);return{dynamicMin:bt(t),dynamicMax:bt(e),recommendMin:bt(o),recommendMax:bt(r)}}get computedAutoSlippage(){return Mo(this.rootStore)}get computedRealCustomSlippage(){let t=T(this,"slippageSetting.inputSlippage","");return t?Pe(t):""}get computedRealCustomMaxSlippage(){let t=T(this,"slippageSetting.customMax","");return t?Pe(t):""}get computedSafeMoonNotSupport(){let{computedHoneypot:t,computedSlippageTips:e}=this.getSafeMoonStore();return!!(t||e?.overLimit||e?.equalLimit)}get computedSafeMoonSlippage(){return this.getSafeMoonStore().computedSlippage}get computedSafeMoonTips(){return this.getSafeMoonStore().computedSlippageTips}get computedSafeMoonTip(){return this.getSafeMoonStore().computedSlippageTips?.tip}get computedSafeMoonPairSlippage(){return this.getSafeMoonStore().computedPairSlippage}get computedSlippageValue(){return this.getSlippageValue()}get computedRealSlippageValue(){let t=this.getSlippageValue();return Number(Pe(t))||0}isValidVolatilityTip(){if(Number(this.computedSlippageValue)>this.computedAutoSlippage)return!1;let t=this.getSafeMoonStore(),e=this.smartRouterStore;return t.computedSafeMoonToken===null&&!e?.isCrossBridgeOnly}get computedVolatilityTips(){if(!this.isValidVolatilityTip())return null;let{computedAutoSlippage:t}=this,e=this.rootStore?.quoteStore?.quote?.bestRoute||{},{priceFluctuationMonitorTime:o,priceFluctuationThreshold:r,fromPriceFluctuation:s,toPriceFluctuation:i,rateFluctuationThreshold:a,slippageFluctuationhold:u,rateFluctuation:m}=e,{from:p,to:g}=this.fromToStore,I=g?.tokenSymbol||"",b=p?.tokenSymbol||"",M=_.mul(u,100),B=_.mul(r,100),lt=_.mul(a,100),rt=Number(m),pt=Number(a);if(t>M){if(rt<pt)return null}else if(t===M){let Xt=Math.abs(s),Ot=Math.abs(i),ht=Number(r);if(Xt>ht&&Ot>ht)return{tip:h("swaptrade_placeorder_alert_both_volatility",{payToken:b,receiveToken:I,value:B,min:o}),tipEquation:h("swaptrade_placeorder_alert_both_volatility",{payToken:Q(b),receiveToken:Q(I),value:B,min:o})};if(Xt>ht)return{tip:h("swaptrade_placeorder_alert_pay_receive_volatility",{token:b,value:B,min:o}),tipEquation:h("swaptrade_placeorder_alert_pay_receive_volatility",{token:Q(b),value:B,min:o})};if(Ot>ht)return{tip:h("swaptrade_placeorder_alert_pay_receive_volatility",{token:I,value:B,min:o}),tipEquation:h("swaptrade_placeorder_alert_pay_receive_volatility",{token:Q(I),value:B,min:o})};if(rt>=pt)return{tip:h("swaptrade_settings_alert_both_exchange",{payToken:b,receiveToken:I,value:lt,min:o}),tipEquation:h("swaptrade_settings_alert_both_exchange",{payToken:Q(b),receiveToken:Q(I),value:lt,min:o})}}return null}getDefaultSetting(){let t={inputSlippage:"",autoIsSelected:!0,mode:Ft.DYNAMIC,level:xt.LOW,customMax:""},e=this.getSafeMoonStore();if(e.computedSafeMoonToken){let o=e.computedSlippage,r=cr(o);e.isChanged&&r&&(t.inputSlippage=r,t.autoIsSelected=!1,t.mode=Ft.FIXED,t.level=xt.CUSTOM,t.customMax="")}return t}getSlippageType(){return this.slippageSetting.autoIsSelected||this.isFrozen?Mt.AUTO:Mt.CUSTOM}getSlippageValue(t=this.slippageSetting){let{autoIsSelected:e,inputSlippage:o}=t;return e||this.isFrozen?this.computedAutoSlippage:o||this.computedAutoSlippage}setSlippageSetting(t){let e={...t},o=this.getSafeMoonStore(),{computedSafeMoonToken:r}=o,{computedIsSingleChain:s}=this.fromToStore;if(!r||s){this.slippageSetting=e;return}let i=this.getSlippageValue(e);if(i===this.getSlippageValue(this.slippageSetting)||o.isAccessSlippage(i)||!o.getSafemoonIsChangedLocal()){e.inputSlippage="",e.autoIsSelected=!0,e.mode=Ft.DYNAMIC,e.level=xt.LOW;let a=cr(i);o.isChanged&&a&&(e.inputSlippage=a,e.autoIsSelected=!1,e.mode=Ft.FIXED,e.level=xt.CUSTOM,e.customMax=""),o.setSafeMoonPairSlippage(i),this.slippageSetting=e}}async initSlippageConfigs(){this.hasInit=!0;try{let{data:t}=await R.get(Yn),e=t?.find(({configId:r})=>fc===r),o=t?.find(({configId:r})=>Sc===r);e&&(this.configSingle=e),o&&(this.configCross=o)}catch{this.configSingle=ua,this.configCross=ma}}initSlippageSetting(){let t=this.getDefaultSetting(),e;t?e={...t}:e={autoIsSelected:!0,inputSlippage:"",mode:Ft.DYNAMIC,level:xt.LOW,customMax:""},this.setSlippageSetting(e)}initReactions(){Tt(()=>{let{from:t,to:e}=this.fromToStore;return{chainId:t.chainId,toChainId:e.chainId,fromTokenAddress:t.tokenContractAddress,toTokenAddress:e.tokenContractAddress}},({fromTokenAddress:t,toTokenAddress:e})=>t&&e?(this.rootStore.quoteStore.slippageInfoFetched=!1,this.initSlippageSetting()):!1,{equals:ro.shallow}),Tt(()=>{let{computedSafeMoonPairSlippage:t}=this;return{computedSafeMoonPairSlippage:t}},()=>{this.initSlippageSetting()},{equals:ro.shallow}),Tt(()=>{let{quote:t}=this.rootStore.quoteStore,e=T(t,"bestRoute.smartRoutingMenuVoList"),o=T(e,[0,"smartRoutingMenuType"]),r=e&&e.length===1&&o===ni.BRIDGE,{computedSafeMoonNotSupport:s}=this;return{computedSafeMoonNotSupport:s,isCrossBridgeOnly:r}},this.setFrozenInfo,{equals:ro.shallow})}get computedMinimumReceived(){let{quote:t,computedIsOfflineType:e}=this.rootStore.quoteStore,{receiveAmount:o,minimumReceived:r}=t?.bestRoute||{},s=this.fromToStore.to?.tokenSymbol;if(!kt(o))return"--";let i=this.inputCache?Pe(this.inputCache):this.computedRealSlippageValue,a=e?r:_.mul(o,1-(kt(i)?i:0));return _.BigNumber(a).lte(0)?"--":`${At(a,{needBillionMillionUnit:!1})} ${s}`}get computedMinimumReceivedIsOrange(){let{quote:t}=this.rootStore.quoteStore,e=this.computedMinimumReceived,o=t?.bestRoute?.receiveAmount,r=_.BigNumber(o);return!r.isZero()&&!r.isNaN()&&_.div(_.sub(r,e),r)>=.1}};d();l();P();var jr=class{constructor(t){n(this,"checkCrossChainParams",()=>{let{quoteStore:t,receiveAddressStore:e}=this.rootStore,{quote:o}=t,r=this.checkCommonParams(),{receiveAddrObj:s}=e,i=T(o.bestRoute,"quoteNetWorkFeeOfMoney"),a=o?.bestRoute?.bridge?.bridgeId,u=s?.specifiedAddress;return{...r,fromSwapFeeUsd:i,bridgeId:a,receiveWalletAddress:u}});n(this,"checkCommonParams",()=>{let{accountStore:t,fromToStore:e,quoteStore:o}=this.rootStore,{from:r,to:s}=e;return{fromChainId:r.chainId,fromTokenAddress:r.tokenContractAddress,amount:o?.computedQuoteAmount,toChainId:s.chainId,toTokenAddress:s.tokenContractAddress,userWalletAddress:t.address,accountId:t.computedAccountId}});n(this,"repeatOrder",null);n(this,"checkRepeatOrder",async()=>{this.repeatOrder=null;let{fromChainId:t,...e}=this.checkCommonParams(),{quoteStore:{quote:o}}=this.rootStore,r=T(o.bestRoute,"fromSwapFeeUsd"),s={...e,chainId:t,fromSwapFeeUsd:r},[i,a]=await A(R.get(Vn,{params:s}));!i&&[Ce.COMMON_REPEAT,Ce.BTC_REPEAT].includes(a?.data.repeatFlag)&&st(()=>{let{orderId:u,enoughFlag:m}=a?.data??{};this.repeatOrder={enoughFlag:m,repeatFlag:a?.data.repeatFlag,id:u}})});n(this,"checkSwapMoreInfo",null);n(this,"checkCrossChainSwap",async()=>{this.checkSwapMoreInfo=null;let t=this.checkCrossChainParams(),[e,o]=await A(R.post(Wn,{...t}));e||st(()=>{this.checkSwapMoreInfo=o?.data})});L(this),this.rootStore=t}},sr=jr;d();l();var $t=class{constructor(t){n(this,"swapOnDappBtnLoading",!1);n(this,"setSwapOnDappBtnLoading",t=>{this.swapOnDappBtnLoading=t});n(this,"dappPanelVisible",!1);n(this,"setDappPanelVisible",t=>{this.dappPanelVisible=t});n(this,"showDappPanel",()=>{this.setSwapOnDappBtnLoading(!0),this.setDappPanelVisible(!0)});n(this,"hideDappPanel",()=>{this.setSwapOnDappBtnLoading(!1),this.setDappPanelVisible(!1)});n(this,"getSupportDetail",(t={},e=!1)=>{let o=this.chainIsSupportMarket(t),r=this.chainIsSupportDappTrade(t),s=!!this.quoteStore?.computedSupportDappTradeByQuote,i=!o&&r,a=o&&r,u=o&&!r;return{chainSupportMarket:o,chainSupportDappTrade:r,quoteSupportDappTrade:s,balance:a||u,kline:a||u,klineJumpMarket:a||u,costValue:e&&a||u,valueDifference:u,liquidity:u,disableInput:i||a,showMax:u,showAddFund:u}});n(this,"mergeCurrencyInputProps",(t,e)=>({balanceStatus:e.balance?t.balanceStatus:So.BALANCE_NOT_SHOW,costValue:e.costValue?t.costValue:"",valueDifference:e.valueDifference?t.valueDifference:{},disableInput:e.disableInput,showMax:e.showMax?t.showMax:!1,showMaxIcon:e.showMax?t.showMaxIcon:!1,showAddFund:e.showAddFund?t.showAddFund:!1}));n(this,"getCurrentFromToChainConfig",()=>{let t=this.fromToStore.from.chainId,e=this.fromToStore.to.chainId,o=this.commonStore.getChainByID(t),r=this.commonStore.getChainByID(e);return[o,r]});n(this,"chainIsSupportMarket",t=>Number(t?.isSupportMarket)===1);n(this,"chainIsSupportDappTrade",t=>Number(t?.isSupportDappTrade)===1);n(this,"bridgeSupportDappTrade",t=>Number(t?.supportLinkDapp)===1);n(this,"getSupportDappTradeByToken",()=>{let t=this.quoteStore?.computedSupportDappTradeByQuote,e=No?.computedIsSelectedAllDex;return this.fromToStore.computedIsSingleChain&&t&&e});n(this,"checkShouldJumpToDapp",()=>this.fromToStore.computedFormToTokenIsLeverageToken?!1:this.computedSupportDappTradeByChain?!0:this.getSupportDappTradeByToken());this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,this.quoteStore=t.quoteStore,L(this,{},{autoBind:!0})}get computedFromToSupportMarketAndDappTrade(){let[t,e]=this.getCurrentFromToChainConfig();return{from:{...this.getSupportDetail(t,!0)},to:{...this.getSupportDetail(e)}}}get computedFromToSupportMarket(){let[t,e]=this.getCurrentFromToChainConfig();return this.chainIsSupportMarket(t)&&this.chainIsSupportMarket(e)}get computedSupportDappTradeByChain(){let t=this.fromToStore.from.chainId,e=this.fromToStore.to.chainId,o=this.commonStore.getChainByID(t);if(this.fromToStore.computedIsSingleChain)return this.chainIsSupportDappTrade(o);let r=o?.bridgeSupportChainInfoList,s=Array.isArray(r)&&r.find(i=>Number(i.chainId)===Number(e));return this.bridgeSupportDappTrade(s)}};d();l();P();var We=class{constructor(){this.serviceStatus=null;L(this)}get maintenanceChainsMap(){return this.serviceStatus?zt(this.serviceStatus?.maintenanceChains,"chainID")??{}:{}}async init(){if(this.serviceStatus!==null&&this.serviceStatus.maintenanceChains?.length===0)return;let t=await ai();st(()=>{this.serviceStatus={...t}}),ii.setServiceState(t)}};d();l();d();l();var He=class extends Go{constructor(){super(...arguments);this.sendTransactionOrUpdateHash=e=>(E.info(O.UPDATE_HASH,{...e,tags:{orderId:e.orderId,status:e?.status||1}}),R.post(Un,e).catch(o=>{E.info(O.UPDATE_HASH_ERROR,{...e,error:o,tags:{orderId:e.orderId}})}));this.extendSaveOrderParams=e=>{let{computedQuote:o}=this,{receiveAddressStore:r}=this.rootStore,{to:s}=this.rootStore.fromToStore,{receiveAddrObj:i}=r,{fromDexRouterList:a,bridge:u,toDexRouterToList:m,originFromDexRouterList:p}=o.bestRoute||{};return{...e,gasDropType:0,toChainId:s.chainId,crossChainDexRouter:{fromDexRouterList:a,toDexRouterToList:m,bridge:u,originFromDexRouterList:p},receiveWalletAddress:i?.specifiedAddress}};this.onGenerateCallData=e=>{let o={...e,...Uo()};return E.info(O.SAVE_ORDER_PARAMS,{data:o}),R.post(Qn,o)};this.isSwapSolana=()=>!1;this.cancelOrder=e=>{e&&(E.info(O.CANCEL_ORDER,{tags:{orderId:e},data:{type:"bridge"}}),R.get(Xn,{params:{id:e}}))}}};var Ye=class extends He{constructor(e){super(e);this.sendTransactionEnhance=e=>{let{from:o}=this.rootStore?.fromToStore,{walletSendParams:r}=this.rootStore.walletContractStore;return this.rootStore.sendTransactionStore.sendTransaction(o.chainId,e,r).then(s=>wo(o.chainId,s))};this.showRecentTransactionModal=e=>{this.isConfirmLoading=!1,this.confirmSwapVisible=!1,E.stuff(`orderId: ${e}`),v.history.go(-1);let{advanceSetTypedValue:o}=this.rootStore?.fromToStore;o?.("")};this.baseSaveOrderParams=()=>({...super.baseSaveOrderParams()});this.extendsGas=e=>{let o={...e},{gasInfo:r}=this.rootStore.walletContractStore,{gasLimitInfo:s,isGasLimitLoading:i,gasType:a,...u}=r;return o.extParams.gasType=a,{...o,gasInfo:u}};this.extendTronParams=e=>{let o={...e},{maxGasFeeInt:r}=this.rootStore.walletContractStore;return o.maxGasFeeInt=r,o};this.onWalletFail=(e,o)=>{this.isConfirmLoading=!1,!e?.message?.includes(v.global?.HARDWALLETERROR)&&super.onWalletFail(e,o)};this.checkRepeatOrderDetail=e=>{e&&v.history.push(`${io}/${e}`)};this.onSwap=async e=>{let{computedIsOfflineType:o}=this.rootStore.quoteStore;o?await this.rootStore.intentSwapStore?.onIntentSwap():await super.onSwap(e)};this.getSaveOrderMonitorData=()=>({...W(),...this.rootStore.walletContractStore.computedMonitorGasType});this.isSwapSolana=()=>!1;this.onClaim=e=>{v.history.push(`${te}?orderId=${e.orderId}&source=orderDetail`)};$(this,{},{autoBind:!0})}isOkxWallet(){return!0}getTransaction(){}walletErrorMessage(e){return e}get walletSendParams(){return this.rootStore.walletContractStore.walletSendParams}};var le=class extends Gt{constructor(){super();n(this,"reset",()=>{this.receiveAddressStore=new qo(this),this.outerStore=new nr(this),this.fromToStore=new Bo(this),this.approveStore=new Vt(this),this.quoteStore=new ca(this),this.tokenModalStore=new er(this),this.safeMoonStore=new Yt(this),this.walletContractStore=new zo(this),this.sendTransactionStore=new Qo(this),this.intentSwapStore=new Jo(this),this.swapCheckStore=new sr(this),this.swapStore=new Ye(this),this.swapBtnStore=new Wt(this),this.mevStore=new rr(this),this.recentTransactionStore=new Wo(this),this.swapDappStore=new $t(this),this.smartRouterStore=new Yo(this),this.slippageStore=new jt(this),this.oneMoreOrderStore=new Vo(this),this.gasDropStore=new or,this.swapServStatusStore=new We,this.chainMaintanceStore=new Qe({swapServStatusStore:this.swapServStatusStore,chainIdList:mn(()=>{let{from:e,to:o}=this.fromToStore;return an([e.chainId,o.chainId].filter(Boolean))})})});this.reset()}},Ke=le;n(Ke,"instance",null),n(Ke,"getInstance",()=>(le.instance||(le.instance=new le),le.instance));var la=Ke;d();l();d();l();var ir=class extends Ht{constructor(t){super(t),$(this)}getSearchParams(t){return this.singleSearchParams(t)}};d();l();P();d();l();P();var gc=c=>{let{quoteStore:t,swapStore:e}=w();!c&&t.aggregateSelectStatus!==0&&(t.setAggregateNoRouteTipStatus(e.confirmSwapVisible?2:1),t.setAggregateSelectStatus(0))},Tc=c=>{let{quoteStore:t}=w(),e=c?.find(i=>i.defiPlatformId===at),o=t.aggregateSelectId===et?e:c?.find(i=>i.defiPlatformId===t.aggregateSelectId),r=T(e,"dexRouterList",[]);gc(o);let s=c?.[0]||{};return Nt({},o||s,{dexRouterList:r})},Cc=({data:c,isCompareResult:t})=>{let{commonDexInfo:e,swapType:o,isSupportDappTrade:r,defiPlatformInfoList:s,traceData:i}=c,a=s?.map((g,I)=>({...g,isBest:I===0}));return{bestRoute:{...s?.[0]||{},...e||{},isSupportDappTrade:t?r:"0",swapType:o,defiPlatformInfoList:a,traceData:i}}},Ic=({bestRoute:c,aggregateInfo:t,isAutoError:e,networkFeeInfo:o,jitoData:r,commonDexInfo:s},{fromToStore:i,quoteStore:a})=>{let u=Nt({},c,t);a.updateSlippageInfoFetched(u),a.setAggregateSelectId(u.defiPlatformId),a.setQuote({...a.quote,bestRoute:u,quoteNull:e,quoteError:null,isFetchQuoting:!1,networkFeeInfo:o,jitoData:r,commonDexInfo:s}),e&&a.setAggregateFetchStatus(4),i.quoteUpdateFromTo(u)},_c=c=>{let{solanaPriorityFeeStore:t}=w();t&&c?.jitoData&&t.setJitoData(c?.jitoData)},pa=c=>{let{fromToStore:t,quoteStore:e,approveStore:o}=w(),r=e.aggregateFetchStatus===3,{bestRoute:s}=Cc({data:c,isCompareResult:r}),i=Tc(s.defiPlatformInfoList),a=r&&s.defiPlatformInfoList?.length===0;e.setQuoteNumber(e.quoteNumber+1);let{networkFeeInfo:u,jitoData:m,commonDexInfo:p}=c;Ic({bestRoute:s,aggregateInfo:i,isAutoError:a,networkFeeInfo:u,jitoData:m,commonDexInfo:p},{fromToStore:t,quoteStore:e}),_c(c),Yr(c),Hr({isAutoError:a},{approveStore:o}),Ue({isAutoError:a},{quoteStore:e})};d();l();function ha({quoteParams:c,serviceStateError:t}){if(t||!c||!kt(c.amount)||!c.fromTokenAddress||!c.chainId||!c.toTokenAddress||!c.slippageConfig?.slippageType)return!1;let{slippageType:e,slippage:o}=c.slippageConfig;return!(e===Mt.CUSTOM&&!kt(o))}var je=class extends Kt{constructor(e){super();this.enableQuoteAggregates=!0;this.setAggregateSelectId=e=>{this.aggregateSelectId=e};this.aggregateSelectStatus=0;this.setAggregateSelectStatus=e=>{this.aggregateSelectStatus=e};this.aggregateFetchStatus=0;this.setAggregateFetchStatus=e=>{this.aggregateFetchStatus=e};this.cleanQuoteTimerAndCancelQuote=()=>{clearTimeout(this.quoteTimer),this.quoteTimer=null,this.cancelRef&&this.cancelRef.abort()};this.clearQuote=()=>{this.quoteScope=null,this.cleanQuoteTimerAndCancelQuote(),this.setQuote(this.initQuote),this.rootStore.fromToStore?.quoteUpdateFromTo(null),this.quotePending=!1,this.setAggregateSelectId(et),this.setAggregateSelectStatus(0),this.setAggregateFetchStatus(0)};this.fetchQuoteStart=({quoteSource:e,isPolling:o})=>{o||(this.quotePending=!0),e===0&&!o&&(this.setAggregateSelectStatus(0),this.setAggregateFetchStatus(1)),!_t()&&!o&&e===0&&this.setAggregateSelectId(et),this.cleanQuoteTimerAndCancelQuote(),this.setQuote({...this.quote,isFetchQuoting:!0})};this.fetchQuoteEnd=(e,o)=>{this.quotePending=!1,!gt(e)&&e&&this.handleQuoteError(e),this.defiPlatformChangeAlert({defiPlatformId:this.aggregateSelectId,preDefiPlatformName:this.quote.bestRoute?.name,quoteRes:o}),this.handleUpdateQuote(o),this.setIsPickRouterFromWallet(!1),this.rootStore.commonStore.setResetFromToByTabChange(!1)};this.stopIntervalQuote=!1;this.setStopIntervalQuote=e=>{this.stopIntervalQuote=e};this.pollingQuote=({quoteParams:e,error:o})=>{!gt(o)&&!this.dialogCloseFlag&&(this.quoteTimer=setTimeout(()=>{this.fetchQuote({...e,config:{...e.config,isPolling:!0}}).catch(()=>{})},Ie))};this.fetchQuote=async e=>{let{params:o,config:r={}}=e||{},{quoteSource:s,serviceStateError:i,isPolling:a}=r;if(!ha({quoteParams:o,serviceStateError:i}))return this.clearQuote(),E.error(O.SWAP_QUOTE_PARAMS_ERROR,{quoteParams:e}),Promise.resolve(!1);if(this.stopIntervalQuote)return this.pollingQuote({quoteParams:e}),Promise.resolve(!1);this.fetchQuoteStart({quoteSource:s,isPolling:a}),this.cancelRef=Et();let[m,p]=await this.getQuoteData({signal:this.cancelRef.signal,params:o,quoteSource:s,isPolling:a});return this.fetchQuoteEnd(m,p),this.pollingQuote({quoteParams:e,error:m}),Promise.resolve(!0)};this.debouncedFetchQuote=Ze(e=>this.fetchQuote(e),Eo);this.fetchQuoteDebounce=async e=>{this.debouncedFetchQuote(e)};this.fetchOKXQuote=({params:e,signal:o})=>{ie({...e,liquidityConfig:{...e.liquidityConfig,defiPlatformIds:at}},{signal:o}).then(r=>{this.aggregateFetchStatus===1&&(this.setAggregateFetchStatus(2),this.handleUpdateQuote(r),this.setQuoteNumber(this.quoteNumber+1),this.quotePending=!1)}).catch(r=>{E.stuff(r)})};this.getQuoteData=async({params:e,signal:o,quoteSource:r,isPolling:s})=>{let i=r===0&&!s,{media:a}=Po(),u=a!=="sm"&&a!=="md",m=Vs();return!_t()&&i&&u&&!m&&this.fetchOKXQuote({params:e,signal:o}),A(yt(()=>this.fetchAggregatesQuote({params:e,signal:o}),ft.NUM,ft.TIMER))};this.handleUpdateQuote=e=>{if(e){let{data:o}=e;pa(o)}};this.updateBestRoute=e=>{let o=e||{},r={...this.quote.bestRoute,...o};this.setQuote({...this.quote,bestRoute:r}),this.rootStore.fromToStore?.quoteUpdateFromTo(r)};this.aggregateNoRouteTipStatus=0;this.setAggregateNoRouteTipStatus=e=>{this.aggregateNoRouteTipStatus=e};this.handleQuoteError=(e=null)=>{this.setQuote({...this.initQuote,quoteError:e}),this.handleReverseQuoteErrorAndNull(),this.setAggregateFetchStatus(5)};this.aggregatorListPending=!1;this.setAggregatorListPending=e=>{this.aggregatorListPending=e};this.fetchAggregatorList=async()=>{this.setAggregatorListPending(!0),await A(this.initialPropsStore.getInitialProps({key:"aggregatorList",callee:je})),this.setAggregatorListPending(!1)};this.compareVisible=!1;this.setCompareVisible=e=>{this.compareVisible=e};this.dialogGroupVisibleStatus=1;this.setDialogGroupVisibleStatus=e=>{this.dialogGroupVisibleStatus=e};$(this),Object.assign(this,e),this.rootStore=e}static async getInitialProps(){let[e,o]=await A(R.get(xn));if(e)throw e;return T(o,"data",[]).map(s=>({platformId:s.platformId,logo:s.logo}))}defiPlatformChangeAlert({defiPlatformId:e,preDefiPlatformName:o,quoteRes:r}){e!==et&&r?.data?.defiPlatformInfoList&&!r.data.defiPlatformInfoList.find(s=>s.defiPlatformId===e)&&dr.warn({title:dn("swaptrade_swap_dialog_desc_provider_path_error",{name:o}),placement:dr.DIRECTION.top})}fetchAggregatesQuote({params:e,signal:o}){return ie(e,{signal:o}).then(r=>(this.aggregateFetchStatus===2&&this.setAggregateSelectId(et),this.setAggregateFetchStatus(3),r))}get aggregatorList(){return this.initialPropsStore.initialProps.aggregatorList||[]}get computedIsAggregatorListLoading(){return so()?!this.aggregatorList?.length:this.aggregatorListPending}get computedPriorityFeeInfo(){let e=T(this,"quote.networkFeeInfo.normal",{})??{},o=T(this,"quote.networkFeeInfo.mev.[0]",{})??{},r=wr(e);return{mevPriorityFeeInfo:wr(o),nonMevPriorityFeeInfo:r}}get computedNotLiquidity(){return this.quote.quoteError&&this.quote.quoteError?.code===tt.NOT_LIQUIDITY}get computedQuoteError(){return!!this.quote.quoteError}get computedQuoteNetworkError(){return this.quote.quoteError&&this.quote.quoteError?.status===tt.ERR_NETWORK}get computedSupportDappTradeByQuote(){return this.quote.quoteError&&this.quote.quoteError?.code===tt.JUMP_TO_DAPP}get computedQuoteSafemoon(){let e=T(this.quote,"commonDexInfo.fromToken",{}),o=T(this.quote,"commonDexInfo.toToken",{});return Number(e?.isSafeMoonToken)===1?e?.tokenSymbol:Number(o?.isSafeMoonToken)===1?o?.tokenSymbol:""}get computedQuoteIsNewAddress(){return this.quote.quoteError&&this.quote.quoteError?.code===tt.NEW_ADDRESS_ERROR_CODE}get computedQuoteErrorMsg(){return this.quote.quoteError?.error_message||this.quote.quoteError?.message||this.quote.quoteError?.detailMsg}},fa=xo(je);d();l();d();l();P();var $r=c=>{if(!c)return[];let{solPrice:t,solTokenSymbol:e,solDecimals:o}=c;return br.map(r=>({type:r,fee:c[`${r}Fee`],usd:c[`${r}FeeUsd`],solPrice:t,solTokenSymbol:e,solDecimals:o}))},Sa=c=>{let t={},e=zt($r(c),"type");return on(br).forEach(o=>{t[o]={amount:e[o]?.fee||"",price:e[o]?.usd||""}}),t};var Xr=class{constructor(t){n(this,"visible",!1);n(this,"setVisible",t=>{this.visible=t});n(this,"feeType",be.MARKET);n(this,"setFeeType",t=>{this.feeType=t});n(this,"customFee",null);n(this,"setCustomFee",t=>{this.customFee=t});n(this,"jitoData",null);n(this,"setJitoData",t=>{this.jitoData=t});this.rootStore=t,$(this)}get computedPriorityFeeList(){return $r(this.jitoData)}get computedPriorityFeeMap(){return Sa(this.jitoData)}get computedPriorityFeeAmount(){return this.jitoData?this.feeType===be.CUSTOM?this.customFee:this.computedPriorityFeeList.find(e=>e.type===this.feeType)?.fee:null}get computedPriorityFeeOfUsd(){if(!this.jitoData)return null;let{solPrice:t}=this.jitoData;return _.mul(this.computedPriorityFeeAmount,t,{returnString:!0})}},ga=Xr;d();l();d();l();Aa();d();l();P();d();l();d();l();var zr=class{constructor(){this.mevList=[];this.setMevList=t=>{this.mevList=t};this.getMevList=()=>this.mevList;L(this)}},Jr=new zr;var Zr=class{constructor(){this.fetchMevList=async()=>{let[t,e]=await A(yt(()=>R.get(ss)));return!t&&e?.data?.length?(Jr.setMevList(e.data),e.data):(E.error(O.GET_MEV_LIST_ERROR,{error:t,data:e}),[])};this.getMevList=async t=>{let e=Jr.getMevList();(!e||!e.length)&&(e=await this.fetchMevList());let r=(e||[]).filter(s=>s.chainIds&&s.chainIds.includes(t)).map(s=>s.supplier);if(r.length)return r}}},Ta=new Zr;var Ac=async({mevConfig:c,chainId:t})=>T(c,"enableMev")?yo(t)?{enableMev:!0,mevSuppliers:T(c,"mevSuppliers")}:{enableMev:!0,mevSuppliers:await Ta.getMevList(Number(t))}:{enableMev:!1},Ca=Ac;var $e=class extends Go{constructor(){super(...arguments);this.sendTransactionOrUpdateHash=async e=>{let{transactionHash:o,orderData:r,...s}=e;if(r?.approveTxInfo){let{mevSuppliers:i}=await Ca({mevConfig:r.mevConfig,chainId:r.swapParams.chainId});return Ds({...s,mevSuppliers:i,userWalletAddress:this.rootStore.accountStore.address,walletId:this.rootStore.accountStore.computedAccountId,chainId:r.swapParams.chainId})}return Ns({signedInfoList:[{txHash:o}],...s,userWalletAddress:this.rootStore.accountStore.address,walletId:this.rootStore.accountStore.computedAccountId,orderId:e.orderId})};this.extendEvmParams=(e,o=!1)=>{let r=super.extendEvmParams(e),s=this.rootStore?.quoteStore?.quote?.bestRoute?.isEnableMev;return r.extParams.isMev=o,!o&&Number(s)===Ao.ON&&(r.extParams.isShowBlockSwapMevTooltip=!0),r};this.extendSaveOrderParams=async e=>{let o={...e},{computedQuote:r}=this,{originDexRouterList:s,dexRouterList:i,serviceFeeInfo:a,quoteData:u,isEnableMev:m}=r.bestRoute||{},{supportCustomGasFee:p,feeType:g}=dt;if(o.mevInfo=dt.getMevInfo(m),p){let I=_t();o.priorityFeeType=I?js[g]:g,o.priorityFee=dt.computedPriorityFeeAmount,o.chainId===_e.X_LAYER_MAINNET&&(o.gasPrice=String(dt.computedPriorityFeeAmount))}return{...o,dexRouterList:i,originDexRouterList:s,serviceFeeInfo:a,referralCommissionJsVersion:Cs,quoteData:u}};this.onGenerateCallData=e=>{let o={...e,...Uo()};return E.info(O.SAVE_ORDER_PARAMS,{data:o}),we(o)};this.extendSolanaCalldata=e=>{let o=dt.feeType===be.CUSTOM;return{...e,tradeMode:2,customPriorityFee:o}};this.getSolanaCalldata=e=>(this.setSolanaSwapParams(e),A(this.onGenerateCallData(e)));this.onSolanaSwap=async e=>{let o=this.extendSolanaCalldata(e),[r,s]=await this.getSolanaCalldata(o);if(r){this.saveOrderError(r);return}E.info(O.SAVE_ORDER,{data:s?.data,tags:{orderId:s?.data.orderId}}),Ee({...W(),order_id:s?.data.orderId,wallet_type:this.rootStore.accountStore.walletConfig?.walletType}),this.checkCallData({chainId:e.chainId,responseData:s?.data,requestParams:o}).catch(()=>{}),await this.solanaTransaction(s.data,o)};this.isSwapSolana=e=>yo(e);this.solanaTransaction=async(e,o)=>{let{from:r}=this.rootStore.fromToStore,{computedAccountId:s}=this.rootStore.accountStore,u=(await Do(r,{orderData:e,extParams:{}},this).jitoTransaction()).map(g=>g.payload.transaction);this.walletSignConfirming=!0;let[m,p]=await A(Is({transactions:u}));if(this.walletSignConfirming=!1,m){this.onWalletFail(m,e?.orderId),this.isConfirmLoading=!1,E.removeKeep();return}await this.sendSolanaTransaction({signedTransactions:p,swapParams:o,walletId:s,orderData:e})};this.sendSolanaTransaction=async({signedTransactions:e,swapParams:o,walletId:r,orderData:s})=>{let[i,a]=await A(di({signedTransactions:e,swapParams:o,walletId:r,orderData:s}));if(this.isConfirmLoading=!1,E.removeKeep(),i){lr.error({title:i?.error_message||h("swaptrade_home_toast_initiation_error"),placement:lr.DIRECTION.top});return}let u=T(a,"data.orderId"),m=T(a,"data.transactionHash");this.afterTransaction(u,{txHash:m,chainId:o.chainId,txType:"SWAP"}),this.logVerifyCallDataResult({txHash:m,orderId:u})};this.cancelOrder=e=>{e&&(E.info(O.CANCEL_ORDER,{tags:{orderId:e},data:{type:"swap"}}),R.get($n,{params:{id:e}}))}}};var Xe=class extends $e{constructor(e){super(e);this.sendTransactionEnhance=e=>{let{from:o}=this.rootStore?.fromToStore,{walletSendParams:r}=this.rootStore.walletContractStore;return this.rootStore.sendTransactionStore.sendTransaction(o.chainId,e,r).then(s=>wo(o.chainId,s))};this.showRecentTransactionModal=e=>{this.isConfirmLoading=!1,this.confirmSwapVisible=!1,E.stuff(`orderId: ${e}`),v.history.go(-1);let{advanceSetTypedValue:o}=this.rootStore?.fromToStore;o?.("")};this.baseSaveOrderParams=()=>({...super.baseSaveOrderParams()});this.extendsGas=e=>{let o={...e},{gasInfo:r}=this.rootStore.walletContractStore,{gasLimitInfo:s,isGasLimitLoading:i,gasType:a,...u}=r;return o.extParams.gasType=a,{...o,gasInfo:u}};this.extendEvmParams=(e,o=!1)=>{let r={...e},{activityId:s}=this.rootStore.walletContractStore,i=this.rootStore.quoteStore.quote?.bestRoute?.isEnableMev;s&&(r.extParams.activityId=s);let{computedIsMevOpen:a,mevInfo:u,walletMevControl:m}=this.rootStore.mevStore;return r.extParams.isMev=a||m||o,r.extParams.mevInfo=u,!o&&Number(i)===Ao.ON&&(r.extParams.isShowBlockSwapMevTooltip=!0),r};this.extendTronParams=e=>{let o={...e},{maxGasFeeInt:r}=this.rootStore.walletContractStore;return o.maxGasFeeInt=r,o};this.onWalletFail=(e,o)=>{this.isConfirmLoading=!1,!e?.message?.includes(v.global?.HARDWALLETERROR)&&super.onWalletFail(e,o)};this.checkRepeatOrderDetail=e=>{e&&v.history.push(`${io}/${e}`)};this.onSwap=async e=>{let{computedIsOfflineType:o}=this.rootStore.quoteStore;o?await this.rootStore.intentSwapStore?.onIntentSwap():await super.onSwap(e)};this.getSaveOrderMonitorData=()=>({...W(),...this.rootStore.walletContractStore.computedMonitorGasType});this.onClaim=e=>{v.history.push(`${te}?orderId=${e.orderId}&source=orderDetail`)};$(this,{},{autoBind:!0})}isOkxWallet(){return!0}getTransaction(){}walletErrorMessage(e){return e}get walletSendParams(){return this.rootStore.walletContractStore.walletSendParams}};var pe=class extends Gt{constructor(){super();n(this,"reset",()=>{this.receiveAddressStore=new qo(this),this.outerStore=new nr(this),this.fromToStore=new Bo(this),this.approveStore=new Vt(this),this.quoteStore=new fa(this),this.tokenModalStore=new ir(this),this.safeMoonStore=new Yt(this),this.walletContractStore=new zo(this),this.sendTransactionStore=new Qo(this),this.intentSwapStore=new Jo(this),this.swapCheckStore=new sr(this),this.swapStore=new Xe(this),this.swapBtnStore=new Wt(this),this.solanaPriorityFeeStore=new ga(this),this.mevStore=new rr(this),this.recentTransactionStore=new Wo(this),this.swapDappStore=new $t(this),this.smartRouterStore=new Yo(this),this.slippageStore=new jt(this),this.oneMoreOrderStore=new Vo(this)});this.reset()}},ze=pe;n(ze,"instance",null),n(ze,"getInstance",()=>(pe.instance||(pe.instance=new pe),pe.instance));var Ia=ze;var kc=({localeData:c,...t})=>{mi();let e=(0,_a.useLocation)(),o;return e.pathname.includes(ot)?o=k.BRIDGE:e.pathname.includes(kn)?o=k.LIMIT_ORDER:e.pathname===X&&(o=k.SWAP),ar.default.createElement(Us,{localeData:c,isDev:!0,noRemoteData:!0,customRender:r=>r},ar.default.createElement(hi,{swapRootStore:Ia,bridgeRootStore:la,initTab:o},ar.default.createElement(xi,{currentTab:o,...t})))},aA=ut(kc);export{aA as default};
//# sourceMappingURL=Advanced-YPBNJ2RN.js.map
