import{a as F}from"./chunk-5T4URYBB.js";import{a as v}from"./chunk-KZDRRGNV.js";import{h as H}from"./chunk-JVJHSYZS.js";import{a as y}from"./chunk-IFGNGASP.js";import{Sa as W,ob as R,zc as w}from"./chunk-NPJCEXXH.js";import{u as O,w as b}from"./chunk-4HHTYYQM.js";import{a as M}from"./chunk-DSO47LPO.js";import{f as N,h as o,o as T,p as u,q as m}from"./chunk-LHDKEQAM.js";T();m();var D=N(M());T();m();var C=N(M());T();m();T();m();var P=class{constructor({orderData:a,extParams:t},e){o(this,"walletNoNeedExtParams",!1);o(this,"differentiatedEnvironment",a=>R()&&a.length>1&&!this.walletNoNeedExtParams&&!a[0].params?[{...a[0],extParams:a[1]}]:a);this.orderData=a,this.calldataType=a.calldataType,this.extParams=t||{},this.swapStore=e}get isTransferType(){return this.calldataType===W.TRANSFER}};var V=["nonce","gas","gasPrice","maxFeePerGas","maxPriorityFeePerGas","priorityFee","value"],I=n=>V.reduce((a,t)=>((n[t]||n[t]===0)&&(a[t]=v(n[t],"0x")),a),n),h=class extends P{constructor(){super(...arguments);o(this,"valueToHex",(t,e="")=>`${e}${y.BigNumber(t).toString(16)}`);o(this,"formatContractPayload",({needGasPrice:t,isSilentSign:e=!1}={})=>{let{orderData:r}=this,{priorityFee:c,maxFeePerGas:i,maxPriorityFeePerGas:l,gasPrice:s,gas:x,hasReferralCommission:g,...p}=r?.callData||{},d=p;return t&&(d={...r?.callData,gasLimit:x}),r?.approveTxInfo&&(d=I({...r?.callData})),e&&(d=I(d)),d});o(this,"formatTransferPayload",()=>{let{orderData:t}=this;return t.callData});o(this,"getSendTransactionParams",async({needGasPrice:t=!1,isSilentSign:e=!1}={})=>{let{payload:r}=await this.preExecution({needGasPrice:t,isSilentSign:e});return F&&r.value&&(r.value=v(r.value)),this.differentiatedEnvironment([r])});o(this,"preExecution",async({needGasPrice:t,isSilentSign:e=!1}={})=>{let{orderData:r}=this,{mevConfig:c}=r,i;this.isTransferType?i=this.formatTransferPayload():i=this.formatContractPayload({needGasPrice:t,isSilentSign:e});let{extendEvmParams:l,extendsGas:s}=this.swapStore;return i.extParams=this.extParams,s&&(i=s(i)),i=l(i,c?.enableMev??!1),{payload:i}})}};o(h,"chainId",w.ETHEREUM_MAINNET);var rt=h;var Y=n=>{if(!n)return"0";let{BigNumber:a}=y,t=new a("365.25").div(2).multipliedBy(2);return new a("19.055441478439427").multipliedBy(n).multipliedBy(t).div(10**9).toFixed(9)},L=async(n,a={})=>{let{data:t,accountLength:e,bizType:r,bizId:c,from:i,to:l}=n,s=Y(e);if(a.encoding==="base64")return{payload:{bizType:r,bizId:c,transaction:{transaction:t,encoding:"base64"}},inputData:t,from:i,to:l,rent:s};let{transaction:x,version:g}=await G(t);return{payload:{bizType:r,bizId:c,transaction:x,version:g},inputData:t,from:i,to:l,rent:s}},mt=async(n,a={})=>{try{let t=JSON.parse(n);return t.array?await Promise.all(t.array.map(e=>L(e,a))):await Promise.all([t].map(e=>L(e,a)))}catch(t){return Promise.reject(t)}};function j(n){return"txHash"in n&&"signedTx"in n&&typeof n.txHash=="string"&&typeof n.signedTx=="string"}async function ft(n,a){let{isMemeMode:t=!1,isWidgetEnv:e=!1,isWallet:r=!1,isWalletInstantTrade:c=!1}=a||{},i=n.map(s=>{if(j(s))return{txHash:s.txHash,signature:s.signedTx};if(t&&r||e||c){let S=s;return{txHash:S.signature,signature:S.serializedTransaction}}let g=s,p=g.signature||g.signatures?.[0],d=C.default.encode(p),A=C.default.encode(g.serialize());return{txHash:d,signature:A}}),l=n[0]?.encoding??"base58";return{signedInfoList:i,encoding:l}}var xt=n=>{let a="0";return n.forEach(t=>{a=y.add(a,t.rent,{returnString:!0})}),a},pt=({approveTxInfo:n,params:a})=>{let{isCrossChain:t,teeSilentSignEnabled:e,isOnlySign:r,...c}=a,{id:i,data:l,from:s,to:x,unsignedTx:g,gas:p,gasLimit:d,gasPrice:A,maxFeePerGas:S,maxPriorityFeePerGas:U,type:B,nonce:k}=n||{},f={data:l,from:s,to:x};(e||r)&&(f={...f,gas:p,gasLimit:d||p,gasPrice:A,maxFeePerGas:S,maxPriorityFeePerGas:U,type:B,nonce:k},f=I(f));let z={txSource:3};return H(a.chainId)&&(f=JSON.parse(g),_.set(z,"orderId",i)),t&&_.set(f,"extParams",z),{transactionPayload:f,id:i,defiPlatformId:c.defiPlatformId}};var G=async n=>{let a,t;try{a=b.deserialize(D.default.decode(n)),t="versionedTransaction"}catch(e){console.log(e),a=O.from(D.default.decode(n)),t="transaction"}return{transaction:a,version:t}},It=async n=>{let a=u.Buffer.from(n,"base64");return b.deserialize(a)},At=async n=>{let a=n.serialize();return u.Buffer.from(a).toString("base64")};export{P as a,V as b,I as c,rt as d,It as e,At as f,L as g,mt as h,ft as i,xt as j,pt as k};
//# sourceMappingURL=chunk-LOS6KRNX.js.map
