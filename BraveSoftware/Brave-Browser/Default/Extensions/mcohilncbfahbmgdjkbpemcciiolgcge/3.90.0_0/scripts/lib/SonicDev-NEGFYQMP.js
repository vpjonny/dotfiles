import{a as w,b,c as I}from"./chunk-6P6KR663.js";import{W as E,X as S,u as y}from"./chunk-5M5WQCD3.js";import{a as B}from"./chunk-ZJ4FWIGG.js";import"./chunk-34KDKISZ.js";import"./chunk-AL77NTUI.js";import"./chunk-V3FLECS4.js";import{c as T}from"./chunk-LHUS6JBK.js";import"./chunk-R6TSAW7C.js";import{e as u,f}from"./chunk-2W2QYRRT.js";import{a as h}from"./chunk-Q7AZQDRY.js";import{a as P}from"./chunk-DSO47LPO.js";import"./chunk-HDMZQINQ.js";import"./chunk-F6LAWA6D.js";import"./chunk-OAMYZMR4.js";import"./chunk-BGUOO6AC.js";import"./chunk-OQWPK3VC.js";import"./chunk-GUM36CPA.js";import{f as A,o as p,q as k}from"./chunk-LHDKEQAM.js";p();k();var C=A(P());var l={getAccount:async({provider:n})=>{let a=n?.solana?.publicKey;if(!a){let{publicKey:e}=await n?.solana?.connect({onlyIfTrusted:!0});a=e}return a?.toBase58()},getSolanaConnection:()=>B({SolanaConnection:E,chainId:h.SONIC_DEV}),getLatestBlockhash:async({from:n,to:a,isBlockHashFromRpc:e=!1})=>{let s,t;if(e){let o=await l.getSolanaConnection().getLatestBlockhash();s=o?.blockhash,t=o?.lastValidBlockHeight}else{let r=T(u.GET_SIGNINFO,{address:n,coinId:27500}),o=await f.post(r,{from:n,to:a});s=o?.data?.info?.recentBlockhash,t=o?.data?.info?.lastValidBlockHeight}return{recentBlockhash:s,lastValidBlockHeight:t}},signSolanaTransaction:async({payload:n,feePayer:a})=>{let{transaction:e,bizType:s,bizId:t=[],notReplaceBlockhash:r=!1}=n,o=null,c=()=>typeof n?.toJSON=="function"?n:n?.instruction,{recentBlockhash:i,lastValidBlockHeight:g}=await l.getLatestBlockhash({from:a,isBlockHashFromRpc:t?.length>0}),m=c();return m?(o=new y({feePayer:a,blockhash:i,lastValidBlockHeight:g}).add(m),o.recentBlockhash=i):e&&(r||(e?.version>=0?e.message.recentBlockhash=i:(e.signatures=[],e.recentBlockhash=i,e.lastValidBlockHeight=g),t.forEach(_=>{let R=I(s,_),d=S.fromSeed(R.slice(0,32));e?.version>=0?e.sign([d]):e.partialSign(d)})),o=e),o},signMessage:({provider:n,message:a})=>{let{solana:e}=n||{};return new Promise((s,t)=>{let r=new TextEncoder().encode(a);e.publicKey&&e.signMessage(r,"utf8").then(o=>{let c=Array.prototype.map.call(o.signature,i=>`00${i.toString(16)}`.slice(-2)).join("");s(c)}).catch(o=>{t(o)})})},signAllTransactions:({provider:n,transactions:a})=>new Promise((e,s)=>{n?.solana?.signAllTransactions(a).then(t=>{e(t)}).catch(t=>{s(t)})}),preExecuteTrade:async({address:n,transaction:a})=>{let e;try{e=C.default.encode(a.serialize({requireAllSignatures:!1,verifySignatures:!1}))}catch(t){console.log("preExecuteTrade err: ",t)}if(!e)return Promise.resolve();let[,s]=await b(f.post(u.PRE_EXECUTE_TRADE,{checkTypes:[8],from:n,chainId:h.SONIC_DEV,simulateTransactionParamList:[{sigVerify:!1,replaceRecentBlockhash:!0,transaction:e}]},{timeout:3e4}));if(s){let t=s[0]?.simulateTransactionResultList||[];if(t?.length>0&&!t[0]?.result)throw{code:w.PRE_TRADE,message:t[0]?.msg}}},sendTransaction:async({provider:n,payload:a,cb:e,extraParams:s,address:t})=>async function(){let{solana:r}=n||{},o=await l.signSolanaTransaction({provider:n,payload:a,feePayer:r.publicKey});if(!o)throw new Error("no transaction");s?.isNotNeedPreExecute||l.preExecuteTrade({address:t,transaction:o});try{console.log("solana transaction",o);let{signature:c}=await r.signAndSendTransaction(o,{},s);return e&&e(c),c}catch(c){throw console.log("solana transaction error",c),c}}()},M=l;export{M as default};
//# sourceMappingURL=SonicDev-NEGFYQMP.js.map
