import{n as f}from"./chunk-ER33EHJQ.js";import{e as N}from"./chunk-LQG7SAW5.js";import{a as D}from"./chunk-CTJA2WQT.js";import{a as M,g as v}from"./chunk-TQ2XASI3.js";import{c}from"./chunk-VJ2JNI4M.js";import{Ka as b,hb as F,ra as u,t as R,xa as l}from"./chunk-22THXMTO.js";import{A}from"./chunk-AHLFMVMC.js";import{G as d,He as O,Ka as y,Ob as E}from"./chunk-NPJCEXXH.js";import{b as C}from"./chunk-PJC4UBLU.js";import{f as I,o as i,q as s}from"./chunk-LHDKEQAM.js";i();s();var P=I(C());i();s();async function J(o){let e=o?.unsignedTx;if(!e)return[null,null];l.info(u.SIGN_INTENT_SWAP,{tradeType:E.MARKET,unsignedTx:e});let r=JSON.parse(e),[t,n]=await d(b({message:r,chainId:o.chainId}));return t&&(l.error(u.SIGN_PERMIT2_DATA,{error:t,unsignedTx:e}),D(t)||A.error({title:O("swaptrade_trading_mode_alert_order_fail"),placement:A.DIRECTION.top})),[t,n]}async function B({chainId:o,defiPlatformInfo:e}){let r=e?.permit2Data;if(!r||!r.unsignedTx)return null;let[t,n]=await J({unsignedTx:r.unsignedTx,chainId:o});if(t)throw t;return{unsignedTx:r.unsignedTx,signature:n}}i();s();var g=I(C());i();s();var S=I(C());var K=()=>{let{accountStore:{isConnectedWallet:o}}=c(),[e,r]=(0,S.useState)(!1);return(0,S.useEffect)(()=>{(async()=>{if(o){let n=await F();r(n)}})()},[o]),{isWalletSupportSignApprovalAndSwap:e}},U=K;var L=({chainId:o})=>{let{commonStore:e}=c(),{chainList:r}=e,t=(0,g.useMemo)(()=>Array.isArray(e.chainList)&&e.chainList.length>0?e.getChainByID(o):null,[o,r]);return(0,g.useMemo)(()=>t?t.supportBatchBroadcast:!1,[t])},H=({isSingleChain:o,isOkxAggregator:e,isChainSupportBatchBroadcast:r})=>{let{isWalletSupportSignApprovalAndSwap:t}=U();return(0,g.useMemo)(()=>!o||!r||!e?!1:t,[r,e,o,t])},V=H;function Q(o){let e=o?.computedRealSlippageValue||0,r=o?.getOrderSlippageInfo()||{autoSlippageInfo:{}},t=N({slippageInfo:r,isSingleChain:!0}),n=o?.getSlippageType()||M.AUTO;return{slippage:String(e),slippageType:n,maxSlippage:t.maxSlippage||""}}function X(o){let{feeType:e,computedPriorityFeeAmount:r}=o;return{priorityFeeType:v[e]||1,priorityFee:r}}function Z(o){let{priorityMode:e,manualType:r}=o,t=1;return e==="auto"?t=1:r===0?t=2:r===1&&(t=3),{routerModeType:t}}var $=({computedIsCrossChain:o,computedIsOkxProvider:e,chainId:r})=>{let t=L({chainId:r}),n=V({isSingleChain:!o,isOkxAggregator:e,isChainSupportBatchBroadcast:t});return(0,P.useCallback)(({approveStatus:h})=>({needApproveTxInfo:h===y.UnApproved&&n}),[n])},Be=()=>{let{quoteStore:o,accountStore:e,fromToStore:r,slippageStore:t,approveStore:n}=c(),{getApprovalStatus:h}=n,{computedIsOkxProvider:x}=o,{from:p,computedIsCrossChain:W}=r,k=$({computedIsCrossChain:W,computedIsOkxProvider:x,chainId:p.chainId});return(0,P.useCallback)(async(G=!0,q)=>{if(!G)return null;let m=q||o.quote?.bestRoute,Y=m?.quoteId,z=h(p,m?.defiPlatformId),a={quoteId:Y,userWalletAddress:e.getAddressByChainId(p.chainId)};a.accountInfo={accountId:e.computedAccountId,teeId:e.computedTeeInfo?.teeId||"",accountBizLine:2,teeSilentSignEnabled:R.supportStatus},a.slippageConfig=Q(t),a.networkFee=X(f),a.preSetConfig=Z(f),a.simulate=!1;let[w,j]=await d(B({chainId:p.chainId,defiPlatformInfo:m}));return w&&l.error(u.SIGN_PERMIT2_ERROR,{error:w,data:{chainId:p.chainId,defiPlatformInfo:m}}),a.permit2=j,a.chainId=p.chainId,a.ext=k({approveStatus:z}),a},[o.quote?.bestRoute,e,p.chainId,t,f,k])};export{L as a,V as b,Be as c};
//# sourceMappingURL=chunk-O6NQ2NHM.js.map
