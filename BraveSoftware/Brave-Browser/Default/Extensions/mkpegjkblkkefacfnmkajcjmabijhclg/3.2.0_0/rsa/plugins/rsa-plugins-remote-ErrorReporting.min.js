import{d as e,p as r,A as t,s as n}from"./rsa-plugins-common.min.js";let o=function(e){return e.HANDLEDEXCEPTION="handledException",e.UNHANDLEDEXCEPTION="unhandledException",e.UNHANDLEDREJECTION="unhandledPromiseRejection",e}({});const i=["The request failed"],a=["www.test-host.com","localhost","127.0.0.1","[::1]"],s=["userId","userTraits","groupId","groupTraits","anonymousId","config","instance","eventBuffer","traits"],c=(e,r)=>({type:"manual",name:e,timestamp:new Date,metaData:null!=r?r:{}}),l=()=>{const e=globalThis.location.hostname;return e&&a.includes(e)?"development":"production"},u=e=>{const r=n(e,!1,s);return null!==r?JSON.parse(r):{}},p=e=>{const{message:r}=e;let t=r;return r.includes("Error in loading a third-party script")&&(t="Script load failures"),t},d=(e,r)=>{const o={version:"1",message_id:t(),source:{name:"js",sdk_version:r.context.app.value.version,write_key:r.lifecycle.writeKey.value,install_type:r.context.app.value.installType},errors:e};return n(o)};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function f(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var m,v,g,h,b,N={exports:{}},y={exports:{}};function E(){return m?y.exports:(m=1,y.exports=function(){function e(e){return!isNaN(parseFloat(e))&&isFinite(e)}function r(e){return e.charAt(0).toUpperCase()+e.substring(1)}function t(e){return function(){return this[e]}}var n=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],i=["fileName","functionName","source"],a=["args"],s=["evalOrigin"],c=n.concat(o,i,a,s);function l(e){if(e)for(var t=0;t<c.length;t++)void 0!==e[c[t]]&&this["set"+r(c[t])](e[c[t]])}l.prototype={getArgs:function(){return this.args},setArgs:function(e){if("[object Array]"!==Object.prototype.toString.call(e))throw new TypeError("Args must be an Array");this.args=e},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(e){if(e instanceof l)this.evalOrigin=e;else{if(!(e instanceof Object))throw new TypeError("Eval Origin must be an Object or StackFrame");this.evalOrigin=new l(e)}},toString:function(){var e=this.getFileName()||"",r=this.getLineNumber()||"",t=this.getColumnNumber()||"",n=this.getFunctionName()||"";return this.getIsEval()?e?"[eval] ("+e+":"+r+":"+t+")":"[eval]:"+r+":"+t:n?n+" ("+e+":"+r+":"+t+")":e+":"+r+":"+t}},l.fromString=function(e){var r=e.indexOf("("),t=e.lastIndexOf(")"),n=e.substring(0,r),o=e.substring(r+1,t).split(","),i=e.substring(t+1);if(0===i.indexOf("@"))var a=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(i,""),s=a[1],c=a[2],u=a[3];return new l({functionName:n,args:o||void 0,fileName:s,lineNumber:c||void 0,columnNumber:u||void 0})};for(var u=0;u<n.length;u++)l.prototype["get"+r(n[u])]=t(n[u]),l.prototype["set"+r(n[u])]=function(e){return function(r){this[e]=Boolean(r)}}(n[u]);for(var p=0;p<o.length;p++)l.prototype["get"+r(o[p])]=t(o[p]),l.prototype["set"+r(o[p])]=function(r){return function(t){if(!e(t))throw new TypeError(r+" must be a Number");this[r]=Number(t)}}(o[p]);for(var d=0;d<i.length;d++)l.prototype["get"+r(i[d])]=t(i[d]),l.prototype["set"+r(i[d])]=function(e){return function(r){this[e]=String(r)}}(i[d]);return l}())}const O=f(N.exports=(v=E(),g=/(^|@)\S+:\d+/,h=/^\s*at .*(\S+:\d+|\(native\))/m,b=/^(eval@)?(\[native code])?$/,{parse:function(e){if(void 0!==e.stacktrace||void 0!==e["opera#sourceloc"])return this.parseOpera(e);if(e.stack&&e.stack.match(h))return this.parseV8OrIE(e);if(e.stack)return this.parseFFOrSafari(e);throw new Error("Cannot parse given Error object")},extractLocation:function(e){if(-1===e.indexOf(":"))return[e];var r=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(e.replace(/[()]/g,""));return[r[1],r[2]||void 0,r[3]||void 0]},parseV8OrIE:function(e){return e.stack.split("\n").filter((function(e){return!!e.match(h)}),this).map((function(e){e.indexOf("(eval ")>-1&&(e=e.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var r=e.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),t=r.match(/ (\(.+\)$)/);r=t?r.replace(t[0],""):r;var n=this.extractLocation(t?t[1]:r),o=t&&r||void 0,i=["eval","<anonymous>"].indexOf(n[0])>-1?void 0:n[0];return new v({functionName:o,fileName:i,lineNumber:n[1],columnNumber:n[2],source:e})}),this)},parseFFOrSafari:function(e){return e.stack.split("\n").filter((function(e){return!e.match(b)}),this).map((function(e){if(e.indexOf(" > eval")>-1&&(e=e.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),-1===e.indexOf("@")&&-1===e.indexOf(":"))return new v({functionName:e});var r=/((.*".+"[^@]*)?[^@]*)(?:@)/,t=e.match(r),n=t&&t[1]?t[1]:void 0,o=this.extractLocation(e.replace(r,""));return new v({functionName:n,fileName:o[0],lineNumber:o[1],columnNumber:o[2],source:e})}),this)},parseOpera:function(e){return!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function(e){for(var r=/Line (\d+).*script (?:in )?(\S+)/i,t=e.message.split("\n"),n=[],o=2,i=t.length;o<i;o+=2){var a=r.exec(t[o]);a&&n.push(new v({fileName:a[2],lineNumber:a[1],source:t[o]}))}return n},parseOpera10:function(e){for(var r=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,t=e.stacktrace.split("\n"),n=[],o=0,i=t.length;o<i;o+=2){var a=r.exec(t[o]);a&&n.push(new v({functionName:a[3]||void 0,fileName:a[2],lineNumber:a[1],source:t[o]}))}return n},parseOpera11:function(e){return e.stack.split("\n").filter((function(e){return!!e.match(g)&&!e.match(/^Error created at/)}),this).map((function(e){var r,t=e.split("@"),n=this.extractLocation(t.pop()),o=t.shift()||"",i=o.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0;o.match(/\(([^)]*)\)/)&&(r=o.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var a=void 0===r||"[arguments not available]"===r?void 0:r.split(",");return new v({functionName:i,args:a,fileName:n[0],lineNumber:n[1],columnNumber:n[2],source:e})}),this)}})),w=e=>!(!e||!e.stack&&!e.stacktrace&&!e["opera#sourceloc"]||"string"!=typeof(e.stack||e.stacktrace||e["opera#sourceloc"])||e.stack===`${e.name}: ${e.message}`),x=e=>"string"==typeof e?e:"";function k(e,r,t){return{errorClass:x(e),message:x(r),type:"browserjs",stacktrace:t.reduce(((e,r)=>{const t=(e=>{const r={file:e.fileName,method:(t=e.functionName,/^global code$/i.test(t)?"global code":t),lineNumber:e.lineNumber,columnNumber:e.columnNumber,code:void 0,inProject:void 0};var t;return r.lineNumber>-1&&!r.file&&!r.method&&(r.file="global code"),r})(r);try{return"{}"===JSON.stringify(t)?e:e.concat(t)}catch(r){return e}}),[])}}const S=(e,r,t)=>{let o,i=0;if((e=>{switch(Object.prototype.toString.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return e instanceof Error}})(e)?o=e:"object"==typeof e&&(e=>!("string"!=typeof e.name&&"string"!=typeof e.errorClass||"string"!=typeof e.message&&"string"!=typeof e.errorMessage))(e)?(o=new Error(e.message||e.errorMessage),o.name=e.name||e.errorClass,i+=1):(null==t||t.warn(`ErrorReportingPlugin:: ${r} received a non-error: ${n(o)}`),o=void 0),o&&!w(o))try{throw o}catch(e){w(e)&&(o=e,i=1)}return[o,i]};class T{constructor(e,r,t){this.errors=[k(e,r,t)]}static create(e,r,t,n,o=0,i){const[a,s]=S(e,n,i);if(!a)return;let c;try{const e=((e,r)=>w(e)?O.parse(e).slice(r):[])(a,s>0?1+s+o:0);c=new T(a.name,a.message,e)}catch(e){c=new T(a.name,a.message,[])}return c}}const D="ErrorReporting",j=()=>({name:D,deps:[],initialize:e=>{var r;e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,D],e.reporting.isErrorReportingPluginLoaded.value=!0,null!==(r=e.reporting.breadcrumbs)&&void 0!==r&&r.value&&(e.reporting.breadcrumbs.value=[c("Error Reporting Plugin Loaded")])},errorReporting:{init:(e,r,t,n,o)=>{var i,a;if(!o)return null!==(i=e.source.value)&&void 0!==i&&i.config&&null!==(a=e.source.value)&&void 0!==a&&a.id?r.invokeSingle("errorReportingProvider.init",e,t,n):Promise.reject(new Error("Invalid source configuration or source id."))},notify:(t,n,a,s,c,f,m)=>{if(f){const{component:t,tolerateNonErrors:n,errorFramesToSkip:v,normalizedError:g}=((e,r)=>{switch(r){case o.UNHANDLEDEXCEPTION:{const{error:r}=e;return{component:"unhandledException handler",tolerateNonErrors:!0,errorFramesToSkip:1,normalizedError:r||e}}case o.UNHANDLEDREJECTION:return{component:"unhandledrejection handler",tolerateNonErrors:!1,errorFramesToSkip:1,normalizedError:e.reason};case o.HANDLEDEXCEPTION:default:return{component:"notify()",tolerateNonErrors:!0,errorFramesToSkip:2,normalizedError:e}}})(a,null==m?void 0:m.severityReason.type),h=T.create(g,n,m,t,v,c);if(!h||!(e=>{const r=e.message;return!r||"string"!=typeof r||!i.some((e=>r.includes(e)))})(h.errors[0]))return;if(!(e=>{var t;const n=null===(t=e.stacktrace)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.file;if(!n||"string"!=typeof n)return!1;const o=n.substring(n.lastIndexOf("/")+1),i=n.split("/");return i[i.length-2]===r||["rsa"].some((e=>o.startsWith(e)&&o.endsWith(".js")))})(h.errors[0]))return;const b=((r,t,n)=>{var o,i,a,s,c;return{notifier:{name:"RudderStack JavaScript SDK Error Notifier",version:n.context.app.value.version,url:"https://github.com/rudderlabs/rudder-sdk-js"},events:[{payloadVersion:"5",exceptions:e(r.errors),severity:t.severity,unhandled:t.unhandled,severityReason:t.severityReason,app:{version:n.context.app.value.version,releaseStage:l()},device:{locale:null!==(o=n.context.locale.value)&&void 0!==o?o:void 0,userAgent:null!==(i=n.context.userAgent.value)&&void 0!==i?i:void 0,time:new Date},request:{url:globalThis.location.href.split("?")[0],clientIp:"[NOT COLLECTED]"},breadcrumbs:e(n.reporting.breadcrumbs.value),context:p(r.errors[0]),metaData:{sdk:{name:"JS",installType:n.context.app.value.installType},state:null!==(a=u(n))&&void 0!==a?a:{},source:{snippetVersion:globalThis.RudderSnippetVersion}},user:{id:null!==(s=null===(c=n.source.value)||void 0===c?void 0:c.id)&&void 0!==s?s:n.lifecycle.writeKey.value}}]}})(h,m,s);null==f||f.getAsyncData({url:s.metrics.metricsServiceUrl.value,options:{method:"POST",data:d(b,s),sendRawData:!0},isRawResponse:!0,timeout:1e4,callback:(e,r)=>{}})}else t.invokeSingle("errorReportingProvider.notify",n,a,s,c)},breadcrumb:(e,r,t,n,o,i)=>{o?o.reporting.breadcrumbs.value=[...o.reporting.breadcrumbs.value,c(t,i)]:e.invokeSingle("errorReportingProvider.breadcrumb",r,t,n)}}});export{j as ErrorReporting,j as default};
//# sourceMappingURL=rsa-plugins-remote-ErrorReporting.min.js.map
