{"version":3,"file":"rsa-plugins-remote-ExternalAnonymousId.min.js","sources":["../../../../src/externalAnonymousId/constants.ts","../../../../src/externalAnonymousId/index.ts","../../../../src/externalAnonymousId/util.ts"],"sourcesContent":["const externallyLoadedSessionStorageKeys = {\n  segment: 'ajs_anonymous_id',\n};\n\nexport { externallyLoadedSessionStorageKeys };\n","/* eslint-disable no-param-reassign */\nimport type { IStorage } from '@rudderstack/analytics-js-common/types/Store';\nimport type { StorageType } from '@rudderstack/analytics-js-common/types/Storage';\nimport type { ApplicationState } from '@rudderstack/analytics-js-common/types/ApplicationState';\nimport type { ExtensionPlugin } from '@rudderstack/analytics-js-common/types/PluginEngine';\nimport type { AnonymousIdOptions } from '@rudderstack/analytics-js-common/types/LoadOptions';\nimport type { PluginName } from '@rudderstack/analytics-js-common/types/PluginsManager';\nimport { getSegmentAnonymousId } from './util';\nimport { externallyLoadedSessionStorageKeys } from './constants';\n\nconst pluginName: PluginName = 'ExternalAnonymousId';\n\nconst ExternalAnonymousId = (): ExtensionPlugin => ({\n  name: pluginName,\n  initialize: (state: ApplicationState) => {\n    state.plugins.loadedPlugins.value = [...state.plugins.loadedPlugins.value, pluginName];\n  },\n  storage: {\n    getAnonymousId(\n      getStorageEngine: (type?: StorageType) => IStorage,\n      options?: AnonymousIdOptions,\n    ) {\n      let anonymousId;\n      if (options?.autoCapture?.enabled && options.autoCapture.source) {\n        const source = options.autoCapture.source.toLowerCase();\n        if (!Object.keys(externallyLoadedSessionStorageKeys).includes(source)) {\n          return anonymousId;\n        }\n\n        // eslint-disable-next-line sonarjs/no-small-switch\n        switch (source) {\n          case 'segment':\n            anonymousId = getSegmentAnonymousId(getStorageEngine);\n            break;\n\n          default:\n            break;\n        }\n      }\n      return anonymousId;\n    },\n  },\n});\n\nexport { ExternalAnonymousId };\n\nexport default ExternalAnonymousId;\n","import type { IStorage } from '@rudderstack/analytics-js-common/types/Store';\nimport type { StorageType } from '@rudderstack/analytics-js-common/types/Storage';\nimport { storages } from '../shared-chunks/common';\nimport { externallyLoadedSessionStorageKeys } from './constants';\n\nconst getSegmentAnonymousId = (getStorageEngine: (type?: StorageType) => IStorage) => {\n  let anonymousId;\n  /**\n   * First check the local storage for anonymousId\n   * Ref: https://segment.com/docs/connections/sources/catalog/libraries/website/javascript/#identify\n   */\n  const lsEngine = getStorageEngine(storages.LOCAL_STORAGE);\n  if (lsEngine?.isEnabled) {\n    anonymousId = lsEngine.getItem(externallyLoadedSessionStorageKeys.segment);\n  }\n\n  // If anonymousId is not present in local storage and find it in cookies\n  const csEngine = getStorageEngine(storages.COOKIE_STORAGE);\n  if (!anonymousId && csEngine?.isEnabled) {\n    anonymousId = csEngine.getItem(externallyLoadedSessionStorageKeys.segment);\n  }\n  return anonymousId;\n};\n\nexport { getSegmentAnonymousId };\n"],"names":["externallyLoadedSessionStorageKeys","segment","pluginName","ExternalAnonymousId","name","initialize","state","plugins","loadedPlugins","value","storage","getAnonymousId","getStorageEngine","options","_options$autoCapture","anonymousId","autoCapture","enabled","source","toLowerCase","Object","keys","includes","lsEngine","storages","isEnabled","getItem","csEngine","getSegmentAnonymousId"],"mappings":"uDAAA,MAAMA,EAAqC,CACzCC,QAAS,oBCSLC,EAAyB,sBAEzBC,EAAsBA,KAAwB,CAClDC,KAAMF,EACNG,WAAaC,IACXA,EAAMC,QAAQC,cAAcC,MAAQ,IAAIH,EAAMC,QAAQC,cAAcC,MAAOP,EAAW,EAExFQ,QAAS,CACPC,cAAAA,CACEC,EACAC,GACAC,IAAAA,EACA,IAAIC,EACJ,GAAIF,SAAoB,QAAbC,EAAPD,EAASG,mBAAW,IAAAF,GAApBA,EAAsBG,SAAWJ,EAAQG,YAAYE,OAAQ,CAC/D,MAAMA,EAASL,EAAQG,YAAYE,OAAOC,cAC1C,IAAKC,OAAOC,KAAKrB,GAAoCsB,SAASJ,GAC5D,OAAOH,EAIT,GACO,YADCG,EAEJH,EC3BmBH,KAC7B,IAAIG,EAKJ,MAAMQ,EAAWX,EAAiBY,GAC9BD,SAAAA,EAAUE,YACZV,EAAcQ,EAASG,QAAQ1B,EAAmCC,UAIpE,MAAM0B,EAAWf,EAAiBY,GAIlC,OAHKT,GAAD,MAAgBY,GAAAA,EAAUF,YAC5BV,EAAcY,EAASD,QAAQ1B,EAAmCC,UAE7Dc,CAAW,EDWMa,CAAsBhB,EAM1C,CACA,OAAOG,CACT"}