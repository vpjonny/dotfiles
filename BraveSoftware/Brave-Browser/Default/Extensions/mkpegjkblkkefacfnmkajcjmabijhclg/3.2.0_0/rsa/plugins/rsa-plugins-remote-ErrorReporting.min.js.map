{"version":3,"file":"rsa-plugins-remote-ErrorReporting.min.js","sources":["../../../../../analytics-js-common/src/types/ErrorHandler.ts","../../../../../analytics-js-common/src/constants/metrics.ts","../../../../../analytics-js-common/src/constants/errors.ts","../../../../src/errorReporting/constants.ts","../../../../src/errorReporting/utils.ts","../../../../../../node_modules/error-stack-parser/error-stack-parser.js","../../../../../../node_modules/stackframe/stackframe.js","../../../../src/errorReporting/event/utils.ts","../../../../src/errorReporting/event/event.ts","../../../../src/errorReporting/logMessages.ts","../../../../src/errorReporting/index.ts"],"sourcesContent":["import type { IPluginEngine } from './PluginEngine';\nimport type { ILogger } from './Logger';\nimport type { BufferQueue } from '../services/BufferQueue/BufferQueue';\nimport type { IHttpClient } from './HttpClient';\nimport type { IExternalSrcLoader } from '../services/ExternalSrcLoader/types';\n\nexport type SDKError = unknown | Error | ErrorEvent | Event | PromiseRejectionEvent;\n\nexport interface IErrorHandler {\n  logger?: ILogger;\n  pluginEngine?: IPluginEngine;\n  errorBuffer: BufferQueue<PreLoadErrorData>;\n  init(httpClient: IHttpClient, externalSrcLoader: IExternalSrcLoader): void;\n  onError(\n    error: SDKError,\n    context?: string,\n    customMessage?: string,\n    shouldAlwaysThrow?: boolean,\n    errorType?: string,\n  ): void;\n  leaveBreadcrumb(breadcrumb: string): void;\n  notifyError(error: Error, errorState: ErrorState): void;\n  attachErrorListeners(): void;\n}\n\nexport type ErrorState = {\n  severity: string;\n  unhandled: boolean;\n  severityReason: { type: string };\n};\n\nexport interface ErrorTarget extends Element {\n  dataset?: { loader?: string; isnonnativesdk?: string };\n  src?: string;\n}\n\nexport type PreLoadErrorData = {\n  error: SDKError;\n  errorState: ErrorState;\n};\n\nexport enum ErrorType {\n  HANDLEDEXCEPTION = 'handledException',\n  UNHANDLEDEXCEPTION = 'unhandledException',\n  UNHANDLEDREJECTION = 'unhandledPromiseRejection',\n}\n","const METRICS_PAYLOAD_VERSION = '1';\n\nexport { METRICS_PAYLOAD_VERSION };\n","const FAILED_REQUEST_ERR_MSG_PREFIX = 'The request failed';\nconst ERROR_MESSAGES_TO_BE_FILTERED = [FAILED_REQUEST_ERR_MSG_PREFIX];\n\nexport { FAILED_REQUEST_ERR_MSG_PREFIX, ERROR_MESSAGES_TO_BE_FILTERED };\n","// Errors from the below scripts are NOT allowed to reach Bugsnag\nconst SDK_FILE_NAME_PREFIXES = (): string[] => [\n  'rsa', // Prefix for all the SDK scripts including plugins and module federated chunks\n];\n\nconst DEV_HOSTS = ['www.test-host.com', 'localhost', '127.0.0.1', '[::1]'];\n\n// List of keys to exclude from the metadata\n// Potential PII or sensitive data\nconst APP_STATE_EXCLUDE_KEYS = [\n  'userId',\n  'userTraits',\n  'groupId',\n  'groupTraits',\n  'anonymousId',\n  'config',\n  'instance', // destination instance objects\n  'eventBuffer', // pre-load event buffer (may contain PII)\n  'traits',\n];\nconst REQUEST_TIMEOUT_MS = 10 * 1000; // 10 seconds\nconst NOTIFIER_NAME = 'RudderStack JavaScript SDK Error Notifier';\nconst SDK_GITHUB_URL = 'https://github.com/rudderlabs/rudder-sdk-js';\nconst SOURCE_NAME = 'js';\nconst ERROR_REPORTING_PLUGIN = 'ErrorReportingPlugin';\n\nexport {\n  SDK_FILE_NAME_PREFIXES,\n  DEV_HOSTS,\n  APP_STATE_EXCLUDE_KEYS,\n  REQUEST_TIMEOUT_MS,\n  NOTIFIER_NAME,\n  SDK_GITHUB_URL,\n  SOURCE_NAME,\n  ERROR_REPORTING_PLUGIN,\n};\n","import type {\n  ApplicationState,\n  Breadcrumb,\n  BreadcrumbMetaData,\n} from '@rudderstack/analytics-js-common/types/ApplicationState';\nimport {\n  ErrorType,\n  type ErrorState,\n  type SDKError,\n} from '@rudderstack/analytics-js-common/types/ErrorHandler';\nimport { CDN_INT_DIR } from '@rudderstack/analytics-js-common/constants/urls';\nimport { clone } from 'ramda';\nimport type {\n  ErrorEventPayload,\n  MetricServicePayload,\n} from '@rudderstack/analytics-js-common/types/Metrics';\nimport { generateUUID } from '@rudderstack/analytics-js-common/utilities/uuId';\nimport { METRICS_PAYLOAD_VERSION } from '@rudderstack/analytics-js-common/constants/metrics';\nimport { stringifyWithoutCircular } from '@rudderstack/analytics-js-common/utilities/json';\nimport { ERROR_MESSAGES_TO_BE_FILTERED } from '@rudderstack/analytics-js-common/constants/errors';\nimport {\n  APP_STATE_EXCLUDE_KEYS,\n  DEV_HOSTS,\n  SDK_FILE_NAME_PREFIXES,\n  SDK_GITHUB_URL,\n  NOTIFIER_NAME,\n  SOURCE_NAME,\n} from './constants';\nimport { json } from '../shared-chunks/common';\nimport type { ErrorFormat } from './event/event';\n\nconst getConfigForPayloadCreation = (err: SDKError, errorType: string) => {\n  switch (errorType) {\n    case ErrorType.UNHANDLEDEXCEPTION: {\n      const { error } = err as ErrorEvent;\n      return {\n        component: 'unhandledException handler',\n        tolerateNonErrors: true,\n        errorFramesToSkip: 1,\n        normalizedError: error || err,\n      };\n    }\n    case ErrorType.UNHANDLEDREJECTION: {\n      const error = err as PromiseRejectionEvent;\n      return {\n        component: 'unhandledrejection handler',\n        tolerateNonErrors: false,\n        errorFramesToSkip: 1,\n        normalizedError: error.reason,\n      };\n    }\n    case ErrorType.HANDLEDEXCEPTION:\n    default:\n      return {\n        component: 'notify()',\n        tolerateNonErrors: true,\n        errorFramesToSkip: 2,\n        normalizedError: err,\n      };\n  }\n};\n\nconst createNewBreadcrumb = (message: string, metaData?: BreadcrumbMetaData): Breadcrumb => ({\n  type: 'manual',\n  name: message,\n  timestamp: new Date(),\n  metaData: metaData ?? {},\n});\n\nconst getReleaseStage = () => {\n  const host = globalThis.location.hostname;\n  return host && DEV_HOSTS.includes(host) ? 'development' : '__RS_BUGSNAG_RELEASE_STAGE__';\n};\n\nconst getAppStateForMetadata = (state: ApplicationState): Record<string, any> => {\n  const stateStr = json.stringifyWithoutCircular(state, false, APP_STATE_EXCLUDE_KEYS);\n  return stateStr !== null ? JSON.parse(stateStr) : {};\n};\n\nconst getURLWithoutQueryString = () => {\n  const url = globalThis.location.href.split('?');\n  return url[0];\n};\n\nconst getErrorContext = (event: any) => {\n  const { message } = event;\n  let context = message;\n\n  // Hack for easily grouping the script load errors\n  // on the dashboard\n  if (message.includes('Error in loading a third-party script')) {\n    context = 'Script load failures';\n  }\n  return context;\n};\n\nconst getBugsnagErrorEvent = (\n  payload: ErrorFormat,\n  errorState: ErrorState,\n  state: ApplicationState,\n): ErrorEventPayload => ({\n  notifier: {\n    name: NOTIFIER_NAME,\n    version: state.context.app.value.version,\n    url: SDK_GITHUB_URL,\n  },\n  events: [\n    {\n      payloadVersion: '5',\n      exceptions: clone(payload.errors),\n      severity: errorState.severity,\n      unhandled: errorState.unhandled,\n      severityReason: errorState.severityReason,\n      app: {\n        version: state.context.app.value.version,\n        releaseStage: getReleaseStage(),\n      },\n      device: {\n        locale: state.context.locale.value ?? undefined,\n        userAgent: state.context.userAgent.value ?? undefined,\n        time: new Date(),\n      },\n      request: {\n        url: getURLWithoutQueryString() as string,\n        clientIp: '[NOT COLLECTED]',\n      },\n      breadcrumbs: clone(state.reporting.breadcrumbs.value),\n      context: getErrorContext(payload.errors[0]),\n      metaData: {\n        sdk: {\n          name: 'JS',\n          installType: state.context.app.value.installType,\n        },\n        state: getAppStateForMetadata(state) ?? {},\n        source: {\n          snippetVersion: (globalThis as typeof window).RudderSnippetVersion,\n        },\n      },\n      user: {\n        id: state.source.value?.id ?? (state.lifecycle.writeKey.value as string),\n      },\n    },\n  ],\n});\n\n/**\n * A function to determine whether the error should be promoted to notify or not\n * @param {Error} error\n * @returns\n */\nconst isAllowedToBeNotified = (event: any) => {\n  const errorMessage = event.message;\n  if (errorMessage && typeof errorMessage === 'string') {\n    return !ERROR_MESSAGES_TO_BE_FILTERED.some(e => errorMessage.includes(e));\n  }\n  return true;\n};\n\n/**\n * A function to determine if the error is from Rudder SDK\n * @param {Error} event\n * @returns\n */\nconst isRudderSDKError = (event: any) => {\n  const errorOrigin = event.stacktrace?.[0]?.file;\n\n  if (!errorOrigin || typeof errorOrigin !== 'string') {\n    return false;\n  }\n\n  const srcFileName = errorOrigin.substring(errorOrigin.lastIndexOf('/') + 1);\n  const paths = errorOrigin.split('/');\n  // extract the parent folder name from the error origin file path\n  // Ex: parentFolderName will be 'sample' for url: https://example.com/sample/file.min.js\n  const parentFolderName = paths[paths.length - 2];\n\n  return (\n    parentFolderName === CDN_INT_DIR ||\n    SDK_FILE_NAME_PREFIXES().some(\n      prefix => srcFileName.startsWith(prefix) && srcFileName.endsWith('.js'),\n    )\n  );\n};\n\nconst getErrorDeliveryPayload = (payload: ErrorEventPayload, state: ApplicationState): string => {\n  const data = {\n    version: METRICS_PAYLOAD_VERSION,\n    message_id: generateUUID(),\n    source: {\n      name: SOURCE_NAME,\n      sdk_version: state.context.app.value.version,\n      write_key: state.lifecycle.writeKey.value as string,\n      install_type: state.context.app.value.installType,\n    },\n    errors: payload,\n  };\n  return stringifyWithoutCircular<MetricServicePayload>(data) as string;\n};\n\nexport {\n  getConfigForPayloadCreation,\n  createNewBreadcrumb,\n  getReleaseStage,\n  getAppStateForMetadata,\n  getBugsnagErrorEvent,\n  getURLWithoutQueryString,\n  isRudderSDKError,\n  getErrorDeliveryPayload,\n  getErrorContext,\n  isAllowedToBeNotified,\n};\n","(function(root, factory) {\n    'use strict';\n    // Universal Module Definition (UMD) to support AMD, CommonJS/Node.js, Rhino, and browsers.\n\n    /* istanbul ignore next */\n    if (typeof define === 'function' && define.amd) {\n        define('error-stack-parser', ['stackframe'], factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory(require('stackframe'));\n    } else {\n        root.ErrorStackParser = factory(root.StackFrame);\n    }\n}(this, function ErrorStackParser(StackFrame) {\n    'use strict';\n\n    var FIREFOX_SAFARI_STACK_REGEXP = /(^|@)\\S+:\\d+/;\n    var CHROME_IE_STACK_REGEXP = /^\\s*at .*(\\S+:\\d+|\\(native\\))/m;\n    var SAFARI_NATIVE_CODE_REGEXP = /^(eval@)?(\\[native code])?$/;\n\n    return {\n        /**\n         * Given an Error object, extract the most information from it.\n         *\n         * @param {Error} error object\n         * @return {Array} of StackFrames\n         */\n        parse: function ErrorStackParser$$parse(error) {\n            if (typeof error.stacktrace !== 'undefined' || typeof error['opera#sourceloc'] !== 'undefined') {\n                return this.parseOpera(error);\n            } else if (error.stack && error.stack.match(CHROME_IE_STACK_REGEXP)) {\n                return this.parseV8OrIE(error);\n            } else if (error.stack) {\n                return this.parseFFOrSafari(error);\n            } else {\n                throw new Error('Cannot parse given Error object');\n            }\n        },\n\n        // Separate line and column numbers from a string of the form: (URI:Line:Column)\n        extractLocation: function ErrorStackParser$$extractLocation(urlLike) {\n            // Fail-fast but return locations like \"(native)\"\n            if (urlLike.indexOf(':') === -1) {\n                return [urlLike];\n            }\n\n            var regExp = /(.+?)(?::(\\d+))?(?::(\\d+))?$/;\n            var parts = regExp.exec(urlLike.replace(/[()]/g, ''));\n            return [parts[1], parts[2] || undefined, parts[3] || undefined];\n        },\n\n        parseV8OrIE: function ErrorStackParser$$parseV8OrIE(error) {\n            var filtered = error.stack.split('\\n').filter(function(line) {\n                return !!line.match(CHROME_IE_STACK_REGEXP);\n            }, this);\n\n            return filtered.map(function(line) {\n                if (line.indexOf('(eval ') > -1) {\n                    // Throw away eval information until we implement stacktrace.js/stackframe#8\n                    line = line.replace(/eval code/g, 'eval').replace(/(\\(eval at [^()]*)|(,.*$)/g, '');\n                }\n                var sanitizedLine = line.replace(/^\\s+/, '').replace(/\\(eval code/g, '(').replace(/^.*?\\s+/, '');\n\n                // capture and preseve the parenthesized location \"(/foo/my bar.js:12:87)\" in\n                // case it has spaces in it, as the string is split on \\s+ later on\n                var location = sanitizedLine.match(/ (\\(.+\\)$)/);\n\n                // remove the parenthesized location from the line, if it was matched\n                sanitizedLine = location ? sanitizedLine.replace(location[0], '') : sanitizedLine;\n\n                // if a location was matched, pass it to extractLocation() otherwise pass all sanitizedLine\n                // because this line doesn't have function name\n                var locationParts = this.extractLocation(location ? location[1] : sanitizedLine);\n                var functionName = location && sanitizedLine || undefined;\n                var fileName = ['eval', '<anonymous>'].indexOf(locationParts[0]) > -1 ? undefined : locationParts[0];\n\n                return new StackFrame({\n                    functionName: functionName,\n                    fileName: fileName,\n                    lineNumber: locationParts[1],\n                    columnNumber: locationParts[2],\n                    source: line\n                });\n            }, this);\n        },\n\n        parseFFOrSafari: function ErrorStackParser$$parseFFOrSafari(error) {\n            var filtered = error.stack.split('\\n').filter(function(line) {\n                return !line.match(SAFARI_NATIVE_CODE_REGEXP);\n            }, this);\n\n            return filtered.map(function(line) {\n                // Throw away eval information until we implement stacktrace.js/stackframe#8\n                if (line.indexOf(' > eval') > -1) {\n                    line = line.replace(/ line (\\d+)(?: > eval line \\d+)* > eval:\\d+:\\d+/g, ':$1');\n                }\n\n                if (line.indexOf('@') === -1 && line.indexOf(':') === -1) {\n                    // Safari eval frames only have function names and nothing else\n                    return new StackFrame({\n                        functionName: line\n                    });\n                } else {\n                    var functionNameRegex = /((.*\".+\"[^@]*)?[^@]*)(?:@)/;\n                    var matches = line.match(functionNameRegex);\n                    var functionName = matches && matches[1] ? matches[1] : undefined;\n                    var locationParts = this.extractLocation(line.replace(functionNameRegex, ''));\n\n                    return new StackFrame({\n                        functionName: functionName,\n                        fileName: locationParts[0],\n                        lineNumber: locationParts[1],\n                        columnNumber: locationParts[2],\n                        source: line\n                    });\n                }\n            }, this);\n        },\n\n        parseOpera: function ErrorStackParser$$parseOpera(e) {\n            if (!e.stacktrace || (e.message.indexOf('\\n') > -1 &&\n                e.message.split('\\n').length > e.stacktrace.split('\\n').length)) {\n                return this.parseOpera9(e);\n            } else if (!e.stack) {\n                return this.parseOpera10(e);\n            } else {\n                return this.parseOpera11(e);\n            }\n        },\n\n        parseOpera9: function ErrorStackParser$$parseOpera9(e) {\n            var lineRE = /Line (\\d+).*script (?:in )?(\\S+)/i;\n            var lines = e.message.split('\\n');\n            var result = [];\n\n            for (var i = 2, len = lines.length; i < len; i += 2) {\n                var match = lineRE.exec(lines[i]);\n                if (match) {\n                    result.push(new StackFrame({\n                        fileName: match[2],\n                        lineNumber: match[1],\n                        source: lines[i]\n                    }));\n                }\n            }\n\n            return result;\n        },\n\n        parseOpera10: function ErrorStackParser$$parseOpera10(e) {\n            var lineRE = /Line (\\d+).*script (?:in )?(\\S+)(?:: In function (\\S+))?$/i;\n            var lines = e.stacktrace.split('\\n');\n            var result = [];\n\n            for (var i = 0, len = lines.length; i < len; i += 2) {\n                var match = lineRE.exec(lines[i]);\n                if (match) {\n                    result.push(\n                        new StackFrame({\n                            functionName: match[3] || undefined,\n                            fileName: match[2],\n                            lineNumber: match[1],\n                            source: lines[i]\n                        })\n                    );\n                }\n            }\n\n            return result;\n        },\n\n        // Opera 10.65+ Error.stack very similar to FF/Safari\n        parseOpera11: function ErrorStackParser$$parseOpera11(error) {\n            var filtered = error.stack.split('\\n').filter(function(line) {\n                return !!line.match(FIREFOX_SAFARI_STACK_REGEXP) && !line.match(/^Error created at/);\n            }, this);\n\n            return filtered.map(function(line) {\n                var tokens = line.split('@');\n                var locationParts = this.extractLocation(tokens.pop());\n                var functionCall = (tokens.shift() || '');\n                var functionName = functionCall\n                    .replace(/<anonymous function(: (\\w+))?>/, '$2')\n                    .replace(/\\([^)]*\\)/g, '') || undefined;\n                var argsRaw;\n                if (functionCall.match(/\\(([^)]*)\\)/)) {\n                    argsRaw = functionCall.replace(/^[^(]+\\(([^)]*)\\)$/, '$1');\n                }\n                var args = (argsRaw === undefined || argsRaw === '[arguments not available]') ?\n                    undefined : argsRaw.split(',');\n\n                return new StackFrame({\n                    functionName: functionName,\n                    args: args,\n                    fileName: locationParts[0],\n                    lineNumber: locationParts[1],\n                    columnNumber: locationParts[2],\n                    source: line\n                });\n            }, this);\n        }\n    };\n}));\n","(function(root, factory) {\n    'use strict';\n    // Universal Module Definition (UMD) to support AMD, CommonJS/Node.js, Rhino, and browsers.\n\n    /* istanbul ignore next */\n    if (typeof define === 'function' && define.amd) {\n        define('stackframe', [], factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory();\n    } else {\n        root.StackFrame = factory();\n    }\n}(this, function() {\n    'use strict';\n    function _isNumber(n) {\n        return !isNaN(parseFloat(n)) && isFinite(n);\n    }\n\n    function _capitalize(str) {\n        return str.charAt(0).toUpperCase() + str.substring(1);\n    }\n\n    function _getter(p) {\n        return function() {\n            return this[p];\n        };\n    }\n\n    var booleanProps = ['isConstructor', 'isEval', 'isNative', 'isToplevel'];\n    var numericProps = ['columnNumber', 'lineNumber'];\n    var stringProps = ['fileName', 'functionName', 'source'];\n    var arrayProps = ['args'];\n    var objectProps = ['evalOrigin'];\n\n    var props = booleanProps.concat(numericProps, stringProps, arrayProps, objectProps);\n\n    function StackFrame(obj) {\n        if (!obj) return;\n        for (var i = 0; i < props.length; i++) {\n            if (obj[props[i]] !== undefined) {\n                this['set' + _capitalize(props[i])](obj[props[i]]);\n            }\n        }\n    }\n\n    StackFrame.prototype = {\n        getArgs: function() {\n            return this.args;\n        },\n        setArgs: function(v) {\n            if (Object.prototype.toString.call(v) !== '[object Array]') {\n                throw new TypeError('Args must be an Array');\n            }\n            this.args = v;\n        },\n\n        getEvalOrigin: function() {\n            return this.evalOrigin;\n        },\n        setEvalOrigin: function(v) {\n            if (v instanceof StackFrame) {\n                this.evalOrigin = v;\n            } else if (v instanceof Object) {\n                this.evalOrigin = new StackFrame(v);\n            } else {\n                throw new TypeError('Eval Origin must be an Object or StackFrame');\n            }\n        },\n\n        toString: function() {\n            var fileName = this.getFileName() || '';\n            var lineNumber = this.getLineNumber() || '';\n            var columnNumber = this.getColumnNumber() || '';\n            var functionName = this.getFunctionName() || '';\n            if (this.getIsEval()) {\n                if (fileName) {\n                    return '[eval] (' + fileName + ':' + lineNumber + ':' + columnNumber + ')';\n                }\n                return '[eval]:' + lineNumber + ':' + columnNumber;\n            }\n            if (functionName) {\n                return functionName + ' (' + fileName + ':' + lineNumber + ':' + columnNumber + ')';\n            }\n            return fileName + ':' + lineNumber + ':' + columnNumber;\n        }\n    };\n\n    StackFrame.fromString = function StackFrame$$fromString(str) {\n        var argsStartIndex = str.indexOf('(');\n        var argsEndIndex = str.lastIndexOf(')');\n\n        var functionName = str.substring(0, argsStartIndex);\n        var args = str.substring(argsStartIndex + 1, argsEndIndex).split(',');\n        var locationString = str.substring(argsEndIndex + 1);\n\n        if (locationString.indexOf('@') === 0) {\n            var parts = /@(.+?)(?::(\\d+))?(?::(\\d+))?$/.exec(locationString, '');\n            var fileName = parts[1];\n            var lineNumber = parts[2];\n            var columnNumber = parts[3];\n        }\n\n        return new StackFrame({\n            functionName: functionName,\n            args: args || undefined,\n            fileName: fileName,\n            lineNumber: lineNumber || undefined,\n            columnNumber: columnNumber || undefined\n        });\n    };\n\n    for (var i = 0; i < booleanProps.length; i++) {\n        StackFrame.prototype['get' + _capitalize(booleanProps[i])] = _getter(booleanProps[i]);\n        StackFrame.prototype['set' + _capitalize(booleanProps[i])] = (function(p) {\n            return function(v) {\n                this[p] = Boolean(v);\n            };\n        })(booleanProps[i]);\n    }\n\n    for (var j = 0; j < numericProps.length; j++) {\n        StackFrame.prototype['get' + _capitalize(numericProps[j])] = _getter(numericProps[j]);\n        StackFrame.prototype['set' + _capitalize(numericProps[j])] = (function(p) {\n            return function(v) {\n                if (!_isNumber(v)) {\n                    throw new TypeError(p + ' must be a Number');\n                }\n                this[p] = Number(v);\n            };\n        })(numericProps[j]);\n    }\n\n    for (var k = 0; k < stringProps.length; k++) {\n        StackFrame.prototype['get' + _capitalize(stringProps[k])] = _getter(stringProps[k]);\n        StackFrame.prototype['set' + _capitalize(stringProps[k])] = (function(p) {\n            return function(v) {\n                this[p] = String(v);\n            };\n        })(stringProps[k]);\n    }\n\n    return StackFrame;\n}));\n","const hasStack = (err: any) =>\n  !!err &&\n  (!!err.stack || !!err.stacktrace || !!err['opera#sourceloc']) &&\n  typeof (err.stack || err.stacktrace || err['opera#sourceloc']) === 'string' &&\n  err.stack !== `${err.name}: ${err.message}`;\n\nconst isError = (value: any) => {\n  switch (Object.prototype.toString.call(value)) {\n    case '[object Error]':\n    case '[object Exception]':\n    case '[object DOMException]':\n      return true;\n    default:\n      return value instanceof Error;\n  }\n};\n\nexport { hasStack, isError };\n","import type { ErrorState } from '@rudderstack/analytics-js-common/types/ErrorHandler';\nimport type { ILogger } from '@rudderstack/analytics-js-common/types/Logger';\nimport ErrorStackParser from 'error-stack-parser';\nimport type { Exception, Stackframe } from '@rudderstack/analytics-js-common/types/Metrics';\nimport { stringifyWithoutCircular } from '@rudderstack/analytics-js-common/utilities/json';\nimport type { FrameType, IErrorFormat } from '../types';\nimport { hasStack, isError } from './utils';\nimport { ERROR_REPORTING_PLUGIN } from '../constants';\n\nconst normaliseFunctionName = (name: string) =>\n  /^global code$/i.test(name) ? 'global code' : name;\n\n// takes a stacktrace.js style stackframe (https://github.com/stacktracejs/stackframe)\n// and returns a Bugsnag compatible stackframe (https://docs.bugsnag.com/api/error-reporting/#json-payload)\nconst formatStackframe = (frame: FrameType): Stackframe => {\n  const f = {\n    file: frame.fileName,\n    method: normaliseFunctionName(frame.functionName),\n    lineNumber: frame.lineNumber,\n    columnNumber: frame.columnNumber,\n    code: undefined,\n    inProject: undefined,\n  };\n  // Some instances result in no file:\n  // - calling notify() from chrome's terminal results in no file/method.\n  // - non-error exception thrown from global code in FF\n  // This adds one.\n  if (f.lineNumber > -1 && !f.file && !f.method) {\n    f.file = 'global code';\n  }\n  return f;\n};\n\nconst ensureString = (str: any) => (typeof str === 'string' ? str : '');\n\nfunction createBugsnagError(\n  errorClass: string,\n  errorMessage: string,\n  stacktrace: any[],\n): Exception {\n  return {\n    errorClass: ensureString(errorClass),\n    message: ensureString(errorMessage),\n    type: 'browserjs',\n    stacktrace: stacktrace.reduce((accum: Stackframe[], frame: FrameType) => {\n      const f = formatStackframe(frame);\n      // don't include a stackframe if none of its properties are defined\n      try {\n        if (JSON.stringify(f) === '{}') return accum;\n        return accum.concat(f);\n      } catch (e) {\n        return accum;\n      }\n    }, []),\n  };\n}\n\n// Helpers\n\nconst getStacktrace = (error: any, errorFramesToSkip: number) => {\n  if (hasStack(error)) return ErrorStackParser.parse(error).slice(errorFramesToSkip);\n  return [];\n};\n\nconst hasNecessaryFields = (error: any) =>\n  (typeof error.name === 'string' || typeof error.errorClass === 'string') &&\n  (typeof error.message === 'string' || typeof error.errorMessage === 'string');\n\nconst normaliseError = (maybeError: any, component: string, logger?: ILogger) => {\n  let error;\n  let internalFrames = 0;\n\n  if (isError(maybeError)) {\n    error = maybeError;\n  } else if (typeof maybeError === 'object' && hasNecessaryFields(maybeError)) {\n    error = new Error(maybeError.message || maybeError.errorMessage);\n    error.name = maybeError.name || maybeError.errorClass;\n    internalFrames += 1;\n  } else {\n    logger?.warn(\n      `${ERROR_REPORTING_PLUGIN}:: ${component} received a non-error: ${stringifyWithoutCircular(error)}`,\n    );\n    error = undefined;\n  }\n\n  if (error && !hasStack(error)) {\n    // in IE10/11 a new Error() doesn't have a stacktrace until you throw it, so try that here\n    try {\n      throw error;\n    } catch (e) {\n      if (hasStack(e)) {\n        error = e;\n        // if the error only got a stacktrace after we threw it here, we know it\n        // will only have one extra internal frame from this function\n        internalFrames = 1;\n      }\n    }\n  }\n\n  return [error, internalFrames];\n};\n\nclass ErrorFormat implements IErrorFormat {\n  errors: Exception[];\n\n  constructor(errorClass: string, errorMessage: string, stacktrace: any[]) {\n    this.errors = [createBugsnagError(errorClass, errorMessage, stacktrace)];\n  }\n  static create(\n    maybeError: any,\n    tolerateNonErrors: boolean,\n    handledState: ErrorState,\n    component: string,\n    errorFramesToSkip = 0,\n    logger?: ILogger,\n  ) {\n    const [error, internalFrames] = normaliseError(maybeError, component, logger);\n    if (!error) {\n      return undefined;\n    }\n    let event;\n    try {\n      const stacktrace = getStacktrace(\n        error,\n        // if an error was created/throw in the normaliseError() function, we need to\n        // tell the getStacktrace() function to skip the number of frames we know will\n        // be from our own functions. This is added to the number of frames deep we\n        // were told about\n        internalFrames > 0 ? 1 + internalFrames + errorFramesToSkip : 0,\n      );\n      event = new ErrorFormat(error.name, error.message, stacktrace);\n    } catch (e) {\n      event = new ErrorFormat(error.name, error.message, []);\n    }\n\n    return event;\n  }\n}\n\nexport { ErrorFormat };\n","const INVALID_SOURCE_CONFIG_ERROR = `Invalid source configuration or source id.`;\n\nexport { INVALID_SOURCE_CONFIG_ERROR };\n","/* eslint-disable @typescript-eslint/no-unused-vars */\n/* eslint-disable no-param-reassign */\nimport type {\n  ApplicationState,\n  BreadcrumbMetaData,\n} from '@rudderstack/analytics-js-common/types/ApplicationState';\nimport type {\n  ExtensionPlugin,\n  IPluginEngine,\n} from '@rudderstack/analytics-js-common/types/PluginEngine';\nimport type { ILogger } from '@rudderstack/analytics-js-common/types/Logger';\nimport type { PluginName } from '@rudderstack/analytics-js-common/types/PluginsManager';\nimport type { ErrorState, SDKError } from '@rudderstack/analytics-js-common/types/ErrorHandler';\nimport type { IHttpClient } from '@rudderstack/analytics-js-common/types/HttpClient';\nimport type { IExternalSrcLoader } from '@rudderstack/analytics-js-common/services/ExternalSrcLoader/types';\nimport {\n  createNewBreadcrumb,\n  getConfigForPayloadCreation,\n  isRudderSDKError,\n  getBugsnagErrorEvent,\n  getErrorDeliveryPayload,\n  isAllowedToBeNotified,\n} from './utils';\nimport { REQUEST_TIMEOUT_MS } from './constants';\nimport { ErrorFormat } from './event/event';\nimport { INVALID_SOURCE_CONFIG_ERROR } from './logMessages';\n\nconst pluginName: PluginName = 'ErrorReporting';\n\nconst ErrorReporting = (): ExtensionPlugin => ({\n  name: pluginName,\n  deps: [],\n  initialize: (state: ApplicationState) => {\n    state.plugins.loadedPlugins.value = [...state.plugins.loadedPlugins.value, pluginName];\n    state.reporting.isErrorReportingPluginLoaded.value = true;\n    if (state.reporting.breadcrumbs?.value) {\n      state.reporting.breadcrumbs.value = [createNewBreadcrumb('Error Reporting Plugin Loaded')];\n    }\n  },\n  errorReporting: {\n    // This extension point is deprecated\n    // TODO: Remove this in the next major release\n    init: (\n      state: ApplicationState,\n      pluginEngine: IPluginEngine,\n      externalSrcLoader: IExternalSrcLoader,\n      logger?: ILogger,\n      isInvokedFromLatestCore?: boolean,\n    ) => {\n      if (isInvokedFromLatestCore) {\n        return undefined;\n      }\n      if (!state.source.value?.config || !state.source.value?.id) {\n        return Promise.reject(new Error(INVALID_SOURCE_CONFIG_ERROR));\n      }\n\n      return pluginEngine.invokeSingle(\n        'errorReportingProvider.init',\n        state,\n        externalSrcLoader,\n        logger,\n      );\n    },\n    notify: (\n      pluginEngine: IPluginEngine, // Only kept for backward compatibility\n      client: any, // Only kept for backward compatibility\n      error: SDKError,\n      state: ApplicationState,\n      logger?: ILogger,\n      httpClient?: IHttpClient,\n      errorState?: ErrorState,\n    ): void => {\n      if (httpClient) {\n        const { component, tolerateNonErrors, errorFramesToSkip, normalizedError } =\n          getConfigForPayloadCreation(error, errorState?.severityReason.type as string);\n\n        // Generate the error payload\n        const errorPayload = ErrorFormat.create(\n          normalizedError,\n          tolerateNonErrors,\n          errorState as ErrorState,\n          component,\n          errorFramesToSkip,\n          logger,\n        );\n\n        if (!errorPayload || !isAllowedToBeNotified(errorPayload.errors[0])) {\n          return;\n        }\n\n        // filter errors\n        if (!isRudderSDKError(errorPayload.errors[0])) {\n          return;\n        }\n\n        // enrich error payload\n        const bugsnagPayload = getBugsnagErrorEvent(errorPayload, errorState as ErrorState, state);\n\n        // send it to metrics service\n        httpClient?.getAsyncData({\n          url: state.metrics.metricsServiceUrl.value as string,\n          options: {\n            method: 'POST',\n            data: getErrorDeliveryPayload(bugsnagPayload, state),\n            sendRawData: true,\n          },\n          isRawResponse: true,\n          timeout: REQUEST_TIMEOUT_MS,\n          callback: (result: any, details: any) => {\n            // do nothing\n          },\n        });\n      } else {\n        pluginEngine.invokeSingle('errorReportingProvider.notify', client, error, state, logger);\n      }\n    },\n    breadcrumb: (\n      pluginEngine: IPluginEngine, // Only kept for backward compatibility\n      client: any, // Only kept for backward compatibility\n      message: string,\n      logger?: ILogger, // Only kept for backward compatibility\n      state?: ApplicationState,\n      metaData?: BreadcrumbMetaData,\n    ): void => {\n      if (state) {\n        state.reporting.breadcrumbs.value = [\n          ...state.reporting.breadcrumbs.value,\n          createNewBreadcrumb(message, metaData),\n        ];\n      } else {\n        pluginEngine.invokeSingle('errorReportingProvider.breadcrumb', client, message, logger);\n      }\n    },\n  },\n});\n\nexport { ErrorReporting };\n\nexport default ErrorReporting;\n"],"names":["ErrorType","ERROR_MESSAGES_TO_BE_FILTERED","DEV_HOSTS","APP_STATE_EXCLUDE_KEYS","createNewBreadcrumb","message","metaData","type","name","timestamp","Date","getReleaseStage","host","globalThis","location","hostname","includes","getAppStateForMetadata","state","stateStr","json","JSON","parse","getErrorContext","event","context","getErrorDeliveryPayload","payload","data","version","message_id","generateUUID","source","sdk_version","app","value","write_key","lifecycle","writeKey","install_type","installType","errors","stringifyWithoutCircular","StackFrame","FIREFOX_SAFARI_STACK_REGEXP","CHROME_IE_STACK_REGEXP","SAFARI_NATIVE_CODE_REGEXP","exports","_isNumber","n","isNaN","parseFloat","isFinite","_capitalize","str","charAt","toUpperCase","substring","_getter","p","booleanProps","numericProps","stringProps","arrayProps","objectProps","props","concat","obj","i","length","undefined","this","prototype","getArgs","args","setArgs","v","Object","toString","call","TypeError","getEvalOrigin","evalOrigin","setEvalOrigin","fileName","getFileName","lineNumber","getLineNumber","columnNumber","getColumnNumber","functionName","getFunctionName","getIsEval","fromString","argsStartIndex","indexOf","argsEndIndex","lastIndexOf","split","locationString","parts","exec","Boolean","j","Number","k","String","factory","require$$0","error","stacktrace","parseOpera","stack","match","parseV8OrIE","parseFFOrSafari","Error","extractLocation","urlLike","replace","filter","line","map","sanitizedLine","locationParts","functionNameRegex","matches","e","parseOpera9","parseOpera11","parseOpera10","lineRE","lines","result","len","push","argsRaw","tokens","pop","functionCall","shift","hasStack","err","ensureString","createBugsnagError","errorClass","errorMessage","reduce","accum","frame","f","file","method","test","code","inProject","formatStackframe","stringify","normaliseError","maybeError","component","logger","internalFrames","isError","hasNecessaryFields","warn","ErrorFormat","constructor","create","tolerateNonErrors","handledState","errorFramesToSkip","getStacktrace","ErrorStackParser","slice","pluginName","ErrorReporting","deps","initialize","_state$reporting$brea","plugins","loadedPlugins","reporting","isErrorReportingPluginLoaded","breadcrumbs","errorReporting","init","pluginEngine","externalSrcLoader","isInvokedFromLatestCore","_state$source$value","_state$source$value2","config","id","invokeSingle","Promise","reject","notify","client","httpClient","errorState","normalizedError","getConfigForPayloadCreation","errorType","UNHANDLEDEXCEPTION","UNHANDLEDREJECTION","reason","HANDLEDEXCEPTION","severityReason","errorPayload","some","isAllowedToBeNotified","_event$stacktrace","errorOrigin","srcFileName","paths","CDN_INT_DIR","prefix","startsWith","endsWith","isRudderSDKError","bugsnagPayload","getBugsnagErrorEvent","_state$context$locale","_state$context$userAg","_getAppStateForMetada","_state$source$value$i","notifier","url","events","payloadVersion","exceptions","clone","severity","unhandled","releaseStage","device","locale","userAgent","time","request","href","clientIp","sdk","snippetVersion","RudderSnippetVersion","user","getAsyncData","metrics","metricsServiceUrl","options","sendRawData","isRawResponse","timeout","callback","details","breadcrumb"],"mappings":"qEAyCA,IAAYA,EAAAA,SAAAA,GAAA,OAAAA,EAAAA,iBAAAA,mBAAAA,EAAAA,mBAAAA,qBAAAA,EAAA,mBAAA,4BAAAA,CAAS,CAATA,CAAS,ICzCrB,MCCMC,EAAgC,CADA,sBCKhCC,EAAY,CAAC,oBAAqB,YAAa,YAAa,SAI5DC,EAAyB,CAC7B,SACA,aACA,UACA,cACA,cACA,SACA,WACA,cACA,UC4CIC,EAAsBA,CAACC,EAAiBC,KAA+C,CAC3FC,KAAM,SACNC,KAAMH,EACNI,UAAW,IAAIC,KACfJ,SAAUA,QAAAA,EAAY,CACxB,IAEMK,EAAkBA,KACtB,MAAMC,EAAOC,WAAWC,SAASC,SACjC,OAAOH,GAAQV,EAAUc,SAASJ,GAAQ,cAAgB,YAA8B,EAGpFK,EAA0BC,IAC9B,MAAMC,EAAWC,EAA8BF,GAAO,EAAOf,GAC7D,OAAoB,OAAbgB,EAAoBE,KAAKC,MAAMH,GAAY,CAAA,CAAE,EAQhDI,EAAmBC,IACvB,MAAMnB,QAAEA,GAAYmB,EACpB,IAAIC,EAAUpB,EAOd,OAHIA,EAAQW,SAAS,2CACnBS,EAAU,wBAELA,CAAO,EA2FVC,EAA0BA,CAACC,EAA4BT,KAC3D,MAAMU,EAAO,CACXC,QH1L4B,IG2L5BC,WAAYC,IACZC,OAAQ,CACNxB,KDtKc,KCuKdyB,YAAaf,EAAMO,QAAQS,IAAIC,MAAMN,QACrCO,UAAWlB,EAAMmB,UAAUC,SAASH,MACpCI,aAAcrB,EAAMO,QAAQS,IAAIC,MAAMK,aAExCC,OAAQd,GAEV,OAAOe,EAA+Cd,EAAK,yPCxL3Be,EAG1BC,EACAC,EACAC,uECTAC,QAIA,WAEJ,SAASC,EAAUC,GACf,OAAQC,MAAMC,WAAWF,KAAOG,SAASH,EAC5C,CAED,SAASI,EAAYC,GACjB,OAAOA,EAAIC,OAAO,GAAGC,cAAgBF,EAAIG,UAAU,EACtD,CAED,SAASC,EAAQC,GACb,OAAO,WACH,YAAYA,EACxB,CACK,CAED,IAAIC,EAAe,CAAC,gBAAiB,SAAU,WAAY,cACvDC,EAAe,CAAC,eAAgB,cAChCC,EAAc,CAAC,WAAY,eAAgB,UAC3CC,EAAa,CAAC,QACdC,EAAc,CAAC,cAEfC,EAAQL,EAAaM,OAAOL,EAAcC,EAAaC,EAAYC,GAEvE,SAASrB,EAAWwB,GAChB,GAAKA,EACL,IAAK,IAAIC,EAAI,EAAGA,EAAIH,EAAMI,OAAQD,SACRE,IAAlBH,EAAIF,EAAMG,KACVG,KAAK,MAAQlB,EAAYY,EAAMG,KAAKD,EAAIF,EAAMG,IAGzD,CAEDzB,EAAW6B,UAAY,CACnBC,QAAS,WACL,YAAYC,IACf,EACDC,QAAS,SAASC,GACd,GAA0C,mBAAtCC,OAAOL,UAAUM,SAASC,KAAKH,GAC/B,MAAU,IAAAI,UAAU,yBAExBT,KAAKG,KAAOE,CACf,EAEDK,cAAe,WACX,OAAWV,KAACW,UACf,EACDC,cAAe,SAASP,GACpB,GAAIA,aAAajC,EACb4B,KAAKW,WAAaN,MACf,MAAIA,aAAaC,QAGpB,MAAU,IAAAG,UAAU,+CAFpBT,KAAKW,WAAa,IAAIvC,EAAWiC,EAGpC,CACJ,EAEDE,SAAU,WACN,IAAIM,EAAWb,KAAKc,eAAiB,GACjCC,EAAaf,KAAKgB,iBAAmB,GACrCC,EAAejB,KAAKkB,mBAAqB,GACzCC,EAAenB,KAAKoB,mBAAqB,GAC7C,OAAIpB,KAAKqB,YACDR,EACO,WAAaA,EAAW,IAAME,EAAa,IAAME,EAAe,IAEpE,UAAYF,EAAa,IAAME,EAEtCE,EACOA,EAAe,KAAON,EAAW,IAAME,EAAa,IAAME,EAAe,IAE7EJ,EAAW,IAAME,EAAa,IAAME,CAC9C,GAGL7C,EAAWkD,WAAa,SAAgCvC,GACpD,IAAIwC,EAAiBxC,EAAIyC,QAAQ,KAC7BC,EAAe1C,EAAI2C,YAAY,KAE/BP,EAAepC,EAAIG,UAAU,EAAGqC,GAChCpB,EAAOpB,EAAIG,UAAUqC,EAAiB,EAAGE,GAAcE,MAAM,KAC7DC,EAAiB7C,EAAIG,UAAUuC,EAAe,GAElD,GAAoC,IAAhCG,EAAeJ,QAAQ,KACvB,IAAIK,EAAQ,gCAAgCC,KAAKF,EAAgB,IAC7Df,EAAWgB,EAAM,GACjBd,EAAac,EAAM,GACnBZ,EAAeY,EAAM,GAG7B,OAAW,IAAAzD,EAAW,CAClB+C,aAAcA,EACdhB,KAAMA,QAAQJ,EACdc,SAAUA,EACVE,WAAYA,QAAchB,EAC1BkB,aAAcA,QAAgBlB,GAE1C,EAEI,IAAK,IAAIF,EAAI,EAAGA,EAAIR,EAAaS,OAAQD,IACrCzB,EAAW6B,UAAU,MAAQnB,EAAYO,EAAaQ,KAAOV,EAAQE,EAAaQ,IAClFzB,EAAW6B,UAAU,MAAQnB,EAAYO,EAAaQ,KAAQ,SAAST,GACnE,OAAgBiB,SAAAA,GACZL,KAAKZ,GAAK2C,QAAQ1B,EAClC,CACA,CAJsE,CAI3DhB,EAAaQ,IAGpB,IAAK,IAAImC,EAAI,EAAGA,EAAI1C,EAAaQ,OAAQkC,IACrC5D,EAAW6B,UAAU,MAAQnB,EAAYQ,EAAa0C,KAAO7C,EAAQG,EAAa0C,IAClF5D,EAAW6B,UAAU,MAAQnB,EAAYQ,EAAa0C,KAAQ,SAAS5C,GACnE,OAAO,SAASiB,GACZ,IAAK5B,EAAU4B,GACX,MAAM,IAAII,UAAUrB,EAAI,qBAE5BY,KAAKZ,GAAK6C,OAAO5B,EACjC,CACA,CAPsE,CAO3Df,EAAa0C,IAGpB,IAAK,IAAIE,EAAI,EAAGA,EAAI3C,EAAYO,OAAQoC,IACpC9D,EAAW6B,UAAU,MAAQnB,EAAYS,EAAY2C,KAAO/C,EAAQI,EAAY2C,IAChF9D,EAAW6B,UAAU,MAAQnB,EAAYS,EAAY2C,KAAQ,SAAS9C,GAClE,OAAO,SAASiB,GACZL,KAAKZ,GAAK+C,OAAO9B,EACjC,CACA,CAJqE,CAI1Dd,EAAY2C,IAGnB,OAAO9D,CACX,CAtIyBgE,gBDAA5D,SAISJ,EAJDiE,IAOzBhE,EAA8B,eAC9BC,EAAyB,iCACzBC,EAA4B,8BAEzB,CAOHxB,MAAO,SAAiCuF,GACpC,QAAgC,IAArBA,EAAMC,iBAAkE,IAA7BD,EAAM,mBACxD,OAAOtC,KAAKwC,WAAWF,GACpB,GAAIA,EAAMG,OAASH,EAAMG,MAAMC,MAAMpE,GACxC,OAAW0B,KAAC2C,YAAYL,GACjBA,GAAAA,EAAMG,MACb,OAAOzC,KAAK4C,gBAAgBN,GAE5B,MAAU,IAAAO,MAAM,kCAEvB,EAGDC,gBAAiB,SAA2CC,GAExD,IAA8B,IAA1BA,EAAQvB,QAAQ,KAChB,MAAO,CAACuB,GAGZ,IACIlB,EADS,+BACMC,KAAKiB,EAAQC,QAAQ,QAAS,KACjD,MAAO,CAACnB,EAAM,GAAIA,EAAM,SAAM9B,EAAW8B,EAAM,SAAM9B,EACxD,EAED4C,YAAa,SAAuCL,GAKhD,OAJeA,EAAMG,MAAMd,MAAM,MAAMsB,QAAO,SAASC,GACnD,QAASA,EAAKR,MAAMpE,EACvB,GAAE0B,MAEamD,KAAI,SAASD,GACrBA,EAAK1B,QAAQ,WAAa,IAE1B0B,EAAOA,EAAKF,QAAQ,aAAc,QAAQA,QAAQ,6BAA8B,KAEpF,IAAII,EAAgBF,EAAKF,QAAQ,OAAQ,IAAIA,QAAQ,eAAgB,KAAKA,QAAQ,UAAW,IAIzFzG,EAAW6G,EAAcV,MAAM,cAGnCU,EAAgB7G,EAAW6G,EAAcJ,QAAQzG,EAAS,GAAI,IAAM6G,EAIpE,IAAIC,EAAgBrD,KAAK8C,gBAAgBvG,EAAWA,EAAS,GAAK6G,GAC9DjC,EAAe5E,GAAY6G,QAAiBrD,EAC5Cc,EAAW,CAAC,OAAQ,eAAeW,QAAQ6B,EAAc,KAAO,OAAItD,EAAYsD,EAAc,GAElG,OAAW,IAAAjF,EAAW,CAClB+C,aAAcA,EACdN,SAAUA,EACVE,WAAYsC,EAAc,GAC1BpC,aAAcoC,EAAc,GAC5B5F,OAAQyF,GAEf,GAAElD,KACN,EAED4C,gBAAiB,SAA2CN,GAKxD,OAJeA,EAAMG,MAAMd,MAAM,MAAMsB,QAAO,SAASC,GACnD,OAAQA,EAAKR,MAAMnE,EACtB,GAAEyB,MAEamD,KAAI,SAASD,GAMzB,GAJIA,EAAK1B,QAAQ,YAAc,IAC3B0B,EAAOA,EAAKF,QAAQ,mDAAoD,SAGjD,IAAvBE,EAAK1B,QAAQ,OAAsC,IAAvB0B,EAAK1B,QAAQ,KAEzC,OAAO,IAAIpD,EAAW,CAClB+C,aAAc+B,IAGlB,IAAII,EAAoB,6BACpBC,EAAUL,EAAKR,MAAMY,GACrBnC,EAAeoC,GAAWA,EAAQ,GAAKA,EAAQ,QAAKxD,EACpDsD,EAAgBrD,KAAK8C,gBAAgBI,EAAKF,QAAQM,EAAmB,KAEzE,OAAO,IAAIlF,EAAW,CAClB+C,aAAcA,EACdN,SAAUwC,EAAc,GACxBtC,WAAYsC,EAAc,GAC1BpC,aAAcoC,EAAc,GAC5B5F,OAAQyF,GAGnB,GAAElD,KACN,EAEDwC,WAAY,SAAsCgB,GAC9C,OAAKA,EAAEjB,YAAeiB,EAAE1H,QAAQ0F,QAAQ,OAAS,GAC7CgC,EAAE1H,QAAQ6F,MAAM,MAAM7B,OAAS0D,EAAEjB,WAAWZ,MAAM,MAAM7B,YAC5C2D,YAAYD,GAChBA,EAAEf,WAGEiB,aAAaF,GAFdxD,KAAC2D,aAAaH,EAIhC,EAEDC,YAAa,SAAuCD,GAKhD,IAJA,IAAII,EAAS,oCACTC,EAAQL,EAAE1H,QAAQ6F,MAAM,MACxBmC,EAAS,GAEJjE,EAAI,EAAGkE,EAAMF,EAAM/D,OAAQD,EAAIkE,EAAKlE,GAAK,EAAG,CACjD,IAAI6C,EAAQkB,EAAO9B,KAAK+B,EAAMhE,IAC1B6C,GACAoB,EAAOE,KAAK,IAAI5F,EAAW,CACvByC,SAAU6B,EAAM,GAChB3B,WAAY2B,EAAM,GAClBjF,OAAQoG,EAAMhE,KAGzB,CAED,OAAOiE,CACV,EAEDH,aAAc,SAAwCH,GAKlD,IAJA,IAAII,EAAS,6DACTC,EAAQL,EAAEjB,WAAWZ,MAAM,MAC3BmC,EAAS,GAEJjE,EAAI,EAAGkE,EAAMF,EAAM/D,OAAQD,EAAIkE,EAAKlE,GAAK,EAAG,CACjD,IAAI6C,EAAQkB,EAAO9B,KAAK+B,EAAMhE,IAC1B6C,GACAoB,EAAOE,KACH,IAAI5F,EAAW,CACX+C,aAAcuB,EAAM,SAAM3C,EAC1Bc,SAAU6B,EAAM,GAChB3B,WAAY2B,EAAM,GAClBjF,OAAQoG,EAAMhE,KAI7B,CAED,OAAOiE,CACV,EAGDJ,aAAc,SAAwCpB,GAKlD,OAJeA,EAAMG,MAAMd,MAAM,MAAMsB,QAAO,SAASC,GACnD,QAASA,EAAKR,MAAMrE,KAAiC6E,EAAKR,MAAM,oBACnE,GAAE1C,MAEamD,KAAI,SAASD,GACzB,IAMIe,EANAC,EAAShB,EAAKvB,MAAM,KACpB0B,EAAgBrD,KAAK8C,gBAAgBoB,EAAOC,OAC5CC,EAAgBF,EAAOG,SAAW,GAClClD,EAAeiD,EACdpB,QAAQ,iCAAkC,MAC1CA,QAAQ,aAAc,UAAOjD,EAE9BqE,EAAa1B,MAAM,iBACnBuB,EAAUG,EAAapB,QAAQ,qBAAsB,OAEzD,IAAI7C,OAAoBJ,IAAZkE,GAAqC,8BAAZA,OACjClE,EAAYkE,EAAQtC,MAAM,KAE9B,OAAW,IAAAvD,EAAW,CAClB+C,aAAcA,EACdhB,KAAMA,EACNU,SAAUwC,EAAc,GACxBtC,WAAYsC,EAAc,GAC1BpC,aAAcoC,EAAc,GAC5B5F,OAAQyF,GAEf,GAAElD,KACN,KEvMHsE,EAAYC,MACdA,IACCA,EAAI9B,QAAW8B,EAAIhC,aAAgBgC,EAAI,oBACyB,iBAA3DA,EAAI9B,OAAS8B,EAAIhC,YAAcgC,EAAI,qBAC3CA,EAAI9B,QAAU,GAAG8B,EAAItI,SAASsI,EAAIzI,WC6B9B0I,EAAgBzF,GAA6B,iBAARA,EAAmBA,EAAM,GAEpE,SAAS0F,EACPC,EACAC,EACApC,GAEA,MAAO,CACLmC,WAAYF,EAAaE,GACzB5I,QAAS0I,EAAaG,GACtB3I,KAAM,YACNuG,WAAYA,EAAWqC,QAAO,CAACC,EAAqBC,KAClD,MAAMC,EA/BcD,KACxB,MAAMC,EAAI,CACRC,KAAMF,EAAMjE,SACZoE,QAR2BhJ,EAQG6I,EAAM3D,aAPtC,iBAAiB+D,KAAKjJ,GAAQ,cAAgBA,GAQ5C8E,WAAY+D,EAAM/D,WAClBE,aAAc6D,EAAM7D,aACpBkE,UAAMpF,EACNqF,eAAWrF,GAZgB9D,MAqB7B,OAHI8I,EAAEhE,YAAc,IAAMgE,EAAEC,OAASD,EAAEE,SACrCF,EAAEC,KAAO,eAEJD,CAAC,EAeMM,CAAiBP,GAE3B,IACE,MAA0B,OAAtBhI,KAAKwI,UAAUP,GAAoBF,EAChCA,EAAMlF,OAAOoF,EACtB,CAAE,MAAOvB,GACP,OAAOqB,CACT,IACC,IAEP,CAIA,MASMU,EAAiBA,CAACC,EAAiBC,EAAmBC,KAC1D,IAAIpD,EACAqD,EAAiB,EAerB,GD/Ee/H,KACf,OAAQ0C,OAAOL,UAAUM,SAASC,KAAK5C,IACrC,IAAK,iBACL,IAAK,qBACL,IAAK,wBACH,OAAW,EACb,QACE,OAAOA,aAAiBiF,MAC5B,EC0DI+C,CAAQJ,GACVlD,EAAQkD,EACuB,iBAAfA,GAVQlD,MACH,iBAAfA,EAAMrG,MAAiD,iBAArBqG,EAAMoC,YACtB,iBAAlBpC,EAAMxG,SAAsD,iBAAvBwG,EAAMqC,cAQNkB,CAAmBL,IAC9DlD,EAAQ,IAAIO,MAAM2C,EAAW1J,SAAW0J,EAAWb,cACnDrC,EAAMrG,KAAOuJ,EAAWvJ,MAAQuJ,EAAWd,WAC3CiB,GAAkB,IAElBD,SAAAA,EAAQI,KACN,0BAA+BL,2BAAmCtH,EAAyBmE,MAE7FA,OAAQvC,GAGNuC,IAAUgC,EAAShC,GAErB,IACE,MAAMA,CACR,CAAE,MAAOkB,GACHc,EAASd,KACXlB,EAAQkB,EAGRmC,EAAiB,EAErB,CAGF,MAAO,CAACrD,EAAOqD,EAAe,EAGhC,MAAMI,EAGJC,WAAAA,CAAYtB,EAAoBC,EAAsBpC,GACpDvC,KAAK9B,OAAS,CAACuG,EAAmBC,EAAYC,EAAcpC,GAC9D,CACA,aAAO0D,CACLT,EACAU,EACAC,EACAV,EACAW,EAAoB,EACpBV,GAEA,MAAOpD,EAAOqD,GAAkBJ,EAAeC,EAAYC,EAAWC,GACtE,IAAKpD,EACH,OAEF,IAAIrF,EACJ,IACE,MAAMsF,EA/DU8D,EAAC/D,EAAY8D,IAC7B9B,EAAShC,GAAegE,EAAiBvJ,MAAMuF,GAAOiE,MAAMH,GACzD,GA6DgBC,CACjB/D,EAKAqD,EAAiB,EAAI,EAAIA,EAAiBS,EAAoB,GAEhEnJ,EAAQ,IAAI8I,EAAYzD,EAAMrG,KAAMqG,EAAMxG,QAASyG,EACrD,CAAE,MAAOiB,GACPvG,EAAQ,IAAI8I,EAAYzD,EAAMrG,KAAMqG,EAAMxG,QAAS,GACrD,CAEA,OAAOmB,CACT,ECxIF,MC2BMuJ,EAAyB,iBAEzBC,EAAiBA,MACrBxK,KAAMuK,EACNE,KAAM,GACNC,WAAahK,IAA4BiK,IAAAA,EACvCjK,EAAMkK,QAAQC,cAAclJ,MAAQ,IAAIjB,EAAMkK,QAAQC,cAAclJ,MAAO4I,GAC3E7J,EAAMoK,UAAUC,6BAA6BpJ,OAAQ,EACtB,QAA/BgJ,EAAIjK,EAAMoK,UAAUE,mBAAW,IAAAL,GAA3BA,EAA6BhJ,QAC/BjB,EAAMoK,UAAUE,YAAYrJ,MAAQ,CAAC/B,EAAoB,kCAC3D,EAEFqL,eAAgB,CAGdC,KAAMA,CACJxK,EACAyK,EACAC,EACA3B,EACA4B,SACGC,EAAAC,EACH,IAAIF,EAGJ,OAAuBC,QAAnBA,EAAC5K,EAAMc,OAAOG,aAAb2J,IAAkBA,GAAlBA,EAAoBE,QAA6BD,QAAnBA,EAAC7K,EAAMc,OAAOG,aAAb4J,IAAkBA,GAAlBA,EAAoBE,GAIjDN,EAAaO,aAClB,8BACAhL,EACA0K,EACA3B,GAPOkC,QAAQC,OAAO,IAAIhF,MDrDE,8CC6D7B,EAEHiF,OAAQA,CACNV,EACAW,EACAzF,EACA3F,EACA+I,EACAsC,EACAC,KAEA,GAAID,EAAY,CACd,MAAMvC,UAAEA,EAASS,kBAAEA,EAAiBE,kBAAEA,EAAiB8B,gBAAEA,GN1C7BC,EAAC5D,EAAe6D,KAClD,OAAQA,GACN,KAAK3M,EAAU4M,mBAAoB,CACjC,MAAM/F,MAAEA,GAAUiC,EAClB,MAAO,CACLkB,UAAW,6BACXS,mBAAmB,EACnBE,kBAAmB,EACnB8B,gBAAiB5F,GAASiC,EAE9B,CACA,KAAK9I,EAAU6M,mBAEb,MAAO,CACL7C,UAAW,6BACXS,mBAAmB,EACnBE,kBAAmB,EACnB8B,gBALY3D,EAKWgE,QAG3B,KAAK9M,EAAU+M,iBACf,QACE,MAAO,CACL/C,UAAW,WACXS,mBAAmB,EACnBE,kBAAmB,EACnB8B,gBAAiB3D,GAEvB,EMeQ4D,CAA4B7F,EAAO2F,aAAAA,EAAAA,EAAYQ,eAAezM,MAG1D0M,EAAe3C,EAAYE,OAC/BiC,EACAhC,EACA+B,EACAxC,EACAW,EACAV,GAGF,IAAKgD,INgEkBzL,KAC7B,MAAM0H,EAAe1H,EAAMnB,QAC3B,OAAI6I,GAAwC,iBAAjBA,IACjBjJ,EAA8BiN,MAAKnF,GAAKmB,EAAalI,SAAS+G,IAE7D,EMrEiBoF,CAAsBF,EAAaxK,OAAO,IAC9D,OAIF,INwEkBjB,KAAe4L,IAAAA,EACvC,MAAMC,EAA8BD,QAAnBA,EAAG5L,EAAMsF,sBAAUsG,GAAK,QAALA,EAAhBA,EAAmB,UAAE,IAAAA,OAAA,EAArBA,EAAuB7D,KAE3C,IAAK8D,GAAsC,iBAAhBA,EACzB,OAAY,EAGd,MAAMC,EAAcD,EAAY5J,UAAU4J,EAAYpH,YAAY,KAAO,GACnEsH,EAAQF,EAAYnH,MAAM,KAKhC,OAFyBqH,EAAMA,EAAMlJ,OAAS,KAGvBmJ,GDhLsB,CAC7C,OCgL2BN,MACvBO,GAAUH,EAAYI,WAAWD,IAAWH,EAAYK,SAAS,QAClE,EMzFQC,CAAiBX,EAAaxK,OAAO,IACxC,OAIF,MAAMoL,ENAeC,EAC3BnM,EACA6K,EACAtL,KAAuB,IAAA6M,EAAAC,EAAAC,EAAAC,EAAApC,EACA,MAAA,CACvBqC,SAAU,CACR3N,KDjFkB,4CCkFlBqB,QAASX,EAAMO,QAAQS,IAAIC,MAAMN,QACjCuM,IDlFmB,+CCoFrBC,OAAQ,CACN,CACEC,eAAgB,IAChBC,WAAYC,EAAM7M,EAAQc,QAC1BgM,SAAUjC,EAAWiC,SACrBC,UAAWlC,EAAWkC,UACtB1B,eAAgBR,EAAWQ,eAC3B9K,IAAK,CACHL,QAASX,EAAMO,QAAQS,IAAIC,MAAMN,QACjC8M,aAAchO,KAEhBiO,OAAQ,CACNC,OAAkCd,QAA5BA,EAAE7M,EAAMO,QAAQoN,OAAO1M,aAAK4L,IAAAA,EAAAA,OAAIzJ,EACtCwK,kBAASd,EAAE9M,EAAMO,QAAQqN,UAAU3M,aAAK,IAAA6L,EAAAA,OAAI1J,EAC5CyK,KAAM,IAAIrO,MAEZsO,QAAS,CACPZ,IA3CMvN,WAAWC,SAASmO,KAAK/I,MAAM,KAChC,GA2CLgJ,SAAU,mBAEZ1D,YAAagD,EAAMtN,EAAMoK,UAAUE,YAAYrJ,OAC/CV,QAASF,EAAgBI,EAAQc,OAAO,IACxCnC,SAAU,CACR6O,IAAK,CACH3O,KAAM,KACNgC,YAAatB,EAAMO,QAAQS,IAAIC,MAAMK,aAEvCtB,MAAoC,QAA/B+M,EAAEhN,EAAuBC,UAAM,IAAA+M,EAAAA,EAAI,CAAE,EAC1CjM,OAAQ,CACNoN,eAAiBvO,WAA6BwO,uBAGlDC,KAAM,CACJrD,GAA0BiC,QAAxBA,EAAoB,QAApBpC,EAAE5K,EAAMc,OAAOG,aAAK,IAAA2J,OAAA,EAAlBA,EAAoBG,UAAEiC,IAAAA,EAAAA,EAAKhN,EAAMmB,UAAUC,SAASH,SAI/D,EM/C8B2L,CAAqBb,EAAcT,EAA0BtL,GAGpFqL,SAAAA,EAAYgD,aAAa,CACvBnB,IAAKlN,EAAMsO,QAAQC,kBAAkBtN,MACrCuN,QAAS,CACPlG,OAAQ,OACR5H,KAAMF,EAAwBmM,EAAgB3M,GAC9CyO,aAAa,GAEfC,eAAe,EACfC,QPvFiB,IOwFjBC,SAAUA,CAACzH,EAAa0H,KAAdD,GAId,MACEnE,EAAaO,aAAa,gCAAiCI,EAAQzF,EAAO3F,EAAO+I,EACnF,EAEF+F,WAAYA,CACVrE,EACAW,EACAjM,EACA4J,EACA/I,EACAZ,KAEIY,EACFA,EAAMoK,UAAUE,YAAYrJ,MAAQ,IAC/BjB,EAAMoK,UAAUE,YAAYrJ,MAC/B/B,EAAoBC,EAASC,IAG/BqL,EAAaO,aAAa,oCAAqCI,EAAQjM,EAAS4J,EAClF","x_google_ignoreList":[5,6]}