import{k as e,m as t,d as n,M as i}from"./rsa-plugins-common.min.js";import{R as s}from"./rsa-plugins-RetryQueue.min.js";import{f as r}from"./rsa-plugins-deviceModeDestinations.min.js";const a={maxItems:100},o="NativeDestinationQueuePlugin",l=e=>e&&"string"==typeof e,u=(e,t,n,i)=>{const s=e.type.toString();try{var r,a;null===(r=t.instance)||void 0===r||null===(a=r[s])||void 0===a||a.call(r,{message:e})}catch(e){null==n||n.onError(e,o,`Failed to forward event to destination "${t.userFriendlyId}".`)}},d="NativeDestinationQueue",v=()=>({name:d,deps:[],initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,d]},destinationsEventsQueue:{init(d,v,c,m,f,p){const g=(y=d.loadOptions.value.destinationsQueueOptions,t(a,y));var y;const h=d.lifecycle.writeKey.value;return new s(`rudder_destinations_events_${h}`,g,((t,i)=>{const s=r(t.integrations,d.nativeDestinations.initializedDestinations.value),a=[],c=n(t);s.forEach((t=>{try{const r=!((e,t,n)=>{if("track"!==e)return!1;const{blacklistedEvents:i,whitelistedEvents:s,eventFilteringOption:r}=n.config;switch(r){case"blacklistedEvents":{if(!l(t))return!1;const e=t.trim();return!!Array.isArray(i)&&i.some((t=>t.eventName.trim()===e))}case"whitelistedEvents":{if(!l(t))return!0;const e=t.trim();return!Array.isArray(s)||!s.some((t=>t.eventName.trim()===e))}default:return!1}})(c.type,c.event,t);if(!r)return void(null==p||p.warn((n=o,i=c.event,s=t.userFriendlyId,`${n}${e}The "${i}" track event has been filtered for the "${s}" destination.`)));t.shouldApplyDeviceModeTransformation?a.push(t):u(c,t,f)}catch(e){null==f||f.onError(e,o)}var n,i,s})),a.length>0&&v.invokeSingle("transformEvent.enqueue",d,m,c,a,f,p),i(null)}),c,i)},enqueue(e,t,n,i,s){t.addItem(n)},enqueueEventToDestination(e,t,n,i,s){u(t,n,i)}}});export{v as NativeDestinationQueue,v as default};
//# sourceMappingURL=rsa-plugins-remote-NativeDestinationQueue.min.js.map
