import{k as e,C as n,l as t,x as s,c as o,g as r}from"./rsa-plugins-common.min.js";const a="KetchConsentManagerPlugin",i=(o,r)=>{let i=null;try{const e=null==o?void 0:o.setStore({id:a,name:a,type:n});i=null==e?void 0:e.engine.getItem("_ketch_consent_v1_")}catch(n){return void(null==r||r.error((l=a,`${l}${e}Failed to read the consent cookie.`),n))}var l;if(t(i))return;let c;try{c=JSON.parse(s(i))}catch(n){return void(null==r||r.error((n=>`${n}${e}Failed to parse the consent cookie.`)(a),n))}if(!c)return;const d={};return Object.entries(c).forEach((e=>{const n=e[0],t=e[1];d[n]="granted"===(null==t?void 0:t.status)})),d},l=(e,n)=>{const t=(e=>{const n=[],t=[];return e&&Object.entries(e).forEach((e=>{const s=e[0];e[1]?n.push(s):t.push(s)})),{allowedConsentIds:n,deniedConsentIds:t}})(n);e.consents.initialized.value=o(n),e.consents.data.value=t},c="KetchConsentManager",d=()=>({name:c,deps:[],initialize:e=>{e.plugins.loadedPlugins.value=[...e.plugins.loadedPlugins.value,c]},consentManager:{init(e,n){globalThis.getKetchUserConsentedPurposes=()=>{var n;return null===(n=e.consents.data.value.allowedConsentIds)||void 0===n?void 0:n.slice()},globalThis.getKetchUserDeniedPurposes=()=>{var n;return null===(n=e.consents.data.value.deniedConsentIds)||void 0===n?void 0:n.slice()},globalThis.updateKetchConsent=n=>{l(e,n)}},updateConsentsInfo(e,n,t){let s;s=r(globalThis.ketchConsent)?i(n,t):globalThis.ketchConsent,l(e,s)},isDestinationConsented(e,n,t,s){if(!e.consents.initialized.value)return!0;const o=e.consents.data.value.allowedConsentIds;try{const{ketchConsentPurposes:t,consentManagement:s}=n,a=e=>o.includes(e);if(s){var r;const n=null===(r=s.find((n=>n.provider===e.consents.provider.value)))||void 0===r?void 0:r.consents;if(!n)return!0;const t=n.map((e=>e.consent.trim())).filter((e=>e));return"or"===e.consents.resolutionStrategy.value?t.some(a)||0===t.length:t.every(a)}if(t){const e=t.map((e=>e.purpose.trim())).filter((e=>e));return e.some(a)||0===e.length}return!0}catch(e){return null==t||t.onError(e,a,"Failed to determine the consent status for the destination. Please check the destination configuration and try again."),!0}}}});export{d as KetchConsentManager,d as default};
//# sourceMappingURL=rsa-plugins-remote-KetchConsentManager.min.js.map
