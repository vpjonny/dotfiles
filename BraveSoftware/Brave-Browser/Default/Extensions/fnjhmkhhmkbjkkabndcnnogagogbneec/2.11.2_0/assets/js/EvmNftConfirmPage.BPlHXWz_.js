import{j as z}from"./useTriggerLoadNext.KJIKMCqU.js";import{r as ss,_ as ts,$ as es,x as rs,P as as,b as os,T as is,e as cs,f as ns,l as S,W as us}from"./windowUtils.Ut7JS-rc.js";import{m as ms,u as L,s as fs}from"./useActiveTimeStore.C3Wei7Oz.js";import{p as ds,q as ps,b as ls,s as Es,t as Ps,k as Cs,v as b,w as ys}from"./PopupLoading.D-LitESe.js";import{L as vs}from"./enum.CGJbW6Yf.js";import{u as ws,a as xs}from"./useTempStore.C8dvVNTz.js";import{r as o}from"./index.CxJLds0B.js";import{C as As}from"./ConfirmForm.BRfi3U3b.js";import{u as hs,a as gs}from"./useNormalizeToken.CRab6WQg.js";import"./tiny-invariant.BHpmfUqq.js";import"./preload-helper.2LWRYvkK.js";import"./PasswordLevelLabel.rhWNhrqO.js";import"./useDebouncedEffect.CslCnlPq.js";import"./solana.CGFphaJI.js";import"./TransferTitle.DcO0V0Yy.js";import"./useNftCollectionItems.DtJWVrNT.js";import"./useNftCollectionList.0TiOOKoB.js";import"./useSearchErc20Tokens.D0zoSI7L.js";import"./token.types.DkObBlUj.js";const Vs=()=>{var G,R,N,I;const[O,P]=o.useState(void 0),[_,M]=o.useState(),[T,B]=o.useState(!1),p=o.useRef(!1),{setActivityChanged:j}=ws(),k=ss(),{accountInfo:c}=ms(),{addCurrentReceiver:q}=L(),{customGasPriceGwei:H,reset:$,customGasLimit:C,customMaxBaseFee:Y,customPriorityFree:y,customNonce:v}=ds(),{setActivityChainConfigId:V}=L(),{chainId:l,collectionAddress:W,tokenId:w,recipient:i,rawAmount:n}=hs(),s=gs({collectionAddress:W,chainId:l,tokenId:w}),f=(R=(G=c==null?void 0:c.data)==null?void 0:G.currentAccount)==null?void 0:R.address,{reloadActivity:J}=xs(),U=ps(l),{data:r}=ls(l),Z=(r==null?void 0:r.type)===fs.LEGACY,{data:x}=Es(f,i,s,n),{data:A}=Ps(f,i,s,n),{pendingTxStoreData:t,setPendingSignTx:d}=Cs(),h=o.useCallback(e=>{vs.error("[handleError] err: ",e),M(typeof e=="object"?JSON.stringify(e):e);const a=ts(e);a&&P({message:a,shouldBlockNextStep:!1})},[]);o.useEffect(()=>{es().then(e=>B(e))},[]);const g=o.useCallback(async(e=!1)=>{await q(i),s!=null&&s.chainId&&await V(s==null?void 0:s.chainId),$(),e||(k(`${rs.HOME}${as.ACTIVITY}`),await J(),await d(void 0),await j())},[s==null?void 0:s.chainId,i]);if(o.useEffect(()=>{var a,u;const e=async()=>{var m;h((m=t==null?void 0:t.pendingSignTx)==null?void 0:m.error),await d(void 0)};if(((a=t==null?void 0:t.pendingSignTx)==null?void 0:a.status)==="success"&&p.current){g();return}((u=t==null?void 0:t.pendingSignTx)==null?void 0:u.status)==="error"&&p.current&&e()},[(N=t==null?void 0:t.pendingSignTx)==null?void 0:N.error,(I=t==null?void 0:t.pendingSignTx)==null?void 0:I.status]),!s)return null;const K=async()=>{var e,a,u,m;P(void 0),os.sendEvent(is.Click,cs.Send,ns.ConfirmTransaction);try{const E={from:f,to:i,tokenId:w,chainId:s==null?void 0:s.chainId,contractAddress:s==null?void 0:s.address,rawAmount:n},Q=Z?{gasPrice:H||U,gasLimit:C||x}:{maxFeePerGas:`${b(Y)+b(y)||((e=r==null?void 0:r.medium)==null?void 0:e.maxFeePerGas)}`,maxPriorityFeePerGas:y||((a=r==null?void 0:r.medium)==null?void 0:a.maxPriorityFeePerGas),gasLimit:C||x},X=v||A,F=S.isEmpty(X)?void 0:Number(v||A),D=await ys(E,s.standard,Q,S.isNumber(F)?F:void 0);p.current=!0,await d({status:"pending",payload:{txRequest:D,receiverAddress:i,token:s,rawAmount:n}}),T&&((m=(u=c==null?void 0:c.data)==null?void 0:u.currentAccount)==null?void 0:m.type)===us.TREZOR&&(await g(!0),window.close())}catch(E){d(void 0),h(E)}};return z.jsx(As,{recipient:i,token:s,handleConfirm:K,rawAmount:n,sender:f,err:O,txError:_,isNft:!0})};export{Vs as default};
