import{R,N as _,O as h}from"./windowUtils.Ut7JS-rc.js";import{a as q,u as P,D as b}from"./useActiveTimeStore.C3Wei7Oz.js";import{i as G,j as M}from"./PopupLoading.D-LitESe.js";import{g as Y,f as K,a as O}from"./useNftCollectionList.0TiOOKoB.js";import{u as Q}from"./useSearchErc20Tokens.D0zoSI7L.js";const B=({contractAddress:l,owners:I,chainId:g,limit:F=b,balance:U})=>{var y;const a=q(g),{data:v}=P(),{data:p}=G(),w=async o=>{var N,k,T,E,x,S,A;if(!((N=a==null?void 0:a.chainConfig)!=null&&N.chainId)||!v)return;let s;if(((k=a==null?void 0:a.chainConfig)==null?void 0:k.isCustom)===!0){const r=await Y(l,a==null?void 0:a.chainConfig);if(!r)return;if(r.toUpperCase()===_.ERC721){const d=(await Promise.all(I.map(e=>K({chainConfig:a==null?void 0:a.chainConfig,contractAddress:l,ownerAddress:e})))).flat();s={data:d,total:d==null?void 0:d.length,nextPage:""}}if(r.toUpperCase()===_.ERC1155){const u=I.flatMap(c=>{var n;return(((n=p==null?void 0:p.customNftsList)==null?void 0:n[c])||[]).filter(t=>(t==null?void 0:t.contractAddress)===l).map(t=>t==null?void 0:t.tokenId)}),d=[...new Set(u)],m=(await Promise.all(I.map(c=>O({chainConfig:a==null?void 0:a.chainConfig,contractAddress:l,ownerAddress:c,tokenIds:d})))).flat();s={data:m,total:m==null?void 0:m.length,nextPage:""}}}else{const r=await M(l,g,{addresses:I,cursor:o,limit:F});s={data:(((T=r==null?void 0:r.data)==null?void 0:T.items)??[]).map(e=>{var m,c,C,n,t;return{owner:I[0],tokenId:e==null?void 0:e.itemId,quantity:e==null?void 0:e.totalItems,tokenName:(m=e==null?void 0:e.metadata)==null?void 0:m.name,tokenSymbol:e==null?void 0:e.symbol,tokenStandard:e==null?void 0:e.collectionStandard,tokenUri:h(e==null?void 0:e.tokenUri),contractAddress:e==null?void 0:e.collectionAddress,mintAddress:(c=e==null?void 0:e.extraInfo)==null?void 0:c.nftMintAddress,metadata:{name:e==null?void 0:e.metadata.name,tokenImage:h(e==null?void 0:e.metadata.image),tokenVideo:(C=e==null?void 0:e.metadata)==null?void 0:C.video,traits:(t=(n=e==null?void 0:e.metadata)==null?void 0:n.attributes)==null?void 0:t.map(i=>({trait_type:i==null?void 0:i.traitType,value:i==null?void 0:i.value,display_type:i==null?void 0:i.displayType}))}}})??[],total:(x=(E=r==null?void 0:r.data)==null?void 0:E.items)==null?void 0:x.length,nextPage:(A=(S=r==null?void 0:r.data)==null?void 0:S.paging)==null?void 0:A.cursor}}return{data:s,reachEnd:(s==null?void 0:s.nextPage)===o||!(s!=null&&s.nextPage)}};return Q({queryKey:[R.NFT_ITEMS_PAGING,I,l,(y=a==null?void 0:a.chainConfig)==null?void 0:y.chainId,U],queryFn:async({pageParam:o})=>await w((o==null?void 0:o.nextPageCursor)||""),initialPageParam:{nextPageCursor:""},getNextPageParam:o=>{var s;if(!(o!=null&&o.reachEnd))return{nextPageCursor:(s=o==null?void 0:o.data)==null?void 0:s.nextPage}}})};export{B as u};
