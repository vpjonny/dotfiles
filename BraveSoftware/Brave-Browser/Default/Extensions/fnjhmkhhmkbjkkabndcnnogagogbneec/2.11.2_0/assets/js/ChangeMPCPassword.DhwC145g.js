import{j as t}from"./useTriggerLoadNext.KJIKMCqU.js";import{L as S,B as V}from"./PopupLoading.D-LitESe.js";import{r as o}from"./index.CxJLds0B.js";import{w as X,W as Y,r as Z,a as b,l as $,a6 as ss,x as es}from"./windowUtils.Ut7JS-rc.js";import{S as x}from"./ShowPasswordToggler.eaRYVsWD.js";import{L as ts}from"./enum.CGJbW6Yf.js";import{g as os,I as v}from"./useActiveTimeStore.C3Wei7Oz.js";import{I as w,S as E,P as rs,B as as}from"./PasswordLevelLabel.rhWNhrqO.js";import"./solana.CGFphaJI.js";import"./preload-helper.2LWRYvkK.js";import"./tiny-invariant.BHpmfUqq.js";import"./useDebouncedEffect.CslCnlPq.js";const ns="_input_h3yp3_1",is="_suffix_h3yp3_5",p={input:ns,suffix:is},ds=(i,d)=>d===void 0?!1:d!==i,vs=()=>{var N;const i=o.useRef((N=X.getWalletByType(Y.MPC))==null?void 0:N[0]),d=Z(),{toastError:k,toastSuccess:T}=os(),[y,W]=o.useState(!1),[C,D]=o.useState(!1),[R,A]=o.useState(!1),[a,M]=o.useState(),[n,F]=o.useState(),[f,G]=o.useState(),[P,l]=o.useState(),[j,L]=o.useState(),[g,h]=o.useState(),[I,u]=o.useState(!1),B=I?w.Danger:void 0,H=P?w.Danger:void 0,U=g?w.Danger:void 0,r=b.changeRecoveryPassword,q=r.requireEnterNewPassword,[O,m]=o.useState(!1);o.useEffect(()=>{const s=i.current.getState();s&&M(s==null?void 0:s.masterPassword)},[]);const _=(s,e)=>{const c=ds(s,e);u(c)},z=s=>{if(l(void 0),s.target.value.length===0){l(void 0);return}if(s.target.value!=a){l(r.incorrectPassword);return}},K=s=>{const e=s.target.value;if(F(e),h(void 0),L(void 0),$.isEmpty(e))return;if(e===a){h(q);return}const c=ss(e);L(c),c==="too_weak"&&h(r.minLength),_(e,f)},J=s=>{if(G(s.target.value),s.target.value.length===0){u(void 0);return}_(n,s.target.value),s.target.value!==n?u(!0):u(!1)},Q=async s=>{if(s.preventDefault(),!(!a||!n||!f)){m(!0);try{await Promise.race([await i.current.changePassword(a,n,!0),new Promise(e=>{setTimeout(()=>{e(Error("BACKUP_FAILED"))},3e4)})]),T({title:r.changedPasswordSuccessfully}),d(es.HOME)}catch(e){if(ts.error("ChangeMPCPassword",e),e.code==="WRONG_PASSWORD"||e.message==="WRONG_PASSWORD")l(r.incorrectPassword);else{k({title:b.common.error,content:e.message}),m(!1);return}return}finally{m(!1)}}};return t.jsxs(S,{noFooter:!0,noBackground:!0,children:[t.jsx(S.BackableNavbar,{noBackground:!0,title:r.title}),t.jsx(S.Content,{children:t.jsxs("form",{children:[t.jsx(v,{autoFocus:!0,type:y?"text":"password",label:r.enterCurrentPassword,className:p.input,onChange:z,shape:E.Rounded,withBackground:!0,suffixIcon:t.jsx(x,{isShow:y,onToggleShow:W}),intent:H,caption:P}),t.jsx(v,{type:C?"text":"password",label:r.enterNewPassword,className:p.input,onChange:K,shape:E.Rounded,withBackground:!0,suffixIcon:t.jsxs("div",{className:p.suffix,children:[t.jsx(rs,{level:j}),t.jsx(x,{isShow:C,onToggleShow:D})]}),intent:U,caption:g}),t.jsx(v,{type:R?"text":"password",label:r.confirmNewPassword,className:p.input,onChange:J,shape:E.Rounded,withBackground:!0,suffixIcon:t.jsx(x,{isShow:R,onToggleShow:A}),intent:B,caption:B?r.mismatchedPassword:void 0}),t.jsx(V,{children:t.jsx(as,{type:"submit",disabled:!a||!n||!f||!!P||!!g||!!I||j==="too_weak"||O,fullWidth:!0,intent:w.Primary,text:r.finish,loading:O,onClick:Q})})]})})]})};export{vs as default};
