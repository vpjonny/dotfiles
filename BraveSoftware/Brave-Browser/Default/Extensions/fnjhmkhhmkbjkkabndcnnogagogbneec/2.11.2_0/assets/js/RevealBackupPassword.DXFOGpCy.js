import{j as l}from"./useTriggerLoadNext.KJIKMCqU.js";import{r as P}from"./index.CxJLds0B.js";import{R as A,a as k}from"./RevealSeedphrase.CLZ8w1lx.js";import{U as D}from"./Unlock.BESn9bxh.js";import{q as I,r as O,a as E,w as C,W as K,s as T,l as _,K as u,v as m,x as N,y as B}from"./windowUtils.Ut7JS-rc.js";import{a as U}from"./PopupLoading.D-LitESe.js";import{g as W,h as j}from"./useActiveTimeStore.C3Wei7Oz.js";import{L as y}from"./enum.CGJbW6Yf.js";import"./tiny-invariant.BHpmfUqq.js";import"./solana.CGFphaJI.js";import"./PasswordLevelLabel.rhWNhrqO.js";import"./EyeFill.nydyW7Qz.js";import"./ShowPasswordToggler.eaRYVsWD.js";import"./preload-helper.2LWRYvkK.js";import"./useDebouncedEffect.CslCnlPq.js";const ee=()=>{const{walletId:g}=I(),w=O(),e=U(a=>a.setIsLoading),[p,s]=P.useState(0),[R,c]=P.useState(!1),{toastError:t,toastInfo:v}=W(),r=E.reveal.recoveryPassword,{keylessStatus:d,setAccountStatus:o}=j(),h=async()=>{var f;const a=(f=C.getWalletByType(K.MPC))==null?void 0:f[0];e(!0);const n=a.getState();if(!n){t({title:r.missingDataError}),e(!1);return}const S=T(d.accountStatus);if(!_.isEmpty(S)){t({title:S}),await o(d.accountStatus,!0),e(!1),s(1);return}try{await a.getBackup(n.auth.accessToken,{masterPassword:n.masterPassword}),e(!1),s(1)}catch(i){if(y.error("get backup failed",i),i.code===u.NO_BACKUP){await o(m.NO_BACKUP,!0),w(N.HOME);return}else if(i.code===u.PASSWORD_CHANGED)await o(m.PASSWORD_CHANGED,!0),t({title:r.recoveryPasswordChanged}),c(!0),s(1);else if(i.code===u.SESSION_EXPIRED)try{await B(a),v({title:r.sessionRefreshed});return}catch(x){y.error("refresh token failed",x),await o(m.SESSION_EXPIRED,!0),t({title:r.sessionExpired}),c(!0),s(1)}else{t({title:E.common.errorMessage}),c(!0),s(1);return}}finally{e(!1)}};return l.jsxs(l.Fragment,{children:[p===0&&l.jsx(D,{onSuccess:()=>h()}),p===1&&l.jsx(A,{type:k.BACKUP_PASSWORD,walletId:g,invalidPassword:R})]})};export{ee as default};
