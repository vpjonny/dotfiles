import{j as z}from"./useTriggerLoadNext.KJIKMCqU.js";import{r as ss,B as ts,_ as es,$ as rs,x as as,P as os,l as B,W as is}from"./windowUtils.Ut7JS-rc.js";import{m as cs,u as V,s as ns}from"./useActiveTimeStore.C3Wei7Oz.js";import{p as us,q as ms,b as fs,s as ds,t as ps,k as ls,v as j,w as Es}from"./PopupLoading.D-LitESe.js";import{L as Ps}from"./enum.CGJbW6Yf.js";import{r as o}from"./index.CxJLds0B.js";import{C as ws}from"./ConfirmForm.BRfi3U3b.js";import{a as xs,u as ys}from"./useTempStore.C8dvVNTz.js";import{u as Cs}from"./useDebouncedValue.BgjK-DBz.js";import{u as hs}from"./useNormalizeToken.C6igk56m.js";import"./tiny-invariant.BHpmfUqq.js";import"./preload-helper.2LWRYvkK.js";import"./PasswordLevelLabel.rhWNhrqO.js";import"./useDebouncedEffect.CslCnlPq.js";import"./solana.CGFphaJI.js";import"./TransferTitle.DcO0V0Yy.js";import"./useTransferAdapter.DBEESo_0.js";import"./token.types.DkObBlUj.js";import"./associatedTokenAccount.Cs_dSOLN.js";const $s=()=>{var L,M,O,_;const[q,x]=o.useState(void 0),[H,$]=o.useState(!1),d=o.useRef(!1),y=ss(),{accountInfo:c}=cs(),{addCurrentReceiver:C}=V(),{setActivityChainConfigId:h}=V(),{recipient:i,rawAmount:u,tokenAddress:Y,chainId:l,reset:A}=Cs(),[T,W]=o.useState(),{customGasPriceGwei:J,customGasLimit:v,customMaxBaseFee:U,customPriorityFree:G,customNonce:R,reset:I}=us(),s=hs(Y,l,ts.EVM),p=(M=(L=c==null?void 0:c.data)==null?void 0:L.currentAccount)==null?void 0:M.address,Z=ms(l),{data:r}=fs(l),k=(r==null?void 0:r.type)===ns.LEGACY,{data:F}=ds(p,i,s,u),{data:N}=ps(p,i,s,u),{reloadActivity:g}=xs(),{pendingTxStoreData:t,setPendingSignTx:n}=ls(),{setActivityChanged:S}=ys(),E=o.useCallback(e=>{Ps.error("[handleError] err: ",e),W(typeof e=="object"?JSON.stringify(e):e);const a=es(e);a&&x({message:a,shouldBlockNextStep:!1,isValidationErr:!0})},[]);o.useEffect(()=>{rs().then(e=>$(e))},[]);const P=o.useCallback(async(e=!1)=>{await C(i),s!=null&&s.chainId&&await h(s==null?void 0:s.chainId),I(),A(),e||(await n(void 0),await g(),await S(),y(`${as.HOME}${os.ACTIVITY}`))},[C,y,s==null?void 0:s.chainId,i,g,A,I,h,S,n]);o.useEffect(()=>{var a,m;const e=async()=>{var f;E((f=t==null?void 0:t.pendingSignTx)==null?void 0:f.error),await n(void 0)};if(((a=t==null?void 0:t.pendingSignTx)==null?void 0:a.status)==="success"&&d.current){P();return}((m=t==null?void 0:t.pendingSignTx)==null?void 0:m.status)==="error"&&d.current&&e()},[P,E,(O=t==null?void 0:t.pendingSignTx)==null?void 0:O.error,(_=t==null?void 0:t.pendingSignTx)==null?void 0:_.status,n]);const K=async()=>{var e,a,m,f;try{x(void 0);const w={from:p,to:i,rawAmount:u,chainId:s==null?void 0:s.chainId,decimals:s==null?void 0:s.decimal,contractAddress:s==null?void 0:s.address};d.current=!1;const Q=k?{gasPrice:J||Z,gasLimit:v||F}:{maxFeePerGas:`${j(U)+j(G)||((e=r==null?void 0:r.medium)==null?void 0:e.maxFeePerGas)}`,maxPriorityFeePerGas:G||((a=r==null?void 0:r.medium)==null?void 0:a.maxPriorityFeePerGas),gasLimit:v||F},X=R||N,b=B.isEmpty(X)?void 0:Number(R||N),D=await Es(w,s.standard,Q,B.isNumber(b)?b:void 0);d.current=!0,await n({status:"pending",payload:{txRequest:D,receiverAddress:i,token:s,rawAmount:u}}),H&&((f=(m=c==null?void 0:c.data)==null?void 0:m.currentAccount)==null?void 0:f.type)===is.TREZOR&&(await P(!0),window.close())}catch(w){E(w),await n(void 0)}};return s?z.jsx(ws,{sender:p,recipient:i,token:s,txError:T,rawAmount:u,handleConfirm:K,err:q}):null};export{$s as default};
