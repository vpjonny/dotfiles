import{ax as G,l as V,au as K,R as pt,an as mt,ay as v,r as tt,a as B,x as et,b as Q,T as Y,e as z,f as q,az as S,B as st,aA as C,aB as Tt,z as J,aC as ht,aD as yt,aE as ft}from"./windowUtils.Ut7JS-rc.js";import{u as vt}from"./useSearchErc20Tokens.D0zoSI7L.js";import{j as t,u as Et}from"./useTriggerLoadNext.KJIKMCqU.js";import{E as _t}from"./EmptyState.B5_-rwyr.js";import{r as At,R as gt}from"./index.CxJLds0B.js";import{i as nt,W as D,Z as St,a as Nt,e as jt,_ as It,J as Ct}from"./useActiveTimeStore.C3Wei7Oz.js";import{d as Dt,T as N,I as j}from"./PasswordLevelLabel.rhWNhrqO.js";import{a6 as ot,a as Rt,ab as kt,a7 as bt,R as wt}from"./PopupLoading.D-LitESe.js";import{u as Lt,g as Ot,a as Pt,A as Vt,S as Z}from"./useTxStatus.C8QHcxiJ.js";import{u as Bt}from"./useFeatureFlagStore.PL0vfare.js";const Ft="_txList_11bcr_1",Ut="_monthDisplay_11bcr_8",$t="_loadingNext_11bcr_14",Ht="_alert_11bcr_21",Wt="_content_11bcr_24",Mt="_alertText_11bcr_31",R={txList:Ft,monthDisplay:Ut,loadingNext:$t,alert:Ht,content:Wt,alertText:Mt},Gt=async({address:s,chainId:n,tokenAddress:r,paging:e,limit:i,localOnly:l})=>{var o,a;return l?{results:await G.getTxs(n,s,{tokenAddress:r})}:V.isEmpty(r)?await((o=K.getProvider(n))==null?void 0:o.getTransactionsByOwner(s,e,i)):await((a=K.getProvider(n))==null?void 0:a.getTransactionsByTokenAddress(s,r,e,i))},X=s=>(s==null?void 0:s.findIndex(n=>(n==null?void 0:n.status)===v.PENDING))!==-1,Qt=async(s,n,r,e)=>{var y,k;const i=await mt(n),l=!!((y=i==null?void 0:i.chainConfig)!=null&&y.isCustom),o=20,a=await Gt({address:s,chainId:n,tokenAddress:r,paging:e==null?void 0:e.remotePaging,localOnly:l,limit:o}),u=(a==null?void 0:a.results)??[];if(l)return{result:u,havePending:X(u)};let E=await G.getTxs(n,s,{tokenAddress:r,beforeTimestamp:(e==null?void 0:e.localPaging)??Date.now(),onlyCheckFromAccount:!0,limit:o});const I=[v.PENDING,v.DROPPED,v.IN_QUEUE],F=[v.SUCCESS,v.FAILED];E=E.filter(c=>I.includes(c.status)||F.includes(c.status)&&c.localTxId!==null);const p={};for(const c of u)p[c.txHash]=c;for(const c of E){const g=c.txHash||c.localTxId,O=p[g];if(!O){p[g]=c;continue}G.set(g,{...c,localTxId:null,status:O.status})}const T=Object.values(p).sort((c,g)=>g.timestamp-c.timestamp).slice(0,o),h=T.filter(c=>!V.isEmpty(c.localTxId)).length;return h>0&&u.length+h>=o&&T.push(...u.slice(u.length-h)),{result:T,havePending:X(T),paging:a!=null&&a.paginationObject?{remotePaging:a==null?void 0:a.paginationObject,localPaging:((k=T==null?void 0:T[T.length-1])==null?void 0:k.timestamp)??Date.now()}:null}},fe=({address:s,chainId:n,tokenAddress:r})=>vt({queryKey:[pt.ALL_ACTIVITY,s,r,n],queryFn:({pageParam:e})=>Qt(s,n,r,e),initialPageParam:null,staleTime:1e3*60,enabled:!V.isNil(n)&&!V.isEmpty(s),getNextPageParam:e=>{var i;return(i=e==null?void 0:e.paging)!=null&&i.remotePaging?e==null?void 0:e.paging:null}}),ve=({className:s})=>{const n=tt();return t.jsx(_t,{icon:"ðŸ“¦",label:B.activity.empty.title,message:B.activity.empty.description,onClickButton:()=>{n(et.RECEIVE),Q.sendEvent(Y.Click,z.Activity,q.ClickToDeposit)},className:s})},Yt="_loadingContainer_1i5ls_1",zt="_tokenInfoLoading_1i5ls_8",qt="_container_1i5ls_14",Kt="_txDetail_1i5ls_29",Jt="_tokenInfo_1i5ls_8",Zt="_row_1i5ls_42",Xt="_toAddressContainer_1i5ls_49",te="_droppedText_1i5ls_57",ee="_toAddress_1i5ls_49",se="_tokenName_1i5ls_65",ne="_time_1i5ls_72",x={loadingContainer:Yt,tokenInfoLoading:zt,container:qt,txDetail:Kt,tokenInfo:Jt,row:Zt,toAddressContainer:Xt,droppedText:te,toAddress:ee,tokenName:se,time:ne},at=()=>t.jsxs("div",{className:x.loadingContainer,children:[t.jsx("div",{className:x.iconAvt,children:t.jsx(Dt.Skeleton,{height:32,width:32,borderRadius:"50%"})}),t.jsx("div",{className:x.tokenInfoLoading,children:t.jsx(ot,{height:20,count:2,fullWidth:!0})})]}),oe=s=>{const n=tt(),r=Rt(m=>m.setCurrentTx),e=B.activity,{txHash:i,decoded:l,chainId:o,to:a,from:u,timestamp:E,currency:I,localTxId:F}=s,{type:p,actionName:T,balanceDiffs:h,activities:y,contract:k}=l||{},{data:c}=Lt(u,s),g=p===S.APPROVAL,O=p===S.SEND,it=p===S.SELF,U=c===v.PENDING,$=c===v.IN_QUEUE,H=c===v.DROPPED,W=c===v.SUCCESS,ct=!W&&!H&&!U&&!$,rt=k==null?void 0:k.name,lt=nt(o)===st.SOLANA&&p===S.GENERIC,b=At.useMemo(()=>{const{inAssets:m,outAssets:_}=Ot(h),A=p===S.SWAP,{inTokenSymbols:w,outTokenSymbols:d}=Pt({inAssets:m,outAssets:_}),f=[S.APPROVAL].includes(p)||V.isEmpty(h),P=h==null?void 0:h.filter(L=>Number(L==null?void 0:L.value)!==0);return{inAssets:m,outAssets:_,isSwapTx:A,inTokenSymbols:w,outTokenSymbols:d,shouldNotRenderAmountInfo:f,filteredAmountZeroList:P}},[p,h]),dt=()=>{const m=i||F;m&&(r(s),n(`${et.ACTIVITY}/${m}`),Q.sendEvent(Y.Click,z.Activity,q.ClickActivityDetail,{action_properties:{item:s}}))},ut=m=>{var _,A;if(m)return i?`${Tt(i)}`:"";switch(l==null?void 0:l.type){case S.RECEIVE:return`${e.from} ${J(u,{boldDot:!0})??"--"}`;case S.SWAP:return`${b.outTokenSymbols} -> ${b.inTokenSymbols}`;default:{const w=O&&((_=y==null?void 0:y.filter(M=>(M==null?void 0:M.type)===C.SEND))==null?void 0:_.length)>1,d=g?e.for:e.to,P=g||O||it?(A=y==null?void 0:y[0])==null?void 0:A.to:a,L=rt||J(P,{boldDot:!0});return`${W||U?"":" â€¢ "}${d} ${w?e.multipleRecipients:L??"--"}`}}},xt=()=>{var w;const{isSwapTx:m,filteredAmountZeroList:_}=b,A=_==null?void 0:_.sort((d,f)=>{if(d.type===C.RECEIVE&&f.type!==C.RECEIVE)return-1;if(d.type!==C.RECEIVE&&f.type===C.RECEIVE)return 1;const P=parseFloat(d.value||"0");return parseFloat(f.value||"0")-P});return m?(w=A==null?void 0:A.filter(d=>d.type===C.RECEIVE))==null?void 0:w.map((d,f)=>t.jsx(Z,{asset:d,chainId:o,showSubInfoOption:!1,amountTextOptions:{intent:j.Success},currency:I},f)):[A[0]].map((d,f)=>t.jsx(Z,{asset:d,chainId:o,showSubInfoOption:!1,amountTextOptions:{intent:(d==null?void 0:d.type)===C.RECEIVE?j.Success:j.Default},currency:I},f))};return t.jsx("div",{role:"button",className:x.container,tabIndex:0,onClick:dt,children:t.jsxs("div",{className:x.txDetail,children:[t.jsx(Vt,{actionType:p,transactionHash:i,isPending:U,isInQueue:$,isDropped:H,timestamp:E,inAssets:b.inAssets,outAssets:b.outAssets,success:W,activities:y}),t.jsxs("div",{className:x.tokenInfo,children:[t.jsxs("div",{className:x.row,children:[t.jsx(N.Text,{level:"2",className:x.tokenName,children:T}),t.jsx(D,{when:!b.shouldNotRenderAmountInfo,children:xt()})]}),t.jsxs("div",{className:x.row,children:[t.jsxs("div",{className:x.toAddressContainer,children:[t.jsx(D,{when:H,children:t.jsx(N.Text,{level:"4",className:x.droppedText,children:e.status.dropped})}),t.jsx(D,{when:$,children:t.jsx(N.Text,{level:"4",className:x.droppedText,children:"Pending"})}),t.jsx(D,{when:ct,children:t.jsx(N.Text,{level:"4",intent:j.Danger,children:e.status.failed})}),t.jsx(N.Text,{level:"4",intent:j.Secondary,className:x.toAddress,children:ut(lt)})]}),t.jsx(N.Text,{level:"4",intent:j.Secondary,className:x.time,children:kt(E,St.HOUR_MINUTE)})]})]})]})})},Ee=({txList:s,currency:n,hasNextPage:r,fetchNextPage:e})=>{const{endOfListRef:i}=Et(()=>{r&&e(),Q.sendEvent(Y.Scroll,z.Activity,q.ScrollActivities)});let l=null;return t.jsxs("div",{className:R.txList,children:[s==null?void 0:s.map(o=>{const a=ht(o==null?void 0:o.timestamp),u=l!==a;return u&&(l=a),t.jsxs(gt.Fragment,{children:[t.jsx(D,{when:u,children:t.jsx(N.Text,{level:"3",intent:j.Secondary,bold:!0,className:R.monthDisplay,children:a})}),t.jsx(oe,{...o,currency:n})]},(o==null?void 0:o.timestamp)+(o==null?void 0:o.txHash)+(o==null?void 0:o.localTxId))}),t.jsx(D,{when:r,children:t.jsx("div",{ref:i,className:R.loadingNext,children:t.jsx(at,{})})})]})},_e=({numberOfRows:s})=>{const n=yt(s);return t.jsxs(t.Fragment,{children:[t.jsx(ot,{className:R.monthDisplay,level:bt.Text2,width:100}),n==null?void 0:n.map((r,e)=>t.jsx(at,{},e))]})},Ae=({chainId:s})=>{var a,u,E,I;const{data:n,setSolanaTxsLocalBanner:r}=Bt(),e=nt(s),i=(a=Nt(s))==null?void 0:a.chainConfig,l=jt(),o=(E=(u=l==null?void 0:l.chains)==null?void 0:u[e])==null?void 0:E.address;return t.jsx(D,{when:e===st.SOLANA&&((I=n==null?void 0:n.activity)==null?void 0:I.solanaTxsLocalBanner),children:t.jsx(It,{className:R.alert,content:t.jsxs("div",{className:R.content,children:[t.jsxs(N.Text,{level:"3",intent:j.Secondary,className:R.alertText,children:[B.activity.localWarning.solanaMessage," ",t.jsx("a",{href:ft("address",i==null?void 0:i.explorerUrl,o),target:"_blank",rel:"noopener noreferrer",children:B.activity.localWarning.solscan})]}),t.jsx(wt,{icon:Ct,onClick:()=>r(!1),size:16})]})})})};export{Ee as A,ve as E,Ae as L,_e as a,R as s,fe as u};
