import{j as r}from"./useTriggerLoadNext.KJIKMCqU.js";import{o as mt,L as z,B as ft}from"./PopupLoading.D-LitESe.js";import{w as Ct,W as rt,m as yt,ai as xt,aj as St,q as wt,a as f,r as vt,b as Z,T as tt,e as nt}from"./windowUtils.Ut7JS-rc.js";import{r as a}from"./index.CxJLds0B.js";import{u as kt,m as bt,g as Nt,t as It,I as k}from"./useActiveTimeStore.C3Wei7Oz.js";import{L as M}from"./enum.CGJbW6Yf.js";import{T as Rt,S as b,I as C,B as et}from"./PasswordLevelLabel.rhWNhrqO.js";import"./solana.CGFphaJI.js";import"./preload-helper.2LWRYvkK.js";import"./tiny-invariant.BHpmfUqq.js";import"./useDebouncedEffect.CslCnlPq.js";const Ut="_container_k4z7d_1",Et="_warningContainer_k4z7d_7",_t="_warning_k4z7d_7",jt="_icon_k4z7d_24",Tt="_input_k4z7d_30",Pt="_buttons_k4z7d_34",l={container:Ut,warningContainer:Et,warning:_t,icon:jt,input:Tt,buttons:Pt},Wt=async p=>{var o,u,N,I;try{const y=(o=Ct.getWalletByType(rt.MPC))==null?void 0:o[0];return y?((I=(N=await(await fetch(`${yt.mpcApiUrl}/v1/public/rpc/validate`,{method:"POST",body:JSON.stringify({params:{rpcURL:p}}),headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:xt((u=y.getState().auth)==null?void 0:u.accessToken)}})).json())==null?void 0:N.status)==null?void 0:I.toLowerCase())==="ok":!0}catch(y){return M.error("CheckWhitelistRPC",y),!1}};async function At(p){const o=new St(p);try{const u=await o.send("eth_chainId",[]);return u||o.destroy(),Number(u)}catch(u){return o.destroy(),M.error("tryGetChainId error:",u),null}}const $t=()=>{var V,$;const{configId:p}=wt(),{data:o,addCustomRPC:u,toggleSingleChain:N,editCustomRPC:I,getSupportedChains:y}=kt(),{setActiveSingleChain:q}=mt(),{accountInfo:x}=bt(),{toastInfo:it,toastError:at}=Nt(),{addRPC:e,title:ot}=f.settings.developer.customRPC,W=vt(),[d,D]=a.useState(""),[h,G]=a.useState(""),[s,F]=a.useState(void 0),[S,J]=a.useState(""),[A,O]=a.useState(""),[R,v]=a.useState(),[U,E]=a.useState(),[_,H]=a.useState(),[j,B]=a.useState(!1),g=a.useRef(),m=y(),w=a.useCallback(()=>!!p,[p]);a.useEffect(()=>{if(w()){const t=m==null?void 0:m.find(n=>{var c;return((c=n==null?void 0:n.configId)==null?void 0:c.toString())===p});t&&!g.current&&(g.current=t,G(t.chainConfig.rpcUrl),D(t.chainConfig.displayName),O(t.chainConfig.explorerUrl),J(t.chainConfig.nativeToken.symbol),F(t.chainConfig.chainId.toString()))}},[p,m,w]);const st=t=>{D(t.target.value.trimStart())},ct=t=>{try{v(void 0);const n=t.target.value.trim();if(G(n),!n)return;new URL(n)}catch{v(e.invalidUrl)}},lt=t=>{try{E(void 0);const n=t.target.value.trim();F(n);const c=Number(n);isNaN(c)&&E(e.invalidChainId)}catch{E(e.invalidChainId)}},ut=t=>{J(t.target.value.trim())},dt=t=>{try{H(void 0);const n=t.target.value.trim();if(O(n),!n)return;new URL(n)}catch{H(e.invalidUrl)}},ht=a.useCallback(async()=>{var n,c;if(!w()&&!!(m!=null&&m.find(P=>new URL(P.chainConfig.rpcUrl).href===new URL(h).href)))return v(e.rpcExisted),!1;if(((c=(n=x==null?void 0:x.data)==null?void 0:n.currentAccount)==null?void 0:c.type)===rt.MPC&&!await Wt(h))return v(e.notWhitelistedError),!1;const t=await At(h);return t===null?(v(e.cannotGetChainIdError),!1):t.toString()!==s?(E(f.formatString(e.chainIdNotMatch,t).toString()),!1):!0},[($=(V=x==null?void 0:x.data)==null?void 0:V.currentAccount)==null?void 0:$.type,s,m,w,e.cannotGetChainIdError,e.chainIdNotMatch,e.notWhitelistedError,e.rpcExisted,h]),pt=async t=>{var n,c,T,P,K,Q,X;t.preventDefault(),B(!0);try{if(!await ht()){B(!1);return}if(w()){g.current.chainConfig.rpcUrl=h,g.current.chainConfig.chainId=Number(s),g.current.chainConfig.explorerUrl=A,g.current.chainConfig.displayName=d==null?void 0:d.trim(),g.current.chainConfig.nativeToken.symbol=S,await I(g.current),W(-1),Z.sendEvent(tt.Noop,nt.Settings,"Edit Custom RPC Success",{action_properties:{chain_id:s}});return}const i=(n=o==null?void 0:o.chainConfigs)==null?void 0:n.find(Y=>Y.chainConfig.chainId.toString()===s&&!Y.chainConfig.isCustom),L={chainConfig:{isCustom:!0,chainName:"",logoUrl:(c=i==null?void 0:i.chainConfig)==null?void 0:c.logoUrl,chainId:Number(s),explorerUrl:A||((T=i==null?void 0:i.chainConfig)==null?void 0:T.explorerUrl),rpcUrl:h,displayName:d==null?void 0:d.trim(),nativeToken:{symbol:S,decimals:((K=(P=i==null?void 0:i.chainConfig)==null?void 0:P.nativeToken)==null?void 0:K.decimals)??18,name:((X=(Q=i==null?void 0:i.chainConfig)==null?void 0:Q.nativeToken)==null?void 0:X.name)||S}},configId:Date.now()};await u(L),o!=null&&o.isSingleChain||await N(!0),await q(L),it({content:f.formatString(e.switchChainTo,L.chainConfig.displayName),title:""}),W(-1),Z.sendEvent(tt.Noop,nt.Settings,"Add Custom RPC Success",{action_properties:{chain_id:s}})}catch(i){M.error(i),at({title:f.common.error,content:f.common.errorMessage})}finally{B(!1)}},gt=a.useCallback(()=>!d||!h||!s||!S||j||!!U||!!R||!!_,[U,s,_,j,d,R,h,S]);return r.jsxs(z,{noBackground:!0,noFooter:!0,children:[r.jsx(z.BackableNavbar,{title:ot}),r.jsxs(z.Content,{children:[r.jsxs("div",{className:l.container,children:[r.jsxs("div",{className:l.warningContainer,children:[r.jsx(It,{size:20,className:l.icon}),r.jsx(Rt.Text,{level:"4",className:l.warning,children:e.warning})]}),r.jsx(k,{onChange:st,autoFocus:!0,required:!0,label:e.networkName,placeholder:e.networkHint,shape:b.Rounded,className:l.input,withBackground:!0,value:d}),r.jsx(k,{onChange:ct,required:!0,label:e.rpcUrl,placeholder:"https://",shape:b.Rounded,className:l.input,withBackground:!0,intent:R?C.Danger:C.Primary,caption:R,value:h}),r.jsx(k,{onChange:lt,required:!0,label:e.chainId,shape:b.Rounded,className:l.input,withBackground:!0,inputMode:"numeric",intent:U?C.Danger:C.Primary,caption:U,value:s}),r.jsx(k,{onChange:ut,required:!0,label:e.currencySymbol,shape:b.Rounded,className:l.input,withBackground:!0,value:S}),r.jsx(k,{onChange:dt,label:e.blockExplorerUrl,shape:b.Rounded,className:l.input,withBackground:!0,intent:_?C.Danger:C.Primary,caption:_,value:A})]}),r.jsx(ft,{children:r.jsxs("div",{className:l.buttons,children:[r.jsx(et,{text:f.common.cancel,onClick:()=>W(-1),intent:C.Secondary,fullWidth:!0,disabled:j}),r.jsx(et,{text:w()?f.common.save:f.common.add,intent:C.Primary,fullWidth:!0,loading:j,disabled:gt(),onClick:pt})]})})]})]})};export{$t as default};
