import{j as e}from"./useTriggerLoadNext.KJIKMCqU.js";import{r as F,C as L,a as s,x as b,b as h,T as k,e as S,f as _,a3 as R,w as v,a4 as E,X as x}from"./windowUtils.Ut7JS-rc.js";import{a as M,L as B}from"./PopupLoading.D-LitESe.js";import{S as D}from"./ShowPasswordToggler.eaRYVsWD.js";import{r as f}from"./index.CxJLds0B.js";import{m as O,w as H,x as W,y as G,I as q,z,E as K,F as X}from"./useActiveTimeStore.C3Wei7Oz.js";import{L as A}from"./enum.CGJbW6Yf.js";import{I as w,T as N,S as Y,B as J}from"./PasswordLevelLabel.rhWNhrqO.js";import"./tiny-invariant.BHpmfUqq.js";import"./preload-helper.2LWRYvkK.js";import"./solana.CGFphaJI.js";import"./useDebouncedEffect.CslCnlPq.js";const Q="_App_453ob_1",V="_appContent_453ob_10",Z="_form_453ob_20",$="_logo_453ob_25",tt="_h3_453ob_32",ot="_input_453ob_36",et="_forgot_453ob_42",n={App:Q,appContent:V,form:Z,logo:$,h3:tt,input:ot,forgot:et},ht=()=>{const t=F(),[o,y]=f.useState(!1),[i,c]=f.useState(),[p,u]=f.useState(),C=M(l=>l.setIsLoading),{accountInfo:d}=O(),r=f.useRef(!1),{setUnlocked:a}=H(),{updateLastActiveTime:m}=W(),g=l=>{c(l.target.value),u(void 0)},{handleRegularAccountUnlock:I}=at(C,i,t,u,d,m,a),j=async l=>{l.preventDefault(),await I()},U=()=>{t(b.FORGOT_PASSWORD),h.sendEvent(k.Click,S.Unlock,_.ForgotPassword)},P=p?w.Danger:void 0;return e.jsx(B,{noBackground:!0,noFooter:!0,children:e.jsx(G.div,{className:n.App,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5},children:e.jsxs("div",{className:n.appContent,children:[e.jsx("img",{src:L.quest.BountiesLogo,className:n.logo,alt:"logo"}),e.jsx(N.Heading,{className:n.h3,level:"3",children:s.appName}),e.jsxs("form",{className:n.form,onSubmit:j,children:[e.jsx(q,{autoFocus:!0,type:o?"text":"password",onChange:g,intent:P,caption:p,className:n.input,shape:Y.Rounded,suffixIcon:e.jsx(D,{isShow:o,onToggleShow:y}),withBackground:!0,placeholder:s.common.enterYourPasscode,"data-testid":"unlock-input-passcode"}),e.jsx(J,{fullWidth:!0,intent:w.Primary,onClick:()=>{r.current=!0},text:s.common.unlock,"data-testid":"unlock-submit-button"})]}),e.jsx(N.Text,{bold:!0,level:"2",intent:w.Info,onClick:U,className:n.forgot,children:s.common.forgot})]})})})};function at(t,o,y,i,c,p,u){return{handleRegularAccountUnlock:async()=>{var d;try{const r=await z();if(!((d=c==null?void 0:c.data)!=null&&d.isMigrated)&&r)try{await K(o)}catch(a){return T(a,i)}try{await X(o)}catch(a){return T(a,i)}R.doFingerprint(),await p(),await v.unlock(o),await u(o),E(),y(b.HOME),h.sendEvent(k.Noop,S.Authenticate,_.Pincode+" - "+x.Success),A.info("WalletType",v.getWallets().map(a=>{var m,g;return{type:(m=a.getState())==null?void 0:m.type,id:(g=a.getState())==null?void 0:g.walletId}}))}catch(r){A.error("Unlock error",r),i(s.common.errors.invalidPasscode),h.sendEvent(k.Noop,S.Authenticate,_.Pincode+" - "+x.Fail,{action_properties:{error:r}});return}}}}function T(t,o){A.error("MigrateDataIfNeeded",t),typeof t=="object"&&((t==null?void 0:t.message)==="UNLOCK_FAILED"||(t==null?void 0:t.message)==="Incorrect password")?o(s.common.errors.invalidPasscode):o(s.common.errors.migrateFailed),h.sendEvent(k.Noop,S.Authenticate,_.Migrate+" - "+x.Fail,{action_properties:{error:t}})}export{ht as default};
