import{j as e}from"./useTriggerLoadNext.KJIKMCqU.js";import{a as o,a7 as m,c as z,N as D,a8 as B,a9 as H,R as I,l as g,r as Y,C as $,aa as Z,ab as k}from"./windowUtils.Ut7JS-rc.js";import{w as aa,p as sa,q as ta,s as ia,t as ea,D as ca,k as la,E as ra,F as na,G as oa,I as ua,L as T,m as da,J as ma,H as ga,K as pa,M as ha}from"./PopupLoading.D-LitESe.js";import{r as xa}from"./index.CxJLds0B.js";import{d as Ea,g as Na,W as w,P as ya,K as Sa,B as Ba}from"./useActiveTimeStore.C3Wei7Oz.js";import{V as Ta}from"./solana.CGFphaJI.js";import{T as fa,F as Ca}from"./TransferTitle.DcO0V0Yy.js";import{L as Ra}from"./enum.CGJbW6Yf.js";import{T as F,I as V,f as _a}from"./PasswordLevelLabel.rhWNhrqO.js";const Ga="_container_1g2cd_1",La="_actionName_1g2cd_6",ba="_copy_1g2cd_21",ja="_notEnoughGas_1g2cd_25",d={container:Ga,actionName:La,copy:ba,notEnoughGas:ja};function wa({gasFee:c,nativeTokenInfo:s,token:a,rawAmount:n,err:i}){if(!c||!(s!=null&&s.balance))return{shouldBlockNextStep:!0,isValidationErr:!0};const{errors:t}=o.signing;if(!m(c))return{message:t.invalidGasFeeEstimation,shouldBlockNextStep:!0,isValidationErr:!0};if(z(a==null?void 0:a.standard,D.ERC721))return i!=null&&i.isValidationErr,void 0;if(!m(s==null?void 0:s.balance)||!m(a==null?void 0:a.balance))return{message:t.cannotFetchBalance,shouldBlockNextStep:!0,isValidationErr:!0};if(!m(n))return{message:t.invalidTokenAmount,shouldBlockNextStep:!0,isValidationErr:!0};const l=new B(c),u=new B(s==null?void 0:s.balance),E=new B(n).add(l),N=u.gte(E);if(l.gt(u)||H(a==null?void 0:a.address)&&!N)return{message:o.formatString(o.transfer.insufficientFunds,s==null?void 0:s.symbol).toString(),shouldBlockNextStep:!0,isValidationErr:!0};i!=null&&i.isValidationErr}const Fa=(c,s,a,n,i)=>{const t=async()=>{try{if(g.isEmpty(c)&&g.isEmpty(a))return;const l=i?`0x${BigInt(i).toString(16)}`:void 0,u={from:c,to:s,tokenId:a==null?void 0:a.id,chainId:a==null?void 0:a.chainId,contractAddress:a.address,rawAmount:n};return await aa(u,a==null?void 0:a.standard,{gasLimit:l})}catch(l){Ra.error(l)}};return Ea({queryKey:[I.CREATE_TX_REQUEST,c,s,a,n],queryFn:t,gcTime:0})},Xa=({rawAmount:c,recipient:s,token:a,handleConfirm:n,sender:i,err:t,txError:l})=>{var _,G,L,b;const[u,x]=xa.useState(!1),{customGasLimit:E,customGasPriceGwei:N,reset:P,totalEstFee:q}=sa(),A=ta(a==null?void 0:a.chainId),{data:f}=ia(i,s,a,c),{data:p}=Fa(i,s,a,c,f),{data:C}=ea(i,s,a,c),U=Y(),y=ca(E||f,N||A),{toastSuccess:v}=Na(),{pendingTxStoreData:S}=la(),{account:K}=ra(i),{data:M}=na({chainId:a==null?void 0:a.chainId,address:i});oa(K);const X=((_=S==null?void 0:S.pendingSignTx)==null?void 0:_.status)==="pending",r=wa({gasFee:q||y,nativeTokenInfo:M,token:a,rawAmount:c,err:t}),h=ua({chainId:a==null?void 0:a.chainId,url:"https://wallet.roninchain.com",address:(G=p==null?void 0:p.from)==null?void 0:G.toString(),data:ha("eth_sendTransaction",[p])}),J=((b=(L=h==null?void 0:h.data)==null?void 0:L.validation)==null?void 0:b.resultType)===Ta.MALICIOUS,O=async()=>{if(!R){x(!0);try{await n()}catch{}finally{x(!1)}}},Q=j=>{j.preventDefault(),v({title:o.common.copiedToClipboard}),navigator.clipboard.writeText(JSON.stringify(l))},W=!g.isEmpty(t==null?void 0:t.message)||!g.isEmpty(r==null?void 0:r.message),R=!m(y)||!y||!m(C)||!C||(r==null?void 0:r.shouldBlockNextStep)||(t==null?void 0:t.shouldBlockNextStep)||J;return e.jsxs(T,{noBackground:!0,noFooter:!0,children:[e.jsx(T.BackableNavbar,{title:o.signing.previewTransaction,callback:()=>{U(-1),P()}}),e.jsxs(T.Content,{className:d.container,children:[e.jsx(fa,{title:o.transfer.transferTitle,logoUrl:$.RoninLogoIcon}),e.jsx(da,{simulateResult:h,chainId:a.chainId}),e.jsx(F.Text,{level:"3",className:d.actionName,children:g.get(h.data,"simulation.txLabel",Z)}),e.jsx(ma,{txRequest:p,isNativeTransfer:k(a.standard,D.NATIVE),recipient:s}),e.jsx(w,{when:W,children:e.jsxs(ga,{className:d.notEnoughGas,intent:V.Danger,children:[(t==null?void 0:t.message)||(r==null?void 0:r.message),e.jsx(w,{when:!g.isEmpty(l),children:e.jsx(ya,{hoverToShow:!0,placement:"bottom-center",triggerElement:e.jsx(Sa,{icon:pa,size:Ba.XXSmall,variant:_a.Plain,className:d.copy,intent:V.Danger,onClick:Q}),isOpen:!0,layerClassName:d.popoverContent,triggerWrapperClassName:d.wrapperTrigger,children:e.jsx(F.Text,{level:"4",bold:!0,children:o.common.copyFullLog})})})]})}),e.jsx(Ca,{isLoading:u||X,shouldDisableConfirm:R,onClickConfirm:O})]})]})};export{Xa as C};
