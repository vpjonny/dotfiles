import{j as s,u as ps}from"./useTriggerLoadNext.KJIKMCqU.js";import{u as $,g as xs,I as z,B as ss,W as B,a as Ss,b as es,C as bs,e as vs,$ as Ts,p as _s,a0 as Q,a1 as Ns}from"./useActiveTimeStore.C3Wei7Oz.js";import{r as cs,aP as fs,a as m,B as F,l as U,N as as,aQ as ys,E as js,z as Is,a9 as Es,R as ts,x as As}from"./windowUtils.Ut7JS-rc.js";import{i as Y,u as is,B as ws,z as rs,af as Ls,O as Rs,ag as Bs,Q as Vs,L as H}from"./PopupLoading.D-LitESe.js";import{r as g}from"./index.CxJLds0B.js";import{N as ds}from"./Network.CvcxyDcT.js";import{I as y,B as ns,T as M}from"./PasswordLevelLabel.rhWNhrqO.js";import{u as Os,a as Ps}from"./Erc20SelectTokenOnRampPage.CZiohm3T.js";import{a as qs}from"./useSearchErc20Tokens.D0zoSI7L.js";import{E as Ds}from"./EmptyState.B5_-rwyr.js";import{t as zs}from"./useTxStatus.C8QHcxiJ.js";import{S as Ms}from"./index.C702uFBM.js";import"./tiny-invariant.BHpmfUqq.js";import"./enum.CGJbW6Yf.js";import"./preload-helper.2LWRYvkK.js";import"./useDebouncedEffect.CslCnlPq.js";import"./solana.CGFphaJI.js";import"./token.types.DkObBlUj.js";import"./useTempStore.C8dvVNTz.js";const Fs="_customTokenContainer_qqcfy_45",Us="_tabs_qqcfy_54",os={customTokenContainer:Fs,tabs:Us},Ks="_input_m0tyl_1",Ws="_footer_m0tyl_5",D={input:Ks,footer:Ws},Qs=({currentAddress:a,onImported:r})=>{const[x,u]=g.useState(!1),c=cs(),C=async()=>{c(-1)},{data:o}=$(),{setCustomToken:T}=Y(),{data:t}=is([a]),[e,N]=g.useState(fs),{data:S}=Y(),[b,O]=g.useState(),[j,V]=g.useState(),[I,P]=g.useState(void 0),[E,n]=g.useState(void 0),[A,w]=g.useState(void 0),[L,R]=g.useState(void 0),[p,_]=g.useState({}),{toastError:ls,toastSuccess:G}=xs();g.useEffect(()=>{var l,i;o!=null&&o.isSingleChain&&((l=o==null?void 0:o.activeChains)!=null&&l[0])&&N((i=o==null?void 0:o.activeChains)==null?void 0:i[0])},[o==null?void 0:o.activeChains,o==null?void 0:o.isSingleChain]);const K=async()=>{var l,i,h,f,X,Z,J,k;if(b&&e&&!E)try{const q=await Ls({address:b,chainId:(l=e.chainConfig)==null?void 0:l.chainId});if(!q.data)return;const d=q.data,Cs=d==null?void 0:d.symbol;V(Cs),P(U.isNil((i=d==null?void 0:d.platforms[0])==null?void 0:i.decimals)?I:d.platforms[0].decimals),_({...p,logo:d==null?void 0:d.logo,name:d==null?void 0:d.name,price:(X=(f=(h=d==null?void 0:d.quotes)==null?void 0:h.USD)==null?void 0:f.price)==null?void 0:X.toString(),pricePercentChange24h:(k=(J=(Z=d==null?void 0:d.quotes)==null?void 0:Z.USD)==null?void 0:J.percentChange24h)==null?void 0:k.toString()})}catch(q){console.error("onFocusChanged",q)}},ms=l=>{const i=l.target.value,h=t==null?void 0:t.data.find(f=>f.contractAddress.toLowerCase()===i.toLowerCase()&&f.chainId===(e==null?void 0:e.configId));i&&(!i.startsWith("0x")||i.length!==42)?n(m.manageTokens.invalidAddress):n(h!==void 0?m.manageTokens.existedAddress:void 0),O(i)},us=async()=>{var i,h;if(!a)return;const l=(i=e==null?void 0:e.chainConfig)!=null&&i.isCustom?null:p==null?void 0:p.price;if(!(S!=null&&S.customTokensList[a])){await T(a,{name:p.name||ys,symbol:j||"--",contractAddress:b,chainId:e==null?void 0:e.configId,price:l??null,tokenLogo:(p==null?void 0:p.logo)??"",decimals:I,balance:"0",ownerAddress:a,tokenStandard:as.ERC20,pricePercentChange24h:null,computedData:{amount:0,value:null,price:l??null}}),G({title:m.manageTokens.tokenImported}),r();return}if((h=S==null?void 0:S.customTokensList)!=null&&h[a].find(f=>f.contractAddress===b&&f.chainId===(e==null?void 0:e.configId))){ls({title:m.manageTokens.existedAddress});return}await T(a,{name:p.name??j.toUpperCase(),symbol:j.toUpperCase(),contractAddress:b,chainId:e==null?void 0:e.configId,price:l??null,pricePercentChange24h:null,tokenLogo:p.logo??"",decimals:I,balance:"0",ownerAddress:a,tokenStandard:as.ERC20,computedData:{amount:0,value:null,price:l??null}}),G({title:m.manageTokens.tokenImported}),r()},hs=l=>{const i=l.target.value;i.length>11?w(m.manageTokens.maxSymbol):i.length===0?w(m.manageTokens.invalidSymbol):w(void 0),V(i)},gs=l=>{const i=l.target.value;try{const h=U.isEmpty(i)?void 0:Number(i);P(h),h===void 0||Number.isNaN(h)||h>36||h<0?R(m.manageTokens.invalidDecimals):R(void 0)}catch{R(m.manageTokens.invalidDecimals)}},W=m.manageTokens.addCustomToken;return s.jsxs("div",{children:[s.jsx(ds,{chainId:e==null?void 0:e.configId,callback:()=>u(!0)}),s.jsx(z,{autoFocus:!0,placeholder:"0x",label:W.tokenAddress,caption:E,onChange:ms,onFocus:K,className:D.input,intent:E?y.Danger:void 0,withBackground:!0}),s.jsx(z,{placeholder:"eg: AXS",label:W.tokenSymbol,autoCapitalize:"on",caption:A,value:j,onChange:hs,onFocus:K,className:D.input,intent:A?y.Danger:void 0,withBackground:!0}),s.jsx(z,{placeholder:"eg: 18",type:"number",label:W.decimals,caption:L,value:I,onChange:gs,onFocus:K,className:D.input,intent:L?y.Danger:void 0,withBackground:!0}),s.jsx(ws,{children:s.jsxs("div",{className:D.footer,children:[s.jsx(ns,{text:m.common.cancel,intent:y.Secondary,fullWidth:!0,onClick:C,size:ss.Small}),s.jsx(ns,{text:m.common.import,intent:y.Primary,disabled:!!(E||A||L||!b||!j||I===void 0),fullWidth:!0,onClick:us,size:ss.Small})]})}),s.jsx(rs,{currentConfigId:e==null?void 0:e.configId,isVisible:x,requestOnClose:()=>u(!1),onSelect:l=>N(l),blockchains:[F.EVM]})]})},Hs="_tokenListContainer_d2xgc_8",Ys="_searchInput_d2xgc_13",$s="_tokenRecord_d2xgc_18",Gs="_recordContainer_d2xgc_26",Xs="_titleContainer_d2xgc_32",Zs="_tokenName_d2xgc_36",Js="_descriptionContainer_d2xgc_42",ks="_contractAddress_d2xgc_51",se="_tokenList_d2xgc_8",ee="_emptyState_d2xgc_63",v={tokenListContainer:Hs,searchInput:Ys,tokenRecord:$s,recordContainer:Gs,titleContainer:Xs,tokenName:Zs,descriptionContainer:Js,contractAddress:ks,tokenList:se,emptyState:ee},ae=({token:a,onChange:r,checked:x})=>{var C;const u=(C=Ss(a==null?void 0:a.chainId))==null?void 0:C.chainConfig,c=a==null?void 0:a.tokenLogo;return s.jsxs("div",{className:v.tokenRecord,children:[s.jsxs("div",{className:v.recordContainer,children:[s.jsx(Vs,{backAvtSrc:c,backAvtPlaceholder:s.jsx(zs,{size:16}),frontAvtSrc:s.jsx(bs,{chainConfig:u,size:es.Size20,squarePlain:!0}),size:es.Size36,frontSquared:!0}),s.jsxs("div",{className:v.titleContainer,children:[s.jsx(M.Text,{level:"3",intent:y.Secondary,className:v.tokenName,children:a==null?void 0:a.name}),s.jsxs(M.Text,{level:"2",bold:!0,className:v.descriptionContainer,children:[a==null?void 0:a.symbol,s.jsx(B,{when:!Es(a==null?void 0:a.contractAddress),children:s.jsxs(M.Text,{level:"3",intent:y.Secondary,className:v.contractAddress,children:["(",Is(a==null?void 0:a.contractAddress),")"]})})]})]})]}),s.jsx(Ms,{checked:x,onChange:()=>r(a)})]})},te=({customTokens:a,currentAddress:r})=>{const{data:x,setCustomToken:u}=Y(),c=(x==null?void 0:x.customTokensList[r])||[],{data:C}=is([r]),o=a==null?void 0:a.filter(t=>!(C!=null&&C.data.some(e=>(e==null?void 0:e.contractAddress)+(e==null?void 0:e.chainId)===(t==null?void 0:t.contractAddress)+(t==null?void 0:t.chainId)))),T=t=>{u(r,t)};if(o!=null&&o.length)return o==null?void 0:o.map(t=>s.jsx(ae,{token:t,checked:!!(c!=null&&c.find(e=>(e==null?void 0:e.contractAddress)+(e==null?void 0:e.chainId)===(t==null?void 0:t.contractAddress)+(t==null?void 0:t.chainId))),onChange:T},(t==null?void 0:t.contractAddress)+(t==null?void 0:t.decimals)+(t==null?void 0:t.price)+(t==null?void 0:t.chainId)))},ne=({currentAddress:a})=>{var E;const{data:r}=$(),[x,u]=g.useState(""),[c,C]=g.useState(((E=r==null?void 0:r.activeChainIds)==null?void 0:E[0])??js.RONIN),[o,T]=g.useState(!1),t=Os(x,200),{searchTokenList:e,isLoading:N,fetchNextPage:S,hasNextPage:b,isFetchingNextPage:O}=qs(c,t.trim().toLowerCase()),j=n=>{u(n.target.value)},V=U.isEmpty(e)&&!N&&!O,{endOfListRef:I}=ps(()=>{b&&S()}),P=e.map(n=>{var A,w,L,R,p;return{chainId:c,tokenLogo:n==null?void 0:n.logo,name:n==null?void 0:n.name,contractAddress:(w=(A=n==null?void 0:n.platforms)==null?void 0:A.find(_=>(_==null?void 0:_.chainId)===c))==null?void 0:w.address,ownerAddress:a,balance:"0",tokenStandard:(L=n==null?void 0:n.standard)==null?void 0:L.toUpperCase(),symbol:n==null?void 0:n.symbol,decimals:(p=(R=n==null?void 0:n.platforms)==null?void 0:R.find(_=>(_==null?void 0:_.chainId)===c))==null?void 0:p.decimals,price:null,pricePercentChange24h:null,computedData:{price:null,value:null,amount:"0"}}});return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:v.seachContainer,children:[s.jsx(ds,{chainId:c,callback:()=>T(!0)}),s.jsx(z,{placeholder:m.common.search,prefixIcon:s.jsx(Ps,{}),onChange:j,className:v.searchInput})]}),s.jsxs("div",{className:v.tokenListContainer,children:[s.jsx(B,{when:N&&!O,children:s.jsx(Rs,{})}),s.jsx(B,{when:V&&!U.isEmpty(t),children:s.jsx(Ds,{icon:"ðŸ¥²",className:v.emptyState,message:m.manageTokens.addCustomToken.noResult})}),s.jsx(B,{when:!V,children:s.jsxs("div",{className:v.tokenList,children:[s.jsx(te,{currentAddress:a,customTokens:P}),s.jsx(B,{when:b,children:s.jsx("div",{ref:I,children:s.jsx(Bs,{})})})]})})]}),s.jsx(rs,{currentConfigId:c,isVisible:o,requestOnClose:()=>T(!1),onSelect:n=>C(n==null?void 0:n.configId),blockchains:[F.EVM]})]})},fe=()=>{var N,S;const a=cs(),r=vs(),x=Ts(),{data:u}=$(),c=(S=(N=u==null?void 0:u.activeChains)==null?void 0:N[0])==null?void 0:S.chainConfig,[C,o]=g.useState(c!=null&&c.isCustom?"Custom":"Search"),T=_s(),t=()=>{x.refetchQueries({queryKey:[ts.ERC20_TOKEN_LIST_MULTICHAIN]}),a(-1)},e={Search:m.manageTokens.addCustomToken.search,Custom:m.manageTokens.addCustomToken.custom};return s.jsxs(H,{noBackground:!0,noFooter:!0,children:[s.jsx(H.BackableNavbar,{title:m.manageTokens.addCustomToken.title,callback:t,suffixComponent:s.jsx("div",{children:s.jsx(M.Text,{level:"2",bold:!0,intent:y.Info,onClick:()=>{x.refetchQueries({queryKey:[ts.ERC20_TOKEN_LIST_MULTICHAIN]}),a(As.HOME)},children:m.manageWallet.doneBtn})})}),s.jsx(H.Content,{noPadding:!0,children:s.jsxs("div",{className:os.customTokenContainer,children:[s.jsx(B,{when:!(c!=null&&c.isCustom)&&!(u.isSingleChain&&u.activeChainIds[0]===T),children:s.jsxs(Q,{activeKey:C,className:os.tabs,variant:Ns.Border,fullWidth:!0,moreIcon:null,onChange:b=>o(b),children:[s.jsx(Q.TabPane,{tab:e.Search,tabKey:"Search"},"Search"),s.jsx(Q.TabPane,{tab:e.Custom,tabKey:"Custom"},"Custom")]})}),C==="Search"?s.jsx(ne,{currentAddress:r==null?void 0:r.chains[F.EVM].address}):s.jsx(Qs,{currentAddress:r==null?void 0:r.chains[F.EVM].address,onImported:t})]})})]})};export{fe as default};
