import{j as c}from"./useTriggerLoadNext.KJIKMCqU.js";import{R as P,r as B}from"./index.CxJLds0B.js";import{c as N,T as b,I as D}from"./PasswordLevelLabel.rhWNhrqO.js";import{ap as M,aD as Z,aH as G,W as x,aI as H,ak as L,as as Q,a5 as Y,aJ as J}from"./PopupLoading.D-LitESe.js";import{N as C,c as X,az as U,l as g,aQ as nn,aA as w,ag as z,ap as on,af as A,R as en,an as rn,B as cn,ay as v,au as K,ax as E}from"./windowUtils.Ut7JS-rc.js";import{c as an,b as h,J as tn,P as ln,W as R,d as un}from"./useActiveTimeStore.C3Wei7Oz.js";import{S as F}from"./token.types.DkObBlUj.js";import{L as O}from"./enum.CGJbW6Yf.js";import{a as mn}from"./useTempStore.C8dvVNTz.js";const V=an(P.createElement(P.Fragment,null,P.createElement("path",{d:"M128 24c-53.83 0-96 24.6-96 56v96c0 31.4 42.17 56 96 56s96-24.6 96-56V80c0-31.4-42.17-56-96-56Zm80 104c0 9.62-7.88 19.43-21.61 26.92C170.93 163.35 150.19 168 128 168s-42.93-4.65-58.39-13.08C55.88 147.43 48 137.62 48 128v-16.64c17.06 15 46.23 24.64 80 24.64s62.94-9.68 80-24.64Zm-21.61 74.92C170.93 211.35 150.19 216 128 216s-42.93-4.65-58.39-13.08C55.88 195.43 48 185.62 48 176v-16.64c17.06 15 46.23 24.64 80 24.64s62.94-9.68 80-24.64V176c0 9.62-7.88 19.43-21.61 26.92Z"})),"DatabaseFillIcon"),sn="_ring_yag3y_1",dn={ring:sn},pn=({size:n,strokeWidth:e})=>c.jsx("div",{className:dn.ring,children:c.jsx(M,{size:n})}),fn="_dimIcon_1g57v_1",gn="_doubleAvtWrapper_1g57v_5",In="_backAvt_1g57v_11",Tn="_frontAvt_1g57v_17",vn="_genericIcon_1g57v_24",xn="_warningIcon_1g57v_29",hn="_failedIcon_1g57v_34",d={dimIcon:fn,doubleAvtWrapper:gn,backAvt:In,frontAvt:Tn,genericIcon:vn,warningIcon:xn,failedIcon:hn},yn=(n,e)=>[C.NATIVE,C.ERC20].includes(n==null?void 0:n.toUpperCase())?c.jsx(V,{size:e}):c.jsx(Z,{width:e,height:e}),En=()=>c.jsx(x,{img:c.jsx(H,{size:16}),size:h.Size36,className:N(d.genericIcon,d.warningIcon)}),Sn=()=>c.jsx(x,{img:c.jsx(tn,{size:16}),size:h.Size36,className:N(d.genericIcon,d.failedIcon)}),_n=()=>c.jsx(x,{img:c.jsx(pn,{}),size:h.Size36,className:d.genericIcon}),Nn=(n,e)=>{var a,u,i,l;const t=c.jsx(L,{size:16,className:d.dimIcon});return(n==null?void 0:n.length)===1&&(e==null?void 0:e.length)===1?c.jsxs("div",{className:d.doubleAvtWrapper,children:[c.jsx(x,{img:(u=(a=n[0])==null?void 0:a.token)==null?void 0:u.logo,className:N(d.genericIcon,d.backAvt),size:h.Size24,placeholderImage:c.jsx(V,{size:16})}),c.jsx(x,{img:(l=(i=e[0])==null?void 0:i.token)==null?void 0:l.logo,className:N(d.genericIcon,d.frontAvt),size:h.Size24,placeholderImage:c.jsx(V,{size:16})})]}):c.jsx(x,{img:t,size:h.Size32,className:d.genericIcon})},kn=(n,e)=>{var u,i,l,o;const t=c.jsx(L,{size:16,className:d.dimIcon}),a=((i=(u=e==null?void 0:e[0])==null?void 0:u.token)==null?void 0:i.logo)||t;return c.jsx(x,{img:a,size:h.Size32,placeholderImage:yn((o=(l=e==null?void 0:e[0])==null?void 0:l.token)==null?void 0:o.standard,16),className:d.genericIcon})},Kn=({actionType:n,transactionHash:e,isPending:t,isInQueue:a,isDropped:u,inAssets:i,outAssets:l,activities:o,timestamp:r,success:m})=>{var S,_,W,q;const{pendingTx:s,setPendingTxs:f}=G(),p=s==null?void 0:s.find(T=>e?X(T==null?void 0:T.hash,e)&&(T==null?void 0:T.isPending):(T==null?void 0:T.isPending)&&(T==null?void 0:T.timestamp)==r),I=(p==null?void 0:p.isPending)&&!t,k=!m&&!t&&!u&&!a;if(B.useEffect(()=>{t?f({hash:e,isPending:t,timestamp:r}):I&&setTimeout(()=>f({hash:e,isPending:!1,timestamp:r}),2e3)},[]),t)return _n();if(u||a)return En();if(k)return Sn();if(n===U.SWAP)return Nn(l,i);if(n!==U.GENERIC)return kn(n,o);if(!g.isEmpty(l)||!g.isEmpty(i))return c.jsx(x,{img:((_=(S=l[0])==null?void 0:S.token)==null?void 0:_.logo)??((q=(W=i[0])==null?void 0:W.token)==null?void 0:q.logo),size:h.Size32,className:d.genericIcon});const j=c.jsx(L,{size:16,className:d.dimIcon});return c.jsx(x,{img:j,size:h.Size32,className:d.genericIcon})},jn="_amountContainer_qc83v_1",bn="_tokenValue_qc83v_7",Cn="_subInfo_qc83v_14",Pn="_fiatValue_qc83v_21",Dn="_popoverContainer_qc83v_30",wn="_triggerWrapper_qc83v_35",y={amountContainer:jn,tokenValue:bn,subInfo:Cn,fiatValue:Pn,popoverContainer:Dn,triggerWrapper:wn},zn=(n,e)=>{var u,i,l,o;const t=[C.NATIVE,C.ERC20,F.SPL,F.SPL_TOKEN].map(r=>r.toUpperCase()).includes((i=(u=n==null?void 0:n.token)==null?void 0:u.standard)==null?void 0:i.toUpperCase()),a=(n==null?void 0:n.type)===w.RECEIVE;if(t){const r=z(n==null?void 0:n.value,(l=n==null?void 0:n.token)==null?void 0:l.decimals),m=!g.isNil(r)&&!g.isNil((o=n==null?void 0:n.token)==null?void 0:o.decimals),s=m?on(r):null,f=m?A(r):null,p=(e==null?void 0:e.usdPrice)??null,I=!g.isNil(p)&&!g.isNil(r)?Number(r)*p:null;return{isTokenAsset:t,txInDirection:a,displayedAmount:f,exactAmount:s,quotePrice:I}}return{isTokenAsset:t,txInDirection:a,exactAmount:n==null?void 0:n.value,displayedAmount:n==null?void 0:n.value,quotePrice:null}},$=({isTokenAsset:n,quotePrice:e,name:t,currency:a})=>c.jsxs(c.Fragment,{children:[c.jsx(R,{when:n,children:c.jsxs("div",{className:y.fiatValue,children:[c.jsx(b.Text,{level:"4",intent:D.Secondary,children:"â‰ˆ"}),c.jsx(Y,{value:e,textOptions:{level:"3",intent:D.Secondary},currency:a})]})}),c.jsx(R,{when:!n,children:c.jsx(b.Text,{level:"3",intent:D.Secondary,className:y.subInfo,children:t??"--"})})]}),Mn=({asset:n,chainId:e,currency:t,amountTextOptions:a,showSubInfoOption:u=!1,showPopover:i=!0,className:l})=>{var k,j,S,_;const{tokenPrices:o}=Q({tokens:[{address:((k=n==null?void 0:n.token)==null?void 0:k.address)??"",chainId:e}]}),{isTokenAsset:r,txInDirection:m,displayedAmount:s,exactAmount:f,quotePrice:p}=zn(n,o[0]),I=((j=n==null?void 0:n.token)==null?void 0:j.symbol)||(r?nn:"items");return c.jsx(ln,{triggerElement:c.jsxs("div",{className:y.amountContainer,children:[c.jsx(b.Text,{level:"2",...a,className:y.tokenValue,children:`${m?"+":"-"} ${s??"--"} ${I}`}),c.jsx(R,{when:u&&!g.isNil(p),children:c.jsx($,{isTokenAsset:r,quotePrice:p,name:(S=n==null?void 0:n.token)==null?void 0:S.name,currency:t})})]}),triggerWrapperClassName:N(y.triggerWrapper,l),isOpen:i,hoverToShow:i,children:c.jsxs("div",{className:y.amountContainer,children:[c.jsx(b.Text,{level:"2",...a,className:y.popoverContainer,children:`${m?"+":"-"} ${f??"--"} ${I}`}),c.jsx($,{isTokenAsset:r,quotePrice:p,name:(_=n==null?void 0:n.token)==null?void 0:_.name,currency:t})]})})},Zn=({inAssets:n,outAssets:e})=>{const t=n.map(o=>{var f,p,I;const r=z(o==null?void 0:o.value,(f=o==null?void 0:o.token)==null?void 0:f.decimals);return{displayedAmount:!g.isNil(r)&&!g.isNil((p=o==null?void 0:o.token)==null?void 0:p.decimals)?A(r):"--",symbol:((I=o==null?void 0:o.token)==null?void 0:I.symbol)??"--"}}),a=e.map(o=>{var f,p,I;const r=z(o==null?void 0:o.value,(f=o==null?void 0:o.token)==null?void 0:f.decimals);return{displayedAmount:!g.isNil(r)&&!g.isNil((p=o==null?void 0:o.token)==null?void 0:p.decimals)?A(r):"--",symbol:((I=o==null?void 0:o.token)==null?void 0:I.symbol)??"--"}}),u=g.isEmpty(e)?"--":e.map(o=>{var r;return((r=o==null?void 0:o.token)==null?void 0:r.symbol)||"--"}).join(", "),i=g.isEmpty(n)?"--":n.map(o=>{var r;return((r=o==null?void 0:o.token)==null?void 0:r.symbol)||"--"}).join(", "),l=(n==null?void 0:n.length)===1&&(e==null?void 0:e.length)===1;return{safeInAmountsInfo:t,safeOutAmountsInfo:a,outTokenSymbols:u,inTokenSymbols:i,validSwapTokenPair:l}},Gn=n=>{let e=[],t=[];return n==null||n.map(a=>{(a==null?void 0:a.type)===w.RECEIVE&&(e=[...e,a]),(a==null?void 0:a.type)===w.SEND&&(t=[...t,a])}),{inAssets:e,outAssets:t}},An=async(n,e,t)=>{const{chainId:a,txHash:u,nonce:i,localTxId:l}=n;try{if(n.status!==v.PENDING)return n.status;const o=K.getProvider(a),r=await J(a,e==null?void 0:e.toLowerCase());if(i&&r<i){O.info("Transaction nonce is lower than current nonce:",i,r);const f={...n,status:v.IN_QUEUE};return await E.set(l,f),f.status}const m=await o.waitTransaction(u,{confirms:1,timeout:6e4});let s;return m?(s={...n,status:m.status===1?v.SUCCESS:v.FAILED},m.status===1&&t&&t()):s={...n,status:v.DROPPED},await E.set(l,s),s.status}catch(o){if(O.error("Error fetching transaction status:",e,o),typeof o=="object"&&o.code==="TIMEOUT"){const r={...n,status:v.DROPPED};return await E.set(l,r),r.status}}return n.status},Rn=async(n,e)=>{const{chainId:t,txHash:a,localTxId:u}=n;try{if(n.status!==v.PENDING)return n.status;const i=n==null?void 0:n.timestamp,l=K.getProvider(t);let o=n;for(;;){if(e!=null&&e.aborted)return o.status;if(Date.now()-i>3e5)return o={...o,status:v.DROPPED},await E.set(u,o),o.status;const r=await l.getSignatureStatus(a,{searchTransactionHistory:!0});if(r!=null&&r.value){if(r.value.err){o={...o,status:v.FAILED};break}if(r.value.confirmationStatus==="confirmed"||r.value.confirmationStatus==="finalized"){o={...o,status:v.SUCCESS};break}}else if(Date.now()-i>9e5){o={...o,status:v.DROPPED};break}await new Promise(m=>setTimeout(m,2e3))}return await E.set(u,o),o.status}catch(i){O.error("Error in fetchSolanaTxStatus:",i);const l={...n,status:v.DROPPED};return await E.set(u,l),l.status}},Hn=(n,e)=>{const{chainId:t,txHash:a,localTxId:u}=e,{reloadTokens:i}=mn(),l=B.useCallback(()=>{i(3e3)},[i]),o=async r=>{var s;const m=await rn(t);return((s=m==null?void 0:m.chainConfig)==null?void 0:s.blockchain)===cn.SOLANA?Rn(e,r):An(e,n,l)};return un({queryKey:[en.TX_STATUS,a,u],queryFn:({signal:r})=>o(r),initialData:e.status,staleTime:0})};export{Kn as A,Mn as S,Zn as a,yn as b,pn as c,zn as d,Gn as g,V as t,Hn as u};
