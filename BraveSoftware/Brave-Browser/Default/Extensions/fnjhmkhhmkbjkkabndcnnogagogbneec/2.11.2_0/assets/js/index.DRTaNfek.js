import{b as s,M as c,L as l,R as r}from"./enum.CGJbW6Yf.js";import{i}from"./index.umd.Dte_l0di.js";import"./tiny-invariant.BHpmfUqq.js";const d=()=>{if(typeof document>"u")return;let e;const n=document.getElementsByTagName("link");for(let t=0;t<n.length;t++){const o=n[t].getAttribute("rel");o&&["icon","shortcut icon"].includes(o)&&(e=n[t].getAttribute("href")||void 0)}if(e)try{return new URL(e).href}catch{return`${document.location.origin}/${e.replace("/","")}`}},p=()=>{var t;const e=d(),n=(t=document.querySelector("meta[property='og:site_name']"))==null?void 0:t.getAttribute("content");return{url:document.location.origin,name:n||document.title,icon:e}};window.addEventListener(i.RequestType.JSON_RPC,async e=>{const n=e.detail,t=n.payload.id;try{const o=p(),a=await s.runtime.sendMessage({type:c.ASK_PROVIDER_FROM_CONTENT_SCRIPT,message:{...n.payload},peerMeta:o});window.postMessage(JSON.stringify(a),window.location.origin)}catch(o){l.error("JSON_RPC",o);const a={isWalletEvent:!0,type:i.WalletEventType.JSON_RPC_RESPONSE,data:{jsonrpc:"2.0",error:o,id:t,result:void 0}};window.postMessage(JSON.stringify(a),window.location.origin)}},!1);s.runtime.onMessage.addListener((e,n)=>{if(s.runtime.id!==n.id)return console.error(`Receiving message from unauthorized sender ${n}.`),Promise.reject();switch(e.roninEvent){case r.ACCOUNTS_CHANGED:{const t={isWalletEvent:!0,type:i.WalletEventType.ACCOUNTS_CHANGED,data:e.payload,blockchain:e.blockchain};return window.postMessage(JSON.stringify(t),window.location.origin),Promise.resolve(!0)}case r.CHAIN_ID_CHANGED:{const t={isWalletEvent:!0,type:i.WalletEventType.CHAIN_CHANGED,data:e.payload,blockchain:e.blockchain};return window.postMessage(JSON.stringify(t),window.location.origin),Promise.resolve(!0)}case r.UNLOCK_CHANGED:{const t={isWalletEvent:!0,type:i.WalletEventType.ACCOUNTS_CHANGED,data:[],blockchain:e.blockchain};return window.postMessage(JSON.stringify(t),window.location.origin),Promise.resolve(!0)}case r.ACCOUNT_CHANGED:{const t={direction:"from-ronin-content-script",roninEvent:r.ACCOUNT_CHANGED,detail:e.payload,blockchain:e.blockchain};return window.postMessage(t,window.location.origin),Promise.resolve(!0)}}});setInterval(()=>{s.runtime.sendMessage({type:c.KEEP_ALIVE_FROM_CONTENT_SCRIPT})},1e4);const E=()=>{setTimeout(()=>{const e={isWalletEvent:!0,type:i.WalletEventType.CONTENT_SCRIPT_READY};window.postMessage(JSON.stringify(e),window.location.origin)},100)};E();
