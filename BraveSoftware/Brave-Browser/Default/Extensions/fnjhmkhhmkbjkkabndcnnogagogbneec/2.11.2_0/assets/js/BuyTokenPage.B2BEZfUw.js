import{j as e}from"./useTriggerLoadNext.KJIKMCqU.js";import{d as Re,I as Te,m as Xe,a6 as ve}from"./useActiveTimeStore.C3Wei7Oz.js";import{aR as X,aS as Ze,m as B,aT as Je,aU as en,aV as nn,p as on,u as tn,aW as rn,R as ke,r as be,a as S,x as Ae,l as H,aX as Ne,C as sn,o as we,aY as an,ae as cn,b as fe,T as ye,e as _e,f as Ce,X as Pe,W as ln,w as un,aZ as Se}from"./windowUtils.Ut7JS-rc.js";import{a as Z,L as E,P as J,aj as ee,T as dn,S as pn,B as mn}from"./PopupLoading.D-LitESe.js";import{L as Ie}from"./enum.CGJbW6Yf.js";import{T as y,I as N,d as M,e as Le,L as Ee,S as hn,B as gn}from"./PasswordLevelLabel.rhWNhrqO.js";import{r as v}from"./index.CxJLds0B.js";import{u as Be,a as xn}from"./Erc20SelectTokenOnRampPage.CZiohm3T.js";import{G as vn}from"./GroupFooterDialog.DIG6SS89.js";import{t as fn}from"./PokerChip.BO86YiO6.js";import"./tiny-invariant.BHpmfUqq.js";import"./preload-helper.2LWRYvkK.js";import"./useDebouncedEffect.CslCnlPq.js";import"./solana.CGFphaJI.js";import"./EmptyState.B5_-rwyr.js";import"./useSearchErc20Tokens.D0zoSI7L.js";import"./Network.CvcxyDcT.js";const U=X.Prod,yn=new Ze(U===X.Prod?B.moonpayClientKey.production:B.moonpayClientKey.staging,"MoonPay","moonpay",U,"https://wallet-manager.skymavis.com/wallet-manager/v2/public"),_n=new Je(B.rampClientKey,"Ramp","ramp",U),Cn=new en(B.onmetaClientKey,"Onmeta","onmeta",U),Pn=new nn(U===X.Prod?B.transakClientId.production:B.transakClientId.staging,"Transak","transak",U),Sn=async()=>{const d=await on.walletManagerV2Api(`/common?user-agent=${encodeURIComponent(tn)}`),n=[Pn,yn,_n,Cn].filter(p=>!!d.data.fiat_providers.find(l=>{var r,s;return((r=l.id)==null?void 0:r.toLowerCase())===((s=p.id)==null?void 0:s.toLowerCase())})),c="https://wallet-manager.skymavis.com/";return new rn(n,c)},jn=()=>{const{setPurchaseProvider:d}=Z(n=>n);return Re({queryKey:[ke.PROVIDERS],queryFn:async()=>{try{const n=await Sn();return n&&d(n),{supportedfiat:await n.getSupportedFiat(),areaCurrency:n.location}}catch(n){Ie.error(n)}}})},Rn="_content_3ms3a_1",Tn={content:Rn},kn=({tokenSymbol:d})=>{const n=be();return e.jsxs(E,{noBackground:!0,noFooter:!0,children:[e.jsx(E.BackableNavbar,{title:`${S.deposit.onRamp.buy.title} ${d}`,suffixComponent:e.jsx(y.Text,{level:"2",bold:!0,intent:N.Info,onClick:()=>{n(Ae.RECEIVE,{state:{from:location}})},children:S.common.done})}),e.jsx(E.Content,{className:Tn.content,children:e.jsx(M.Dot,{intent:N.Primary})})]})},bn="_content_ion73_1",An="_amountToken_ion73_9",Nn="_settingsGroup_ion73_13",wn="_loadingProvider_ion73_16",In="_providerIcon_ion73_28",Ln="_currencyIcon_ion73_31",I={content:bn,amountToken:An,settingsGroup:Nn,loadingProvider:wn,providerIcon:In,currencyIcon:Ln},En="_fiatBox_dca1j_1",Bn="_fiatContainer_dca1j_12",Un="_icon_dca1j_19",$n="_header_dca1j_31",W={fiatBox:En,fiatContainer:Bn,icon:Un,header:$n},Dn=d=>{const{visible:n,onSelectFiat:c,supportedFiatArray:p,tokenSymbol:l,onCloseDialog:r}=d,[s,i]=v.useState(""),_=Be(s,200),C=p.filter(u=>{var R,b,P,t;const j=((b=(R=u==null?void 0:u.fiat)==null?void 0:R.code)==null?void 0:b.toLowerCase())||"",k=((t=(P=u==null?void 0:u.fiat)==null?void 0:P.name)==null?void 0:t.toLowerCase())||"";return j.includes(_.toLowerCase())||k.includes(_.toLowerCase())});return e.jsx(J,{visible:n,title:e.jsxs("div",{className:W.header,children:[e.jsx(y.Text,{level:"2",bold:!0,children:S.formatString(S.deposit.onRamp.buyWith,l).toString()}),e.jsx(Te,{size:Le.Small,withBackground:!0,prefixIcon:e.jsx(xn,{}),placeholder:S.common.search,onChange:u=>i(u.target.value)})]}),closeType:ee.TextDone,content:e.jsx("div",{className:W.fiatBox,children:C.map((u,j)=>{var k,R,b;return e.jsxs("div",{className:W.fiatContainer,role:"button",tabIndex:0,onClick:()=>{c(u),i(""),r()},children:[e.jsx("div",{className:W.icon,children:!H.isEmpty((k=u==null?void 0:u.fiat)==null?void 0:k.icon)&&e.jsx(dn,{src:(R=u==null?void 0:u.fiat)==null?void 0:R.icon,width:40,height:40})}),e.jsx(y.Text,{level:"2",bold:!0,children:(b=u.fiat)==null?void 0:b.code.toUpperCase()})]},j)})}),onClose:()=>{i(""),r()}})},Ue=(d,n)=>{const[c,p]=v.useState(null),[l,r]=v.useState(!0),s=Z(i=>i.purchaseProvider);return v.useEffect(()=>{const i=async(C,u)=>{try{return s?await s.getFiatExchangeRange(C,u):null}catch{return null}};(async()=>{r(!0);try{const C=await i(d,n);p(C)}catch{}finally{r(!1)}})()},[d,n]),{limits:c,limitsLoading:l}},Mn="_content_59hqp_1",On="_providerContainer_59hqp_4",Vn="_childContainer_59hqp_10",Wn="_icon_59hqp_17",qn="_providerInfo_59hqp_20",Fn="_bestRate_59hqp_25",L={content:Mn,providerContainer:On,childContainer:Vn,icon:Wn,providerInfo:qn,bestRate:Fn},Kn=d=>{const{visible:n,onSelectProvider:c,providers:p,suggestedProviderName:l,onCloseDialog:r}=d;return e.jsx(J,{visible:n,title:S.deposit.onRamp.selectProvider,closeType:ee.TextDone,content:e.jsx("div",{className:L.content,children:p.map((s,i)=>{var _,C,u,j,k,R,b,P,t;return e.jsxs("div",{className:L.providerContainer,role:"button",tabIndex:0,onClick:()=>{c(s),r()},children:[e.jsxs("div",{className:L.childContainer,children:[e.jsx("img",{src:Ne((C=(_=s==null?void 0:s.provider)==null?void 0:_.icon)==null?void 0:C.toString()),alt:"fiat-icon",width:40,height:40,className:L.icon}),e.jsxs("div",{className:L.providerInfo,children:[e.jsx(y.Text,{level:"2",bold:!0,children:(u=s==null?void 0:s.provider)==null?void 0:u.name}),e.jsx(y.Text,{level:"2",children:`${(k=(j=s==null?void 0:s.quote)==null?void 0:j.cryptoReceive)==null?void 0:k.toLocaleString("en-US")} ${(b=(R=s==null?void 0:s.quote)==null?void 0:R.cryptoSymbol)==null?void 0:b.toUpperCase()}`})]})]}),(l==null?void 0:l.toLowerCase())===((t=(P=s==null?void 0:s.provider)==null?void 0:P.name)==null?void 0:t.toLowerCase())&&e.jsx("div",{className:L.bestRate,children:e.jsx(y.Label,{level:Ee.Small,children:S.deposit.onRamp.bestRate})})]},i)})}),onClose:r})},Gn="_dialog_s4ah5_1",zn="_content_s4ah5_1",Yn="_description_s4ah5_7",Qn="_link_s4ah5_17",Hn="_footer_s4ah5_20",$={dialog:Gn,content:zn,description:Yn,link:Qn,footer:Hn},Xn=d=>{const{visible:n,onNext:c,onCloseDialog:p}=d,l=S.deposit.onRamp.warning;return e.jsx(J,{className:$.dialog,visible:n,title:l.title,closeType:ee.TextDone,content:e.jsxs("div",{className:$.content,children:[e.jsx("img",{src:sn.RampImage,width:60,height:40,alt:"ramp-icon"}),e.jsxs("div",{className:$.description,children:[e.jsx("div",{children:l.message}),e.jsx(y.Label,{level:Ee.Medium,intent:N.Info,className:$.link,onClick:()=>{we(an)},children:l.link})]})]}),onClose:p,footer:e.jsx("div",{className:$.footer,children:e.jsx(vn,{primaryBtn:{title:l.actionBuy,handleClick:()=>{c(),p()}},secondaryBtn:{title:S.common.cancel,handleClick:p}})})})},Zn=({fiat:d,symbol:n,amount:c,chainId:p})=>{const{purchaseProvider:l}=Z(_=>_),r=async(_,C,u,j)=>{if(!l||u===0)return null;try{return await l.getBestProvider(_,C,u,j)}catch{return null}},{isLoading:s,...i}=Re({queryKey:[ke.BEST_PROVIDERS,n,d,c,p],queryFn:async()=>await r(d,n,c,p),staleTime:0,refetchInterval:15e3});return{isLoading:s,data:i==null?void 0:i.data}},Jn="_amountFiat_7mshi_1",eo="_inputAmount_7mshi_8",je={amountFiat:Jn,inputAmount:eo},no=d=>{const{amount:n,onChangeAmount:c,code:p}=d;return e.jsxs("div",{className:je.amountFiat,children:[e.jsx(Te,{withBackground:!0,shape:hn.Rounded,type:"number",onChange:l=>{c(l.target.value)},className:je.inputAmount,placeholder:"0",value:n,size:Le.Small}),e.jsx(y.Heading,{level:"5",children:p==null?void 0:p.toUpperCase()})]})},oo="_limitContainer_8g6lx_1",to="_limitText_8g6lx_7",D={limitContainer:oo,limitText:to},ro=d=>{const{deposit:{onRamp:{buy:n}}}=S,{code:c,precision:p,symbol:l}=d,{limits:r,limitsLoading:s}=Ue(c,l),i=_=>_.toLocaleString("en-US",{maximumFractionDigits:p??0,style:"currency",currency:c.toUpperCase()??"USD"});return e.jsxs("div",{className:D.limitContainer,children:[e.jsx(y.Text,{level:"3",className:D.limitText,children:n.limit}),s?e.jsx(M.Skeleton,{height:24,width:100,borderRadius:12}):e.jsxs(e.Fragment,{children:[(r==null?void 0:r.minPurchaseAmount)>-1&&e.jsx(y.Text,{level:"3",className:D.limitText,children:`${n.min} ${i(r==null?void 0:r.minPurchaseAmount)}`}),(r==null?void 0:r.maxPurchaseAmount)>-1&&(r==null?void 0:r.minPurchaseAmount)>-1&&e.jsx(y.Text,{level:"3",className:D.limitText,children:" - "}),(r==null?void 0:r.maxPurchaseAmount)>-1&&e.jsxs(y.Text,{level:"3",className:D.limitText,children:[n.max," ",i(r==null?void 0:r.maxPurchaseAmount)]})]})]})},so=500,ao=d=>{var re,se,ae,ie,ce,le,ue;const{tokenSymbol:n,supportedFiat:c,currency:p,chainId:l}=d,r=be(),s=cn(),{accountInfo:i}=Xe(),[_,C]=v.useState(!1),[u,j]=v.useState(!1),[k,R]=v.useState(!1),b=c[p],P=S.deposit.onRamp.buy,[t,$e]=v.useState(b),[m,q]=v.useState(null),[F,De]=v.useState(""),Me=Be(F,so),[O,V]=v.useState(),{limits:a,limitsLoading:Oe}=Ue((re=t==null?void 0:t.fiat)==null?void 0:re.code,n),{isLoading:K,data:h}=Zn({fiat:(se=t==null?void 0:t.fiat)==null?void 0:se.code,symbol:n,amount:Number(Me),chainId:l}),G=v.useMemo(()=>h==null?void 0:h.suggestedProvider,[h==null?void 0:h.suggestedProvider]),T=v.useMemo(()=>(h==null?void 0:h.allProviders)||[],[h==null?void 0:h.allProviders]),z=v.useMemo(()=>{var g,x;const o=(g=T==null?void 0:T.find(f=>{var A;return((A=f==null?void 0:f.provider)==null?void 0:A.name)===(m==null?void 0:m.name)}))==null?void 0:g.quote;return((x=o==null?void 0:o.fees)==null?void 0:x.total)??null},[T,m]),w=v.useMemo(()=>{var g;return((g=T==null?void 0:T.find(x=>{var f;return((f=x==null?void 0:x.provider)==null?void 0:f.name)===(m==null?void 0:m.name)}))==null?void 0:g.quote)||null},[T,m]),Ve=Object.entries(c??{}).map(([,o])=>({fiat:o==null?void 0:o.fiat,precision:o==null?void 0:o.precision,supportedProvider:o==null?void 0:o.supportedProvider})).sort((o,g)=>{var x,f,A;return(A=(x=o==null?void 0:o.fiat)==null?void 0:x.code)==null?void 0:A.localeCompare((f=g==null?void 0:g.fiat)==null?void 0:f.code)}),ne=((ae=t==null?void 0:t.supportedProvider)==null?void 0:ae.length)===0||!a||(a==null?void 0:a.maxPurchaseAmount)===0,We=ne||(((ie=w==null?void 0:w.cryptoReceive)==null?void 0:ie.toLocaleString("en-US"))??"0")==="0"||!!O,qe=()=>{R(!1)},Fe=o=>{var f;let g="";const x=(t==null?void 0:t.precision)??0;if(((f=o.split(".")[1])==null?void 0:f.length)>x){g=x?S.formatString(P.maxPrecision,x).toString():P.noPrecision,V(g);return}if(ne||!(a!=null&&a.minPurchaseAmount)){V(void 0);return}if(a&&((a==null?void 0:a.minPurchaseAmount)>-1&&(a==null?void 0:a.minPurchaseAmount)>Number(o)||(a==null?void 0:a.maxPurchaseAmount)>=0&&(a==null?void 0:a.maxPurchaseAmount)<Number(o))){V(P.invalidAmount);return}V(void 0)},oe=o=>{De(o),Fe(o)},Ke=o=>{$e(o)},Ge=o=>{q(o.provider),fe.sendEvent(ye.Click,_e.Deposit,Ce.DepositOnRamp+" - "+Pe.ChangeProvider,{action_properties:{provider:o.provider.name}})},te=async()=>{var o,g,x,f,A,de,pe,me,he,ge,xe;if(fe.sendEvent(ye.Click,_e.Deposit,Ce.DepositOnRamp+" - "+Pe.Next,{action_properties:{provider:m.name}}),m&&((g=(o=i==null?void 0:i.data)==null?void 0:o.currentAccount)!=null&&g.address)){let Y;((f=(x=i==null?void 0:i.data)==null?void 0:x.currentAccount)==null?void 0:f.type)===ln.MPC?Y=(me=(pe=un.getWalletById((de=(A=i==null?void 0:i.data)==null?void 0:A.currentAccount)==null?void 0:de.walletId))==null?void 0:pe.getState())==null?void 0:me.auth.email:Y=void 0;try{const Q=await m.getBuyUrl((he=t==null?void 0:t.fiat)==null?void 0:he.code.toLowerCase(),n,Number(F),(xe=(ge=i==null?void 0:i.data)==null?void 0:ge.currentAccount)==null?void 0:xe.address,"dark",Y,l);we(Q)}catch(Q){Ie.error(Q)}}},ze=()=>{(m==null?void 0:m.id)==="ramp"?R(!0):te()};v.useEffect(()=>{var g;const o=((g=a==null?void 0:a.minPurchaseAmount)==null?void 0:g.toString())??"0";oe(o)},[a==null?void 0:a.minPurchaseAmount]),v.useEffect(()=>{h!=null&&h.suggestedProvider?q(h==null?void 0:h.suggestedProvider):q(null)},[h==null?void 0:h.suggestedProvider]);const Ye=()=>{var o,g,x;return O?{noIndicator:!0,title:P.noProviderAvailable}:Oe||K?{title:e.jsx("div",{className:I.loadingProvider,children:e.jsx(M.Dot,{intent:N.Primary})}),noIndicator:!0}:m?{noIndicator:T.length===1,customLeftIcon:e.jsx("img",{src:Ne((o=m==null?void 0:m.icon)==null?void 0:o.toString()),width:24,height:24,alt:"provider-icon",className:I.providerIcon}),title:m==null?void 0:m.name,extraInfo:K?e.jsx(M.Skeleton,{height:24,width:40,borderRadius:12}):`${P.fee} ${z==null?void 0:z.toLocaleString("en-US",{style:"currency",currency:((x=(g=t==null?void 0:t.fiat)==null?void 0:g.code)==null?void 0:x.toUpperCase())??"USD",maximumFractionDigits:(t==null?void 0:t.precision)??0})}`,callback:()=>{T.length>1&&j(!0)}}:{noIndicator:!0,title:P.noProviderAvailable}},Qe=()=>{var o;return O?e.jsx(y.Text,{level:"3",intent:N.Danger,children:O}):K?e.jsx(M.Skeleton,{height:24,width:100,borderRadius:12}):e.jsx(y.Text,{level:"3",children:`â‰ˆ ${((o=w==null?void 0:w.cryptoReceive)==null?void 0:o.toLocaleString("en-US"))??0} ${n.toUpperCase()}`})},He=[Ye(),{customLeftIcon:e.jsx(fn,{size:20,color:I.currencyIcon}),title:P.currency,extraInfo:(ce=t==null?void 0:t.fiat)==null?void 0:ce.code.toUpperCase(),callback:()=>{C(!0)}}];return e.jsxs(E,{noBackground:!0,noFooter:!0,children:[e.jsx(E.BackableNavbar,{title:`${P.title} ${n}`,suffixComponent:e.jsx(y.Text,{level:"2",bold:!0,intent:N.Info,onClick:()=>{r(Ae.RECEIVE,{state:{from:s}})},children:S.common.done})}),e.jsxs(E.Content,{className:I.content,children:[e.jsx(no,{amount:F,onChangeAmount:oe,code:(le=t==null?void 0:t.fiat)==null?void 0:le.code}),e.jsx("div",{className:I.amountToken,children:Qe()}),a&&(a==null?void 0:a.maxPurchaseAmount)!==0&&e.jsx(ro,{code:(ue=t==null?void 0:t.fiat)==null?void 0:ue.code,precision:t==null?void 0:t.precision,symbol:n}),e.jsx("div",{className:I.settingsGroup,children:e.jsx(pn,{settingList:He})}),e.jsx(mn,{children:e.jsx(gn,{fullWidth:!0,intent:N.Primary,disabled:We,onClick:ze,text:S.common.next})}),e.jsx(Dn,{visible:_,onSelectFiat:Ke,supportedFiatArray:Ve,tokenSymbol:n,onCloseDialog:()=>{C(!1)}}),e.jsx(Kn,{visible:u,onSelectProvider:Ge,providers:T,suggestedProviderName:G==null?void 0:G.name,onCloseDialog:()=>{j(!1)}}),e.jsx(Xn,{visible:k,onNext:te,onCloseDialog:qe})]})]})},Ro=()=>{var s;const d=Se(ve.TOKEN_SYMBOL),n=Se(ve.TOKEN_NETWORK),{data:c,isLoading:p}=jn();if(p)return e.jsx(kn,{tokenSymbol:d});if(!c)return null;const l=((s=c==null?void 0:c.areaCurrency)==null?void 0:s.currency_code.toLowerCase())??"usd",r=(c==null?void 0:c.supportedfiat)??{};return e.jsx(ao,{tokenSymbol:d,supportedFiat:r,currency:H.get(r,l)?l:"usd",chainId:H.isEmpty(n)?void 0:Number(n)})};export{Ro as default};
